function GraphemeSplitter(){function t(t,e){return 55296<=t.charCodeAt(e)&&t.charCodeAt(e)<=56319&&56320<=t.charCodeAt(e+1)&&t.charCodeAt(e+1)<=57343}function e(t,e){void 0===e&&(e=0);var i=t.charCodeAt(e);if(55296<=i&&i<=56319&&e<t.length-1){var r=i,n=t.charCodeAt(e+1);return 56320<=n&&n<=57343?1024*(r-55296)+(n-56320)+65536:r}if(56320<=i&&i<=57343&&e>=1){r=t.charCodeAt(e-1),n=i;return 55296<=r&&r<=56319?1024*(r-55296)+(n-56320)+65536:n}return i}function i(t,e,i){var r=[t].concat(e).concat([i]),g=r[r.length-2],C=i,E=r.lastIndexOf(_);if(E>1&&r.slice(1,E).every(function(t){return t==a})&&-1==[a,m,T].indexOf(t))return b;var I=r.lastIndexOf(h);if(I>0&&r.slice(1,I).every(function(t){return t==h})&&-1==[y,h].indexOf(g))return r.filter(function(t){return t==h}).length%2==1?P:A;if(g==n&&C==o)return S;if(g==s||g==n||g==o)return C==_&&e.every(function(t){return t==a})?b:w;if(C==s||C==n||C==o)return w;if(g==c&&(C==c||C==u||C==d||C==f))return S;if(!(g!=d&&g!=u||C!=u&&C!=p))return S;if((g==f||g==p)&&C==p)return S;if(C==a||C==v)return S;if(C==l)return S;if(g==y)return S;var O=-1!=r.indexOf(a)?r.lastIndexOf(a)-1:r.length-2;return-1!=[m,T].indexOf(r[O])&&r.slice(O+1,-1).every(function(t){return t==a})&&C==_?S:g==v&&-1!=[x,T].indexOf(C)?S:-1!=e.indexOf(h)?b:g==h&&C==h?S:w}function r(t){return 1536<=t&&t<=1541||1757==t||1807==t||2274==t||3406==t||69821==t||70082<=t&&t<=70083||72250==t||72326<=t&&t<=72329||73030==t?y:13==t?n:10==t?o:0<=t&&t<=9||11<=t&&t<=12||14<=t&&t<=31||127<=t&&t<=159||173==t||1564==t||6158==t||8203==t||8206<=t&&t<=8207||8232==t||8233==t||8234<=t&&t<=8238||8288<=t&&t<=8292||8293==t||8294<=t&&t<=8303||55296<=t&&t<=57343||65279==t||65520<=t&&t<=65528||65529<=t&&t<=65531||113824<=t&&t<=113827||119155<=t&&t<=119162||917504==t||917505==t||917506<=t&&t<=917535||917632<=t&&t<=917759||918e3<=t&&t<=921599?s:768<=t&&t<=879||1155<=t&&t<=1159||1160<=t&&t<=1161||1425<=t&&t<=1469||1471==t||1473<=t&&t<=1474||1476<=t&&t<=1477||1479==t||1552<=t&&t<=1562||1611<=t&&t<=1631||1648==t||1750<=t&&t<=1756||1759<=t&&t<=1764||1767<=t&&t<=1768||1770<=t&&t<=1773||1809==t||1840<=t&&t<=1866||1958<=t&&t<=1968||2027<=t&&t<=2035||2070<=t&&t<=2073||2075<=t&&t<=2083||2085<=t&&t<=2087||2089<=t&&t<=2093||2137<=t&&t<=2139||2260<=t&&t<=2273||2275<=t&&t<=2306||2362==t||2364==t||2369<=t&&t<=2376||2381==t||2385<=t&&t<=2391||2402<=t&&t<=2403||2433==t||2492==t||2494==t||2497<=t&&t<=2500||2509==t||2519==t||2530<=t&&t<=2531||2561<=t&&t<=2562||2620==t||2625<=t&&t<=2626||2631<=t&&t<=2632||2635<=t&&t<=2637||2641==t||2672<=t&&t<=2673||2677==t||2689<=t&&t<=2690||2748==t||2753<=t&&t<=2757||2759<=t&&t<=2760||2765==t||2786<=t&&t<=2787||2810<=t&&t<=2815||2817==t||2876==t||2878==t||2879==t||2881<=t&&t<=2884||2893==t||2902==t||2903==t||2914<=t&&t<=2915||2946==t||3006==t||3008==t||3021==t||3031==t||3072==t||3134<=t&&t<=3136||3142<=t&&t<=3144||3146<=t&&t<=3149||3157<=t&&t<=3158||3170<=t&&t<=3171||3201==t||3260==t||3263==t||3266==t||3270==t||3276<=t&&t<=3277||3285<=t&&t<=3286||3298<=t&&t<=3299||3328<=t&&t<=3329||3387<=t&&t<=3388||3390==t||3393<=t&&t<=3396||3405==t||3415==t||3426<=t&&t<=3427||3530==t||3535==t||3538<=t&&t<=3540||3542==t||3551==t||3633==t||3636<=t&&t<=3642||3655<=t&&t<=3662||3761==t||3764<=t&&t<=3769||3771<=t&&t<=3772||3784<=t&&t<=3789||3864<=t&&t<=3865||3893==t||3895==t||3897==t||3953<=t&&t<=3966||3968<=t&&t<=3972||3974<=t&&t<=3975||3981<=t&&t<=3991||3993<=t&&t<=4028||4038==t||4141<=t&&t<=4144||4146<=t&&t<=4151||4153<=t&&t<=4154||4157<=t&&t<=4158||4184<=t&&t<=4185||4190<=t&&t<=4192||4209<=t&&t<=4212||4226==t||4229<=t&&t<=4230||4237==t||4253==t||4957<=t&&t<=4959||5906<=t&&t<=5908||5938<=t&&t<=5940||5970<=t&&t<=5971||6002<=t&&t<=6003||6068<=t&&t<=6069||6071<=t&&t<=6077||6086==t||6089<=t&&t<=6099||6109==t||6155<=t&&t<=6157||6277<=t&&t<=6278||6313==t||6432<=t&&t<=6434||6439<=t&&t<=6440||6450==t||6457<=t&&t<=6459||6679<=t&&t<=6680||6683==t||6742==t||6744<=t&&t<=6750||6752==t||6754==t||6757<=t&&t<=6764||6771<=t&&t<=6780||6783==t||6832<=t&&t<=6845||6846==t||6912<=t&&t<=6915||6964==t||6966<=t&&t<=6970||6972==t||6978==t||7019<=t&&t<=7027||7040<=t&&t<=7041||7074<=t&&t<=7077||7080<=t&&t<=7081||7083<=t&&t<=7085||7142==t||7144<=t&&t<=7145||7149==t||7151<=t&&t<=7153||7212<=t&&t<=7219||7222<=t&&t<=7223||7376<=t&&t<=7378||7380<=t&&t<=7392||7394<=t&&t<=7400||7405==t||7412==t||7416<=t&&t<=7417||7616<=t&&t<=7673||7675<=t&&t<=7679||8204==t||8400<=t&&t<=8412||8413<=t&&t<=8416||8417==t||8418<=t&&t<=8420||8421<=t&&t<=8432||11503<=t&&t<=11505||11647==t||11744<=t&&t<=11775||12330<=t&&t<=12333||12334<=t&&t<=12335||12441<=t&&t<=12442||42607==t||42608<=t&&t<=42610||42612<=t&&t<=42621||42654<=t&&t<=42655||42736<=t&&t<=42737||43010==t||43014==t||43019==t||43045<=t&&t<=43046||43204<=t&&t<=43205||43232<=t&&t<=43249||43302<=t&&t<=43309||43335<=t&&t<=43345||43392<=t&&t<=43394||43443==t||43446<=t&&t<=43449||43452==t||43493==t||43561<=t&&t<=43566||43569<=t&&t<=43570||43573<=t&&t<=43574||43587==t||43596==t||43644==t||43696==t||43698<=t&&t<=43700||43703<=t&&t<=43704||43710<=t&&t<=43711||43713==t||43756<=t&&t<=43757||43766==t||44005==t||44008==t||44013==t||64286==t||65024<=t&&t<=65039||65056<=t&&t<=65071||65438<=t&&t<=65439||66045==t||66272==t||66422<=t&&t<=66426||68097<=t&&t<=68099||68101<=t&&t<=68102||68108<=t&&t<=68111||68152<=t&&t<=68154||68159==t||68325<=t&&t<=68326||69633==t||69688<=t&&t<=69702||69759<=t&&t<=69761||69811<=t&&t<=69814||69817<=t&&t<=69818||69888<=t&&t<=69890||69927<=t&&t<=69931||69933<=t&&t<=69940||70003==t||70016<=t&&t<=70017||70070<=t&&t<=70078||70090<=t&&t<=70092||70191<=t&&t<=70193||70196==t||70198<=t&&t<=70199||70206==t||70367==t||70371<=t&&t<=70378||70400<=t&&t<=70401||70460==t||70462==t||70464==t||70487==t||70502<=t&&t<=70508||70512<=t&&t<=70516||70712<=t&&t<=70719||70722<=t&&t<=70724||70726==t||70832==t||70835<=t&&t<=70840||70842==t||70845==t||70847<=t&&t<=70848||70850<=t&&t<=70851||71087==t||71090<=t&&t<=71093||71100<=t&&t<=71101||71103<=t&&t<=71104||71132<=t&&t<=71133||71219<=t&&t<=71226||71229==t||71231<=t&&t<=71232||71339==t||71341==t||71344<=t&&t<=71349||71351==t||71453<=t&&t<=71455||71458<=t&&t<=71461||71463<=t&&t<=71467||72193<=t&&t<=72198||72201<=t&&t<=72202||72243<=t&&t<=72248||72251<=t&&t<=72254||72263==t||72273<=t&&t<=72278||72281<=t&&t<=72283||72330<=t&&t<=72342||72344<=t&&t<=72345||72752<=t&&t<=72758||72760<=t&&t<=72765||72767==t||72850<=t&&t<=72871||72874<=t&&t<=72880||72882<=t&&t<=72883||72885<=t&&t<=72886||73009<=t&&t<=73014||73018==t||73020<=t&&t<=73021||73023<=t&&t<=73029||73031==t||92912<=t&&t<=92916||92976<=t&&t<=92982||94095<=t&&t<=94098||113821<=t&&t<=113822||119141==t||119143<=t&&t<=119145||119150<=t&&t<=119154||119163<=t&&t<=119170||119173<=t&&t<=119179||119210<=t&&t<=119213||119362<=t&&t<=119364||121344<=t&&t<=121398||121403<=t&&t<=121452||121461==t||121476==t||121499<=t&&t<=121503||121505<=t&&t<=121519||122880<=t&&t<=122886||122888<=t&&t<=122904||122907<=t&&t<=122913||122915<=t&&t<=122916||122918<=t&&t<=122922||125136<=t&&t<=125142||125252<=t&&t<=125258||917536<=t&&t<=917631||917760<=t&&t<=917999?a:127462<=t&&t<=127487?h:2307==t||2363==t||2366<=t&&t<=2368||2377<=t&&t<=2380||2382<=t&&t<=2383||2434<=t&&t<=2435||2495<=t&&t<=2496||2503<=t&&t<=2504||2507<=t&&t<=2508||2563==t||2622<=t&&t<=2624||2691==t||2750<=t&&t<=2752||2761==t||2763<=t&&t<=2764||2818<=t&&t<=2819||2880==t||2887<=t&&t<=2888||2891<=t&&t<=2892||3007==t||3009<=t&&t<=3010||3014<=t&&t<=3016||3018<=t&&t<=3020||3073<=t&&t<=3075||3137<=t&&t<=3140||3202<=t&&t<=3203||3262==t||3264<=t&&t<=3265||3267<=t&&t<=3268||3271<=t&&t<=3272||3274<=t&&t<=3275||3330<=t&&t<=3331||3391<=t&&t<=3392||3398<=t&&t<=3400||3402<=t&&t<=3404||3458<=t&&t<=3459||3536<=t&&t<=3537||3544<=t&&t<=3550||3570<=t&&t<=3571||3635==t||3763==t||3902<=t&&t<=3903||3967==t||4145==t||4155<=t&&t<=4156||4182<=t&&t<=4183||4228==t||6070==t||6078<=t&&t<=6085||6087<=t&&t<=6088||6435<=t&&t<=6438||6441<=t&&t<=6443||6448<=t&&t<=6449||6451<=t&&t<=6456||6681<=t&&t<=6682||6741==t||6743==t||6765<=t&&t<=6770||6916==t||6965==t||6971==t||6973<=t&&t<=6977||6979<=t&&t<=6980||7042==t||7073==t||7078<=t&&t<=7079||7082==t||7143==t||7146<=t&&t<=7148||7150==t||7154<=t&&t<=7155||7204<=t&&t<=7211||7220<=t&&t<=7221||7393==t||7410<=t&&t<=7411||7415==t||43043<=t&&t<=43044||43047==t||43136<=t&&t<=43137||43188<=t&&t<=43203||43346<=t&&t<=43347||43395==t||43444<=t&&t<=43445||43450<=t&&t<=43451||43453<=t&&t<=43456||43567<=t&&t<=43568||43571<=t&&t<=43572||43597==t||43755==t||43758<=t&&t<=43759||43765==t||44003<=t&&t<=44004||44006<=t&&t<=44007||44009<=t&&t<=44010||44012==t||69632==t||69634==t||69762==t||69808<=t&&t<=69810||69815<=t&&t<=69816||69932==t||70018==t||70067<=t&&t<=70069||70079<=t&&t<=70080||70188<=t&&t<=70190||70194<=t&&t<=70195||70197==t||70368<=t&&t<=70370||70402<=t&&t<=70403||70463==t||70465<=t&&t<=70468||70471<=t&&t<=70472||70475<=t&&t<=70477||70498<=t&&t<=70499||70709<=t&&t<=70711||70720<=t&&t<=70721||70725==t||70833<=t&&t<=70834||70841==t||70843<=t&&t<=70844||70846==t||70849==t||71088<=t&&t<=71089||71096<=t&&t<=71099||71102==t||71216<=t&&t<=71218||71227<=t&&t<=71228||71230==t||71340==t||71342<=t&&t<=71343||71350==t||71456<=t&&t<=71457||71462==t||72199<=t&&t<=72200||72249==t||72279<=t&&t<=72280||72343==t||72751==t||72766==t||72873==t||72881==t||72884==t||94033<=t&&t<=94078||119142==t||119149==t?l:4352<=t&&t<=4447||43360<=t&&t<=43388?c:4448<=t&&t<=4519||55216<=t&&t<=55238?u:4520<=t&&t<=4607||55243<=t&&t<=55291?p:44032==t||44060==t||44088==t||44116==t||44144==t||44172==t||44200==t||44228==t||44256==t||44284==t||44312==t||44340==t||44368==t||44396==t||44424==t||44452==t||44480==t||44508==t||44536==t||44564==t||44592==t||44620==t||44648==t||44676==t||44704==t||44732==t||44760==t||44788==t||44816==t||44844==t||44872==t||44900==t||44928==t||44956==t||44984==t||45012==t||45040==t||45068==t||45096==t||45124==t||45152==t||45180==t||45208==t||45236==t||45264==t||45292==t||45320==t||45348==t||45376==t||45404==t||45432==t||45460==t||45488==t||45516==t||45544==t||45572==t||45600==t||45628==t||45656==t||45684==t||45712==t||45740==t||45768==t||45796==t||45824==t||45852==t||45880==t||45908==t||45936==t||45964==t||45992==t||46020==t||46048==t||46076==t||46104==t||46132==t||46160==t||46188==t||46216==t||46244==t||46272==t||46300==t||46328==t||46356==t||46384==t||46412==t||46440==t||46468==t||46496==t||46524==t||46552==t||46580==t||46608==t||46636==t||46664==t||46692==t||46720==t||46748==t||46776==t||46804==t||46832==t||46860==t||46888==t||46916==t||46944==t||46972==t||47e3==t||47028==t||47056==t||47084==t||47112==t||47140==t||47168==t||47196==t||47224==t||47252==t||47280==t||47308==t||47336==t||47364==t||47392==t||47420==t||47448==t||47476==t||47504==t||47532==t||47560==t||47588==t||47616==t||47644==t||47672==t||47700==t||47728==t||47756==t||47784==t||47812==t||47840==t||47868==t||47896==t||47924==t||47952==t||47980==t||48008==t||48036==t||48064==t||48092==t||48120==t||48148==t||48176==t||48204==t||48232==t||48260==t||48288==t||48316==t||48344==t||48372==t||48400==t||48428==t||48456==t||48484==t||48512==t||48540==t||48568==t||48596==t||48624==t||48652==t||48680==t||48708==t||48736==t||48764==t||48792==t||48820==t||48848==t||48876==t||48904==t||48932==t||48960==t||48988==t||49016==t||49044==t||49072==t||49100==t||49128==t||49156==t||49184==t||49212==t||49240==t||49268==t||49296==t||49324==t||49352==t||49380==t||49408==t||49436==t||49464==t||49492==t||49520==t||49548==t||49576==t||49604==t||49632==t||49660==t||49688==t||49716==t||49744==t||49772==t||49800==t||49828==t||49856==t||49884==t||49912==t||49940==t||49968==t||49996==t||50024==t||50052==t||50080==t||50108==t||50136==t||50164==t||50192==t||50220==t||50248==t||50276==t||50304==t||50332==t||50360==t||50388==t||50416==t||50444==t||50472==t||50500==t||50528==t||50556==t||50584==t||50612==t||50640==t||50668==t||50696==t||50724==t||50752==t||50780==t||50808==t||50836==t||50864==t||50892==t||50920==t||50948==t||50976==t||51004==t||51032==t||51060==t||51088==t||51116==t||51144==t||51172==t||51200==t||51228==t||51256==t||51284==t||51312==t||51340==t||51368==t||51396==t||51424==t||51452==t||51480==t||51508==t||51536==t||51564==t||51592==t||51620==t||51648==t||51676==t||51704==t||51732==t||51760==t||51788==t||51816==t||51844==t||51872==t||51900==t||51928==t||51956==t||51984==t||52012==t||52040==t||52068==t||52096==t||52124==t||52152==t||52180==t||52208==t||52236==t||52264==t||52292==t||52320==t||52348==t||52376==t||52404==t||52432==t||52460==t||52488==t||52516==t||52544==t||52572==t||52600==t||52628==t||52656==t||52684==t||52712==t||52740==t||52768==t||52796==t||52824==t||52852==t||52880==t||52908==t||52936==t||52964==t||52992==t||53020==t||53048==t||53076==t||53104==t||53132==t||53160==t||53188==t||53216==t||53244==t||53272==t||53300==t||53328==t||53356==t||53384==t||53412==t||53440==t||53468==t||53496==t||53524==t||53552==t||53580==t||53608==t||53636==t||53664==t||53692==t||53720==t||53748==t||53776==t||53804==t||53832==t||53860==t||53888==t||53916==t||53944==t||53972==t||54e3==t||54028==t||54056==t||54084==t||54112==t||54140==t||54168==t||54196==t||54224==t||54252==t||54280==t||54308==t||54336==t||54364==t||54392==t||54420==t||54448==t||54476==t||54504==t||54532==t||54560==t||54588==t||54616==t||54644==t||54672==t||54700==t||54728==t||54756==t||54784==t||54812==t||54840==t||54868==t||54896==t||54924==t||54952==t||54980==t||55008==t||55036==t||55064==t||55092==t||55120==t||55148==t||55176==t?d:44033<=t&&t<=44059||44061<=t&&t<=44087||44089<=t&&t<=44115||44117<=t&&t<=44143||44145<=t&&t<=44171||44173<=t&&t<=44199||44201<=t&&t<=44227||44229<=t&&t<=44255||44257<=t&&t<=44283||44285<=t&&t<=44311||44313<=t&&t<=44339||44341<=t&&t<=44367||44369<=t&&t<=44395||44397<=t&&t<=44423||44425<=t&&t<=44451||44453<=t&&t<=44479||44481<=t&&t<=44507||44509<=t&&t<=44535||44537<=t&&t<=44563||44565<=t&&t<=44591||44593<=t&&t<=44619||44621<=t&&t<=44647||44649<=t&&t<=44675||44677<=t&&t<=44703||44705<=t&&t<=44731||44733<=t&&t<=44759||44761<=t&&t<=44787||44789<=t&&t<=44815||44817<=t&&t<=44843||44845<=t&&t<=44871||44873<=t&&t<=44899||44901<=t&&t<=44927||44929<=t&&t<=44955||44957<=t&&t<=44983||44985<=t&&t<=45011||45013<=t&&t<=45039||45041<=t&&t<=45067||45069<=t&&t<=45095||45097<=t&&t<=45123||45125<=t&&t<=45151||45153<=t&&t<=45179||45181<=t&&t<=45207||45209<=t&&t<=45235||45237<=t&&t<=45263||45265<=t&&t<=45291||45293<=t&&t<=45319||45321<=t&&t<=45347||45349<=t&&t<=45375||45377<=t&&t<=45403||45405<=t&&t<=45431||45433<=t&&t<=45459||45461<=t&&t<=45487||45489<=t&&t<=45515||45517<=t&&t<=45543||45545<=t&&t<=45571||45573<=t&&t<=45599||45601<=t&&t<=45627||45629<=t&&t<=45655||45657<=t&&t<=45683||45685<=t&&t<=45711||45713<=t&&t<=45739||45741<=t&&t<=45767||45769<=t&&t<=45795||45797<=t&&t<=45823||45825<=t&&t<=45851||45853<=t&&t<=45879||45881<=t&&t<=45907||45909<=t&&t<=45935||45937<=t&&t<=45963||45965<=t&&t<=45991||45993<=t&&t<=46019||46021<=t&&t<=46047||46049<=t&&t<=46075||46077<=t&&t<=46103||46105<=t&&t<=46131||46133<=t&&t<=46159||46161<=t&&t<=46187||46189<=t&&t<=46215||46217<=t&&t<=46243||46245<=t&&t<=46271||46273<=t&&t<=46299||46301<=t&&t<=46327||46329<=t&&t<=46355||46357<=t&&t<=46383||46385<=t&&t<=46411||46413<=t&&t<=46439||46441<=t&&t<=46467||46469<=t&&t<=46495||46497<=t&&t<=46523||46525<=t&&t<=46551||46553<=t&&t<=46579||46581<=t&&t<=46607||46609<=t&&t<=46635||46637<=t&&t<=46663||46665<=t&&t<=46691||46693<=t&&t<=46719||46721<=t&&t<=46747||46749<=t&&t<=46775||46777<=t&&t<=46803||46805<=t&&t<=46831||46833<=t&&t<=46859||46861<=t&&t<=46887||46889<=t&&t<=46915||46917<=t&&t<=46943||46945<=t&&t<=46971||46973<=t&&t<=46999||47001<=t&&t<=47027||47029<=t&&t<=47055||47057<=t&&t<=47083||47085<=t&&t<=47111||47113<=t&&t<=47139||47141<=t&&t<=47167||47169<=t&&t<=47195||47197<=t&&t<=47223||47225<=t&&t<=47251||47253<=t&&t<=47279||47281<=t&&t<=47307||47309<=t&&t<=47335||47337<=t&&t<=47363||47365<=t&&t<=47391||47393<=t&&t<=47419||47421<=t&&t<=47447||47449<=t&&t<=47475||47477<=t&&t<=47503||47505<=t&&t<=47531||47533<=t&&t<=47559||47561<=t&&t<=47587||47589<=t&&t<=47615||47617<=t&&t<=47643||47645<=t&&t<=47671||47673<=t&&t<=47699||47701<=t&&t<=47727||47729<=t&&t<=47755||47757<=t&&t<=47783||47785<=t&&t<=47811||47813<=t&&t<=47839||47841<=t&&t<=47867||47869<=t&&t<=47895||47897<=t&&t<=47923||47925<=t&&t<=47951||47953<=t&&t<=47979||47981<=t&&t<=48007||48009<=t&&t<=48035||48037<=t&&t<=48063||48065<=t&&t<=48091||48093<=t&&t<=48119||48121<=t&&t<=48147||48149<=t&&t<=48175||48177<=t&&t<=48203||48205<=t&&t<=48231||48233<=t&&t<=48259||48261<=t&&t<=48287||48289<=t&&t<=48315||48317<=t&&t<=48343||48345<=t&&t<=48371||48373<=t&&t<=48399||48401<=t&&t<=48427||48429<=t&&t<=48455||48457<=t&&t<=48483||48485<=t&&t<=48511||48513<=t&&t<=48539||48541<=t&&t<=48567||48569<=t&&t<=48595||48597<=t&&t<=48623||48625<=t&&t<=48651||48653<=t&&t<=48679||48681<=t&&t<=48707||48709<=t&&t<=48735||48737<=t&&t<=48763||48765<=t&&t<=48791||48793<=t&&t<=48819||48821<=t&&t<=48847||48849<=t&&t<=48875||48877<=t&&t<=48903||48905<=t&&t<=48931||48933<=t&&t<=48959||48961<=t&&t<=48987||48989<=t&&t<=49015||49017<=t&&t<=49043||49045<=t&&t<=49071||49073<=t&&t<=49099||49101<=t&&t<=49127||49129<=t&&t<=49155||49157<=t&&t<=49183||49185<=t&&t<=49211||49213<=t&&t<=49239||49241<=t&&t<=49267||49269<=t&&t<=49295||49297<=t&&t<=49323||49325<=t&&t<=49351||49353<=t&&t<=49379||49381<=t&&t<=49407||49409<=t&&t<=49435||49437<=t&&t<=49463||49465<=t&&t<=49491||49493<=t&&t<=49519||49521<=t&&t<=49547||49549<=t&&t<=49575||49577<=t&&t<=49603||49605<=t&&t<=49631||49633<=t&&t<=49659||49661<=t&&t<=49687||49689<=t&&t<=49715||49717<=t&&t<=49743||49745<=t&&t<=49771||49773<=t&&t<=49799||49801<=t&&t<=49827||49829<=t&&t<=49855||49857<=t&&t<=49883||49885<=t&&t<=49911||49913<=t&&t<=49939||49941<=t&&t<=49967||49969<=t&&t<=49995||49997<=t&&t<=50023||50025<=t&&t<=50051||50053<=t&&t<=50079||50081<=t&&t<=50107||50109<=t&&t<=50135||50137<=t&&t<=50163||50165<=t&&t<=50191||50193<=t&&t<=50219||50221<=t&&t<=50247||50249<=t&&t<=50275||50277<=t&&t<=50303||50305<=t&&t<=50331||50333<=t&&t<=50359||50361<=t&&t<=50387||50389<=t&&t<=50415||50417<=t&&t<=50443||50445<=t&&t<=50471||50473<=t&&t<=50499||50501<=t&&t<=50527||50529<=t&&t<=50555||50557<=t&&t<=50583||50585<=t&&t<=50611||50613<=t&&t<=50639||50641<=t&&t<=50667||50669<=t&&t<=50695||50697<=t&&t<=50723||50725<=t&&t<=50751||50753<=t&&t<=50779||50781<=t&&t<=50807||50809<=t&&t<=50835||50837<=t&&t<=50863||50865<=t&&t<=50891||50893<=t&&t<=50919||50921<=t&&t<=50947||50949<=t&&t<=50975||50977<=t&&t<=51003||51005<=t&&t<=51031||51033<=t&&t<=51059||51061<=t&&t<=51087||51089<=t&&t<=51115||51117<=t&&t<=51143||51145<=t&&t<=51171||51173<=t&&t<=51199||51201<=t&&t<=51227||51229<=t&&t<=51255||51257<=t&&t<=51283||51285<=t&&t<=51311||51313<=t&&t<=51339||51341<=t&&t<=51367||51369<=t&&t<=51395||51397<=t&&t<=51423||51425<=t&&t<=51451||51453<=t&&t<=51479||51481<=t&&t<=51507||51509<=t&&t<=51535||51537<=t&&t<=51563||51565<=t&&t<=51591||51593<=t&&t<=51619||51621<=t&&t<=51647||51649<=t&&t<=51675||51677<=t&&t<=51703||51705<=t&&t<=51731||51733<=t&&t<=51759||51761<=t&&t<=51787||51789<=t&&t<=51815||51817<=t&&t<=51843||51845<=t&&t<=51871||51873<=t&&t<=51899||51901<=t&&t<=51927||51929<=t&&t<=51955||51957<=t&&t<=51983||51985<=t&&t<=52011||52013<=t&&t<=52039||52041<=t&&t<=52067||52069<=t&&t<=52095||52097<=t&&t<=52123||52125<=t&&t<=52151||52153<=t&&t<=52179||52181<=t&&t<=52207||52209<=t&&t<=52235||52237<=t&&t<=52263||52265<=t&&t<=52291||52293<=t&&t<=52319||52321<=t&&t<=52347||52349<=t&&t<=52375||52377<=t&&t<=52403||52405<=t&&t<=52431||52433<=t&&t<=52459||52461<=t&&t<=52487||52489<=t&&t<=52515||52517<=t&&t<=52543||52545<=t&&t<=52571||52573<=t&&t<=52599||52601<=t&&t<=52627||52629<=t&&t<=52655||52657<=t&&t<=52683||52685<=t&&t<=52711||52713<=t&&t<=52739||52741<=t&&t<=52767||52769<=t&&t<=52795||52797<=t&&t<=52823||52825<=t&&t<=52851||52853<=t&&t<=52879||52881<=t&&t<=52907||52909<=t&&t<=52935||52937<=t&&t<=52963||52965<=t&&t<=52991||52993<=t&&t<=53019||53021<=t&&t<=53047||53049<=t&&t<=53075||53077<=t&&t<=53103||53105<=t&&t<=53131||53133<=t&&t<=53159||53161<=t&&t<=53187||53189<=t&&t<=53215||53217<=t&&t<=53243||53245<=t&&t<=53271||53273<=t&&t<=53299||53301<=t&&t<=53327||53329<=t&&t<=53355||53357<=t&&t<=53383||53385<=t&&t<=53411||53413<=t&&t<=53439||53441<=t&&t<=53467||53469<=t&&t<=53495||53497<=t&&t<=53523||53525<=t&&t<=53551||53553<=t&&t<=53579||53581<=t&&t<=53607||53609<=t&&t<=53635||53637<=t&&t<=53663||53665<=t&&t<=53691||53693<=t&&t<=53719||53721<=t&&t<=53747||53749<=t&&t<=53775||53777<=t&&t<=53803||53805<=t&&t<=53831||53833<=t&&t<=53859||53861<=t&&t<=53887||53889<=t&&t<=53915||53917<=t&&t<=53943||53945<=t&&t<=53971||53973<=t&&t<=53999||54001<=t&&t<=54027||54029<=t&&t<=54055||54057<=t&&t<=54083||54085<=t&&t<=54111||54113<=t&&t<=54139||54141<=t&&t<=54167||54169<=t&&t<=54195||54197<=t&&t<=54223||54225<=t&&t<=54251||54253<=t&&t<=54279||54281<=t&&t<=54307||54309<=t&&t<=54335||54337<=t&&t<=54363||54365<=t&&t<=54391||54393<=t&&t<=54419||54421<=t&&t<=54447||54449<=t&&t<=54475||54477<=t&&t<=54503||54505<=t&&t<=54531||54533<=t&&t<=54559||54561<=t&&t<=54587||54589<=t&&t<=54615||54617<=t&&t<=54643||54645<=t&&t<=54671||54673<=t&&t<=54699||54701<=t&&t<=54727||54729<=t&&t<=54755||54757<=t&&t<=54783||54785<=t&&t<=54811||54813<=t&&t<=54839||54841<=t&&t<=54867||54869<=t&&t<=54895||54897<=t&&t<=54923||54925<=t&&t<=54951||54953<=t&&t<=54979||54981<=t&&t<=55007||55009<=t&&t<=55035||55037<=t&&t<=55063||55065<=t&&t<=55091||55093<=t&&t<=55119||55121<=t&&t<=55147||55149<=t&&t<=55175||55177<=t&&t<=55203?f:9757==t||9977==t||9994<=t&&t<=9997||127877==t||127938<=t&&t<=127940||127943==t||127946<=t&&t<=127948||128066<=t&&t<=128067||128070<=t&&t<=128080||128110==t||128112<=t&&t<=128120||128124==t||128129<=t&&t<=128131||128133<=t&&t<=128135||128170==t||128372<=t&&t<=128373||128378==t||128400==t||128405<=t&&t<=128406||128581<=t&&t<=128583||128587<=t&&t<=128591||128675==t||128692<=t&&t<=128694||128704==t||128716==t||129304<=t&&t<=129308||129310<=t&&t<=129311||129318==t||129328<=t&&t<=129337||129341<=t&&t<=129342||129489<=t&&t<=129501?m:127995<=t&&t<=127999?_:8205==t?v:9792==t||9794==t||9877<=t&&t<=9878||9992==t||10084==t||127752==t||127806==t||127859==t||127891==t||127908==t||127912==t||127979==t||127981==t||128139==t||128187<=t&&t<=128188||128295==t||128300==t||128488==t||128640==t||128658==t?x:128102<=t&&t<=128105?T:g}var n=0,o=1,s=2,a=3,h=4,l=5,c=6,u=7,p=8,d=9,f=10,g=11,y=12,m=13,_=14,v=15,x=16,T=17,S=0,w=1,b=2,P=3,A=4;return this.nextBreak=function(n,o){if(void 0===o&&(o=0),o<0)return 0;if(o>=n.length-1)return n.length;for(var s=r(e(n,o)),a=[],h=o+1;h<n.length;h++)if(!t(n,h-1)){var l=r(e(n,h));if(i(s,a,l))return h;a.push(l)}return n.length},this.splitGraphemes=function(t){for(var e,i=[],r=0;(e=this.nextBreak(t,r))<t.length;)i.push(t.slice(r,e)),r=e;return r<t.length&&i.push(t.slice(r)),i},this.iterateGraphemes=function(t){var e=0,i={next:function(){var i,r;return(r=this.nextBreak(t,e))<t.length?(i=t.slice(e,r),e=r,{value:i,done:!1}):e<t.length?(i=t.slice(e),e=t.length,{value:i,done:!1}):{value:void 0,done:!0}}.bind(this)};return"undefined"!=typeof Symbol&&Symbol.iterator&&(i[Symbol.iterator]=function(){return i}),i},this.countGraphemes=function(t){for(var e,i=0,r=0;(e=this.nextBreak(t,r))<t.length;)r=e,i++;return r<t.length&&i++,i},this}(function(window,Object,undefined){"use strict";function WheelEventProxy(t,e){this._scaleFactor=t,this._deltaMode=e,this.originalEvent=null}if(!window.qc||!window.qc.Node){var deepCopy=function(t){var e=[],i=function(t,e){for(var i in t)if(t[i]==e)return!0;return!1},r=function(t){if("object"!=typeof t||null===t)return t;if(i(e,t))return t;e.push(t);var n={};for(var o in Array.isArray(t)&&(n=[]),t)t.hasOwnProperty(o)&&(n[o]=r(t[o]));return n};return r(t)},mixin=function(t,e,i){for(var r in e)i&&t[r]!==undefined||(t[r]=e[r]);return t};window.qc||(window.qc={});var qc=window.qc,Phaser=window.Phaser,PIXI=window.PIXI;mixin(qc,{PHASER_VERSION:Phaser.VERSION,GAMES:Phaser.GAMES,AUTO:Phaser.AUTO,CANVAS:Phaser.CANVAS,WEBGL:Phaser.WEBGL,HEADLESS:Phaser.HEADLESS,NONE:Phaser.NONE,LEFT:Phaser.LEFT,RIGHT:Phaser.RIGHT,UP:Phaser.UP,DOWN:Phaser.DOWN,scaleModes:Phaser.scaleModes}),this.qc=this.qc||{};var Log=qc.Log=function(t){var e=this;e.game=t,e.enableTrace=!1};Log.prototype.trace=function(){if(window.printingloading)if(this.game.remoteLogUrl){var t=qc.Util.formatString.apply(null,arguments);console.log(t);var e=new Date,i=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds();qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",i+" "+t,function(t){})}else if(this.enableTrace){t=qc.Util.formatString.apply(null,arguments);console.log(t)}},Log.prototype.important=function(){var t=qc.Util.formatString.apply(null,arguments);if(window.__wx?console.log(t):console.log("%c"+t,"color:green"),this.game.remoteLogUrl){var e=new Date,i=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds();qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",i+" "+t,function(t){})}},Log.prototype.error=function(){var t,e=qc.Util.formatString.apply(null,arguments);window.__wx?console.log(e):console.log("%c"+e,"color:red");for(var i=1;i<arguments.length;i++)if(arguments[i]&&arguments[i].stack){t=arguments[i].stack,console.error(t);break}this.game.remoteLogUrl&&qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",Date.now()+" "+t?t:e,function(t){}),t||window.__wx||console.trace()},Log.prototype.remoteReply=function(){var t=qc.Util.formatString.apply(null,arguments);console.log("%c"+t,"color:green"),qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",t,function(t){})},qc.Circle=Phaser.Circle,Object.defineProperty(qc.Circle.prototype,"class",{get:function(){return"qc.Circle"}}),qc.Circle.prototype.toJson=function(){return[this.x,this.y,this.diameter]},qc.Circle.prototype.fromJson=function(t){this.x=t[0],this.y=t[1],this.diameter=t[2]},qc.Ellipse=Phaser.Ellipse,Object.defineProperty(qc.Ellipse.prototype,"class",{get:function(){return"qc.Ellipse"}}),qc.Ellipse.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]},qc.Ellipse.prototype.fromJson=function(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]},qc.Line=Phaser.Line,Object.defineProperty(qc.Line.prototype,"class",{get:function(){return"qc.Line"}}),qc.Line.prototype.toJson=function(){return[this.start.x,this.start.y,this.end.x,this.end.y]},qc.Line.prototype.fromJson=function(t){this.start.setTo(t[0],t[1]),this.end.setTo(t[2],t[3])},qc.Matrix=Phaser.Matrix,Object.defineProperty(qc.Matrix.prototype,"class",{get:function(){return"qc.Matrix"}}),qc.Matrix.prototype.toJson=function(){return this.toArray()},qc.Matrix.prototype.fromJson=function(t){this.fromArray(t)},qc.Point=Phaser.Point,Object.defineProperty(qc.Point.prototype,"class",{get:function(){return"qc.Point"}}),qc.Point.prototype.toJson=function(){return[this.x,this.y]},qc.Point.prototype.fromJson=function(t){this.x=t[0],this.y=t[1]},qc.Polygon=Phaser.Polygon,Object.defineProperty(qc.Polygon.prototype,"class",{get:function(){return"qc.Polygon"}}),qc.Polygon.prototype.toJson=function(){return[this.toNumberArray(),this.closed]},qc.Polygon.prototype.fromJson=function(t){this.setTo(t[0]),this.closed=t[1]},qc.Rectangle=Phaser.Rectangle,Object.defineProperty(qc.Rectangle.prototype,"class",{get:function(){return"qc.Rectangle"}}),qc.Rectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]},qc.Rectangle.prototype.fromJson=function(t){this.setTo(t[0],t[1],t[2],t[3])},qc.RoundedRectangle=Phaser.RoundedRectangle,Object.defineProperty(qc.RoundedRectangle.prototype,"class",{get:function(){return"qc.RoundedRectangle"}}),qc.RoundedRectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height,this.radius]},qc.RoundedRectangle.prototype.fromJson=function(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3],this.radius=t[4]};var Keyframe=qc.Keyframe=function(t,e,i,r){this.time=t,this.value=e,this.type=Keyframe.FREE_SMOOTH,this.inTangent=isNaN(i)?0:i,this.outTangent=isNaN(r)?0:r};Keyframe.prototype={},Keyframe.prototype.constructor=Keyframe,Keyframe.prototype.clone=function(){var t=new Keyframe(this.time,this.value,this.inTangent,this.outTangent);return t.type=this.type,t},Keyframe.AUTO=0,Keyframe.FREE_SMOOTH=1,Keyframe.FLAT=2,Keyframe.BROKEN=3,Keyframe.LINEAR=4,Keyframe.InfinityValue=Math.tan(Math.PI/2),Object.defineProperties(Keyframe.prototype,{inAngle:{get:function(){return Math.atan(this.inTangent)},set:function(t){this.inTangent=Math.tan(t*Math.PI/180)}},outAngle:{get:function(){return Math.atan(this.outTangent)},set:function(t){this.outTangent=Math.tan(t*Math.PI/180)}},inTangent:{get:function(){return this._inTangent||0},set:function(t){this._inTangent=Math.abs(t)===Keyframe.InfinityValue?1/0*(t<0?-1:1):t}},outTangent:{get:function(){return this._outTangent||0},set:function(t){this._outTangent=Math.abs(t)===Keyframe.InfinityValue?1/0*(t<0?-1:1):t}},isFlat:{get:function(){return this.inTangent===this.outTangent&&0===this.outTangent}},isBroken:{get:function(){return this.inTangent!==this.outTangent}}});var BezierCurve=qc.BezierCurve=function(t){if(this._keys=[],Array.isArray(t))for(var e in t)this.addKey(t[e]);else for(e=0;e<arguments.length;++e)this.addKey(arguments[e])};BezierCurve.prototype={},BezierCurve.prototype.constructor=BezierCurve,Object.defineProperties(BezierCurve.prototype,{class:{get:function(){return"qc.BezierCurve"}},keys:{get:function(){return this._keys},set:function(t){for(var e in this._keys=[],t)this.addKey(t[e])}},length:{get:function(){return this._keys.length}},startTime:{get:function(){return this.keys&&this.keys.length?this.keys[0].time:0}},endTime:{get:function(){return this.keys&&this.keys.length?this.keys[this.keys.length-1].time:0}},totalTime:{get:function(){return this.keys&&this.keys.length?this.keys[this.keys.length-1].time-this.keys[0].time:0}},postWrapMode:{get:function(){return isNaN(this._postWrapMode)?BezierCurve.WRAP_CLAMP:this._postWrapMode},set:function(t){this._postWrapMode=t}},preWrapMode:{get:function(){return isNaN(this._preWrapMode)?BezierCurve.WRAP_CLAMP:this._preWrapMode},set:function(t){this._preWrapMode=t}}}),BezierCurve.prototype.toJson=function(){for(var t=[],e=0;e<this._keys.length;++e)t.push([this._keys[e].time,this._keys[e].value,this._keys[e].inTangent===1/0?"Infinity":this._keys[e].inTangent,this._keys[e].outTangent===1/0?"Infinity":this._keys[e].outTangent]);return t.push([this.preWrapMode,this.postWrapMode]),t},BezierCurve.prototype.fromJson=function(t){for(var e=0;e<t.length;++e)4===t[e].length&&this.addKey(t[e][0],t[e][1],"Infinity"===t[e][2]?1/0:t[e][2],"Infinity"===t[e][3]?1/0:t[e][3]);2===t[t.length-1].length&&(this.preWrapMode=t[t.length-1][0],this.postWrapMode=t[t.length-1][1])},BezierCurve.prototype.sort=function(){this._keys.sort(function(t,e){return t.time-e.time})},BezierCurve.prototype.addKey=function(t,e,i,r){var n=!(t instanceof Keyframe)&&(isNaN(i)||isNaN(r)),o=t instanceof Keyframe?t:new Keyframe(t,e,i,r),s=qc.Util.insertSortedList(this._keys,o,this._keyframeLess);return n&&this.makeKeyframeAuto(s),s},BezierCurve.prototype.removeKey=function(t){return this._keys?this._keys.splice(t,1):null},BezierCurve.prototype._keyframeLess=function(t,e){return t.time<e.time},BezierCurve.prototype._calc=function(t,e,i,r,n){var o=Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*i+3*(1-t)*Math.pow(t,2)*n+r*Math.pow(t,3);return o===1/0||isNaN(o)||Math.abs(o)>=2147483647?1===t?r:e:o},BezierCurve.prototype._calcDerivative=function(t,e,i,r,n){var o=1-t,s=-3*e*o*o+3*i*o*(1-3*t)+3*n*t*(2-3*t)+3*r*Math.pow(t,2);return s===1/0||isNaN(s)?0:s},BezierCurve.prototype.evaluate=function(t,e){var i=0,r=this._keys?this._keys.length:0;if(0===r)return NaN;if(1===r)return this._keys[0].value;var n,o=this._keys[0].time,s=this._keys[r-1].time,a=s-o;if(o>t){if(0===a||this.preWrapMode===BezierCurve.WRAP_CLAMP)return this._keys[0].value;if(this.preWrapMode===BezierCurve.WRAP_LOOP){var h=o-t;return h-=Math.floor(h/a)*a,this.evaluate(s-h,e)}if(this.preWrapMode===BezierCurve.WRAP_PINGPONG){h=o-t;return h-=2*Math.floor(h/(2*a))*a,h<=a?this.evaluate(o+h,e):this.evaluate(s-h+a,e)}}if(t>s){
if(0===a||this.postWrapMode===BezierCurve.WRAP_CLAMP)return this._keys[r-1].value;if(this.postWrapMode===BezierCurve.WRAP_LOOP){h=t-s;return h-=Math.floor(h/a)*a,this.evaluate(o+h,e)}if(this.postWrapMode===BezierCurve.WRAP_PINGPONG){h=t-s;return h-=2*Math.floor(h/(2*a))*a,h<=a?this.evaluate(s-h,e):this.evaluate(o+h-a,e)}}for(t===o&&e&&this.preWrapMode!==BezierCurve.WRAP_CLAMP&&(t=s);++i<r;)if(n=this._keys[i].time,n!==o){if(t<=n){var l=n-o,c=(this._keys[i].value,this._keys[i-1].value,(t-o)/l),u=this._calc(c,this._keys[i-1].value,this._keys[i-1].value+l*this._keys[i-1].outTangent/3,this._keys[i].value,this._keys[i].value-l*this._keys[i].inTangent/3);return u}o=this._keys[i].time}return NaN},BezierCurve.prototype.evaluateDerivative=function(t){var e=0,i=this._keys?this._keys.length:0;if(0===i)return NaN;var r,n=this._keys[0].time;if(n>t||t>this._keys[i-1].time)return NaN;for(;++e<i;)if(r=this._keys[e].time,r!==n){if(t<r){var o=r-n,s=(t-n)/o,a=this._calcDerivative(s,this._keys[e-1].value,this._keys[e-1].value+o*this._keys[e-1].outTangent/3,this._keys[e].value,this._keys[e].value-o*this._keys[e].inTangent/3);return a/o}n=this._keys[e].time}return NaN},BezierCurve.prototype.makeKeyframeAuto=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null,i=t>0&&t<this._keys.length?this._keys[t-1]:null,r=t<=this._keys.length-1&&t>=0?this._keys[t+1]:null,n=0,o=0;e&&(i&&(n++,o+=Math.atan2(e.value-i.value,e.time-i.time)),r&&(n++,o+=Math.atan2(r.value-e.value,r.time-e.time)),n>0&&(e.inTangent=e.outTangent=Math.tan(o/n)))},BezierCurve.prototype.makeKeyframeSmooth=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null;if(e){var i=Math.atan(e.inTangent)+Math.atan(e.outTangent);e.inTangent=e.outTangent=Math.tan(i/2)}},BezierCurve.prototype.makeKeyframeFlat=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null;e&&(e.inTangent=e.outTangent=0)},BezierCurve.prototype.makeKeyframeLinear=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null,i=t>0&&t<this._keys.length?this._keys[t-1]:null,r=t<=this._keys.length-1&&t>=0?this._keys[t+1]:null;e&&(i&&(e.inTangent=(e.value-i.value)/(e.time-i.time)),r&&(e.outTangent=(r.value-e.value)/(r.time-e.time)))},BezierCurve.prototype.clone=function(){var t=new BezierCurve([]);for(var e in this._keys)t.addKey(this._keys[e].clone());return t},BezierCurve.WRAP_CLAMP=0,BezierCurve.WRAP_LOOP=1,BezierCurve.WRAP_PINGPONG=2;var GeometricTool=qc.GeometricTool={};GeometricTool.flattenPolygon=function(t){for(var e=new Array(2*t.length),i=t.length;i--;)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},GeometricTool.polygonContains=function(t,e,i){if(isNaN(t[0])){for(var r=t.length,n=!1,o=-1,s=r-1;++o<r;s=o){var a=t[o].x,h=t[o].y,l=t[s].x,c=t[s].y;(h<=i&&i<c||c<=i&&i<h)&&e<(l-a)*(i-h)/(c-h)+a&&(n=!n)}return n}for(r=t.length/2,n=!1,o=-1,s=r-1;++o<r;s=o){a=t[2*o],h=t[2*o+1],l=t[2*s],c=t[2*s+1];(h<=i&&i<c||c<=i&&i<h)&&e<(l-a)*(i-h)/(c-h)+a&&(n=!n)}return n},GeometricTool.pointOnLine=function(t,e,i,r){return(i-t.x)*(e.y-t.y)==(e.x-t.x)*(r-t.y)},GeometricTool.pointOnSegment=function(t,e,i,r){var n=Math.min(t.x,e.x),o=Math.max(t.x,e.x),s=Math.min(t.y,e.y),a=Math.max(t.y,e.y);return qc.GeometricTool.pointOnLine(t,e,i,r)&&i>=n&&i<=o&&r>=s&&r<=a},GeometricTool.lineIntersectsPoints=function(t,e,i,r,n,o){void 0===n&&(n=!0),o||(o=new qc.Point);var s=e.y-t.y,a=r.y-i.y,h=t.x-e.x,l=i.x-r.x,c=e.x*t.y-t.x*e.y,u=r.x*i.y-i.x*r.y,p=s*l-a*h;if(0===p)return null;if(t.equals(i)||t.equals(r))return o.x=t.x,o.y=t.y,o;if(e.equals(i)||e.equals(r))return o.x=e.x,o.y=e.y,o;if(o.x=(h*u-l*c)/p,o.y=(a*c-s*u)/p,n){var d=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y),f=((r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x))/d,g=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/d;return f>=0&&f<=1&&g>=0&&g<=1?o:null}return o};var inside=GeometricTool._sutherlandHodgmanInside=function(t,e,i,r){return(e.x-t.x)*(i.y-t.y)+r>=(e.y-t.y)*(i.x-t.x)},intersection=GeometricTool._sutherlandHodgmanIntersection=function(t,e,i,r){var n=[t.x-e.x,t.y-e.y],o=[i.x-r.x,i.y-r.y],s=t.x*e.y-t.y*e.x,a=i.x*r.y-i.y*r.x,h=1/(n[0]*o[1]-n[1]*o[0]);return{x:(s*o[0]-a*n[0])*h,y:(s*o[1]-a*n[1])*h}};GeometricTool.sutherlandHodgman=function(t,e){var i,r,n,o,s=1e-6,a=t;for(n in i=e[e.length-1],e){var h=e[n],l=a;for(o in a=[],r=l[l.length-1],l){var c=l[o];inside(i,h,c,s)?(inside(i,h,r,s)||a.push(intersection(i,h,r,c)),a.push(c)):inside(i,h,r,s)&&a.push(intersection(i,h,r,c)),r=c}i=h}return a},GeometricTool.Triangulate=function(t){var e=!0,i=t.length;if(i<3)return[];for(var r=[],n=[],o=0;o<i;o++)n.push(o);o=0;for(var s=i;s>3;){var a=n[(o+0)%s],h=n[(o+1)%s],l=n[(o+2)%s],c=t[a].x,u=t[a].y,p=t[h].x,d=t[h].y,f=t[l].x,g=t[l].y,y=!1;if(PIXI.PolyK._convex(c,u,p,d,f,g,e)){y=!0;for(var m=0;m<s;m++){var _=n[m];if(_!==a&&_!==h&&_!==l&&PIXI.PolyK._PointInTriangle(t[_].x,t[_].y,c,u,p,d,f,g)){y=!1;break}}}if(y)r.push(a,h,l),n.splice((o+1)%s,1),s--,o=0;else if(o++>3*s){if(!e)return null;for(r=[],n=[],o=0;o<i;o++)n.push(o);o=0,s=i,e=!1}}return r.push(n[0],n[1],n[2]),r},GeometricTool.area=function(t,e,i){return t&&e&&i?(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y):0},GeometricTool.left=function(t,e,i){return GeometricTool.area(t,e,i)>0},GeometricTool.leftOn=function(t,e,i){return GeometricTool.area(t,e,i)>=0},GeometricTool.right=function(t,e,i){return GeometricTool.area(t,e,i)<0},GeometricTool.rightOn=function(t,e,i){return GeometricTool.area(t,e,i)<=0},GeometricTool.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r},GeometricTool.atPolygon=function(t,e){var i=t.length;return t[e<0?e%i+i:e%i]},GeometricTool.lineInt=function(t,e,i){i=i||0;var r,n,o,s,a,h,l,c=new qc.Point;return r=t[1].y-t[0].y,n=t[0].x-t[1].x,o=r*t[0].x+n*t[0].y,s=e[1].y-e[0].y,a=e[0].x-e[1].x,h=s*e[0].x+a*e[0].y,l=1/(r*a-s*n),GeometricTool._equals(l,0,i)||(c.x=(a*o-n*h)*l,c.y=(r*h-s*o)*l),c},GeometricTool.isPolygonReflex=function(t,e){return GeometricTool.right(GeometricTool.atPolygon(t,e-1),GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,e+1))},GeometricTool.polygonCanSee=function(t,e,i){var r,n,o=[],s=[];if(GeometricTool.leftOn(GeometricTool.atPolygon(t,e+1),GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,i))&&GeometricTool.rightOn(GeometricTool.atPolygon(t,e-1),GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,i)))return!1;n=GeometricTool.distance(GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,i));for(var a=0;a!=t.length;++a)if((a+1)%t.length!==e&&a!==e&&GeometricTool.leftOn(GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,i),GeometricTool.atPolygon(t,a+1))&&GeometricTool.rightOn(GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,i),GeometricTool.atPolygon(t,a))&&(o[0]=GeometricTool.atPolygon(t,e),o[1]=GeometricTool.atPolygon(t,i),s[0]=GeometricTool.atPolygon(t,a),s[1]=GeometricTool.atPolygon(t,a+1),r=GeometricTool.lineInt(o,s),GeometricTool.distance(GeometricTool.atPolygon(t,e),r)<n))return!1;return!0},GeometricTool._equals=function(t,e,i){return i=i||0,Math.abs(t-e)<i},GeometricTool.getIntersectionPoint=function(t,e,i,r,n){n=n||0;var o=e.y-t.y,s=t.x-e.x,a=o*t.x+s*t.y,h=r.y-i.y,l=i.x-r.x,c=h*i.x+l*i.y,u=o*l-h*s;return GeometricTool._equals(u,0,n)?{x:0,y:0}:{x:(l*a-s*c)/u,y:(o*c-h*a)/u}},GeometricTool.quickDecomp=function(t,e,i,r,n,o,s){o=o||100,s=s||0,n=n||25,e=void 0!==e?e:[],i=i||[],r=r||[];var a=[0,0],h=[0,0],l=[0,0],c=0,u=0,p=0,d=0,f=0,g=0,y=0,m=[],_=[],v=t;if(v.length<3)return e;if(s++,s>o)return e;for(var x=0;x<v.length;++x)if(GeometricTool.isPolygonReflex(v,x)){i.push(v[x]),c=u=Number.MAX_VALUE;for(var T=0;T<v.length;++T)GeometricTool.left(GeometricTool.atPolygon(v,x-1),GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,T))&&GeometricTool.rightOn(GeometricTool.atPolygon(v,x-1),GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,T-1))&&(l=GeometricTool.getIntersectionPoint(GeometricTool.atPolygon(v,x-1),GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,T-1)),GeometricTool.right(GeometricTool.atPolygon(v,x+1),GeometricTool.atPolygon(v,x),l)&&(p=GeometricTool.distance(v[x],l),p<u&&(u=p,h=l,g=T))),GeometricTool.left(GeometricTool.atPolygon(v,x+1),GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,T+1))&&GeometricTool.rightOn(GeometricTool.atPolygon(v,x+1),GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,T))&&(l=GeometricTool.getIntersectionPoint(GeometricTool.atPolygon(v,x+1),GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,T+1)),GeometricTool.left(GeometricTool.atPolygon(v,x-1),GeometricTool.atPolygon(v,x),l)&&(p=GeometricTool.distance(v[x],l),p<c&&(c=p,a=l,f=T)));if(g==(f+1)%v.length)l.x=(h.x+a.x)/2,l.y=(h.y+a.y)/2,r.push(l),x<f?(Array.prototype.push.apply(m,v.slice(x,f+1)),m.push(l),_.push(l),0!=g&&Array.prototype.push.apply(_,v.slice(g,v.length)),Array.prototype.push.apply(_,v.slice(0,x+1))):(0!=x&&Array.prototype.push.apply(m,v.slice(x,v.length)),Array.prototype.push.apply(m,v.slice(0,f+1)),m.push(l),_.push(l),Array.prototype.push.apply(_,v.slice(g,x+1)));else{if(g>f&&(f+=v.length),d=Number.MAX_VALUE,f<g)return e;for(T=g;T<=f;++T)GeometricTool.leftOn(GeometricTool.atPolygon(v,x-1),GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,T))&&GeometricTool.rightOn(GeometricTool.atPolygon(v,x+1),GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,T))&&(p=GeometricTool.distance(GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,T)),p<d&&(d=p,y=T%v.length));x<y?(Array.prototype.push.apply(m,v.slice(x,y+1)),0!=y&&Array.prototype.push.apply(_,v.slice(y,v.length)),Array.prototype.push.apply(_,v.slice(0,x+1))):(0!=x&&Array.prototype.push.apply(m,v.slice(x,v.length)),Array.prototype.push.apply(m,v.slice(0,y+1)),Array.prototype.push.apply(_,v.slice(y,x+1)))}return m.length<_.length?(GeometricTool.quickDecomp(m,e,i,r,n,o,s),GeometricTool.quickDecomp(_,e,i,r,n,o,s)):(GeometricTool.quickDecomp(_,e,i,r,n,o,s),GeometricTool.quickDecomp(m,e,i,r,n,o,s)),e}return e.push(v),e},GeometricTool.decomp=function(t){var e=GeometricTool.getCutEdges(t);return e.length>0?GeometricTool.polygonSlice(t,e):[t]},GeometricTool.polygonSlice=function(t,e){if(0===e.length)return[this];if(e instanceof Array&&e.length&&e[0]instanceof Array&&2==e[0].length&&e[0][0]instanceof Array){for(var i=[t],r=0;r<e.length;r++)for(var n=e[r],o=0;o<i.length;o++){var s=i[o],a=GeometricTool.polygonSlice(s,n);if(a){i.splice(o,1),i.push(a[0],a[1]);break}}return i}n=e,r=t.indexOf(n[0]),o=t.indexOf(n[1]);return-1!=r&&-1!=o&&[GeometricTool.copyPolygon(t,r,o),GeometricTool.copyPolygon(t,o,1)]},GeometricTool.copyPolygon=function(t,e,i,r){var n=r||[];if(e<i)for(var o=e;o<=i;o++)n.push(t[o]);else{for(o=0;o<=i;o++)n.push(t[o]);for(o=e;o<t.length;o++)n.push(t[o])}return n},GeometricTool.getCutEdges=function(t){for(var e=[],i=[],r=[],n=Number.MAX_VALUE,o=0;o<t.length;++o)if(GeometricTool.isPolygonReflex(t,o))for(var s=0;s<t.length;++s)if(GeometricTool.polygonCanSee(t,o,s)){i=GeometricTool.getCutEdges(GeometricTool.copyPolygon(t,o,s)),r=GeometricTool.getCutEdges(GeometricTool.copyPolygon(t,s,o));for(var a=0;a<r.length;a++)i.push(r[a]);i.length<n&&(e=i,n=i.length,e.push([GeometricTool.atPolygon(t,o),GeometricTool.atPolygon(t,s)]))}return e};var AssetUtil=qc.AssetUtil={ASSET_SCENE:1,ASSET_PREFAB:2,ASSET_ATLAS:3,ASSET_TEXT:4,ASSET_FONT:5,ASSET_SOUND:6,ASSET_EXCEL:7,ASSET_WEBFONT:8,ASSET_ACTION:9,ASSET_ACTIONMANAGER:10,ASSET_TS:99,ASSET_JS:100,ASSET_UNKNOWN:101,parse:function(t,e,i,r){var n,o=e.key,s=e.url,a=e.data;if(/\.bin$/.test(s)){if(e.isSound){var h,l;a=a||t.assets._cache.getBinary(s),delete t.assets._cache._binary[s];var c=new Uint8Array(a);if(81!==c[0]||67!==c[1])return t.log.error("Asset({0}) parse fail",s),void t.assets._parsing--;h=c,l=2;var u,p=function(){var t=h[l]<<24|h[l+1]<<16|h[l+2]<<8|h[l+3],e=l+4;return l+=t+4,[e,t]};n=[],u=p(),n.push(t.serializer.unpackUTF8(h.subarray(u[0],u[0]+u[1]))),u=p(),n.push(a.slice(u[0],u[1]))}else{a=a||t.assets._cache.getText(s),delete t.assets._cache._text[s],e.data=a;try{n=JSON.parse(a)}catch(e){return t.log.error("Asset{0}/{1} Parse fail",o,s),qc.Util.popupError(e.message),void(i&&i())}}var d=JSON.parse(n[0]);switch(window.__wx&&!e.data&&AssetUtil.wxSaveAsset(t,s,a),d.type){case AssetUtil.ASSET_ATLAS:if(window.hasBase64&&window.hasBase64()){for(var f=e.url.split("/"),g=f[f.length-1],y=[],m=0;m<d.source.length;m++){var _="";_=2==m&&".json"==d.source[m]?g.replace("_tex.bin","_ske.json"):g.replace(".bin",d.source[m]);var v=_.replace(".","_");y.push(v)}if(1==y.length){var x=window.getAssestByKey(y[0]);x&&(n[1]="{}",n[2]=x)}else for(m=0;m<y.length;m++){x=window.getAssestByKey(y[m]);x&&(n[m+1]=x)}}else{for(y=[],m=0;m<d.source.length;m++){var T=d.source[m];if("."!=T.charAt(0))y.push(T);else if(2==m&&".json"==d.source[m]){_=e.url.replace("_tex.bin","_ske.json");y.push(_)}else{_=e.url.replace(".bin",d.source[m]);y.push(_)}}var S=!1;for(m=0;m<y.length;m++)(e.override&&!e.hasLoadDep||null==t.phaser.cache.getText(y[m])&&null==t.phaser.cache.getImage(y[m]))&&(e.hasLoadDep=!0,S=!0);if(S)return e.loadCnt=y.length,void(r&&(t.assets._uuid2UrlConf[d.uuid]=e.url,r(d.uuid,y)));if(1==y.length)n[1]="{}",n[2]=t.phaser.cache.getText(y[0])||t.phaser.cache.getImage(y[0]);else for(m=0;m<y.length;m++)if(t.phaser.cache.getText(y[m])||t.phaser.cache.getImage(y[m])){var w=t.phaser.cache.getText(y[m])||t.phaser.cache.getImage(y[m]);n[m+1]=w}}return AssetUtil._parseAtlas(t,d,JSON.parse(n[1]),n[2],n[3]?JSON.parse(n[3]):undefined,o,s,i);case AssetUtil.ASSET_PREFAB:return AssetUtil._parsePrefab(t,JSON.parse(n[1]),o,s,d,i);case AssetUtil.ASSET_SCENE:return AssetUtil._parseScene(t,JSON.parse(n[1]),o,s,d,i);case AssetUtil.ASSET_TEXT:return AssetUtil._parseText(t,n[1],o,s,d,i);case AssetUtil.ASSET_FONT:return AssetUtil._parseFont(t,d,n[1],n[2],o,s,i);case AssetUtil.ASSET_SOUND:return AssetUtil._parseSound(t,d,n[1],o,s,i);case AssetUtil.ASSET_EXCEL:return AssetUtil._parseExcel(t,d,JSON.parse(n[1]),o,s,i);case AssetUtil.ASSET_WEBFONT:return AssetUtil._parseWebFont(t,d,JSON.parse(n[1]),o,s,i);case AssetUtil.ASSET_ACTION:return AssetUtil._parseAction(t,JSON.parse(n[1]),o,s,d,i);case AssetUtil.ASSET_ACTIONMANAGER:return AssetUtil._parseActionManager(t,JSON.parse(n[1]),o,s,d,i);default:throw new Error("unsupported asset type："+d.type)}}else{if(e.isRaw)this._addAtlasToCache(t,o,s);else{var b=t.assets._cache.getSound(s);if(b){var P=new qc.SoundAsset(o,s,b.data,{uuid:o,type:AssetUtil.ASSET_SOUND});t.assets.cache(o,s,P)}if(window.__wx){var A=t.storage.get("localFiles")||{},C=t.storage.get("assetsMd5")||{};o=s.replace("Assets/","");if(C[o]){var E=A[o];E?E.md5==C[o]&&(t.log.important("文件({0})md5一致，不缓存。",s),E.time=t.time.now,t.storage.delaySet("localFiles",A,1e4)):(E={},E.md5=C[o],E.time=t.time.now,A[o]=E,t.storage.delaySet("localFiles",A,1e4))}}}i&&i()}},isSound:function(t){if(qc.Util.isArray(t)){for(var e=0;e<t.length;e++)if(t[e]&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(t[e].toLowerCase()))return!0;return!1}return t&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(t.toLowerCase())},_parseAtlas:function(t,e,i,r,n,o,s,a){var h=new Image;h.url=s;var l=function(t){for(var e,i,r={meta:{image:t.imagePath},frames:e={}},n=t.SubTexture,o=n.length,s=0;s<o;s++)i=n[s],e[i.name]={filename:i.name,frame:{x:i.x,y:i.y,w:i.width,h:i.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:i.width,h:i.height},sourceSize:{w:i.width,h:i.height}};return r},c=function(t,e,i){window.drawcanvas||(window.drawcanvas=document.createElement("canvas"),window.drawctx=drawcanvas.getContext("2d")),drawcanvas.width=e,drawcanvas.height=i,drawctx.drawImage(t,0,0,e,i),t.key=null,t.remove();var r=drawcanvas.toDataURL("image/png");return r},u=function(){h.onload=undefined;var r=t.assets._cache,p=s.split("/"),d=p[p.length-1],f=d.replace(".","_");if(window.picDesc&&window.picDesc[f]){var g=window.picDesc[f],y=g.split(","),m=parseInt(y[0]),_=parseInt(y[1]);if(m!=h.width){var v=c(h,m,_);return h.src=v,void(h.onload=u)}}if(r._images[s]={url:s,data:h},PIXI.BaseTextureCache[s]=new PIXI.BaseTexture(h),PIXI.TextureCache[s]=new PIXI.Texture(PIXI.BaseTextureCache[s]),Object.keys(i).length>0)if(!n||e.animationType!==Sprite.DRAGON_BONES&&e.animationType!==Sprite.FRAME_SAMPLES)i&&qc.Util.isArray(i.frames)?r._images[s].frameData=Phaser.AnimationParser.JSONData(t.phaser,i,s):r._images[s].frameData=Phaser.AnimationParser.JSONDataHash(t.phaser,i,s);else{var x=l(i);r._images[s].frameData=Phaser.AnimationParser.JSONDataHash(t.phaser,x,s)}else if(e.spriteSheet){var T=h.width/(e.spriteSheet.columns||1),S=h.height/(e.spriteSheet.rows||1),w=e.spriteSheet.margin||0,b=e.spriteSheet.spacing||0;r._images[s].frameData=Phaser.AnimationParser.spriteSheet(t.phaser,s,T,S,-1,w,b)}else r._images[s].frameData=new Phaser.FrameData,r._images[s].frame=new Phaser.Frame(0,0,0,h.width,h.height,"",""),r._images[s].frameData.addFrame(new Phaser.Frame(0,0,0,h.width,h.height,null,t.math.uuid()));r._resolveURL(s,r._images[s]);var P=new qc.Atlas(o,s,r._images[s],e,n);P.json=i,P.img=h,t.assets.cache(o,s,P),a()};"string"==typeof r?0==r.search("data")?h.src=r:h.src="data:image/png;base64,"+r:(h=r,u()),h.onerror=function(){h.onerror=undefined,a()},h.onload=u},addAtlasFromImage:function(t,e,i,r){return t.assets._cache.addImage(i,i,r),this._addAtlasToCache(t,e,i)},_addAtlasToCache:function(t,e,i){var r=t.assets._cache._images[i],n=new qc.Atlas(e,i,r,{uuid:t.math.uuid(),type:AssetUtil.ASSET_ATLAS});return n.img=r.data,t.assets.cache(e,i,n),n},_parseFont:function(t,e,i,r,n,o,s){window.__wx||(r=t.assets._loader.parseXml(r));var a=new Image;a.src="data:image/png;base64,"+i,a.onerror=function(){a.onerror=undefined,s()},a.onload=function(){if(a.onload=undefined,window.__wx){if(window.Tautologistics){var i=new Tautologistics.NodeHtmlParser.DefaultHandler(function(i,r){if(i)t.log.error("解析字体文件{0}的 xml 失败。",o),s();else{var h=new qc.Font(n,o,a,r,e);h._fontFamily=qc.UIText.BITMAPFONT,t.assets._cache.addBitmapFont(o,o,a,r,h.xSpacing,h.ySpacing),t.assets.cache(n,o,h),s()}}),h=new Tautologistics.NodeHtmlParser.Parser(i);h.parseComplete(r)}}else{var l=new qc.Font(n,o,a,r,e);l._fontFamily=qc.UIText.BITMAPFONT,t.assets._cache.addBitmapFont(o,o,a,r,l.xSpacing,l.ySpacing),t.assets.cache(n,o,l),s()}}},_parseText:function(t,e,i,r,n,o){t.assets._cache.addText(r,r,e),t.assets.cache(i,r,new qc.TextAsset(i,r,e,n)),o()},_parseScene:function(t,e,i,r,n,o){return AssetUtil._parsePrefab(t,e,i,r,n,o)},_parsePrefab:function(t,e,i,r,n,o){t.assets.cache(i,r,new Prefab(i,r,e,n)),o()},_parseAction:function(t,e,i,r,n,o){t.assets.cache(i,r,new ActionAsset(i,r,e,n)),o()},_parseActionManager:function(t,e,i,r,n,o){t.assets.cache(i,r,new ActionManagerAsset(i,r,e,n)),o()},_parseSound:function(t,e,i,r,n,o){if(t.assets._cache.addSound(n,n,i),t.assets._cache.isSoundDecoded(n)){var s=new qc.SoundAsset(r,n,t.phaser.cache.getSound(n),e);t.assets.cache(r,n,s),o()}else t.sound.phaser.decode(n,{url:n,key:r,meta:e,nextStep:o})},_parseExcel:function(t,e,i,r,n,o){t.assets.cache(r,n,new qc.ExcelAsset(r,n,i,e)),o()},_parseWebFont:function(t,e,i,r,n,o){AssetUtil._deleteWebFont(e.uuid),AssetUtil._loadWebFont(t,e.uuid,i.url);var s=new qc.Font(e.uuid,n,s,null,e);"string"==typeof i.url?s._fontUrl=[i.url]:s._fontUrl=i.url,s._fontFamily=qc.UIText.WEBFONT,t.assets.cache(r,n.toString(),s),o();var a=function(i){t.world&&(Object.keys(PIXI.Text.fontPropertiesCache).forEach(function(t){t.indexOf(e.uuid)>=0&&delete PIXI.Text.fontPropertiesCache[t]}),AssetUtil._refreshWebFont(i,t.world)),t.assets.webFontLoaded.dispatch()};if(window.__wx)for(var h=0;h<s._fontUrl.length;h++){n=s._fontUrl[h];var l=wx.env.USER_DATA_PATH+"/"+n,c=wx.getFileSystemManager();try{c.accessSync(l);var u=wx.loadFont(l);if(u){t.log.trace("Asset {0}->{1} load from local filesystem.",n,u);s=t.assets.find(r);s?s.wxFontName=u:t.log.error("加载本地字体"+n+"成功后取不到 font 资源"),a(u)}}catch(e){AssetUtil.wxAssureDirectory(t,n),wx.downloadFile({url:t.assets.baseURL+n,filePath:wx.env.USER_DATA_PATH+"/"+n,success:function(e){t.log.trace("字体 {0} 下载成功. res : {1}",n,JSON.stringify(e));var i=wx.loadFont(wx.env.USER_DATA_PATH+"/"+n);if(i){t.log.trace("Asset {0}->{1} load from local filesystem.",n,i);var o=t.assets.find(r);o?o.wxFontName=i:t.log.error("从网络加载本地字体"+n+"成功后取不到 font 资源"),a(i)}},fail:function(e){t.log.error("Download "+t.assets.baseURL+n+" fail："+JSON.stringify(e))}})}}else window.WebFont&&(window.hasBase64&&window.hasBase64()?a(u):WebFont.load({timeout:6e4,custom:{families:[e.uuid]},fontactive:function(t){a(t)},fontinactive:function(e){t.log.error("Load "+e+" fail")}}))},_webFontType:{eot:"embedded-opentype",ttf:"truetype",ttc:"truetype",woff:"woff",svg:"svg"},_loadWebFont:function(t,e,i){var r=AssetUtil._webFontType,n=document.createElement("style");n.type="text/css",n.id="qc.webfont."+e,document.getElementsByTagName("head")[0].appendChild(n);var o="@font-face { font-family:"+e+"; src:";if(window.hasBase64&&window.hasBase64()){var s="data:application/octet-stream;base64,"+window.getAssestByKey(window.getKeyByUrl(i[0]));let t=new FontFace(e,`local(""),url('${s}') format('ttf'),url('${s}')`);t.load().then(function(t){document.fonts.add(t)})}else if(qc.Util.isArray(i))for(var a=0,h=i.length;a<h;a++){i[a];var l=AssetUtil._getSuffix(i[a]);i[a].indexOf("http")>=0?o+="url('"+i[a]+"') format('"+r[l]+"')":o+="url('"+(t.assets.baseURL+i[a])+"') format('"+r[l]+"')",o+=a===h-1?";":","}else{l=AssetUtil._getSuffix(i);o+="url('"+i+"') format('"+r[l]+"');"}n.textContent+=o+"};"},_deleteWebFont:function(t){for(;;){var e=document.getElementById("qc.webfont."+t);if(!e)break;qc.Util.removeHTML(e)}},_refreshWebFont:function(t,e){e instanceof qc.UIText&&e._refreshWebFont(t);for(var i=e.children,r=i.length;r--;){var n=i[r];AssetUtil._refreshWebFont(t,n)}},_getSuffix:function(t){var e=t.substr((Math.max(0,t.lastIndexOf("."))||1/0)+1);return e.toLowerCase()},_createStandardXHR:function(){try{return new window.XMLHttpRequest}catch(t){}},_createActiveXHR:function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}},getXHR:function(){var t;try{t=location.href}catch(e){t=document.createElement("a"),t.href="",t=t.href}var e=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,i=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,r=e.exec(t.toLowerCase())||[],n=i.test(r[1]),o=window.ActiveXObject?function(){return!n&&AssetUtil._createStandardXHR()||AssetUtil._createActiveXHR()}:AssetUtil._createStandardXHR;return o()},get:function(t,e,i){if(window.__wx){var r={"Content-Type":"text/plain;charset=UTF-8"};wx.request({url:t,header:r,dataType:"text",success:function(t){e(t.data)},fail:function(t){console.log("err:"+JSON.stringify(t)),i()}})}else{var n=AssetUtil.getXHR();n.open("GET",t,!0),n.responseType="text",n.onreadystatechange=function(){4===n.readyState&&(200===n.status?e(n.responseText):i&&i(n))},n.send()}},post:function(t,e,i,r){if(window.__wx){var n={"Content-Type":"text/plain;charset=UTF-8"};wx.request({url:t,method:"POST",data:e,header:n,dataType:"text",success:function(t){i(t.data)},fail:function(){r()}})}else{var o=AssetUtil.getXHR();o.open("POST",t,!0),o.responseType="text",o.onreadystatechange=function(){4===o.readyState&&(200===o.status?i(o.responseText):r&&r(o))},o.send(e)}},createAtlasFromCanvas:function(t,e,i){var r=t.assets.find(e);if(r){var n=PIXI.BaseTextureCache[e];if(n&&n.source==i)return n.dirty(),r;r.unload(t)}var o=t.assets._cache;PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(i),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),o._images[e]={url:e,data:i},o._images[e].frameData=new Phaser.FrameData,o._images[e].frame=new Phaser.Frame(0,0,0,i.width,i.height,"",""),o._images[e].frameData.addFrame(new Phaser.Frame(0,0,0,i.width,i.height,null,t.math.uuid()));r=new qc.Atlas(e,e,o._images[e],{});return r.json={},r.img=i,t.assets.cache(e,e,r),r},wxRemoveUnusedAssets:function(t){if(window.__wx&&"function"!=typeof wx.getSharedCanvas){var e=t.storage.get("assetsMd5")||{},i=wx.getFileSystemManager(),r=wx.env.USER_DATA_PATH+"/Assets",n=function(o){try{for(var s=i.readdirSync(o),a=0;a<s.length;a++){var h=s[a],l=o+"/"+h;try{var c=i.statSync(l);if(c.isDirectory())n(l);else{var u=l.replace(r+"/","");e[u]||(t.log.trace("本地文件({0})不在md5列表中，删除之！",u),i.unlink({filePath:l}))}}catch(e){t.log.important("wxRemoveUnusedAssets statSync({0}) 出错：{1}",l,e)}}}catch(e){return void t.log.important("wxRemoveUnusedAssets readdirSync({0}) 出错：{1}",o,e)}};n(r)}},wxCleanLocalFiles:function(t,e,i,r){if(window.__wx&&"function"!=typeof wx.getSharedCanvas){var n=t.storage.get("localFiles")||{},o=[];for(var s in n){var a={key:s,time:n[s].time};qc.Util.insertSortedList(o,a,function(t,e){return t.time<e.time},!0)}for(var h=wx.getFileSystemManager(),l=0,c=20971520,u=0;u<o.length&&!(l>=c);u++){s=o[u].key;try{var p=wx.env.USER_DATA_PATH+"/Assets/"+s,d=h.statSync(p);l+=d.size,h.unlinkSync(p)}catch(e){t.log.important("wxCleanLocalFiles statSync({0}) 出错：{1}",p,e)}}r||e&&i&&qc.AssetUtil.wxWriteFile(t,e,i,!0)}},wxAssureDirectory:function(t,e){if(window.__wx&&"function"!=typeof wx.getSharedCanvas){var i=wx.getFileSystemManager(),r="",n=[wx.env.USER_DATA_PATH];n=n.concat(e.split("/"));for(var o=0;o<n.length-1;o++){r=0===o?n[0]:r+"/"+n[o];try{i.accessSync(r)}catch(e){try{i.mkdirSync(r)}catch(e){t.log.trace("创建目录{0}失败：{1}",r,JSON.stringify(e))}}}}},wxWriteFile:function(t,e,i,r,n){if(window.__wx){AssetUtil.wxAssureDirectory(t,e);var o=wx.getFileSystemManager(),s=wx.env.USER_DATA_PATH+"/"+e;o.writeFile({filePath:s,data:i,encoding:"utf8",success:function(){t.log.trace("资源({0})写入本地文件",e),n&&n.apply(null,[e])},fail:function(n){t.log.important("资源({0})写入本地文件{1}失败：{2}",e,s,n.errMsg),o.unlink({filePath:s}),AssetUtil.wxCleanLocalFiles(t,e,i,r)}})}},wxSaveAsset:function(t,e,i){if(window.__wx&&"function"!=typeof wx.getSharedCanvas){var r=t.storage.get("localFiles")||{},n=t.storage.get("assetsMd5")||{},o=e.replace("Assets/","");if(n[o]){var s=r[o];if(s){if(s.md5==n[o])return t.log.important("文件({0})md5一致，不缓存。",e),s.time=t.time.now,void t.storage.delaySet("localFiles",r,1e4)}else s={};s.md5=n[o],s.time=t.time.now,r[o]=s,t.storage.delaySet("localFiles",r,1e4),AssetUtil.wxWriteFile(t,e,i)}else t.log.important("文件({0})不在md5列表中，不缓存。",e)}},wxReadAsset:function(t,e){if(window.__wx&&"function"!=typeof wx.getSharedCanvas){var i=e.url,r=t.storage.get("localFiles")||{},n=t.storage.get("assetsMd5")||{},o=i.replace("Assets/",""),s=function(r){var n=wx.getFileSystemManager();try{if(e.isSound){n.accessSync(r);var o=new Audio;o.name=i;var s=function(){o.removeEventListener("canplaythrough",s,!1),o.removeEventListener("stalled",a,!1),o.onerror=null};o.onerror=function(){o.removeEventListener("canplaythrough",s,!1),o.removeEventListener("stalled",a,!1),o.onerror=null;var e=t.assets.find(i);e&&e.unload(t)};var a=function(){o.removeEventListener("canplaythrough",s,!1),o.removeEventListener("stalled",a,!1),o.onerror=null;var e=t.assets.find(i);e&&e.unload(t)};return o.preload="auto",o.src=r,o.addEventListener("canplaythrough",s,!1),o.addEventListener("stalled",a,!1),e.data=o,t.assets._cache.addSound(i,i,o,!1,!0),o}return o=n.readFileSync(r,"utf8"),e.data=o,o}catch(t){}},a=s(i);if(a)return t.log.trace("Asset {0} load from package.",i),a;if(n[o]){var h=r[o];if(h&&h.md5==n[o]){var l=wx.env.USER_DATA_PATH+"/"+i;a=s(l);if(a)return t.log.trace("Asset {0} load from local filesystem.",i),h.time=t.time.now,r[o]=h,t.storage.delaySet("localFiles",r,1e4),a;delete r[o],t.storage.delaySet("localFiles",r,1e4);var c=wx.getFileSystemManager();c.unlink({filePath:l})}}else t.log.important("文件({0})不在md5列表中，不尝试读取本地资源。",i)}},updateWxResMd5:function(t,e,i,r){AssetUtil.get(e,function(n){try{var o=JSON.parse(n);t.log.trace("Download dislist success: {0}",n);var s=t.storage.get("version")||"",a=t.storage.get("assetsMd5");if(s==o.version&&a)return t.log.trace("资源版本一致。"),void("function"==typeof r&&r.apply(null,[o]));AssetUtil.get(i,function(e){var n={};try{n=JSON.parse(e),t.log.trace("下载 md5List 成功。"),t.storage.set("assetsMd5",n),t.storage.set("version",o.version),AssetUtil.wxRemoveUnusedAssets(t),"function"==typeof r&&r.apply(null,[o])}catch(e){t.log.error("parse md5List({0}) fail.",i),"function"==typeof r&&r.apply(null,[])}},function(){t.log.error("download md5List({0}) fail.",i),"function"==typeof r&&r.apply(null,[])})}catch(i){return t.log.error("parse dislist({0}) fail.",e),void("function"==typeof r&&r.apply(null,[]))}},function(){t.log.error("download dislist({0}) fail.",e),"function"==typeof r&&r.apply(null,[])})}},Assets=qc.Assets=function(t,e,i){this._loader=e,this._cache=i,this.game=t,e._qc=this,i._qc=this,this._uuid2UrlConf=window.urlMapConfig||{},this._uuid2UrlConf.__builtin_resource__="__builtin_resource__",this.assetCountMap=window.assetCountMap||{},this.batchTotalCount=0,this.batchCurCount=0,this.batchLoadFlag=!1,this.inBatchLoadFlag=!1,this.maxRetryTimes=1,this.webFontLoaded=new qc.Signal,this._parsing=0,this._loaderTimerMutex=-1024,this._assets={},this._keyUrl={},this._complete={};var r=this;e.onFileComplete.add(function(t,e,i){if(!i){var n=r._complete[e];if(!n||0===n.length)return;return n[0].retry>=r.maxRetryTimes?(r.game.log.important("Asset({0}) load fail",e),void r._callCb(e,null,n[0])):void r.game.timer.add(1e3,function(){r.game.log.trace("Retry download:{0}",e),n[0].retry++,r._internalLoad(n[0])})}r._parseAsset(e)}),t.sound.phaser.onSoundDecode.add(function(e,i){var n=r.game.phaser.cache.getSound(e);if(n&&n.decoded){var o=t.assets.find(e);if(!o){o=new qc.SoundAsset(e,e,n,{uuid:e,type:AssetUtil.ASSET_SOUND});t.assets.cache(e,e,o)}}i&&i.nextStep&&i.nextStep()}),this._loadBuiltin()},loadItem;Assets.prototype={},Assets.prototype.constructor=Assets,Assets.IMAGE=1,Assets.AUDIO=2,Assets.TEXT=3,Assets.BITMAPFONT=4,Assets.BINARY=5,Assets.ATLAS=6,Assets.JSON=7,Object.defineProperties(Assets.prototype,{isLoading:{get:function(){return this._loader.isLoading}},hasLoaded:{get:function(){return this._loader.hasLoaded}},baseURL:{get:function(){return this._loader.baseURL},set:function(t){this._loader.baseURL=t}},parsing:{get:function(){return this._parsing>0}},loaded:{get:function(){return this.batchCurCount?this.batchCurCount:this._loader._loadedFileCount}},total:{get:function(){return this.batchTotalCount?this.batchTotalCount:this._loader._totalFileCount}}}),Assets.prototype.loadBatch=(loadItem=function(t,e,i,r){t.inBatchLoadFlag=!0,e.loaded=!1,t.load(e.key,e.url,function(n,o){n&&(e.loaded=!0),e.asset=n,e.dependenceAsset=o,e.callback&&e.callback(e);for(var s=0;s<i.length;s++)if(!i[s].loaded)return;t.inBatchLoadFlag=!1,r(i)},e.override,e.isRaw)},function(t,e){this.beginBatchLoad();for(var i=0;i<t.length;i++)loadItem(this,t[i],t,e);this.endBatchLoad()}),Assets.prototype._internalLoad=function(t){var e=this;t.retry||(t.retry=0),t.isSound=AssetUtil.isSound(t.url),t.isSound&&(t.url=e.game.sound.tryGetUrl(t.url));var i=t.url;if(!t.override){var r=e.find(i);if(r&&(!r.hasUnloadedDependence||!r.hasUnloadedDependence(this.game)))return e._keyUrl[t.key]=i,"__builtin_resource__"!==t.key&&e.batchTotalCount&&e.batchCurCount<e.batchTotalCount&&(t.inPrefab||(e.batchCurCount+=1,e.game.log.trace("Asset {0} load from cache: {1} / {2}",i,e.batchCurCount,e.batchTotalCount))),void(t.callback&&t.callback(r))}if("__builtin_resource__"!==t.key){window.assetDataMap&&window.assetDataMap[i]&&(t.data=window.assetDataMap[i]),window.__wx&&AssetUtil.wxReadAsset(e.game,t);var n=e._loader;0===t.retry&&(e._complete[i]?e._complete[i].push(t):e._complete[i]=[t]),t.data?n.onFileComplete.dispatch(0,i,!0):(e.game.log.trace("Asset {0} ready to download from network.",i),t.isSound?i.indexOf(".bin")<0?n.audio(i,i):AssetUtil.isSound(i)&&n.binary(i,i):t.isRaw?n.image(i,i):n.text(i,i),e.start())}},Assets.prototype.load=function(){var t,e,i,r=this,n=!1,o=!1,s=!1;if(1===arguments.length?e=arguments[0]:2===arguments.length?"string"==typeof arguments[1]?(t=arguments[0],e=arguments[1]):(e=arguments[0],i=arguments[1]):(t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],o=arguments[4],s=arguments[5]),t=t||e,!e)throw new Error("url is empty.");var a={key:t,url:e,callback:i,override:n,isRaw:o,inPrefab:s};if(r.batchLoadFlag&&"__builtin_resource__"!==t){var h=r.assetCountMap[e]||1
;r.batchTotalCount+=h}else r.batchLoadFlag||"__builtin_resource__"===t||r.batchTotalCount&&r.batchCurCount>=r.batchTotalCount&&(r.batchTotalCount=r.batchCurCount=0);r.game.phaser.state._created?r.game.timer.add(1,function(){r._internalLoad(a)}):r._internalLoad(a)},Assets.prototype.beginBatchLoad=function(){this.batchLoadFlag=!0,this.batchTotalCount=0,this.batchCurCount=0},Assets.prototype.endBatchLoad=function(){this.batchLoadFlag=!1},Assets.prototype.loadByUUID=function(t,e,i,r){var n=this,o=this._uuid2UrlConf[t];if(!o)return this.game.log.important("UUID({0}) not found.",t),n.batchTotalCount&&n.batchCurCount<n.batchTotalCount&&(r||(n.batchCurCount+=1,n.game.log.trace("Asset {0} load failed: {1} / {2}",t,n.batchCurCount,n.batchTotalCount))),void(e&&e());this.load(t,o,e,i,!1,r)},Assets.prototype.loadTexture=function(){var t,e,i,r,n=this;if(1===arguments.length?"string"==typeof arguments[0]?e=arguments[0]:i=arguments[0]:2===arguments.length?"string"==typeof arguments[0]&&"function"==typeof arguments[1]?(e=arguments[0],r=arguments[1]):"function"==typeof arguments[1]?(i=arguments[0],r=arguments[1]):(t=arguments[0],e=arguments[1]):"string"==typeof arguments[1]?(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],i=arguments[1],r=arguments[2]),t=t||e,i){if(!t)throw new Error("key cannot be null.");n._keyUrl[t]=t;var o=AssetUtil.addAtlasFromImage(n.game,t,t,i);n.batchTotalCount&&n.batchCurCount<n.batchTotalCount&&(n.batchCurCount+=1,n.game.log.trace("Asset {0} loaded: {1} / {2}",t,n.batchCurCount,n.batchTotalCount)),r(o)}else n.load(t,e,r,!1,!0)},Assets.prototype.find=function(t){if(AssetUtil.isSound(t)&&(t=this.game.sound.tryGetUrl(t)),!qc.Util.isArray(t)){var e=this._keyUrl[t];return e?this._assets[e]:null}for(var i=0;i<t.length;i++){var r=this.find(t[i]);if(r)return r}},Assets.prototype.unload=function(t){if("string"==typeof t&&!this._keyUrl[t]){var e=AssetUtil.isSound(t);e&&(t=this.game.sound.tryGetUrl(t))}if(qc.Util.isArray(t))for(var i=0;i<t.length;i++)this.unload(t[i]);else if("string"==typeof t){var r=this._keyUrl[t];r&&(this._assets[r]&&this._assets[r].unload&&this._assets[r].unload(this.game),delete this._assets[r],delete this._keyUrl[t])}else this.unload(t.url)},Assets.prototype.findByUUID=function(t){for(var e in this._assets){var i=this._assets[e];if(i.uuid===t)return i}},Assets.prototype.cache=function(t,e,i){t=t||e,this._assets[e]=i,this._keyUrl[t]=e,this._keyUrl[e]=e},Assets.prototype.clear=function(){var t=this,e=Object.keys(PIXI.TextureCache);e.forEach(function(t){"__default"!==t&&"__missing"!==t&&"__builtin_resource__"!==t&&(PIXI.TextureCache[t].destroy(),delete PIXI.TextureCache[t])}),e=Object.keys(PIXI.BaseTextureCache),e.forEach(function(t){"__default"!==t&&"__missing"!==t&&"__builtin_resource__"!==t&&delete PIXI.BaseTextureCache[t]});var i=t._cache._images.__builtin_resource__;t._cache.destroy(),t._cache._images.__builtin_resource__=i,e=Object.keys(t._keyUrl),e.forEach(function(e){"__builtin_resource__"!==e&&delete t._keyUrl[e]}),e=Object.keys(t._assets),e.forEach(function(e){"__builtin_resource__"!==e&&(t._assets[e]&&t._assets[e].unload&&t._assets[e].unload(t.game),delete t._assets[e])})},Assets.prototype.start=function(){var t=this;t.game.time.fixedTime-t._loaderTimerMutex<1||(t._loaderTimerMutex=t.game.time.fixedTime,t.game.timer.add(1,function(){t._loaderTimerMutex=-1024,t._loader.start()}))},Assets.prototype.addUrlConf=function(t,e){this._uuid2UrlConf[t]=e},Assets.prototype._parseAsset=function(t){var e=this,i=e._complete[t];if(i&&0!=i.length){var r=function(t){e=e;var i=this.key,r=e._uuid2UrlConf[i],n=e._complete[r];n?(n[0].loadCnt--,0==n[0].loadCnt&&(window.printingloading&&console.log("依赖资源加载完成:"+r),e._parseAsset(r))):console.warn("error url:"+r)},n=function(t,i){e._parsing--;t=t;for(var n=0;n<i.length;n++){var o=i[n];window.printingloading&&console.log("loadDependenceRaw:"+t+" "+o);var s=o.indexOf(".png")>-1||o.indexOf(".jpg")>-1;e.load(t,o,r,!1,s,!0)}},o=function(){e._parsing--;var r=e.find(t);if(r&&(r.meta.type!==AssetUtil.ASSET_SCENE||e.inBatchLoadFlag)&&r.hasUnloadedDependence&&r.hasUnloadedDependence(e.game))for(var n in r.dependences){var o=r.dependences[n],s=function(n){n=n;return function(o,s,a){if(!o&&!s){e.game.log.important("预制的依赖资源({0})加载失败.",n.uuid);var h=r.dependences[n.uuid];h&&(h.ok=!0)}if(e.inBatchLoadFlag&&!a){var l=e._complete[t];l&&l[0]&&l[0].callback&&l[0].callback(null,o,!0)}r.hasUnloadedDependence(e.game)||e._callCb(t,r,i[0])}},a=!0;e.inBatchLoadFlag&&(a=!1),e.loadByUUID(o.uuid,s(o),!1,a)}else e._callCb(t,r,i[0])};e.nextStep=o,e.loadDependenceRaw=n,e._parsing++;try{AssetUtil.parse(this.game,i[0],o,n)}catch(r){e._parsing--,e.game.log.error("Asset({0}) Parse fail",t,r),qc.Util.popupError(r.message),e._callCb(t,null,i[0])}}},Assets.prototype._callCb=function(t,e,i){var r=this,n=r._complete[t];n&&(delete r._complete[t],n.forEach(function(i){e&&(r._keyUrl[i.key]=i.url),r.game.loadingProcessCallback&&(i.inPrefab||r.game.loadingProcessCallback(t,e,i)),r.batchTotalCount&&r.batchCurCount<r.batchTotalCount&&(i.inPrefab||(r.batchCurCount+=1,e?r.game.log.trace("Asset {0} loaded: {1} / {2}",t,r.batchCurCount,r.batchTotalCount):r.game.log.trace("Asset {0} load failed: {1} / {2}",t,r.batchCurCount,r.batchTotalCount))),i.callback&&i.callback(e)}))},Assets.prototype._loadBuiltin=function(){var t=this,e="__builtin_resource__",i="iVBORw0KGgoAAAANSUhEUgAAAIAAAABACAYAAADS1n9/AAAURElEQVR4Xu1cCVRUR9au1w2NrL8LAoIoEFBJ0w8QIioJRBRB1BE1qCCLBCUaEyMBo6AnYlSYqIjGOaNxieKekBicIKIoZnFQiUjTiKgoIAoBo8ggi2z95tyXLv62pbtfb7Q61DkegXer6ta9X92qunVvEUiFQpLkSDabPUFfX5+HELJqbGy0pijqoYmJyROhUHitra2ttKOjI6ekpKRdhW5eqEpRFIEQGokQMlSx3WaE0C2CICim7URERERdu3ZtfF1dnUlTUxPTajSdkZERMjc3bxw9enReWlraPqaVeTzeBQ6H83ZHR4cOi8VCHA6HaVWUn58PspJaZH6U10sfAF5+AIAOZYFAYQC4uLi4GBgYLGltbQ1yc3Mb4Ofnh7hcLiIIAo0aNYrGzM2bNxFFUejKlSvo7NmzHaWlpVcJgthlb29/JD09vUsesOR937x5c3Z2drZfeXk5evLkiTzyHr8PGDAA2dnZIX9//zMrVqzwl9dIXFycz9GjRzdyOBz9hIQEWzs7O30Oh0PAOJkUkE97eztVXl7empSUVNHe3t4aEhKyesuWLbnS6ru6unoJhcKzlpaWeqGhoSgkJIRJVy/QENC5lMIYACRJ2hobG39tb2/vu2TJEuTh4aEQM7m5uSg1NfXhgwcPPuLz+ekKVRYRx8bGzjpy5MjxpqYm3bCwMDR9+nRka2uLwCyCIuQpA+QA/4RCIaqoqEA//fQTOnToEJjmjpCQEK+tW7de7omvNWvWOKSkpBxZt26dmZ+f3xCEEAf6VKZA3wih9jNnzvyxdu3ah7GxsfM3bNhQJtnWmDFjRrS3t99cu3YtERgYqExX3XVUBsDEiRO36+rqfrR48WLWjBkzVGLmwIED6JtvvrldX1/vW1JSUsW0sYSEBDI1NZUfFRVFzJ07F5mZmdGKh3+SAJcEQk/fQRHw7+HDh+jbb79F+/bto2JiYqySkpL+kOTJxsbmzOzZs4eHh4fbcTgcXfxdHuAk2xHno729vePgwYPlP/zww73Kyko/SVoej/d4xowZAxMTE1FHRwc9TswzU5lhOkNDQ+UsAJfLNTI1NT3v7e09BhgRHwAMvqur6zmmROimmYWCFcRms1+oGxkZ2czn86cXFRVdYDIge3v7/4wbN85kw4YNNLmuri6CdiXbFm8L+O1JSZh34B+EC2XNmjXo0qVLjXfu3Pk/sTa+gp8DAgJ8N2/eDBtcQ2VnvuQYQVYEQTSvWLHiflZW1gHR9y/d3d3pGfbGG29k7N+/n/6zokCT7EspAHC5XIv+/ftfmzlz5pDY2NjuNkFonZ2dtPIVKaAoHR0dWmG4xMbGCnNzcz/g8/l7ZbSVBt8sLS3DL1++TLcBu2A9PT26LawQGcvcc01jYYICYAxtbW2wNtNjGjt2LKqpqfm7qEI8Qugq/Hzjxg03aWBSRAY9WQTg58033ywQfXN3dnb+N/ycl5f3iCCIaTCPeh0AXC6XM2TIkBsBAQFvxMTEdKMQhIVnubIDB4WB8rDC4uLiqPPnz8/i8/kZUtqkd1lbt25F8+fPR/369XtO+XhdV4QfvF8QB8GzZ8/QkSNH0KeffoqbArNJA6C0tNSFoqj/R64incmhJQiiy9HRkY8BwOPxauDny5cv1xEE4aIVC+Dn55c1fvz4KZ9//jnNF54hahx390yGNhcsWNBRWFjIEwgEt3rogwbA1atX0ciRI1+Y+aryJA6CW7duIXd39xcAcPPmTRehUKgRALBYrK5Ro0aJA+ChCAA1BEE4Y2ZUsQIKLQF+fn7LjY2NU7/77jt6lsKsV9TcM1UKmHCwBjC4CRMmlJuZmY3o4ZhIA+Dx48fI2Nj4ObPPtB95dBgET58+RYMGDdIqAEiSvCECwFqE0He9CgAulzvQ2tq6ZtmyZXpTpkxBYBZVNfnyhA9LAph12Ilv3rw5rqCgIEWiDg0AUI6+vn6Pu355fcj7DgCEcba2ttIgE5XuJaA3LYCbm9sqUf/JFy9e7N4A9ooFIElyu7e397KvvvpKI2ZfmiLwxm7mzJlPy8rKTCVcxzQAWlpaaGuhrl24JC8AALB2BgYGWgUA7pwkybbY2FjOnDlzVJ6EjJaAcePG6ffv379h3bp1nNGjR9PC6M0Cyv3tt99QTExMNJ/P3yPWNw0AsEZw9NMkAOBICNZImxYAd/7WW29FdnR0fLNr1y7k7OzMyNElTV+MAODt7R2MEDr6888/06ZQFZOjDHBgvwEm3sPDoyQ/P99JEgAASAAA0+OeojzAeAEAAMSXAQDAg4uLy0aKolZ5enqyVq1ahQYPHqyUXgwMDOQ7gsLCwi7Y29u/Gx8f3+0cUVSIqtCDYmEpWLp0KZWXl2cKbZWUlNSDHwR+hpMIAECTBQAgdtOmlT2A5Pi8vLysnzx5UkAQxGCQD3hAxUDKSBwnT56UD4DZs2c3RkZGGk+cOFHlNYcRVz0QgXnPzMxEGzduBAcI4vP5pzAAwFEj7kRStg9Z9eC0A0J+WSwA8KEqAGQpH9onYOcPP1haWj5OTU0FF6RWAXD37l0UHh6+CXi6du3aSgwAmJ1iytGE/mlvoJiV0YojSCMDk9Eo4ezsPAa+6+joXMnOzkaGhoZKrTPqYByWgebmZuTr63taZAECMABgdmpqA4h5h5OAmJXpBsDt27dHd3V1Mb76ZSoLGC+bzaZGjBhxTVSH9kJRKm7AZN3+SfJGODk5+Yr+eBZ87fhqlekg1EmH/e1jx469BO0WFxePfxkAkJGRYWdjY2PSr18/trr8IiDnZ8+edVVWVjYGBgaWYwCoqvzu9YvhbplwcXGZCpU6OzszXyIAFIoAMBoDAK6R582bp/AGiClA4ZRx/PhxcEt3y/CDDz7wgl+ysrL+8eOPP9oaGhoaqTg5u9kRWbummTNnVgQEBHwEH77++utfex0APB7PGzrncDg/v0RLwK+iJcDbx8fnB/j54sWLsxobGzUKABMTE/T222+fgP5yc3NnY21ZWVldWLhw4fDAwMBhYAVEZpoptp6jwxMTZn9GRkbV3r1771VXV0/ARL0OAFdX1zehc3Nz85JNmzYhBwcHrW4Cy8rKUFRU1HHg6ffffwffBF2GDRv2dNKkSUY7d+6k+RNz2CilCFwJHExgjiHK6dy5c01VVVXdvmBMs3LlyvG7du3aFh8fb+7r62uhq6vLYWhhX+BN5G9oz8nJqU1OTq5bvHjx8i+//DJPawCAq1/onCTJZ/PmzSMmT56sNQDABgys0Pr16+OAJ/F7AYjb271796ng4GAWxCfY29urpHhc+c6dOyglJQUdO3ZMGB0dPRXiDXtqGMcEGhgYGMbHx9vY2trqw6mE6Z4AQAanjIqKitbk5OTKlpaW5p5iAnvdAuDBfvjhh9WDBg2yXL16NT0oda11TLUEMwqEBB6vCxcu0AGHRUVF+eL1RTGBx5qbmzkQjArX1TweRKQrXoqLi9EXX3yBzpw5Ayef9vnz5wenpKTQ5l9aiY6O1m1ra4u8evWq559//mmgTFj44MGDW9zd3f+tp6e3f/fu3X+FI4kVrQHg/fff33v37t2onJwcGqnaAADMKG9v72dDhw41Apn0FEGcmJjIqa6uTrx3715kS0uLBVwSKVPg0sfAwKB2+PDh+62srBITExPl5i681gDg8Xhu9vb2V5cvX05H/GoqBkCassD85+fngwX4V15entTIU20CQBmgKVpHaxYAGOVyuVXvvvuuNYRfAQB6ywqIHCIoOjoavH/uxcXFOEZOUfm9MvQ8Hi+SIIi5XV1dfxO//tYqAHx8fIIHDRp0FBIQICCkt6wAzP7Tp0+jbdu2CX755ZfuMChp2oyIiFhTWFjoX1dXN1CZddjc3Lze1dU1Oy0t7a8QYy0UcQBA9xgEWgUAMBITE3OzpqZmJDheoDDd5SorQ+zenTt3LlVVVTWaz+fj+DipTb7qAODxeIcIgggVDXAp/C8QCP4J/2sdAOAX8PT0FJiamrLhaljZZAQmgMB5A+vXr4c0sn05OTkLZdWDU8Dhw4ePNjc368EpYOPGjXSgqCIFAj/hpCPa/beFhoaGyNv9K9K+PFqSJJchhLaL0dHZSAKBYNxLAQBgIiQkJBwhlObi4oI++eQTjYAAK3/79u1w9r9dV1fHk5VFLMoMKoyKimIBMC0tLeXJWub3mpoalJycDBlBwpiYGNekpCSBSg0yqMzj8bwIgoBEGPG8MvqoKxAI6KOv1i0AHseCBQtSqqurP4WZ9vHHH6sVBFj5O3bsQCdOnHjc2trqWFhY+KcsGdrY2PzxzjvvWBw8eJCBqJmThIeHQyhabWVlJeT8aaw4OTmZs1isSoRQd8wZQqitq6uLRrIo+OXlAQAwFRwcvImiqBWQ9bty5cruxEplTwfY2QP1k5KSIPulvLa21rOkpKRWhuTpiCCY8dXV1TQZDt9SZnnC4BMPL7OysoKMIMwC44RZRdBCkiTkHFqI1yEIYnZRUdFzzqeXxgJgRidPnjzfwcHhwKNHj3TgNi4gIOA5T6E8MGCfOVZ+VlYWOnz4MGpqajrd2Ng4+9KlS61yBEkDAOpAZhBO51JE+NJocXoZZARB+rWoqB0AJEleRAh5ivNBUdSPxcXFsyR5e+kAAAzCxtDLy+tIRUWFi7W1NX0tO2bMmBdi1jEYxJUO9eF3cPIcPXoU3b59u5kgiBXnzp3byVCJNADu378PF1Zqj1cES1BXV4dgXJoAAEmS2xBCn0iM9ZFAIBgsbfyqgkChgBCGSqDJxo4dO8nDw2P/vXv3htbX1yMfHx96Fw5LBJhWR0dHmq60tJS2EvBQBOy6z58/D27XdhaLldrQ0LCOwax/brLALzhDSZ7FUWQ8GJw4Q0kaAMBLShCEp0Ag+AecjJn24ezsHEpR1CEJeqFQKHS9fv26xjedTPhUytzB0zCenp5LdXV1ZzQ0NAyDtC1QOMTzwWyHlzfgd1NT02YdHZ3fqqqqdpqamp5S8nWQ7qhgTdxR4GhkiWhgWnb4ppTNZuMkCbgpfE8gEMDbQjKLk5MTyWKxINRLMqdwnUAgSJRVOSgiZAmiqOUIdfqmH0zv8Q2FoPDgZITQVETpzEg/dKhCHj/SvisFAMnGnJ2drYRCoQVFUQMJgoBQ7vZiuG5TT9EaAHg8HgSlAqhxyjj8ms9ms6fJOrXAuwpsNhs2tpKPWAkEAoFMTyetfCgKAADIlQVBHwBE+Qg9WQAej0c/ekQQBNxNdOeMIYRgxk0UCAQ9zjySJO8ihOwk8E8f+fBxT9rcCAoPpsPhIC8EIaIKoY53JK1AUETwBkSh1YhAN3TakQ8QHzt2rE6Z+aYWACjTsQJ1tGYBMI9OTk7WLBarBCEkHi1Uz2Kx/Pl8/u/iY+HxeJkEQdBxluKlpyNfTzIICgqir8KRvk4mQshbEgRBEcHrEIUgb78AsTunpO9Pl+k/kSfnHgFQW1trePDgwdgrV65MKykpcYSNl6IhULgOl8st9fDwyAwPD0+xsLCQu3b2wLDWAQA8iRw5pQihAWI8thIEMaeoqAiUBVFVsLZDWvdzRdqRT5ZygoKCOEhf5wjsOTAIEKETJVL+JdSvc0r67vT/yFOwvO99AJCxBEgKD5Jo2Gw2PGJBp66JShdFUR+yWKwGiqIgllFSpjKPfPIUFBQ+bwdCBEQNg7Lh/aJc1No5Iz09XbFHCqV09AIA0tLSQrds2bIjLCysv5OTE72jlzb75b2bA1YA3vK7fv06PMfWEBcX93FERMRheYOWnEDwO36rQBPHQPxGgahfmcuiaIMHIJC8jIBHkyR3/Go58gWFBcN6D+t+NnrWOSs9PV2e84yxiJ8b7KJFizKNjIyeBAYGhlpYWKiUkow5wG/41NbWooyMjMNNTU0D9uzZQ+f+MSz0EgD3/ppIWgH+4MgKz7gyAQDQwPFQZAls5IxB7pGPoQzQnPCQSVRrx6/p6elyQ9eYtgl03QDYtGnT5w8fPrRbtGhRBH5ESV2zDYMA/t+zZ0+amZlZ+WefffYFQ0ZpAED0Lvjs1R2fAKCCOwaxKGNGG2MRCCB24S/v14tF7pGP4fhpMo0BoKyszAQ6mDZtWvX3339vBK5RdQsZDxSEDUme7733XlNmZqYV/N3BwaFRjiBoAODMIHVGLOP7CcmMIEUUQ5JkEez/JOowOvIp0o+maAmY+aLG18EroOoUsCTTWOAnT56ET/RuWZ4liIqKmg50hw4d+hdkBuH3fNQhEPzKKGQEhYWF/Q3a3Ldv30+Ktk2SJOQyjsX1mB75FO1HE/TE1KlTaY9dTEyM09ChQzU2+8WtwIMHD+Dd4Ovwt1OnTjEK7Le0tHzi7+/fH2cG4WVKGaHgJQlnBGVnZzfU1NSIH+8UbpYkyRyE0CRljnwKd6bGCoSbmxvtQdq7d68ZpFupa92XxiMIH3b0CxcupN/DKygoMGcyHsnMILi9UwYEWPlwu8gkI4gJb5jG2dn570VFRfiVL0Wqao2WcHV1pT1JBw4cMAV3aG8AAJ57WbBgwSPot7CwUOq1qKRUcExgS0sLHRMImUH4iXqmEoQbSpwRZGBgoNaYwFcSAK/KEoAVDIkh5eXlCQUFBVMePXpkrExYuKmp6VM3N7fTdnZ2SUwygpiC61WkI5KSkjYC43p6egnTpk3TeC4A3L3DO0BtbW1J0G9CQsJqRQTXBwBFpCWflqioqOgPZP7+/vdPnDgB15ga2wjCpgtCumbNmtWUnZ1Nh+DY2to2yGezj0JTEuh2eoAlqK+vt+oNR9DAgQOrFZ35mhLA/3q7r4Ir+H9dRxodv8zLIJIk6csgVQpcBgkEAlUug1Tpvq+uHAnIvA7Oy8sLLC0tdVBFio6OjmXjx4/PUCEeQJXu++r2AaAPA7IkwOjmq0+Er68E+gDw+uqW0cj6AMBITK8vUR8AXl/dMhpZHwAYien1JeoDwOurW0Yj+y97o2/XSZsB1wAAAABJRU5ErkJggg==",r={ver:1,uuid:e,padding:{"button.png":[10,9,10,9],"button2.png":[10,9,10,9],"slider.png":[12,10,12,10],"sliderbg.png":[13,7,13,7],"sliderbg2.png":[14,0,0,0]}},n=JSON.parse('{"frames":{"circle.png":{"frame":{"x":1,"y":1,"w":37,"h":37},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":37},"sourceSize":{"w":37,"h":37}},"sliderbg.png":{"frame":{"x":1,"y":41,"w":30,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":30,"h":16},"sourceSize":{"w":30,"h":16}},"slider.png":{"frame":{"x":41,"y":1,"w":28,"h":24},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":28,"h":24},"sourceSize":{"w":28,"h":24}},"button.png":{"frame":{"x":41,"y":28,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"button2.png":{"frame":{"x":72,"y":1,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"ok.png":{"frame":{"x":72,"y":27,"w":25,"h":22},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":25,"h":22},"sourceSize":{"w":25,"h":22}},"sliderbg2.png":{"frame":{"x":101,"y":1,"w":19,"h":14},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":19,"h":14},"sourceSize":{"w":19,"h":14}},"empty.png":{"frame":{"x":101,"y":18,"w":16,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":16,"h":16},"sourceSize":{"w":16,"h":16}},"arrow.png":{"frame":{"x":101,"y":37,"w":12,"h":7},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":12,"h":7},"sourceSize":{"w":12,"h":7}}},"meta":{"app":"QCEngine","version":"1.0","image":"__builtin_resource__","format":"RGBA8888","size":{"w":128,"h":64},"scale":"1"}}');t._parsing++,AssetUtil._parseAtlas(this.game,r,n,i,undefined,r.uuid,e,function(){t._parsing--,t._callCb(e,t.find(e))})};var Atlas=qc.Atlas=function(t,e,i,r,n){this.key=e,this.url=e,this.meta=r,this.animation=undefined,this.json=undefined,this.img=undefined,this._data=i,n&&(this.animation={type:r.animationType,data:n})};Atlas.prototype.constructor=Atlas,Object.defineProperties(Atlas.prototype,{count:{get:function(){return this._data.frameData.total}},frames:{get:function(){return this._data.frameData._frames}},frameNames:{get:function(){var t=this.frames;if(!t||t.length<1)return[0];var e=[];for(var i in t)e.push(t[i].name);return e}},uuid:{get:function(){return this.meta.uuid}},class:{get:function(){return"qc.Atlas"}}}),Atlas.prototype.getFrame=function(t){return"number"==typeof t?this._data.frameData.getFrame(t):this._data.frameData.getFrameByName(t)},Atlas.prototype.getTexture=function(t){return new qc.Texture(this,t)},Atlas.prototype.getPadding=function(t){if(!this.meta||!this.meta.padding)return[0,0,0,0];if(1==this.count){var e=Object.keys(this.meta.padding);t=e.length>0?e[0]:0}t===undefined&&(t=0);var i=this.meta.padding[t];return i&&(i[0]*=1,i[1]*=1,i[2]*=1,i[3]*=1),i||[0,0,0,0]},Atlas.prototype.unload=function(t){t.assets._cache.removeImage(this.key,!1),delete PIXI.TextureCache[this.key],delete PIXI.BaseTextureCache[this.key]};var Texture=qc.Texture=function(t,e){var i=this;i.atlas=t,i.frame=e||0};Texture.prototype.constructor=Texture,Object.defineProperties(Texture.prototype,{padding:{get:function(){return this.atlas.getPadding(this.frame)}},class:{get:function(){return"qc.Texture"}}});var Prefab=qc.Prefab=function(t,e,i,r){this.key=t,this.url=e,this.meta=r,this.json=i};Prefab.prototype.constructor=Prefab,Object.defineProperties(Prefab.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),Prefab.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(!i.ok&&i.uuid!==this.uuid){var r=t.assets.find(i.uuid);if(!r)return!0;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return!0;i.ok=!0}}return!1};var Font=qc.Font=function(t,e,i,r,n){this.key=t,this.url=e,this.meta=n,this.xml=r,this.image=i,this._fontUrl,this._fontFamily=qc.UIText.SYSTEMFONT};Font.prototype.constructor=Font,Object.defineProperties(Font.prototype,{uuid:{get:function(){return this.meta.uuid}},xSpacing:{get:function(){return this.meta.xSpacing}},ySpacing:{get:function(){return this.meta.ySpacing}}}),Font.prototype.unload=function(t){t.assets._cache.removeBitmapData(this.key),t.assets._cache.removeBitmapFont(this.key)};var SoundAsset=qc.SoundAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.sound=i};SoundAsset.prototype.constructor=SoundAsset,Object.defineProperties(SoundAsset.prototype,{uuid:{get:function(){return this.meta.uuid}}}),SoundAsset.prototype.unload=function(t){window.__wx&&this.sound.destroy(),t.assets._cache.removeSound(this.key)};var TextAsset=qc.TextAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.text=i};TextAsset.prototype.constructor=TextAsset,Object.defineProperties(TextAsset.prototype,{uuid:{get:function(){return this.meta.uuid}}}),TextAsset.prototype.unload=function(t){t.assets._cache.removeText(this.key)};var ExcelAsset=qc.ExcelAsset=function(t,e,i,r){this.key=e,this.url=e,this._meta=r,this._data="string"==typeof i?JSON.parse(i):i,this._sheets={},this._makeSheetData()};ExcelAsset.prototype.constructor=ExcelAsset,Object.defineProperties(ExcelAsset.prototype,{uuid:{get:function(){return this.meta.uuid}},sheetsName:{get:function(){return this._sheets?Object.keys(this._sheets):[]}},sheets:{get:function(){return this._sheets}},meta:{get:function(){return this._meta}}}),ExcelAsset.prototype._makeSheetData=function(){for(var t=this._data?Object.keys(this._data):[],e=0;e<t.length;e++){var i=t[e],r=this._data[i].rows,n=this._data[i].cols,o=this._meta[i]&&this._meta[i].primaryKey||[],s=new qc.ExcelSheet(n,r,o);this._sheets[i]=s}},ExcelAsset.prototype.findSheet=function(t){return this.sheets[t]},ExcelAsset.prototype.unload=function(t){},ExcelAsset._EXCEL_DATE_OFF=-22089888e5,ExcelAsset._TIMEZONE_OFF=60*(new Date).getTimezoneOffset()*1e3,ExcelAsset.parseToDate=function(t){return new Date(ExcelAsset._EXCEL_DATE_OFF+864e5*t+ExcelAsset._TIMEZONE_OFF)};var ExcelSheet=qc.ExcelSheet=function(t,e,i){this._cols=t||[],this._rows=e||[],this._indexes={},this._primaryKey=i,this._buildPrimaryIndex()};ExcelSheet.prototype.constructor=ExcelSheet,Object.defineProperties(ExcelSheet.prototype,{columns:{get:function(){return this._cols}},rows:{get:function(){return this._rows}}}),ExcelSheet.prototype._buildPrimaryIndex=function(){this.addSortIndex("primary",this._primaryKey)},ExcelSheet.prototype.addSortIndex=function(t){var e,i=Array.prototype.slice.call(arguments,1);return e=Array.isArray(i[0])?new qc.ExcelSortSheetIndex(this,i[0]):new qc.ExcelSortSheetIndex(this,i),this._indexes[t]=e,e},ExcelSheet.prototype.addHashIndex=function(t,e,i){var r=new qc.ExcelHashSheetIndex(this,e,i===undefined||i);return this._indexes[t]=r,r},ExcelSheet.prototype.getIndex=function(t){return this._indexes[t]},ExcelSheet.prototype.getPrimary=function(){return this.getIndex("primary")},ExcelSheet.prototype.find=function(t){for(var e=this._rows,i=e.length,r=-1;++r<i;)if(t(e[r]))return r;return-1},ExcelSheet.prototype.findLast=function(t){for(var e=this._rows,i=e.length;i-- >0;)if(t(e[i]))return i;return-1},ExcelSheet.prototype.matches=function(t){for(var e=this._rows,i=e.length,r=-1,n=[];++r<i;)t(e[r])&&n.push(r);return n},ExcelSheet.prototype.parseColumnToData=function(t){for(var e=this._rows,i=e.length,r=-1,n=[];++r<i;)t in e[r]&&(e[r][t]=ExcelAsset.parseToDate(e[r][t]));return n};var ExcelSortSheetIndex=qc.ExcelSortSheetIndex=function(t,e){this.sheet=t,this._keys=e,this._buildIndex()};ExcelSortSheetIndex.prototype={},ExcelSortSheetIndex.prototype.constructor=ExcelSortSheetIndex,Object.defineProperties(ExcelSortSheetIndex.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}}}),ExcelSortSheetIndex.prototype._buildIndex=function(){var t=this,e=this.sheet.columns.slice(0);if(this._keys){for(var i=0;i<this._keys.length;i++){var r=e.indexOf(this._keys[i]);e.splice(r,1)}Array.prototype.unshift.apply(e,this._keys)}t._cols=e,t._rows=this.sheet.rows.slice(0),t._rows.sort(function(i,r){t._rowCompare(e,i,r)})},ExcelSortSheetIndex.prototype.first=function(){var t=arguments.length;if(0===t)return 0;var e=this;return this._dichotomySearchFirst(this._rows,arguments,function(t,i){return e._searchCompare(t,i)})},ExcelSortSheetIndex.prototype.last=function(){var t=arguments.length;if(0===t)return 0;var e=this;return this._dichotomySearchLast(this._rows,arguments,function(t,i){return e._searchCompare(t,i)})},ExcelSortSheetIndex.prototype.matches=function(){var t=arguments.length;if(0===t)return[0,this._rows.length];var e=this,i=this._dichotomySearchFirst(this._rows,arguments,function(t,i){return e._searchCompare(t,i)});if(i<0)return null;var r=this._dichotomySearchFirst(this._rows,arguments,function(t,i){return e._searchCompare(t,i)},i);return[i,r]},ExcelSortSheetIndex.prototype._cellCompare=function(t,e){return t?e?t===e?0:t<e?-1:1:-1:e?1:0},ExcelSortSheetIndex.prototype._searchCompare=function(t,e){if(!e)return 1;for(var i,r=this._cols,n=t.length,o=-1;++o<n;){if(i=this._cellCompare(t[o],e[r[o]]),i>0)return 1;if(i<0)return-1}return 0},ExcelSortSheetIndex.prototype._rowCompare=function(t,e,i,r,n){if(!t)return e?1:0;if(!e)return-1;r=r||0;for(var o,s,a=r+(n||i.length-r),h=r;h<a;h++)if(o=i[h],s=this._cellCompare(t[o],e[o]),0!==s)return s;return 0},ExcelSortSheetIndex.prototype._dichotomySearch=function(t,e,i){for(var r=0,n=t.length-1,o=0,s=0;r<=n;)if(o=Math.floor((r+n)/2),s=i(e,t[o]),s<0)n=o-1;else{if(!(s>0))return o;r=o+1}return-1},ExcelSortSheetIndex.prototype._dichotomySearchFirst=function(t,e,i,r,n){r=r||0,n=n||t.length-1;for(var o=0,s=0;r<n;)o=Math.floor((r+n)/2),s=i(e,t[o]),s<=0?n=o:r=o+1;return 0===i(e,t[r])?r:-1},ExcelSortSheetIndex.prototype._dichotomySearchLast=function(t,e,i,r,n){r=r||0,n=n||t.length-1;for(var o=0,s=0;r<n;)o=Math.ceil((r+n)/2),s=i(e,t[o]),s<0?n=o-1:r=o;return 0===i(e,t[n])?r:-1};var ExcelHashSheetIndex=qc.ExcelHashSheetIndex=function(t,e,i){this._buildIndex(t,e,i)};ExcelHashSheetIndex.prototype={},ExcelHashSheetIndex.prototype.constructor=ExcelHashSheetIndex,Object.defineProperties(ExcelHashSheetIndex.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}},keys:{get:function(){return this._keys}}}),ExcelHashSheetIndex.prototype._buildIndex=function(t,e,i){var r=t.rows;this._rows=r,this._cols=t.columns.slice(0),this._keys=[];for(var n=r.length,o=-1;++o<n;){var s=r[o],a=s[e];i?(this[a]=s,this._keys.push(a)):a in this?this[a].push(s):(this[a]=[s],this._keys.push(a))}};var phaserFileComplete=Phaser.Loader.prototype.fileComplete;Phaser.Loader.prototype.fileComplete=function(t,e){this.game.cache&&phaserFileComplete.call(this,t,e)};var ActionAsset=qc.ActionAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.json=i};ActionAsset.prototype.constructor=ActionAsset,Object.defineProperties(ActionAsset.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),ActionAsset.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(!i.ok&&i.uuid!==this.uuid){var r=t.assets.find(i.uuid);if(!r)return!0;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return!0;i.ok=!0}}return!1};var ActionManagerAsset=qc.ActionManagerAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.json=i};ActionManagerAsset.prototype.constructor=ActionManagerAsset,Object.defineProperties(ActionManagerAsset.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),ActionManagerAsset.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(!i.ok&&i.uuid!==this.uuid){var r=t.assets.find(i.uuid);if(!r)return!0;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return!0;i.ok=!0}}return!1};var Math2=qc.Math=function(t){this.phaserMath=Phaser.Math,this.arrayUtils=Phaser.ArrayUtils,this.phaserRnd=t},id;Math2.prototype={},Math2.prototype.constructor=Math2,Math2.prototype.fuzzyEqual=function(t,e,i){return this.phaserMath.fuzzyEqual(t,e,i)},Math2.prototype.shuffle=function(t){return this.arrayUtils.shuffle(t)},Math2.prototype.fuzzyLessThan=function(t,e,i){return this.phaserMath.fuzzyLessThan(t,e,i)},Math2.prototype.fuzzyGreaterThan=function(t,e,i){return this.phaserMath.fuzzyGreaterThan(t,e,i)},Math2.prototype.fuzzyCeil=function(t,e){return this.phaserMath.fuzzyCeil(t,e)},Math2.prototype.fuzzyFloor=function(t,e){return this.phaserMath.fuzzyFloor(t,e)},Math2.prototype.average=function(){return this.phaserMath.average.apply(null,arguments)},Math2.prototype.shear=function(t){return this.phaserMath.shear(t)},Math2.prototype.snapTo=function(t,e,i){return this.phaserMath.snapTo(t,e,i)},Math2.prototype.snapToFloor=function(t,e,i){return this.phaserMath.snapToFloor(t,e,i)},Math2.prototype.snapToCeil=function(t,e,i){return this.phaserMath.snapToCeil(t,e,i)},Math2.prototype.roundTo=function(t,e,i){return this.phaserMath.roundTo(t,e,i)},Math2.prototype.floorTo=function(t,e,i){return this.phaserMath.floorTo(t,e,i)},Math2.prototype.ceilTo=function(t,e,i){return this.phaserMath.ceilTo(t,e,i)},Math2.prototype.angleBetween=function(t,e,i,r){return this.phaserMath.angleBetween(t,e,i,r)},Math2.prototype.angleBetweenY=function(t,e,i,r){return this.phaserMath.angleBetweenY(t,e,i,r)},Math2.prototype.reverseAngle=function(t){return this.phaserMath.reverseAngle(t)},Math2.prototype.normalizeAngle=function(t){return this.phaserMath.normalizeAngle(t)},Math2.prototype.maxAdd=function(t,e,i){return this.phaserMath.maxAdd(t,e,i)},Math2.prototype.minSub=function(t,e,i){return this.phaserMath.minSub(t,e,i)},Math2.prototype.wrap=function(t,e,i){return e<i?this.phaserMath.wrap(t,e,i):this.phaserMath.wrap(t,i,e)},Math2.prototype.wrapValue=function(t,e,i){return this.phaserMath.wrapValue(t,e,i)},Math2.prototype.isOdd=function(t){return!!this.phaserMath.isOdd(t)},Math2.prototype.isEven=function(t){return!!this.phaserMath.isEven(t)},Math2.prototype.min=function(){return this.phaserMath.min.apply(null,arguments)},Math2.prototype.max=function(){return this.phaserMath.max.apply(null,arguments)},Math2.prototype.wrapAngle=function(t,e){return this.phaserMath.wrapAngle(t,e)},Math2.prototype.linear=function(t,e,i){return this.phaserMath.linear(t,e,i)},Math2.prototype.factorial=function(t){return this.phaserMath.factorial(t)},Math2.prototype.getRandom=function(t,e,i){return Phaser.ArrayUtils.getRandomItem(t,e,i)},Math2.prototype.distance=function(t,e,i,r){return this.phaserMath.distance(t,e,i,r)},Math2.prototype.clamp=function(t,e,i){return this.phaserMath.clamp(t,e,i)},Math2.prototype.within=function(t,e,i){return this.phaserMath.within(t,e,i)},Math2.prototype.sign=function(t){return this.phaserMath.sign(t)},Math2.prototype.degToRad=function(t){return this.phaserMath.degToRad(t)},Math2.prototype.radToDeg=function(t){return this.phaserMath.radToDeg(t)},Math2.prototype.random=function(t,e){return void 0===t||void 0===e?this.phaserRnd.frac():t>e?this.phaserRnd.integerInRange(e,t):this.phaserRnd.integerInRange(t,e)},Math2.prototype.uuid=function(){return this.phaserRnd.uuid()},Math2.prototype.id=(id=1,function(){return++id}),Math2.prototype.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],c=e[8],u=c*s-a*l,p=-c*o+a*h,d=l*o-s*h,f=i*u+r*p+n*d;return f?(f=1/f,t[0]=u*f,t[1]=(-c*r+n*l)*f,t[2]=(a*r-n*s)*f,t[3]=p*f,t[4]=(c*i-n*h)*f,t[5]=(-a*i+n*o)*f,t[6]=d*f,t[7]=(-l*i+r*h)*f,t[8]=(s*i-r*o)*f,t):null},Math2.prototype.multiply=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],c=e[7],u=e[8],p=i[0],d=i[1],f=i[2],g=i[3],y=i[4],m=i[5],_=i[6],v=i[7],x=i[8];return t[0]=p*r+d*s+f*l,t[1]=p*n+d*a+f*c,t[2]=p*o+d*h+f*u,t[3]=g*r+y*s+m*l,t[4]=g*n+y*a+m*c,t[5]=g*o+y*h+m*u,t[6]=_*r+v*s+x*l,t[7]=_*n+v*a+x*c,t[8]=_*o+v*h+x*u,t},Math2.prototype.smoothDamp=function(t,e,i,r,n,o){r=Math.max(1e-4,r);var s=2/r,a=s*o,h=1/(1+a+.48*a*a+.235*a*a*a),l=t-e,c=e,u=n*r;l=this.clamp(l,-u,u),e=t-l;var p=(i+s*l)*o;i=(i-s*p)*h;var d=e+(l+p)*h;return c-t>0&&d>c&&(d=c,i=(d-c)/o),[d,i]},qc.CleanPIXISpriteRetainer=function(t,e){this._frameCount=0,this.game=t},qc.CleanPIXISpriteRetainer.prototype={postRender:function(){if(this._frameCount++,!(this._frameCount<100)){this._frameCount=0;var t=this.game.phaser.renderer;if(t instanceof PIXI.WebGLRenderer)for(var e=t.spriteBatch.sprites,i=t.spriteBatch.currentBatchSize,r=e.length,n=i;n<r;n++)e[n]=null}}},qc.CleanPIXISpriteRetainer.prototype.constructor=qc.CleanPIXISpriteRetainer;var NodePool=qc.NodePool=function(t){this._game=t,this._nodes={},this._nameUuidMap={}};NodePool.prototype={},NodePool.prototype.constructor=NodePool,Object.defineProperties(NodePool.prototype,{game:{get:function(){return this._game}}}),NodePool.prototype.add=function(t,e){this._nodes[t]&&this.game.log.error("uuid {0} already exists",t),this._nodes[t]=e,e.uniqueName&&!this._nameUuidMap[e.uniqueName]&&(this._nameUuidMap[e.uniqueName]=t)},NodePool.prototype.remove=function(t){this._nodes[t]&&(this._nodes[t].uniqueName&&delete this._nameUuidMap[this._nodes[t].uniqueName],delete this._nodes[t])},NodePool.prototype.find=function(t){if(this._nodes[t])return this._nodes[t]},NodePool.prototype.findByName=function(t){var e=this._nameUuidMap[t];if(e)return this._nodes[e]},NodePool.prototype.removeName=function(t){delete this._nameUuidMap[t]},NodePool.prototype.addName=function(t,e){this._nameUuidMap[t]=e};var Behaviour=qc.Behaviour=function(t){this._gameObject=t,this.cookie=0,this._events={},this.__hadUpdateOrRender=!!(this.preUpdate||this.update||this.postUpdate)};Behaviour.prototype.constructor=Behaviour,qc._userScripts={};var defineBehaviour=qc.defineBehaviour=function(t,e,i,r){for(var n=t.split("."),o=window,s=0;s<n.length-1;s++)o[n[s]]||(o[n[s]]={}),o=o[n[s]];var a=n[n.length-1];return e=e||qc.Behaviour,"function"==typeof r&&(r=r.call(this)),r=r||{},o[a]=function(r){e.call(this,r),this.class=t,this.super=e.prototype,"function"==typeof i&&i.call(this)},o[a].prototype=Object.create(e.prototype),o[a].prototype.constructor=o[a],o[a].prototype.getMeta=function(){var t=e.prototype.getMeta.call(this);return mixin(t,r)},o[a].prototype.clazz=t,qc._userScripts[t]=o[a],o[a]};qc.registerBehaviour=function(t,e){for(var i=t.split("."),r=window,n=0;n<i.length-1;n++)r[i[n]]||(r[i[n]]={}),r=r[i[n]];var o=i[i.length-1];r[o]=e;var s=e.prototype.getMeta;e.prototype.getMeta=function(){var t=s.call(this);return mixin(t,this.serializableFields||{})},e.prototype.clazz=t,qc._userScripts[t]=e},Object.defineProperties(Behaviour.prototype,{uuid:{get:function(){return this._uuid},set:function(t){this._uuid=t}},gameObject:{get:function(){return this._gameObject}},name:{get:function(){return this.gameObject.name},set:function(t){this.gameObject.name=t}},key:{get:function(){if(this._key)return this._key;if(this.class){var t=this.class.match(/([^\..]*)$/);t&&(this._key=t[1])}return this._key},set:function(t){this._key&&this.gameObject&&this.gameObject[this._key]&&this.gameObject[this._key].uuid===this.uuid&&delete this.gameObject[this._key],this._key=t,this.gameObject&&!this.gameObject[t]&&(this.gameObject[t]=this)}},enable:{get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this._enable&&this.onEnable?this.onEnable():!this._enable&&this.onDisable&&this.onDisable())}},runInEditor:{get:function(){return!0===this._runInEditor},set:function(t){this._runInEditor=t}},game:{get:function(){
return this.gameObject.game}}}),Behaviour.prototype.addScript=function(t){return this.gameObject.addScript(t)},Behaviour.prototype.getScript=function(t){return this.gameObject.getScript(t)},Behaviour.prototype.getScripts=function(t){return this.gameObject.getScripts(t)},Behaviour.prototype.destroy=function(){for(var t in this.gameObject.removeScript(this),this.onDestroy&&this.onDestroy(),this._events){var e=this._events[t];e&&e[0].remove(e[1],e[2])}this._events=[]},Behaviour.prototype.isEnable=function(){return this._enable},Behaviour.prototype.getMeta=function(){return{uuid:qc.Serializer.STRING,enable:{get:function(t){return t.enable},set:function(t,e){t._enable=e}}}},Behaviour.prototype._restoreInit=function(){this.gameObject._initGetSetField.call(this)},Behaviour.prototype.addListener=function(t,e,i,r){return t.add(e,i,r),this.cookie++,this._events[this.cookie]=[t,e,i],this.cookie},Behaviour.prototype.addListenerOnce=function(t,e,i,r){t.addOnce(e,i,r)},Behaviour.prototype.removeListener=function(t){var e=this._events[t];e&&(e[0].remove(e[1],e[2]),delete this._events[t])};var Storage=qc.Storage=function(t){this.game=t,this._data={},this.timerMap={}};Storage.prototype={},Storage.prototype.constructor=Storage,Object.defineProperties(Storage.prototype,{key:{get:function(){return this.game.localStorageID}}}),Storage.prototype.restore=function(){},Storage.prototype.save=function(){},Storage.prototype.set=function(t,e){var i=this.key+"_"+t;this._data[i]=e;var r=JSON.stringify(e);window.__wx?wx.setStorage({key:i,data:r}):window.localStorage.setItem(i,r)},Storage.prototype.delaySet=function(t,e,i){if(!this.timerMap[t]){var r=this.key+"_"+t;this._data[r]=e;var n=this;this.timerMap[t]=this.game.timer.add(i,function(){delete n.timerMap[t],n.set(t,e)})}},Storage.prototype.del=function(t){var e=this.key+"_"+t;this._data[e]&&delete this._data[e],window.__wx?wx.removeStorageSync(e):window.localStorage.removeItem(e)},Storage.prototype.get=function(t){var e,i,r=this.key+"_"+t;return this._data[r]?this._data[r]:(e=window.__wx?wx.getStorageSync(r):window.localStorage.getItem(r),e&&(i=JSON.parse(e),this._data[r]=i),i)};var Node=qc.Node=function(t,e,i){var r=this;r.game=t.game._qc,r.phaser=t,t._qc=this,r.uuid=i||r.game.math.uuid(),r._uniqueName="",r._interactive=!1,r._draggable=!1,r._children=null,r._prefab="",r.scripts=[],r.scriptMap={},r.static=!1,r._localZOrder=0,r.hitArea=undefined,this.cookie=0,r._events=[];var n=t.destroy;t.destroy=function(){if(!r._destroy)if(this.maybeOutWorld&&this.maybeOutWorld(),r===r.game.world)n.call(t,!0,!0),r._dispatchModelChangeEvent("destroy",r);else{r.onDestroy(),n.call(t);for(var e=r.scripts.length;e--;)r.scripts[e].destroy();r.scripts=[],r.scriptMap={},r._dispatchModelChangeEvent("destroy",r),r._destroy=!0}},e!==this&&(e||this.game.world).addChild(this),this._defaultTransform()};Node.prototype.constructor=Node,Object.defineProperties(Node.prototype,{uuid:{get:function(){return this._uuid},set:function(t){this._uuid&&this.game.nodePool.remove(this.uuid),this._uuid=t,this.game.nodePool.add(this.uuid,this)}},name:{get:function(){return this.phaser.name},set:function(t){t=t||"",t=t.replace(/\//g,""),this.phaser.name=t,this._dispatchModelChangeEvent("name",this)}},uniqueName:{get:function(){return this._uniqueName},set:function(t){this._uniqueName&&this.game.nodePool.removeName(this._uniqueName),this._uniqueName=t,this._uniqueName&&!this.game.nodePool.findByName(this._uniqueName)&&this.game.nodePool.addName(this._uniqueName,this.uuid)}},ignoreDestroy:{get:function(){return this.parent===this.game.world&&this.phaser.ignoreDestroy},set:function(t){this.parent===this.game.world?this.phaser.ignoreDestroy=t:(this.phaser.ignoreDestroy=!1,t&&this.game.log.error("Only Root Node can set: ignoreDestroy=true"))}},alpha:{get:function(){return this.phaser.alpha},set:function(t){this.phaser.alpha=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ALPHA)}},visible:{get:function(){return this.phaser.visible},set:function(t){this.phaser.visible!==t&&(t&&this._toDestroy||(this.phaser.visible=t,this._isTransformDirty=!0,this._dispatchLayoutArgumentChanged("size"),this.phaser.displayChanged(t?qc.DisplayChangeStatus.SHOW:qc.DisplayChangeStatus.HIDE),this._notifyVisibleChanged(t)))}},parent:{get:function(){var t=this.phaser.parent;return t?t._qc:null},set:function(t){t?t.addChild(this):this.parent instanceof Node&&this.parent.removeChild(this)}},worldVisible:{get:function(){return this.phaser&&this.phaser.worldVisible}},mask:{get:function(){return this.phaser.mask},set:function(t){this.phaser.mask=t}},children:{get:function(){if(!this._children){this._children=[];for(var t=this.phaser.children,e=0,i=t.length;e<i;e++){var r=t[e]._qc;r&&this._children.push(r)}}return this._children}},localZOrder:{get:function(){return this._localZOrder},set:function(t){this._localZOrder=t,this.parent&&(this.parent._orderDirty=!0)}},colorTint:{get:function(){return new Color(this.phaser.tint)},set:function(t){if(t=t||new Color(16777215),!(t instanceof Color))return console.error(t),void this.game.log.error("Expected qc.Color");this.phaser.tint=t.toNumber(),this.phaser.displayChanged(qc.DisplayChangeStatus.TINT)}},onChildrenChanged:{get:function(){return this._onChildrenChanged||(this._onChildrenChanged=new Phaser.Signal)}}}),Node.prototype.preUpdate=function(){if(this._orderDirty&&(this._orderDirty=undefined,this.phaser&&"function"==typeof this.phaser.updateZ)){var t=this.getChildren();t.sort(function(t,e){var i=(t._localZOrder||0)-(e._localZOrder||0);return 0===i?t.phaser.z-e.phaser.z:i});for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i];e.push(n.phaser)}this.phaser.children=e,this.phaser.updateZ(),this._children=null}},Node.prototype.isVisible=function(){return this.phaser.visible},Node.prototype.isWorldVisible=function(){var t=this;do{if(!t.phaser.visible)return!1;t=t.parent}while(t);return!0},Node.prototype.addScript=function(t,e){var i=t;if("string"==typeof t&&(i=qc.Util.findClass(t)),"function"==typeof i){var r=new i(this);if(r instanceof qc.Behaviour)return r.uuid=this.game.math.uuid(),r._clazz=t,r.class=t,this[r.key]=r,this.scripts.push(r),this.scriptMap[t]=r,(e||e===undefined)&&(!r.awake||!0===this.game.device.editor&&!0!==r.runInEditor||r.awake()),r._enable===undefined&&!1!==e&&(!0===this.game.device.editor&&!0!==r.runInEditor?r._enable=!0:r.enable=!0),r;this.game.log.error("Must inherit from qc.Behaviour")}else this.game.log.error("Class:{0} not exists",t)},Node.prototype.removeScript=function(t){var e=this.scripts.indexOf(t);e>-1&&this.scripts.splice(e,1),delete this.scriptMap[t.class],this[t._key]&&this[t._key].uuid===t.uuid&&delete this[t._key],this.__json&&this.__json[t.uuid]&&delete this.__json[t.uuid]},Node.prototype.getScript=function(t,e){var i=t;if("string"!=typeof t&&(t=i.prototype.clazz),this.scriptMap[t])return this.scriptMap[t];if("string"==typeof t&&(i=qc.Util.findClass(t)),!i)return this.game.log.error("Class:{0} not exists",t),null;if(1===arguments.length||e){for(var r in this.scripts)if(this.scripts[r]instanceof i)return this.scripts[r]}else for(var r in this.scripts)if(this.scripts[r].class===i.prototype.clazz)return this.scripts[r]},Node.prototype.getScripts=function(t,e){var i=t;"string"==typeof t&&(i=qc.Util.findClass(t));var r=[];if(!i)return this.game.log.error("Class:{0} not exists",t),r;if(1===arguments.length||e)for(var n in this.scripts)this.scripts[n]instanceof i&&r.push(this.scripts[n]);else for(var n in this.scripts)this.scripts[n].class===i.prototype.clazz&&r.push(this.scripts[n]);return r},Node.prototype.isDescendantOf=function(t){for(var e=this.parent;e;){if(t===e)return!0;e=e.parent}return!1},Node.prototype.getChildren=function(){var t=this._children;return t||(t=this.children),t},Node.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},Node.prototype.addChildAt=function(t,e){if(t.parent!==this){if(!(t instanceof Node))throw new Error("Expected qc.Node");if(t===this)throw new Error("The child is myself");if(this.isDescendantOf(t))throw new Error("child is my parent");var i=t.parent;return i instanceof Node&&(i._children=null),this.phaser.addAt?this.phaser.addAt(t.phaser,e):this.phaser.addChildAt(t.phaser,e),this._orderDirty=!0,this._dispatchModelChangeEvent("parent",t),t._callChildrenFunc("onAddToWorld"),t}},Node.prototype.swapChildren=function(t,e){this.phaser.swapChildren(t.phaser,e.phaser),this._dispatchModelChangeEvent("parent",t),this._dispatchModelChangeEvent("parent",e)},Node.prototype.getChildIndex=function(t){return this.children.indexOf(t)},Node.prototype.setChildIndex=function(t,e){if(t.parent===this){var i=this.phaser.children,r=i.indexOf(t.phaser);r!==e&&(i.splice(r,1),i.splice(e,0,t.phaser),this.phaser.updateZ&&this.phaser.updateZ(),t.phaser.displayChanged(qc.DisplayChangeStatus.ORDER),this._dispatchModelChangeEvent("parent",t),this._dispatchChildrenChanged("order",[t]))}},Node.prototype.getChildAt=function(t){return this.children[t]},Node.prototype.removeChild=function(t){return this.phaser.remove?this.phaser.remove(t.phaser):this.phaser.removeChild(t.phaser),this._children=null,this._dispatchModelChangeEvent("parent",t),t._callChildrenFunc("onRemoveFromWorld"),t},Node.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.removeChild(e)},Node.prototype.removeChildren=function(){var t=this.children;this.phaser.removeAll?this.phaser.removeAll():this.phaser.removeChildren(),this._dispatchModelChangeEvent("removeChildren",this),t.forEach(function(t){t&&t._callChildrenFunc("onRemoveFromWorld")})},Node.prototype.onDestroy=function(){this.parent=null,this.game.nodePool.remove(this.uuid)},Node.prototype.destroy=function(){this._toDestroy||(this._toDestroy=!0,this.visible=!1,this.game.world.addToDestroy(this))},Node.prototype.destroyImmediately=function(){if(!this._destroy&&!this._destroying){for(var t in this._events){var e=this._events[t];e&&e[0].remove(e[1],e[2])}this._events=[],this.visible=!1,this._destroying=!0,this.phaser&&this.phaser.destroy(),this._destroying=!1}},Node.prototype.find=function(t){if(""===t||"."===t||"./"===t)return this;for(var e=t.split("/"),i=this,r=0;r<e.length-1;r++){var n=e[r];if(""!==n)if(".."!==n){if(i=i._findByName(e[r]),!i)return i}else if(i=this.parent,i===this.game.stage)return null}n=e[e.length-1];return""===n||"."===n?i:".."===n?i.parent===this.game.stage?null:i.parent:i._findByName(n)},Node.prototype._findByName=function(t){var e=this.children;for(var i in e)if(e[i].name===t)return e[i]},Node.prototype._dispatchModelChangeEvent=function(t,e){"name"!==t&&(this._children=null);var i=this.game.world;i.onModelChange.dispatch({type:t,target:e})},Node.prototype._sendMessage=function(t,e){if(this.scripts)for(var i=this.scripts.length,r=Array.prototype.slice.call(arguments,2),n=0;n<i;n++){var o=this.scripts[n];if(o&&o.enable){var s=o[t];if(!s)continue;var a=s.apply(o,r);if(!0===e&&!0===a)return!0}}},Node.prototype._broadcast=function(t){if(this.scripts){for(var e=this.scripts.length,i=Array.prototype.slice.call(arguments,1);e--;){var r=this.scripts[e];if(r&&r.enable&&(!0!==this.game.device.editor||!0===r.runInEditor)){if(this._toDestroy||this._destroy)return;var n=r[t];n&&n.apply(r,i)}}var o=this._children;o||(o=this.getChildren());var s=o.length;for(e=0;e<s;e++)o[e][t](i)}},Node.prototype._dispatchChildrenChanged=function(t,e){for(var i=this,r={source:this,type:t,children:e};i;)i._onChildrenChanged&&i._onChildrenChanged.dispatch(r),i=i.parent},Node.prototype._notifyVisibleChanged=function(t){this.onVisibleChange&&this.onVisibleChange();var e=this._children;e||(e=this.children);for(var i=e.length;i--;)e[i].visible&&e[i]._notifyVisibleChanged(t)},Node.prototype._notifyCacheChanged=function(t){this.cacheEnable=t;var e=this._children;e||(e=this.children);for(var i=e.length;i--;)e[i]._notifyCacheChanged(t)},Node.prototype._callChildrenFunc=function(t){var e=this[t];e&&e.apply(this,arguments);var i=this._children;i||(i=this.children);for(var r=i.length;r--;){var n=i[r];n&&(e=n[t],e&&e.apply(n,arguments))}},Node.prototype.addListener=function(t,e,i,r){return t.add(e,i,r),this.cookie++,this._events[this.cookie]=[t,e,i],this.cookie},Node.prototype.addListenerOnce=function(t,e,i,r){t.addOnce(e,i,r)},Node.prototype.removeListener=function(t){var e=this._events[t];e&&(e[0].remove(e[1],e[2]),delete this._events[t])},Object.defineProperties(Node.prototype,{x:{get:function(){return this.phaser.x},set:function(t){this.x!==t&&(this.minAnchor.x<this.maxAnchor.x&&(this._left=this.left+(t-this.x),this._right=this.right-(t-this.x)),this.phaser.x=t,this._calcAnchoredX(),this.phaser.displayChanged(qc.DisplayChangeStatus.OFFSET),this._isTransformDirty=!0)}},y:{get:function(){return this.phaser.y},set:function(t){this.y!==t&&(this.minAnchor.y<this.maxAnchor.y&&(this._top=this.top+(t-this.y),this._bottom=this.bottom-(t-this.y)),this.phaser.y=t,this._calcAnchoredY(),this.phaser.displayChanged(qc.DisplayChangeStatus.OFFSET),this._isTransformDirty=!0)}},anchoredX:{get:function(){return this._anchoredX===undefined&&this._calcAnchoredX(),this._anchoredX},set:function(t){t!==this.anchoredX&&(this._anchoredX=t,this._calcX(),this._isTransformDirty=!0)}},anchoredY:{get:function(){return this._anchoredY===undefined&&this._calcAnchoredY(),this._anchoredY},set:function(t){t!==this.anchoredY&&(this._anchoredY=t,this._calcY(),this._isTransformDirty=!0)}},scaleX:{get:function(){return this.phaser.scale.x},set:function(t){t!==this.scaleX&&(this.phaser.scale.x=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SCALE),this._isTransformDirty=!0)}},scaleY:{get:function(){return this.phaser.scale.y},set:function(t){t!==this.scaleY&&(this.phaser.scale.y=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SCALE),this._isTransformDirty=!0)}},pivotX:{get:function(){return this.phaser.anchor||(this.phaser.anchor=new qc.Point(.5,.5)),this.phaser.anchor.x},set:function(t){this.phaser.anchor||(this.phaser.anchor=new qc.Point(.5,.5)),this.phaser.anchor.x!==t&&(this.phaser.anchor.x=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this.relayout())}},pivotY:{get:function(){return this.phaser.anchor||(this.phaser.anchor=new qc.Point(.5,.5)),this.phaser.anchor.y},set:function(t){this.phaser.anchor||(this.phaser.anchor=new qc.Point(.5,.5)),this.phaser.anchor.y!==t&&(this.phaser.anchor.y=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this.relayout())}},rotation:{get:function(){return this.phaser.rotation},set:function(t){this.phaser.rotation!==t&&(this.phaser.rotation=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX!==t&&(this._skewX=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY!==t&&(this._skewY=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},width:{get:function(){return this._width=this._width||0},set:function(t){if(!this.game.math.fuzzyEqual(this._width,t,.001)){if(this.minAnchor.x<this.maxAnchor.x){var e=t-this.width,i=e*this.pivotX,r=e-i;this._left-=i,this._right-=r}else this.setWidth(t);this.relayout()}}},height:{get:function(){return this._height=this._height?this._height:0},set:function(t){if(!this.game.math.fuzzyEqual(this._height,t,.001)){if(this.minAnchor.y<this.maxAnchor.y){var e=t-this.height,i=e*this.pivotY,r=e-i;this._top-=i,this._bottom-=r}else this.setHeight(t);this.relayout()}}},minAnchor:{get:function(){return this._minAnchor||(this._minAnchor=new qc.Point(0,0)),this._minAnchor},set:function(t){throw new Error("user function:setAnchor")}},maxAnchor:{get:function(){return this._maxAnchor||(this._maxAnchor=new qc.Point(0,0)),this._maxAnchor},set:function(t){throw new Error("use function:setAnchor")}},left:{get:function(){return this._left===undefined&&(this._left=0),this._left},set:function(t){this._left!==t&&(this._left=t,this.relayout())}},right:{get:function(){return this._right===undefined&&(this._right=0),this._right},set:function(t){this._right!==t&&(this._right=t,this.relayout())}},top:{get:function(){return this._top===undefined&&(this._top=0),this._top},set:function(t){this._top!==t&&(this._top=t,this.relayout())}},bottom:{get:function(){return this._bottom===undefined&&(this._bottom=0),this._bottom},set:function(t){this._bottom!==t&&(this._bottom=t,this.relayout())}},rect:{get:function(){var t=this.width,e=this.height;return new qc.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,t,e)}},worldTransform:{get:function(){return this.nodeUpdateTransform(),this.phaser.worldTransform}},localBounds:{get:function(){return this.phaser.getLocalBounds()}},_isTransformDirty:{get:function(){return!this.phaser._isNotNeedCalcTransform},set:function(t){this.phaser._isNotNeedCalcTransform!==!t&&(this.phaser._isNotNeedCalcTransform=!t)}},onLayoutArgumentChanged:{get:function(){return this._onLayoutArgumentChanged||(this._onLayoutArgumentChanged=new Phaser.Signal)}},onRelayout:{get:function(){return this._onRelayout||(this._onRelayout=new Phaser.Signal)}},onTransformChanged:{get:function(){return this.phaser._onTransformChanged||(this.phaser._onTransformChanged=new Phaser.Signal)}}}),Node.prototype.setStretch=function(t,e,i,r){var n=!1;this.minAnchor.x>=this.maxAnchor.x?this._anchoredX!==t&&(this._anchoredX=t,n=!0):(t!==undefined&&this._left!==t&&(this._left=t,n=!0),e!==undefined&&this._right!==e&&(this._right=e,n=!0)),this.minAnchor.y>=this.maxAnchor.y?this._anchoredY!==i&&(this._anchoredY=i,n=!0):(i!==undefined&&this._top!==i&&(this._top=i,n=!0),r!==undefined&&this._bottom!==r&&(this._bottom=r,n=!0)),n&&this.relayout()},Node.prototype.setAnchor=function(t,e,i){if(i=i===undefined||i,t=t||this.minAnchor,e=e||this.maxAnchor,t.x<0&&(t.x=0),t.y<0&&(t.y=0),t.x>1&&(t.x=1),t.y>1&&(t.y=1),e.x<0&&(e.x=0),e.y<0&&(e.y=0),e.x>1&&(e.x=1),e.y>1&&(e.y=1),t.x>e.x||t.y>e.y)throw new Error("Expected:min < max");t.x===this.minAnchor.x&&t.y===this.minAnchor.y&&e.x===this.maxAnchor.x&&e.y===this.maxAnchor.y||(this._minAnchor=t,this._maxAnchor=e,i?(this._calcAnchoredX(),this._calcAnchoredY(),this._calcMargin()):this.relayout())},Node.prototype.relayout=function(){var t=this.parent.rect;if(this.minAnchor.x<this.maxAnchor.x){var e=t.x+t.width*this.minAnchor.x+this.left,i=t.x+t.width*this.maxAnchor.x-this.right,r=i-e;this.setWidth(r),this.phaser.x=e+r*this.pivotX,this._calcAnchoredX()}else this.phaser.x=t.x+t.width*this.minAnchor.x+this.anchoredX;if(this.minAnchor.y<this.maxAnchor.y){var n=t.y+t.height*this.minAnchor.y+this.top,o=t.y+t.height*this.maxAnchor.y-this.bottom,s=o-n;this.setHeight(s),this.phaser.y=n+s*this.pivotY,this._calcAnchoredY()}else this.phaser.y=t.y+t.height*this.minAnchor.y+this.anchoredY;this._isTransformDirty=!0;for(var a=this.children,h=0;h<a.length;h++)a[h].relayout();this._calcWorldCorners(!0),this._dispatchLayoutArgumentChanged("size"),this._lastRectInfo=new qc.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),this._onRelayout&&this._onRelayout.dispatch()},Node.prototype.setWidth=function(t){this._width=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE)},Node.prototype.setHeight=function(t){this._height=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE)},Node.prototype._defaultTransform=function(){this.parent&&this.parent!==this.game.stage&&(this.x=0,this.y=0,this.width=100,this.height=100)},Node.prototype._calcMargin=function(){var t=this.parent.rect;if(this.minAnchor.x>=this.maxAnchor.x)this._left=this._right=0;else{var e=this.x-this.pivotX*this.width,i=t.x+t.width*this.minAnchor.x;this._left=e-i;var r=t.x+t.width*this.maxAnchor.x;this._right=r-(e+this.width)}if(this.minAnchor.y>=this.maxAnchor.y)this._top=this._bottom=0;else{var n=this.y-this.pivotY*this.height,o=t.y+t.height*this.minAnchor.y;this._top=n-o;var s=t.y+t.height*this.maxAnchor.y;this._bottom=s-(n+this.height)}},Node.prototype._calcAnchoredX=function(){var t=this.parent.rect;this._anchoredX=this.x-(t.width*this.minAnchor.x+t.x)},Node.prototype._calcAnchoredY=function(){var t=this.parent.rect;this._anchoredY=this.y-(t.height*this.minAnchor.y+t.y)},Node.prototype._calcX=function(){var t=this.parent.rect;this.x=this._anchoredX+(t.width*this.minAnchor.x+t.x)},Node.prototype._calcY=function(){var t=this.parent.rect;this.y=this._anchoredY+(t.height*this.minAnchor.y+t.y)},Node.prototype.toLocal=function(t){return this.worldTransform.applyInverse(t)},Node.prototype.toGlobal=function(t){return this.worldTransform.apply(t)},Node.prototype.nodeUpdateTransform=function(){var t=!1;return this.parent&&this.parent.nodeUpdateTransform&&(t=this.parent.nodeUpdateTransform()),this._isTransformDirty?(t||this.phaser.updateTransform(),!0):t},Node.prototype.getWorldPosition=function(){var t=this.worldTransform;return new qc.Point(t.tx,t.ty)},Node.prototype.getWorldScale=function(){var t=this.worldTransform,e=Math.atan2(t.b,t.a),i=Math.atan2(-t.c,t.d);t.b/t.a==-t.c/t.d&&i!==e&&(e=Math.atan(t.b/t.a),i=Math.atan(-t.c/t.d));var r=e===Math.PI||0===e||0===t.b&&0!==t.a?t.a/Math.cos(e):t.b/Math.sin(e),n=i===Math.PI||0===i||0===t.c&&0!==t.d?t.d/Math.cos(i):-t.c/Math.sin(i);return new qc.Point(r,n)},Node.prototype.getWorldSkew=function(){var t=this.worldTransform;return t.b/t.a==-t.c/t.d?new qc.Point(0,0):new qc.Point(Math.atan2(-t.c,t.d),Math.atan2(t.b,t.a))},Node.prototype.getWorldRotation=function(){if(this.worldRotationTmp!=undefined)return this.worldRotationTmp;var t=this.worldTransform;return t.b/t.a!=-t.c/t.d?0:Math.atan2(t.b,t.a)},Node.prototype.setTransformToWorld=function(t,e,i,r,n){this.setTransformTo(this.game.world,t,e,i,r,n)},Node.prototype.setTransformTo=function(t,e,i,r,n,o){e=e||0,i=i||0,r=r||1,n=n||1,o=o||0;var s=0,a=0;arguments.length>6&&"number"==typeof arguments[6]&&(s=arguments[6]),arguments.length>7&&"number"==typeof arguments[7]&&(a=arguments[7]);var h=Math.cos(s),l=Math.sin(s),c=Math.cos(a),u=Math.sin(a),p=Math.cos(o),d=Math.sin(o),f=(p*c-d*l)*r,g=(p*u+d*h)*r,y=(-d*c-p*l)*n,m=(-d*u+p*h)*n,_=e,v=i;this.setTransformToWithMatrix(t,f,g,y,m,_,v)},Node.prototype.setTransformToWithMatrix=function(t,e,i,r,n,o,s){var a=[e,i,0,r,n,0,o,s,1];if(t){var h=t&&t.worldTransform||new qc.Matrix,l=h.toArray(!0);this.game.math.multiply(a,l,a)}var c=this.parent&&this.parent.worldTransform||new qc.Matrix,u=c.toArray(!0),p=[];this.game.math.invert(p,u),this.game.math.multiply(p,p,a);e=p[0],i=p[1],r=p[3],n=p[4];if(this.x=p[6],this.y=p[7],i/e!=-r/n){var d=Math.atan2(i,e),f=Math.atan2(-r,n);this.rotation=d,this.scaleX=0===d||0===i&&0!==e?e/Math.cos(d):i/Math.sin(d),this.scaleY=0===f||0===r&&0!==n?n/Math.cos(f):-r/Math.sin(f)}else{var g=this.rotation;this.scaleX=0===g||0===i&&0!==e?e/Math.cos(g):i/Math.sin(g),this.scaleY=0===g||0===r&&0!==n?n/Math.cos(g):-r/Math.sin(g)}this._calcAnchoredX(),this._calcAnchoredY(),this._calcMargin()};var oldAddChildAt=Node.prototype.addChildAt;Node.prototype.addChildAt=function(t,e){oldAddChildAt.call(this,t,e),t._isSwitchParent||t.relayout(),t._isTransformDirty=!0},Node.prototype.switchParent=function(t,e){if(t!==this&&!t.isDescendantOf(this)){var i=this.worldTransform,r=i.a,n=i.b,o=i.c,s=i.d,a=i.tx,h=i.ty;this._isSwitchParent=!0,this.parent=t,delete this._isSwitchParent,e&&this.parent.setChildIndex(this,e),this.setTransformToWithMatrix(null,r,n,o,s,a,h)}},Node.prototype._calcWorldCorners=function(t){if(t||this.nodeUpdateTransform()){var e=this.rect,i=new qc.Point(e.x,e.y),r=new qc.Point(e.x+e.width,e.y),n=new qc.Point(e.x+e.width,e.y+e.height),o=new qc.Point(e.x,e.y+e.height),s=this.phaser.worldTransform;this._worldLeftTop=s.apply(i),this._worldRightTop=s.apply(r),this._worldRightBottom=s.apply(n),this._worldLeftBottom=s.apply(o);var a=Math.min(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x),h=Math.max(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x),l=Math.min(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y),c=Math.max(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y);this._worldBox=new qc.Rectangle(a,l,h-a,c-l)}},Node.prototype.getWorldCorners=function(){return this._calcWorldCorners(!0),[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]},Node.prototype.getCornersIn=function(t){var e=t&&t.phaser.worldTransform;return this._calcWorldCorners(),e?[e.applyInverse(this._worldLeftTop),e.applyInverse(this._worldRightTop),e.applyInverse(this._worldRightBottom),e.applyInverse(this._worldLeftBottom)]:[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]},Node.prototype.getWorldBox=function(){return this._calcWorldCorners(!0),this._worldBox},Node.prototype.getBoxIn=function(t){for(var e=this.getCornersIn(t),i=new qc.Point(-Number.MAX_VALUE,-Number.MAX_VALUE),r=new qc.Point(Number.MAX_VALUE,Number.MAX_VALUE),n=0;n<4;n++){var o=e[n];i.x=Math.max(i.x,o.x),i.y=Math.max(i.y,o.y),r.x=Math.min(r.x,o.x),r.y=Math.min(r.y,o.y)}return new qc.Rectangle(r.x,r.y,i.x-r.x,i.y-r.y)},Node.prototype.rectContains=function(t){var e=this.toLocal(t);return this.rect.contains(e.x,e.y)},Node.prototype._dispatchLayoutArgumentChanged=function(t){this._onLayoutArgumentChanged&&this._onLayoutArgumentChanged.dispatch(t)},Object.defineProperties(Node.prototype,{hitArea:{get:function(){return this.phaser.hitArea===undefined?this.rect:this.phaser.hitArea},set:function(t){this.phaser.hitArea=t}},serializeHitArea:{get:function(){return this.phaser.hitArea},set:function(t){this.phaser.hitArea=t}},onDown:{get:function(){return this._onDown||(this._onDown=new Phaser.Signal),this._onDown}},onUp:{get:function(){return this._onUp||(this._onUp=new Phaser.Signal),this._onUp}},onClick:{get:function(){return this._onClick||(this._onClick=new Phaser.Signal),this._onClick}},onDragStart:{get:function(){return this._onDragStart||(this._onDragStart=new Phaser.Signal),this._onDragStart}},onDrag:{get:function(){return this._onDrag||(this._onDrag=new Phaser.Signal),this._onDrag}},onDragEnd:{get:function(){return this._onDragEnd||(this._onDragEnd=new Phaser.Signal),this._onDragEnd}},onDragDrop:{get:function(){return this._onDragDrop||(this._onDragDrop=new Phaser.Signal),this._onDragDrop}},onWheel:{get:function(){return this._onWheel||(this._onWheel=new Phaser.Signal),this._onWheel}},onEnter:{get:function(){return this._onEnter||(this._onEnter=new Phaser.Signal),this._onEnter}},onExit:{get:function(){return this._onExit||(this._onExit=new Phaser.Signal),this._onExit}},onInteractive:{get:function(){return this._onInteractive||(this._onInteractive=new Phaser.Signal),this._onInteractive}},interactive:{get:function(){return this._interactive},set:function(t){this._interactive=t,this._onInteractive&&this._onInteractive.dispatch()}},passEvent:{get:function(){return this._passEvent},set:function(t){this._passEvent=t}}}),Node.prototype.checkAllowDrop=function(t){for(var e=!1,i=this.scripts.length,r=0;r<i;r++){var n=this.scripts[r];if(n){var o=n.isAllowDrop;if(!o)continue;if(o.call(n,t))return!0;e=!0}}return this.isAllowDrop?this.isAllowDrop(t):!e},Node.prototype.canHandleInputEvent=function(t){if(!this.interactive)return!1;var e=this["_"+t];if(e&&e.getNumListeners()>0)return!0;for(var i=this.scripts.length,r=0;r<i;r++){var n=this.scripts[r];if(n){var o=n[t];if(!o)continue;return!0}}return!1},Node.prototype.getInputEventHandle=function(t,e,i){for(var r,n=Array.isArray(t)?t:[t],o=this,s=this.game.stage,a=[];o&&o!==s;){r=n.length;for(var h=o.phaser.worldTransform.applyInverse({x:e,y:i});r--;)if(o.canHandleInputEvent(n[r])&&o.checkHit(h.x,h.y)){if(a.push(o),!o.passEvent)return a;break}o=o.parent}return a},Node.prototype.getInputEventHandleAndEventType=function(t,e,i){for(var r,n=Array.isArray(t)?t:[t],o=this,s=this.game.stage,a=[];o&&o!==s;){r=n.length;for(var h=o.phaser.worldTransform.applyInverse({x:e,y:i});r--;)if(o.canHandleInputEvent(n[r])&&o.checkHit(h.x,h.y)){if(a.push([o,n[r]]),!o.passEvent)return a;break}o=o.parent}return a},Node.prototype.fireInputEvent=function(t,e){if(!this.interactive||this.state===qc.UIState.DISABLED)return!1;var i=this._sendMessage(t,!0,e);if(!0===i)return!0;var r=this["_"+t];r&&r.getNumListeners()>0&&r.dispatch(this,e)},Node.prototype.checkHit=function(t,e){var i=this;if(i._interactive){var r=i.phaser.hitArea===undefined?this._lastRectInfo:this.phaser.hitArea;return r&&r.contains&&r.contains(t,e)}},Object.defineProperty(Node.prototype,"class",{get:function(){return"qc.Node"}}),Node.prototype.getMeta=function(){var t=qc.Serializer,e=this;return{uuid:{type:t.STRING,get:function(t,e){return t.uuid},set:function(t,i){e.game.serializer.restoreContext[i]=e.uuid}},_prefab:t.STRING,__lock:t.BOOLEAN,name:t.STRING,uniqueName:t.STRING,ignoreDestroy:t.BOOLEAN,alpha:t.NUMBER,visible:t.BOOLEAN,colorTint:t.COLOR,static:t.BOOLEAN,scripts:{get:function(t,i){return e._packScripts.call(t,i)},set:function(t,i){e._unpackScripts.call(t,i)}},position:{get:function(t,e){return[t.pivotX,t.pivotY,t.anchoredX,t.anchoredY,t.x,t.y,t.width,t.height,t.left,t.right,t.top,t.bottom,t.minAnchor.x,t.minAnchor.y,t.maxAnchor.x,t.maxAnchor.y]},set:function(t,e){var i=t;i._minAnchor=new qc.Point(e[12],e[13]),i._maxAnchor=new qc.Point(e[14],e[15]),i.phaser.anchor=new qc.Point(e[0],e[1]),i._anchoredX=e[2],i._anchoredY=e[3],i._minAnchor.x<i._maxAnchor.x?(i._left=e[8],i._right=e[9]):i.setWidth(e[6]),i._minAnchor.y<i._maxAnchor.y?(i._top=e[10],i._bottom=e[11]):i.setHeight(e[7]),i.relayout()}},scaleX:t.NUMBER,scaleY:t.NUMBER,rotation:t.NUMBER,serializeHitArea:t.AUTO,interactive:t.BOOLEAN,isFiltersThrough:t.BOOLEAN,children:{get:function(t,i){return e._packChildren.call(t,i)},set:function(t,i){e._unpackChildren.call(t,i)}}}},Node.prototype._packChildren=function(t){var e=this.children;if(0===e.length)return[];if(this instanceof qc.UIText||this instanceof qc.Sprite)return[];var i=[];for(var r in e){var n=e[r],o=this.game.serializer.buildBundle(n,t);i.push(o)}return i},Node.prototype._unpackChildren=function(t){for(var e in t)this.game.serializer.restoreBundle(t[e],this,!0)},Node.prototype._packScripts=function(t){var e=this.scripts;if(!e||0===e.length)return[];var i=[];for(var r in e){var n=e[r],o=null;"qc.NonexistScript"!==n._clazz?(this.__json&&this.__json[n.uuid]&&(o=this.__json[n.uuid].data),o=this.game.serializer.buildBundle(n,t,o),i.push({clazz:n._clazz,data:n.uuid}),this.__json||(this.__json={}),this.__json[n.uuid]=o):i.push({clazz:n.script,data:n.data.uuid[1]})}return i},Node.prototype._unpackScripts=function(t){for(var e in t){var i=t[e],r=i.data;r="string"==typeof r?this.__json[r].data:r.data;var n=qc.Util.findClass(i.clazz);if("function"==typeof n)try{a=this.addScript(i.clazz,!1);var o={};for(var s in a.getMeta&&(o=a.getMeta()),o)try{this.game.serializer.fromJson(a,r,s,o[s])}catch(t){console.error("Deserialize fail!",t),qc.Util.popupError(t.message)}}catch(t){console.error("Deserialize error!",t),qc.Util.popupError(t.message)}else{if(r&&r.uuid){var a=this.addScript("qc.NonexistScript");a.script=i.clazz,a.data=r}console.error("Class: "+i.clazz+" is not exist!")}}this.game.device.editor||delete this.__json},Node.prototype._findPath=function(t,e){var i="";if(t===this)return i;e===undefined&&(e=!0);var r=this.children;for(var n in r){var o=r[n],s=o._findPath(t,!1);if(""===s)return i+=o.name,i;if(s)return i+=o.name+"/"+s,i}if(!e)return null;var a=this.parent;for(i+="/..";a!==this.game.stage;){s=a._findPath(t,!1);if(""===s)return i;if(s)return i+="/"+s,i;a=a.parent,i+="/.."}return null},Node.prototype._restoreNodeRef=function(){var t={};for(var e in this.getMeta&&(t=this.getMeta()),t){var i="__BUILTIN_NODE__"+e;this[i]&&"string"==typeof this[i]&&(this[e]=this.game.serializer.findNodeRef(this[i]),delete this[i]);var r="__BUILTIN_NODE_ARRAY__"+e;if(this[r]&&"object"==typeof this[r]){var n=[]
;for(var o in this[r])this[r][o]&&this[r][o][1]?n.push(this.game.serializer.findNodeRef(this[r][o][1])):n.push(null);this[e]=n,delete this[r]}}for(var o in this.scripts){var s=this.scripts[o];t={};for(var e in s.getMeta&&(t=s.getMeta()),t){i="__BUILTIN_NODE__"+e;s[i]&&"string"==typeof s[i]&&(s[e]=this.game.serializer.findNodeRef(s[i]),delete s[i]);r="__BUILTIN_NODE_ARRAY__"+e;if(s[r]&&"object"==typeof s[r]){n=[];for(var o in s[r])s[r][o]&&s[r][o][1]?n.push(this.game.serializer.findNodeRef(s[r][o][1])):n.push(null);s[e]=n,delete s[r]}}}var a=this.children;for(var e in a)a[e]._restoreNodeRef()},Node.prototype._restoreInit=function(){for(var t in this._initGetSetField(),this.scripts){var e=this.scripts[t];e._restoreInit&&e._restoreInit()}var i=this.children;for(var r in i)i[r]._restoreInit()},Node.prototype._dispatchAwake=function(){var t=this.children;for(var e in t)t[e]._dispatchAwake();for(var i in this.scripts){var r=this.scripts[i];(!0!==this.game.device.editor||r.runInEditor)&&(r.awake&&r.awake.call(r))}},Node.prototype._dispatchEnable=function(){var t=this.children;for(var e in t)t[e]._dispatchEnable();for(var i in this.scripts){var r=this.scripts[i];(!0!==this.game.device.editor||r.runInEditor)&&(r.enable&&r.onEnable&&r.onEnable())}},Node.prototype._initGetSetField=function(){var t=this.__GET_SET__;if(t){for(var e in t){var i=t[e];this[i]=this["__BUILTIN_SET__"+i],delete this["__BUILTIN_SET__"+i]}delete this.__GET_SET__}};var _CUSTOM_FIELD=function(t,e){return{type:e,get:function(e){return e[t]},set:function(e,i){e["__BUILTIN_SET__"+t]=i,e.__GET_SET__?e.__GET_SET__.push(t):e.__GET_SET__=[t]}}};Node.prototype.generateTexture=function(t,e,i,r,n,o){if(!this.phaser)return new qc.RenderTexture(0,0,renderer,e,t);var s=this.localBounds;s.x+=i||0,s.y+=r||0,isNaN(n)||(s.width=n),isNaN(o)||(s.height=o);var a=new qc.RenderTexture(0|s.width,0|s.height,null,e,t);return PIXI.DisplayObject._tempMatrix.tx=-s.x,PIXI.DisplayObject._tempMatrix.ty=-s.y,a.render(this.phaser,PIXI.DisplayObject._tempMatrix),a},Node._snapTempMatrix=new PIXI.Matrix,Node.prototype._snapshotAsRenderTexture=function(t,e,i,r){if(!this.phaser)return new qc.RenderTexture(0,0);var n=t,o=this.getWorldScale();n||(n=qc.Bounds.getBounds(this)),e=e||n.width*o.x,i=i||n.height*o.y;var s=e/n.width,a=i/n.height;r=r||this.game.resolution,Node._snapTempMatrix.a=s,Node._snapTempMatrix.d=a,Node._snapTempMatrix.tx=-n.x*s,Node._snapTempMatrix.ty=-n.y*a;var h=this.game.phaser,l=new qc.RenderTexture(1,1,h.renderer,h.scale.scaleMode,r);return l.resize(e,i,!0),l.render(this.phaser,Node._snapTempMatrix),l},Node.prototype.snapshotAsImage=function(t,e,i,r,n){var o=this._snapshotAsRenderTexture(t,e,i,r),s=o.getBase64();o.destroy(!0);var a=new Image;return a.src=s,n&&(a.onload=function(){n(a)}),a},Node.prototype.snapshotAsAtlas=function(t,e,i,r,n){var o=this._snapshotAsRenderTexture(e,i,r,n),s=this.game.assets._cache;s.checkImageKey(t)&&s.removeImage(t,!1);var a=qc.AssetUtil.addAtlasFromImage(this.game,t,t,o.getCanvas());return a};var Serializer=qc.Serializer=function(t){this.game=t};Serializer.prototype={},Serializer.prototype.constructor=Serializer,Serializer.customDeserializers={},Serializer.AUTO=0,Serializer.INT=1,Serializer.INTS=2,Serializer.NUMBER=3,Serializer.NUMBERS=4,Serializer.BOOLEAN=5,Serializer.BOOLEANS=6,Serializer.STRING=7,Serializer.STRINGS=8,Serializer.MAPPING=9,Serializer.TEXTURE=10,Serializer.TEXTURES=11,Serializer.AUDIO=12,Serializer.AUDIOS=13,Serializer.COLOR=14,Serializer.COLORS=15,Serializer.PREFAB=16,Serializer.PREFABS=17,Serializer.NODE=18,Serializer.NODES=19,Serializer.SCRIPT=20,Serializer.SCRIPTS=21,Serializer.GEOM=22,Serializer.GEOMS=23,Serializer.POINT=24,Serializer.POINTS=25,Serializer.RECTANGLE=26,Serializer.RECTANGLES=27,Serializer.CIRCLE=28,Serializer.CIRCLES=29,Serializer.ELLIPSE=30,Serializer.ELLIPSES=31,Serializer.FONT=32,Serializer.FONTS=33,Serializer.FILTER=34,Serializer.FILTERS=35,Serializer.TEXTASSET=36,Serializer.TEXTASSETS=37,Serializer.EXCELASSET=38,Serializer.EXCELASSETS=39,Serializer.ACTION=40,Serializer.ACTIONMANAGER=41,Serializer.ANIMATOR=42,Serializer.ANIMATORS=43,Serializer.prototype.buildBundle=function(t,e,i){e.dependences||(e.dependences=[]);var r={};for(var n in t.getMeta&&(r=t.getMeta()),i=i||{},r)this.toJson(t,i,e,n,t[n],r[n]);return{class:t.class,data:i,__json:t.__json}},Serializer.prototype.combineDependence=function(t){var e={};for(var i in t.dependences){var r=t.dependences[i];e[r.uuid]||(e[r.uuid]=r)}return e},Serializer.prototype.restoreBundle=function(t,e,i){i||(this.restoreContext={}),this.isRestoring=!0;var r=t.data.uuid;this.game.nodePool.find(r)&&(r=this.game.math.uuid());var n=this.newNode(t.class,e,r);t.__json&&(n.__json=deepCopy(t.__json));var o={};n.getMeta&&(o=n.getMeta());var s=t.data;for(var a in o)"scripts"!==a&&this.fromJson(n,s,a,o[a]);return o.scripts&&this.fromJson(n,s,"scripts",o.scripts),n.onDeserialized&&n.onDeserialized(),i?n:(n._restoreNodeRef(),n._restoreInit(),n._dispatchAwake(),n._dispatchEnable(),this.restoreContext={},this.isRestoring=!1,n)},Serializer.prototype.restoreState=function(t){var e=[];for(var i in this.restoreContext={},this.isRestoring=!0,t.children){var r=this.restoreBundle(t.children[i],this.game.world,!0);e.push(r)}for(var i in e)e[i]._restoreNodeRef();for(var i in e)e[i]._restoreInit();for(var i in e)e[i]._dispatchAwake();for(var i in e)e[i]._dispatchEnable();this.restoreContext={},this.isRestoring=!1},Serializer.prototype.toJson=function(t,e,i,r,n,o){if(o=o||Serializer.AUTO,"object"!=typeof o||"function"!=typeof o.get||"function"!=typeof o.set)switch(o){case Serializer.AUTO:o=this.getAutoType(n),o===undefined?e[r]=n:this.toJson(t,e,i,r,n,o);break;case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:this._saveCommonType(t,e,i,r,n,o);break;case Serializer.INTS:case Serializer.NUMBERS:case Serializer.STRINGS:case Serializer.BOOLEANS:this._saveCommonArray(t,e,i,r,n,o);break;case Serializer.MAPPING:this._saveMapping(t,e,i,r,n,o);break;case Serializer.COLOR:this.saveColor(t,e,i,r,n);break;case Serializer.COLORS:this._saveArray(t,e,i,r,n,o,this._saveColorItem);break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:this.saveGeom(t,e,i,r,n);break;case Serializer.POINTS:case Serializer.RECTANGLES:case Serializer.CIRCLES:case Serializer.ELLIPSES:this._saveArray(t,e,i,r,n,o,this._saveGeomItem);break;case Serializer.PREFAB:this.savePrefab(t,e,i,r,n);break;case Serializer.PREFABS:this._saveArray(t,e,i,r,n,o,this._savePrefabItem);break;case Serializer.TEXTURE:this.saveTexture(t,e,i,r,n);break;case Serializer.TEXTURES:this._saveArray(t,e,i,r,n,o,this._saveTextureItem);break;case Serializer.AUDIO:this.saveAudio(t,e,i,r,n);break;case Serializer.AUDIOS:this._saveArray(t,e,i,r,n,o,this._saveAudioItem);break;case Serializer.TEXTASSET:this.saveTextAsset(t,e,i,r,n);break;case Serializer.TEXTASSETS:this._saveArray(t,e,i,r,n,o,this._saveTextAssetItem);break;case Serializer.EXCELASSET:this.saveExcelAsset(t,e,i,r,n);break;case Serializer.EXCELASSETS:this._saveArray(t,e,i,r,n,o,this._saveExcelAssetItem);break;case Serializer.FONT:this.saveFont(t,e,i,r,n);break;case Serializer.FONTS:this._saveArray(t,e,i,r,n,o,this._saveFontItem);break;case Serializer.NODE:this.saveNode(t,e,i,r,n);break;case Serializer.NODES:this._saveArray(t,e,i,r,n,o,this._saveNodeItem);break;case Serializer.FILTER:this._saveFilter(t,e,i,r,n);break;case Serializer.FILTERS:this._saveArray(t,e,i,r,n,o,this._saveFilterItem);break;case Serializer.ACTION:this.saveAction(t,e,i,r,n);break;case Serializer.ACTIONMANAGER:this.saveActionManager(t,e,i,r,n);break;case Serializer.ANIMATOR:n instanceof qc.ActionAsset?this.saveAction(t,e,i,r,n):n instanceof qc.ActionManagerAsset&&this.saveActionManager(t,e,i,r,n);break;case Serializer.ANIMATORS:if(n)for(var s in e[r]=[o,[]],n){var a=n[s];a instanceof qc.ActionAsset?e[r][1].push(this._saveActionItem(a,i)):a instanceof qc.ActionManagerAsset&&e[r][1].push(this._saveActionManagerItem(a,i))}break;default:throw new Error("unsupported asset type:"+o)}else e[r]=o.get.call(t,t,i)},Serializer.prototype.fromJson=function(t,e,i,r){if(r=r||Serializer.AUTO,"object"!=typeof r||"function"!=typeof r.get||"function"!=typeof r.set){var n=e[i];if(n!==undefined)if(null!==n&&NaN!==n)switch(n[0]){case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:this._restoreCommonType(t,e,i,n[0]);break;case Serializer.INTS:case Serializer.NUMBERS:case Serializer.STRINGS:case Serializer.BOOLEANS:this._restoreCommonArray(t,e,i,n);break;case Serializer.MAPPING:this._restoreMapping(t,e,i,n);break;case Serializer.COLOR:this.restoreColor(t,e,i,n);break;case Serializer.COLORS:this._restoreArray(t,e,i,n,this._restoreColorItem);break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:this.restoreGeom(t,e,i,n);break;case Serializer.POINTS:case Serializer.RECTANGLES:case Serializer.CIRCLES:case Serializer.ELLIPSES:this._restoreArray(t,e,i,n,this._restoreGeomItem);break;case Serializer.PREFAB:this.restorePrefab(t,e,i,n);break;case Serializer.PREFABS:this._restoreArray(t,e,i,n,this._restorePrefabItem);break;case Serializer.TEXTURE:this.restoreTexture(t,e,i,n);break;case Serializer.TEXTURES:this._restoreArray(t,e,i,n,this._restoreTextureItem);break;case Serializer.EXCELASSET:this.restoreExcelAsset(t,e,i,n);break;case Serializer.EXCELASSETS:this._restoreArray(t,e,i,n,this._restoreExcelAssetItem);break;case Serializer.AUDIO:this.restoreAudio(t,e,i,n);break;case Serializer.AUDIOS:this._restoreArray(t,e,i,n,this._restoreAudioItem);break;case Serializer.TEXTASSET:this.restoreTextAsset(t,e,i,n);break;case Serializer.TEXTASSETS:this._restoreArray(t,e,i,n,this._restoreTextAssetItem);break;case Serializer.FONT:this.restoreFont(t,e,i,n);break;case Serializer.FONTS:this._restoreArray(t,e,i,n,this._restoreFontItem);break;case Serializer.NODE:this.restoreNode(t,e,i,n);break;case Serializer.NODES:this.restoreNodes(t,e,i,n);break;case Serializer.FILTER:this._restoreFilter(t,e,i,n);break;case Serializer.FILTERS:this._restoreArray(t,e,i,n,this._restoreFilterItem);break;case Serializer.ACTION:this.restoreAction(t,e,i,n);break;case Serializer.ACTIONMANAGER:this.restoreActionManager(t,e,i,n);break;case Serializer.ANIMATORS:var o=[];if(n)for(var s in n[1])n[1][s][0]===Serializer.ACTION?o.push(this._restoreActionItem(n[1][s])):n[1][s][0]===Serializer.ACTIONMANAGER&&o.push(this._restoreActionManagerItem(n[1][s]));t[i]=o;break;default:throw new Error("unsupported asset type:"+r)}else t[i]=n}else r.set.call(t,t,e[i])},Serializer.prototype.atob=function(t){return decodeURIComponent(atob(t))},Serializer.prototype.btoa=function(t){return btoa(encodeURIComponent(t))},Serializer.prototype.unpackUTF8=function(t){var e,i,r,n,o=0,s=t.length;for(e="";o<s;)switch(i=t[o++],i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(i);break;case 12:case 13:r=t[o++],e+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=t[o++],n=t[o++],e+=String.fromCharCode((15&i)<<12|(63&r)<<6|(63&n)<<0)}return e},Serializer.prototype.findNodeRef=function(t){var e=this.restoreContext[t]?this.restoreContext[t]:t;return this.game.nodePool.find(e)},Serializer.prototype.saveAudio=function(t,e,i,r,n){e[r]=this._saveAudioItem(n,i)},Serializer.prototype.restoreAudio=function(t,e,i,r){t[i]=this._restoreAudioItem(r)},Serializer.prototype._saveAudioItem=function(t,e){return t instanceof qc.SoundAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[Serializer.AUDIO,t.key,t.uuid]):null},Serializer.prototype._restoreAudioItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e?e instanceof qc.SoundAsset?e:null:(console.error("音频资源尚未载入, 无法反序列化.",t[1]),null)},Serializer.prototype.saveAction=function(t,e,i,r,n){e[r]=this._saveActionItem(n,i)},Serializer.prototype.restoreAction=function(t,e,i,r){t[i]=this._restoreActionItem(r)},Serializer.prototype._saveActionItem=function(t,e){return t instanceof qc.ActionAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[Serializer.ACTION,t.uuid]):null},Serializer.prototype._restoreActionItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof qc.ActionAsset?e:null},Serializer.prototype.saveActionManager=function(t,e,i,r,n){e[r]=this._saveActionManagerItem(n,i)},Serializer.prototype.restoreActionManager=function(t,e,i,r){t[i]=this._restoreActionManagerItem(r)},Serializer.prototype._saveActionManagerItem=function(t,e){return t instanceof qc.ActionManagerAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[Serializer.ACTIONMANAGER,t.uuid]):null},Serializer.prototype._restoreActionManagerItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof qc.ActionManagerAsset?e:null},Serializer.prototype.saveColor=function(t,e,i,r,n){e[r]=this._saveColorItem(n)},Serializer.prototype.restoreColor=function(t,e,i,r){t[i]=this._restoreColorItem(r)},Serializer.prototype._saveColorItem=function(t){return t instanceof Color?[Serializer.COLOR,t.toNumber(!0)]:null},Serializer.prototype._restoreColorItem=function(t){return t?new Color(t[1]):null},Serializer.prototype.saveExcelAsset=function(t,e,i,r,n){e[r]=this._saveExcelAssetItem(n,i)},Serializer.prototype.restoreExcelAsset=function(t,e,i,r){t[i]=this._restoreExcelAssetItem(r)},Serializer.prototype._saveExcelAssetItem=function(t,e){return t instanceof qc.ExcelAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[Serializer.EXCELASSET,t.key,t.uuid]):null},Serializer.prototype._restoreExcelAssetItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e&&e instanceof qc.ExcelAsset?e:null},Serializer.prototype.saveFont=function(t,e,i,r,n){e[r]=this._saveFontItem(n,i)},Serializer.prototype.restoreFont=function(t,e,i,r){t[i]=this._restoreFontItem(r)},Serializer.prototype._saveFontItem=function(t,e){if(t instanceof qc.Font)var i=t;if(i&&i instanceof qc.Font){e.dependences.push({key:i.key,uuid:i.uuid});var r=i.uuid;t=i.key}return[Serializer.FONT,t,r]},Serializer.prototype._restoreFontItem=function(t,e){if(!t)return null;e=e||this;var i=e.game.assets.find(t[1]);return i||(i=e.game.assets.findByUUID(t[2])),i||(i=t[1]),i},Serializer.prototype.isGeom=function(t){return t instanceof qc.Circle||t instanceof qc.Ellipse||t instanceof qc.Line||t instanceof qc.Matrix||t instanceof qc.Polygon||t instanceof qc.Rectangle||t instanceof qc.RoundedRectangle||t instanceof qc.Point},Serializer.prototype.saveGeom=function(t,e,i,r,n){e[r]=this._saveGeomItem(n,i)},Serializer.prototype.restoreGeom=function(t,e,i,r){t[i]=this._restoreGeomItem(r)},Serializer.prototype._saveGeomItem=function(t,e){var i=Serializer.GEOM;return t instanceof qc.Point?i=Serializer.POINT:t instanceof qc.Rectangle?i=Serializer.RECTANGLE:t instanceof qc.Circle?i=Serializer.CIRCLE:t instanceof qc.Ellipse&&(i=Serializer.ELLIPSE),t?[i,t.class,t.toJson()]:null},Serializer.prototype._restoreGeomItem=function(t){if(!t)return null;var e=qc.Util.findClass(t[1]),i=new e;return i.fromJson(t[2]),i},Serializer.prototype.saveNode=function(t,e,i,r,n){e[r]=this._saveNodeItem(n,i)},Serializer.prototype.restoreNode=function(t,e,i,r){t["__BUILTIN_NODE__"+i]=r[1]},Serializer.prototype.restoreNodes=function(t,e,i,r){t["__BUILTIN_NODE_ARRAY__"+i]=r[1]},Serializer.prototype._saveNodeItem=function(t,e){return t instanceof qc.Node?[Serializer.NODE,t.uuid]:null},Serializer.prototype.savePrefab=function(t,e,i,r,n){e[r]=this._savePrefabItem(n,i)},Serializer.prototype.restorePrefab=function(t,e,i,r){t[i]=this._restorePrefabItem(r)},Serializer.prototype._savePrefabItem=function(t,e){return t instanceof Prefab?(e.dependences.push({key:t.uuid,uuid:t.uuid}),[Serializer.PREFAB,t.uuid]):null},Serializer.prototype._restorePrefabItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof Prefab?e:null},Serializer.prototype.saveTexture=function(t,e,i,r,n){e[r]=this._saveTextureItem(n,i)},Serializer.prototype.restoreTexture=function(t,e,i,r){t[i]=this._restoreTextureItem(r)},Serializer.prototype._saveTextureItem=function(t,e){if(!(t instanceof qc.Texture))return null;var i=t.atlas;return e.dependences.push({key:i.key,uuid:i.uuid}),[Serializer.TEXTURE,i.key,i.uuid,t.frame]},Serializer.prototype._restoreTextureItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e?e instanceof qc.Atlas?new qc.Texture(e,t[3]):null:(console.error("贴图资源尚未载入，无法反序列化。",t[1]),null)},Serializer.prototype.saveTextAsset=function(t,e,i,r,n){e[r]=this._saveTextAssetItem(n,i)},Serializer.prototype.restoreTextAsset=function(t,e,i,r){t[i]=this._restoreTextAssetItem(r)},Serializer.prototype._saveTextAssetItem=function(t,e){return t instanceof qc.TextAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[Serializer.TEXTASSET,t.key,t.uuid]):null},Serializer.prototype._restoreTextAssetItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e?e instanceof qc.TextAsset?e:null:(console.error("文本资源尚未载入, 无法反序列化.",t[1]),null)},Serializer.registerCustomDeserializer=function(t,e){var i=Serializer.customDeserializers;i[t]?console.error("Duplicate custom deserializer"):i[t]=e},Serializer.prototype.getAutoType=function(t){if(t===undefined||null===t||NaN===t)return undefined;if("number"==typeof t)return Serializer.NUMBER;if("string"==typeof t)return Serializer.STRING;if("boolean"==typeof t)return Serializer.BOOLEAN;if(t instanceof qc.Node)return Serializer.NODE;if(t instanceof qc.Texture)return Serializer.TEXTURE;if(t instanceof qc.SoundAsset)return Serializer.AUDIO;if(t instanceof qc.TextAsset)return Serializer.TEXTASSET;if(t instanceof qc.ActionAsset)return Serializer.ACTION;if(t instanceof qc.ActionManagerAsset)return Serializer.ACTIONMANAGER;if(this.isGeom(t))return Serializer.GEOM;throw console.error(t),new Error("")},Serializer.prototype.newNode=function(t,e,i){switch(t){case"qc.UIImage":return this.game.add.image(e,i);case"qc.Sprite":return this.game.add.sprite(e,i);case"qc.UIRoot":return new qc.UIRoot(this.game,i);case"qc.Button":return this.game.add.button(e,i);case"qc.Toggle":return new qc.Toggle(this.game,e,i);case"qc.UIText":return this.game.add.text(e,i);case"qc.Sound":return this.game.add.sound(e,i);case"qc.Node":return this.game.add.node(e,i);case"qc.ScrollView":return this.game.add.scrollView(e,i);case"qc.ScrollBar":return this.game.add.scrollBar(e,!1,i);case"qc.InputField":return this.game.add.inputField(e,i);case"qc.ProgressBar":return this.game.add.progressBar(e,!1,i);case"qc.Slider":return this.game.add.slider(e,!1,i);case"qc.Tilemap":return this.game.add.tilemap(e,i);case"qc.TileLayer":return this.game.add.tileLayer(e,i);case"qc.ObjectLayer":return this.game.add.objectLayer(e,i);case"qc.Dom":return this.game.add.dom(e,i);case"qc.Graphics":return this.game.add.graphics(e,i);case"qc.Dropdown":return this.game.add.dropdown(e,i);default:var r=Serializer.customDeserializers[t];if(r)return r(this.game,e,i);throw new Error("unsupported class:"+t)}},Serializer.prototype._saveCommonType=function(t,e,i,r,n,o){e[r]=[o,n]},Serializer.prototype._restoreCommonType=function(t,e,i,r){t[i]=e[i][1]},Serializer.prototype._saveCommonArray=function(t,e,i,r,n,o){if(e[r]=[o,[]],n)for(var s in n)e[r][1].push(n[s])},Serializer.prototype._restoreCommonArray=function(t,e,i,r){var n=[];if(r)for(var o in r[1])n.push(r[1][o]);t[i]=n},Serializer.prototype._saveMapping=function(t,e,i,r,n,o){if(e[r]=[o,{}],n)for(var s in n)e[r][1][s]=n[s]},Serializer.prototype._restoreMapping=function(t,e,i,r){var n={};if(r)for(var o in r[1])n[o]=r[1][o];t[i]=n},Serializer.prototype._saveArray=function(t,e,i,r,n,o,s){if(e[r]=[o,[]],n)for(var a in n){var h=n[a],l=s.call(this,h,i);e[r][1].push(l)}},Serializer.prototype._restoreArray=function(t,e,i,r,n){var o=this,s=[];if(r)for(var a in r[1])s.push(n.call(this,r[1][a],o));t[i]=s};var Camera=qc.Camera=function(t){this.phaser=t,t._qc=this,t.roundPx=!1};Camera.prototype={},Camera.prototype.constructor=Camera,Object.defineProperties(Camera.prototype,{game:{get:function(){return this.phaser.game._qc}},world:{get:function(){return this.phaser.world._qc}},id:{get:function(){return this.phaser.id}},view:{get:function(){return this.phaser.view}},position:{get:function(){return this.phaser.position},set:function(t){this.phaser.position=t}},size:{get:function(){return new qc.Point(this.view.width,this.view.height)},set:function(t){this.setSize(t.x,t.y)}},x:{get:function(){return this.phaser.x},set:function(t){this.phaser.x=t}},y:{get:function(){return this.phaser.y},set:function(t){this.phaser.y=t}},width:{get:function(){return this.phaser.width},set:function(t){this.phaser.width=t}},height:{get:function(){return this.phaser.height},set:function(t){this.phaser.height=t}},bounds:{get:function(){return this.phaser.bounds},set:function(t){this.phaser.bounds=t}},visible:{get:function(){return this.phaser.visible},set:function(t){this.phaser.visible=t}},target:{get:function(){return this.phaser.target}}}),Camera.FOLLOW_LOCKON=Phaser.Camera.FOLLOW_LOCKON,Camera.FOLLOW_PLATFORMER=Phaser.Camera.FOLLOW_PLATFORMER,Camera.FOLLOW_TOPDOWN=Phaser.Camera.FOLLOW_TOPDOWN,Camera.FOLLOW_TOPDOWN_TIGHT=Phaser.Camera.FOLLOW_TOPDOWN_TIGHT,Camera.prototype.follow=function(t,e){null===t?this.phaser.unfollow():this.phaser.follow(t,e)},Camera.prototype.focusOn=function(t,e){this.phaser.focusOnXY(t,e)},Camera.prototype.reset=function(){this.phaser.reset()};var Game=qc.Game=function(t,e,i,r,n,o,s,a){var h,l=this;l.onStart=new qc.Signal,l.log=new qc.Log(l),l._debug=new qc.Debug(l),l._device=new qc.Device(l,Phaser.Device),h="object"==typeof arguments[0]&&1===arguments.length?arguments[0]:{width:t,height:e,parent:i,state:r,transparent:n,physicsConfig:a},l.debug.on=h.debug,l.device.editor=h.editor,h.width>0&&h.height>0?l.fixedGameSize={width:h.width,height:h.height}:l.fixedGameSize=null,l.remoteLogUrl=h.remoteLogUrl,r=h.state,r=r||{preload:function(){},create:function(){}};var c=r.init;if(r.init=function(){var t=l.phaser;window.qc_game=l,l._nodePool=new qc.NodePool(l),new qc.SceneManager(t.state),new qc.PluginManager(t.plugins),t.math._qc=new qc.Math(t.rnd),l.timer=new qc.Timer(l),l.time=new qc.Time(l),l.sound=new qc.SoundManager(l),l._assets=new qc.Assets(l,t.load,t.cache),new qc.Stage(t.stage),new qc.Camera(t.camera),new qc.World(t.world),new qc.Input(t.input),l.dirtyRectangle=new qc.DirtyRectangle(t),t.renderer.dirtyRectangle=l.dirtyRectangle,l.dirtyRectangle.enable=h.dirtyRectangles,l.dirtyRectangle.showDirtyRegion=h.dirtyRectanglesShow,l.canvas.style.outline=0,l.container&&l.container.style&&l.container.style.setProperty&&l.container.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null),l.plugins.add(qc.dragonBonesDriver),l.plugins.add(qc.CleanPIXISpriteRetainer),l._serializer=new qc.Serializer(l),l._storage=new qc.Storage(l),l.phaser.scale.pageAlignHorizontally=!0,l.phaser.scale.pageAlignVertically=!0,l.phaser.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,l.phaser.scale.onSizeChange.add(function(){l.device.resetOrientation()}),l.device.resetOrientation(),l._debug.remoteLogUrl=h.remoteLogUrl,c&&c.call(r),window.qc.initGame&&window.qc.initGame(l),l.onStart.dispatch()},h.state=r,h.renderer=null==h.renderer?Phaser.AUTO:h.renderer,!("antialias"in h)){var u;switch(h.renderer){case Phaser.HEADLESS:case Phaser.CANVAS:u=!1;break;case Phaser.AUTO:var p=function(){try{if(window.__wx)return!0;var t=document.createElement("canvas");return t.screencanvas=!1,!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}();u=!!p;default:u=!0}h.antialias=u}if(h.disableVisibilityChange=h.runInBackground,h.disableVisibilityChange=null==h.disableVisibilityChange||h.disableVisibilityChange,!h.resolution){var d=window.devicePixelRatio;"number"==typeof h.resolutionRatio?h.resolution=1+Math.max(0,(d-1)*h.resolutionRatio):l.device.desktop?h.resolution=d:h.resolution=1+Math.max(0,(d-1)/4)}var f=h.backgroundColor;null==f&&(f=Color.background),f instanceof Color&&(f=f.toNumber()),h.backgroundColor=f,l.phaser=new Phaser.Game(h),l.phaser._qc=this,this.phaser._calcTransformCount=0,l.phaser.forceSingleUpdate=!0,l.add=new GameObjectFactory(l)};Object.defineProperties(Game.prototype,{id:{get:function(){return this.phaser.id}},config:{get:function(){return this.phaser.config},set:function(t){this.phaser.config=t}},physicsConfig:{get:function(){return this.phaser.physicsConfig},set:function(t){this.phaser.physicsConfig=t}},parent:{get:function(){return this.phaser.parent}},width:{get:function(){return this.phaser.width}},height:{get:function(){return this.phaser.height}},resolution:{get:function(){return this.phaser.resolution}},transparent:{get:function(){return this.phaser.renderer.transparent},set:function(t){this.phaser.renderer.transparent=t}},antialias:{get:function(){return this.phaser.antialias},set:function(t){var e=this.phaser;if(e.antialias!==t){for(var i in e.antialias=t,e.stage.smoothed=t,PIXI.BaseTextureCache)PIXI.BaseTextureCache[i].scaleMode=t?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST,this.phaser.renderType===Phaser.WEBGL&&PIXI.BaseTextureCache[i].dirty();this.dirtyRectangle.forceDirty=!0}}},isBooted:{get:function(){return this.phaser.isBooted}},isRunning:{get:function(){return this.phaser.isRunning}},camera:{get:function(){return this.phaser.camera._qc}},canvas:{get:function(){return this.phaser.canvas}},onPause:{get:function(){return this.phaser.onPause}},onResume:{get:function(){return this.phaser.onResume}},onBlur:{get:function(){return this.phaser.onBlur}},onFocus:{get:function(){return this.phaser.onFocus}},state:{get:function(){return this.phaser.state._qc}},scene:{get:function(){return this.phaser.state._qc}},stage:{get:function(){return this.phaser.stage._qc}},container:{get:function(){return this.phaser.canvas.parentNode}},input:{get:function(){return this.phaser.input._qc}},plugins:{get:function(){return this.phaser.plugins._qc}},math:{get:function(){return this.phaser.math._qc}},assets:{get:function(){return this._assets}},world:{get:function(){return this.phaser.world?this.phaser.world._qc:null}},serializer:{get:function(){return this._serializer}},nodePool:{get:function(){return this._nodePool}},storage:{get:function(){return this._storage}},paused:{get:function(){return this.phaser.paused},set:function(t){this.phaser.paused=t}},stepCount:{get:function(){return this.phaser.stepCount}},stepping:{get:function(){return this.phaser.stepping}},device:{get:function(){return this._device}},debug:{get:function(){return this._debug}}}),Game.prototype.shutdown=function(){this.input.enable=!1,this.state.clearWorld(!0),this.assets.clear(),this.phaser.destroy()},Game.prototype.enableStep=function(){this.phaser.enableStep()},Game.prototype.disableStep=function(){this.phaser.disableStep()},Game.prototype.step=function(){this.phaser.step()},Game.prototype.updateScale=function(t){var e=this.phaser.scale;e&&(e._lastUpdate=0,t&&e.preUpdate())},Game.prototype.fullScreen=function(){var t,e,i=this;i._adjustToFullScreen||(i._adjustToFullScreen=function(r){if(!i.isBooted||!i.input.inputting){var n=document.documentElement.clientWidth||window.innerWidth;window.innerWidth&&window.innerWidth<n&&(n=window.innerWidth);var o=document.documentElement.clientHeight||window.innerHeight;window.innerHeight&&window.innerHeight<o&&(o=window.innerHeight),(t!==n||e!==o||r)&&(t=n,e=o,i.device.iOS?(i.setGameSize(n-5,o+5),i.phaser.time.events.add(1,function(){i.setGameSize(n,o)})):i.setGameSize(n,o),i.container&&i.container.style&&(i.container.style.width=n+"px",i.container.style.height=o+"px"),i.updateScale(),i.device.phaser.UCBrowser&&(window.scrollTo(0,1),setTimeout(function(){var t=document.createElement("div");t.style.position="absolute",t.style.top=o+"px",t.style.width="100px",t.style.height="100px",document.body.appendChild(t),window.scrollTo(0,o),setTimeout(function(){window.scrollTo(0,1),document.body.removeChild(t)},10)},10)))}},window.addEventListener("orientationchange",i.updateGameLayout.bind(i,!1),!1),window.addEventListener("resize",i.updateGameLayout.bind(i,!1),!1),window.scrollTo(0,1),i._adjustToFullScreen())},Game.prototype.setGameSize=function(t,e){this.fixedGameSize||this.phaser.scale.setGameSize(t,e),this.updateScale()},Game.prototype.updateGameLayout=function(t){this._adjustToFullScreen&&this._adjustToFullScreen(t),this.world.updateDomRoot()},Game.prototype.update=function(t){var e=this.phaser;if(this.time){t=this.time.now;(!this._lastUpdateGameSizeTime||t-this._lastUpdateGameSizeTime>1e3)&&(this._lastUpdateGameSizeTime=t,this.updateGameLayout())}e._calcTransformCount=0,e.time.update(t);var i=1/e.time.desiredFps;try{if(e._kickstart)return this.updateLogic(i),e._calcTransformCount=0,e.stage.updateTransform(),this.updateRender(e.time.slowMotion*e.time.desiredFps),void(e._kickstart=!1);if(!(e._spiraling>1)||e.forceSingleUpdate){var r=1e3*e.time.slowMotion/e.time.desiredFps;e._deltaTime+=Math.max(Math.min(3*r,e.time.elapsed),0);var n=0;e.updatesThisFrame=Math.floor(e._deltaTime/r),e.forceSingleUpdate&&(e.updatesThisFrame=Math.min(1,e.updatesThisFrame));for(var o=!1;e._deltaTime>=r&&(e._deltaTime-=r,e.currentUpdateID=n,o||this._paused||this.pendingStep||(o=!0),o&&(e.updateFrameDelta(),this.updateLogic(i),e._calcTransformCount=0,e.stage.updateTransform()),n++,!e.forceSingleUpdate||1!==n););return n>e._lastCount?e._spiraling++:n<e._lastCount&&(e._spiraling=0),e._lastCount=n,o&&this.updateRender(e._deltaTime/r),o}e.time.time>e._nextFpsNotification&&(e._nextFpsNotification=e.time.time+1e4,e.fpsProblemNotifier.dispatch()),e._deltaTime=0,e._spiraling=0,e.updateRender(e.time.slowMotion*e.time.desiredFps)}catch(t){this.log.error("{0}",t)}},Game.prototype.updateLogic=function(t){var e=Date.now(),i=this.phaser;if(i._paused||i.pendingStep)i.scale.pauseUpdate(),i.state.pauseUpdate(),i.debug.preUpdate();else{this.timer&&this.timer.update(this.time.now),i.stepping&&(i.pendingStep=!0);var r=Date.now();i.scale.preUpdate(),i.debug.preUpdate(),i.world.camera.preUpdate(),i.state.preUpdate(t),i.plugins.preUpdate(t),i.stage.preUpdate(),i.physics.preUpdate(),this.debug.preUpdate+=Date.now()-r,r=Date.now(),i.input.update(),i.state.update(),i.stage.update(),i.tweens.update(t),i.sound.update(),i.physics.update(),i.plugins.update(),this.debug.update+=this.time.now-r,r=Date.now(),i.stage.postUpdate(),i.plugins.postUpdate(),this.debug.postUpdate+=Date.now()-r,r=Date.now()}this.debug.logic+=Date.now()-e},Game.prototype.updateRender=function(t){var e=Date.now(),i=this.phaser;i.lockRender||(i.state.preRender(t),i.renderer.render(i.stage),i.plugins.render(t),i.state.render(t),i.plugins.postRender(t),qc.CanvasPool.postRender(),this.debug.render+=Date.now()-e)},Phaser.Game.prototype.gamePaused=function(t){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},Phaser.Game.prototype.gameResumed=function(t){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))};var phaserGameParseConfig=Phaser.Game.prototype.parseConfig;Phaser.Game.prototype.parseConfig=function(t){phaserGameParseConfig.call(this,t),"antialias"in t&&(this.antialias=!!t.antialias)};var phaser_updateSetTimeout=Phaser.RequestAnimationFrame.prototype.updateSetTimeout;Phaser.RequestAnimationFrame.prototype.updateSetTimeout=function(){try{phaser_updateSetTimeout.call(this)}catch(t){this.game._qc.log.error("Error：{0}",t)}};var phaser_updateRAF=Phaser.RequestAnimationFrame.prototype.updateRAF;Phaser.RequestAnimationFrame.prototype.updateRAF=function(t){try{phaser_updateRAF.call(this,t)}catch(t){
this.game._qc.log.error("Error：{0}",t)}},Phaser.Game.prototype.updateFrameDelta=function(t){var e=this,i=e.time,r=i.time,n=e.__lastFrameTime?r-e.__lastFrameTime:t;e.__lastFrameTime=r,i.frameDeltaTime=n/i.slowMotion,i._totalEscapeTime=i.frameDeltaTime+(i._totalEscapeTime||0)};var Plugin=qc.Plugin=Phaser.Plugin,PluginManager=qc.PluginManager=function(t){t._qc=this,this.phaser=t};PluginManager.prototype={},PluginManager.prototype.constructor=PluginManager,Object.defineProperties(PluginManager.prototype,{game:{get:function(){return this.phaser.game._qc}},plugins:{get:function(){return this.phaser.plugins}}}),PluginManager.prototype.add=function(t){t=this.phaser.add.apply(this.phaser,arguments);return t.game=this.game,t},PluginManager.prototype.remove=function(t){this.phaser.remove(t)},PluginManager.prototype.removeAll=function(){this.phaser.removeAll()},PluginManager.prototype.destroy=function(){this.phaser.destroy(),delete this.phaser},qc.Signal=Phaser.Signal,qc.SignalBinding=Phaser.SignalBinding;var Stage=qc.Stage=function(t){this.phaser=t,t._qc=this};Stage.prototype={},Stage.prototype.constructor=Stage,Object.defineProperties(Stage.prototype,{game:{get:function(){return this.phaser.game._qc}},name:{get:function(){return this.phaser.name},set:function(t){this.phaser.name=t}},runInBackground:{get:function(){return this.phaser.disableVisibilityChange},set:function(t){this.phaser.disableVisibilityChange=t}},useLanguages:{get:function(){return this.phaser.useLanguages},set:function(t){this.phaser.useLanguages=t}},backgroundColor:{get:function(){return new Color(this.phaser.backgroundColor)},set:function(t){if(t=t||Color.background,!(t instanceof Color))throw new Error("Expected qc.Color");this.phaser.backgroundColor=t.toNumber()}},x:{get:function(){return 0}},y:{get:function(){return 0}},rect:{get:function(){return new qc.Rectangle(0,0,this.game.width,this.game.height)}},pivotX:{get:function(){return 0},set:function(t){throw new Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(t){throw new Error("pivotY cannot be modified")}},worldTransform:{get:function(){return this.phaser.worldTransform}}}),Stage.prototype.updateTransform=function(){this.phaser.updateTransform()},Stage.prototype.destroy=function(){this.phaser.destroy(),delete this.phaser};var State=qc.State=function(){var t=new Phaser.State;this.phaser=t,t._qc=this};State.prototype={},State.prototype.constructor=State,Object.defineProperties(State.prototype,{game:{get:function(){return this.phaser.game}},key:{get:function(){return this.phaser.key},set:function(t){this.phaser.key=t}},add:{get:function(){return this.phaser.add._qc},set:function(t){this.phaser.add=t.phaser,t.phaser._qc=t}},make:{get:function(){return this.phaser.make._qc},set:function(t){this.phaser.make=t.phaser,t.phaser._qc=t}},camera:{get:function(){return this.phaser.camera._qc},set:function(t){this.phaser.camera=t.phaser,t.phaser._qc=t}},assets:{get:function(){return this._assets},set:function(t){this._assets=t}},input:{get:function(){return this.phaser.input._qc},set:function(t){this.phaser.input=t.phaser,t.phaser._qc=t}},math:{get:function(){return this.phaser.math._qc},set:function(t){this.phaser.math=t.phaser,t.phaser._qc=t}},time:{get:function(){return this.phaser.time._qc},set:function(t){this.phaser.time=t.phaser,t.phaser._qc=t}},tweens:{get:function(){return this.phaser.tweens._qc},set:function(t){this.phaser.tweens=t.phaser,t.phaser._qc=t}},world:{get:function(){return this.phaser.world?this.phaser.world._qc:null},set:function(t){this.phaser.world=t.phaser,t.phaser._qc=t}},physics:{get:function(){return this.phaser.physics._qc},set:function(t){this.phaser.physics=t.phaser,t.phaser._qc=t}}});var SceneManager=qc.SceneManager=function(t){t._qc=this,this.phaser=t,this._onPreload=new qc.Signal,this._onCreate=new qc.Signal,this.onStartLoad=new qc.Signal,this.onEndLoad=new qc.Signal};SceneManager.prototype={},SceneManager.prototype.constructor=SceneManager,Object.defineProperties(SceneManager.prototype,{game:{get:function(){return this.phaser.game._qc}},entry:{get:function(){return this._entry},set:function(t){this._entry=t}},list:{get:function(){return this._list},set:function(t){this._list=t;var e=this;for(var i in t){var r=t[i],n={preload:function(){e._onPreload.dispatch();var t=e.game.assets.find(e.current+".bin");if(t)for(var i in t.dependences){var r=t.dependences[i];e.game.assets.loadByUUID(r.uuid,function(t){t||(e.game.log.important("场景的依赖资源({0})加载失败.",r.uuid),"function"==typeof e.game.loadingProcessCallback&&e.game.loadingProcessCallback(r.key))})}},create:function(){try{e._parse()}catch(t){e.game.log.error("Parse scene fail：{0}",t),qc.Util.popupError(t.message)}e.loading=!1,e._onCreate.dispatch(),e.onEndLoad.dispatch(n)}};this.phaser.add(r,n,!1)}}},loading:{get:function(){return this._loading||!1},set:function(t){this._loading=t}},current:{get:function(){return this.phaser.current}}}),SceneManager.prototype.download=function(t,e){t=t||this.entry;var i=t+".bin";this.game.log.trace("Start downloading scene:{0}",t),this.game.assets.beginBatchLoad(),this.game.assets.load(i,i,e),this.game.assets.endBatchLoad()},SceneManager.prototype.load=function(t,e,i,r){var n=this;n.loading?console.warn("Cannot call when switching scene."):(t=t||n.entry,/\//.test(t)||(t="Assets/scene/"+t),n.list.indexOf(t)<0?n.game.log.error("Scene:{0} not exists",t):(n.loading=!0,n.onStartLoad.dispatch(t),n.clearWorld(),!0!==e&&(e=!1),e&&n.game.assets.clear(),n.download(t,function(o){"function"==typeof i&&n._onPreload.addOnce(i),"function"==typeof r&&n._onCreate.addOnce(r),n.phaser.start(t,!1,e)})))},SceneManager.prototype.clearWorld=function(t){var e=this.game.world.children.slice(0);e.forEach(function(e){!t&&e.ignoreDestroy||e.destroy()})},SceneManager.prototype.destroy=function(){this.entry=undefined,this.list=[],this.phaser.destroy()},SceneManager.prototype._parse=function(){var t=this.current+".bin",e=this.game.assets.find(t);if(e){var i=e.json.data;this.game.serializer.restoreState(i),this.game.world._prefab=t}else this.game.log.error("Can not find scene {0} from assets",state)};var World=qc.World=function(t){var e=this;if(e.onModelChange=new qc.Signal,qc.Node.call(e,t,e),e.name="world",e.onSizeChange.add(function(){e.relayout()}),e._toDestroyQ=[],window.__wx)return e.backDomRoot=null,void(e.frontDomRoot=null);e.game.container.style.overflow="hidden",e.backDomRoot=document.createElement("div"),e.backDomRoot.style.position="absolute",e.backDomRoot.style.left="0px",e.backDomRoot.style.top="0px",e.backDomRoot.style.overflow="hidden",e.game.container.insertBefore(e.backDomRoot,e.game.canvas),e.frontDomRoot=document.createElement("div"),e.frontDomRoot.style.position="absolute",e.frontDomRoot.style.left="0px",e.frontDomRoot.style.top="0px",e.frontDomRoot.style.overflow="hidden",e.game.container.appendChild(e.frontDomRoot)};World.prototype=Object.create(qc.Node.prototype),World.prototype.constructor=World,World.prototype.getMeta=function(){qc.Serializer;var t=qc.Node.prototype.getMeta.call(this);return delete t.uuid,t},World.prototype.relayout=function(){for(var t=this.children,e=0;e<t.length;e++)t[e].relayout()},Object.defineProperties(World.prototype,{bounds:{get:function(){return this.phaser.bounds},set:function(t){this.phaser.setBounds(t.x,t.y,t.width,t.height)}},camera:{get:function(){return this.phaser.camera}},width:{get:function(){return this._editorWidth!==undefined?this._editorWidth:this.phaser.width},set:function(t){this.width!==t&&(this.phaser.width=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE),Object.getOwnPropertyDescriptor(qc.Node.prototype,"width").set.call(this,t))}},height:{get:function(){return this._editorHeight!==undefined?this._editorHeight:this.phaser.height},set:function(t){this.height!==t&&(this.phaser.height=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE),Object.getOwnPropertyDescriptor(qc.Node.prototype,"height").set.call(this,t))}},centerX:{get:function(){return this.phaser.centerX}},centerY:{get:function(){return this.phaser.centerY}},pivotX:{get:function(){return 0},set:function(t){throw new Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(t){throw new Error("pivotY cannot be modified")}},onSizeChange:{get:function(){return this.game.phaser.scale.onSizeChange}}}),World.prototype.preUpdate=function(){this._toDestroyQ.forEach(function(t){t.destroyImmediately()}),this._toDestroyQ.length=0},World.prototype.addToDestroy=function(t){this._toDestroyQ.push(t)},World.prototype.updateDomRoot=function(){if(!(window.__wx||this.game.isBooted&&this.game.input.inputting)){var t=this.frontDomRoot.style,e=this.backDomRoot.style,i=this.game.canvas.style;t.width=e.width=i.width,t.height=e.height=i.height,t.marginLeft=e.marginLeft=i.marginLeft,t.marginTop=e.marginTop=i.marginTop,t.marginRight=e.marginRight=i.marginRight,t.marginBottom=e.marginBottom=i.marginBottom}};var Input=qc.Input=function(t){var e=this;t._qc=e;var i=t.destroy;t.destroy=function(){e.destroy(),i.call(t)};var r=t.update;t.update=function(){e.update(),r.call(t)},e.phaser=t,e.game=t.game._qc,e._inputting=0,e.cursorPosition=new qc.Point(NaN,NaN),e.onKeyDown=new Phaser.Signal,e.onKeyUp=new Phaser.Signal,e.onKeyRepeat=new Phaser.Signal,e.onCursorMove=new Phaser.Signal,e.onWheel=new Phaser.Signal,e.onPointerUp=new Phaser.Signal,e.onPointerDown=new Phaser.Signal,e.onPointerMove=new Phaser.Signal,e.nativeMode=!1,e.keyboard=new qc.Keyboard(this),e.mouse=new qc.Mouse(this),e.touch=new qc.Touch(this),e.module=new qc.BaseInputModule(e.game,e),e._init()};Input.prototype={},Input.prototype.constructor=Input,Object.defineProperties(Input.prototype,{wheelDeltaX:{get:function(){return this._wheelDeltaX}},wheelDeltaY:{get:function(){return this._wheelDeltaY}},keyCount:{get:function(){return this.keyboard.keyCount}},keyCodes:{get:function(){return this.keyboard.keyCodes}},mouseCount:{get:function(){return this.mouse.mouseCount}},mouseIds:{get:function(){return this.mouse.mouseIds}},touchCount:{get:function(){return this.touch.touchCount}},touchIds:{get:function(){return this.touch.touchIds}},pointerCount:{get:function(){return this.mouseCount+this.touchCount}},pointers:{get:function(){return this.mouseIds.concat(this.touchIds)}},enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},inputting:{get:function(){return this._inputting>0}}}),Input.prototype._init=function(){var t=this;t.phaser.game.onBlur.add(this._onBlur,this),t.keyboard.onKeyUp.add(this.processKeyUp,this),t.keyboard.onKeyDown.add(this.processKeyDown,this),t.keyboard.onKeyRepeat.add(this.processKeyRepeat,this),t.mouse.onMouseDown.add(this.processPointerDown,this),t.mouse.onMouseUp.add(this.processPointerUp,this),t.mouse.onMousePressMove.add(this.processPointerMove,this),t.mouse.onMouseMove.add(this.processMouseMove,this),t.mouse.onMouseWheel.add(this.processMouseWheel,this),t.touch.onTouchStart.add(this.processPointerDown,this),t.touch.onTouchEnd.add(this.processPointerUp,this),t.touch.onTouchMove.add(this.processPointerMove,this),t.enable=!0},Input.prototype.destroy=function(){this.phaser.game.onBlur.remove(this._onBlur,this),this.keyboard.onKeyUp.remove(this.processKeyUp,this),this.keyboard.onKeyDown.remove(this.processKeyDown,this),this.keyboard.onKeyRepeat.remove(this.processKeyRepeat,this),this.mouse.onMouseDown.remove(this.processPointerDown,this),this.mouse.onMouseUp.remove(this.processPointerUp,this),this.mouse.onMousePressMove.remove(this.processPointerDown,this),this.mouse.onMouseMove.remove(this.processMouseMove,this),this.mouse.onMouseWheel.remove(this.processMouseWheel,this),this.touch.onTouchStart.remove(this.processPointerDown,this),this.touch.onTouchEnd.remove(this.processPointerUp,this),this.touch.onTouchMove.remove(this.processPointerMove,this),this.module&&this.module.destroy(),this.keyboard&&this.keyboard.destroy(),this.mouse&&this.mouse.destroy(),this.touch&&this.touch.destroy(),this.onKeyDown.removeAll(),this.onKeyUp.removeAll(),this.onKeyRepeat.removeAll(),this.onCursorMove.removeAll(),this.onWheel.removeAll(),this.onPointerDown.removeAll(),this.onPointerMove.removeAll(),this.onPointerUp.removeAll(),this.phaser=null,this.module=null,this.keyboard=null,this.mouse=null,this.touch=null},Input.prototype._setEnable=function(t){this._enable!==t&&(this._enable=t,this.touch&&(this.touch.enable=t),this.mouse&&(this.mouse.enable=t),this.keyboard&&(this.keyboard.enable=t))},Input.prototype.update=function(){this._wheelDeltaX=0,this._wheelDeltaY=0,this.keyboard.update(),this.touch.update(),this.mouse.update(),this.module.update()},Input.prototype._onBlur=function(){this.module.lossFocus(),this.keyboard.lossFocus(),this.mouse.lossFocus(),this.touch.lossFocus()},Input.prototype.processKeyDown=function(t,e){this.onKeyDown.dispatch(t,e)},Input.prototype.processKeyUp=function(t,e){this.onKeyUp.dispatch(t,e)},Input.prototype.processKeyRepeat=function(t,e){this.onKeyRepeat.dispatch(t,e)},Input.prototype.isKeyDown=function(t){return this.keyboard.isKeyDown(t)},Input.prototype.isAnyKeyDown=function(){return this.keyboard.isAnyKeyDown()},Input.prototype.isAnyKey=function(){return this.keyboard.isAnyKey()},Input.prototype.isAltDown=function(){return this.isKeyDown(qc.Keyboard.ALT)},Input.prototype.isControlDown=function(){return this.isKeyDown(qc.Keyboard.CONTROL)},Input.prototype.isShiftDown=function(){return this.isKeyDown(qc.Keyboard.SHIFT)},Input.prototype.isMetaDown=function(){return this.isKeyDown(qc.Keyboard.META)||this.isKeyDown(qc.Keyboard.META_RWIN)||this.isKeyDown(qc.Keyboard.META_RMAC)},Input.prototype.hasCursor=function(){return!isNaN(this.cursorPosition.x)&&!isNaN(this.cursorPosition.y)},Input.prototype.isMouse=function(t){return t<0&&t>=qc.Mouse.BUTTON_FORWORD},Input.prototype.isAnyMouse=function(){return this.mouse.isAnyMouse()},Input.prototype.isAnyMouseDown=function(){return this.mouse.isAnyMouseDown()},Input.prototype.isMouseDown=function(t){return this.mouse.isMouseDown(t)},Input.prototype.isAnyTouch=function(){return this.touch.isAnyTouch()},Input.prototype.isAnyTouchStart=function(){return this.touch.isAnyTouchStart()},Input.prototype.isTouchStart=function(t){return this.touch.isTouchStart(t)},Input.prototype.isAnyPointer=function(){return this.touch.isAnyTouch()||this.mouse.isAnyMouse()},Input.prototype.isAnyPointerStart=function(){return this.touch.isAnyTouchStart()||this.mouse.isAnyMouseDown()},Input.prototype.isPointerStart=function(t){return this.isMouse(t)?this.isMouseDown(t):this.isTouchStart(t)},Input.prototype.getPointer=function(t){return t<0&&t>=qc.Mouse.BUTTON_FORWORD?this.mouse.getMouseById(t):this.touch.getTouchById(t)},Input.prototype.processMouseMove=function(t,e){this.cursorPosition.x=t,this.cursorPosition.y=e,this.onCursorMove.dispatch(t,e)},Input.prototype.processMouseWheel=function(t,e){this._wheelDeltaX=t,this._wheelDeltaY=e,this.onWheel.dispatch(t,e)},Input.prototype.processPointerDown=function(t,e,i){this.onPointerDown.dispatch(t,e,i)},Input.prototype.processPointerUp=function(t,e,i){this.onPointerUp.dispatch(t,e,i)},Input.prototype.processPointerMove=function(t,e,i){this.onPointerMove.dispatch(t,e,i)},Input.prototype.ignoreDomEvent=function(t){var e=this,i=e.findDomNodeWithEvent(t);return i&&i.interactive&&i.hitArea},Input.prototype.findDomNodeWithEvent=function(t){var e=this,i=t.target;if(!i||i===e.game.world.frontDomRoot||i===e.game.world.backDomRoot||i===e.game.canvas.parentNode)return null;for(;i&&!i._qc;)i=i.parentNode;return i?i._qc:null};var Debug=qc.Debug=function(t){var e=this;e._game=t,e.on=!1,e.animation=0,e.total=0,e.logic=0,e.render=0,e.preUpdate=0,e.update=0,e.postUpdate=0,e.clientId=0};Debug.prototype={},Debug.prototype.constructor=Debug,Object.defineProperties(Debug.prototype,{game:{get:function(){return this._game}},on:{get:function(){return this._on||!1},set:function(t){this._on=t,t&&(this.game.log.enableTrace=!0)}},remoteLogUrl:{set:function(v){if(this.pollTimer&&(this.game.timer.remove(this.pollTimer),this.pollTimer=null),"string"==typeof v){var self=this;this.pollTimer=this.game.timer.loop(1e3,function(game){if(!self.isPolling){var str=":queryCmd:"+self.clientId;try{self.isPolling=!0,qc.AssetUtil.post(game.remoteLogUrl+"/remoteLog",str,function(res){if(self.isPolling=!1,"200 OK"!==res){var match=res.match(/^id:(.*)/),cmdList;if(match)return self.clientId=match[1],void(document.title="("+match[1]+")"+document.title);try{cmdList=JSON.parse(res)}catch(t){cmdList=[]}for(var i=0;i<cmdList.length;i++)try{var ret;ret=window.__wx?qc.Util.formatString.apply(null,["{0}",cmdList[i]]):eval(cmdList[i]),game.log.remoteReply(ret)}catch(t){game.log.remoteReply(t.stack)}}},function(t){console.log("queryCmd post error."),self.isPolling=!1})}catch(t){self.isPolling=!1}}},null,this.game)}}}});var Device=qc.Device=function(t,e){var i=this;i.phaser=e,i._game=t,i._orientation=Device.PORTRAIT,i.onOrientationChange=new qc.Signal};Device.prototype={},Device.prototype.constructor=Debug,Object.defineProperties(Device.prototype,{game:{get:function(){return this._game}},desktop:{get:function(){return this.phaser.initialized?this.phaser.desktop:(this._isDesktop===undefined&&this.checkOS(),this._isDesktop)}},iOS:{get:function(){return this.phaser.iOS}},android:{get:function(){return this.phaser.android}},webGL:{get:function(){return this.phaser.webGL}},vibration:{get:function(){return this.phaser.vibration}},browser:{get:function(){return this.phaser.chrome?Device.CHROME:this.phaser.arora?Device.ARORA:this.phaser.epiphany?Device.EPIPHANY:this.phaser.firefox?Device.FIREFOX:this.phaser.trident?Device.TRIDENT:this.phaser.ie?Device.IE:this.phaser.mobileSafari?Device.MOBILE_SAFARI:this.phaser.midori?Device.MIDORI:this.phaser.opera?Device.OPERA:this.phaser.safari?Device.SAFARI:this.phaser.silk?Device.SILK:this.phaser.UCBrowser?Device.UCBROWSER:Device.UNKNOW}},resolution:{get:function(){return window.devicePixelRatio}},fullscreen:{get:function(){return this.phaser.fullscreen}},editor:{get:function(){return this._editor||!1},set:function(t){this._editor=t,t&&(this.game.debug.on=!0)}},orientation:{get:function(){return this._orientation},set:function(t){this.orientation!==t&&(this._orientation=t,this.onOrientationChange.dispatch(t))}}}),Device.UNKNOW=-1,Device.CHROME=0,Device.ARORA=1,Device.EPIPHANY=2,Device.FIREFOX=3,Device.IE=4,Device.TRIDENT=5,Device.MOBILE_SAFARI=6,Device.MIDORI=7,Device.OPERA=8,Device.SAFARI=9,Device.WEBAPP=10,Device.SILK=11,Device.UCBROWSER=12,Device.AUTO=0,Device.PORTRAIT=1,Device.LANDSCAPE=2,Device.prototype.resetOrientation=function(){this.game.world.width>this.game.world.height?this.orientation=Device.LANDSCAPE:this.orientation=Device.PORTRAIT},Device.prototype.isCanvasRenderer=function(){return this.game.phaser.renderType===Phaser.CANVAS},Device.prototype.isWebGLRenderer=function(){return this.game.phaser.renderType===Phaser.WEBGL},Device.prototype.checkOS=function(){var t=navigator.userAgent,e={};/Playstation Vita/.test(t)?e.vita=!0:/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?e.kindle=!0:/Android/.test(t)?e.android=!0:/CrOS/.test(t)?e.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?e.iOS=!0:/Linux/.test(t)?e.linux=!0:/Mac OS/.test(t)?e.macOS=!0:/Windows/.test(t)&&(e.windows=!0,/Windows Phone/i.test(t)&&(e.windowsPhone=!0));var i=/Silk/.test(t);this._isDesktop=!1,(e.windows||e.macOS||e.linux&&!i||e.chromeOS)&&(this._isDesktop=!0),(e.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(this._isDesktop=!1)},qc.RenderTexture=PIXI.RenderTexture,qc.RenderTexture.prototype.resize=function(t,e,i){t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=e*this.resolution,i&&(this.baseTexture.width=Math.round(this.width*this.resolution),this.baseTexture.height=Math.round(this.height*this.resolution)),this.renderer.type===PIXI.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(Math.round(this.width*this.resolution),Math.round(this.height*this.resolution)))},qc.RenderTexture.prototype.directRenderWebGL=function(t,e,i){if(this.valid){var r={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=e?e.x:0,this.renderer.offset.y=e?e.y:0;var n=this.renderer.gl;if(n.isContextLost())return!1;if(!n.replace){var o=n.viewport;n.viewport=function(t,e,i,r){(0===i||0===r||i*r<0)&&console.log("viewPort:",t,e,i,r,i*r),o.call(n,t,e,i,r)},n.replace=!0}n.viewport(0,0,this.width*this.resolution,this.height*this.resolution),n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear();var s=n.getError();s&&console.log("webgl gl.getError(",s,")"),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0,this.renderer.offset.x=r.x,this.renderer.offset.y=r.y}},PIXI.RenderTexture.prototype.directRenderCanvas=function(t,e,i){if(this.valid){var r={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=e?e.x:0,this.renderer.offset.y=e?e.y:0,i&&this.textureBuffer.clear();var n=this.textureBuffer.context,o=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,n),this.renderer.resolution=o,this.renderer.offset.x=r.x,this.renderer.offset.y=r.y}},qc.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid){t.game._qc.renderInRenderTexture=!0;var r=t.getWorldTransform();r.identity(),r.translate(0,2*this.projection.y),e&&r.append(e),r.scale(1,-1),t.worldAlpha=1,t._isSubNeedCalcTransform=!0;for(var n=t.children,o=0,s=n.length;o<s;o++)n[o].updateTransform();t.game._qc.renderInRenderTexture=!1;var a=this.renderer.gl;a.viewport(0,0,this.width*this.resolution,this.height*this.resolution),a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0,t._isNotNeedCalcTransform=!1}},PIXI.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid){t.game._qc.renderInRenderTexture=!0;var r=t.worldTransform;r.identity(),e&&r.append(e),t.worldAlpha=1,t._isSubNeedCalcTransform=!0;for(var n=t.children,o=0,s=n.length;o<s;o++)n[o].updateTransform();t.game._qc.renderInRenderTexture=!1,i&&this.textureBuffer.clear();var a=this.textureBuffer.context,h=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,a),this.renderer.resolution=h,t._isNotNeedCalcTransform=!1}};var SoftClipManager=qc.SoftClipManager=function(t){this.renderSession=t,this._polygons=[]};SoftClipManager.prototype={},SoftClipManager.prototype.constructor=SoftClipManager,Object.defineProperties(SoftClipManager.prototype,{needClip:{get:function(){return!!this._polygons.length}}}),SoftClipManager.getManager=function(t){var e=t.softClipManager;return e||(e=t.softClipManager=new SoftClipManager(t)),e},SoftClipManager.prototype.pushPolygon=function(t){var e=this,i=[];if(e.renderSession.spriteBatch.batchType=qc.BATCH_TRIANGLES,e._polygons.length){for(var r=e._polygons[e._polygons.length-1],n=r.length;n--;){var o=r[n];for(s=arguments.length;s--;){t=arguments[s];h=qc.GeometricTool.sutherlandHodgman(t,o);i.push(h)}}e._polygons.push(i)}else{for(var s=arguments.length;s--;){var a=arguments[s],h=qc.GeometricTool.quickDecomp(a);if(h.length)Array.prototype.push.apply(i,h);else for(var l=GeometricTool.Triangulate(a),c=0;c<l.length;c+=3){var u=l[c],p=l[c+1],d=l[c+2];i.push([a[u],a[p],a[d]])}}e._polygons.push(i)}},SoftClipManager.prototype.popPolygon=function(){var t=this;t._polygons.length&&t._polygons.splice(t._polygons.length-1,1),t._polygons.length||(t.renderSession.spriteBatch.batchType=qc.BATCH_QUAD)},SoftClipManager.prototype.getClipPolygon=function(t,e,i,r,n,o){var s=this,a=[],h=s._polygons[s._polygons.length-1],l=h.length,c=1/(t*r+i*-e);t*=c,e*=c,i*=c,r*=c;for(var u=o*i-n*r,p=-o*t+n*e,d=-1;++d<l;){for(var f=h[d],g=[],y=f.length,m=-1;++m<y;){var _=f[m];g.push(new qc.Point(r*_.x-i*_.y+u,t*_.y-e*_.x+p))}a.push(g)}return a},SoftClipManager.prototype.renderSprite=function(t,e,i,r,n,o,s,a,h,l,c,u,p,d,f,g,y){var m=this.getClipPolygon(c,u,p,d,f,g);if(0!==m.length){var _=[new qc.Point(i,r),new qc.Point(n,r),new qc.Point(n,o),new qc.Point(i,o)],v={x:i,y:r,width:n-i,height:o-r};if(v.width&&v.height)for(var x=function(t,e,i,r,n,o){return{x:e+(t.x-o.x)/o.width*(i-e),y:r+(t.y-o.y)/o.height*(n-r)}},T=m.length;T--;){var S=m[T],w=qc.GeometricTool.sutherlandHodgman(S,_),b=w.length;if(!(b<3)){for(var P=[],A=[],C=-1;++C<b;)P[C]=x(w[C],s,h,a,l,v),A.push({x:c*w[C].x+p*w[C].y+f,y:d*w[C].y+u*w[C].x+g});var E=qc.GeometricTool.Triangulate(A);if(E)for(C=0;C<E.length;C+=3){var I=E[C],O=E[C+1],M=E[C+2];this._addWebGLTriangle(t.spriteBatch,e,y,A[I],A[O],A[M],P[I],P[O],P[M])}}}}},SoftClipManager.prototype._addWebGLTriangle=function(t,e,i,r,n,o,s,a,h){t.currentBatchSize>=t.triangleSize&&(t.flush(),t.currentBaseTexture=e.texture.baseTexture);var l=t.colors,c=t.positions,u=3*t.currentBatchSize*t.vertSize;t.renderSession.roundPixels?(c[u]=0|r.x,c[u+1]=0|r.y,c[u+5]=0|n.x,c[u+6]=0|n.y,c[u+10]=0|o.x,c[u+11]=0|o.y):(c[u]=r.x,c[u+1]=r.y,c[u+5]=n.x,c[u+6]=n.y,c[u+10]=o.x,c[u+11]=o.y),c[u+2]=s.x,c[u+3]=s.y,c[u+7]=a.x,c[u+8]=a.y,c[u+12]=h.x,c[u+13]=h.y,l[u+4]=l[u+9]=l[u+14]=i,t.sprites[t.currentBatchSize++]=e};var SoundManager=qc.SoundManager=function(t){this.game=t,this.phaser=t.phaser.sound,this.phaser._qc=this;var e=this;t.onStart.add(function(){e._boot()}),this._soundDurationMap=window.soundDurationMap||{}};SoundManager.prototype.constructor=SoundManager,SoundManager.prototype._boot=function(){var t=this.phaser,e=this.game.input;!window.__wx&&!t.game.device.cocoonJS&&t.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(e.touch.callbackContext=t,t.game.device.iOSVersion>8?e.touch.touchEndCallback=t.unlock:e.touch.touchStartCallback=t.unlock,e.mouse.callbackContext=t,e.mouse.mouseDownCallback=t.unlock,t.touchLocked=!0):t.touchLocked=!1},Object.defineProperties(SoundManager.prototype,{mute:{get:function(){return this.phaser.mute},set:function(t){this.phaser.mute=t}},volume:{get:function(){return this.phaser.volume},set:function(t){this.phaser.volume=t}},usingWebAudio:{get:function(){return this.phaser.usingWebAudio}},usingAudioTag:{get:function(){return this.phaser.usingAudioTag}},mp3Support:{get:function(){return this.game.phaser.device.mp3}},oggSupport:{get:function(){return this.game.phaser.device.ogg||this.game.phaser.device.opus}},webAudioSupport:{get:function(){return this.game.phaser.sound.usingWebAudio}}}),SoundManager.prototype._getAudioTagDurationInConfig=function(t){var e=t.key;return/\.bin$/i.test(e)||(e+=".bin"),this._soundDurationMap[e]||t._sound.duration},SoundManager.prototype.tryGetUrl=function(t){var e=t;return e.indexOf(".mp3.bin")>0?this.mp3Support||(e=e.replace(".mp3.bin",".ogg.bin")):e.indexOf(".ogg.bin")>0&&(this.oggSupport||(e=e.replace(".ogg.bin",".mp3.bin"))),this.webAudioSupport||(e=e.replace(".bin","")),e};var Key=qc.Key=function(t,e){this.game=t,this._keycode=e,this._isDown=!1,this._justDown=!1,this._justUp=!1,this.downTime=0,this.repeats=0,this._lastRepeatTime=0,this._eventList=[]};Key.prototype={},Key.prototype.constructor=Key,Object.defineProperties(Key.prototype,{keyCode:{get:function(){return this._keycode}},currCharCode:{get:function(){return this._charCode},set:function(t){this._charCode=t}},isJustDown:{get:function(){var t=this._justDown;return t&&(this._justDown=!1,this._isDown=!0),t}},isJustUp:{get:function(){var t=this._justUp;return t&&(this._justUp=!1,this._isDown=!1),t}},isDown:{get:function(){return this._isDown}},duringTime:{get:function(){return this.isDown?this.game.time.fixedTime-this.downTime:-1}}}),Key.prototype.destroy=function(){this.game=null},Key.prototype.hasEvent=function(){return!!this._eventList.length},Key.prototype.nextEvent=function(){if(!this._eventList.length)return!1;var t=this._eventList.shift();do{if(!t)break;switch(t.type){case Key.DOWN:this._onDown(t.time);break;case Pointer.UP:this._onUp()}return!0}while(0);return!1},Key.prototype.onDown=function(){return this._eventList.push({type:Key.DOWN,time:this.game.time.fixedTime}),!0},Key.prototype.onUp=function(){return this._eventList.push({type:Key.UP}),!0},Key.prototype._onDown=function(t){return!this.isDown&&!this._justDown&&(this._justDown=!0,this.downTime=t,this._lastRepeatTime=this.downTime,!0)},Key.prototype._onUp=function(){return!(!this._isDown&&!this._justDown||this._justUp)&&(this._justUp=!0,!0)},Key.prototype.setState=function(t){var e=(this._isDown||this._justDown)&&!this._justUp;return this._isDown=t,this._justDown=!1,this._justUp=!1,e^t},Key.prototype.checkRepeat=function(t){if(!this.isDown)return!1;var e=this.game.time.fixedTime;return e-this._lastRepeatTime-t>0&&(this.repeats++,this._lastRepeatTime=e,!0)},Key.UP=-1,Key.DOWN=0;var Pointer=qc.Pointer=function(t,e){this.game=t,this._id=e,this._isDown=!1,this._justDown=!1,this._justUp=!1,this.downTime=0,this.withinGame=!1,this.previousStatus=[],this._eventList=[]};Pointer.prototype={},Pointer.prototype.constructor=Pointer,Object.defineProperties(Pointer.prototype,{id:{get:function(){return this._id}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},startX:{get:function(){return this._startX}},startY:{get:function(){return this._startY}},isMouse:{get:function(){return this._id<qc.Mouse.NONE&&this._id>=qc.Mouse.BUTTON_FORWORD}},isJustDown:{get:function(){var t=this._justDown;return t&&(this._justDown=!1,this._isDown=!0),t}},isJustUp:{get:function(){var t=this._justUp;return t&&(this._justUp=!1,this._isDown=!1),t}},isDown:{get:function(){return this._isDown}},isDowning:{get:function(){return this._justDown}},isUpping:{get:function(){return this._justUp}},deltaX:{get:function(){return this._deltaX}},deltaY:{get:function(){return this._deltaY}},distanceX:{get:function(){return this.x-this.startX}},distanceY:{get:function(){return this.y-this.startY}},deviceId:{get:function(){return this._deviceId||this.id},set:function(t){this._deviceId=t}},eventId:{get:function(){return this._eventId||this.id},set:function(t){this._eventId=t}},duringTime:{get:function(){return this.isDown?this.game.time.fixedTime-this.downTime:-1}}}),Pointer.prototype.destroy=function(){this.game=null},Pointer.prototype.update=function(){this._deltaX=this._tempX-this._x,this._deltaY=this._tempY-this._y,this._x=this._tempX,this._y=this._tempY},Pointer.prototype.hasEvent=function(){return!!this._eventList.length},Pointer.prototype.nextEvent=function(){if(!this._eventList.length)return!1;var t=this._eventList.shift();do{if(!t)break;switch(t.type){case Pointer.DOWN:this.withinGame=!0,this._onDown(t.x,t.y,t.time);break;case Pointer.UP:this._onUp(t.time);break;case Pointer.LEAVE:this.withinGame=!1,this._onMove(t.x,t.y);break;case Pointer.ENTER:this.withinGame=!0,this._onMove(t.x,t.y);break;case Pointer.MOVE:this._onMove(t.x,t.y);break;case Pointer.CANCEL:this._onCancel(t.time)}return!0}while(0);return!1},Pointer.prototype.onDown=function(t,e){return this._eventList.push({type:Pointer.DOWN,x:t,y:e,time:this.game.time.fixedTime}),!0},Pointer.prototype.onMove=function(t,e){var i=this._eventList.length;return i>0&&this._eventList[i-1].type===Pointer.MOVE?(this._eventList[i-1].x=t,this._eventList[i-1].y=e):this._eventList.push({type:Pointer.MOVE,x:t,y:e}),!0},Pointer.prototype.onLeave=function(t,e){return this._eventList.push({type:Pointer.LEAVE,x:t,y:e}),!0},Pointer.prototype.onEnter=function(t,e){return this._eventList.push({type:Pointer.ENTER,x:t,y:e}),!0},Pointer.prototype.onUp=function(){return this._eventList.push({type:Pointer.UP,time:this.game.time.fixedTime}),!0},Pointer.prototype.onCancel=function(){return this._eventList.push({type:Pointer.CANCEL,time:this.game.time.fixedTime}),!0},
Pointer.prototype._onDown=function(t,e,i){return!this.isDown&&!this._justDown&&(this._justDown=!0,this.downTime=i,this._x=t,this._y=e,this._startX=t,this._startY=e,this._tempX=t,this._tempY=e,this._deltaX=0,this._deltaY=0,!0)},Pointer.prototype._onUp=function(t){if(!this._isDown&&!this._justDown||this._justUp)return!1;for(this._justUp=!0,this.previousStatus.unshift({startX:this._startX,startY:this._startY,endX:this.x,endY:this.y,downTime:this.downTime,upTime:t});this.previousStatus.length>10;)this.previousStatus.pop();return!0},Pointer.prototype._onCancel=function(t){return!this._justUp&&(this._onUp(t),!0)},Pointer.prototype._onMove=function(t,e){this._tempX=t,this._tempY=e},Pointer.prototype.isDouble=function(t,e){},Pointer.UP=-1,Pointer.DOWN=0,Pointer.MOVE=1,Pointer.ENTER=2,Pointer.LEAVE=3,Pointer.CANCEL=4;var Keyboard=qc.Keyboard=function(t,e){this.input=t,this.game=t.game,this.repeatInterval=100,this.onKeyDown=new Phaser.Signal,this.onKeyUp=new Phaser.Signal,this.onKeyRepeat=new Phaser.Signal,this._keys=[],this._keyCodes={},this._capture={},this._keyDownNum=0,this._anyKeyDown=!1,this._init(e)};Keyboard.prototype={},Keyboard.prototype.constructor=Keyboard,Object.defineProperties(Keyboard.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||window},set:function(t){if(t!==this._generator){var e=this.enable;this.enable=!1,this._generator=t,e&&(this.enable=!0)}}},gainFocusType:{get:function(){return this._gainFocusType},set:function(t){this._gainFocusType=t}},keyCount:{get:function(){return this._keyDownNum}},keyCodes:{get:function(){return Object.keys(this._keyCodes)}}}),Keyboard.prototype._init=function(t){this._onKeyDown=this._processKeyDown.bind(this),this._onKeyUp=this._processKeyUp.bind(this),this._onBlur=this.lossFocus.bind(this),this._onMouseOver=this._onOver.bind(this),this._onMouseClick=this._onClick.bind(this),this.generator=t,this.gainFocusType=Keyboard.GAINFOCUS_CLICK,this.enable=!0,this.game.device.phaser.windows&&this.game.device.phaser.desktop&&this.addKeyCapture(Keyboard.ALT)},Keyboard.prototype.destroy=function(){this.enable=!1,this.input=null,this.generator=null,this._onKeyDown=null,this._onKeyUp=null,this._onBlur=null,this._onMouseOver=null,this._onMouseClick=null},Keyboard.prototype.update=function(){if(this.enable){this._anyKeyDown=!1;for(var t,e=this._keys.length;e--;)if(t=this._keys[e],t)for(;t.nextEvent();)t.isJustDown&&(this._anyKeyDown=!0,this._recordKey(t.keyCode,!0),this.onKeyDown.dispatch(t.keyCode)),t.isJustUp&&(this._recordKey(t.keyCode,!1),this.onKeyUp.dispatch(t.keyCode)),t.checkRepeat(this.repeatInterval)&&this.onKeyRepeat.dispatch(t._keycode)}},Keyboard.prototype.isKeyDown=function(t){return this._keys[t]&&this._keys[t].isDown},Keyboard.prototype.isAnyKey=function(){return this._keyDownNum>0},Keyboard.prototype.isAnyKeyDown=function(){return this._anyKeyDown},Keyboard.prototype._recordKey=function(t,e){e?(this._keyDownNum++,this._keyCodes[t]=!0):(this._keyDownNum--,delete this._keyCodes[t])},Keyboard.prototype._setEnable=function(t){if(this._enable!==t){this._enable=t;var e=this.generator;t?(e.addEventListener("keydown",this._onKeyDown,!1),e.addEventListener("keyup",this._onKeyUp,!1),e.addEventListener("blur",this._onBlur,!1),this._addFocusAbility(e,!0)):(e.removeEventListener("keydown",this._onKeyDown),e.removeEventListener("keyup",this._onKeyUp),e.removeEventListener("blur",this._onBlur),this._removeFocusAbility(e),this._clearKeys())}},Keyboard.prototype._addFocusAbility=function(t,e){if(t!==window||window.parent&&window.parent!==window){t.tabIndex=t.tabIndex||-1;var i=this;t.addEventListener("mouseover",i._onMouseOver,!1),t.addEventListener("click",i._onMouseClick,!1),this.input.onPointerDown.add(i._onMouseClick,i),e&&setTimeout(function(){i.gainFocus()},1)}},Keyboard.prototype._removeFocusAbility=function(t){(t!==window||window.parent&&window.parent!==window)&&(t.removeEventListener("mouseover",this._onMouseOver),t.removeEventListener("click",this._onMouseClick),this.input.onPointerDown.remove(this._onMouseClick,this))},Keyboard.prototype._prepareKey=function(t){this._keys[t]||(this._keys[t]=new qc.Key(this.game,t))},Keyboard.prototype.setModifierKeysState=function(t,e){t.altKey!==undefined&&(this._setKeyCodeState(Keyboard.ALT,t.altKey,e),this._setKeyCodeState(Keyboard.SHIFT,t.shiftKey,e),this._setKeyCodeState(Keyboard.CONTROL,t.ctrlKey,e),e!=Keyboard.META&&e!=Keyboard.META_RWIN&&e!=Keyboard.META_RMAC&&this._setKeyCodeState(Keyboard.META,t.metaKey,e))},Keyboard.prototype._setKeyCodeState=function(t,e,i){t!==i&&(this._prepareKey(t),this._keys[t].setState(e)&&this._recordKey(t,e))},Keyboard.prototype._processKeyDown=function(t){this._prepareKey(t.keyCode),this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode].onDown(),this._keys[t.keyCode].currCharCode=t.charCode,this.setModifierKeysState(t,t.keyCode),this.update()},Keyboard.prototype._processKeyUp=function(t){this._prepareKey(t.keyCode),this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode].onUp(),this.setModifierKeysState(t,t.keyCode),this.update()},Keyboard.prototype._onOver=function(t){this.gainFocusType===Keyboard.GAINFOCUS_OVER&&this.gainFocus()},Keyboard.prototype._onClick=function(t){this.gainFocusType===Keyboard.GAINFOCUS_CLICK&&this.gainFocus()},Keyboard.prototype.gainFocus=function(t){(this.generator!==window||window.parent&&window.parent!==window)&&this.generator.focus()},Keyboard.prototype._clearKeys=function(){for(;this._keys.length>0;){var t=this._keys.pop();t&&t.destroy()}this._keyDownNum=0,this._keyCodes={}},Keyboard.prototype.lossFocus=function(){this._clearKeys()},Keyboard.prototype.addKeyCapture=function(t){if("object"==typeof t)for(var e in t)this._capture[t[e]]=!0;else this._capture[t]=!0},Keyboard.prototype.removeKeyCapture=function(t){delete this._capture[t]},Keyboard.prototype.clearCapture=function(){this._capture={}},Keyboard.GAINFOCUS_OVER=0,Keyboard.GAINFOCUS_CLICK=1,Keyboard.A="A".charCodeAt(0),Keyboard.B="B".charCodeAt(0),Keyboard.C="C".charCodeAt(0),Keyboard.D="D".charCodeAt(0),Keyboard.E="E".charCodeAt(0),Keyboard.F="F".charCodeAt(0),Keyboard.G="G".charCodeAt(0),Keyboard.H="H".charCodeAt(0),Keyboard.I="I".charCodeAt(0),Keyboard.J="J".charCodeAt(0),Keyboard.K="K".charCodeAt(0),Keyboard.L="L".charCodeAt(0),Keyboard.M="M".charCodeAt(0),Keyboard.N="N".charCodeAt(0),Keyboard.O="O".charCodeAt(0),Keyboard.P="P".charCodeAt(0),Keyboard.Q="Q".charCodeAt(0),Keyboard.R="R".charCodeAt(0),Keyboard.S="S".charCodeAt(0),Keyboard.T="T".charCodeAt(0),Keyboard.U="U".charCodeAt(0),Keyboard.V="V".charCodeAt(0),Keyboard.W="W".charCodeAt(0),Keyboard.X="X".charCodeAt(0),Keyboard.Y="Y".charCodeAt(0),Keyboard.Z="Z".charCodeAt(0),Keyboard.ZERO="0".charCodeAt(0),Keyboard.ONE="1".charCodeAt(0),Keyboard.TWO="2".charCodeAt(0),Keyboard.THREE="3".charCodeAt(0),Keyboard.FOUR="4".charCodeAt(0),Keyboard.FIVE="5".charCodeAt(0),Keyboard.SIX="6".charCodeAt(0),Keyboard.SEVEN="7".charCodeAt(0),Keyboard.EIGHT="8".charCodeAt(0),Keyboard.NINE="9".charCodeAt(0),Keyboard.NUMPAD_0=96,Keyboard.NUMPAD_1=97,Keyboard.NUMPAD_2=98,Keyboard.NUMPAD_3=99,Keyboard.NUMPAD_4=100,Keyboard.NUMPAD_5=101,Keyboard.NUMPAD_6=102,Keyboard.NUMPAD_7=103,Keyboard.NUMPAD_8=104,Keyboard.NUMPAD_9=105,Keyboard.NUMPAD_MULTIPLY=106,Keyboard.NUMPAD_ADD=107,Keyboard.NUMPAD_ENTER=108,Keyboard.NUMPAD_SUBTRACT=109,Keyboard.NUMPAD_DECIMAL=110,Keyboard.NUMPAD_DIVIDE=111,Keyboard.F1=112,Keyboard.F2=113,Keyboard.F3=114,Keyboard.F4=115,Keyboard.F5=116,Keyboard.F6=117,Keyboard.F7=118,Keyboard.F8=119,Keyboard.F9=120,Keyboard.F10=121,Keyboard.F11=122,Keyboard.F12=123,Keyboard.F13=124,Keyboard.F14=125,Keyboard.F15=126,Keyboard.COLON=186,Keyboard.EQUALS=187,Keyboard.UNDERSCORE=189,Keyboard.QUESTION_MARK=191,Keyboard.TILDE=192,Keyboard.OPEN_BRACKET=219,Keyboard.BACKWARD_SLASH=220,Keyboard.CLOSED_BRACKET=221,Keyboard.QUOTES=222,Keyboard.BACKSPACE=8,Keyboard.TAB=9,Keyboard.CLEAR=12,Keyboard.ENTER=13,Keyboard.SHIFT=16,Keyboard.CONTROL=17,Keyboard.ALT=18,Keyboard.META=91,Keyboard.META_RWIN=92,Keyboard.META_RMAC=93,Keyboard.CAPS_LOCK=20,Keyboard.ESC=27,Keyboard.SPACEBAR=32,Keyboard.PAGE_UP=33,Keyboard.PAGE_DOWN=34,Keyboard.END=35,Keyboard.HOME=36,Keyboard.LEFT=37,Keyboard.UP=38,Keyboard.RIGHT=39,Keyboard.DOWN=40,Keyboard.INSERT=45,Keyboard.DELETE=46,Keyboard.HELP=47,Keyboard.NUM_LOCK=144,Keyboard.PLUS=43,Keyboard.MINUS=45;var Mouse=qc.Mouse=function(t,e){this.input=t,this.game=t.game,this._wheelEvent=null,this.capture=!0,this.callbackContext=this.game,this.mouseDownCallback=null,this.onMouseDown=new Phaser.Signal,this.onMouseUp=new Phaser.Signal,this.onMouseMove=new Phaser.Signal,this.onMousePressMove=new Phaser.Signal,this.onMouseWheel=new Phaser.Signal,this._mouses=[],this._mouseIds={},this._mouseDownNum=0,this._anyMouseDown=!1,this._checkEventHandledByTouch=this.game.phaser.device.android&&!1===this.game.phaser.device.chrome,this._wheelInfo={deltaX:0,deltaY:0},this._init(e)};Mouse.prototype={},Mouse.prototype.constructor=Mouse,Object.defineProperties(Mouse.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(t){if(t!==this._generator){var e=this.enable;this.enable=!1,this._generator=t,e&&(this.enable=!0)}}},mouseWheel:{get:function(){return this._wheelInfo}},mouseCount:{get:function(){return this._mouseDownNum}},mouseIds:{get:function(){return Object.keys(this._mouseIds)}}}),Mouse.prototype._init=function(t){this._mouseKeyMap={0:Mouse.BUTTON_LEFT,1:Mouse.BUTTON_MIDDLE,2:Mouse.BUTTON_RIGHT,3:Mouse.BUTTON_BACK,4:Mouse.BUTTON_FORWORD},this._mouseKeyMap[-1]=Mouse.NONE,this._onMouseDown=this.processMouseDown.bind(this),this._onMouseUp=this.processMouseUp.bind(this),this._onMouseOver=this.processMouseOver.bind(this),this._onMouseOut=this.processMouseOut.bind(this),this._onMouseUpGlobal=this.processMouseUpGlobal.bind(this),this._onMouseMove=this.processMouseMove.bind(this),this._onMouseWheel=this.processMouseWheel.bind(this),this.generator=t,this.enable=!0},Mouse.prototype.update=function(){if(this.enable){this._anyMouseDown=!1;for(var t,e=this._mouses.length;e-- >1;)if(t=this._mouses[e],t)for(;t.nextEvent();)t.isJustDown&&(this._anyMouseDown=!0,this._recordMouse(t.id,!0),this.onMouseDown.dispatch(t.id,t.x,t.y)),t.update(),t.isDown&&(t.deltaX||t.deltaY)&&this.onMousePressMove.dispatch(t.id,t.x,t.y),t.isJustUp&&(this._recordMouse(t.id,!1),this.onMouseUp.dispatch(t.id,t.x,t.y));if(t=this.getMouseById(Mouse.NONE),t)for(;t.nextEvent();)t.update(),(t.deltaX||t.deltaY)&&this.onMouseMove.dispatch(t.x,t.y);var i=this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0});i&&(i.deltaX||i.deltaY)?(this._wheelInfo.deltaX=i.deltaX||0,this._wheelInfo.deltaY=i.deltaY||0,this.onMouseWheel.dispatch(this._wheelInfo.deltaX,this._wheelInfo.deltaY)):(this._wheelInfo.deltaX=0,this._wheelInfo.deltaY=0),i.deltaX=0,i.deltaY=0}},Mouse.prototype.destroy=function(){this.enable=!1,this._onMouseDown=null,this._onMouseUp=null,this._onMouseOver=null,this._onMouseOut=null,this._onMouseUpGlobal=null,this._onMouseMove=null,this._onMouseWheel=null,this.input=null,this.game=null,this.generator=null},Mouse.prototype._setEnable=function(t){if(!(this._enable===t||this.game.phaser.device.android&&!1===this.game.phaser.device.chrome&&this.game.phaser.device.touch)){this._enable=t;var e=this.generator,i=this.game.phaser.device;if(t){e.addEventListener("mousedown",this._onMouseDown,!1),e.addEventListener("mouseup",this._onMouseUp,!1),e.addEventListener("mousemove",this._onMouseMove,!1),i.cocoonJS||(e===window||window.addEventListener("mouseup",this._onMouseUpGlobal,!1),e.addEventListener("mouseout",this._onMouseOut,!1),e.addEventListener("mouseover",this._onMouseOver,!1));var r=i.wheelEvent;r&&(e.addEventListener(r,this._onMouseWheel,!1),"mousewheel"===r?this._wheelEvent=new WheelEventProxy(-.025,1):"DOMMouseScroll"===r&&(this._wheelEvent=new WheelEventProxy(1,1))),this.getMouseById(Mouse.NONE)}else{e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("mousemove",this._onMouseMove),e.removeEventListener("mouseup",this._onMouseUp),e.removeEventListener("mouseout",this._onMouseOut),e.removeEventListener("mouseover",this._onMouseOver);r=i.wheelEvent;r&&e.removeEventListener(r,this._onMouseWheel),e===window||window.removeEventListener("mouseup",this._onMouseUpGlobal),this._clearMouses()}}},Mouse.prototype._clearMouses=function(){for(;this._mouses.length>0;){var t=this._mouses.pop();t&&t.destroy()}this._mouseDownNum=0,this._mouseIds={}},Mouse.prototype.lossFocus=function(){this._clearMouses(),this.getMouseById(Mouse.NONE)},Mouse.prototype.isAnyMouse=function(){return this._mouseDownNum>0},Mouse.prototype.isAnyMouseDown=function(){return this._anyMouseDown},Mouse.prototype.isMouseDown=function(t){return!!this._mouseIds[t]},Mouse.prototype._recordMouse=function(t,e){e?(this._mouseDownNum++,this._mouseIds[t]=!0):(this._mouseDownNum--,delete this._mouseIds[t])},Mouse.prototype.getMouseById=function(t){var e=Math.abs(t);return this._mouses[e]||(this._mouses[e]=new qc.Pointer(this.game,t)),this._mouses[e]},Mouse.prototype._updateMousesPosition=function(t,e,i){for(var r,n=this._mouses.length;n--;)r=this._mouses[n],r&&(i===qc.Pointer.ENTER?r.onEnter(t,e):i===qc.Pointer.LEAVE?r.onLeave(t,e):r.onMove(t,e))},Mouse.prototype._toWorld=function(t,e,i){var r=this.game.canvas,n=this.game.phaser.scale.scaleFactor,o=r.ownerDocument===(this.generator.ownerDocument||this.generator.document)?r.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(e-o.left)*n.x,y:(i-o.top)*n.y}},Mouse.prototype.processMouseDown=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,t);var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this._toWorld(this.generator,t.clientX,t.clientY);if(!this._checkEventHandledByTouch||!this.input.touch.checkEventHandled(!0,i.x,i.y)){var r=this.getMouseById(e);r.deviceId=t.button,r.onDown(i.x,i.y),this.input.keyboard.setModifierKeysState(t),this.update()}}},Mouse.prototype.processMouseUp=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this.getMouseById(e);i.deviceId=t.button,i.onUp(),this.input.keyboard.setModifierKeysState(t),this.update()}},Mouse.prototype.processMouseUpGlobal=function(t){var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this.getMouseById(e);i.onUp(),this.input&&this.input.keyboard&&this.input.keyboard.setModifierKeysState(t),this.update()}},Mouse.prototype.processMouseOut=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(i.x,i.y,qc.Pointer.LEAVE),this.update()}},Mouse.prototype.processMouseOver=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(i.x,i.y,qc.Pointer.ENTER),this.input.keyboard.setModifierKeysState(t),this.update()}},Mouse.prototype.processMouseMove=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(i.x,i.y,qc.Pointer.MOVE),this.input.keyboard.setModifierKeysState(t),this.update()}},Mouse.prototype.processMouseWheel=function(t){this._wheelEvent&&(t=this._wheelEvent.bindEvent(t)),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();Phaser.Math.clamp(-t.deltaY,-1,1);var e=this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0});e.deltaX+=t.deltaX,e.deltaY+=t.deltaY,this.input.keyboard.setModifierKeysState(t),this.update()},Mouse.NONE=0,Mouse.BUTTON_LEFT=-1,Mouse.BUTTON_MIDDLE=-2,Mouse.BUTTON_RIGHT=-3,Mouse.BUTTON_BACK=-4,Mouse.BUTTON_FORWORD=-5,WheelEventProxy.prototype={},WheelEventProxy.prototype.constructor=WheelEventProxy,WheelEventProxy.prototype.bindEvent=function(t){if(!WheelEventProxy._stubsGenerated&&t){var e=function(t){return function(){var e=this.originalEvent[t];return"function"!=typeof e?e:e.bind(this.originalEvent)}};for(var i in t)i in WheelEventProxy.prototype||Object.defineProperty(WheelEventProxy.prototype,i,{get:e(i)});WheelEventProxy._stubsGenerated=!0}return this.originalEvent=t,this},Object.defineProperties(WheelEventProxy.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});var Touch=qc.Touch=function(t,e){this.input=t,this.game=t.game,this.capture=!0,this.onTouchStart=new Phaser.Signal,this.onTouchEnd=new Phaser.Signal,this.onTouchMove=new Phaser.Signal,this._touches=[],this._touchIds={},this._deviceIdMap={},this._touchesStartPosition=[],this._touchStartNum=0,this._anyTouchStart=!1,this._init(e),this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null};Touch.prototype={},Touch.prototype.constructor=Touch,Object.defineProperties(Touch.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(t){if(t!==this._generator){var e=this.enable;this.enable=!1,this._generator=t,e&&(this.enable=!0)}}},touchCount:{get:function(){return this._touchStartNum}},touchIds:{get:function(){return Object.keys(this._touchIds)}}}),Touch.prototype._init=function(t){this._onTouchStart=this.processTouchStart.bind(this),this._onTouchCancel=this.processTouchCancel.bind(this),this._onTouchEnd=this.processTouchEnd.bind(this),this._onTouchEnter=this.processTouchEnter.bind(this),this._onTouchLeave=this.processTouchLeave.bind(this),this._onTouchMove=this.processTouchMove.bind(this),this.generator=t,this.enable=!0},Touch.prototype.update=function(){if(this.enable){this._touchesStartPosition.splice(0,this._touchesStartPosition.length),this._anyTouchStart=!1;for(var t,e=this._touches.length;e--;)if(t=this._touches[e],t)for(;t.nextEvent();)t.isJustDown&&(this._anyTouchStart=!0,this._recordTouch(t.id,!0),this.onTouchStart.dispatch(t.id,t.x,t.y)),t.update(),t.isDown&&(t.deltaX||t.deltaY)&&this.onTouchMove.dispatch(t.id,t.x,t.y),t.isJustUp&&(this._recordTouch(t.id,!1),this.onTouchEnd.dispatch(t.id,t.x,t.y)),t.isDown||this._removeTouch(t.id)}},Touch.prototype.destroy=function(){this.enable=!1,this._onTouchStart=null,this._onTouchCancel=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchMove=null,this.input=null,this.game=null,this.generator=null},Touch.prototype.checkEventHandled=function(t,e,i){for(var r=this._touchesStartPosition.length;r--;){var n=this._touchesStartPosition[r];if(n.isDown===t&&n.x===e&&n.y===i)return!0}return!1},Touch.prototype._setEnable=function(t){if(this._enable!==t){var e=this.generator,i=this.game.phaser.device;i.touch?(this._enable=t,t?(e.addEventListener("touchstart",this._onTouchStart,!1),e.addEventListener("touchmove",this._onTouchMove,!1),e.addEventListener("touchend",this._onTouchEnd,!1),e.addEventListener("touchcancel",this._onTouchCancel,!1),i.cocoonJS||(e.addEventListener("touchenter",this._onTouchEnter,!1),e.addEventListener("touchleave",this._onTouchLeave,!1))):(e.removeEventListener("touchstart",this._onTouchStart),e.removeEventListener("touchmove",this._onTouchMove),e.removeEventListener("touchend",this._onTouchEnd),e.removeEventListener("touchcancel",this._onTouchCancel),e.removeEventListener("touchenter",this._onTouchEnter),e.removeEventListener("touchleave",this._onTouchLeave),this._clearTouches())):this._enable=!1}},Touch.prototype._clearTouches=function(){for(var t;this._touches.length>0;)t=this._touches.pop(),t&&t.destroy();this._deviceIdMap={},this._touchStartNum=0,this._touchIds={}},Touch.prototype.lossFocus=function(){this._clearTouches()},Touch.prototype.isAnyTouch=function(){return this._touchStartNum>0},Touch.prototype.isAnyTouchStart=function(){return this._anyTouchStart},Touch.prototype.isTouchStart=function(t){return!!this._touchIds[t]},Touch.prototype._recordTouch=function(t,e){e?(this._touchStartNum++,this._touchIds[t]=!0):(this._touchStartNum--,delete this._touchIds[t])},Touch.prototype.getTouchById=function(t){return this._touches[t]},Touch.prototype._getFirstInvalidTouch=function(){for(var t=-1,e=this._touches.length+1;++t<e;){var i=this._touches[t];if(!i)break;if(!i.isDown&&!i.hasEvent())return i}var r=new qc.Pointer(this.game,t);return this._touches[t]=r,r},Touch.prototype._removeTouch=function(t){var e=this._touches[t];e&&delete this._deviceIdMap[e.deviceId]},Touch.prototype.getTouchByDeviceId=function(t,e){if(this._deviceIdMap[t]===undefined){if(e){var i=this._getFirstInvalidTouch();return i.deviceId=t,this._deviceIdMap[t]=i.id,i}return null}return this.getTouchById(this._deviceIdMap[t])},Touch.prototype._toWorld=function(t,e,i){var r=this.game.canvas,n=this.game.phaser.scale.scaleFactor,o=r.ownerDocument===(this.generator.ownerDocument||this.generator.document)?r.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(e-o.left)*n.x,y:(i-o.top)*n.y}},Touch.prototype._updateTouchWithTouches=function(t){for(var e=t.length,i={};e--;){var r=t[e];i[r.identifier]=!0;var n=this._toWorld(this.generator,r.clientX,r.clientY),o=this.getTouchByDeviceId(r.identifier);o&&(o.deviceId=r.identifier,o.onMove(n.x,n.y))}for(e=this._touches.length;e--;){r=this._touches[e];r&&!i[r.deviceId]&&r.onCancel(!1)}},Touch.prototype.processTouchStart=function(t){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,t),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();for(var e=t.changedTouches.length;e--;){var i=t.changedTouches[e];if(i){var r=this.getTouchByDeviceId(i.identifier,!0),n=this._toWorld(this.generator,i.clientX,i.clientY);this._touchesStartPosition.push({isDown:!0,x:n.x,y:n.y}),r.onDown(n.x,n.y)}}this._updateTouchWithTouches(t.touches),this.input.keyboard.setModifierKeysState(t),this.update()},Touch.prototype.processTouchEnd=function(t){this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,t),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();for(var e=t.changedTouches.length;e--;){var i=t.changedTouches[e];if(i){var r=this.getTouchByDeviceId(i.identifier);if(r){var n=this._toWorld(this.generator,i.clientX,i.clientY);this._touchesStartPosition.push({isDown:!1,x:n.x,y:n.y}),r.onUp(n.x,n.y)}}}this._updateTouchWithTouches(t.touches),this.input.keyboard.setModifierKeysState(t),this.update()},Touch.prototype.processTouchCancel=function(t){this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,t),this.processTouchEnd(t,!0)},Touch.prototype.processTouchLeave=function(t){this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,t),this.processTouchMove(t,!0)},Touch.prototype.processTouchEnter=function(t){this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,t),this.processTouchMove(t,!0)},Touch.prototype.processTouchMove=function(t,e){!e&&this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,t),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();for(var i=t.changedTouches.length;i--;){var r=t.changedTouches[i];if(r){var n=this.getTouchByDeviceId(r.identifier);if(n){var o=this._toWorld(this.generator,r.clientX,r.clientY);n.onMove(o.x,o.y)}}}this._updateTouchWithTouches(t.touches),this.input.keyboard.setModifierKeysState(t),this.update()},Touch.MAIN=0;var BaseInputEvent=qc.BaseInputEvent=function(t){this.source=t,this.effect=!0};BaseInputEvent.prototype={},BaseInputEvent.prototype.constructor=BaseInputEvent;var WheelEvent=qc.WheelEvent=function(t,e){BaseInputEvent.call(this,{deltaX:t,deltaY:e})};WheelEvent.prototype=Object.create(BaseInputEvent.prototype),WheelEvent.prototype.constructor=WheelEvent,Object.defineProperties(WheelEvent.prototype,{deltaX:{get:function(){return this.source.deltaX}},deltaY:{get:function(){return this.source.deltaY}}});var CursorMoveEvent=qc.CursorMoveEvent=function(t,e){BaseInputEvent.call(this,{x:t,y:e})};CursorMoveEvent.prototype=Object.create(BaseInputEvent.prototype),CursorMoveEvent.prototype.constructor=CursorMoveEvent,Object.defineProperties(CursorMoveEvent.prototype,{x:{get:function(){return this.source.x}},y:{get:function(){return this.source.y}}});var PointerEvent=qc.PointerEvent=function(t){BaseInputEvent.call(this,t)};PointerEvent.prototype=Object.create(BaseInputEvent.prototype),PointerEvent.prototype.constructor=PointerEvent;var ClickEvent=qc.ClickEvent=function(t){PointerEvent.call(this,t),this.isTap=!1,this.isDoubleTap=!1,this.isDoubleClick=!1};ClickEvent.prototype=Object.create(PointerEvent.prototype),ClickEvent.prototype.constructor=ClickEvent;var DragStartEvent=qc.DragStartEvent=function(t){PointerEvent.call(this,t),this.started=!0};DragStartEvent.prototype=Object.create(PointerEvent.prototype),DragStartEvent.prototype.constructor=DragStartEvent;var DragEvent=qc.DragEvent=function(t){PointerEvent.call(this,t)};DragEvent.prototype=Object.create(PointerEvent.prototype),DragEvent.prototype.constructor=DragEvent;var DragEndEvent=qc.DragEndEvent=function(t,e){PointerEvent.call(this,t),this.result=e};DragEndEvent.prototype=Object.create(PointerEvent.prototype),DragEndEvent.prototype.constructor=DragEndEvent;var DropEvent=qc.DropEvent=function(t,e){PointerEvent.call(this,t),this.dragging=e,this.result=null};DropEvent.prototype=Object.create(PointerEvent.prototype),DropEvent.prototype.constructor=DropEvent;var BaseInputModule=qc.BaseInputModule=function(t,e){this.game=t,this.input=e,this.handleTouchAsMouse=!0,this._currMainPointerId=NaN,this._needHandleEventTypes=["onDown","onUp","onClick"],this._needHandleDragTypes=["onDragStart","onDrag","onDragEnd"],this._needHandleClickAndDragType=["onClick","onDragStart","onDrag","onDragEnd"],this._startDragMoveDistance=10,this.tapDuringTime=200,this.doubleClickDuringTime=600,this._pointersEvent={},this._init()};BaseInputModule.prototype={},BaseInputModule.prototype.constructor=BaseInputModule,BaseInputModule.prototype._init=function(){this.input.onPointerDown.add(this.onPointerDown,this),this.input.onPointerUp.add(this.onPointerUp,this),this.input.onPointerMove.add(this.onPointerMove,this),this.input.onWheel.add(this.onWheel,this),this.input.onCursorMove.add(this.onCursorMove,this)},BaseInputModule.prototype._buildPointerRecord=function(t,e){return{eventId:t,deviceId:t,isMouse:e,downNodeList:null,draggingNodeList:null,overNode:null}},BaseInputModule.prototype.destroy=function(){this.input.onPointerDown.remove(this.onPointerDown,this),this.input.onPointerUp.remove(this.onPointerUp,this),this.input.onPointerMove.remove(this.onPointerMove,this),this.input.onWheel.remove(this.onWheel,this),this.input.onCursorMove.remove(this.onCursorMove,this),this.reset()},BaseInputModule.prototype.lossFocus=function(){this.reset()},BaseInputModule.prototype.update=function(){},BaseInputModule.prototype.reset=function(){for(var t in this._pointersEvent){var e,i=this._pointersEvent[t];if(isNaN(i.deviceId)||(e=this.input.getPointer(i.deviceId),i.deviceId=NaN),i.downNodeList){for(var r=0;r<i.downNodeList.length;r++){var n=new qc.PointerEvent(e);i.downNodeList[r].fireInputEvent("onUp",n)}i.downNodeList=null}if(i.draggingNodeList){for(r=0;r<i.draggingNodeList.length;r++){var o=new qc.DragEndEvent(e,null);i.draggingNodeList[r].fireInputEvent("onDragEnd",o)}i.draggingNodeList=null}if(i.overNode){var s=new qc.CursorMoveEvent(NaN,NaN);this.doPointerExitAndEnter(i,s,null),i.overNode=null}}this._pointersEvent={},this._currMainPointerId=NaN},BaseInputModule.prototype.checkEventRecordNode=function(t){if(t.draggingNodeList){for(var e=[],i=0;i<t.draggingNodeList.length;i++)t.draggingNodeList[i]._destroy&&e.push(t.draggingNodeList[i]);for(i=0;i<e.length;i++)t.draggingNodeList.remove(e[i]);0===t.draggingNodeList.length&&(t.draggingNodeList=null)}if(t.downNodeList){for(e=[],i=0;i<t.downNodeList.length;i++)t.downNodeList[i]._destroy&&e.push(t.downNodeList[i]);for(i=0;i<e.length;i++)t.downNodeList.remove(e[i]);0===t.downNodeList.length&&(t.downNodeList=null)}t.overNode&&t.overNode._destroy&&(t.overNode=null)},BaseInputModule.prototype.onPointerDown=function(t,e,i){var r=this.input.getPointer(t),n=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));if(this.handleTouchAsMouse&&(t===qc.Mouse.BUTTON_LEFT||t===qc.Touch.MAIN)){if(!isNaN(this._currMainPointerId)&&this._currMainPointerId!==t)return;this._currMainPointerId=t,r.eventId=qc.Mouse.BUTTON_LEFT,n.eventId=qc.Mouse.BUTTON_LEFT}this.checkEventRecordNode(n);var o=this._fetchNodeInParent(this.game.world,e,i);if(!n.isMouse){var s=new qc.CursorMoveEvent(e,i);this.doPointerExitAndEnter(n,s,o)}var a=o?o.getInputEventHandle(this._needHandleEventTypes,e,i):[];if(0!==a.length){n.downNodeList=a;for(var h=new qc.PointerEvent(r),l=0;l<a.length;l++)a[l].fireInputEvent("onDown",h)}},BaseInputModule.prototype.onPointerUp=function(t,e,i){var r=this.input.getPointer(t),n=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));if(this.handleTouchAsMouse&&(t===qc.Mouse.BUTTON_LEFT||t===qc.Touch.MAIN)){if(this._currMainPointerId!==t)return;this._currMainPointerId=NaN,r.eventId=qc.Mouse.BUTTON_LEFT,n.eventId=r.eventId}this.checkEventRecordNode(n);var o=this._fetchNodeInParent(this.game.world,e,i,n.draggingNodeList),s=o?o.getInputEventHandle(this._needHandleEventTypes,e,i):[],a=new qc.PointerEvent(r);if(n.draggingNodeList&&n.draggingNodeList.length>0){for(var h=o?o.getInputEventHandle("onDragDrop",e,i):[],l=0;l<n.draggingNodeList.length;l++){for(var c=n.draggingNodeList[l],u=new qc.DropEvent(r,c),p=0;p<h.length;p++){var d=h[p];d&&d.checkAllowDrop(c)&&d.fireInputEvent("onDragDrop",u)}var f=new qc.DragEndEvent(r,u.result);c.fireInputEvent("onDragEnd",f)}n.draggingNodeList=null}else for(l=0;l<s.length;l++){var g=s[l];if(qc.Util.isArray(n.downNodeList))for(p=0;p<n.downNodeList.length;p++){var y=n.downNodeList[p];if(g&&g===y){var m=new qc.ClickEvent(r);if(r.previousStatus.length){var _=r.previousStatus[0],v=r.previousStatus[1];m.isTap=_.upTime-_.downTime<this.tapDuringTime,m.isDoubleTap=v&&_.upTime-v.downTime<2*this.tapDuringTime,m.isDoubleClick=v&&_.upTime-v.downTime<this.doubleClickDuringTime}g.fireInputEvent("onClick",m);break}}}if(qc.Util.isArray(n.downNodeList))for(l=0;l<n.downNodeList.length;l++){y=n.downNodeList[l];a.downInside=!0,a.upInside=!1;for(p=0;p<s.length;p++){g=s[p];if(y===g){a.upInside=!0;break}}y.fireInputEvent("onUp",a)}for(l=0;l<s.length;l++){var x;g=s[l];if(a.downInside=!1,a.upInside=!0,qc.Util.isArray(n.downNodeList))for(p=0;p<n.downNodeList.length;p++){y=n.downNodeList[p];if(g===y){x=!0;break}}x||g.fireInputEvent("onUp",a)}if(n.downNodeList=null,!n.isMouse){var T=new qc.CursorMoveEvent(e,i);this.doPointerExitAndEnter(n,T,null)}delete this._buildPointerRecord[n.deviceId]},BaseInputModule.prototype.onPointerMove=function(t,e,i){var r=this.input.getPointer(t),n=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));this.checkEventRecordNode(n);var o=this._fetchNodeInParent(this.game.world,e,i);if(!n.isMouse){var s=new qc.CursorMoveEvent(e,i);this.doPointerExitAndEnter(n,s,o)}if(!n.draggingNodeList||0===n.draggingNodeList.length){
var a=this._fetchNodeInParent(this.game.world,r.startX,r.startY),h={x:r.x,y:r.y},l=[];do{if(!a)break;var c=a.getInputEventHandleAndEventType(this._needHandleClickAndDragType,r.startX,r.startY);if(0===c.length)break;for(var u=0;u<c.length;u++){var p=c[u];"onClick"===p[1]&&(Math.abs(r.distanceX)<this._startDragMoveDistance||Math.abs(r.distanceY)<this._startDragMoveDistance)||l.push(p[0])}}while(0);var d=new qc.DragStartEvent(r);r._x=r.startX,r._y=r.startY;for(u=0;u<l.length;u++)l[u].fireInputEvent("onDragStart",d);r._x=h.x,r._y=h.y,n.draggingNodeList=l}if((!n.draggingNodeList||0===n.draggingNodeList.length)&&(Math.abs(r.distanceX)>=this._startDragMoveDistance||Math.abs(r.distanceY)>=this._startDragMoveDistance)){a=this._fetchNodeInParent(this.game.world,r.startX,r.startY),h={x:r.x,y:r.y},l=a?a.getInputEventHandle(this._needHandleDragTypes,r.startX,r.startY):[],d=new qc.DragStartEvent(r);r._x=r.startX,r._y=r.startY;for(u=0;u<l.length;u++)l[u].fireInputEvent("onDragStart",d);r._x=h.x,r._y=h.y,n.draggingNodeList=l}if(n.draggingNodeList&&n.draggingNodeList.length>0){for(l=o?o.getInputEventHandle("onDragDrop",e,i):[],u=0;u<l.length;u++)for(var f=l[u],g=0;g<n.draggingNodeList.length;g++){var y=n.draggingNodeList[g],m=new qc.DropEvent(r,y);!f||f.isAllowDrop&&!f.isAllowDrop(y)||f.fireInputEvent("onDragOver",m)}var _=new qc.DragEvent(r);for(g=0;g<n.draggingNodeList.length;g++){y=n.draggingNodeList[g];y.fireInputEvent("onDrag",_)}}},BaseInputModule.prototype.onWheel=function(t,e){if(this.input.hasCursor)for(var i=this.input.cursorPosition,r=this._fetchNodeInParent(this.game.world,i.x,i.y),n=r?r.getInputEventHandle("onWheel"):[],o=0;o<n.length;o++){var s=n[o],a=new qc.WheelEvent(-t,-e);s.fireInputEvent("onWheel",a),this.onCursorMove(i.x,i.y)}},BaseInputModule.prototype.onCursorMove=function(t,e){var i=this._fetchNodeInParent(this.game.world,t,e),r=new qc.CursorMoveEvent(t,e);this.checkEventRecordNode(this),this.doPointerExitAndEnter(this,r,i)},BaseInputModule.prototype.doPointerExitAndEnter=function(t,e,i){if(t.overNode!==i){var r=this.findCommonRoot(t.overNode,i);if(t.overNode)for(var n=t.overNode;n&&n!==this.game.world&&(!r||r!==n);)n.fireInputEvent("onExit",e),n=n.parent;if(i)for(n=i;n&&n!==r&&n!==this.game.world;)n.fireInputEvent("onEnter",e),n=n.parent;t.overNode=i}},BaseInputModule.prototype._flattenPolygonContains=function(t,e,i){for(var r=t.length/2,n=!1,o=-1,s=r-1;++o<r;s=o){var a=t[2*o],h=t[2*o+1],l=t[2*s],c=t[2*s+1];(h<=i&&i<c||c<=i&&i<h)&&e<(l-a)*(i-h)/(c-h)+a&&(n=!n)}return n},BaseInputModule.prototype.findCommonRoot=function(t,e){if(!t||!e)return null;for(var i=t,r=e;i;){for(r=e;r;){if(i===r)return i;r=r.parent}i=i.parent}return null},BaseInputModule.prototype._fetchNodeInParent=function(t,e,i,r){if(!t||!t.phaser.visible)return null;var n=t.phaser.worldTransform.applyInverse({x:e,y:i});if(t===this.game.world&&!t.rect.contains(n.x,n.y))return null;if(qc.Util.isArray(r)){for(var o=0;o<r.length;o++)if(t===r[o])return null}else if(t===r)return null;if(t.phaser.mask){var s=t.phaser.mask.graphicsData||t.phaser.mask.phaser.graphicsData,a=s.length,h=!1;for(o=0;o<s.length;o++){var l=s[o];if(l.fill&&l.shape){l.shape.points&&l.shape.points.length>0&&!(l.shape.points[0]instanceof qc.Point)&&this._flattenPolygonContains(l.shape.points,e,i)?h=!0:l.shape.contains(e,i)&&(h=!0);break}}if(0!=a&&!h)return null}if(t.phaser.softClip&&t.phaser.softClip.length&&!qc.GeometricTool.polygonContains(t.phaser.softClip,e,i))return null;var c=null,u=t.children;for(o=u.length;o--;)if(c=this._fetchNodeInParent(u[o],e,i,r),c)return c;return t.checkHit(n.x,n.y)?t:null};var DirtyRectangle=qc.DirtyRectangle=function(t){var e=this;e._destroyRegion=[],e.game=t,e.game.world.getSelfWidth=function(){return this.width},e.game.world.getSelfHeight=function(){return this.height},e.game.scale.onSizeChange.add(e.onSizeChange,e),e.enable=!1,e.showDirtyRegion=!1,e.forceDirty=!1};DirtyRectangle.prototype={},DirtyRectangle.prototype.constructor=DirtyRectangle,Object.defineProperties(DirtyRectangle.prototype,{enable:{get:function(){return this._enable},set:function(t){t!==this._enable&&(this._enable=t,this._recalcAll=t,t||this.releaseDirtyCanvas())}},showDirtyRegion:{get:function(){return this._showDirtyRegion},set:function(t){t!==this._showDirtyRegion&&(this._showDirtyRegion=t,t||this.releaseDirtyCanvas())}}}),DirtyRectangle.prototype.redirectDirty=function(t){var e=this;e._enable&&t&&e._destroyRegion.push(t)},DirtyRectangle.prototype.onSizeChange=function(){var t=this;t.game.world.displayChanged(qc.DisplayChangeStatus.SIZE)},DirtyRectangle.prototype._unionRect=function(t,e){var i=t.x+t.width,r=t.y+t.height,n=e.x+e.width,o=e.y+e.height,s=t.x<e.x?t.x:e.x,a=t.y<e.y?t.y:e.y,h=i<n?n:i,l=r<o?o:r,c=h-s,u=l-a;return{x:s,y:a,width:c,height:u,area:c*u}},DirtyRectangle.prototype._insersectionRect=function(t,e){var i=t.x+t.width,r=t.y+t.height,n=e.x+e.width,o=e.y+e.height,s=t.x>e.x?t.x:e.x,a=t.y>e.y?t.y:e.y,h=i>n?n:i,l=r>o?o:r,c=h-s,u=l-a;if(c<0||u<0)return null;var p={x:s,y:a,width:c,height:u,area:c*u};return p},DirtyRectangle.prototype._mergeRect=function(t,e){var i=this,r=t.length;if(r<2)return!0;for(var n=-1,o=!1,s=null,a=0;!o&&++n<r;){var h=t[n];for(h.clip&&(h=h.clip),a=n;!o&&++a<r;){var l=t[a];l.clip&&(l=l.clip),s=i._unionRect(h,l),o=.8*s.area-h.area-l.area<0}}return!o||!s||(t[n]=s,t.splice(a,1),!1)},DirtyRectangle.prototype.collectDirtyRegion=function(t,e,i){var r=this;if(i=i||[],!e)return i;var n=t;e instanceof Phaser.Text&&e.dirty&&(e.updateText(),e.getWorldTransform(),e.dirty=!1);var o=e.isSkipChildrenRender&&e.isSkipChildrenRender(),s=e.getDisplayProxy&&e.getDisplayProxy()||e;if(s!==e&&s.displayChanged(e._displayChangeStatus),s._updateBounds&&(o|=s._updateBounds(r._recalcAll)),s._mask){var a=s._currWorldBounds;a&&(n=n?r._insersectionRect(n,a):a)}if(s._dirtyBounds){var h=s._currWorldBounds;if(h&&n){var l=r._insersectionRect(h,n);l?s._currWorldBounds.clip=l:h=null}if(s._lastWorldBounds)for(var c=s._lastWorldBounds.length;c--;){var u=s._lastWorldBounds[c];u&&i.push(u)}s._lastWorldBounds=[],h&&i.push(h),s._dirtyBounds=!1}if(0===s._displayChangeStatus&&(o|=!e._subDisplayChanged),e._subDisplayChanged=!1,r._recalcAll||!o)for(var p=e.children.length;p--;)r.collectDirtyRegion(n,e.children[p],i);return e._resetDisplayChangeStatus&&e._resetDisplayChangeStatus(),s!==e&&s._resetDisplayChangeStatus&&s._resetDisplayChangeStatus(),i},DirtyRectangle.prototype.updateDirtyRegion=function(t,e,i){var r=this;Date.now();null==i._displayChangeStatus&&(i._displayChangeStatus=-1);var n=r._currDirtyRegion=r.collectDirtyRegion(null,i);if(r._destroyRegion&&(Array.prototype.push.apply(n,r._destroyRegion),r._destroyRegion=[]),r._recalcAll||r.forceDirty||n.length>500)r._recalcAll=!1,r._currDirtyRegion=n=[{x:0,y:0,width:r.game.width,height:r.game.height}],r.forceDirty=!1;else for(;!r._mergeRect(n););var o=n.length;if(!o)return!1;for(t.save(),r._saveContext=!0,t.beginPath();o--;){var s=n[o];s&&0!==s.clip&&(s.clip&&(s=s.clip),t.rect(s.x*e-1|0,s.y*e-1|0,s.width*e+3|0,s.height*e+3|0))}return t.clip(),i._displayChangeStatus=0,!0},DirtyRectangle.prototype.restore=function(t){var e=this;e._saveContext&&(t.restore(),e._saveContext=!1)},DirtyRectangle.prototype.checkShowDirtyCanvas=function(){var t=this,e=t.game.canvas,i=t._dirtyCanvas;return!!e&&(i||(i=t._dirtyCanvas=document.createElement("canvas"),t._dirtyContext=t._dirtyCanvas.getContext("2d"),e.parentNode.insertBefore(t._dirtyCanvas,e),i.style.left=i.style.top="0px",i.style.position="absolute"),i.style.width===e.style.width&&i.style.height===e.style.height&&i.width===e.width&&i.height===e.height||(i.width=e.width,i.height=e.height,i.style.width=e.style.width,i.style.height=e.style.height),!0)},DirtyRectangle.prototype.releaseDirtyCanvas=function(){var t=this,e=t._dirtyCanvas;e&&(this.dirtyContext=null,this._dirtyCanvas=null,e.parentElement&&e.parentElement.removeChild(e))},DirtyRectangle.prototype.showDirtyRectangle=function(t,e){if(this._showDirtyRegion){var i=this;if(i.checkShowDirtyCanvas()){var r=i._dirtyCanvas,n=i._dirtyContext;n.clearRect(0,0,r.width,r.height),n.beginPath();var o=this._currDirtyRegion,s=o.length,a=.9;for(0===s&&this._lastShowAlpha>0?(o=this._lastShowRegion,a=this._lastShowAlpha-.05,s=o.length):this._lastShowRegion=o,this._lastShowAlpha=a;s--;){var h=o[s];h&&(h.clip?n.rect(h.clip.x*e,h.clip.y*e,h.clip.width*e,h.clip.height*e):n.rect(h.x*e,h.y*e,h.width*e,h.height*e))}n.lineWidth=3,n.strokeStyle="rgba(255,255,0, "+this._lastShowAlpha+")",n.stroke()}}};var __extends=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},removingHTML;qc.dragonBonesDriver=function(t,e){window.dragonBones&&(dragonBones.PhaserFactory.init(t),qc.dragonBones.game=t)},qc.dragonBonesDriver.prototype={update:function(){}},qc.dragonBonesDriver.prototype.constructor=qc.dragonBonesDriver,qc.Transition={NONE:0,COLOR_TINT:1,TEXTURE_SWAP:2,ANIMATION:3},qc.UIState={NORMAL:0,PRESSED:1,DISABLED:2},qc.Util={findClass:function(t){for(var e=t.split("."),i=window,r=0;r<e.length-1;r++){if(!i[e[r]])return;i=i[e[r]]}return i[e[e.length-1]]},clone:function(t){if(null===t||"object"!=typeof t)return t;var e=new t.constructor;for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},isArray:Array.isArray||function(t){return"[object Array]"===toString.call(t)},removeHTML:function(t){if(t&&t.parentNode){if(removingHTML===t)return;removingHTML=t,t.parentNode.removeChild(t),removingHTML=null}},updateTransform:function(t,e){var i=t.game,r=i.phaser.scale.scaleFactorInversed,n=e.style,o=t.rect,s=t.worldTransform,a=(-o.x).toFixed(5)+"px "+(-o.y).toFixed(5)+"px",h="matrix("+(s.a*r.x).toFixed(5)+","+(s.b*r.x).toFixed(5)+","+(s.c*r.y).toFixed(5)+","+(s.d*r.y).toFixed(5)+","+(s.tx*r.x).toFixed(0)+","+(s.ty*r.y).toFixed(0)+")";n.left=o.x.toFixed(5)+"px",n.top=o.y.toFixed(5)+"px",n.width=o.width.toFixed(5)+"px",n.height=o.height.toFixed(5)+"px",n.webkitTransform=h,n.mozTransform=h,n.msTransform=h,n.oTransform=h,n.transform=h,n.webkitTransformOrigin=a,n.mozTransformOrigin=a,n.msTransformOrigin=a,n.oTransformOrigin=a,n.transformOrigin=a},formatString:function(t){var e=arguments;return e.length<=1?qc.Util.formatValue(t).replace(/^\'|\'$/g,""):t.replace(/\{(\d+)\}/g,function(t,i){return qc.Util.formatValue(e[parseInt(i)+1]).replace(/^\'|\'$/g,"")})},popupError:function(t){if(window.parent&&window.parent.G&&window.parent.G.notification){var e=window.parent.G,i=qc.Util.formatString(e._("Exception notification"),t);e.notification.error(i)}else{i="Error: "+t;if("undefined"!=typeof qici&&qici.config){var r=qici.config.gameInstance,n=window[r];n&&(n.log.error(i),n.debug.on&&(window.__wx?wx.showModal({title:"",content:i,showCancel:!1}):alert(i)))}else console.error(i)}},formatValue:function(t,e,i){"number"!=typeof e&&(e=0),i=i||[];var r=function(t){if(t===undefined)return"undefined";if(null===t)return"null";var e=typeof t,i=Object.prototype.toString.call(t);if("string"===e){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return r}if("number"===e)return 0===t&&1/t<0?"-0":""+t;if("boolean"===e)return""+t;if("symbol"===e)return t.toString();if("function"===e){var n=t.name?":"+t.name:"";return"[Function"+n+"]"}return"[object RegExp]"===i?"[RegExp: "+RegExp.prototype.toString.call(t)+"]":"[object Error]"===i?"[Error: "+t.stack+"]":"[object Date]"===i?"[Date: "+Date.prototype.toString.call(t)+"]":void 0},n=r(t);if(n)return n;var o=Object.keys(t);if(0===o.length){var s=t;try{s=t.valueOf()}catch(t){}if(n=r(s),n)return n}var a,h,l=function(t,e,i,r){for(var n=[],o=0,s=t.length;o<s;++o)Object.prototype.hasOwnProperty.call(t,String(o))?n.push(u(r,t,e,String(o),!0)):n.push("");return i.forEach(function(i){"symbol"!=typeof i&&i.match(/^\d+$/)||n.push(u(r,t,e,i,!0))}),n},c=function(t,e,i,r){return i.map(function(i){return u(r,t,e,i,!1)})};if(Array.isArray(t)?(a=["[","]"],h=l):(a=["{","}"],h=c),0===o.length)return a[0]+""+a[1];var u=function(t,e,i,r,n){var o,s,a;return a=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]},a.get?s=a.set?"[Getter/Setter]":"[Getter]":a.set&&(s="[Setter]"),s||(t.indexOf(a.value)<0?(s=null===i?qc.Util.formatValue(a.value,null,t):qc.Util.formatValue(a.value,i-1,t),s.indexOf("\n")>-1&&(s=n?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n"))):s="[Circular]"),n&&r.match(/^\d+$/)?s:(o=JSON.stringify(""+r),o=o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?o.substr(1,o.length-2):o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'").replace(/\\\\/g,"\\"),o+": "+s)};if(e<0){var p="Object";return Array.isArray(t)?p="Array":(t.class&&"string"==typeof t.class&&(p=t.class),t.name&&"string"==typeof t.class&&(p=p+"("+t.name+")")),"["+p+"]"}i.push(t);var d=h(t,e,o,i);i.pop();var f=function(t,e){var i=t.reduce(function(t,e){return t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?e[0]+(1===e[0].length?"":"\n ")+" "+t.join(",\n  ")+" "+e[1]:e[0]+" "+t.join(", ")+" "+e[1]};return f(d,a)},insertSortedList:function(t,e,i,r){var n,o=function(t,e,i){var r=0,n=t.length-1;if(n<0)return-1;for(var o=0;r<n;)o=Math.floor((r+n)/2),i(t[o],e)?r=o+1:n=o;return i(t[r],e)?-1:r},s=o(t,e,i);return n=r?s<0?t.push(e)-1:t.splice(s,0,e)&&s:s<0?t.push(e)-1:t.splice(s,i(e,t[s])?0:1,e)&&s,n}},window.onerror=function(t,e,i,r,n){qc.Util.popupError(t)};var Color=qc.Color=function(t){if(this.alpha=1,this._rgb=[255,255,255],null!=t)if("number"==typeof t)this._rgb[0]=t>>16&255,this._rgb[1]=t>>8&255,this._rgb[2]=255&t,this.alpha=(t>>>24)/255;else if(qc.Util.isArray(t))this.rgb=t;else{if("string"!=typeof t)throw new Error("Invalid color");if(t=t.toLowerCase(),0===t.indexOf("rgb"))var e=Phaser.Color.webToColor(t);else{e=this._hexToColor(t);e.a=e.a/255}this._rgb[0]=e.r,this._rgb[1]=e.g,this._rgb[2]=e.b,this.alpha=e.a}};Color.prototype={},Color.prototype.constructor=Color,Object.defineProperties(Color.prototype,{alpha:{get:function(){return this._alpha},set:function(t){(t<0||t>1)&&(t=1),this._alpha=t}},rgb:{get:function(){return this._rgb},set:function(t){if(!qc.Util.isArray(t))throw new Error("Expected:Array");if(t.length<3)throw new Error("Invalid rgb");this._rgb[0]=t[0],this._rgb[1]=t[1],this._rgb[2]=t[2],4===t.length?this.alpha=t[3]:this.alpha=1}},r:{get:function(){return this._rgb[0]},set:function(t){this._rgb[0]=t}},g:{get:function(){return this._rgb[1]},set:function(t){this._rgb[1]=t}},b:{get:function(){return this._rgb[2]},set:function(t){this._rgb[2]=t}},class:{get:function(){return"qc.Color"}}}),Color.prototype.toString=function(t){switch(t){case"#rgb":return"#"+Phaser.Color.componentToHex(this._rgb[0])+Phaser.Color.componentToHex(this._rgb[1])+Phaser.Color.componentToHex(this._rgb[2]);case"#argb":return"#"+Phaser.Color.componentToHex(Math.round(255*this.alpha))+Phaser.Color.componentToHex(this._rgb[0])+Phaser.Color.componentToHex(this._rgb[1])+Phaser.Color.componentToHex(this._rgb[2]);case"rgb":return"rgb("+this._rgb[0].toString()+","+this._rgb[1].toString()+","+this._rgb[2].toString()+")";default:return"rgba("+this._rgb[0].toString()+","+this._rgb[1].toString()+","+this._rgb[2].toString()+","+this.alpha+")"}},Color.prototype.toNumber=function(t){return t?(255*this.alpha<<24|this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0:(this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0},Color.prototype._hexToColor=function(t){if(t.length<=0||"#"!==t[0])return{r:255,g:255,b:255,a:255};t=t.substr(1,t.length-1);var e=!1;if(t.length>6&&t.length<=8)for(e=!0;t.length<8;)t="0"+t;for(;t.length<6;)t="0"+t;var i=255,r=0;e&&(i=parseInt(t.substr(r,2),16),r+=2);var n=parseInt(t.substr(r,2),16);r+=2;var o=parseInt(t.substr(r,2),16);r+=2;var s=parseInt(t.substr(r,2),16);return{r:n,g:o,b:s,a:i}},Color.black=new Color(4278190080),Color.white=new Color(4294967295),Color.red=new Color(4294901760),Color.yellow=new Color(4294967040),Color.blue=new Color(4278255615),Color.green=new Color(4278255360),Color.grey=new Color(4291611852),Color.shadow=new Color(2147483648),Color.background=new Color(4282861383),qc.CanvasPool={pool:{},unused:[],cookie:19870101,get:function(t){var e=qc.CanvasPool.pool,i=e[t],r=!1;if(!i){r=!0;var n=qc.CanvasPool.unused;n.length?e[t]=i=n.pop():e[t]=i=Phaser.Canvas.create(1,1)}return i._cookie=qc.CanvasPool.cookie,{canvas:i,dirty:r}},stat:function(){var t=0,e=0,i=qc.CanvasPool.pool;for(var r in i){var n=i[r];n&&(t++,e+=n.width*n.height)}console.info("当前Canvas使用中："+t+"，总像素为："+e+"，未使用的Canvas数量："+qc.CanvasPool.unused.length)},postRender:function(){var t=qc.CanvasPool,e=t.cookie;t.cookie=e+1;for(var i=t.pool,r=t.unused,n=Object.keys(i),o=0,s=n.length;o<s;o++){var a=n[o],h=i[a];h._cookie!==e&&(delete i[a],h.width=1,h.height=1,r.push(h))}}};var appCache=window.applicationCache;if(appCache){var logEvent=function(t){},logError=function(t){};appCache.addEventListener("cached",logEvent,!1),appCache.addEventListener("checking",logEvent,!1),appCache.addEventListener("downloading",logEvent,!1),appCache.addEventListener("error",logError,!1),appCache.addEventListener("noupdate",logEvent,!1),appCache.addEventListener("obsolete",logEvent,!1),appCache.addEventListener("progress",logEvent,!1),appCache.addEventListener("updateready",logEvent,!1)}var pc2bytes0=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964),pc2bytes1=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697),pc2bytes2=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272),pc2bytes3=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144),pc2bytes4=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256),pc2bytes5=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488),pc2bytes6=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746),pc2bytes7=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568),pc2bytes8=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578),pc2bytes9=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488),pc2bytes10=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800),pc2bytes11=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744),pc2bytes12=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128),pc2bytes13=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261),spfunction1=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756),spfunction2=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344),spfunction3=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584),spfunction4=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928),spfunction5=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080),spfunction6=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312),spfunction7=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154),spfunction8=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696);qc.Des={encrypt:function(t,e,i,r,n){return qc.Des._des(t,e,!0,i,r,n)},decrypt:function(t,e,i,r,n){return qc.Des._des(t,e,!1,i,r,n)},_des:function(t,e,i,r,n,o){var s,a,h,l,c,u,p,d,f,g,y,m,_,v,x=qc.Des.des_createKeys(t),T=0,S=e.length,w=0,b=32==x.length?3:9;d=3==b?i?new Array(0,32,2):new Array(30,-2,-2):i?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2),2==o?e+="        ":1==o?(h=8-S%8,e+=String.fromCharCode(h,h,h,h,h,h,h,h),8==h&&(S+=8)):o||(e+="\0\0\0\0\0\0\0\0");var P="",A="";for(1==r&&(f=n.charCodeAt(T++)<<24|n.charCodeAt(T++)<<16|n.charCodeAt(T++)<<8|n.charCodeAt(T++),y=n.charCodeAt(T++)<<24|n.charCodeAt(T++)<<16|n.charCodeAt(T++)<<8|n.charCodeAt(T++),T=0);T<S;){for(u=e.charCodeAt(T++)<<24|e.charCodeAt(T++)<<16|e.charCodeAt(T++)<<8|e.charCodeAt(T++),p=e.charCodeAt(T++)<<24|e.charCodeAt(T++)<<16|e.charCodeAt(T++)<<8|e.charCodeAt(T++),1==r&&(i?(u^=f,p^=y):(g=f,m=y,f=u,y=p)),h=252645135&(u>>>4^p),p^=h,u^=h<<4,h=65535&(u>>>16^p),p^=h,u^=h<<16,h=858993459&(p>>>2^u),u^=h,p^=h<<2,h=16711935&(p>>>8^u),u^=h,p^=h<<8,h=1431655765&(u>>>1^p),p^=h,u^=h<<1,u=u<<1|u>>>31,p=p<<1|p>>>31,a=0;a<b;a+=3){for(_=d[a+1],v=d[a+2],s=d[a];s!=_;s+=v)l=p^x[s],c=(p>>>4|p<<28)^x[s+1],h=u,u=p,p=h^(spfunction2[l>>>24&63]|spfunction4[l>>>16&63]|spfunction6[l>>>8&63]|spfunction8[63&l]|spfunction1[c>>>24&63]|spfunction3[c>>>16&63]|spfunction5[c>>>8&63]|spfunction7[63&c]);h=u,u=p,p=h}u=u>>>1|u<<31,p=p>>>1|p<<31,h=1431655765&(u>>>1^p),p^=h,u^=h<<1,h=16711935&(p>>>8^u),u^=h,p^=h<<8,h=858993459&(p>>>2^u),u^=h,p^=h<<2,h=65535&(u>>>16^p),p^=h,u^=h<<16,h=252645135&(u>>>4^p),p^=h,u^=h<<4,1==r&&(i?(f=u,y=p):(u^=g,p^=m)),A+=String.fromCharCode(u>>>24,u>>>16&255,u>>>8&255,255&u,p>>>24,p>>>16&255,p>>>8&255,255&p),w+=8,512==w&&(P+=A,A="",w=0)}return P+A},des_createKeys:function(t){for(var e,i,r,n=t.length>8?3:1,o=new Array(32*n),s=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0),a=0,h=0,l=0;l<n;l++){var c=t.charCodeAt(a++)<<24|t.charCodeAt(a++)<<16|t.charCodeAt(a++)<<8|t.charCodeAt(a++),u=t.charCodeAt(a++)<<24|t.charCodeAt(a++)<<16|t.charCodeAt(a++)<<8|t.charCodeAt(a++);r=252645135&(c>>>4^u),u^=r,c^=r<<4,r=65535&(u>>>-16^c),c^=r,u^=r<<-16,r=858993459&(c>>>2^u),u^=r,c^=r<<2,r=65535&(u>>>-16^c),c^=r,u^=r<<-16,r=1431655765&(c>>>1^u),u^=r,c^=r<<1,r=16711935&(u>>>8^c),c^=r,u^=r<<8,r=1431655765&(c>>>1^u),u^=r,c^=r<<1,r=c<<8|u>>>20&240,c=u<<24|u<<8&16711680|u>>>8&65280|u>>>24&240,u=r;for(var p=0;p<s.length;p++)s[p]?(c=c<<2|c>>>26,u=u<<2|u>>>26):(c=c<<1|c>>>27,u=u<<1|u>>>27),c&=-15,u&=-15,e=pc2bytes0[c>>>28]|pc2bytes1[c>>>24&15]|pc2bytes2[c>>>20&15]|pc2bytes3[c>>>16&15]|pc2bytes4[c>>>12&15]|pc2bytes5[c>>>8&15]|pc2bytes6[c>>>4&15],i=pc2bytes7[u>>>28]|pc2bytes8[u>>>24&15]|pc2bytes9[u>>>20&15]|pc2bytes10[u>>>16&15]|pc2bytes11[u>>>12&15]|pc2bytes12[u>>>8&15]|pc2bytes13[u>>>4&15],r=65535&(i>>>16^e),o[h++]=e^r,o[h++]=i^r<<16}return o}},Phaser.Game.prototype.update=function(t){var e=Date.now();this._qc.update(t),this._qc.debug.total+=Date.now()-e};var phaser_setUpRenderer=Phaser.Game.prototype.setUpRenderer;Phaser.Game.prototype.setUpRenderer=function(){!this.device.webGL||this.device.desktop||this.device.iOS||qc.isSupportWebGL&&!qc.isSupportWebGL(this._qc)&&(this.device.webGL=!1),phaser_setUpRenderer.call(this)},Phaser.Group.prototype.preUpdate=function(){var t=this._qc;if(t&&t.static)return!0;if(t){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.preUpdate(),!this.visible)))return}}var n=this.children;for(i=n.length;i--;)n[i]&&(n[i].visible?n[i].preUpdate():n[i].renderOrderID=-1);return!0},Phaser.Group.prototype.update=function(){var t=this._qc;if(t&&t.static)return!0;if(t){t.update&&t.update();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.update&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.update(),!this.visible)))return}}var n=this.children;for(i=n.length;i--;)n[i]&&n[i].visible&&n[i].update()},Phaser.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var t=this._qc;if(!t||!t.static){if(t){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.postUpdate(),!this.visible)))return}}var n=this.children;for(i=n.length;i--;)n[i]&&n[i].visible&&n[i].postUpdate()}},Phaser.StateManager.prototype.loadComplete=function(){var t=this;if(!0!==t._created){var e=t.game._qc;e.assets.parsing||e.state.pendLoadComplete?e.timer.add(15,function(){t.loadComplete()}):!1===t._created&&t.onCreateCallback?(t._created=!0,t.onCreateCallback.call(t.callbackContext,t.game)):t._created=!0}};var oldClearCurrentState=Phaser.StateManager.prototype.clearCurrentState;Phaser.StateManager.prototype.clearCurrentState=function(){oldClearCurrentState.call(this),this.game.world.displayChanged(qc.DisplayChangeStatus.SIZE)};var oldDeviceInitialize=Phaser.Device._initialize;Phaser.Device._initialize=function(){oldDeviceInitialize.call(this);var t=window.navigator.userAgent;this.UCBrowser=/UCBrowser/.test(t),this.iOS&&(navigator.appVersion.match(/OS (\d+)/),this.iOSVersion=parseInt(RegExp.$1,10));var e=/AppleWebKit\/([0-9\.]+)/,i=e.exec(navigator.userAgent);i&&i.length>0?(this.AppleWebKit=!0,this.AppleWebKitVersion=i[1].split(".")):this.AppleWebKit=!1,this.supportStencil=!this.AppleWebKit||this.AppleWebKitVersion[0]>534,this.android&&this.UCBrowser&&(qc.__IS_ANDROID_UC=!0)},Phaser.Animation=function(t,e,i,r,n,o,s){void 0===s&&(s=!1),this.game=t,this._parent=e,this._frameData=r,this.name=i,this._frames=[],this._frames=this._frames.concat(n),this.delay=1e3/o,this.loop=s,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.onStart=new Phaser.Signal,this.onUpdate=null,this.onComplete=new Phaser.Signal,this.onLoop=new Phaser.Signal,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},Phaser.Animation.prototype={play:function(t,e,i){return"number"==typeof t&&(this.delay=1e3/t),"boolean"==typeof e&&(this.loop=e),void 0!==i&&(this.killOnComplete=i),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.updateCurrentFrame(!1),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},setFrame:function(t,e){var i;if(void 0===e&&(e=!1),"string"==typeof t)for(var r=0;r<this._frames.length;r++)this._frameData&&this._frameData.getFrame(this._frames[r]).name===t&&(i=r);else if("number"==typeof t)if(e)i=t;else for(r=0;r<this._frames.length;r++)this._frames[r]===i&&(i=r);i&&(this._frameIndex=i-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,t&&(this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[0]):0,this._parent.setFrame(this.currentFrame)),e&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return!this.isPaused&&(!!(this.isPlaying&&this.game.time.time>=this._timeNextFrame)&&(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay,this._frameSkip+=1),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length?this.loop?(this._frameIndex%=this._frames.length,
this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),this.updateCurrentFrame(!0)):(this.complete(),!1):this.updateCurrentFrame(!0)))},updateCurrentFrame:function(t){return!!this._frameData&&(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),!this.onUpdate||!t||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData))},next:function(t){void 0===t&&(t=1);var e=this._frameIndex+t;e>=this._frames.length&&(this.loop?e%=this._frames.length:e=this._frames.length-1),e!==this._frameIndex&&(this._frameIndex=e,this.updateCurrentFrame(!0))},previous:function(t){void 0===t&&(t=1);var e=this._frameIndex-t;e<0&&(this.loop?e=this._frames.length+e:e++),e!==this._frameIndex&&(this._frameIndex=e,this.updateCurrentFrame(!0))},updateFrameData:function(t){this._frameData=t,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):this._frameIndex%this._frames.length},destroy:function(){this.game&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},Phaser.Animation.prototype.constructor=Phaser.Animation,Object.defineProperty(Phaser.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t,t?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(Phaser.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(Phaser.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(t){this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[t]):t,null!==this.currentFrame&&(this._frameIndex=t,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(Phaser.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(t){t>=1&&(this.delay=1e3/t)}}),Object.defineProperty(Phaser.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(t){t&&null===this.onUpdate?this.onUpdate=new Phaser.Signal:t||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),Phaser.Animation.generateFrameNames=function(t,e,i,r,n){void 0===r&&(r="");var o=[],s="";if(e<i)for(var a=e;a<=i;a++)s="number"==typeof n?Phaser.Utils.pad(a.toString(),n,"0",1):a.toString(),s=t+s+r,o.push(s);else for(a=e;a>=i;a--)s="number"==typeof n?Phaser.Utils.pad(a.toString(),n,"0",1):a.toString(),s=t+s+r,o.push(s);return o},Phaser.AnimationManager=function(t){this.sprite=t,this.game=t.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},Phaser.AnimationManager.prototype={loadFrameData:function(t,e){if(void 0===t)return!1;if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(t);return this._frameData=t,null==e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},copyFrameData:function(t,e){if(this._frameData=t.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return null==e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},add:function(t,e,i,r,n){if(e=e||[],i=i||60,void 0===r&&(r=!1),void 0===n&&(n=!(!e||"number"!=typeof e[0])),this._outputFrames.length=0,this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION)this._frameData.getFrameIndexes(e,n,this._outputFrames),this._anims[t]=new Phaser.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,r);else{for(var o=this.sprite._qc._animation[t].last,s=new Array(o),a=0,h=o;a<h;a++)s[a]=a;this._anims[t]=new Phaser.Animation(this.game,this.sprite,t,null,s,i,r)}return this.currentAnim=this._anims[t],this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame),this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[t]},validateFrames:function(t,e){void 0===e&&(e=!0);for(var i=0;i<t.length;i++)if(!0===e){if(t[i]>this._frameData.total)return!1}else if(!1===this._frameData.checkFrameName(t[i]))return!1;return!0},play:function(t,e,i,r){if(this._anims[t]){var n=this.currentAnim;return n===this._anims[t]?!1===n.isPlaying?(n.paused=!1,n.play(e,i,r)):("number"==typeof e&&n.delay!==1e3/e&&(n.delay=1e3/e,n._timeNextFrame=n._timeLastFrame+n.delay),"boolean"==typeof i&&(n.loop=i),void 0!==r&&(n.killOnComplete=r),n):(n&&n.isPlaying&&n.stop(),n=this._anims[t],n.paused=!1,this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=n.currentFrame),n.play(e,i,r))}},stop:function(t,e){void 0===e&&(e=!1),"string"==typeof t?this._anims[t]&&(this.currentAnim=this._anims[t],this.currentAnim.stop(e)):this.currentAnim&&this.currentAnim.stop(e)},update:function(){return!(this.updateIfVisible&&!this.sprite.visible)&&(!(!this.currentAnim||!this.currentAnim.update())&&(this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame),!0))},next:function(t){this.currentAnim&&(this.currentAnim.next(t),this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame))},previous:function(t){this.currentAnim&&(this.currentAnim.previous(t),this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame))},getAnimation:function(t){return"string"==typeof t&&this._anims[t]?this._anims[t]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var t=null;for(var t in this._anims)this._anims.hasOwnProperty(t)&&this._anims[t].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},Phaser.AnimationManager.prototype.constructor=Phaser.AnimationManager,Object.defineProperty(Phaser.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(Phaser.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}}),Object.defineProperty(Phaser.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},set:function(t){"number"==typeof t&&this._frameData&&null!==this._frameData.getFrame(t)&&(this.currentFrame=this._frameData.getFrame(t),this.currentFrame&&(this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(t){"string"==typeof t&&null!==this._frameData.getFrameByName(t)?(this.currentFrame=this._frameData.getFrameByName(t),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+t)}}),qc.BATCH_QUAD=0,qc.BATCH_TRIANGLES=1;var oldWebGLSpriteBatchSetContext=PIXI.WebGLSpriteBatch.prototype.setContext;PIXI.WebGLSpriteBatch.prototype.setContext=function(t){oldWebGLSpriteBatchSetContext.call(this,t),this.quadSize=this.size,this.triangleSize=300,this.batchIndexNumber=6;var e=3*this.triangleSize;this.triangleIndices=new PIXI.Uint16Array(e);for(var i=0;i<e;++i)this.triangleIndices[i]=i;this._batchType=qc.BATCH_QUAD,this.quadIndexBuffer=this.indexBuffer,this.triangleIndexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.triangleIndices,t.STATIC_DRAW)};var oldWebGLSpriteBatchDestroy=PIXI.WebGLSpriteBatch.prototype.destroy;PIXI.WebGLSpriteBatch.prototype.destroy=function(){this.triangleIndices=null,this.gl.deleteBuffer(this.triangleIndexBuffer),oldWebGLSpriteBatchDestroy.call(this)},Object.defineProperties(PIXI.WebGLSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(t){t!==this._batchType&&(this.stop(),t===qc.BATCH_TRIANGLES?(this.size=this.triangleSize,this.indexBuffer=this.triangleIndexBuffer,this._batchType=t,this.batchIndexNumber=3):(this.size=this.quadSize,this.indexBuffer=this.quadIndexBuffer,this._batchType=t,this.batchIndexNumber=6),this.start())}}}),PIXI.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var r=this.gl;t._dirty[r.id]?this.renderSession.renderer.updateTexture(t):r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id]),r.drawElements(r.TRIANGLES,e*this.batchIndexNumber,r.UNSIGNED_SHORT,i*this.batchIndexNumber*2),this.renderSession.drawCount++}},PIXI.CanvasMaskManager.prototype.popMask=function(t){if(t.context.restore(),qc.__IS_ANDROID_UC){var e=qc._tempCanvas;e||(e=qc._tempCanvas=document.createElement("canvas"),e.width=128,e.height=128),t.context.drawImage(e,0,0,2,2,-5,-5,1,1)}},PIXI.CanvasTinter.getTintedTexture=function(t,e){var i=t.tintedTexture||document.createElement("canvas");return PIXI.CanvasTinter.tintMethod(t.texture,e,i),i};var DisplayChangeStatus=qc.DisplayChangeStatus={OFFSET:1,SCALE:2,ROTATION:4,SIZE:8,TINT:16,ALPHA:32,SHOW:64,HIDE:128,TEXTURE:256,ORDER:512};DisplayChangeStatus.VISIBLE_MASK=DisplayChangeStatus.SHOW|DisplayChangeStatus.HIDE,DisplayChangeStatus.INHERIT_MASK=DisplayChangeStatus.SIZE|DisplayChangeStatus.ORDER|DisplayChangeStatus.OFFSET|DisplayChangeStatus.SCALE|DisplayChangeStatus.ROTATION|DisplayChangeStatus.VISIBLE_MASK,DisplayChangeStatus.RECALC_MASK=DisplayChangeStatus.ROTATION|DisplayChangeStatus.VISIBLE_MASK|DisplayChangeStatus.SIZE|DisplayChangeStatus.SCALE,DisplayChangeStatus.REOFFSET_MASK=DisplayChangeStatus.OFFSET;var oldDestroy=PIXI.DisplayObject.prototype.destroy;PIXI.DisplayObject.prototype.destroy=function(){this.maybeOutWorld(),oldDestroy.call(this)},PIXI.DisplayObject.prototype.setDisplayProxy=function(t,e){this._displayProxy=t,this._skipChildren=e},PIXI.DisplayObject.prototype.getDisplayProxy=function(){return this._displayProxy},PIXI.DisplayObject.prototype.isSkipChildrenRender=function(){return this._skipChildren},PIXI.DisplayObject.prototype.maybeOutWorld=function(){this.game?this.game._qc&&this.game._qc.dirtyRectangle.redirectDirty(this._currWorldBounds):this.stage&&this.stage.game._qc&&this.stage.game._qc.dirtyRectangle.redirectDirty(this._currWorldBounds)},PIXI.DisplayObject.prototype.displayChanged=function(t){if(0!==t&&null!=t){var e=this;if(null==e._displayChangeStatus&&(e._displayChangeStatus=DisplayChangeStatus.SHOW),e._displayChangeStatus|=t,t&DisplayChangeStatus.HIDE){this.displayObjectUpdateTransform();for(var i=0,r=this.children.length;i<r;++i)this.children[i].updateTransform()}else t&DisplayChangeStatus.SHOW&&(e._displayChangeStatus&=~DisplayChangeStatus.HIDE);for(var n=e;(n=n.parent)&&!n._subDisplayChanged;)n._subDisplayChanged=!0}},PIXI.DisplayObject.prototype._fastCalcBounds=function(t,e){var i=this,r=i.getSelfWidth&&i.getSelfWidth(),n=i.getSelfHeight&&i.getSelfHeight();if(e&DisplayChangeStatus.HIDE||!i.worldAlpha||!i.worldVisible||!r||!n)return null;var o=i.worldTransform,s=o.a,a=o.b,h=o.c,l=o.d,c=o.tx,u=o.ty;if(!t||e&DisplayChangeStatus.RECALC_MASK){var p,d,f,g,y,m,_,v,x,T,S,w,b,P=i.anchor?i.anchor.x:0,A=i.anchor?i.anchor.y:0,C=r*-P,E=n*-A,I=C+r,O=E+n;if(r<0&&(p=C,C=I,I=p),n<0&&(p=E,E=O,O=p),0===a&&0===h)s<0?(d=s*I+c,f=s*C+c):(d=s*C+c,f=s*I+c),l<0?(g=l*O+u,y=l*E+u):(g=l*E+u,y=l*O+u);else s>=0?(m=s*C,_=s*I):(m=s*I,_=s*C),a>=0?(v=a*C,x=a*I):(v=a*I,x=a*C),h>=0?(T=h*E,S=h*O):(T=h*O,S=h*E),l>=0?(w=l*E,b=l*O):(w=l*O,b=l*E),d=m+T+c,f=_+S+c,g=v+w+u,y=x+b+u;return{x:d,y:g,width:f-d,height:y-g,tx:c,ty:u,area:(f-d)*(y-g)}}if(e&DisplayChangeStatus.REOFFSET_MASK){t.tx,t.ty;return{x:t.x+c-t.tx,y:t.y+u-t.ty,width:t.width,height:t.height,tx:c,ty:u,area:t.area}}return{x:t.x,y:t.y,tx:t.tx,ty:t.ty,width:t.width,height:t.height,area:t.area}},PIXI.DisplayObject.prototype._updateBounds=function(t){var e=this,i=(e.worldTransform,e.parent),r=i?i._displayChangeStatus:0;(null==e._displayChangeStatus||t)&&(e._displayChangeStatus=DisplayChangeStatus.SHOW);var n=e._displayChangeStatus;if(n|=r&DisplayChangeStatus.INHERIT_MASK,!(e.worldVisible||n&DisplayChangeStatus.HIDE))return!0;if(0===n)return!1;e._lastWorldBounds||(e._lastWorldBounds=[]);var o=e._qc&&e._qc.animationType===qc.Sprite.FRAME_SAMPLES,s=e._currWorldBounds;if(e._currWorldBounds&&e._lastWorldBounds.push(e._currWorldBounds),e._displayChangeStatus=n,o){var a=e._qc.getSampledAnimationBounds(),h=e.worldTransform.apply(new qc.Point(a.x,a.y)),l=e.worldTransform.apply(new qc.Point(a.x+a.width,a.y)),c=e.worldTransform.apply(new qc.Point(a.x+a.width,a.y+a.height)),u=e.worldTransform.apply(new qc.Point(a.x,a.y+a.height)),p=Math.min(h.x,l.x,c.x,u.x),d=Math.max(h.x,l.x,c.x,u.x),f=Math.min(h.y,l.y,c.y,u.y),g=Math.max(h.y,l.y,c.y,u.y);e._currWorldBounds={x:p,y:f,width:d-p,height:g-f,area:(d-p)*(g-f)}}else e._currWorldBounds=e._fastCalcBounds(e._lastWorldBounds[e._lastWorldBounds.length-1],n);return e._dirtyBounds=s!==e._currWorldBounds,!1},PIXI.DisplayObject.prototype._resetDisplayChangeStatus=function(){var t=this;t._displayChangeStatus=0},PIXI.DisplayObject.prototype.updateTransform=function(){var t=this.parent;if(t)if(this.worldAlpha=this.alpha*this.parent.worldAlpha,this._lastWorldAlpha!==this.worldAlpha&&(this._lastWorldAlpha=this.worldAlpha,this.displayChanged(DisplayChangeStatus.ALPHA)),!this._isNotNeedCalcTransform||t._isSubNeedCalcTransform){this.game&&this.game._calcTransformCount++;var e,i,r,n,o,s,a=this.parent.worldTransform,h=this.worldTransform;h.inUpdate=!0,this.rotation%PIXI.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),e=this._cr*this.scale.x,i=this._sr*this.scale.x,r=-this._sr*this.scale.y,n=this._cr*this.scale.y,o=this.position.x,s=this.position.y,(this.pivot.x||this.pivot.y)&&(o-=this.pivot.x*e+this.pivot.y*r,s-=this.pivot.x*i+this.pivot.y*n),h.a=e*a.a+i*a.c,h.b=e*a.b+i*a.d,h.c=r*a.a+n*a.c,h.d=r*a.b+n*a.d,h.tx=o*a.a+s*a.c+a.tx,h.ty=o*a.b+s*a.d+a.ty):(e=this.scale.x,n=this.scale.y,o=this.position.x-this.pivot.x*e,s=this.position.y-this.pivot.y*n,h.a=e*a.a,h.b=e*a.b,h.c=n*a.c,h.d=n*a.d,h.tx=o*a.a+s*a.c+a.tx,h.ty=o*a.b+s*a.d+a.ty),this._isNotNeedCalcTransform=!0,this._isSubNeedCalcTransform=!0,this.worldTransformChangedCallback&&this.worldTransformChangedCallback.call(this.worldTransformChangedContext),this.transformCallback&&(h.inUpdate=!1,this.transformCallback.call(this.transformCallbackContext,h,a)),this._onTransformChanged&&this._onTransformChanged.dispatch(h,a)}else{this._isSubNeedCalcTransform=!1;h=this.worldTransform,a=t.worldTransform;this.transformCallback&&(h.inUpdate=!1,this.transformCallback.call(this.transformCallbackContext,h,a))}},PIXI.DisplayObject.prototype.displayObjectUpdateTransform=PIXI.DisplayObject.prototype.updateTransform,PIXI.DisplayObject.prototype.getWorldTransform=function(){for(var t=!1,e=this,i=null;e;)e._isNotNeedCalcTransform||(t=!0,i=e),e=e.parent;return t&&i.updateTransform(),this.worldTransform},PIXI.DisplayObjectContainer.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else{var e;this.softClip&&SoftClipManager.getManager(t).pushPolygon(this.softClip);var i=!1;if(this._graphicsFilter||this._mask||this._filters){if(this._graphicsFilter&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._renderSelfWebGL&&(i=this._renderSelfWebGL(t)),!i)for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&!this.filterSelf&&t.filterManager.popFilter(),this._graphicsFilter&&t.filterManager.popFilter(),t.spriteBatch.start()}else if(this._renderSelfWebGL&&(i=this._renderSelfWebGL(t)),!i)for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);this.softClip&&SoftClipManager.getManager(t).popPolygon()}},PIXI.DisplayObjectContainer.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(t);else{var e=!1;if(this._mask&&t.maskManager.pushMask(this._mask,t),this._renderSelfCanvas&&(e=this._renderSelfCanvas(t)),!e)for(var i=0;i<this.children.length;i++)this.children[i]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},PIXI.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this._qc&&this._qc._dispatchChildrenChanged("add",[t._qc]),this.stage&&t.setStageReference(this.stage),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},PIXI.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(i<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[r]=t,this._qc&&this._qc._dispatchChildrenChanged("order",[t._qc,e._qc]),t.displayChanged(qc.DisplayChangeStatus.ORDER),e.displayChanged(qc.DisplayChangeStatus.ORDER)}},PIXI.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t),this._qc&&this._qc._dispatchChildrenChanged("order",[t._qc]),t.displayChanged(qc.DisplayChangeStatus.ORDER)},PIXI.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.maybeOutWorld(),this.stage&&e.removeStageReference(),e.parent=undefined,this.children.splice(t,1),this._qc&&this._qc._dispatchChildrenChanged("remove",[e._qc]),e},PIXI.DisplayObjectContainer.prototype.remove=function(t){return this.removeChild(t)},PIXI.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0,r="number"==typeof e?e:this.children.length,n=r-i;if(n>0&&n<=r){for(var o=this.children.splice(i,n),s=[],a=0;a<o.length;a++){var h=o[a];h.maybeOutWorld(),this.stage&&h.removeStageReference(),h.parent=undefined,h._qc&&s.push(h._qc)}return this._qc&&this._qc._dispatchChildrenChanged("remove",s),o}if(0===n&&0===this.children.length)return this._qc&&this._qc._dispatchChildrenChanged("remove",[]),[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},PIXI.DisplayObjectContainer.prototype.getLocalBounds=function(){var t=this.worldTransform;this._isSubNeedCalcTransform=!0,this.worldTransform=PIXI.identityMatrix;for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateTransform();var r=this.getBounds();return this.worldTransform=t,this._isSubNeedCalcTransform=!0,this._isNotNeedCalcTransform=!1,r},PIXI.DisplayObjectContainer.prototype.displayMaybeOutWorld=PIXI.DisplayObject.prototype.maybeOutWorld,PIXI.DisplayObjectContainer.prototype.maybeOutWorld=function(){this.displayMaybeOutWorld();for(var t=this.children,e=0,i=t.length;e<i;e++)t[e].maybeOutWorld()},PIXI.PixiShader.prototype.init=function(){var t=this.gl,e=PIXI.compileProgram(t,this.vertexSrc||PIXI.PixiShader.defaultVertexSrc,this.fragmentSrc);if(t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.uSourceSampler=t.getUniformLocation(e,"uSourceSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.pixelSize=t.getUniformLocation(e,"pixelSize"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.extraAttribute)for(var i in this.extraAttribute){var r=this.extraAttribute[i].name;this[r]=t.getAttribLocation(e,r),this.attributes.push(this[r])}for(var r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(e,r);this.initUniforms(),this.program=e};var oldSpriteSetTexture=PIXI.Sprite.prototype.setTexture;PIXI.Sprite.prototype.setTexture=function(t){oldSpriteSetTexture.call(this,t),this.displayChanged(qc.DisplayChangeStatus.TEXTURE|qc.DisplayChangeStatus.SIZE)},PIXI.Sprite.prototype.getSelfWidth=function(){return this._qc?this._qc.width:this.texture&&this.texture.frame&&this.texture.frame.width},PIXI.Sprite.prototype.getSelfHeight=function(){return this._qc?this._qc.height:this.texture&&this.texture.frame&&this.texture.frame.height},PIXI.Sprite.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)&&this.renderable){var e;if(this.softClip&&SoftClipManager.getManager(t).pushPolygon(this.softClip),this.maskPixel){var i=t.spriteBatch;for(i.flush(),t.filterManager.pushFilter(this.maskPixel),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);i.stop(),t.filterManager.popFilter(),i.start()}else if(this._graphicsFilter||this._mask||this._filters){i=t.spriteBatch;if(this._graphicsFilter&&(i.flush(),t.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(i.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(i.stop(),t.maskManager.pushMask(this.mask,t),i.start()),this._filters&&this.filterSelf){i.stop();var r=this.texture.baseTexture._glTextures[t.gl.id],n=t.filterManager.buildFilterTexture(t,this._filterBlock,this);i.start();var o=this.texture._uvs;n&&(this.texture.baseTexture._glTextures[t.gl.id]=n.texture),this._renderWebGLImpl(t),i.flush(),n&&(this.texture.baseTexture._glTextures[t.gl.id]=r,t.filterManager.texturePool.push(n),this.texture._uvs=o)}else this._renderWebGLImpl(t);for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);i.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&!this.filterSelf&&t.filterManager.popFilter(),this._graphicsFilter&&t.filterManager.popFilter(),i.start()}else for(this._renderWebGLImpl(t),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);this.softClip&&SoftClipManager.getManager(t).popPolygon()}},PIXI.WebGLStencilManager.prototype.pushSpriteStencil=function(t,e){var i=this.gl;0===this.stencilStack.length&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(t);var r=this.count;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.ALWAYS,0,255),i.stencilOp(i.KEEP,i.KEEP,i.INVERT),this.reverse?(i.stencilFunc(i.EQUAL,r,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)):(i.stencilFunc(i.EQUAL,255-r,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)),t._renderWebGLImpl(e),e.spriteBatch.flush(),this.reverse?i.stencilFunc(i.EQUAL,r+1,255):i.stencilFunc(i.EQUAL,255-(r+1),255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),this.count++},PIXI.WebGLStencilManager.prototype.popSpriteStencil=function(t,e){var i=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)i.disable(i.STENCIL_TEST);else{var r=this.count;i.colorMask(!1,!1,!1,!1),this.reverse?(i.stencilFunc(i.EQUAL,r+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)):(i.stencilFunc(i.EQUAL,255-(r+1),255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)),t._renderWebGLImpl(e),e.spriteBatch.flush(),this.reverse?i.stencilFunc(i.EQUAL,r,255):i.stencilFunc(i.EQUAL,255-r,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}},PIXI.Sprite.prototype._renderWebGLImpl=function(t){var e=t.softClipManager,i=t.spriteBatch;if(e&&e.needClip){var r=this.texture,n=r.baseTexture.resolution,o=this.worldTransform,s=r._uvs;if(!s)return;var a,h,l,c,u=o.a/n,p=o.b/n,d=o.c/n,f=o.d/n,g=o.tx,y=o.ty,m=this.anchor.x,_=this.anchor.y;if(r.trim){var v=r.trim;h=v.x-m*v.width,a=h+r.crop.width,c=v.y-_*v.height,l=c+r.crop.height}else a=r.frame.width*(1-m),h=r.frame.width*-m,l=r.frame.height*(1-_),c=r.frame.height*-_;var x=this.tint;x=(x>>16)+(65280&x)+((255&x)<<16)+(255*this.worldAlpha<<24),e.renderSprite(t,this,h,c,a,l,s.x0,s.y0,s.x2,s.y2,u,p,d,f,g,y,x)}else i.render(this)},PIXI.Sprite.prototype._renderCanvas=function(t){if(!(!1===this.visible||0===this.alpha||!1===this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.maskPixel){var e=t.bufferPool||(t.bufferPool=[]),i=t.context,r=i.globalOffX||0,n=i.globalOffY||0,o=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds(),s=Math.max(r,o.x),a=Math.max(n,o.y),h=Math.min(o.x+o.width,i.canvas.width+r),l=Math.min(o.y+o.height,i.canvas.height+n);o.x=s,o.y=a,o.width=h-s,o.height=l-a;var c=e.pop();c||(c=new PIXI.CanvasBuffer(t.context.canvas.width*t.resolution,t.context.canvas.height*t.resolution),c.context._setTransform=c.context.setTransform,c.context.setTransform=function(t,e,i,r,n,o){this._setTransform(t,e,i,r,n-(this.globalOffX||0),o-(this.globalOffY||0))}),c.resize(o.width*t.resolution,o.height*t.resolution),c.context.clearRect(0,0,o.width*t.resolution,o.height*t.resolution),c.context.globalOffX=o.x*t.resolution+r,c.context.globalOffY=o.y*t.resolution+n,t.context=c.context}if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var u=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===PIXI.scaleModes.LINEAR);var p=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,d=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;t.roundPixels?(t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),p|=0,d|=0):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),this.maskPixel||(16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint)),t.drawCount++,t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,p/u,d/u,this.texture.frame.width/u,this.texture.frame.height/u)):(t.drawCount++,t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,p/u,d/u,this.texture.frame.width/u,this.texture.frame.height/u)))}for(var f=0;f<this.children.length;f++)this.children[f]._renderCanvas(t);if(this._mask&&t.maskManager.popMask(t),this.maskPixel&&this.texture.valid){var g=t.context;g.globalCompositeOperation="destination-in",t.roundPixels?(g.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),p|=0,d|=0):g.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),t.drawCount++,g.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,p/u,d/u,this.texture.crop.width/u,this.texture.crop.height/u),g.globalCompositeOperation="source-over",t.context=i,t.roundPixels?t.context.setTransform(1,0,0,1,o.x*t.resolution|0,o.y*t.resolution|0):t.context.setTransform(1,0,0,1,o.x*t.resolution,o.y*t.resolution),t.drawCount++,t.context.drawImage(c.canvas,0,0,c.canvas.width,c.canvas.height,0,0,c.canvas.width,c.canvas.height),e.push(c)}}};var oldWebGLFastSpriteBatchSetContext=PIXI.WebGLFastSpriteBatch.prototype.setContext;PIXI.WebGLFastSpriteBatch.prototype.setContext=function(t){oldWebGLFastSpriteBatchSetContext.call(this,t),this.quadSize=this.size,this.triangleSize=300,this.batchIndexNumber=6;var e=3*this.triangleSize;this.triangleIndices=new PIXI.Uint16Array(e);for(var i=0;i<e;++i)this.triangleIndices[i]=i;this._batchType=qc.BATCH_QUAD,this.quadIndexBuffer=this.indexBuffer,this.triangleIndexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.triangleIndices,t.STATIC_DRAW)};var oldWebGLFastSpriteBatchDestroy=PIXI.WebGLFastSpriteBatch.prototype.destroy;PIXI.WebGLFastSpriteBatch.prototype.destroy=function(){this.triangleIndices=null,this.gl.deleteBuffer(this.triangleIndexBuffer),oldWebGLFastSpriteBatchDestroy.call(this)},Object.defineProperties(PIXI.WebGLFastSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(t){t!==this._batchType&&(this.stop(),t===qc.BATCH_TRIANGLES?(this.size=this.triangleSize,this.indexBuffer=this.triangleIndexBuffer,this._batchType=t,this.batchIndexNumber=3):(this.size=this.quadSize,this.indexBuffer=this.quadIndexBuffer,this._batchType=t,this.batchIndexNumber=6),this.start())}}}),PIXI.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,this.currentBatchSize*this.batchIndexNumber,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},PIXI.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new PIXI.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new PIXI.Float32Array(8*Filter.MAX_SAMPLE_COUNT),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),
this.colorArray=new PIXI.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},PIXI.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl,i=this.renderSession.projection,r=this.renderSession.offset,n=t._filterArea=(t.target.filterArea||t.target.getBounds()).clone();t._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new PIXI.WebGLStencilManager,this.renderSession.stencilManager.setContext(e),e.disable(e.STENCIL_TEST),this.filterStack.push(t);for(var o=t.filterPasses.length,s=0;o--;){var a=t.filterPasses[o];a.padding>s&&(s=a.padding)}n.x-=s,n.y-=s,n.width+=2*s,n.height+=2*s;var h=Math.max(this.offsetX,n.x),l=Math.max(this.offsetY,n.y),c=Math.max(h,Math.min(n.x+n.width,this.width+this.offsetX)),u=Math.max(l,Math.min(n.y+n.height,this.height+this.offsetY));n.x=h,n.y=l,n.width=c-h,n.height=u-l,this.offsetX+=n.x,this.offsetY+=n.y;var p=this.texturePool.pop();p?p.resize(this.width,this.height):p=new PIXI.FilterTexture(this.gl,this.width,this.height),e.bindTexture(e.TEXTURE_2D,p.texture),e.bindFramebuffer(e.FRAMEBUFFER,p.frameBuffer),e.viewport(0,0,n.width,n.height),i.x=n.width/2,i.y=-n.height/2,r.x=-n.x,r.y=-n.y,e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t._glFilterTexture=p},PIXI.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,e=this.filterStack.pop(),i=e._filterArea,r=e._glFilterTexture,n=e._glFilterTexture,o=this.renderSession.projection,s=this.renderSession.offset;if(e.filterPasses.length>1){t.viewport(0,0,i.width,i.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=0,this.uvArray[1]=0,this.uvArray[2]=i.width/this.width,this.uvArray[3]=0,this.uvArray[4]=0,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var a=r,h=this.texturePool.pop();h||(h=new PIXI.FilterTexture(this.gl,this.width,this.height)),h.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var l=0;l<e.filterPasses.length-1;l++){var c=e.filterPasses[l],u=c.extraAttribute;if(u){t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);for(var p=0;p<u.length;++p){var d=c.uniforms[u[p].texture].value;if(d){var f=d._uvs;this.uvArray[8*(p+1)]=f.x3,this.uvArray[8*(p+1)+1]=f.y3,this.uvArray[8*(p+1)+2]=f.x2,this.uvArray[8*(p+1)+3]=f.y2,this.uvArray[8*(p+1)+4]=f.x0,this.uvArray[8*(p+1)+5]=f.y0,this.uvArray[8*(p+1)+6]=f.x1,this.uvArray[8*(p+1)+7]=f.y1}}t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray)}t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a.texture),this.applyFilterPass(c,i,i.width,i.height,n);var g=a;a=h,g===n?(h=this.texturePool.pop(),h||(h=new PIXI.FilterTexture(this.gl,this.width,this.height))):h=g}t.enable(t.BLEND),r=a,this.texturePool.push(h)}var y=e.filterPasses[e.filterPasses.length-1];this.offsetX-=i.x,this.offsetY-=i.y;var m=this.width,_=this.height,v=0,x=0,T=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var S=this.filterStack[this.filterStack.length-1];i=S._filterArea,m=i.width,_=i.height,v=i.x,x=i.y,T=S._glFilterTexture.frameBuffer}o.x=m/2,o.y=-_/2,s.x=v,s.y=x,i=e._filterArea;var w=i.x-v,b=i.y-x;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=w,this.vertexArray[1]=b+i.height,this.vertexArray[2]=w+i.width,this.vertexArray[3]=b+i.height,this.vertexArray[4]=w,this.vertexArray[5]=b,this.vertexArray[6]=w+i.width,this.vertexArray[7]=b,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=0,this.uvArray[1]=0,this.uvArray[2]=i.width/this.width,this.uvArray[3]=0,this.uvArray[4]=0,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height;u=y.extraAttribute;if(u)for(p=0;p<u.length;++p){d=y.uniforms[u[p].texture].value;if(d){f=d._uvs;this.uvArray[8*(p+1)]=f.x3,this.uvArray[8*(p+1)+1]=f.y3,this.uvArray[8*(p+1)+2]=f.x2,this.uvArray[8*(p+1)+3]=f.y2,this.uvArray[8*(p+1)+4]=f.x0,this.uvArray[8*(p+1)+5]=f.y0,this.uvArray[8*(p+1)+6]=f.x1,this.uvArray[8*(p+1)+7]=f.y1}}t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,m*this.renderSession.resolution,_*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,T),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=e._previous_stencil_mgr,e._previous_stencil_mgr=null,this.renderSession.stencilManager.count>0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.applyFilterPass(y,i,m,_,n),r!==n&&this.texturePool.push(n),this.texturePool.push(r),e._glFilterTexture=null},PIXI.WebGLFilterManager.prototype.buildFilterTexture=function(t,e,i){var r=t.gl,n=r.isEnabled(r.STENCIL_TEST);n&&r.disable(r.STENCIL_TEST);var o=i.texture.baseTexture;o._glTextures[r.id]||t.renderer.updateTexture(o,r);var s=o._glTextures[r.id],a={texture:s},h=new qc.Rectangle(0,0,o.width,o.height),l=i.texture.crop,c=i.texture._uvs,u=this.texturePool.pop();u||(u=new PIXI.FilterTexture(this.gl,h.width,h.height)),u.resize(h.width,h.height),r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer),r.viewport(0,0,h.width,h.height),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.disable(r.BLEND),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=l.x,this.vertexArray[1]=h.height-l.y,this.vertexArray[2]=l.x+l.width,this.vertexArray[3]=h.height-l.y,this.vertexArray[4]=l.x,this.vertexArray[5]=h.height-l.y-l.height,this.vertexArray[6]=l.x+l.width,this.vertexArray[7]=h.height-l.y-l.height,r.bufferSubData(r.ARRAY_BUFFER,0,this.vertexArray);var p=e.filterPasses[0];r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=c.x0,this.uvArray[1]=c.y0,this.uvArray[2]=c.x1,this.uvArray[3]=c.y1,this.uvArray[4]=c.x3,this.uvArray[5]=c.y3,this.uvArray[6]=c.x2,this.uvArray[7]=c.y2;var d=p.extraAttribute;if(d)for(var f=0;f<d.length;++f){var g=p.uniforms[d[f].texture].value;if(g){c=g._uvs;this.uvArray[8*(f+1)]=c.x0,this.uvArray[8*(f+1)+1]=c.y0,this.uvArray[8*(f+1)+2]=c.x1,this.uvArray[8*(f+1)+3]=c.y1,this.uvArray[8*(f+1)+4]=c.x3,this.uvArray[8*(f+1)+5]=c.y3,this.uvArray[8*(f+1)+6]=c.x2,this.uvArray[8*(f+1)+7]=c.y2}}r.bufferSubData(r.ARRAY_BUFFER,0,this.uvArray),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.texture),this.applyFilterPass(p,new qc.Rectangle(0,0,h.width,h.height),h.width,h.height,a,h.width,h.height);for(var y=null,m=1;m<e.filterPasses.length;m++){var _=y;y=u,u=_,u||(u=this.texturePool.pop(),u||(u=new PIXI.FilterTexture(this.gl,h.width,h.height)),u.resize(h.width,h.height)),r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this._filterSelfUVArray);p=e.filterPasses[m],d=p.extraAttribute;if(d){r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer);for(f=0;f<d.length;++f){g=p.uniforms[d[f].texture].value;if(g){c=g._uvs;this.uvArray[8*(f+1)]=c.x0,this.uvArray[8*(f+1)+1]=c.y0,this.uvArray[8*(f+1)+2]=c.x1,this.uvArray[8*(f+1)+3]=c.y1,this.uvArray[8*(f+1)+4]=c.x3,this.uvArray[8*(f+1)+5]=c.y3,this.uvArray[8*(f+1)+6]=c.x2,this.uvArray[8*(f+1)+7]=c.y2}}r.bufferSubData(r.ARRAY_BUFFER,0,this.uvArray)}r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,y.texture),this.applyFilterPass(p,new qc.Rectangle(0,0,h.width,h.height),h.width,h.height,a,h.width,h.height)}return n&&r.enable(r.STENCIL_TEST),r.enable(r.BLEND),r.viewport(0,0,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),r.bindFramebuffer(r.FRAMEBUFFER,this.buffer),r.colorMask(!0,!0,!0,!0),u},PIXI.WebGLFilterManager.prototype.applyFilterPass=function(t,e,i,r,n,o,s){var a=this.gl,h=t.shaders[a.id];if(h||(h=new PIXI.PixiShader(a),h.fragmentSrc=t.fragmentSrc,t.vertexSrc&&(h.vertexSrc=t.vertexSrc),h.uniforms=t.uniforms,t.extraAttribute&&(h.extraAttribute=t.extraAttribute),h.init(),t.shaders[a.id]=h),this.renderSession.shaderManager.setShader(h),o=isNaN(o)?this.width:o,s=isNaN(s)?this.height:s,a.uniform2f(h.projectionVector,i/2,-r/2),a.uniform2f(h.offsetVector,0,0),h.pixelSize&&a.uniform2f(h.pixelSize,1/o,1/s),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=o,t.uniforms.dimensions.value[1]=s,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),h.syncUniforms(),h.uSourceSampler&&n){var l=h.textureCount++;a.activeTexture(a["TEXTURE"+l]),a.bindTexture(a.TEXTURE_2D,n.texture),a.uniform1i(h.uSourceSampler,l)}a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.vertexAttribPointer(h.aVertexPosition,2,a.FLOAT,!1,0,0);var c=t.extraAttribute;if(a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.vertexAttribPointer(h.aTextureCoord,2,a.FLOAT,!1,0,0),c)for(var u=0;u<c.length;++u)a.vertexAttribPointer(h[c[u].name],2,a.FLOAT,!1,0,32*(u+1));a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.vertexAttribPointer(h.colorAttribute,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0),this.renderSession.drawCount++},PIXI.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl,r=t._webGL||t.phaser._webGL;r[i.id]&&r[i.id].data.length&&e.stencilManager.popStencil(t,r[i.id].data[0],e)};var oldTextUpdateTexture=PIXI.Text.prototype.updateTexture;PIXI.Text.prototype.updateTexture=function(){oldTextUpdateTexture.call(this),this.displayChanged(qc.DisplayChangeStatus.SIZE|qc.DisplayChangeStatus.TEXTURE)},PIXI.Text.prototype.getSelfWidth=function(){return this.texture&&this.texture.frame&&this.texture.frame.width*(this._canvasDownScale?this._canvasDownScale.x:1)},PIXI.Text.prototype.getSelfHeight=function(){return this.texture&&this.texture.frame&&this.texture.frame.height*(this._canvasDownScale?this._canvasDownScale.y:1)},PIXI.Text.prototype._uploadToRenderTexture=function(){var t=this._frameTexture,e=t.baseTexture,i=this.game.renderer;e.source=this.canvas,i.updateTexture(e),this.texture=t,e.resolution=this.resolution,e.scaleMode=PIXI.scaleModes.NEAREST,e.width=t.crop.width=t.frame.width=this.canvas.width,e.height=t.crop.height=t.frame.height=this.canvas.height},Object.defineProperty(Phaser.Text.prototype,"dirty",{get:function(){return this._dirty},set:function(t){this._dirty!==t&&(this._dirty=t,this.displayChanged(qc.DisplayChangeStatus.SIZE|qc.DisplayChangeStatus.TEXTURE))}}),Object.defineProperty(Phaser.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width/this.resolution},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(Phaser.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height/this.resolution},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}});var textScaleDirtyInterval=200,oldRenderCanvas=PIXI.Sprite.prototype._renderCanvas,oldRenderWebGL=PIXI.Sprite.prototype._renderWebGL,createFunc=function(t){return function(e){var i,r=this._canvasDownScale,n=!1!==this._nqc.roundPixels;if(n&&(i=e.roundPixels,e.roundPixels=!0),r){var o=this.worldTransform,s=o.a,a=o.b,h=o.c,l=o.d,c=r.x,u=r.y;o.a*=c,o.b*=c,o.c*=u,o.d*=u,!this.game.antialias||o.a===o.d&&0===o.b&&0===o.c?this.texture.baseTexture.scaleMode=PIXI.scaleModes.NEAREST:this.texture.baseTexture.scaleMode=PIXI.scaleModes.LINEAR,t.call(this,e),o.a=s,o.b=a,o.c=h,o.d=l}else t.call(this,e);n&&(e.roundPixels=i)}};PIXI.Text.prototype.getBounds=function(t){this.dirty&&(this.updateText(),this.dirty=!1);var e=this._canvasDownScale,i=this.worldTransform;i.tx=i.tx||0,i.ty=i.ty||0;var r=i.a,n=i.b,o=i.c,s=i.d,a=e.x,h=e.y;i.a*=a,i.b*=a,i.c*=h,i.d*=h;var l=PIXI.Sprite.prototype.getBounds.call(this,t);return i.a=r,i.b=n,i.c=o,i.d=s,l},PIXI.Text.prototype._renderCanvas=createFunc(oldRenderCanvas),PIXI.Text.prototype._renderWebGL=createFunc(oldRenderWebGL),Phaser.Text.prototype.updateLine=function(t,e,i,r,n,o,s,a,h,l){for(var c=0;c<t.length;c++){var u=t[c];this.colors[this._charCount]&&("defaultColor"===this.colors[this._charCount]?r.fillStyle=o:r.fillStyle=this.colors[this._charCount]);var p=r.measureText(u).width;if(this.style.stroke&&n&&(this._clearShadowStyle(r),r.strokeText(u,e,i),this._restoreShadowStyle(r)),this.style.fill)if(h===r.fillStyle&&l){if(r.save(),r.fillStyle="black",r.fillText(u,e,i),r.globalCompositeOperation="source-in",r.fillStyle=h,r.beginPath(),r.rect(e,i-a/2,p,a),r.clip(),r.fillRect(e,i-a/2,p,a),r.restore(),qc.__IS_ANDROID_UC){var d=qc._tempCanvas;d||(d=qc._tempCanvas=document.createElement("canvas"),d.width=128,d.height=128),r.drawImage(d,0,0,2,2,-5,-5,1,1)}}else r.fillText(u,e,i);e+=p,this._charCount++}},Phaser.Text.prototype._clearShadowStyle=function(t){this.style.fill&&this._nqc&&this._nqc.enableShadow&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=null)},Phaser.Text.prototype._restoreShadowStyle=function(t){this.style.fill&&this._nqc&&this._nqc.enableShadow&&(this._shadowOffset?(t.shadowOffsetX=this._shadowOffset[0],t.shadowOffsetY=this._shadowOffset[1]):(t.shadowOffsetX=this.style.shadowOffsetX,t.shadowOffsetY=this.style.shadowOffsetY),t.shadowColor=this.style.shadowColor,t.shadowBlur=this.style.shadowBlur)},Phaser.Text.prototype._getWorldWidth=function(t){if(t.length>0&&"\n"===t[t.length-1]){var e=t.substr(0,t.length-1);return this.context.measureText(e).width}return this.context.measureText(t).width},Phaser.Text.prototype._isLetter=function(t){return!(t<"a"||t>"z")||!(t<"A"||t>"Z")},Phaser.Text.prototype.runWordWrap=function(t,e){for(var i=e,r=[],n=0,o=!1,s=0;s<t.length;)if("\n"===t[s]){var a=t.substr(n,s-n+1);1===a.length&&r.length>0&&!o?r[r.length-1]+="\n":r.push(a),s++,n=s,o=!0}else{o=!1;for(var h=-1;s<t.length;){var l=t.charAt(s);if(!this._isLetter(l)){h>=0&&s--;break}-1===h&&(h=s),s++}s===t.length&&s--;var c=this._getWorldWidth(t.substr(n,s-n+1));if(c>i)if(h>=0&&h===n){a=t.substr(n,s-n+1);r.push(a),s++,n=s}else if(h>=0){var u=h-n;a=t.substr(n,u);r.push(a),s=n+u,n=s}else if(s-n==0){a=t.substr(n,s-n+1);r.push(a),s++,n=s}else{a=t.substr(n,s-n);r.push(a),n=s}else if(s++,s===t.length){a=t.substr(n,s-n+1);r.push(a)}}return r},Phaser.Text.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(!0!==t.game.device.editor||!0===r.runInEditor)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.inUpdate=!0,this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._isNotNeedCalcTransform=!1,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation;for(i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},Phaser.Text.prototype.update=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(!0!==t.game.device.editor||!0===r.runInEditor)){if(!this.visible)return;r.preUpdate()}}}},Phaser.BitmapText.prototype._isLetter=Phaser.Text.prototype._isLetter,Phaser.BitmapText.prototype.runWordWrap=Phaser.Text.prototype.runWordWrap,Phaser.BitmapText.prototype._getWorldWidth=function(t){var e=0,i=PIXI.BitmapText.fonts[this.fontName];if(!i||!t)return e;for(var r=this.fontSize/i.size,n=null,o=0;o<t.length;o++){var s=t.charCodeAt(o),a=i.chars[s];a&&(n&&a.kerning[n]&&(e+=a.kerning[n]),e+=a.xAdvance,n=s)}return e*r},PIXI.BitmapText.prototype.updateText=function(){var t=this.text;if(this._nqc){var e=PIXI.BitmapText.fonts[this.fontName];if(e){var i=new PIXI.Point,r=null,n=[],o=0,s=[],a=this.fontSize/e.size,h=[];if(this._nqc.wrap){t=t.replace(/\r/gi,"").replace(/\n/gi,"\n");h=this.runWordWrap(t,this._nqc.width)}else{h=t.split(/(?:\r\n|\r|\n)/);for(var l=0;l<h.length-1;l++)h[l]+="\n"}i.x=0,i.y=0;for(l=0;l<h.length;l++){i.x=0,r=null;for(var c=h[l],u=0;u<c.length;u++){var p=c.charCodeAt(u),d=e.chars[p];d&&(r&&d.kerning[r]&&(i.x+=d.kerning[r]),n.push({texture:d.texture,line:l,charCode:p,position:new PIXI.Point(i.x+d.xOffset,i.y+d.yOffset)}),i.x+=d.xAdvance,r=p)}s.push(i.x),o=Math.max(o,i.x),i.y+=e.lineHeight}var f=[];for(l=0;l<=h.length;l++){var g=0;"right"===this.style.align?g=o-s[l]:"center"===this.style.align&&(g=(o-s[l])/2),f.push(g)}var y=this.children.length,m=n.length,_=this.tint||16777215;this.textWidth=o*a,this.textHeight=e.lineHeight*a;var v=this.textWidth*this.anchor.x,x=this.textHeight*this.anchor.y;for(l=0;l<m;l++){var T=l<y?this.children[l]:this._pool.pop();T?T.setTexture(n[l].texture):T=new PIXI.Sprite(n[l].texture),T.position.x=(n[l].position.x+f[n[l].line])*a-v,T.position.y=Math.floor(n[l].position.y*a-x),T.scale.x=T.scale.y=a,T.tint=_,T.parent||this.addChild(T)}for(;this.children.length>m;){var S=this.getChildAt(this.children.length-1);this._pool.push(S),this.removeChild(S)}this._nqc.textRealWidth=this.textWidth,this._nqc.textRealHeight=this.textHeight,this.realWidth=this.textWidth,this.realHeight=this.textHeight,this._nqc._adjustTextPos(this.textWidth,this.textHeight)}}},Phaser.BitmapText.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(!0!==t.game.device.editor||!0===r.runInEditor)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return t&&(t._isTransformDirty=!0),this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++;for(i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},Phaser.BitmapText.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var t=this._qc;if(t&&!t.static){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.postUpdate(),!this.visible)))return}}},Phaser.Graphics.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(!0!==t.game.device.editor||!0===r.runInEditor)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,t&&(t._isTransformDirty=!0),this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++;for(i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},Phaser.Graphics.prototype.update=function(){var t=this._qc;if(t&&!t.static){t.update&&t.update();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.update&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.update(),!this.visible)))return}}for(i=this.children.length;i--;)this.children[i].visible&&this.children[i].update()},Phaser.Graphics.prototype.postUpdate=function(){this.key instanceof Phaser.BitmapData&&this.key.render();var t=this._qc;if(t&&!t.static){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.postUpdate(),!this.visible)))return}}for(i=this.children.length;i--;)this.children[i].visible&&this.children[i].postUpdate()},Object.defineProperty(PIXI.Graphics.prototype,"dirty",{get:function(){return this._dirty},set:function(t){t!==this._dirty&&(this._dirty=t,this.displayChanged(qc.DisplayChangeStatus.RECALC_MASK))}}),PIXI.Graphics.prototype._updateBounds=function(){var t=this,e=(t.worldTransform,t.parent),i=e?e._displayChangeStatus:0;null==t._displayChangeStatus&&(t._displayChangeStatus=DisplayChangeStatus.SHOW);var r=t._displayChangeStatus;if(r|=i&DisplayChangeStatus.INHERIT_MASK,!(t.worldVisible||r&DisplayChangeStatus.HIDE))return!0;if(0===r)return!1;t._lastWorldBounds||(t._lastWorldBounds=[]),t._currWorldBounds&&t._lastWorldBounds.push(t._currWorldBounds),t._displayChangeStatus=r,t._currentBounds=null;var n=this.getBounds();return t._currWorldBounds={x:n.x,y:n.y,tx:n.x,ty:n.y,width:n.width,height:n.height,area:n.width*n.height},t._dirtyBounds=!0,!1},Phaser.Sprite.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(!0!==t.game.device.editor||!0===r.runInEditor)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,t&&(t._isTransformDirty=!0),this.fresh=!1,!1;if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.lifespan>0&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0))return this.kill(),!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++,this.animations&&this.animations.update();for(i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},Phaser.Sprite.prototype.update=function(){var t=this._qc;if(t&&!t.static){t.update&&t.update();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.update&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.update(),!this.visible)))return}}for(i=this.children.length;i--;)this.children[i].visible&&this.children[i].update()},Phaser.Sprite.prototype.postUpdate=function(){this.key instanceof Phaser.BitmapData&&this.key.render(),this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var t=this._qc;if(t&&!t.static){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.postUpdate(),!this.visible)))return}}for(i=this.children.length;i--;)this.children[i].visible&&this.children[i].postUpdate()},Phaser.Tileset.prototype.updateTileData=function(t,e){var i,r;t-=this.tileMargin,e-=this.tileMargin,i=e>this.tileHeight?(e-this.tileHeight)/(this.tileHeight+this.tileSpacing)+1:e/this.tileHeight,r=t>this.tileWidth?(t-this.tileWidth)/(this.tileWidth+this.tileSpacing)+1:t/this.tileWidth,i=Math.floor(i),r=Math.floor(r),(this.rows&&this.rows!==i||this.columns&&this.columns!==r)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ"),this.rows=i,this.columns=r,this.total=i*r,this.drawCoords.length=0;for(var n=this.tileMargin,o=this.tileMargin,s=0;s<this.rows;s++){for(var a=0;a<this.columns;a++)this.drawCoords.push(n),this.drawCoords.push(o),n+=this.tileWidth+this.tileSpacing;n=this.tileMargin,o+=this.tileHeight+this.tileSpacing}},Phaser.Cache.prototype.getSound=function(t){return this._sounds[t]?this._sounds[t]:null},Phaser.Loader.prototype.loadAudioTag=function(t){var e=this;if(this.game.sound.touchLocked)t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=t.localPath||this.transformUrl(t.url,t),this.fileComplete(t);else{t.data=new Audio,t.data.name=t.key;var i=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.removeEventListener("stalled",r,!1),t.data.onerror=null,Phaser.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.removeEventListener("stalled",r,!1),t.data.onerror=null,e.fileError(t)};var r=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.removeEventListener("stalled",r,!1),t.data.onerror=null,e.fileError(t)};t.data.preload="auto",t.data.src=t.localPath||this.transformUrl(t.url,t),t.data.addEventListener("canplaythrough",i,!1),t.data.addEventListener("stalled",r,!1)}},Phaser.Sound.prototype.soundHasUnlocked=function(t){t===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this.game._qc.sound._getAudioTagDurationInConfig(this))},Phaser.Sound.prototype.play=function(t,e,i,r,n){if(void 0!==t&&!1!==t&&null!==t||(t=""),void 0===n&&(n=!0),this.isPlaying&&!this.allowMultiple&&!n&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||n))if(this.usingWebAudio)if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(""===t&&Object.keys(this.markers).length>0)return this;if(""!==t){if(this.currentMarker=t,!this.markers[t])return this;this.position=this.markers[t].start,this.volume=this.markers[t].volume,this.loop=this.markers[t].loop,this.duration=this.markers[t].duration,this.durationMS=this.markers[t].durationMS,void 0!==i&&(this.volume=i),void 0!==r&&(this.loop=r),this._tempMarker=t,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else e=e||0,void 0===i&&(i=this._volume),void 0===r&&(r=this.loop),this.position=e,this.volume=i,this.loop=r,this.duration=0,this.durationMS=0,this._tempMarker=t,this._tempPosition=e,this._tempVolume=i,this._tempLoop=r;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(null===this._buffer&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&""===t&&(this._sound.loop=!0),this.loop||""!==t||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1e3*this.totalDuration)),void 0===this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===t?this._sound.start(0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState||window.__wx&&this._sound.readyState>=2)?(this._sound.play(),this.totalDuration=this.game._qc.sound._getAudioTagDurationInConfig(this),0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._muted?this._sound.volume=0:this._sound.volume=this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},Phaser.Sound.prototype.resume=function(){if(this.paused&&this._sound){if(this.usingWebAudio){var t=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var e=this.duration-this.pausedPosition/1e3;void 0===this._sound.start?this._sound.noteGrainOn(0,t,e):this.loop?this._sound.start(0,t):this._sound.start(0,t,e)}else this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},Phaser.SoundManager.prototype.decode=function(t,e){e=e||null;var i=this.game.cache.getSoundData(t);if(i&&!1===this.game.cache.isSoundDecoded(t)){this.game.cache.updateSound(t,"isDecoding",!0);var r=this;try{var n=this.context.decodeAudioData(i,function(i){r.game.cache&&(i&&r.game.cache.decodedSound(t,i),r.onSoundDecode.dispatch(t,e))},function(){r.game._qc.log.trace("Sound decode failed: {0}",t),r.onSoundDecode.dispatch(t,e)});n&&n.catch&&n.catch(function(){})}catch(i){this.game._qc.log.trace("{0}",i.stack),r.onSoundDecode.dispatch(t,e)}}},Phaser.SoundManager.prototype.boot=function(){if(this.game.device.iOS&&!1===this.game.device.webAudio&&(this.channels=1),window.PhaserGlobal){if(!0===window.PhaserGlobal.disableAudio)return this.usingWebAudio=!1,void(this.noAudio=!0);if(!0===window.PhaserGlobal.disableWebAudio)return this.usingWebAudio=!1,this.usingAudioTag=!0,void(this.noAudio=!1)}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(window.AudioContext)try{this.context=new window.AudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.noAudio=!0,console.error("SoundManager boot error!",t),qc.Util.popupError(t.message)}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.noAudio=!0,console.error("SoundManager boot error!",t),qc.Util.popupError(t.message)}window.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1),null!==this.context&&(void 0===this.context.createGain?this.masterGain=this.context.createGainNode():this.masterGain=this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},Phaser.SoundManager.prototype.unlock=function(){if(!1!==this.touchLocked)if(!1===this.game.device.webAudio||window.PhaserGlobal&&!0===window.PhaserGlobal.disableWebAudio)this.touchLocked=!1,this._unlockSource=null,this.game.input._qc.touch.callbackContext=null,this.game.device.iOSVersion>8?this.game.input._qc.touch.touchEndCallback=null:this.game.input._qc.touch.touchStartCallback=null,this.game.input._qc.mouse.callbackContext=null,this.game.input._qc.mouse.mouseDownCallback=null;else{var t=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=t,
this._unlockSource.connect(this.context.destination),void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0)}},Phaser.SoundManager.prototype.update=function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState!==this._unlockSource.PLAYING_STATE&&this._unlockSource.playbackState!==this._unlockSource.FINISHED_STATE||(this.touchLocked=!1,this._unlockSource=null,this.game.input._qc.touch.callbackContext=null,this.game.device.iOSVersion>8?this.game.input._qc.touch.touchEndCallback=null:this.game.input._qc.touch.touchStartCallback=null));for(var t=0;t<this._sounds.length;t++)this._sounds[t].update();if(this._watching){for(var e=this._watchList.first;e;)this.game.cache.isSoundDecoded(e)&&this._watchList.remove(e),e=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}},Phaser.Loader.prototype.transformUrl=function(t){return/^http(s|):\/\//i.test(t)?t:this.baseURL+t},Phaser.Loader.prototype.asyncComplete=function(t,e){void 0===e&&(e=""),t.loaded=!0,t.error=!!e,!window.__wx&&t.requestObject&&200!==t.requestObject.status&&304!==t.requestObject.status&&(t.error=!0),e&&(t.errorMessage=e,console.warn("Phaser.Loader - "+t.type+"["+t.key+"]: "+e)),this.processLoadQueue()},PIXI.CanvasRenderer.prototype.render=function(t){if(this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.drawCount=0,this.renderSession.currentBlendMode=PIXI.blendModes.NORMAL,this.context.globalCompositeOperation=PIXI.blendModesCanvas[PIXI.blendModes.NORMAL],this.dirtyRectangle.enable){if(!this.dirtyRectangle.updateDirtyRegion(this.context,this.resolution,t))return this.context.fillStyle="rgba(0, 0, 0, 0)",this.context.fillRect(0,0,1,1),void this.dirtyRectangle.showDirtyRectangle(this.context,this.resolution)}else navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t),this.dirtyRectangle.enable&&(this.dirtyRectangle.restore(this.context),this.dirtyRectangle.showDirtyRectangle(this.context,this.resolution))},PIXI.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(this.__stage=t);var e=this.gl;e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.projection)}};var GameObjectFactory=qc.GameObjectFactory=function(t){this.game=t};GameObjectFactory.prototype.constructor=GameObjectFactory,GameObjectFactory.prototype.clone=function(t,e){if(!t)return null;if(t instanceof Prefab){var i=this.game.serializer.restoreBundle(t.json,e);return i._prefab=t.uuid,i}var r={},n=this.game.serializer.buildBundle(t,r);n.dependences=this.game.serializer.combineDependence(r);i=this.game.serializer.restoreBundle(n,e||t.parent);return i},GameObjectFactory.prototype.node=function(t,e){var i=new Node(new Phaser.Group(this.game.phaser,null),t,e);return i.name="node",i},GameObjectFactory.prototype.text=function(t,e){return new UIText(this.game,t,e)},GameObjectFactory.prototype.image=function(t,e){return new UIImage(this.game,t,e)},GameObjectFactory.prototype.button=function(t,e){return new Button(this.game,t,e)},GameObjectFactory.prototype.toggle=function(t,e){return new Toggle(this.game,t,e)},GameObjectFactory.prototype.sprite=function(t,e){return new Sprite(this.game,t,e)},GameObjectFactory.prototype.sound=function(t,e){return new Sound(this.game,t,e)},GameObjectFactory.prototype.scrollView=function(t,e){return new ScrollView(this.game,t,e)},GameObjectFactory.prototype.scrollBar=function(t,e,i){var r=new ScrollBar(this.game,t,i),n=i!==undefined;if(n)return r;if(r.width=160,r.height=20,r.size=.2,r.direction=qc.ScrollBar.LEFT_TO_RIGHT,e){var o=this.node(r);o.name="slidingArea",o.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),o.setStretch(0,0,0,0),o.pivotX=o.pivotY=.5;var s=this.image(o);s.name="sliders",s.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),s.setStretch(0,0,0,0),s.pivotX=s.pivotY=.5,r.sliders=s,r.interactive=!0}return r},GameObjectFactory.prototype.progressBar=function(t,e,i){var r=new ProgressBar(this.game,t,i),n=i!==undefined;if(n)return r;if(r.width=160,r.height=20,e){var o=this.node(r);o.name="progressArea",o.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),o.setStretch(0,0,0,0),o.pivotX=o.pivotY=.5;var s=this.image(o);s.name="sliders",s.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),s.setStretch(0,0,0,0),s.pivotX=s.pivotY=.5,r.sliders=s}return r},GameObjectFactory.prototype.slider=function(t,e,i){var r=new Slider(this.game,t,i),n=i!==undefined;if(n)return r;if(r.interactive=!0,r.width=160,r.height=20,e){var o=this.node(r);o.name="slidingArea",o.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),o.setStretch(0,0,0,0),o.pivotX=o.pivotY=.5;var s=this.image(o);s.name="sliders",s.setAnchor(new qc.Point(.5,.5),new qc.Point(.5,.5)),s.setStretch(0,0,0,0),s.pivotX=s.pivotY=.5,r.sliders=s}return r},GameObjectFactory.prototype.inputField=function(t,e){return new InputField(this.game,t,e)},GameObjectFactory.prototype.dropdown=function(t,e){return new qc.Dropdown(this.game,t,e)},GameObjectFactory.prototype.tilemap=function(t,e){return new Tilemap(this.game,t,e)},GameObjectFactory.prototype.tileLayer=function(t,e){return new TileLayer(this.game,t,e)},GameObjectFactory.prototype.objectLayer=function(t,e){return new ObjectLayer(this.game,t,e)},GameObjectFactory.prototype.dom=function(t,e){return new Dom(this.game,t,e)},GameObjectFactory.prototype.graphics=function(t,e){return new Graphics(this.game,t,e)};var UIImage=qc.UIImage=function(t,e,i){var r=this,n=new Phaser.Sprite(t.phaser);qc.Node.call(r,n,e,i),r._oldUpdateTransformFunc=n.updateTransform,n._renderWebGL=imageRenderWebGL,n._renderCanvas=imageRenderCanvas,r._borderLeft=0,r._borderRight=0,r._borderTop=0,r._borderBottom=0,r._imageType=qc.UIImage.IMAGE_TYPE_SIMPLE,r.name="UIImage"};UIImage.prototype=Object.create(qc.Node.prototype),UIImage.prototype.constructor=UIImage,UIImage.IMAGE_TYPE_SIMPLE=0,UIImage.IMAGE_TYPE_SLICED=1,UIImage.IMAGE_TYPE_TILED=2,Object.defineProperties(UIImage.prototype,{texture:{get:function(){return this._atlas?new qc.Texture(this._atlas,this.frame):null},set:function(t){var e=this;if(!t)return e._atlas=null,void e.phaser.loadTexture(null,e.frame);if(t instanceof qc.Atlas)t=t.getTexture(this.frame);else if("string"==typeof t){if(!e._atlas)return;if(t=e._atlas.getTexture(t),!t)return}e._atlas===t.atlas&&e.frame===t.frame||(e._atlas=t.atlas,t.atlas.getFrame(t.frame)||(t.frame=0),e.phaser.key=t.atlas.key,e.frame=t.frame)}},frame:{get:function(){return this.phaser.frameName},set:function(t){if(this.texture){var e=this.texture.atlas.frameNames||[0];"string"==typeof t&&-1===e.indexOf(t)||(this.phaser.loadTexture(this.texture.atlas.key,t),this.setWidth(this.width),this.setHeight(this.height),this._resetNinePadding(),this._dispatchLayoutArgumentChanged("size"),this.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE),this._onTextureChanged&&this._onTextureChanged.dispatch())}}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new qc.Rectangle(0,0,0,0)}},imageType:{get:function(){return this._imageType},set:function(t){this._imageType!==t&&(this._imageType=t,this.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE))}},borderTop:{get:function(){return this._borderTop},set:function(t){this._borderTop=t}},borderBottom:{get:function(){return this._borderBottom},set:function(t){this._borderBottom=t}},borderLeft:{get:function(){return this._borderLeft},set:function(t){this._borderLeft=t}},borderRight:{get:function(){return this._borderRight},set:function(t){this._borderRight=t}},onTextureChanged:{get:function(){return this._onTextureChanged||(this._onTextureChanged=new Phaser.Signal),this._onTextureChanged}},skewX:{get:function(){return this._skewX},set:function(t){var e=this;e._skewX!==t&&(e._skewX=t,e.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),e._isTransformDirty=!0,e._skewX||e._skewY?this.phaser.updateTransform=imageUpdateTransform:e.phaser.updateTransform=e._oldUpdateTransformFunc)}},skewY:{get:function(){return this._skewY},set:function(t){var e=this;e._skewY!==t&&(e._skewY=t,e.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),e._isTransformDirty=!0,e._skewX||e._skewY?this.phaser.updateTransform=imageUpdateTransform:e.phaser.updateTransform=e._oldUpdateTransformFunc)}},class:{get:function(){return"qc.UIImage"}}}),UIImage.prototype.resetNativeSize=function(){this.parent?(this.width=this.nativeSize.width,this.height=this.nativeSize.height):(this.setWidth(this.nativeSize.width),this.setHeight(this.nativeSize.height))},UIImage.prototype.loadImg=function(t){this.game.assets.load(t,t,function(){var e=this.game.assets.find(t);this.texture=e})},UIImage.prototype.setWidth=function(t){Node.prototype.setWidth.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.width=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE))},UIImage.prototype.setHeight=function(t){Node.prototype.setHeight.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.height=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE))},UIImage.prototype._resetNinePadding=function(){if(this.texture){var t=this.texture.padding;this._borderLeft=t[0],this._borderTop=t[1],this._borderRight=t[2],this._borderBottom=t[3]}},UIImage.prototype.getMeta=function(){var t=qc.Serializer,e=qc.Node.prototype.getMeta.call(this);return e.texture=t.TEXTURE,e.frame=t.AUTO,e.imageType=t.NUMBER,e.skewX=t.NUMBER,e.skewY=t.NUMBER,e};var imageRenderWebGL=function(t){var e=this._qc;if(e.imageType===qc.UIImage.IMAGE_TYPE_SIMPLE)return Phaser.Sprite.prototype._renderWebGL.call(this,t);if(this.visible&&!(this.alpha<=0)&&this.renderable){var i;if(this.softClip&&SoftClipManager.getManager(t).pushPolygon(this.softClip),this._graphicsFilter||this._mask||this._filters){var r=t.spriteBatch;for(this._graphicsFilter&&(r.flush(),t.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(r.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),t.maskManager.pushMask(this.mask,t),r.start()),this._filters&&this.filterSelf&&(r.flush(),t.filterManager.pushFilter(this._filterBlock)),imageFillVBO(r,this),this._filters&&this.filterSelf&&(r.stop(),t.filterManager.popFilter(),r.start()),i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);r.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&!this.filterSelf&&t.filterManager.popFilter(),this._graphicsFilter&&t.filterManager.popFilter(),r.start()}else for(imageFillVBO(t.spriteBatch,this),i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);this.softClip&&SoftClipManager.getManager(t).popPolygon()}},generateSlicedSprite=function(t,e){var i=e.texture,r=i._uvs;if(r){var n,o,s,a,h=e._qc,l=h.borderLeft,c=h.borderRight,u=h.borderTop,p=h.borderBottom,d=e.anchor.x,f=e.anchor.y;if(i.trim){var g=i.trim;o=g.x-d*g.width,n=o+i.crop.width,a=g.y-f*g.height,s=a+i.crop.height}else n=i.frame.width*(1-d),o=i.frame.width*-d,s=i.frame.height*(1-f),a=i.frame.height*-f;var y=i.baseTexture.width,m=i.baseTexture.height,_=[new Phaser.Point(r.x0,r.y0),new Phaser.Point(r.x0+l/y,r.y0+u/m),new Phaser.Point(r.x2-c/y,r.y2-p/m),new Phaser.Point(r.x2,r.y2)],v=Math.abs(n-o),x=Math.abs(s-a);v<l+c&&(l=v*l/(l+c),c=v-l),o>n&&(l=-l,c=-c),x<u+p&&(u=x*u/(u+p),p=x-u),a>s&&(u=-u,p=-p);var T=[new Phaser.Point(o,a),new Phaser.Point(o+l,a+u),new Phaser.Point(n-c,s-p),new Phaser.Point(n,s)],S=e.tint;S=(S>>16)+(65280&S)+((255&S)<<16)+(255*e.worldAlpha<<24);for(var w=i.baseTexture.resolution,b=e.worldTransform,P=b.a/w,A=b.b/w,C=b.c/w,E=b.d/w,I=b.tx,O=b.ty,M=0;M<3;++M)for(var R=M+1,L=0;L<3;++L){var N=L+1;webGLAddQuad(t,e,T[M].x,T[L].y,T[R].x,T[N].y,_[M].x,_[L].y,_[R].x,_[N].y,P,A,C,E,I,O,S)}}},webGLAddQuad=function(t,e,i,r,n,o,s,a,h,l,c,u,p,d,f,g,y){var m=t.renderSession.softClipManager;if(m&&m.needClip)m.renderSprite(t.renderSession,e,i,r,n,o,s,a,h,l,c,u,p,d,f,g,y);else{t.currentBatchSize>=t.size&&(t.flush(),t.currentBaseTexture=e.texture.baseTexture);var _=t.colors,v=t.positions,x=4*t.currentBatchSize*t.vertSize;t.renderSession.roundPixels?(v[x]=c*i+p*r+f|0,v[x+1]=d*r+u*i+g|0,v[x+5]=c*n+p*r+f|0,v[x+6]=d*r+u*n+g|0,v[x+10]=c*n+p*o+f|0,v[x+11]=d*o+u*n+g|0,v[x+15]=c*i+p*o+f|0,v[x+16]=d*o+u*i+g|0):(v[x]=c*i+p*r+f,v[x+1]=d*r+u*i+g,v[x+5]=c*n+p*r+f,v[x+6]=d*r+u*n+g,v[x+10]=c*n+p*o+f,v[x+11]=d*o+u*n+g,v[x+15]=c*i+p*o+f,v[x+16]=d*o+u*i+g),v[x+2]=s,v[x+3]=a,v[x+7]=h,v[x+8]=a,v[x+12]=h,v[x+13]=l,v[x+17]=s,v[x+18]=l,_[x+4]=_[x+9]=_[x+14]=_[x+19]=y,t.sprites[t.currentBatchSize++]=e}},generateTiledSprite=function(t,e){var i=e.texture,r=i._uvs;if(r){var n,o,s,a,h=e._qc,l=h.borderLeft,c=h.borderRight,u=h.borderTop,p=h.borderBottom,d=e.anchor.x,f=e.anchor.y;if(i.trim){var g=i.trim;o=g.x-d*g.width,n=o+i.crop.width,a=g.y-f*g.height,s=a+i.crop.height}else n=i.frame.width*(1-d),o=i.frame.width*-d,s=i.frame.height*(1-f),a=i.frame.height*-f;var y=i.baseTexture.width,m=i.baseTexture.height,_=[new Phaser.Point(r.x0,r.y0),new Phaser.Point(r.x0+l/y,r.y0+u/m),new Phaser.Point(r.x2-c/y,r.y2-p/m),new Phaser.Point(r.x2,r.y2)],v=r.x0+l/y,x=r.y0+u/m,T=r.x2-c/y,S=r.y2-p/m,w=Math.abs(n-o),b=Math.abs(s-a);w<l+c&&(l=w*l/(l+c),c=w-l),o>n&&(l=-l,c=-c),b<u+p&&(u=b*u/(u+p),p=b-u),a>s&&(u=-u,p=-p);var P=n-c,A=s-p,C=o+l,E=a+u,I=[new Phaser.Point(o,a),new Phaser.Point(C,E),new Phaser.Point(P,A),new Phaser.Point(n,s)],O=e.tint;O=(O>>16)+(65280&O)+((255&O)<<16)+(255*e.worldAlpha<<24);var M=i.baseTexture.resolution,R=e.worldTransform,L=R.a/M,N=R.b/M,q=R.c/M,D=R.d/M,B=R.tx,k=R.ty,F=(r.x2-r.x0)*y-l-c,U=(r.y2-r.y0)*m-u-p;w-l-c>32*F&&(F=(w-l-c)/32),b-u-p>32*U&&(U=(b-u-p)/32);var z=T,G=S;if(F>0&&U>0)for(var W=E;W<A;W+=U){var j=W+U;j>A&&(G=x+(S-x)*(A-W)/(j-W),j=A),z=T;for(var X=C;X<P;X+=F){var V=X+F;V>P&&(z=v+(T-v)*(P-X)/(V-X),V=P),webGLAddQuad(t,e,X,W,V,j,v,x,z,G,L,N,q,D,B,k,O)}}if(z=T,G=S,U)for(W=E;W<A;W+=U){j=W+U;j>A&&(G=x+(S-x)*(A-W)/(j-W),j=A),webGLAddQuad(t,e,o,W,C,j,r.x0,x,v,G,L,N,q,D,B,k,O),webGLAddQuad(t,e,P,W,n,j,T,x,r.x2,G,L,N,q,D,B,k,O)}if(z=T,G=S,F)for(X=C;X<P;X+=F){V=X+F;V>P&&(z=v+(T-v)*(P-X)/(V-X),V=P),webGLAddQuad(t,e,X,a,V,E,v,r.y0,z,x,L,N,q,D,B,k,O),webGLAddQuad(t,e,X,A,V,s,v,S,z,r.y2,L,N,q,D,B,k,O)}webGLAddQuad(t,e,I[0].x,I[0].y,I[1].x,I[1].y,_[0].x,_[0].y,_[1].x,_[1].y,L,N,q,D,B,k,O),webGLAddQuad(t,e,I[2].x,I[0].y,I[3].x,I[1].y,_[2].x,_[0].y,_[3].x,_[1].y,L,N,q,D,B,k,O),webGLAddQuad(t,e,I[2].x,I[2].y,I[3].x,I[3].y,_[2].x,_[2].y,_[3].x,_[3].y,L,N,q,D,B,k,O),webGLAddQuad(t,e,I[0].x,I[2].y,I[1].x,I[3].y,_[0].x,_[2].y,_[1].x,_[3].y,L,N,q,D,B,k,O)}},imageRenderCanvas=function(t){if(!(!1===this.visible||0===this.alpha||!1===this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)){var e=this.texture.valid,i=this._qc,r=i.imageType;if(this.maskPixel&&e&&r===qc.UIImage.IMAGE_TYPE_SIMPLE){var n=t.bufferPool||(t.bufferPool=[]),o=t.context,s=o.globalOffX||0,a=o.globalOffY||0,h=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds(),l=Math.max(s,h.x),c=Math.max(a,h.y),u=Math.min(h.x+h.width,o.canvas.width+s),p=Math.min(h.y+h.height,o.canvas.height+a);h.x=l,h.y=c,h.width=u-l,h.height=p-c;var d=n.pop();d||(d=new PIXI.CanvasBuffer(t.context.canvas.width*t.resolution,t.context.canvas.height*t.resolution),d.context._setTransform=d.context.setTransform,d.context.setTransform=function(t,e,i,r,n,o){this._setTransform(t,e,i,r,n-(this.globalOffX||0),o-(this.globalOffY||0))}),d.resize(h.width*t.resolution,h.height*t.resolution),d.context.clearRect(0,0,h.width*t.resolution,h.height*t.resolution),d.context.globalOffX=h.x*t.resolution+s,d.context.globalOffY=h.y*t.resolution+a,t.context=d.context}var f=t.context;if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,f.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),e){var g=this.texture.baseTexture.resolution/t.resolution;f.globalAlpha=this.worldAlpha,!t.smoothProperty||t.scaleMode===this.texture.baseTexture.scaleMode&&f[t.smoothProperty]===(t.scaleMode===PIXI.scaleModes.LINEAR)||(t.scaleMode=this.texture.baseTexture.scaleMode,f[t.smoothProperty]=t.scaleMode===PIXI.scaleModes.LINEAR);var y=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,m=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,_=this.texture.trim?this.texture.crop.width:this.texture.frame.width,v=this.texture.trim?this.texture.crop.height:this.texture.frame.height;t.roundPixels?(f.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),y|=0,m|=0):f.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution);var x,T,S,w,b,P=function(e,i,r,n,o,s,a,h,l,c){l&&c&&(t.drawCount++,e.drawImage(i,r,n,o||1,s||1,a,h,l,c))};if(16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint)),x=this.tintedTexture,T=0,S=0,w=this.texture.crop.width,b=this.texture.crop.height):(x=this.texture.baseTexture.source,T=this.texture.crop.x,S=this.texture.crop.y,w=this.texture.crop.width,b=this.texture.crop.height),y=Math.round(y/g),m=Math.round(m/g),_=Math.round(_/g),v=Math.round(v/g),r===qc.UIImage.IMAGE_TYPE_SIMPLE)this.maskPixel||P(f,x,T,S,w,b,y,m,_,v);else if(i.texture&&_&&v){var A=""+i.texture.atlas.uuid+r+i.frame+this.tint+_+v,C=qc.CanvasPool.get(A),E=C.canvas;if(C.dirty){var I=E.getContext("2d");t.smoothProperty&&I[t.smoothProperty]!==(t.scaleMode===PIXI.scaleModes.LINEAR)&&(I[t.smoothProperty]=t.scaleMode===PIXI.scaleModes.LINEAR),E.width=_,E.height=v,I.clearRect(0,0,_,v);var O=i.borderLeft,M=i.borderRight,R=i.borderTop,L=i.borderBottom,N=[new Phaser.Point(T,S),new Phaser.Point(T+O,S+R),new Phaser.Point(T+w-M,S+b-L),new Phaser.Point(T+w,S+b)];O/=g,R/=g,M/=g,L/=g,_<O+M&&(O=_*O/(O+M),M=_-O),v<R+L&&(R=v*R/(R+L),L=v-R);var q=[new Phaser.Point(0,0),new Phaser.Point(O,R),new Phaser.Point(_-M,v-L),new Phaser.Point(_,v)];if(r==qc.UIImage.IMAGE_TYPE_SLICED)for(var D=0;D<3;++D)for(var B=D+1,k=0;k<3;++k){var F=k+1,U=N[D].x,z=N[k].y,G=N[B].x,W=N[F].y,j=q[D].x,X=q[k].y,V=q[B].x,K=q[F].y;G-U<=0||W-z<=0||V-j<=0||K-X<=0||P(I,x,U,z,G-U,W-z,j,X,V-j,K-X)}else{var H=N[1].x,Y=N[1].y,J=N[2].x,Q=N[2].y,Z=_-M,$=v-L,tt=O,et=R,it=w/g-O-M,rt=b/g-R-L;_-O-M>32*it&&(it=(_-O-M)/32),v-R-L>32*rt&&(rt=(v-R-L)/32);var nt=J,ot=Q;if(it>0&&rt>0)for(var st=et;st<$;st+=rt){F=st+rt;F>$&&(ot=Y+(Q-Y)*($-st)/(F-st),F=$),nt=J;for(var at=tt;at<Z;at+=it){B=at+it;B>Z&&(nt=H+(J-H)*(Z-at)/(B-at),B=Z),nt-H<=0||ot-Y<=0||B-at<=0||F-st<=0||P(I,x,H,Y,nt-H,ot-Y,at,st,B-at,F-st)}}if(ot=Q,rt)for(st=et;st<$;st+=rt){F=st+rt;F>$&&(ot=Y+(Q-Y)*($-st)/(F-st),F=$),P(I,x,T,Y,H-T,ot-Y,0,st,O,F-st),P(I,x,J,Y,T+w-J,ot-Y,Z,st,M,F-st)}if(nt=J,it)for(at=tt;at<Z;at+=it){B=at+it;B>Z&&(nt=H+(J-H)*(Z-at)/(B-at),B=Z),P(I,x,H,S,nt-H,Y-S,at,0,B-at,R),P(I,x,H,Q,nt-H,S+b-Q,at,$,B-at,L)}P(I,x,N[0].x,N[0].y,N[1].x-N[0].x,N[1].y-N[0].y,q[0].x,q[0].y,q[1].x-q[0].x,q[1].y-q[0].y),P(I,x,N[2].x,N[0].y,N[3].x-N[2].x,N[1].y-N[0].y,q[2].x,q[0].y,q[3].x-q[2].x,q[1].y-q[0].y),P(I,x,N[2].x,N[2].y,N[3].x-N[2].x,N[3].y-N[2].y,q[2].x,q[2].y,q[3].x-q[2].x,q[3].y-q[2].y),P(I,x,N[0].x,N[2].y,N[1].x-N[0].x,N[3].y-N[2].y,q[0].x,q[2].y,q[1].x-q[0].x,q[3].y-q[2].y)}}P(f,E,0,0,_,v,y,m,_,v)}}for(var ht=0;ht<this.children.length;ht++)this.children[ht]._renderCanvas(t);if(this._mask&&t.maskManager.popMask(t),this.maskPixel&&e&&r===qc.UIImage.IMAGE_TYPE_SIMPLE){if(f.globalCompositeOperation="destination-in",t.roundPixels?(f.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),y|=0,m|=0):f.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),P(f,x,T,S,w,b,y,m,_,v),f.globalCompositeOperation="source-over",t.context=o,t.roundPixels?t.context.setTransform(1,0,0,1,h.x*t.resolution|0,h.y*t.resolution|0):t.context.setTransform(1,0,0,1,h.x*t.resolution,h.y*t.resolution),!d.canvas.height||!d.canvas.width)return;t.drawCount++,t.context.drawImage(d.canvas,0,0,d.canvas.width,d.canvas.height,0,0,d.canvas.width,d.canvas.height),n.push(d)}}},imageFillVBO=function(t,e){switch(e._qc.imageType){case UIImage.IMAGE_TYPE_SLICED:generateSlicedSprite(t,e);break;case UIImage.IMAGE_TYPE_TILED:generateTiledSprite(t,e)}},imageUpdateTransform=function(){var t=this,e=t.parent;if(e&&t.visible){if(t.worldAlpha=t.alpha*e.worldAlpha,!t._isNotNeedCalcTransform||e._isSubNeedCalcTransform){var i,r,n,o,s,a,h,l,c,u,p,d,f,g,y,m,_,v,x,T,S,w;t.game&&t.game._calcTransformCount++,t.rotation!==t.rotationCache&&(t.rotationCache=t.rotation,t._sr=Math.sin(t.rotation),t._cr=Math.cos(t.rotation)),h=Math.cos(t._qc._skewY||0),l=Math.sin(t._qc._skewY||0),c=-Math.sin(t._qc._skewX||0),u=Math.cos(t._qc._skewX||0),p=t.position.x,d=t.position.y,f=t._cr*t.scale.x,g=t._sr*t.scale.x,y=-t._sr*t.scale.y,m=t._cr*t.scale.y,_=0,v=0,i=f*h+g*c,r=f*l+g*u,n=y*h+m*c,o=y*l+m*u,s=_*h+v*c+p,a=_*l+v*u+d;var b=t.worldTransform,P=e.worldTransform;x=P.a,T=P.b,S=P.c,w=P.d,b.a=i*x+r*S,b.b=i*T+r*w,b.c=n*x+o*S,b.d=n*T+o*w,b.tx=s*x+a*S+P.tx,b.ty=s*T+a*w+P.ty,this._isNotNeedCalcTransform=!0,this._isSubNeedCalcTransform=!0,t.transformCallback&&(b.inUpdate=!1,t.transformCallback.call(t.transformCallbackContext,b,P))}else{t._isSubNeedCalcTransform=!1;b=t.worldTransform,P=e.worldTransform;t.transformCallback&&(b.inUpdate=!1,t.transformCallback.call(t.transformCallbackContext,b,P))}if(!t._cacheAsBitmap)for(var A=0,C=t.children.length;A<C;A++)t.children[A].updateTransform()}},UIRoot=qc.UIRoot=function(t,e){qc.Node.call(this,new Phaser.Group(t.phaser,null),null,e),this.name="UIRoot";var i=e!==undefined;if(!i){var r=this.addScript("qc.ScaleAdapter");r.referenceResolution=new qc.Point(640,960),r.manualType=qc.ScaleAdapter.EXPAND,r.fullTarget=!0}this.setAnchor(new qc.Point(0,0),new qc.Point(0,0)),this.pivotX=0,this.pivotY=0;var n=this.getWorldScale();this.setTransformToWorld(0,0,n.x,n.y,this.getWorldRotation())};UIRoot.prototype=Object.create(qc.Node.prototype),UIRoot.prototype.constructor=UIRoot,Object.defineProperties(UIRoot.prototype,{class:{get:function(){return"qc.UIRoot"}}}),UIRoot.prototype.postUpdate=function(){this.x=0,this.y=0};var Sprite=qc.Sprite=function(t,e,i){var r=new Phaser.Sprite(t.phaser);qc.Node.call(this,r,e,i),this.name="Sprite",this.animationType=qc.Sprite.NONE_ANIMATION,this._phaserImageSetFrame=r.setFrame,r.setFrame=setFrame,r._renderWebGL=spriteRenderWebGL,r._renderCanvas=spriteRenderCanvas};Sprite.prototype=Object.create(qc.Node.prototype),Sprite.prototype.constructor=Sprite,Sprite.NONE_ANIMATION=0,Sprite.FRAME_ANIMATION=1,Sprite.DRAGON_BONES=2,Sprite.FRAME_SAMPLES=3;var sInterpolationCo=8;Sprite.prototype.playAnimation=function(t,e,i){var r=this,n=r.animationType;if(n!==Sprite.NONE_ANIMATION&&t){if(n===Sprite.DRAGON_BONES){var o=r._armature.animation;if(o.animationNameList.indexOf(t)<0)return void console.warn("Animation is not exist.",t);e||(e=1);for(var s,a=o.animationNameList.length;a--;)if(o.animationNameList[a]==t){h=o.animations[t];break}return"number"==typeof e&&1!=e&&e>0&&h&&h.duration/e,s=i==undefined?0==h.playTimes?2097152:h.playTimes:!0===i?2097152:!1===i?1:undefined,r.paused=!1,r._armature.animation.timeScale=e,void r._armature.animation.play(t,s)}var h=this._animation[t];if(h){var l=h.rate?h.rate:60;if(n===Sprite.FRAME_SAMPLES&&(l*=sInterpolationCo),!r.phaser.animations._anims[t]){r.phaser.animations.add(t,h.frames,l);o=r.phaser.animations._anims[t];o.onStart.add(function(){r._onStart&&r._onStart.dispatch(r.lastAnimationName)}),o.onComplete.add(function(){r._onFinished&&r._onFinished.dispatch(r.lastAnimationName)}),o.onLoop.add(function(){r._onLoopFinished&&r._onLoopFinished.dispatch(r.lastAnimationName)})}"boolean"!=typeof i&&(i=!!h.loop),this._slowMotion=this.game.time.timeScale,this._speed=(e||1)*l,r.phaser.animations.play(t,this._speed/this._slowMotion,i)}else r.game.log.error("Animation {0} not exists",t)}},Sprite.prototype.stop=function(){var t=this,e=t.animationType;if(e!==Sprite.NONE_ANIMATION&&t.isPlaying)if(e!==Sprite.DRAGON_BONES){var i=t.phaser.animations.currentAnim;i&&i.stop(undefined,!0)}else{var r=t._armature.animation;r.stop()}},Sprite.prototype.update=function(){if(this.animationType===qc.Sprite.FRAME_SAMPLES&&this.isPlaying&&this.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE),this.animationType===qc.Sprite.DRAGON_BONES&&this._armature){if(this.isPaused())return;var t=.001*this.game.time.deltaTime;this._armature.advanceTime(t)}else if(this.animationType===qc.Sprite.FRAME_ANIMATION||this.animationType===qc.Sprite.FRAME_SAMPLES){var e=this.game.time.timeScale;if(e===this._slowMotion)return;this._slowMotion=e;var i=this.phaser.animations.currentAnim;i&&(i.speed=this._speed/e)}},Sprite.prototype.bindDragonBonesEvent=function(){var t=this;t._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.START,function(){t._onStart&&t._onStart.dispatch(t.lastAnimationName)}),t._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,function(){t._onStart&&t._onStart.dispatch(t.lastAnimationName)}),t._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.COMPLETE,function(){t._onFinished&&t._onFinished.dispatch(t.lastAnimationName)})},Sprite.prototype.getAnimationInfo=function(t){var e=this.animationType;if(e!==Sprite.NONE_ANIMATION){if(e===Sprite.DRAGON_BONES){var i=this._armature.animation;if(i.animationNameList.indexOf(t)<0)return;for(var r=i.animationNameList.length;r--;)if(i.animationNameList[r]==t){n=i.animations[t];break}return n}var n=this._animation[t];if(n){var o=n.frames||[],s=n.rate?parseFloat(n.rate):30;return{frames:o,frameRate:s,loop:n.loop?0:1,duration:o.length/s}}}},Object.defineProperties(Sprite.prototype,{texture:{get:function(){return this._atlas?new qc.Texture(this._atlas,this.frame):null},set:function(t){var e=this;if(e.animationType===Sprite.DRAGON_BONES&&e._boneBase&&(e.removeChild(e._boneBase),e._armature=null,e._boneBase=null),!t)return e._atlas=null,e.phaser.loadTexture(null,e.frame),void(e.animationType=Sprite.NONE_ANIMATION);t instanceof qc.Atlas&&(t=new qc.Texture(t,e.frame));var i=e._atlas=t.atlas;if(e.animationType=i.animation?i.animation.type:Sprite.NONE_ANIMATION,e.animationType===Sprite.DRAGON_BONES){var r=e._armature=qc.dragonBones.makeQcArmature(i.animation.data,i.json,i.img,i.key);if(!r)return void console.warn("makeQcArmature failed:(img:",i.img,"atlas:",i.json,"skeleton:",i.animation.data,")");e._armature=r;var n=r.display;e.addChild(n),e._boneBase=n,e.colorTint=e.colorTint,e.pivotX=e.pivotY=.5,e.maxAnchor.x=e.maxAnchor.y=.5,e.minAnchor.x=e.minAnchor.y=.5;var o=i.animation.data.armature[0].canvas;o&&(e.width=o.width,e.height=o.height);var s=e.getChildAt(0);s.pivotX=s.pivotY=.5,s.maxAnchor.x=s.maxAnchor.y=.5,s.minAnchor.x=s.minAnchor.y=.5,s.resetNativeSize()}else e.animationType===Sprite.FRAME_ANIMATION?(e._animation=i.animation.data.animations,e.phaser.animations=new Phaser.AnimationManager(e.phaser)):e.animationType===Sprite.FRAME_SAMPLES&&(e._animation=i.animation.data.samples,e.phaser.animations=new Phaser.AnimationManager(e.phaser));i.getFrame(t.frame)||(t.frame=0),e.phaser.key=i.key,e.frame=t.frame,e.paused=!1,e.animationType===Sprite.DRAGON_BONES&&e.bindDragonBonesEvent(),e.defaultAnimation&&(!e.animationNameList||e.animationNameList.indexOf(e.defaultAnimation)<0?e.defaultAnimation=null:e.playAnimation(e.defaultAnimation)),e._dispatchLayoutArgumentChanged("size"),e._onTextureChanged&&e._onTextureChanged.dispatch()}},frame:{get:function(){return this.phaser.frameName},set:function(t){if(this.texture){var e=this.texture.atlas.frameNames||[0];"string"==typeof t&&-1===e.indexOf(t)||(this.phaser.loadTexture(this.texture.atlas.key,t,!1),this._dispatchLayoutArgumentChanged("size"),this._onTextureChanged&&this._onTextureChanged.dispatch())}}},defaultAnimation:{get:function(){return this._defaultAnimation},set:function(t){""===t&&(t=null),this._defaultAnimation=t,this.playAnimation(t)}},addInfo:{get:function(){function t(i,n){for(var o=0;o<i.children.length;o++){var s=i.children[o];s.texture&&(e[n+"_"+s.name]||(e[n+"_"+s.name]={}),e[n+"_"+s.name].url=s.texture.atlas.url,r+=s.uuid+" "+s.texture),s instanceof dragonBones.PhaserArmatureDisplay&&(e[n+"_"+s.name]||(e[n+"_"+s.name]={}),e[n+"_"+s.name].x=s.x,e[n+"_"+s.name].y=s.y),s.children&&s.children.length>0&&t(s,n)}}var e={},i=this.name;t(this,i);var r=JSON.stringify(e);return r},set:function(t){function e(t,r){for(var n=0;n<t.children.length;n++){var o=t.children[n],s=r+"_"+o.name;i[s]&&(o instanceof dragonBones.PhaserArmatureDisplay?(o.x=i[s].x,o.y=i[s].y):(o.texture=null,dragonBones.game._qc.assets.find(i[s].url)?o.texture=dragonBones.game._qc.assets.find(i[s].url):o.loadImg(i[s].url))),o.children&&o.children.length>0&&e(o,r)}}var i=JSON.parse(t);this.changeData=i;var r=this.name;e(this,r)}},paused:{get:function(){return this.isPaused()},set:function(t){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:if(!this.phaser.animations.currentAnim)return;this.phaser.animations.paused=t;break;case qc.Sprite.DRAGON_BONES:this._paused=t}}},isPlaying:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return!!t&&t.isPlaying;case qc.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsPlaying();default:return!1}}},isComplete:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return!!t&&t.isFinished;case qc.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsComplete();default:return!1}}},lastAnimationName:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return t?t.name:null;case qc.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getLastAnimationName();default:return!1}}},onStart:{get:function(){return this._onStart||(this._onStart=new Phaser.Signal),this._onStart}},onFinished:{get:function(){return this._onFinished||(this._onFinished=new Phaser.Signal),this._onFinished}},onLoopFinished:{get:function(){return this._onLoopFinished||(this._onLoopFinished=new Phaser.Signal),this._onLoopFinished}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new qc.Rectangle(0,0,0,0)}},armature:{get:function(){return this._armature}},animationNameList:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:if(!this.texture)return null;var t=this.texture.atlas.animation.data.animations;return t?Object.keys(t):null;case qc.Sprite.DRAGON_BONES:return this._armature?this._armature.animation.animationNameList:null;case qc.Sprite.FRAME_SAMPLES:var e=this._animation;return e?Object.keys(e):null;default:return null}}},colorTint:{get:function(){return new Color(this.phaser.tint)},set:function(t){if(!(t instanceof Color))throw new Error("Expected:qc.Color");this.phaser.tint=t.toNumber()}},onTextureChanged:{get:function(){
return this._onTextureChanged||(this._onTextureChanged=new Phaser.Signal),this._onTextureChanged}},class:{get:function(){return"qc.Sprite"}}}),Sprite.prototype.resetNativeSize=function(){this.width=this.nativeSize.width,this.height=this.nativeSize.height},Sprite.prototype.isPaused=function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:return!!this.phaser.animations.currentAnim&&this.phaser.animations.paused;case qc.Sprite.DRAGON_BONES:return this._paused;default:return!1}};var setFrame=function(t){var e=this._qc;e._phaserImageSetFrame.call(this,t),e.animationType!==qc.Sprite.DRAGON_BONES&&(e.setWidth(e.width),e.setHeight(e.height))},_spriteWebGLAddQuad=function(t,e,i,r,n,o,s,a,h,l,c,u,p,d,f,g,y,m,_,v,x){t.currentBatchSize>=t.size&&(t.flush(),t.currentBaseTexture=e.texture.baseTexture);var T=t.colors,S=t.positions,w=4*t.currentBatchSize*t.vertSize;t.renderSession.roundPixels?(S[w]=f*i+y*r+_|0,S[w+1]=m*r+g*i+v|0,S[w+5]=f*n+y*o+_|0,S[w+6]=m*o+g*n+v|0,S[w+10]=f*s+y*a+_|0,S[w+11]=m*a+g*s+v|0,S[w+15]=f*h+y*l+_|0,S[w+16]=m*l+g*h+v|0):(S[w]=f*i+y*r+_,S[w+1]=m*r+g*i+v,S[w+5]=f*n+y*o+_,S[w+6]=m*o+g*n+v,S[w+10]=f*s+y*a+_,S[w+11]=m*a+g*s+v,S[w+15]=f*h+y*l+_,S[w+16]=m*l+g*h+v),S[w+2]=c,S[w+3]=u,S[w+7]=p,S[w+8]=u,S[w+12]=p,S[w+13]=d,S[w+17]=c,S[w+18]=d,T[w+4]=T[w+9]=T[w+14]=T[w+19]=x,t.sprites[t.currentBatchSize++]=e},spriteRenderWebGL=function(t){var e=this._qc,i=e.animationType;if(i===qc.Sprite.FRAME_SAMPLES){if(!this.visible||this.alpha<=0||!this.renderable)return;if(!this.animations.currentAnim)return;var r,n,o,s=t.spriteBatch,a=this,h=this.animations.currentAnim._frameIndex,l=e.texture.atlas.animation.data,c=l.uvs,u=e.lastAnimationName,p=e._animation[u],d=p.frames,f=a.texture,g=f.baseTexture.resolution,y=a.worldTransform,m=y.a/g,_=y.b/g,v=y.c/g,x=y.d/g,T=y.tx,S=y.ty,w=a.tint,b=a.parent.worldAlpha*a.alpha,P=p.last;w=(w>>16)+(65280&w)+((255&w)<<16);var A,C,E,I,O,M,R,L,N,q,D,B,k,F=-1;if(l.convert||(l.convert={}),l.convert[u]?E=l.convert[u]:l.convert[u]=E=new Array(d.length),0==(7&h)?(F=h>>3,E[F]||(I=[F])):h===P-1?(F=1+(h>>3),E[F]||(I=[F])):(A=h>>3,C=A+1,E[A]||E[C]?E[A]?E[C]||(I=[C]):I=[A]:I=[A,C]),I)for(var U=a.texture.baseTexture.width,z=a.texture.baseTexture.height,G=c.length>>2,W=0,j=I.length;W<j;W++){var X=I[W],V=d[X];if(V){ut=new Array(G);for(var K=0,H=V.length/10;K<H;K++){r=10*K,n=4*V[r],ut[n]=K;var Y=V[r+1],J=V[r+2],Q=V[r+3],Z=V[r+4],$=V[r+5],tt=V[r+6],et=V[r+7],it=V[r+8],rt=(c[n+2]-c[n])*U,nt=(c[n+3]-c[n+1])*z,ot=rt*-et,st=nt*-it,at=rt*(1-et),ht=nt*(1-it);V[r+1]=Y*ot+Q*st+$,V[r+2]=J*ot+Z*st+tt,V[r+3]=Y*at+Q*st+$,V[r+4]=J*at+Z*st+tt,V[r+5]=Y*at+Q*ht+$,V[r+6]=J*at+Z*ht+tt,V[r+7]=Y*ot+Q*ht+$,V[r+8]=J*ot+Z*ht+tt}l.convert[u][X]=!0,l.uvmap||(l.uvmap={}),l.uvmap[u]||(l.uvmap[u]={}),l.uvmap[u][X]=ut}else console.log(X,I)}if(F>=0)for(V=d[F],K=0,H=V.length/10;K<H;K++)r=10*K,n=4*V[r],O=V[r+1],M=V[r+2],R=V[r+3],L=V[r+4],N=V[r+5],q=V[r+6],D=V[r+7],B=V[r+8],k=V[r+9],_spriteWebGLAddQuad(s,a,O,M,R,L,N,q,D,B,c[n],c[n+1],c[n+2],c[n+3],m,_,v,x,T,S,w+(k*b<<24));else{var lt=(h-(A<<3))/(C===P?P-(A<<3):8),ct=(V=d[A],d[C]),ut=l.uvmap[u][C];for(K=0,H=V.length/10;K<H;K++)r=10*K,n=4*V[r],o=10*ut[n],isNaN(o)?(O=V[r+1],M=V[r+2],R=V[r+3],L=V[r+4],N=V[r+5],q=V[r+6],D=V[r+7],B=V[r+8],k=V[r+9]):(O=V[r+1],M=V[r+2],R=V[r+3],L=V[r+4],N=V[r+5],q=V[r+6],D=V[r+7],B=V[r+8],k=V[r+9],O+=(ct[o+1]-O)*lt,M+=(ct[o+2]-M)*lt,R+=(ct[o+3]-R)*lt,L+=(ct[o+4]-L)*lt,N+=(ct[o+5]-N)*lt,q+=(ct[o+6]-q)*lt,D+=(ct[o+7]-D)*lt,B+=(ct[o+8]-B)*lt,k+=(ct[o+9]-k)*lt),_spriteWebGLAddQuad(s,a,O,M,R,L,N,q,D,B,c[n],c[n+1],c[n+2],c[n+3],m,_,v,x,T,S,w+(k*b<<24))}return PIXI.DisplayObjectContainer.prototype._renderWebGL.call(this,t)}return i===qc.Sprite.DRAGON_BONES&&e._armature?PIXI.DisplayObjectContainer.prototype._renderWebGL.call(this,t):Phaser.Sprite.prototype._renderWebGL.call(this,t)},spriteRenderCanvas=function(t){var e=this._qc,i=e.animationType;if(i!==qc.Sprite.FRAME_SAMPLES)return i===qc.Sprite.DRAGON_BONES&&e._armature?PIXI.DisplayObjectContainer.prototype._renderCanvas.call(this,t):Phaser.Sprite.prototype._renderCanvas.call(this,t);if(!(!1===this.visible||0===this.alpha||!1===this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)&&this.animations.currentAnim){var r=t.context;if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,r.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var n,o=this.texture.baseTexture.resolution/t.resolution;!t.smoothProperty||t.scaleMode===this.texture.baseTexture.scaleMode&&r[t.smoothProperty]===(t.scaleMode===PIXI.scaleModes.LINEAR)||(t.scaleMode=this.texture.baseTexture.scaleMode,r[t.smoothProperty]=t.scaleMode===PIXI.scaleModes.LINEAR);var s=this.texture.baseTexture.width,a=this.texture.baseTexture.height;if(16777215!==this.tint){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;var h=this.texture.crop,l=h.x,c=h.y,u=h.width,p=h.height;h.x=0,h.y=0,h.width=s,h.height=a,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint),h.x=l,h.y=c,h.width=u,h.height=p}n=this.tintedTexture}else n=this.texture.baseTexture.source;var d,f,g,y,m,_,v,x,T,S,w,b=this,P=this.animations.currentAnim._frameIndex,A=e.texture.atlas.animation.data,C=A.uvs,E=e.lastAnimationName,I=e._animation[E].frames,O=b.texture.baseTexture.resolution,M=b.worldTransform,R=M.a/O,L=M.b/O,N=M.c/O,q=M.d/O,D=M.tx,B=M.ty,k=e._animation[E].last;if(0==(7&P))d=P>>3,_=I[d];else if(P===k-1)d=1+(P>>3),_=I[d];else if(f=P>>3,g=f+1,_=I[f],v=I[g],x=(P-(f<<3))/(g===k?k-(f<<3):8),A.uvmap||(A.uvmap={}),A.uvmap[E]?y=A.uvmap[E]:A.uvmap[E]=y=new Array(I.length),y[g])m=y[g];else{var F=C.length>>2;m=new Array(F),v=I[g];for(var U=0,z=v.length/10;U<z;U++)S=4*v[10*U],m[S]=U;y[g]=m}var G=this.parent.worldAlpha*b.alpha;for(U=0,z=_.length/10;U<z;U++){T=10*U,S=4*_[T];var W=_[T+1],j=_[T+2],X=_[T+3],V=_[T+4],K=_[T+5],H=_[T+6],Y=_[T+7],J=_[T+8],Q=_[T+9];g&&(w=10*m[S],isNaN(w)||(W+=(v[w+1]-W)*x,j+=(v[w+2]-j)*x,X+=(v[w+3]-X)*x,V+=(v[w+4]-V)*x,K+=(v[w+5]-K)*x,H+=(v[w+6]-H)*x,Y+=(v[w+7]-Y)*x,J+=(v[w+8]-J)*x,Q+=(v[w+9]-Q)*x));var Z=C[S]*s,$=C[S+1]*a,tt=C[S+2]*s,et=C[S+3]*a,it=W*R+j*N,rt=W*L+j*q,nt=X*R+V*N,ot=X*L+V*q,st=(K*R+H*N+D)*t.resolution,at=(K*L+H*q+B)*t.resolution,ht=tt-Z,lt=et-$,ct=ht*-Y,ut=lt*-J;t.roundPixels?(r.setTransform(it,rt,nt,ot,0|st,0|at),ct|=0,ut|=0):r.setTransform(it,rt,nt,ot,st,at),r.globalAlpha=G*(Q/255),r.drawImage(n,Z,$,ht,lt,ct/o,ut/o,ht/o,lt/o)}}var pt=this.children;for(U=0;U<pt.length;U++)pt[U]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};Sprite.prototype.getSampledAnimationBounds=function(){var t=this.animationType;if(t!==qc.Sprite.FRAME_SAMPLES)return new qc.Rectangle(0,0,0,0);var e=this.lastAnimationName;if(!e)return new qc.Rectangle(0,0,0,0);var i=this.texture.atlas.animation.data,r=i.bounds;r||(r=i.bounds={});var n=r[e];if(n)return n;var o,s,a,h,l,c,u,p,d,f,g,y,m,_,v,x,T,S,w,b,P,A,C,E,I,O,M,R,L,N,q=i.uvs,D=this.phaser.texture.baseTexture.width,B=this.phaser.texture.baseTexture.height,k=this._animation[e],F=i.convert&&i.convert[e]||{},U=1/0,z=1/0,G=-1/0,W=-1/0;for(o=0,s=k.frames.length;o<s;o++)for(a=k.frames[o],c=F[o],h=0,l=a.length/10;h<l;h++)u=10*h,p=4*a[u],c?(C=a[u+1],M=a[u+2],E=a[u+3],R=a[u+4],I=a[u+5],L=a[u+6],O=a[u+7],N=a[u+8]):(d=a[u+1],f=a[u+2],g=a[u+3],y=a[u+4],m=a[u+5],_=a[u+6],v=a[u+7],x=a[u+8],T=(q[p+2]-q[p])*D,S=(q[p+3]-q[p+1])*B,w=T*-v,b=S*-x,P=T*(1-v),A=S*(1-x),C=d*w+g*b+m,M=f*w+y*b+_,E=d*P+g*b+m,R=f*P+y*b+_,I=d*P+g*A+m,L=f*P+y*A+_,O=d*w+g*A+m,N=f*w+y*A+_),U=Math.min(U,C,E,I,O),G=Math.max(G,C,E,I,O),z=Math.min(z,M,R,L,N),W=Math.max(W,M,R,L,N);return n=r[e]=new qc.Rectangle(U,z,G-U,W-z),n},Sprite.prototype.setWidth=function(t){Node.prototype.setWidth.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.width=t)},Sprite.prototype.setHeight=function(t){Node.prototype.setHeight.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.height=t)},Sprite.prototype.getMeta=function(){var t=qc.Serializer,e=qc.Node.prototype.getMeta.call(this);return e.texture=t.TEXTURE,e.frame=t.AUTO,e.defaultAnimation=t.STRING,e.addInfo=t.STRING,e};var UIText=qc.UIText=function(t,e,i){qc.Node.call(this,new Phaser.Group(t.phaser,null),e,i),this.textPhaser=new Phaser.Text(t.phaser),this.textPhaser._nqc=this,this.textPhaser.wordWrapWidth=this.width,this.textPhaser.wordWrapHeight=this.height,this.phaser.addChildAt(this.textPhaser,0),this.textRealWidth=0,this.textRealHeight=0,this.fontSize=12,this._glowText=null,this.name="UIText",this._data="",this._colors=[],this.color=Color.black,this.colorfill,this._gradient=!1,this.startColor=Color.red,this.endColor=Color.black,this._gradientByLine=!0,this._fontFamily=UIText.SYSTEMFONT,this.textPhaser.determineFontProperties=UIText._phaserDetermineFontProperties,this.shadowBlur=10,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowColor=Color.shadow,this._enableShadow=!1,this._enableGlow=!1,this.glowColor=Color.red,this.stroke=Color.black,this._strokeThickness=0,this._glowBlur=1,this._wrap=!1,this._wrapWidth=this.width,this._wrapHeight=this.height,this._autoSize=!1,this._onPhaseTextSizeChange=new Phaser.Signal,this._onPhaseTextSizeChange.add(function(t,e){this.autoSize&&(this.width=t,this.height=e)},this);var r=i!==undefined;!0!==r&&(this.bold=!1,this.alignH=UIText.LEFT,this.alignV=UIText.MIDDLE,this.overflow=!1);var n=this;this.onTransformChanged.add(function(t,e){n.textPhaser&&n.game.renderInRenderTexture&&!n.isUpating&&(n.isUpating=!0,n.textPhaser.updateText(),n.isUpating=!1)})};UIText.prototype=Object.create(qc.Node.prototype),UIText.prototype.constructor=UIText,UIText.LEFT=0,UIText.RIGHT=1,UIText.CENTER=2,UIText.JUSTIFY=3,UIText.TOP=0,UIText.BOTTOM=1,UIText.MIDDLE=2,UIText.SYSTEMFONT=0,UIText.WEBFONT=1,UIText.BITMAPFONT=2,UIText._SYMBOL_COLOR=0,UIText._SYMBOL_END_COLOR=1,UIText.scaleImmediatelyUpdateText=!0,UIText.freezeScaleUpdateText=!1,Object.defineProperties(UIText.prototype,{colorTint:{get:function(){return new Color(this.textPhaser.tint)},set:function(t){if(t=t||new Color(16777215),!(t instanceof Color))throw new Error("Expected qc.Color");this.textPhaser.tint=t.toNumber()}},autoSize:{get:function(){return this._autoSize},set:function(t){t!==this._autoSize&&(this._autoSize=t,t&&this.textPhaser&&(this.width=this.textPhaser.width,this.height=this.textPhaser.height))}},fontFamily:{get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._changeText(""),this._isTransformDirty=!0)}},alignH:{get:function(){return this._alignH},set:function(t){t!==this._alignH&&(this._alignH=t,0==t&&(this.textPhaser.boundsAlignH="left"),1==t&&(this.textPhaser.boundsAlignH="right"),2==t&&(this.textPhaser.boundsAlignH="center"),3==t&&(this.textPhaser.boundsAlignH="justify"),this.textPhaser.dirty=!0,this._adjustTextPos(),this._enableGlow&&(this.enableGlow=!this.enableGlow,this.enableGlow=!this.enableGlow),this._isTransformDirty=!0)}},alignV:{get:function(){return this._alignV},set:function(t){t!==this._alignV&&(this._alignV=t,0==t&&(this.textPhaser.boundsAlignV="top"),2==t&&(this.textPhaser.boundsAlignV="middle"),1==t&&(this.textPhaser.boundsAlignV="bottom"),this.textPhaser.dirty=!0,this._adjustTextPos(),this._enableGlow&&(this.enableGlow=!this.enableGlow,this.enableGlow=!this.enableGlow),this._isTransformDirty=!0)}},font:{get:function(){var t=this.textPhaser.font.replace(/\'/g,"");return this.fontFamily!==UIText.SYSTEMFONT?this.game.assets.find(this._fontKey||t):t},set:function(t){if(t){var e=t;if(this.fontFamily!==UIText.SYSTEMFONT){if(!(t instanceof qc.Font))return void this.game.log.error("Expected qc.Font");if(this.fontFamily!==t._fontFamily)return void this.game.log.error("Invalid font asset");this.fontFamily===UIText.WEBFONT?(e=window.__wx&&t.wxFontName?t.wxFontName:t.uuid,this._fontKey=t.uuid):(e=t.url,this._fontKey=t.url)}else if("string"!=typeof t)return void this.game.log.error("Expected string");e!==this.textPhaser.font&&(this._changeText(e),this.enableGlow&&(this._glowText.font=e),this._isTransformDirty=!0)}}},bold:{get:function(){return"normal"!==this.textPhaser.fontWeight},set:function(t){var e=t?"bold":"normal";e!==this.textPhaser.fontWeight&&(this.textPhaser.fontWeight=e,this._enableGlow&&(this._glowText.fontWeight=e),this._isTransformDirty=!0)}},italic:{get:function(){return"normal"!==this.textPhaser.fontStyle},set:function(t){var e=t?"italic":"normal";e!==this.textPhaser.fontStyle&&(this.textPhaser.fontStyle=e,this._enableGlow&&(this._glowText.fontStyle=e),this._isTransformDirty=!0)}},fontSize:{get:function(){return this.textPhaser.fontSize},set:function(t){if("number"!=typeof t)throw new Error("Expected number");t!==this.textPhaser.fontSize&&(this.textPhaser.fontSize=t,this._enableGlow&&(this._glowText.fontSize=t),this._isTransformDirty=!0,this._changeGradient(!0))}},color:{get:function(){return new Color(this.colorfill)},set:function(t){if(!(t instanceof Color))throw new Error("Expected qc.Color");if(!this._gradient){var e=t.toString("rgb");e!==this.textPhaser.fill&&(this.colorfill=e,this.textPhaser.fill=e,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}}},text:{get:function(){return this._data},set:function(t){if("string"!=typeof t)throw new Error("Expected string");t!==this._data&&(this._colors=[],this._data=t,this._parseTextColor(t),this._setTextColor(this.textPhaser),this._enableGlow&&(this._glowText.text=this.textPhaser.text),this._isTransformDirty=!0,this._changeGradient(!0))}},lineSpacing:{get:function(){return this.textPhaser.lineSpacing},set:function(t){t!==this.textPhaser.lineSpacing&&(this.textPhaser.lineSpacing=t,this._enableGlow&&(this._glowText.lineSpacing=t),this._isTransformDirty=!0,this._changeGradient(!0))}},lineHeight:{get:function(){return this.textPhaser.lineHeight},set:function(t){t!==this.textPhaser.lineHeight&&(this.textPhaser.lineHeight=t,this._enableGlow&&(this._glowText.lineHeight=t),this._isTransformDirty=!0)}},letterSpacing:{get:function(){return this.textPhaser.letterSpacing},set:function(t){t!==this.textPhaser.letterSpacing&&(this.textPhaser.letterSpacing=t,this._enableGlow&&(this._glowText.lineSpacing=t),this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},enableUnderline:{get:function(){return this.textPhaser.enableUnderline},set:function(t){t!==this.textPhaser.enableUnderline&&(this.textPhaser.enableUnderline=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},underlineColor:{get:function(){return this.textPhaser.underlineColor},set:function(t){t!==this.textPhaser.underlineColor&&(this.textPhaser.underlineColor=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},underlineWidth:{get:function(){return this.textPhaser.underlineWidth},set:function(t){t!==this.textPhaser.underlineWidth&&(this.textPhaser.underlineWidth=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},underlineSpacing:{get:function(){return this.textPhaser.underlineSpacing},set:function(t){t!==this.textPhaser.underlineSpacing&&(this.textPhaser.underlineSpacing=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},enableDeleteline:{get:function(){return this.textPhaser.enableDeleteline},set:function(t){t!==this.textPhaser.enableDeleteline&&(this.textPhaser.enableDeleteline=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},deletelineColor:{get:function(){return this.textPhaser.deletelineColor},set:function(t){t!==this.textPhaser.deletelineColor&&(this.textPhaser.deletelineColor=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},deletelineWidth:{get:function(){return this.textPhaser.deletelineWidth},set:function(t){t!==this.textPhaser.deletelineWidth&&(this.textPhaser.deletelineWidth=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},deletelineSpacing:{get:function(){return this.textPhaser.deletelineSpacing},set:function(t){t!==this.textPhaser.deletelineSpacing&&(this.textPhaser.deletelineSpacing=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},wrap:{get:function(){return this._wrap},set:function(t){t!==this._wrap&&(this._wrap=t,this.textPhaser.wordWrap=t,this.textPhaser.useAdvancedWrap=!0,this.textPhaser.style.wordWrap=this._wrap,this.textPhaser.dirty=!0,this._enableGlow&&(this._glowText.wordWrap=t),this._isTransformDirty=!0,this._changeGradient(!0))}},overflow:{get:function(){var t=this.getScript("qc.NodeMask");return!(!t||!t.enable)},set:function(t){var e=this.getScript("qc.NodeMask");e||(e=this.addScript("qc.NodeMask")),e.enable=t}},pivotX:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotX").get.call(this)},set:function(t){Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotX").set.call(this,t),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0}},pivotY:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotY").get.call(this)},set:function(t){Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotY").set.call(this,t),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0}},width:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"width").get.call(this)},set:function(t){t!==this.width&&(Object.getOwnPropertyDescriptor(qc.Node.prototype,"width").set.call(this,t),this._wrapWidth=t,this._enableGlow&&(this._glowText.wordWrapWidth=t,this._glowText.x=this.textPhaser.x,this._glowText.y=this.textPhaser.y,this._glowText.dirty=!0),this.textPhaser&&(this.textPhaser.wordWrapWidth=t,this._adjustTextPos()),this._isTransformDirty=!0)}},height:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"height").get.call(this)},set:function(t){t!==this.height&&(Object.getOwnPropertyDescriptor(qc.Node.prototype,"height").set.call(this,t),this._wrapHeight=t,this.textPhaser&&(this.textPhaser.dirty=!0,this.textPhaser.wordWrapHeight=t,this._adjustTextPos()),this._isTransformDirty=!0)}},class:{get:function(){return"qc.UIText"}},startColor:{get:function(){return new Color(this._startColor)},set:function(t){if(!(t instanceof Color))throw new Error("Expected qc.Color");var e=t.toString();this._startColor=e,this.textPhaser.dirty=!0,this.textPhaser.startColor=e,this._changeGradient(!0)}},endColor:{get:function(){return new Color(this._endColor)},set:function(t){if(!(t instanceof Color))throw new Error("Expected qc.Color");var e=t.toString();this._endColor=e,this.textPhaser.dirty=!0,this.textPhaser.endColor=e,this._changeGradient(!0)}},gradient:{get:function(){return this._gradient},set:function(t){t!==this._gradient&&(this._gradient=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0,this.textPhaser.gradient=t,this._changeGradient(!0))}},gradientByLine:{get:function(){return this._gradientByLine},set:function(t){t!==this._gradientByLine&&(this._gradientByLine=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0,this.textPhaser.gradientByLine=t,this._changeGradient(!0))}},stroke:{get:function(){return new Color(this.textPhaser.stroke)},set:function(t){if(!(t instanceof Color))throw new Error("Expected qc.Color");var e=t.toString();e!==this.textPhaser.stroke&&(this.textPhaser.stroke=e,this._isTransformDirty=!0)}},strokeThickness:{get:function(){return this._strokeThickness},set:function(t){t!==this._strokeThickness&&(this._strokeThickness=t,this.textPhaser.strokeThickness=t,this._enableGlow&&(this._glowText.strokeThickness=this.textPhaser.strokeThickness,this._glowText.dirty=!0),this.textPhaser.shadowStroke=t>0&&this.enableShadow,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},enableShadow:{get:function(){return this._enableShadow},set:function(t){this._enableShadow=t,this.textPhaser.shadowFill=t,this.textPhaser.shadowStroke=t&&this.strokeThickness>0,this.textPhaser.dirty=!0,this._isTransformDirty=!0}},shadowColor:{get:function(){return new Color(this.textPhaser.shadowColor)},set:function(t){if(!(t instanceof Color))throw new Error("Expected qc.Color");var e=t.toString();e!==this.textPhaser.shadowColor&&(this.textPhaser.style.shadowColor=e,this.textPhaser.shadowColor=e,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},shadowBlur:{get:function(){return this.textPhaser.shadowBlur},set:function(t){t!==this.textPhaser.shadowBlur&&(this.textPhaser.style.shadowBlur=t,this.textPhaser.shadowBlur=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},shadowOffsetX:{get:function(){return this.textPhaser.shadowOffsetX},set:function(t){this.textPhaser.shadowOffsetX=t,this.textPhaser.style.shadowOffsetX=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0}},shadowOffsetY:{get:function(){return this.textPhaser.shadowOffsetY},set:function(t){this.textPhaser.shadowOffsetY=t,this.textPhaser.style.shadowOffsetY=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0}},glowColor:{get:function(){return new Color(this._glowColor)},set:function(t){if(!(t instanceof Color))throw new Error("Expected qc.Color");var e=t.toString();e!==this._glowColor&&(this._glowColor=e,this._glowText&&(this._glowText.fill=e,this._glowText.stroke=e,this._glowText.shadowColor=e,this._glowText.dirty=!0))}},glowBlur:{get:function(){return this._glowBlur},set:function(t){t!==this._glowBlur&&(this._glowBlur=t,this.enableGlow&&(this._glowText.filterX.blur=t,this._glowText.filterY.blur=t))}},enableGlow:{get:function(){return this._enableGlow},set:function(t){if(t!==this._enableGlow){if(this._enableGlow=t,t){this._glowText=new Phaser.Text(this.game.phaser),this._glowText._nqc=this,this._copyProperty(this._glowText,this.textPhaser),this._glowText.x=this.textPhaser.x,this._glowText.y=this.textPhaser.y,this._glowText.fill=this._glowColor,this._glowText.stroke=this._glowColor,this._glowText.shadowColor=this._glowColor,this._glowText.scale=this.textPhaser.scale,this._glowText.rotation=this.textPhaser.rotation,this._glowText.determineFontProperties=UIText._phaserDetermineFontProperties,this._glowText.font=this.textPhaser.font,this._glowText.enableGlow=!1,this._glowText.enableShadow=!1,this.phaser.addChildAt(this._glowText,0);var e=new qc.Filter.BlurX(this.game),i=new qc.Filter.BlurY(this.game);e.blur=this.glowBlur,i.blur=this.glowBlur,this._glowText.filters=[e,i],this._glowText.filterX=e,this._glowText.filterY=i}else this._glowText.parent.removeChild(this._glowText),this._glowText.destroy(),this._glowText=null,this.textPhaser.dirty=!0;this._isTransformDirty=!0}}},nativeSize:{get:function(){var t=this.rect;return t.width=this.textRealWidth,t.height=this.textRealHeight,t}}}),UIText.prototype._changeGradient=function(t){if(this._gradient){if(!this.gradientByLine){var e;!t&&this._grid||(this.textPhaser.context.clearRect(0,0,this.textPhaser._width,this.textPhaser._height),this._grid=this.textPhaser.context.createLinearGradient(0,0,0,this.textPhaser.height));var i=this.textPhaser.text;if(this.textPhaser.style.wordWrap)i=i.replace(/(?:\r\n|\r|\n)/g,"\n"),e=this.textPhaser.runWordWrap(i,this.textPhaser.wordWrapWidth);else{e=i.split(/(?:\r\n|\r|\n)/);for(var r=0;r<e.length-1;r++)e[r]+="\n"}e.length;this._grid.addColorStop(0,this.startColor),this._grid.addColorStop(1,this.endColor),this.textPhaser.fill=this._grid}}else this.textPhaser.fill=this.color.toString()},UIText.prototype._changeText=function(t){var e,i=PIXI.BitmapText.fonts[t];i?(e=new Phaser.BitmapText(this.game.phaser,0,0,t),this._glowText&&(this._glowText.visible=!1)):(e=new Phaser.Text(this.game.phaser),e.determineFontProperties=UIText._phaserDetermineFontProperties,this._glowText&&(this._glowText.visible=!0)),e.font=t,e._nqc=this,this.textPhaser.font=t,this._copyProperty(e,this.textPhaser),e.style.shadowFill=this.enableShadow,e.x=this.textPhaser.x,e.y=this.textPhaser.y,this._glowText&&(this._glowText.font=e.font);var r=this.phaser.getChildIndex(this.textPhaser);this.phaser.removeAt?this.phaser.removeAt(r):this.phaser.removeChildAt(r),this.phaser.addAt?this.phaser.addAt(e,r):this.phaser.addChildAt(e,r),this.textPhaser.destroy(),this.textPhaser=e,this._isTransformDirty=!0,this._setTextColor(this.textPhaser)},UIText.prototype.setWidth=function(t){qc.Node.prototype.setWidth.call(this,t),this._wrapWidth=t,this.textPhaser&&(this.textPhaser.wordWrapWidth=t,this._adjustTextPos())},UIText.prototype.setHeight=function(t){qc.Node.prototype.setHeight.call(this,t),this._wrapHeight=t,this.textPhaser&&(this.textPhaser.dirty=!0,this.textPhaser.wordWrapHeight=t,this._adjustTextPos())},UIText.prototype.postUpdate=function(){var t=this.textPhaser;this._adjustTextPos(),t.dirty&&t.updateText()},UIText.prototype._copyProperty=function(t,e){t.align=e.align,t.boundsAlignH=e.boundsAlignH,t.boundsAlignV=e.boundsAlignV,t.fontWeight=e.fontWeight,t.fontSize=e.fontSize,t.lineSpacing=e.lineSpacing,t.lineHeight=e.lineHeight,t.letterSpacing=e.letterSpacing,t.enableUnderline=e.enableUnderline,t.underlineColor=e.underlineColor,t.underlineWidth=e.underlineWidth,t.underlineSpacing=e.underlineSpacing,t.enableDeleteline=e.enableDeleteline,t.deletelineColor=e.deletelineColor,t.deletelineWidth=e.deletelineWidth,t.deletelineSpacing=e.deletelineSpacing,t.wordWrap=this._wrap,t.name=e.name,t.scale=e.scale,t.pivot=e.pivot,t.rotation=e.rotation,t.alpha=e.alpha,t.visible=e.visible,t.renderable=e.renderable,t.mask=e.mask,t.text=e.text,t.wordWrapWidth=this._wrapWidth,t.wordWrapHeight=this._wrapHeight,t.stroke=e.stroke,t.strokeThickness=e.strokeThickness,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.shadowBlur=e.shadowBlur,t.fill=e.fill,t.fontFamily=this.fontFamily,t.fontWeight=e.fontWeight,t.fontStyle=e.fontStyle,t.font=e.font,t.gradient=e.gradient,t.startColor=e.startColor,t.endColor=e.endColor},UIText.prototype._getColor=function(t){switch(t){case"red":return"#8d1d16";case"gray":return"#6a6a6a";case"gold":return"#fde67b";case"yellow":return"#f3e1a3";case"blue":return"#3e65c7";case"brown":return"#322310";case"green":return"#168d3d";case"light_green":return"#7fe39e";case"light_blue":return"#9ed4ec";case"light_red":return"#f86662";case"cyan":return"#52b1ff";case"black":return"#101010";case"gray2":return"#c0c0c0";case"orange":return"#f29f55";case"light_orange":return"#f2c440";case"orange2":return"#9d621c"}},UIText.prototype._parseSymbol=function(t,e,i){var r={result:!1};if("["!==t[e])return r;for(var n=e;++n;){if("["===t[n]||n>=t.length||n-e>25)return r;if("]"===t[n])break}var o=n-e;if(o>2&&"#"===t[e+1])r.color=t.slice(e+1,n),r.result=!0,r.type=UIText._SYMBOL_COLOR;else if(o>6&&"r"===t[e+1]&&"g"===t[e+2]&&"b"===t[e+3])r.color=t.slice(e+1,n),r.result=!0,r.type=UIText._SYMBOL_COLOR;else if("-"===t[e+1]&&"]"===t[e+2])i.length>0&&(r.result=!0),r.type=UIText._SYMBOL_END_COLOR;else if(o>=4){var s=t.slice(e+1,n),a=this._getColor(s);a&&(r.color=a,r.result=!0,r.type=UIText._SYMBOL_COLOR)}return r.result&&(r.pos=n),r},UIText.prototype._pushColor=function(t,e){var i={};i.color=t,i.pos=e,this._colors.push(i),this._isTransformDirty=!0},UIText.prototype._setTextColor=function(t){if(t.clearColors&&t.clearColors(),t.addColor){for(var e=0;e<this._colors.length;e++){var i="defaultColor"===this._colors[e].color?"defaultColor":this._colors[e].color;t.addColor(i,this._colors[e].pos)}this._isTransformDirty=!0}},UIText.prototype._parseTextColor=function(t){t=t.replace(/(?:\r\n|\r|\n)/g,"\n");for(var e="",i=[],r=0;r<t.length;r++){var n=this._parseSymbol(t,r,i);if(n.result){if(r=n.pos,n.type===UIText._SYMBOL_COLOR)i.push(n.color),this._pushColor(n.color,e.length);else if(n.type===UIText._SYMBOL_END_COLOR){i.pop();var o=i.length>0?i[i.length-1]:"defaultColor";this._pushColor(o,e.length)}}else e+=t[r]}this.textPhaser.text=e,this._isTransformDirty=!0},UIText.prototype.getMeta=function(){var t=Node.prototype.getMeta.call(this);return t.fontFamily=Serializer.NUMBER,t.alignH=Serializer.NUMBER,t.alignV=Serializer.NUMBER,t.font=Serializer.FONT,t.bold=Serializer.BOOLEAN,t.italic=Serializer.BOOLEAN,t.fontSize=Serializer.NUMBER,t.color=Serializer.COLOR,t.text=Serializer.STRING,t.lineSpacing=Serializer.NUMBER,t.lineHeight=Serializer.NUMBER,t.letterSpacing=Serializer.NUMBER,t.wrap=Serializer.BOOLEAN,t.enableGlow=Serializer.BOOLEAN,t.startColor=Serializer.COLOR,t.endColor=Serializer.COLOR,t.gradient=Serializer.BOOLEAN,t.gradientByLine=Serializer.BOOLEAN,t.stroke=Serializer.COLOR,t.strokeThickness=Serializer.NUMBER,t.glowColor=Serializer.COLOR,t.autoSize=Serializer.BOOLEAN,t.shadowColor=Serializer.COLOR,t.shadowBlur=Serializer.NUMBER,t.shadowOffsetX=Serializer.NUMBER,t.shadowOffsetY=Serializer.NUMBER,t.enableShadow=Serializer.BOOLEAN,t.enableUnderline=Serializer.BOOLEAN,t.underlineColor=Serializer.COLOR,t.underlineWidth=Serializer.NUMBER,t.underlineSpacing=Serializer.NUMBER,t.enableDeleteline=Serializer.BOOLEAN,t.deletelineColor=Serializer.COLOR,t.deletelineWidth=Serializer.NUMBER,t.deletelineSpacing=Serializer.NUMBER,t},UIText.prototype._adjustTextPos=function(){this.textPhaser.setTextBounds(0,0,this.width,this.height),this.textPhaser.x=-this.pivotX*this.width,this.textPhaser.y=-this.pivotY*this.height,this._isTransformDirty=!0},UIText.prototype._refreshWebFont=function(t){/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)||/['",]/.exec(t)||(t="'"+t+"'"),t===this.textPhaser.font&&(window.__wx&&(this.font=this.font),this.textPhaser.dirty=!0,this._glowText&&(this._glowText.dirty=!0),this._isTransformDirty=!0)},UIText._phaserUpdateText=function(){},UIText._phaserDetermineFontProperties=function(t){var e=PIXI.Text.fontPropertiesCache[t];if(!e){e={},PIXI.Text.fontPropertiesCanvas||(PIXI.Text.fontPropertiesCanvas=PIXI.sharedCanvas,PIXI.Text.fontPropertiesContext=PIXI.Text.fontPropertiesCanvas.getContext("2d"));var i=PIXI.Text.fontPropertiesCanvas,r=PIXI.Text.fontPropertiesContext;r.font=t;var n=Math.ceil(r.measureText("|MÉq").width);0===n&&(n=1);var o=Math.ceil(r.measureText("M").width),s=2*o;0===s&&(s=1),o=1.4*o|0,i.width=n,i.height=s,r.fillStyle="#f00",r.fillRect(0,0,n,s),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|MÉq",0,o);var a,h,l=r.getImageData(0,0,n,s).data,c=l.length,u=4*n,p=0,d=!1;for(a=0;a<o;a++){for(h=0;h<u;h+=4)if(255!==l[p+h]){d=!0;break}if(d)break;p+=u}for(e.ascent=o-a,p=c-u,d=!1,a=s;a>o;a--){for(h=0;h<u;h+=4)if(255!==l[p+h]){d=!0;break}if(d)break;p-=u}e.descent=a-o,e.fontSize=e.ascent+e.descent,PIXI.Text.fontPropertiesCache[t]=e}return e};var Button=qc.Button=function(t,e,i){qc.UIImage.call(this,t,e,i),this.name="Button",this.onStateChange=new qc.Signal;var r=i!==undefined;if(!0!==r){this.text=t.add.text(this),this.text.text="Button",this.text.name="Text",this.text.interactive=!1,this.interactive=!0,this.state=qc.UIState.NORMAL;var n=this.addScript("qc.TransitionBehaviour");n.target=this,this.width=120,this.height=40,this.text.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),this.text.left=0,this.text.right=0,this.text.top=0,this.text.bottom=0,this.text.alignH=UIText.CENTER}var o=this;this.onDown.add(function(){o.state!==qc.UIState.DISABLED&&(o.state=qc.UIState.PRESSED)}),this.onUp.add(function(){o.state===qc.UIState.PRESSED&&(o.state=qc.UIState.NORMAL)}),this._onNativeElementClick=this._processNativeClick.bind(this)};Button.prototype=Object.create(qc.UIImage.prototype),Button.prototype.constructor=Button,Object.defineProperties(Button.prototype,{state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},colorTint:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"colorTint").get.call(this)},set:function(t){Object.getOwnPropertyDescriptor(qc.Node.prototype,"colorTint").set.call(this,t),this.text&&(this.text.colorTint=t)}},supportNativeEvent:{get:function(){return this._supportNativeEvent},set:function(t){t!==this._supportNativeEvent&&(this._supportNativeEvent=t,this._checkNativeElement())}},onNativeClick:{get:function(){return this._onNativeClick||(this._onNativeClick=new Phaser.Signal),this._onNativeClick}},class:{get:function(){return"qc.Button"}}}),Button.prototype.getMeta=function(){var t=qc.Serializer,e=qc.UIImage.prototype.getMeta.call(this);return e.text=t.NODE,e.state=t.NUMBER,e.supportNativeEvent=t.BOOLEAN,e},Button.prototype.update=function(t){
this.isWorldVisible()&&this.supportNativeEvent?(this._checkNativeElement(),t&&this._updateNativeElement()):this._removeNativeElement()},Button.prototype.onVisibleChange=function(){this.update(!0)},Button.prototype.onDestroy=function(){this._removeNativeElement(),qc.UIImage.prototype.onDestroy.call(this)},Button.prototype._checkNativeElement=function(){this.supportNativeEvent&&this.worldVisible&&!this._nativeElement?this._createNativeElement():!this._nativeElement||this.supportNativeEvent&&this.worldVisible||this._removeNativeElement()},Button.prototype._createNativeElement=function(){var t=this;if(!t._nativeElement){var e=t._nativeElement=document.createElement("div");e.addEventListener("click",t._onNativeElementClick,!1),e.addEventListener("touchstart",t._onNativeElementClick,!1);var i=e.style;i.position="absolute",i.padding=0,i.margin=0,i.border=0,i.outline=0,i.background="none",t.game.world.frontDomRoot.appendChild(e),t._updateNativeElement(),t.phaser.worldTransformChangedCallback=t._updateNativeElement.bind(t),t.phaser.worldTransformChangedContext=t}},Button.prototype._removeNativeElement=function(){var t=this._nativeElement;t&&(this._nativeElement=null,t.removeEventListener("click",this._onNativeElementClick,!1),t.removeEventListener("touchstart",this._onNativeElementClick,!1),qc.Util.removeHTML(t))},Button.prototype._updateNativeElement=function(){var t=this,e=t._nativeElement;e&&(e._lastUpdate=t.game.time.now,qc.Util.updateTransform(t,e))},Button.prototype._processNativeClick=function(t){this.worldVisible||this._checkNativeElement(),this._onNativeClick&&this._onNativeClick.getNumListeners()>0&&this._onNativeClick.dispatch(this,t)};var Toggle=qc.Toggle=function(t,e,i){qc.Node.call(this,new Phaser.Group(t.phaser,null),e,i),this.name="Toggle",this.interactive=!0,this.onStateChange=new qc.Signal,this.onValueChange=new qc.Signal,this.canValueChange=new qc.Signal;var r=i!==undefined;if(!0!==r){this.background=t.add.image(this),this.background.name="Background",this.background.interactive=!1,this.background.width=80,this.background.height=80,this.checkMark=t.add.image(this.background),this.checkMark.name="CheckMark",this.checkMark.interactive=!1,this.text=t.add.text(this),this.text.text="Button",this.text.name="Text",this.text.interactive=!1,this.on=!1,this.state=qc.UIState.NORMAL,this.checkMark.pivotX=.5,this.checkMark.pivotY=.5,this.checkMark.setAnchor(new qc.Point(.5,.5),new qc.Point(.5,.5)),this.checkMark.anchoredX=0,this.checkMark.anchoredY=0,this.checkMark.width=50,this.checkMark.height=50,this.text.x=this.background.width+5,this.text.height=this.background.height;var n=this.addScript("qc.TransitionBehaviour");n.target=this.background,n.transition=qc.Transition.TEXTURE_SWAP}var o=this;this.onDown.add(function(){o.state!==qc.UIState.DISABLED&&(o.state=qc.UIState.PRESSED)}),this.onUp.add(function(){o.state===qc.UIState.PRESSED&&(o.state=qc.UIState.NORMAL)}),this.onClick.add(function(){o.on=!o.on,o.checkMark.visible=o.on})};Toggle.prototype=Object.create(qc.Node.prototype),Toggle.prototype.constructor=Toggle,Object.defineProperties(Toggle.prototype,{on:{get:function(){return!!this._on},set:function(t){var e=this.on,i={};this.canValueChange.dispatch(this,t,e,i),i.ignore||(this._on=t,this.checkMark.visible=t,e!==t&&this.onValueChange.dispatch(this))}},state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},class:{get:function(){return"qc.Toggle"}}}),Toggle.prototype.getMeta=function(){var t=qc.Serializer,e=qc.Node.prototype.getMeta.call(this);return e.background=t.NODE,e.checkMark=t.NODE,e.text=t.NODE,e.on=_CUSTOM_FIELD("on",t.BOOLEAN),e.state=_CUSTOM_FIELD("state",t.NUMBER),e};var Sound=qc.Sound=function(t,e,i){this.soundPhaser=new Phaser.Sound(t.phaser),this.soundPhaser._qc=this,this._loop=!1,this.game=t,qc.Node.call(this,new Phaser.Group(this.game.phaser,null),e,i),this.name="Sound",this._related(),t.phaser.sound._sounds.push(this.soundPhaser),this._playOnAwake=!1,this.destroyWhenStop=!0};Sound.prototype=Object.create(qc.Node.prototype),Sound.prototype.constructor=Sound,Object.defineProperties(Sound.prototype,{loop:{get:function(){return this.soundPhaser.loop},set:function(t){this._loop=t,this.soundPhaser.loop=t,this.soundPhaser._sound&&(this.soundPhaser._sound.loop=t)}},audio:{get:function(){return this.game.assets.find(this.soundPhaser.key)},set:function(t){var e=this.audio,i=this.soundPhaser;if(!t)return window.__wx&&e&&this.game.assets.unload(e),void(i.key=t);if(!e||e.key!==t.key){var r=t.key;if(i&&i.key){var n=this.loop,o=this.mute,s=this.volume;i.destroy(),window.__wx&&e&&this.game.assets.unload(e),i=this.soundPhaser=new Phaser.Sound(this.game.phaser,r),i._qc=this,this._related(),this.game.phaser.sound._sounds.push(i),this.loop=n,this.mute=o,this.volume=s}else i.key=r,i.usingAudioTag&&(i.game.cache.getSound(r)&&i.game.cache.isSoundReady(r)?(i._sound=i.game.cache.getSoundData(r),i.totalDuration=0,i._sound.duration&&(i.totalDuration=i._sound.duration)):i.game.cache.onSoundUnlock.add(i.soundHasUnlocked,i))}}},volume:{get:function(){return this.soundPhaser.volume},set:function(t){this.soundPhaser.volume=t}},playOnAwake:{get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},mute:{get:function(){return this.soundPhaser.mute},set:function(t){this.soundPhaser.mute=t}},destroyWhenStop:{get:function(){return this._destroyWhenStop||!1},set:function(t){this._destroyWhenStop=t}},class:{get:function(){return"qc.Sound"}},isPlaying:{get:function(){return this.soundPhaser.isPlaying},set:function(t){t?this.play():this.stop()}},isPaused:{get:function(){return this.soundPhaser.paused}}}),Sound.prototype._dispatchAwake=function(){var t=this;Node.prototype._dispatchAwake.call(t),!t.game.device.editor&&t.playOnAwake&&t.play()},Sound.prototype._related=function(){var t=this;t.onDecoded=t.soundPhaser.onDecoded,t.onStop=t.soundPhaser.onStop,this.onStop.add(function(e){!t.game.device.editor&&t.destroyWhenStop&&t.destroy()},t),t.onLoop=t.soundPhaser.onLoop},Sound.prototype.play=function(){if(this.isPaused)return this.soundPhaser.resume(),this;this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio&&(this.soundPhaser._sound.onended=null);var t=this.marker?this.marker.name:null;return this.soundPhaser.play(t),this},Sound.prototype.fadeIn=function(t){this.soundPhaser.fadeIn(t)},Sound.prototype.fadeOut=function(t){this.soundPhaser.fadeOut(t)},Sound.prototype.pause=function(){this.soundPhaser.pause()},Sound.prototype.resume=function(){this.soundPhaser.resume()},Sound.prototype.stop=function(){this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio&&(this.soundPhaser._sound.onended=null),this.soundPhaser.stop()},Sound.prototype.addMarker=function(t,e,i){this.removeMarker(),this.marker={},this.marker.name="s",this.marker.start=t,this.marker.duration=e,this.marker.volume=i,this.soundPhaser.addMarker(this.marker.name,t,e,i)},Sound.prototype.removeMarker=function(){this.marker&&(this.soundPhaser.currentMarker="",this.soundPhaser.markers={},this.marker=null)},Sound.prototype.onDestroy=function(){if(window.__wx){var t=this.audio;t&&this.game.assets.unload(t)}this.game.phaser.sound.remove(this.soundPhaser),qc.Node.prototype.onDestroy.call(this)},Sound.prototype.getMeta=function(){var t=qc.Serializer,e=qc.Node.prototype.getMeta.call(this);return e.audio=t.AUDIO,e.loop=t.BOOLEAN,e.volume=t.NUMBER,e.playOnAwake=t.BOOLEAN,e.mute=t.BOOLEAN,e.destroyWhenStop=t.BOOLEAN,e};var ScrollView=qc.ScrollView=function(t,e,i){qc.UIImage.call(this,t,e,i),this.name="ScrollView",this.canHorizontal=!0,this.canVertical=!0,this.movementType=ScrollView.MOVEMENT_ELASTIC,this.elasticity=1,this.inertia=!0,this.decelerationRate=.03,this.scrollSensitivity=1,this.propagationScroll=!1,this.onValueChange=new Phaser.Signal,this._contentRect=null,this._viewRect=null,this._preContentPosition=null,this._preContentRect=null,this._preViewRect=null,this._velocity=new qc.Point(0,0),this._isDragging=!1,this.onWheel.add(this._doWheel,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this)};ScrollView.prototype=Object.create(qc.UIImage.prototype),ScrollView.prototype.constructor=ScrollView,Object.defineProperties(ScrollView.prototype,{class:{get:function(){return"qc.ScrollView"}},content:{get:function(){return this._content&&this._content._destroy&&(this._content=null),this._content},set:function(t){this._content=t,this._updateBounds()}},horizontalScrollBar:{get:function(){return this._horizontalScrollBar&&this._horizontalScrollBar._destroy&&(this._horizontalScrollBar=null),this._horizontalScrollBar},set:function(t){this._horizontalScrollBar&&this._horizontalScrollBar.onValueChange.remove(this._setHorizontalNormalizedPosition,this),this._horizontalScrollBar=t,this._horizontalScrollBar&&this._horizontalScrollBar.onValueChange.add(this._setHorizontalNormalizedPosition,this)}},verticalScrollBar:{get:function(){return this._verticalScrollBar&&this._verticalScrollBar._destroy&&(this._verticalScrollBar=null),this._verticalScrollBar},set:function(t){this._verticalScrollBar&&this._verticalScrollBar.onValueChange.remove(this._setVerticalNormalizedPosition,this),this._verticalScrollBar=t,this._verticalScrollBar&&this._verticalScrollBar.onValueChange.add(this._setVerticalNormalizedPosition,this)}},horizontalNormalizedPosition:{get:function(){return this._updateBounds(),this._contentRect.width<=this._viewRect.width?this._viewRect.x>this._contentRect.x?1:0:(this._viewRect.x-this._contentRect.x)/(this._contentRect.width-this._viewRect.width)},set:function(t){this.setNormalizedPosition(t,0)}},verticalNormalizedPosition:{get:function(){return this._updateBounds(),this._contentRect.height<=this._viewRect.height?this._viewRect.y>this._contentRect.y?1:0:(this._viewRect.y-this._contentRect.y)/(this._contentRect.height-this._viewRect.height)},set:function(t){this.setNormalizedPosition(t,1)}}}),ScrollView.prototype.getMeta=function(){var t=qc.Serializer,e=qc.UIImage.prototype.getMeta.call(this);return e.content=t.NODE,e.canHorizontal=t.BOOLEAN,e.canVertical=t.BOOLEAN,e.movementType=t.NUMBER,e.elasticity=t.NUMBER,e.inertia=t.BOOLEAN,e.decelerationRate=t.NUMBER,e.scrollSensitivity=t.NUMBER,e.horizontalScrollBar=t.NODE,e.verticalScrollBar=t.NODE,e.propagationScroll=t.BOOLEAN,e},ScrollView.prototype.onDestroy=function(){qc.UIImage.prototype.onDestroy.call(this),this.content=null,this.horizontalScrollBar=null,this.verticalScrollBar=null,this.phaser.mask=null},ScrollView.prototype.update=function(){},ScrollView.prototype.postUpdate=function(){this._updateVelocity()},ScrollView.prototype._setHorizontalNormalizedPosition=function(t){this.setNormalizedPosition(t,0)},ScrollView.prototype._setVerticalNormalizedPosition=function(t){this.setNormalizedPosition(t,1)},ScrollView.prototype._setContentPosition=function(t,e){this.content.x=t,this.content.y=e},ScrollView.prototype._calculateOffset=function(t,e){var i=new qc.Point(0,0);if(this.movementType===ScrollView.MOVEMENT_UNRESTRICTED)return i;var r=this.rect,n=this._contentRect,o=new qc.Point(n.x,n.y),s=new qc.Point(n.x+n.width,n.y+n.height);return this.canHorizontal&&(o.x+=t,s.x+=t,o.x>r.x?i.x=r.x-o.x:s.x<r.x+r.width&&(i.x=r.x+r.width-s.x)),this.canVertical&&(o.y+=e,s.y+=e,o.y>r.y?i.y=r.y-o.y:s.y<r.y+r.height&&(i.y=r.y+r.height-s.y)),i},ScrollView.prototype._calcVelocityEffect=function(t,e,i,r){if(this.movementType===ScrollView.MOVEMENT_ELASTIC&&0!==e[r]){var n=this["_lastOffset_"+r]||0;Math.abs(n)<Math.abs(e[r])?(this["_lastOffset_"+r]=e[r],this._currSmoothetTime=i):(this["_lastOffset_"+r]=e[r],this._currSmoothetTime+=i);this.elasticity<=0||this.elasticity;var o=this.game.math.smoothDamp(t[r],t[r]+e[r],this._velocity[r],this.elasticity,Number.MAX_VALUE,i/100);Math.abs(t[r]+e[r]-o[0])<1e-4?(t[r]=t[r]+e[r],this._velocity[r]=0):(t[r]=o[0],this._velocity[r]=o[1])}else if(this.movementType===ScrollView.MOVEMENT_CLAMPED&&0!==e[r])t[r]=t[r]+e[r];else if(this.inertia){var s=this._velocity[r]*Math.pow(Math.abs(this.decelerationRate),i/1e3);Math.abs(s)<1&&(s=0),this._velocity[r]=s,t[r]=t[r]+s*i/1e3}else this._velocity[r]=0},ScrollView.prototype._rubberDelta=function(t,e){return(1-1/(.55*Math.abs(t)/e+1))*e*this.game.math.sign(t)},ScrollView.prototype._updateVelocity=function(){if(this.content){var t=this.game.time.deltaTime,e=this._calculateOffset(0,0),i=new qc.Point(this.content.x,this.content.y);if(this._isDragging||0===e.x&&0===e.y&&0===this._velocity.x&&0===this._velocity.y||(this._updateBounds(),this._calcVelocityEffect(i,e,t,"x"),this._calcVelocityEffect(i,e,t,"y"),0===this._velocity.x&&0===this._velocity.y||this.movementType===ScrollView.MOVEMENT_CLAMPED&&(e=this._calculateOffset(i.x-this.content.x,i.y-this.content.y),i.x+=e.x,i.y+=e.y),this._setContentPosition(i.x,i.y)),this._isDragging&&this.inertia){this._updateBounds();var r=this.content.x-this._preContentPosition.x,n=this.content.y-this._preContentPosition.y,o=this.game.math.clamp(t/1e3,0,1);this._velocity.x=r/o,this._velocity.y=n/o}this._preViewRect&&qc.Rectangle.equals(this._viewRect,this._preViewRect)&&this._preContentRect&&qc.Rectangle.equals(this._contentRect,this._preContentRect)&&this._preContentPosition&&qc.Point.equals(this._preContentPosition,i)||(this._updateScrollBars(e.x,e.y),this.onValueChange.dispatch(new qc.Point(this.horizontalNormalizedPosition,this.verticalNormalizedPosition)),this._updatePrevData())}},ScrollView.prototype.setNormalizedPosition=function(t,e){if(this._updateBounds(),this.content&&this._contentRect){var i=e?"height":"width",r=e?"y":"x",n=this._contentRect[i]-this._viewRect[i],o=this._viewRect[r]-t*n,s=this.content[r]+o-this._contentRect[r],a=this.content[r];Math.abs(a-s)>1&&(this.content[r]=s,this._velocity[r]=0,this._updateBounds())}},ScrollView.prototype._updatePrevData=function(){this.content?this._preContentPosition=new qc.Point(this.content.x,this.content.y):this._preContentPosition=new qc.Point(0,0),this._preContentRect=this._contentRect,this._preViewRect=this._viewRect},ScrollView.prototype._updateScrollBars=function(t,e){if(this.horizontalScrollBar){if(this._contentRect.width>0){var i=(this._viewRect.width-Math.abs(t))/this._contentRect.width;this.horizontalScrollBar.size=Phaser.Math.clamp(i,0,1)}else this.horizontalScrollBar.size=1;this.horizontalScrollBar.value=this.horizontalNormalizedPosition}if(this.verticalScrollBar){if(this._contentRect.height>0){i=(this._viewRect.height-Math.abs(e))/this._contentRect.height;this.verticalScrollBar.size=Phaser.Math.clamp(i,0,1)}else this.verticalScrollBar.size=1;this.verticalScrollBar.value=this.verticalNormalizedPosition}},ScrollView.prototype._updateBounds=function(){if(this._viewRect=this.rect,this._updateContentBounds(),this.content){var t=this.rect,e=t.width-this._contentRect.width,i=t.height-this._contentRect.height;e>0&&(this._contentRect.width=t.width,this._contentRect.x-=e*this.content.pivotX),i>0&&(this._contentRect.height=t.height,this._contentRect.y-=i*this.content.pivotY)}},ScrollView.prototype._updateContentBounds=function(){this.content?this._contentRect=qc.Bounds.getBox(this.content,qc.Bounds.USE_BOUNDS,!1,1,this):this._contentRect=new qc.Rectangle(0,0,0,0)},ScrollView.prototype._doWheel=function(t,e){if(this.content){this._updateBounds();var i=new qc.Point(e.source.deltaX,e.source.deltaY);this.canVertical||(i.y=0),this.canHorizontal||(i.x=0);var r=i.x*this.scrollSensitivity,n=i.y*this.scrollSensitivity;this.doScroll(r,n,!1)}},ScrollView.prototype._doDragStart=function(t,e){e.source.eventId===qc.Mouse.BUTTON_LEFT&&(this._updateBounds(),this._contentStartPosition=new qc.Point(this.content.x,this.content.y),this._pointerStartCursor=this.toLocal(new qc.Point(e.source.startX,e.source.startY)),this._isDragging=!0)},ScrollView.prototype._doDragEnd=function(t,e){e.source.eventId===qc.Mouse.BUTTON_LEFT&&(this._isDragging=!1)},ScrollView.prototype._doDrag=function(t,e){if(e.source.eventId===qc.Mouse.BUTTON_LEFT){this._updateBounds();var i=this.toLocal(new qc.Point(e.source.x,e.source.y));if(this._pointerStartCursor){var r=this.canHorizontal?i.x-this._pointerStartCursor.x:0,n=this.canVertical?i.y-this._pointerStartCursor.y:0;this.doScroll(this._contentStartPosition.x+r-this.content.x,this._contentStartPosition.y+n-this.content.y,!0)}}},ScrollView.prototype.doScroll=function(t,e,i){var r=new qc.Point(this.content.x,this.content.y);r.x+=t,r.y+=e;var n=this._calculateOffset(t,e);if(r.x+=n.x,r.y+=n.y,this.movementType===ScrollView.MOVEMENT_CLAMPED&&this.propagationScroll){for(var o=this.parent;!(o instanceof ScrollView)&&o!==this.game.world;)o=o.parent;o instanceof ScrollView&&o.doScroll(-n.x,-n.y,i)}else this.movementType===ScrollView.MOVEMENT_ELASTIC&&(i?(0!==n.x&&(r.x=r.x-this._rubberDelta(n.x,this._viewRect.width)),0!==n.y&&(r.y=r.y-this._rubberDelta(n.y,this._viewRect.height))):(r.x-=n.x,r.y-=n.y,Math.abs(n.x)>this._viewRect.width&&(r.x+=n.x-this.game.math.sign(n.x)*this._viewRect.width),Math.abs(n.y)>this._viewRect.height&&(r.y+=n.y-this.game.math.sign(n.y)*this._viewRect.height)));this._setContentPosition(r.x,r.y),i||this._updateBounds()},ScrollView.MOVEMENT_UNRESTRICTED=0,ScrollView.MOVEMENT_ELASTIC=1,ScrollView.MOVEMENT_CLAMPED=2;var ScrollBar=qc.ScrollBar=function(t,e,i){qc.UIImage.call(this,t,e,i),this.name="ScrollBar",this.autoHide=!1,this._setValue(0,!1),this.onWheel.add(this._doWheel,this),this.onDown.add(this._doDown,this),this.onUp.add(this._doUp,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this)};ScrollBar.prototype=Object.create(qc.UIImage.prototype),ScrollBar.prototype.constructor=ScrollBar,Object.defineProperties(ScrollBar.prototype,{class:{get:function(){return"qc.ScrollBar"}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(t){this._sliders=t,this._updateSliders()}},direction:{get:function(){return this._direction||ScrollBar.LEFT_TO_RIGHT},set:function(t){this._setDirection(t,!1)}},value:{get:function(){return this._value},set:function(t){this._setValue(t,!0)}},size:{get:function(){return this._size},set:function(t){var e=Phaser.Math.clamp(t,0,1);this.visible=!(this.autoHide&&this.game.math.fuzzyEqual(e,1)),this.visible&&!this.fixSlidersSize&&(this._size=e,this._size=Math.max(5/Math.max(this.height,this.width),this._size),this._updateSliders())}},numberOfStep:{get:function(){return this._numberOfStep},set:function(t){this._numberOfStep=t}},onValueChange:{get:function(){return this._onValueChange||(this._onValueChange=new Phaser.Signal),this._onValueChange}},stepSize:{get:function(){return this.numberOfStep>1?1/(this.numberOfStep-1):.1}},fixSlidersSize:{get:function(){return this._fixSlidersSize},set:function(t){this._fixSlidersSize=t}},_axisPos:{get:function(){return this.direction===ScrollBar.LEFT_TO_RIGHT||this.direction===ScrollBar.RIGHT_TO_LEFT?"x":"y"}},_axisSize:{get:function(){return this.direction===ScrollBar.LEFT_TO_RIGHT||this.direction===ScrollBar.RIGHT_TO_LEFT?"width":"height"}},_reverseValue:{get:function(){return this.direction===ScrollBar.RIGHT_TO_LEFT||this.direction===ScrollBar.BOTTOM_TO_TOP}},_slidingRect:{get:function(){return this.sliders&&this.sliders.parent?this.sliders.parent.rect:null}}}),ScrollBar.prototype.getMeta=function(){var t=qc.Serializer,e=qc.UIImage.prototype.getMeta.call(this);return e.sliders=t.NODE,e.value=t.NUMBER,e.size=t.NUMBER,e.numberOfStep=t.NUMBER,e.direction=t.NUMBER,e.fixSlidersSize=t.BOOLEAN,e.autoHide=t.BOOLEAN,e},ScrollBar.prototype.onDestroy=function(){qc.UIImage.prototype.onDestroy.call(this),this.sliders=null},ScrollBar.prototype._setDirection=function(t,e){if(this._direction!==t){var i=this._axisPos;this._reverseValue;if(this._direction=t,e&&i!=this._axisPos){var r=this.width;this.width=this.height,this.height=r}this._updateSliders()}},ScrollBar.prototype._setValue=function(t,e){var i=this._value;this._value=Phaser.Math.clamp(t,0,1),i!==this.value&&(this._updateSliders(),e&&this.onValueChange.dispatch(this.value))},ScrollBar.prototype.postUpdate=function(){this._isMoveNotDragging&&this._doPursued()},ScrollBar.prototype._updateSliders=function(){if(this._slidingRect){var t=new qc.Point(0,0),e=new qc.Point(1,1),i=this.value*(1-this.size),r=this._axisPos;this._reverseValue?(t[r]=1-i-this.size,e[r]=1-i):(t[r]=i,e[r]=i+this.size),this.sliders.setAnchor(t,e,!1)}},ScrollBar.prototype._getSlidersRectInBar=function(){var t=this.sliders.minAnchor,e=this.sliders.maxAnchor,i=this._slidingRect,r=i.width*t.x,n=i.height*t.y,o=i.width*(e.x-t.x),s=i.height*(e.y-t.y),a=i.width/this.rect.width,h=i.height/this.rect.height;return new qc.Rectangle(this.rect.x+r*a,this.rect.y+n*h,o*a,s*h)},ScrollBar.prototype._getSlidersPointInBar=function(t){var e=this.sliders.minAnchor,i=(this.sliders.maxAnchor,this._slidingRect),r=this.sliders.rect.width/i.width,n=this.sliders.rect.height/i.height,o=i.width*e.x+t.x*r,s=i.height*e.y+t.y*n,a=i.width/this.rect.width,h=i.height/this.rect.height;return new qc.Point(this.rect.x+o*a,this.rect.y+s*h)},ScrollBar.prototype._doPursued=function(){var t=this._getSlidersRectInBar(),e=this._axisPos,i=this._axisSize;if(this._pursuedPoint>=t[e]&&this._pursuedPoint<=t[e]+t[i])return this._isMoveNotDragging=!1,this._offset=this._pursuedPoint-t[e]-t[i]/2,this._pursuedPoint=0,void(this._pursuedType=0);this._pursuedPoint<t[e]^this._reverseValue?2!==this._pursuedType&&(this.value-=this.stepSize,this._pursuedType=1):1!==this._pursuedType&&(this.value+=this.stepSize,this._pursuedType=2)},ScrollBar.prototype._doDown=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){var i=new qc.Point(e.source.x,e.source.y);if(!this.sliders.rectContains(i)){var r=this.toLocal(i);this._isMoveNotDragging=!0,this._pursuedPoint=r[this._axisPos],this._pursuedType=0}}},ScrollBar.prototype._doUp=function(t,e){this._isMoveNotDragging=!1},ScrollBar.prototype._doDragStart=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){this._isMoveNotDragging=!1;var i=new qc.Point(e.source.x,e.source.y),r=this.toLocal(i),n=this._getSlidersRectInBar(),o=this._axisPos,s=this._axisSize;this._offset=r[o]-n[o]-n[s]/2}},ScrollBar.prototype._doDragEnd=function(t,e){this._isMoveNotDragging=!1},ScrollBar.prototype._doDrag=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){var i=new qc.Point(e.source.x,e.source.y),r=this.toLocal(i),n=this._getSlidersRectInBar(),o=this._axisPos,s=this._axisSize,a=r[o]-this._offset-this.rect[o]-n[s]/2,h=this.rect[s]*(1-this.size);switch(this.direction){case ScrollBar.LEFT_TO_RIGHT:case ScrollBar.TOP_TO_BOTTOM:this._setValue(a/h,!0);break;case ScrollBar.RIGHT_TO_LEFT:case ScrollBar.BOTTOM_TO_TOP:this._setValue(1-a/h,!0)}}},ScrollBar.prototype._doWheel=function(t,e){if(this.sliders){var i=e.source["delta"+this._axisPos.toUpperCase()],r=this.value;r+=(this._reverseValue?-1:1)*Math.sign(i)*this.stepSize,this._setValue(r,!0)}},ScrollBar.LEFT_TO_RIGHT=0,ScrollBar.RIGHT_TO_LEFT=1,ScrollBar.TOP_TO_BOTTOM=2,ScrollBar.BOTTOM_TO_TOP=3;var ProgressBar=qc.ProgressBar=function(t,e,i){qc.UIImage.call(this,t,e,i),this.name="ProgressBar",this.style=ProgressBar.STYLE_HORIZONTAL,this.value=0,this.minValue=0,this.maxValue=1,this.indeterminable=!1,this.loopTime=3e3,this.numberOfStep=0,this.fixedSize=-1,this._canSlideOut=!0,this.clipSliders=!1,this.showMode=ProgressBar.SHOW_PROCESSED,this.reverse=!1};ProgressBar.prototype=Object.create(qc.UIImage.prototype),ProgressBar.prototype.constructor=ProgressBar,Object.defineProperties(ProgressBar.prototype,{class:{get:function(){return"qc.ProgressBar"}},style:{get:function(){return this._style},set:function(t){this._setStyle(t)}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(t){this._sliders=t,this._updateSliders()}},indeterminable:{get:function(){return this._indeterminable},set:function(t){this._indeterminable=t}},minValue:{get:function(){return isNaN(this._minValue)||null===this._minValue?0:this._minValue},set:function(t){this.setMinMax(t)}},maxValue:{get:function(){return isNaN(this._maxValue)||null===this._maxValue?1:this._maxValue},set:function(t){this.setMinMax(null,t)}},length:{get:function(){return this.maxValue-this.minValue}},stepValue:{get:function(){var t=this.stepSize;return t>0?this.minValue+Math.round((this.value-this.minValue)/t)*t:this.value},set:function(t){var e=this.stepSize;e>0?this._setValue(this.minValue+Math.round((t-this.minValue)/e)*e,!0):this._setValue(t)}},value:{get:function(){return this._value||0},set:function(t){t!==this._value&&this._setValue(t,!0)}},loopTime:{get:function(){return this._loopTime},set:function(t){this._loopTime=t}},numberOfStep:{get:function(){return this._numberOfStep},set:function(t){this._numberOfStep=t}},stepSize:{get:function(){return this.numberOfStep>1?this.length/(this.numberOfStep-1):this.style===ProgressBar.STYLE_CIRCLE?this.length/360:this.style===ProgressBar.STYLE_HORIZONTAL?this.length/(this._slidingRect?this._slidingRect.width:this.width):this.length/(this._slidingRect?this._slidingRect.height:this.height)}},fixedSize:{get:function(){return this._fixedSize},set:function(t){this._fixedSize!==t&&(this._fixedSize=t,this._updateSliders())}},onValueChange:{get:function(){return this._onValueChange||(this._onValueChange=new Phaser.Signal),this._onValueChange}},clipSliders:{get:function(){if(!this.sliders)return!1;var t=this.sliders.getScript(qc.NodeMask);return t&&t.enable},set:function(t){this._setClipSliders(t)}},showMode:{get:function(){return this._showMode},set:function(t){this._setShowMode(t)}},reverse:{get:function(){return this._reverse},set:function(t){this._reverse=t,this._updateSliders()}},startRadian:{get:function(){return this._startRadian||0},set:function(t){this.setCircleScope(t)}},endRadian:{get:function(){return this._endRadian||2*Math.PI},set:function(t){this.setCircleScope(null,t)}},startAngle:{get:function(){return 180*this.startRadian/Math.PI},set:function(t){this.setCircleAngle(t)}},endAngle:{get:function(){return 180*this.endRadian/Math.PI},set:function(t){this.setCircleAngle(null,t)}},showRadian:{get:function(){return this.endRadian-this.startRadian}},_slidingRect:{get:function(){return this.sliders&&this.sliders.parent?this.sliders.parent.rect:null}},_axisPos:{get:function(){return this.style===ProgressBar.STYLE_CIRCLE?"rotation":this.style===ProgressBar.STYLE_HORIZONTAL?"x":"y"}},_axisSize:{get:function(){return this.style===ProgressBar.STYLE_CIRCLE?"rotation":this.style===ProgressBar.STYLE_HORIZONTAL?"width":"height"}}}),ProgressBar.prototype.getMeta=function(){qc.Serializer;var t=qc.UIImage.prototype.getMeta.call(this);return t.style=qc.Serializer.NUMBER,t.sliders=qc.Serializer.NODE,t._minValue=qc.Serializer.NUMBER,t._maxValue=qc.Serializer.NUMBER,t.value=qc.Serializer.NUMBER,t._startRadian=qc.Serializer.NUMBER,t._endRadian=qc.Serializer.NUMBER,t.indeterminable=qc.Serializer.BOOLEAN,t.loopTime=qc.Serializer.NUMBER,t.numberOfStep=qc.Serializer.NUMBER,t.fixedSize=qc.Serializer.NUMBER,t.showMode=qc.Serializer.NUMBER,t.reverse=qc.Serializer.NUMBER,t},ProgressBar.prototype.onDestroy=function(){qc.UIImage.prototype.onDestroy.call(this),this.sliders=null},ProgressBar.prototype._resetSliders=function(){if(this.sliders){this.sliders.rotation=0,this.sliders.setAnchor(new qc.Point(0,0),new qc.Point(1,1),!1);var t=this.sliders.getScript(qc.NodeMask);t&&t.setMask(new qc.Point(0,0),new qc.Point(1,1),0,2*Math.PI)}},ProgressBar.prototype._setStyle=function(t){this._style!==t&&(this._style=t,this._resetSliders(),this._updateSliders())},ProgressBar.prototype._setClipSliders=function(t){if(this.clipSliders!==t){if(this.sliders){this._resetSliders();var e=this.sliders.getScript(qc.NodeMask);!e&&t&&(e=this.sliders.addScript("qc.NodeMask")),e&&(e.enable=t)}this._updateSliders()}},ProgressBar.prototype._setShowMode=function(t){this._showMode!==t&&(this._showMode=t,this.sliders&&this._resetSliders(),this._updateSliders())},ProgressBar.prototype.update=function(){this._indeterminable&&this._processIndeterminable()},ProgressBar.prototype.setMinMax=function(t,e){if(t=null==t?this.minValue:t,e=null==e?this.maxValue:e,t>=e)throw new Error("Expected:min < max");this._minValue=t,this._maxValue=e,this._setValue(this.value,!0)},ProgressBar.prototype.setCircleScope=function(t,e){if(t=null==t?this.startRadian:t,e=null==e?this.endRadian:e,t>=e||e>t+2*Math.PI)throw new Error("Expected:start < end and end <= 2*PI + start");this._startRadian=t,this._endRadian=e,this._updateSliders()},ProgressBar.prototype.setCircleAngle=function(t,e){if(t=null==t?this.startAngle:t,e=null==e?this.endAngle:e,t>=e||e>t+360)throw new Error("Expected:start < end and end <= 360 + start");this._startRadian=t*Math.PI/180,this._endRadian=e*Math.PI/180,this._updateSliders()},ProgressBar.prototype._setValue=function(t,e){var i=this.stepValue;this._value=Phaser.Math.clamp(t,this.minValue,this.maxValue),i!==this.stepValue&&this._updateSliders(),e&&this.onValueChange.dispatch(this.value)},ProgressBar.prototype._processIndeterminable=function(){this._loopValue=this._loopValue||this.value,this._loopValue+=this.length*this.game.time.deltaTime/this.loopTime,this._loopValue>this.maxValue+this.stepSize&&(this._loopValue=this.minValue),this.value=this._loopValue},ProgressBar.prototype._updateSliders=function(){if(this._slidingRect){var t=this.sliders.getScript(qc.NodeMask),e=(this.stepValue-this.minValue)/this.length;if(this.reverse&&(e=1-e),this.clipSliders&&t)switch(this.style){case ProgressBar.STYLE_HORIZONTAL:case ProgressBar.STYLE_VERTICAL:o=new qc.Point(0,0),s=new qc.Point(1,1),a=this._axisPos;this.fixedSize>=0?this._canSlideOut?(e*=1+this.fixedSize,s[a]=Math.min(1,e),o[a]=Math.max(0,e-this.fixedSize-1e-5)):(e*=1-this.fixedSize,o[a]=Math.max(0,e),s[a]=Math.min(1,e+this.fixedSize+1e-5)):this.showMode===ProgressBar.SHOW_PROCESSED?s[a]=Math.min(1,e):o[a]=Math.min(1,e),t.setMask(o,s);break;case ProgressBar.STYLE_CIRCLE:if(this.fixedSize>=0){var i=this.startRadian+(e-this.fixedSize)*this.showRadian,r=this.startRadian+e*this.showRadian;if(this.showMode===ProgressBar.SHOW_REMAINED&&this.showRadian===2*Math.PI){var n=r;r=i+2*Math.PI,i=n}t.setMask(null,null,i,r)}else{i=-Math.PI/2+this.startRadian,r=-Math.PI/2+this.endRadian;this.showMode===ProgressBar.SHOW_PROCESSED?r=i+e*this.showRadian:i+=e*this.showRadian,t.setMask(null,null,i,r)}}else switch(this.style){case ProgressBar.STYLE_HORIZONTAL:case ProgressBar.STYLE_VERTICAL:var o=new qc.Point(0,0),s=new qc.Point(1,1),a=this._axisPos;this.fixedSize>=0?this._canSlideOut?(e*=1+this.fixedSize,s[a]=Math.min(1,e),o[a]=Math.max(0,e-this.fixedSize-1e-5)):(e*=1-this.fixedSize,o[a]=Math.max(0,e),s[a]=Math.min(1,e+this.fixedSize+1e-5)):this.showMode===ProgressBar.SHOW_PROCESSED?s[a]=Math.max(1e-5,Math.min(1,e)):o[a]=Math.min(.99999,e),this.sliders.setAnchor(o,s,!1);break;case ProgressBar.STYLE_CIRCLE:this.sliders.rotation=e*this.showRadian+this.startRadian}}},ProgressBar.STYLE_HORIZONTAL=0,ProgressBar.STYLE_VERTICAL=1,ProgressBar.STYLE_CIRCLE=2,ProgressBar.SHOW_PROCESSED=0,ProgressBar.SHOW_REMAINED=1;var Slider=qc.Slider=function(t,e,i){qc.ProgressBar.call(this,t,e,i),this.name="Slider",this.canPursue=!0,this._canSlideOut=!1,this.onWheel.add(this._doWheel,this),this.onDown.add(this._doDown,this),this.onUp.add(this._doUp,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this);var r=i!==undefined;if(!0!==r){this.state=qc.UIState.NORMAL;var n=this.addScript("qc.TransitionBehaviour");n.target=this.sliders,n.transition=qc.Transition.TEXTURE_SWAP}};Slider.prototype=Object.create(qc.ProgressBar.prototype),Slider.prototype.constructor=Slider,Object.defineProperties(Slider.prototype,{state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,
this._onStateChange&&this._onStateChange.dispatch())}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(t){this._sliders=t;var e=this.getScript("qc.TransitionBehaviour");e&&(e.target=t||this),this._updateSliders()}},onStateChange:{get:function(){return this._onStateChange||(this._onStateChange=new qc.Signal),this._onStateChange}},class:{get:function(){return"qc.Slider"}},canPursue:{get:function(){return this._canPursue},set:function(t){this._canPursue=t}},interactive:{get:function(){return this._interactive},set:function(t){this._interactive=t,this._onInteractive&&this._onInteractive.dispatch(),this.state=this.interactive?qc.UIState.NORMAL:qc.UIState.DISABLED}}}),Slider.prototype.getMeta=function(){qc.Serializer;var t=qc.ProgressBar.prototype.getMeta.call(this);return t.canPursue=qc.Serializer.BOOLEAN,t},Slider.prototype.update=function(){qc.ProgressBar.prototype.update.call(this),this._isMoveNotDragging&&this._canPursue&&this._doPursued()},Slider.prototype._setStyle=function(t){qc.ProgressBar.prototype._setStyle.call(this,t),this.fixedSize=t===Slider.STYLE_CIRCLE?0:-1},Slider.prototype._calcPointValue=function(t,e){var i=0,r=this.rect;switch(this.style){case Slider.STYLE_HORIZONTAL:case Slider.STYLE_VERTICAL:i=this.minValue+(t[this._axisPos]-r[this._axisPos])*this.length/r[this._axisSize];break;case Slider.STYLE_CIRCLE:var n=2*Math.PI,o=Math.atan2(t.x-r.centerX,r.centerY-t.y);if(o<0&&(o+=n),e)if(void 0===this._tempDragAngle||null===this._tempDragAngle)this._tempDragAngle=o,this._recordDragAngle=o;else{var s=o-this._tempDragAngle;this._tempDragAngle=o,Math.abs(s)>Math.PI&&(s=Phaser.Math.sign(s)*(n-Math.abs(s))),this._recordDragAngle+=s,o=this._recordDragAngle}i=this.minValue+(o-this.startRadian)*this.length/this.showRadian}return this.reverse&&(i=this.maxValue-i+this.minValue),i},Slider.prototype._doWheel=function(t,e){if(this.sliders){var i=Math.abs(e.source.deltaX)>=Math.abs(e.source.deltaY)?e.source.deltaX:e.source.deltaY,r=this.value;r+=(this.reverse?-1:1)*Math.sign(i)*this.stepSize,this.value=r}},Slider.prototype._doDown=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){this.state=qc.UIState.PRESSED,this._tempDragAngle=null,this._recordDragAngle=null;var i=new qc.Point(e.source.x,e.source.y);if(!this.sliders.rectContains(i)||this.fixedSize<0){var r=this.toLocal(i);this._isMoveNotDragging=!0,this._pursuedPoint=this._calcPointValue(r),this._pursuedType=0}}},Slider.prototype._doUp=function(t,e){this._isMoveNotDragging=!1,this.state===qc.UIState.PRESSED&&(this.state=qc.UIState.NORMAL)},Slider.prototype._doDragStart=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){this.state=qc.UIState.PRESSED,this._isMoveNotDragging=!1;var i=new qc.Point(e.source.x,e.source.y),r=this.toLocal(i);this._offset=this._calcPointValue(r,!0)-this.value}},Slider.prototype._doDragEnd=function(t,e){this._isMoveNotDragging=!1,this._tempDragAngle=null,this._recordDragAngle=null,this.state===qc.UIState.PRESSED&&(this.state=qc.UIState.NORMAL)},Slider.prototype._doDrag=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){var i=new qc.Point(e.source.x,e.source.y),r=this.toLocal(i),n=this._calcPointValue(r,!0)-this._offset;this._setValue(n,!0)}},Slider.prototype._doPursued=function(){for(var t=this.stepSize,e=Math.max(1,Math.ceil(this.length/10/t));e--;){if(this._pursuedPoint>=this.value&&this._pursuedPoint<=this.value+t)return this._isMoveNotDragging=!1,this._offset=this._pursuedPoint-this.value,this._pursuedPoint=0,void(this._pursuedType=0);this._pursuedPoint<this.value^this.reverse?2!==this._pursuedType&&(this.value-=t,this._pursuedType=1):1!==this._pursuedType&&(this.value+=t,this._pursuedType=2)}},Slider.STYLE_HORIZONTAL=qc.ProgressBar.STYLE_HORIZONTAL,Slider.STYLE_VERTICAL=qc.ProgressBar.STYLE_VERTICAL,Slider.STYLE_CIRCLE=qc.ProgressBar.STYLE_CIRCLE,Slider.SHOW_PROCESSED=qc.ProgressBar.SHOW_PROCESSED,Slider.SHOW_REMAINED=qc.ProgressBar.SHOW_REMAINED;var InputField=qc.InputField=function(t,e,i){var r=this;qc.UIImage.call(r,t,e,i),r.name="InputField",r.onStateChange=new qc.Signal,r.onValueChange=new qc.Signal,r.interactive=!0;var n=r.div=document.createElement("div");if(!window.__wx){var o=n.style;o.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null),o.position="absolute",o.padding=0,o.margin=0,o.border=0,o.outline=0,o.background="none",r.game.world.frontDomRoot.appendChild(n)}var s=i!==undefined;if(!0!==s){var a=r.textComponent=t.add.text(r);a.text="",a.name="Text",a.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),a.left=5,a.right=5,a.top=5,a.bottom=5,a.interactive=!1,a.color=Color.black,a.alignV=UIText.MIDDLE,a.alignH=UIText.LEFT;var h=r.placeholder=t.add.text(r);h.text="Enter text...",h.name="Placeholder",h.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),h.left=5,h.right=5,h.top=5,h.bottom=5,h.interactive=!1,h.color=Color.grey,h.alignV=UIText.MIDDLE,h.alignH=UIText.LEFT,this.state=qc.UIState.NORMAL;var l=this.addScript("qc.TransitionBehaviour");l.target=this}var c=function(t){t.preventDefault(),r.state!==qc.UIState.DISABLED&&r.startEditing()};n.addEventListener("mouseup",c,!1),n.addEventListener("touchend",c,!1),this.onDown.add(function(){r.state!==qc.UIState.DISABLED&&(r.state=qc.UIState.PRESSED)}),this.onUp.add(function(t,e){r.state===qc.UIState.PRESSED&&(r.state=qc.UIState.NORMAL),window.__wx&&r.state!==qc.UIState.DISABLED&&r.startEditing()}),r.phaser.worldTransformChangedCallback=r._updateNativeDiv.bind(r),r.phaser.worldTransformChangedContext=r,this.text="",this.width=120,this.height=30,this._checkVisibility()};InputField.SINGLE_LINE=0,InputField.MULTI_LINE=1,InputField.STANDARD=0,InputField.INT=1,InputField.NUMBER=2,InputField.TEL=3,InputField.EMAIL=4,InputField.PASSWORD=5,InputField.prototype=Object.create(qc.UIImage.prototype),InputField.prototype.constructor=InputField,InputField.prototype._characterLimit=-1,InputField.prototype._lineType=InputField.SINGLE_LINE,InputField.prototype._contentType=InputField.STANDARD,InputField.prototype._input=null,InputField.prototype._password="",InputField.prototype.textComponent=null,InputField.prototype.placeholder=null,Object.defineProperties(InputField.prototype,{class:{get:function(){return"qc.InputField"}},state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},lineType:{get:function(){return this._lineType},set:function(t){this._lineType=t}},contentType:{get:function(){return this._contentType},set:function(t){this._contentType!==t&&(this._contentType=t,this.text=this.text)}},textComponent:{get:function(){return this._textComponent&&this._textComponent._destroy&&(this._textComponent=null),this._textComponent},set:function(t){this._textComponent=t}},placeholder:{get:function(){return this._placeholder&&this._placeholder._destroy&&(this._placeholder=null),this._placeholder},set:function(t){this._placeholder=t}},placeholderText:{get:function(){var t=this.placeholder;return t?t.text:""},set:function(t){var e=this.placeholder;e&&(e.text=t)}},text:{get:function(){var t=this.textComponent;return t?this._contentType===InputField.PASSWORD?this._password:this.textComponent.text:""},set:function(t){if(this.textComponent&&(t=this.toValidateText(t),t!==this.text)){if(this._contentType===InputField.PASSWORD){this._password=t;for(var e="",i=0;i<t.length;i++)e+="·";this.textComponent.text=e}else this.textComponent.text=t;this.onValueChange.dispatch(t)}}},characterLimit:{get:function(){return window.__wx&&-1===this._characterLimit?99999:this._characterLimit},set:function(t){this.characterLimit!==t&&(this._characterLimit=t,this.text=this.text)}},overflow:{get:function(){return!!this.textComponent&&this.textComponent.overflow},set:function(t){this.textComponent&&(this.textComponent.overflow=t)}},isFocused:{get:function(){return!!this.getInput()},set:function(t){t?this.startEditing():this.stopEditing()}}}),InputField.prototype.getMeta=function(){var t=qc.Serializer,e=qc.UIImage.prototype.getMeta.call(this);return e.lineType=t.NUMBER,e.contentType=t.NUMBER,e.placeholder=t.NODE,e.textComponent=t.NODE,e.text=t.STRING,e.overflow=t.BOOLEAN,e.state=t.NUMBER,e._password=t.STRING,e.characterLimit=t.NUMBER,e},InputField.prototype.update=function(){var t=this.getInput(),e=this.textComponent,i=this.placeholder,r=e.textPhaser.renderable;t?(e&&(e.textPhaser.renderable=!1),i&&(i.textPhaser.renderable=!1),this._updateInput(t)):(e&&(e.textPhaser.renderable=!0),i&&(i.textPhaser.renderable=""===this.text)),e.textPhaser.renderable!==r&&(e.textPhaser.displayChanged(e.textPhaser.renderable?qc.DisplayChangeStatus.SHOW:qc.DisplayChangeStatus.HIDE),this.phaser.displayChanged(e.textPhaser.renderable?qc.DisplayChangeStatus.SHOW:qc.DisplayChangeStatus.HIDE))},InputField.prototype.toValidateText=function(t){switch(t=t||"",this.contentType){case InputField.INT:t=t.replace(/[^\d\-]/g,"");break;case InputField.NUMBER:t=t.replace(/[^\d\.\-]/g,"");break;case InputField.EMAIL:t=t.replace(/[^\w0-9\@\.]/g,"");break;case InputField.TEL:t=t.replace(/[^\d\(\)\+\-\s]/g,"")}return this.characterLimit>0&&t.length>this.characterLimit&&(t=t.substr(0,this.characterLimit)),t},InputField.prototype.startEditing=function(){var t=this,e=t.textComponent;if(e){var i=this._input;if(!i)if(window.__wx){var r={defaultValue:t.text,maxLength:t.characterLimit,multiple:t.lineType===InputField.MULTI_LINE,confirmHold:!0,confirmType:"done",success:function(){t._input={value:t.text,_lastValue:t.text};var e=function(e){t._input._lastValue=t._input.value,t._input.value=e.value},i=function(e){t._input._lastValue=t._input.value,t._input.value=e.value,t.stopEditing()},r=function(e){t.cancelEditing()};wx.onKeyboardConfirm(i),wx.onKeyboardInput(e),wx.onKeyboardComplete(r)},fail:function(e){t.game.log.trace("showKeyboard fail : {0}",JSON.stringify(e))}};wx.showKeyboard(r)}else{if(this.lineType===InputField.MULTI_LINE)i=t._input=document.createElement("textarea"),i.onkeydown=function(e){Keyboard.ESC===e.keyCode&&t.cancelEditing()};else{switch(i=t._input=document.createElement("input"),i.onkeydown=function(e){Keyboard.ENTER===e.keyCode?t.stopEditing():Keyboard.ESC===e.keyCode&&t.cancelEditing()},t.contentType){case InputField.PASSWORD:i.type="password";break;case InputField.EMAIL:i.type="email";break;case InputField.TEL:i.type="tel";break;case InputField.INT:case InputField.NUMBER:i.type="number";break;default:i.type="text"}switch(e.alignH){case UIText.LEFT:i.style.textAlign="left";break;case UIText.RIGHT:i.style.textAlign="right";break;default:i.style.textAlign="center"}switch(e.alignV){case UIText.TOP:i.style.verticalAlign="top";break;case UIText.BOTTOM:i.style.verticalAlign="bottom";break;default:i.style.verticalAlign="middle"}}this.characterLimit>0&&i.setAttribute("maxlength",this.characterLimit),i._qc=t,i.value=t.text;var n=i.style;n.position="absolute",n.padding=0,n.margin=0,n.border=0,n.outline=0,n.background="none",i.onblur=function(e){t.stopEditing()},i._handleClick=function(e){e.target!==t.div&&e.target!==i&&t.stopEditing()};var o=t.game.world.frontDomRoot;o.addEventListener("mousedown",i._handleClick,!1),o.addEventListener("touchstart",i._handleClick,!1),t.game.input._inputting++;var s=document.createElement("div");s.style.width=this.game.canvas.style.width,s.style.height=this.game.canvas.style.height,s.style.position="absolute",s.style.overflow="hidden",s.appendChild(i),o.appendChild(s),t._updateInput(i),i.focus(),t._updateNativeInput(),e.phaser.worldTransformChangedCallback=this._updateNativeInput.bind(t),e.phaser.worldTransformChangedContext=e}}},InputField.prototype._updateInput=function(t){var e=this.game.time.now;if(!(t._lastUpdate&&e-t._lastUpdate<100)){if(t._lastUpdate=e,!window.__wx){var i=this.textComponent;i.textPhaser instanceof Phaser.Text&&(t.style.font=i.textPhaser.style.font),t.style.fontSize=i.fontSize+"px",t.style.color=i.color.toString()}t._lastValue!==t.value&&(t._lastValue=t.value,this.text=t.value)}},InputField.prototype.getInput=function(){return this._input&&!this.textComponent&&this.cancelEditing(),this._input},InputField.prototype.cancelEditing=function(){var t=this._input;if(t)if(window.__wx)this._input=null,wx.hideKeyboard(),wx.offKeyboardConfirm(),wx.offKeyboardInput(),wx.offKeyboardComplete();else{this._input=null,this.game.input._inputting--;var e=this.game.world.frontDomRoot;e.removeEventListener("mousedown",t._handleClick,!1),e.removeEventListener("touchstart",t._handleClick,!1),qc.Util.removeHTML(t.parentNode)}},InputField.prototype.stopEditing=function(){var t=this.getInput();t&&(this.text=t.value,this.cancelEditing())},InputField.prototype.onDestroy=function(){this.cancelEditing(),qc.Util.removeHTML(this.div),qc.UIImage.prototype.onDestroy.call(this)},InputField.prototype._dispatchAwake=function(){Node.prototype._dispatchAwake.call(this),this._checkVisibility()},InputField.prototype.onVisibleChange=function(){this._checkVisibility()},InputField.prototype._checkVisibility=function(){var t=this.isWorldVisible();this.div.style.display=t?"block":"none",t||this.stopEditing()},InputField.prototype._updateNativeDiv=function(){var t=this,e=t.div;e._lastUpdate=t.game.time.now,qc.Util.updateTransform(t,e)},InputField.prototype._updateNativeInput=function(){var t=this,e=t.getInput();e&&qc.Util.updateTransform(t.textComponent,e)};var Tilemap=qc.Tilemap=function(t,e,i){qc.Node.call(this,new Phaser.Group(t.phaser,null),e,i),this.name="Tilemap",this._copyCanvas=Phaser.Canvas.create(1,1),this._copyContext=this._copyCanvas.getContext("2d")};Tilemap.prototype=Object.create(qc.Node.prototype),Tilemap.prototype.constructor=Tilemap,Tilemap.prototype._data=null,Tilemap.prototype._scrollX=0,Tilemap.prototype._scrollY=0,Tilemap.prototype._layers=0,Tilemap.prototype._tilesets=0,Tilemap.prototype.getMeta=function(){var t=qc.Node.prototype.getMeta.call(this);return t.data=Serializer.TEXTASSET,t.scrollX=Serializer.NUMBER,t.scrollY=Serializer.NUMBER,t.layers=Serializer.NODES,t.tilesets=Serializer.TEXTURES,t},Tilemap.prototype.generateLayers=function(t){var e=this,i=e.data;if(i){for(var r=e.game,n=e._dataInfo,o=n.json,s=o.tilesets,a=[],h=0;h<s.length;h++)a.push({key:s[h].name,url:n.prefix+s[h].name+".bin"});r.assets.loadBatch(a,function(){for(var i=[],n=0;n<a.length;n++)i.push(new qc.Texture(a[n].asset));e.tilesets=i,e.removeChildren();var s=[];for(n=0;n<o.layers.length;n++){var h=o.layers[n];if("tilelayer"===h.type){var l=new TileLayer(r,e);l.name=h.name,l.tilemap=e,l.layerIndex=n,s.push(l)}else if("objectgroup"===h.type){var c=new ObjectLayer(r,e);c.name=h.name,c.tilemap=e,c.layerIndex=n,s.push(c)}}e.layers=s,t&&t()})}},Tilemap.prototype.getLayerByIndex=function(t){var e=this._layers;return e&&t>=0&&t<e.length?e[t]:null},Tilemap.prototype.getLayerByName=function(t){var e=this._layers;if(e)for(var i=0;i<e.length;i++)if(e[i].name===t)return e[i];return null},Tilemap.prototype._getLayerJson=function(t,e){if(this._dataInfo){var i=this._dataInfo.json.layers;if(t>=0&&t<i.length){var r=i[t];if(r.type===e)return r}return null}},Tilemap.prototype.resetNativeSize=function(){var t=this.nativeSize;t&&(this.width=t.width,this.height=t.height)},Tilemap.prototype.getTilePosition=function(t,e){return new qc.Point(Math.floor(t/this.tileWidth),Math.floor(e/this.tileHeight))},Object.defineProperties(Tilemap.prototype,{nativeSize:{get:function(){var t=this._dataInfo;return t?new qc.Rectangle(0,0,t.map.widthInPixels,t.map.heightInPixels):null}},layers:{get:function(){return this._layers},set:function(t){this._layers=t}},tilesets:{get:function(){return this._tilesets},set:function(t){this._tilesets=t}},scrollX:{get:function(){return this._scrollX},set:function(t){this._scrollX=t}},scrollY:{get:function(){return this._scrollY},set:function(t){this._scrollY=t}},tileWidth:{get:function(){return this._dataInfo.json.tilewidth}},tileHeight:{get:function(){return this._dataInfo.json.tileheight}},mapWidth:{get:function(){return this._dataInfo.json.width}},mapHeight:{get:function(){return this._dataInfo.json.height}},data:{get:function(){return this._data},set:function(t){var e=this,i=e.game,r=null;if(t){if(!(t instanceof TextAsset))return;try{var n=JSON.parse(t.text);if(!n.layers||!n.tilesets)throw new Error("Invalid tilemap data format");i.phaser.load.tilemap(t.url,null,n,Phaser.Tilemap.TILED_JSON);for(var o=i.phaser.add.tilemap(t.url),s=0,a=0,h=0;h<o.tilesets.length;h++)s=Math.max(s,o.tilesets[h].tileWidth),a=Math.max(a,o.tilesets[h].tileHeight);o.maxTileWidth=s,o.maxTileHeight=a;var l=t.url.lastIndexOf("/");r={json:n,map:o,prefix:l>=0?t.url.substring(0,l+1):""}}catch(e){return i.log.error("Asset{0}/{1} Parse fail",t.key,t.url,e),void qc.Util.popupError(e.message)}}e._data=t,e._dataInfo=r}},class:{get:function(){return"qc.Tilemap"}}});var TileLayer=qc.TileLayer=function(t,e,i){var r=this,n=new Phaser.Sprite(t.phaser);qc.Node.call(r,n,e,i),r.name="TileLayer",r._cache={},r._dirtyTiles=null,n.canvas=Phaser.Canvas.create(1,1),n.context=n.canvas.getContext("2d"),n.baseTexture=new PIXI.BaseTexture(n.canvas),n.texture=new PIXI.Texture(n.baseTexture),r.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),r.setStretch(0,0,0,0);var o=n._renderCanvas,s=n._renderWebGL;n._renderCanvas=function(){r._renderTiles(),o.apply(n,arguments)},n._renderWebGL=function(){r._renderTiles(),s.apply(n,arguments)}};TileLayer.prototype=Object.create(qc.Node.prototype),TileLayer.prototype.constructor=TileLayer,TileLayer.prototype._tilemap=null,TileLayer.prototype._layerIndex=-1,TileLayer.prototype._scrollXRatio=1,TileLayer.prototype._scrollYRatio=1,TileLayer.prototype.getMeta=function(){var t=qc.Node.prototype.getMeta.call(this);return t.tilemap=Serializer.NODE,t.layerIndex=Serializer.INT,t.scrollXRatio=Serializer.NUMBER,t.scrollYRatio=Serializer.NUMBER,t},TileLayer.prototype.getTile=function(t,e){var i=this._cache,r=this.tilemap;if(!r)return undefined;var n=i.phaserLayer;if(!n||i.tilemap!==r||i.layerIndex!==this.layerIndex){n=null;var o=r._getLayerJson(this.layerIndex,"tilelayer");if(o){var s=r._dataInfo.map,a=s.getLayerIndex(o.name);a>=0&&(n=s.layers[a])}}return n&&n.data&&n.data[e]?n.data[e][t]:undefined},TileLayer.prototype.getTileIndex=function(t,e){var i=this.getTile(t,e);return i?i.index:1/0},TileLayer.prototype.setTileIndex=function(t,e,i){var r=this.getTile(t,e);r&&r.index!==i&&(r.index=i,this._dirtyTiles||(this._dirtyTiles={}),this._dirtyTiles[t+"|"+e]={x:t,y:e})},TileLayer.prototype.redrawAll=function(){this._redrawAllFlag=!0},TileLayer.prototype._renderTiles=function(){var t=this,e=t.tilemap;if(e){var i=t._cache,r=t.phaser,n=e._dataInfo.map,o=t._checkTileLayerChange(n),s=i.phaserLayer;if(s){t._redrawAllFlag&&(o=!0,t._redrawAllFlag=!1);var a=r.context,h=s.data,l=Math.round(t.width),c=Math.round(t.height),u=e.scrollX,p=e.scrollY,d=t.scrollXRatio,f=t.scrollYRatio;o=t._checkSizeChange(l,c)||o;var g=!1;if(o||i.scrollX!==u||i.scrollY!==p||i.scrollXRatio!==d||i.scrollYRatio!==f){var y=Math.round(u*d),m=Math.round(p*f),_=i.viewRect,v=new Phaser.Rectangle(-y,-m,l,c);if(!o){var x=Phaser.Rectangle.intersection(_,v);if(x.width>10&&x.height>10){var T=x.x-_.x,S=x.y-_.y,w=x.width,b=x.height;e._copyCanvas.width!==l&&(e._copyCanvas.width=l),e._copyCanvas.height!==c&&(e._copyCanvas.height=c),e._copyContext.clearRect(T,S,w,b),e._copyContext.drawImage(r.canvas,T,S,w,b,T,S,w,b)}else o=!0}a.clearRect(0,0,l,c),a.translate(y,m),o?(t._dirtyTiles=null,t._drawRect(a,n,h,-y,-m,l,c)):(a.drawImage(e._copyCanvas,T,S,w,b,x.x,x.y,w,b),v.contains(_.left,_.top)?(t._drawRect(a,n,h,v.x,v.y,x.x-v.x,v.height),t._drawRect(a,n,h,x.x,v.y,v.right-x.x,x.y-v.y)):v.contains(_.right,_.top)?(t._drawRect(a,n,h,v.x,v.y,x.right-v.x,x.y-v.y),t._drawRect(a,n,h,x.right,v.y,v.right-x.right,v.height)):v.contains(_.left,_.bottom)?(t._drawRect(a,n,h,v.x,v.y,x.x-v.x,v.height),t._drawRect(a,n,h,x.x,x.bottom,v.right-x.x,v.bottom-x.bottom)):v.contains(_.right,_.bottom)&&(t._drawRect(a,n,h,v.x,x.bottom,x.right-v.x,v.bottom-x.bottom),t._drawRect(a,n,h,x.right,v.y,v.right-x.right,v.height))),a.translate(-y,-m),g=!0,i.scrollX=u,i.scrollY=p,i.scrollXRatio=d,i.scrollYRatio=f,i.viewRect=v}var P=t._renderDirtyTiles(a,n,h);(g||P)&&(r.texture.baseTexture.dirty(),r.displayChanged(qc.DisplayChangeStatus.TEXTURE))}}},TileLayer.prototype._renderDirtyTiles=function(t,e,i){var r=this,n=!1;if(r._dirtyTiles){var o=e.maxTileWidth,s=e.maxTileHeight,a=e.tileWidth,h=e.tileHeight,l=r._cache.viewRect,c=o>a?-o:0,u=s>h?s:0,p=Math.floor((l.x+c)/a),d=Math.floor(l.y/h),f=Math.ceil((l.x+l.width)/a),g=Math.ceil((l.y+l.height+u)/h);for(var y in t.translate(-l.x,-l.y),r._dirtyTiles){var m=r._dirtyTiles[y],_=m.x,v=m.y;_>=p&&_<=f&&v>=d&&v<=g&&(r._drawRect(t,e,i,_*a,v*h+h-s,o,s,!0),n=!0)}t.translate(l.x,l.y),r._dirtyTiles=null}return n},TileLayer.prototype._checkTileLayerChange=function(t){var e=this._cache,i=this.tilemap,r=this.layerIndex;if(e.tilemap!==i||e.layerIndex!==r){e.phaserLayer=null;var n=i._getLayerJson(r,"tilelayer");if(n){var o=t.getLayerIndex(n.name);o>=0&&(e.phaserLayer=t.layers[o])}return e.tilemap=i,e.layerIndex=r,!0}return!1},TileLayer.prototype._checkSizeChange=function(t,e){var i=this._cache,r=this.phaser,n=r.texture;return(i.width!==t||i.height!==e)&&(r.canvas.width=t,r.canvas.height=e,n.frame.width=t,n.frame.height=e,n.width=t,n.height=e,n.crop.width=t,n.crop.height=e,n.baseTexture.width=t,n.baseTexture.height=e,n.baseTexture.dirty(),i.width=t,i.height=e,!0)},TileLayer.prototype._drawRect=function(t,e,i,r,n,o,s,a){if(o&&s){a&&t.clearRect(r,n,o,s),t.save(),t.beginPath(),t.rect(r,n,o,s),t.clip();var h=e.maxTileWidth,l=e.maxTileHeight,c=e.tileWidth,u=e.tileHeight,p=Math.floor((h>c?r-h:r)/c),d=Math.floor(n/u),f=Math.ceil((r+o)/c),g=Math.ceil((l>u?n+s+l:n+s)/u);for(p<0&&(p=0),d<0&&(d=0),f>e.width&&(f=e.width),g>e.height&&(g=e.height),n=d;n<g;n++){var y=i[n];for(r=p;r<f;r++)this._drawTile(t,e,y[r],r,n)}t.restore()}},TileLayer.prototype._drawTile=function(t,e,i,r,n){var o=i.index;if(!(o<=0)){var s=e.tiles[o],a=e.tilesets[s[2]],h=a.asset;if(h===undefined){var l=this.tilemap._dataInfo.prefix+a.name+".bin",c=this.tilemap.tilesets;if(c)for(var u=0;u<c.length;u++)if(c[u].atlas.url===l){h=c[u];break}a.asset=h||null}h&&t.drawImage(h.atlas.img,s[0],s[1],a.tileWidth,a.tileHeight,i.worldX,i.worldY+e.tileHeight-a.tileHeight,a.tileWidth,a.tileHeight)}},Object.defineProperties(TileLayer.prototype,{tilemap:{get:function(){return this._tilemap&&this._tilemap._destroy&&(this._tilemap=null),this._tilemap},set:function(t){(!t||t instanceof Tilemap)&&(this._tilemap=t)}},layerIndex:{get:function(){return this._layerIndex},set:function(t){this._layerIndex=t}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(t){this._scrollXRatio=t}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(t){this._scrollYRatio=t}},class:{get:function(){return"qc.TileLayer"}}});var ObjectLayer=qc.ObjectLayer=function(t,e,i){qc.Node.call(this,new Phaser.Group(t.phaser,null),e,i),this.name="ObjectLayer",this.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),this.setStretch(0,0,0,0)};ObjectLayer.prototype=Object.create(qc.Node.prototype),ObjectLayer.prototype.constructor=ObjectLayer,ObjectLayer.prototype._tilemap=null,ObjectLayer.prototype._layerIndex=-1,ObjectLayer.prototype._scrollXRatio=1,ObjectLayer.prototype._scrollYRatio=1,ObjectLayer.prototype.getMeta=function(){var t=qc.Node.prototype.getMeta.call(this);return t.tilemap=Serializer.NODE,t.layerIndex=Serializer.INT,t.scrollXRatio=Serializer.NUMBER,t.scrollYRatio=Serializer.NUMBER,t},ObjectLayer.prototype.update=function(){this._tilemap&&this._tilemap._destroy&&(this._tilemap=null);var t=this._tilemap;t&&(this.x=t.scrollX*this.scrollXRatio,this.y=t.scrollY*this.scrollXRatio)},Object.defineProperties(ObjectLayer.prototype,{tilemap:{get:function(){return this._tilemap&&this._tilemap._destroy&&(this._tilemap=null),this._tilemap},set:function(t){(!t||t instanceof Tilemap)&&(this._tilemap=t)}},layerIndex:{get:function(){return this._layerIndex},set:function(t){this._layerIndex=t}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(t){this._scrollXRatio=t}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(t){this._scrollYRatio=t}},class:{get:function(){return"qc.ObjectLayer"}}});var Dom=qc.Dom=function(t,e,i){var r=this;r.game=t,qc.Node.call(this,new Phaser.Group(this.game.phaser,null),e,i),r.name="dom";var n=r.div=document.createElement("div");n.style.position="absolute",n.setAttribute("id",r.uuid),n._qc=r,r.overflow="hidden",r.serializable=!0,r.phaser.worldTransformChangedCallback=r._updateDomTransform,r.phaser.worldTransformChangedContext=r,r.pos=Dom.POS_FRONT,r._updateDomTransform(),r.game.device.android&&(r.game.timer.add(1,function(){r._destroy||(r.rotation+=.001)}),r.game.timer.add(40,function(){r._destroy||(r.rotation-=.002)}),r.game.timer.add(300,function(){r._destroy||(r.rotation+=5e-4)}),r.game.timer.add(1e3,function(){r._destroy||(r.rotation+=5e-4)}))};Dom.prototype=Object.create(qc.Node.prototype),Dom.prototype.constructor=Dom,Dom.POS_NONE=-1,Dom.POS_BACK=0,Dom.POS_FRONT=1,Object.defineProperties(Dom.prototype,{class:{get:function(){return"qc.Dom"}},pos:{get:function(){return this._pos},set:function(t){this.pos!==t&&(this._pos=t,this.div.parentNode&&this.div.parentNode.removeChild(this.div),t===Dom.POS_BACK?(this.game.world.backDomRoot.appendChild(this.div),this.zIndex>=0&&(this.zIndex=-1)):t===Dom.POS_FRONT&&(this.game.world.frontDomRoot.appendChild(this.div),this.zIndex<=0&&(this.zIndex=1)))}},zIndex:{get:function(){return this.div.style.zIndex||0},set:function(t){t!==this.div.style.zIndex&&(this._pos===Dom.POS_BACK&&t>=0?t=-1:this._pos===Dom.POS_FRONT&&t<=0&&(t=1),this.div.style.zIndex=t)}},innerHTML:{get:function(){return this.div.innerHTML},set:function(t){this.div.innerHTML=t}},className:{get:function(){return this.div.className},set:function(t){this.div.className=t}},overflow:{get:function(){return this._overflow},set:function(t){t!==this._overflow&&(this._overflow=t,this.div.style.overflow=t)}},alpha:{get:function(){var t=this.div,e=t.style.opacity;return e?1*e:1},set:function(t){var e=this,i=e.div;t!==i.alpha&&(i.style.filter="alpha(opacity:"+100*t+")",i.style.opacity=t)}}}),Dom.prototype._dispatchAwake=function(){Node.prototype._dispatchAwake.call(this),this._updateDomTransform()},Dom.prototype.onVisibleChange=function(){this._updateDomTransform()},Dom.prototype.onRemoveFromWorld=function(){this.div&&this.div.parentNode&&this.div.parentNode.removeChild(this.div)},Dom.prototype.onAddToWorld=function(){if(this.div&&!this.div.parentNode){var t=this.pos;t===Dom.POS_BACK?(this.game.world.backDomRoot.appendChild(this.div),this.zIndex>=0&&(this.zIndex=-1)):t===Dom.POS_FRONT&&(this.game.world.frontDomRoot.appendChild(this.div),this.zIndex<=0&&(this.zIndex=1))}},Dom.prototype.onDestroy=function(){this.div._qc=null,this.div.parentNode&&this.div.parentNode.removeChild(this.div),qc.Node.prototype.onDestroy.call(this)},Dom.prototype.getMeta=function(){var t=this,e=qc.Serializer,i=qc.Node.prototype.getMeta.call(this);return i.pos=e.NUMBER,i.className=e.STRING,i.overflow=e.STRING,i.innerHTML={get:function(t,e){return t.serializable?[!0,t.innerHTML]:undefined},set:function(e,i){i?(t.serializable=!0,t.innerHTML=i[1]):(t.serializable=!1,t.innerHTML="")}},i.zIndex=e.INT,i},Dom.prototype._updateDomTransform=function(){qc.Util.updateTransform(this,this.div),this.div.style.display=this.isWorldVisible()?"block":"none"};var Graphics=qc.Graphics=function(t,e,i){var r=this;r.game=t,qc.Node.call(this,new Phaser.Graphics(this.game.phaser),e,i),r.name="graphics"};Graphics.prototype=Object.create(qc.Node.prototype),Graphics.prototype.constructor=Graphics,Object.defineProperties(Graphics.prototype,{class:{get:function(){return"qc.Graphics"}},fillAlpha:{get:function(){return this.phaser.fillAlpha},set:function(t){this.phaser.fillAlpha=t}},lineWidth:{get:function(){return this.phaser.lineWidth},set:function(t){this.phaser.lineWidth=t}},lineColor:{get:function(){return this.phaser.lineColor},set:function(t){this.phaser.lineColor=t}},blendMode:{get:function(){return this.phaser.blendMode},set:function(t){this.phaser.blendMode=t}},boundsPadding:{get:function(){return this.phaser.boundsPadding},set:function(t){this.phaser.boundsPadding=t}}}),Graphics.prototype.getMeta=function(){qc.Serializer;var t=qc.Node.prototype.getMeta.call(this);return t},Graphics.prototype.drawTriangle=function(t,e){return this.phaser.drawTriangle(t,e)},Graphics.prototype.drawTriangles=function(t,e,i){return this.phaser.drawTriangles(t,e,i)},Graphics.prototype.lineStyle=function(t,e,i){return this.phaser.lineStyle(t,e,i)},Graphics.prototype.moveTo=function(t,e){return this.phaser.moveTo(t,e)},Graphics.prototype.lineTo=function(t,e){return this.phaser.lineTo(t,e)},Graphics.prototype.quadraticCurveTo=function(t,e,i,r){return this.quadraticCurveTo(t,e,i,r)},Graphics.prototype.bezierCurveTo=function(t,e,i,r,n,o){return this.phaser.bezierCurveTo(t,e,i,r,n,o)},Graphics.prototype.arcTo=function(t,e,i,r,n){return this.phaser.arcTo(t,e,i,r,n)},Graphics.prototype.arc=function(t,e,i,r,n,o){return this.phaser.arc(t,e,i,r,n,o)},Graphics.prototype.beginFill=function(t,e){return this.phaser.beginFill(t,e)},Graphics.prototype.endFill=function(){return this.phaser.endFill()},Graphics.prototype.drawRect=function(t,e,i,r){return this.phaser.drawRect(t,e,i,r)},Graphics.prototype.drawRoundedRect=function(t,e,i,r,n){return this.phaser.drawRoundedRect(t,e,i,r,n)},Graphics.prototype.drawCircle=function(t,e,i){return this.phaser.drawCircle(t,e,i)},Graphics.prototype.drawEllipse=function(t,e,i,r){return this.phaser.drawEllipse(t,e,i,r)},Graphics.prototype.drawPolygon=function(t){return this.phaser.drawPolygon(t)},Graphics.prototype.clear=function(){return this.phaser.clear()},Graphics.prototype.generateTexture=function(t,e){return this.phaser.generateTexture(t,e)},Graphics.prototype.containsPoint=function(t){return this.phaser.containsPoint(t)},Graphics.prototype.drawShape=function(t){return this.phaser.drawShape(t)};var Dropdown=qc.Dropdown=function(t,e,i){var r=this;qc.UIImage.call(r,t,e,i),r.onStateChange=new qc.Signal,r.onValueChange=new qc.Signal,r.captionImage=null,r.captionText=null,r.item=null,r.options=[],r.template=null;var n=i!==undefined;if(r.name="Dropdown",r.interactive=!0,r._items=[],r._value=-1,!0!==n){r.captionText=t.add.text(r),r.captionText.name="Label",r.captionImage=t.add.image(r),r.captionImage.name="Image",r.template=t.add.scrollView(r),r.template.interactive=!0,r.template.name="Template";var o=r.template.addScript("qc.NodeMask");o.checkInField=!1,r.template.content=t.add.node(r.template),r.template.visible=!1,r.template.content.name="Content";var s=r.item=t.add.node(r.template.content);s.name="Item",s.interactive=!0;var a=s.addScript("qc.DropdownItem");a.checkBackground=t.add.image(s),a.checkBackground.name="Background",a.checkMark=t.add.image(s),a.checkMark.name="CheckMark",a.text=t.add.text(s),a.text.name="Text",a.image=t.add.image(s),a.image.name="Image",a.image.visible=!1}r.addListener(r.onDown,function(){r.state!==qc.UIState.DISABLED&&(r.state=qc.UIState.PRESSED)}),r.addListener(r.onUp,function(){r.state===qc.UIState.PRESSED&&(r.state=qc.UIState.NORMAL)}),r.addListener(r.onClick,function(t){r.isFocused=!r.isFocused}),r.phaser.worldTransformChangedCallback=r._updatePosition,r.phaser.worldTransformChangedContext=r,r._updatePosition()};Dropdown.prototype=Object.create(qc.UIImage.prototype),Dropdown.prototype.constructor=Dropdown,Object.defineProperties(Dropdown.prototype,{class:{get:function(){return"qc.Dropdown"}},state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},value:{get:function(){return this.options.length>0?this._value:-1},set:function(t){if(!(this._value===t||t>=this.options.length)&&"number"==typeof this._value){var e=this._items[this._value],i=this._items[t];this._value=t,
e&&e.getScript("qc.DropdownItem").redraw(),i&&i.getScript("qc.DropdownItem").redraw(),this._redraw(),this.onValueChange.dispatch(t)}}},isFocused:{get:function(){return this._list&&this._list.visible},set:function(t){t!==this.isFocused&&(t?this.show():this.hide())}}}),Dropdown.prototype._dispatchAwake=function(){var t=this;Node.prototype._dispatchAwake.call(t),t._value&&0!==t.options.length||(t._value=-1),t._redraw()},Dropdown.prototype.addOptions=function(t){var e=this,i=e.options.concat(t);0===e.options.length?(e.options=i,this.value=0):e.options=i,e.isFocused&&e.show()},Dropdown.prototype.clearOptions=function(){var t=this;t.options=[],t._value>=0&&(t._value=-1,t.onValueChange.dispatch(t._value)),t.isFocused&&t.hide(),t._redraw()},Dropdown.prototype.show=function(){var t=this,e=t._list;t.hide(),t._maskNode=t.game.add.node(t.game.world),t._maskNode.interactive=!0,t._maskNode.name="mask",t._maskNode.addListener(t._maskNode.onClick,function(){t.hide()}),t._items=[],t.item.visible=!1,e=t._list=t.game.add.clone(t.template,t.game.world);for(var i="",r=t.item.parent;r!==t.template;)i=""===i?r.name:r.name+"/"+i,r=r.parent;for(var n=""===i?e:e.find(i),o=0;o<t.options.length;o++){var s=t.game.add.clone(t.item,n);s.visible=!0;var a=s.getScript("qc.DropdownItem");a.dropdown=t,a.index=o,t._items.push(s)}e.visible=!0,t._updatePosition()},Dropdown.prototype.hide=function(){var t=this,e=t._list;e&&(e.destroy(),delete t._list),t._maskNode&&(t._maskNode.destroy(),delete t._maskNode),t._items=[]},Dropdown.prototype.getMeta=function(){var t=this,e=qc.Serializer,i=qc.UIImage.prototype.getMeta.call(t);return i.captionImage=e.NODE,i.captionText=e.NODE,i.template=e.NODE,i.item=e.NODE,i.maskNode=e.NODE,i.state=e.NUMBER,i._value=e.NUMBER,i.options={get:function(e,i){for(var r=[],n=0;n<t.options.length;n++){var o=t.options[n];o?"string"!=typeof o?r.push(t.game.serializer._saveTextureItem(o,i)):r.push(o):r.push(undefined)}return r},set:function(e,i){i.forEach(function(e){e&&"string"!=typeof e?t.options.push(t.game.serializer._restoreTextureItem(e)):t.options.push(e)})}},i},Dropdown.prototype._redraw=function(){var t=this;if(0===t.options.length||t.value<0||t.value>=t.options.length)return t.captionImage&&(t.captionImage.visible=!1),void(t.captionText&&(t.captionText.visible=!1));var e=t.options[t.value];"string"==typeof e?(t.captionImage&&(t.captionImage.visible=!1),t.captionText&&(t.captionText.visible=!0,t.captionText.text=e)):e&&(t.captionText&&(t.captionText.visible=!1),t.captionImage&&(t.captionImage.visible=!0,t.captionImage.texture=e))},Dropdown.prototype._updatePosition=function(){var t=this,e=t._list;if(e){t.template.visible=!0;var i=qc.Bounds.getBox(t,Bounds.USE_BOUNDS,!0,0),r=qc.Bounds.getBox(t.template,Bounds.USE_BOUNDS,!0,0),n=r.y;if(r.height<t.game.world.height/2&&r.y+r.height>t.game.world.height){var o=r.y-(i.y+i.height);n=i.y-o-r.height}var s=t.template.getWorldPosition();e.setAnchor(new qc.Point(0,0),new qc.Point(0,0)),e.x=s.x,e.y=n-e.pivotY*e.height;var a=t.template.getWorldScale();e.scaleX=a.x,e.scaleY=a.y,e.rotation=t.template.getWorldRotation(),e.width=t.template.width,e.height=t.template.height,t._maskNode.x=t._maskNode.y=0,t._maskNode.width=t.game.world.width,t._maskNode.height=t.game.world.height,t.template.visible=!1}};var Bounds=defineBehaviour("qc.Bounds",qc.Behaviour,function(){this._sizeProvider=Bounds.USE_BOUNDS,this._autoCalcBounds=!0,this._marginTop=this._marginBottom=this._marginLeft=this._marginRight=0,this._paddingTop=this._paddingBottom=this._paddingLeft=this._paddingRight=0,this._deep=1},{_sizeProvider:qc.Serializer.NUMBER,_marginTop:qc.Serializer.NUMBER,_marginBottom:qc.Serializer.NUMBER,_marginLeft:qc.Serializer.NUMBER,_marginRight:qc.Serializer.NUMBER,_paddingTop:qc.Serializer.NUMBER,_paddingBottom:qc.Serializer.NUMBER,_paddingLeft:qc.Serializer.NUMBER,_paddingRight:qc.Serializer.NUMBER,_autoCalcBounds:qc.Serializer.BOOLEAN});Bounds.__hiddenInMenu=!0,Object.defineProperties(Bounds.prototype,{sizeProvider:{get:function(){return this._sizeProvider},set:function(t){this._sizeProvider!==t&&(this._sizeProvider=t,this.getBounds(!0))}},marginTop:{get:function(){return this._marginTop},set:function(t){this.setMargin(t)}},marginBottom:{get:function(){return this._marginBottom},set:function(t){this.setMargin(null,null,t)}},marginLeft:{get:function(){return this._marginLeft},set:function(t){this.setMargin(null,null,null,t)}},marginRight:{get:function(){return this._marginRight},set:function(t){this.setMargin(null,t)}},paddingTop:{get:function(){return this._paddingTop},set:function(t){this.setPadding(t)}},paddingBottom:{get:function(){return this._paddingBottom},set:function(t){this.setPadding(null,null,t)}},paddingLeft:{get:function(){return this._paddingLeft},set:function(t){this.setPadding(null,null,null,t)}},paddingRight:{get:function(){return this._paddingRight},set:function(t){this.setPadding(null,t)}},autoCalcBounds:{get:function(){return this._autoCalcBounds},set:function(t){this._autoCalcBounds=t}}}),Bounds.prototype.setPadding=function(t,e,i,r){null!=t&&(this._paddingTop=t),null!=e&&(this._paddingRight=e),null!=i&&(this._paddingBottom=i),null!=r&&(this._paddingLeft=r),this._lastWrapTime=null,this.relayout&&this.relayout(),this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")},Bounds.prototype.setMargin=function(t,e,i,r){null!=t&&(this._marginTop=t),null!=e&&(this._marginRight=e),null!=i&&(this._marginBottom=i),null!=r&&(this._marginLeft=r),this._lastWrapTime=null,this.relayout&&this.relayout(),this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")},Bounds.prototype.calcBounds=function(){this.getBounds(!0)},Bounds.prototype.getBounds=function(t){var e=this._recordBounds||new qc.Rectangle(0,0,0,0);if(!this.enable||!this.gameObject||!this.gameObject.isWorldVisible())return e;if(this._recordBounds&&!t&&(!this.autoCalcBounds||this._lastWrapTime===this.gameObject.game.time.fixedTime))return this._recordBounds;this._lastWrapTime=this.gameObject.game.time.fixedTime;var i=new qc.Point(0,0),r=new qc.Point(0,0);return Bounds._calcBounds(i,r,this.sizeProvider,this.gameObject,this._deep),e.x=i.x,e.y=i.y,e.width=r.x-i.x,e.height=r.y-i.y,this._recordBounds=e,e},Bounds.prototype.getWorldCorners=function(t){var e=this.getBounds(t),i=new qc.Point(e.x,e.y),r=new qc.Point(e.x+e.width,e.y),n=new qc.Point(e.x+e.width,e.y+e.height),o=new qc.Point(e.x,e.y+e.height),s=this.gameObject.worldTransform;return[s.apply(i),s.apply(r),s.apply(n),s.apply(o)]},Bounds._calcBounds=function(t,e,i,r,n){var o=r.getScript("qc.Bounds");i=o&&o.enable?o.sizeProvider:i,i===Bounds.USE_BOUNDS?this._calcRealBounds(t,e,r,n):this._calcRectBounds(t,e,r,n)},Bounds._calcRectBounds=function(t,e,i,r){var n=i.getScript("qc.Bounds"),o=i.rect,s=o.x,a=o.y,h=o.x+o.width,l=o.y+o.height;if(0!==r)for(var c=i.children,u=c.length;u--;){var p=c[u];if(p.isWorldVisible()){var d=p.getScript("qc.Bounds"),f=new qc.Point(0,0),g=new qc.Point(0,0);if(d){var y=d.getBounds();f.x=y.x,f.y=y.y,g.x=y.x+y.width,g.y=y.y+y.height}else Bounds._calcRectBounds(f,g,p,r-1);n&&n.enable&&(f.x-=n.paddingLeft,f.y-=n.paddingTop,g.x+=n.paddingRight,g.y+=n.paddingBottom),s=Math.min(s,f.x),a=Math.min(a,f.y),h=Math.max(h,g.x),l=Math.max(l,g.y)}}n&&n.enable&&(s-=n.marginLeft,a-=n.marginTop,h+=n.marginRight,l+=n.marginBottom),t.x=Math.min(t.x,s),t.y=Math.min(t.y,a),e.x=Math.max(e.x,h),e.y=Math.max(e.y,l)},Bounds._calcRealBounds=function(t,e,i,r){var n=i.getScript("qc.Bounds"),o=i.rect,s=o.x,a=o.y,h=o.x+o.width,l=o.y+o.height;if(0!==r)for(var c=i.worldTransform,u=i.children,p=u.length;p--;){var d=u[p];if(d.isWorldVisible()){var f=d.getScript("qc.Bounds"),g=new qc.Point(0,0),y=new qc.Point(0,0);if(f){var m=f.getBounds();g.x=m.x,g.y=m.y,y.x=m.x+m.width,y.y=m.y+m.height}else Bounds._calcRealBounds(g,y,d,r-1);var _=new qc.Point(g.x,g.y),v=new qc.Point(y.x,g.y),x=new qc.Point(y.x,y.y),T=new qc.Point(g.x,y.y),S=d.worldTransform;_=c.applyInverse(S.apply(_)),v=c.applyInverse(S.apply(v)),x=c.applyInverse(S.apply(x)),T=c.applyInverse(S.apply(T));var w=Math.min(_.x,v.x,x.x,T.x),b=Math.min(_.y,v.y,x.y,T.y),P=Math.max(_.x,v.x,x.x,T.x),A=Math.max(_.y,v.y,x.y,T.y);n&&n.enable&&(w-=n.paddingLeft,b-=n.paddingTop,P+=n.paddingRight,A+=n.paddingBottom),s=Math.min(s,w),a=Math.min(a,b),h=Math.max(h,P),l=Math.max(l,A)}}n&&n.enable&&(s-=n.marginLeft,a-=n.marginTop,h+=n.marginRight,l+=n.marginBottom),t.x=Math.min(t.x,s),t.y=Math.min(t.y,a),e.x=Math.max(e.x,h),e.y=Math.max(e.y,l)},Bounds.getBounds=function(t,e,i,r){r=null==r?0:r;var n=t.getScript("qc.Bounds");if(n&&n.enable)return n.getBounds(i);var o=new qc.Point(0,0),s=new qc.Point(0,0);Bounds._calcBounds(o,s,e,t,r);var a=new qc.Rectangle(0,0,0,0);return a.x=o.x,a.y=o.y,a.width=s.x-o.x,a.height=s.y-o.y,a},Bounds.getCorners=function(t,e,i,r,n){var o=Bounds.getBounds(t,e,i,r),s=t.worldTransform,a=n&&n.worldTransform;if(e===Bounds.USE_RECTTRANSFORM){for(var h=Bounds.findCommonRoot(t,n||t.game.world),l=0,c=0,u=t;u&&u!==t.game.world&&u!==h;)l+=u.x,c+=u.y,u=u.parent;for(u=n;u&&u!==t.game.world&&u!==h;)l-=u.x,c-=u.y;var p=new qc.Point(o.x+l,o.y+c),d=new qc.Point(o.x+o.width+l,o.y+c),f=new qc.Point(o.x+o.width+l,o.y+o.height+c),g=new qc.Point(o.x+l,o.y+o.height+c);return[p,d,f,g]}p=new qc.Point(o.x,o.y),d=new qc.Point(o.x+o.width,o.y),f=new qc.Point(o.x+o.width,o.y+o.height),g=new qc.Point(o.x,o.y+o.height);return a?[a.applyInverse(s.apply(p)),a.applyInverse(s.apply(d)),a.applyInverse(s.apply(f)),a.applyInverse(s.apply(g))]:[s.apply(p),s.apply(d),s.apply(f),s.apply(g)]},Bounds.getBox=function(t,e,i,r,n){for(var o=Bounds.getCorners(t,e,i,r,n),s=new qc.Point(-Number.MAX_VALUE,-Number.MAX_VALUE),a=new qc.Point(Number.MAX_VALUE,Number.MAX_VALUE),h=0;h<4;h++){var l=o[h];s.x=Math.max(s.x,l.x),s.y=Math.max(s.y,l.y),a.x=Math.min(a.x,l.x),a.y=Math.min(a.y,l.y)}return new qc.Rectangle(a.x,a.y,s.x-a.x,s.y-a.y)},Bounds.getContentRect=function(t){var e=t.rect,i=t.getScript("qc.Bounds");return i&&i.enable&&(e.x+=i.paddingLeft,e.y+=i.paddingTop,e.width-=i.paddingLeft+i.paddingRight,e.height-=i.paddingTop+i.paddingBottom),e},Bounds.getMargin=function(t){var e=t.getScript("qc.Bounds");return e&&e.enable?{top:e._marginTop,bottom:e._marginBottom,left:e._marginLeft,right:e._marginRight}:{top:0,bottom:0,left:0,right:0}},Bounds.findCommonRoot=function(t,e){if(!t||!e)return null;for(var i=t,r=e;i;){for(r=e;r;){if(i===r)return i;r=r.parent}i=i.parent}return null},Bounds.USE_BOUNDS=0,Bounds.USE_RECTTRANSFORM=1;var LayoutElement=defineBehaviour("qc.LayoutElement",qc.Bounds,function(){this.ignoreLayout=!1,this.minWidth=-1,this.minHeight=-1,this.preferredWidth=-1,this.preferredHeight=-1,this.flexibleWidth=-1,this.flexibleHeight=-1,this._deep=0},{ignoreLayout:qc.Serializer.BOOLEAN,minWidth:qc.Serializer.NUMBER,minHeight:qc.Serializer.NUMBER,preferredWidth:qc.Serializer.NUMBER,preferredHeight:qc.Serializer.NUMBER,flexibleWidth:qc.Serializer.NUMBER,flexibleHeight:qc.Serializer.NUMBER});LayoutElement.__menu="UI/Layout/LayoutElement",Object.defineProperties(LayoutElement.prototype,{ignoreLayout:{get:function(){return this._ignoreLayout},set:function(t){t!==this._ignoreLayout&&(this._ignoreLayout=t)}},minWidth:{get:function(){return this._minWidth},set:function(t){t!==this._minWidth&&(this._minWidth=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},minHeight:{get:function(){return this._minHeight},set:function(t){t!==this._minHeight&&(this._minHeight=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},preferredWidth:{get:function(){return this._preferredWidth},set:function(t){t!==this._preferredWidth&&(this._preferredWidth=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},preferredHeight:{get:function(){return this._preferredHeight},set:function(t){t!==this._preferredHeight&&(this._preferredHeight=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},flexibleWidth:{get:function(){return this._flexibleWidth},set:function(t){t!==this._flexibleWidth&&(this._flexibleWidth=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},flexibleHeight:{get:function(){return this._flexibleHeight},set:function(t){t!==this._flexibleHeight&&(this._flexibleHeight=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},hasMinWidth:{get:function(){return this.minWidth>=0},set:function(t){this.hasMinWidth!==t&&(this.minWidth=t?0:-1)}},hasMinHeight:{get:function(){return this.minHeight>=0},set:function(t){this.hasMinHeight!==t&&(this.minHeight=t?0:-1)}},hasPreferredWidth:{get:function(){return this.preferredWidth>=0},set:function(t){this.hasPreferredWidth!==t&&(this.preferredWidth=t?this.gameObject?this.gameObject.width:0:-1)}},hasPreferredHeight:{get:function(){return this.preferredHeight>=0},set:function(t){this.hasPreferredHeight!==t&&(this.preferredHeight=t?this.gameObject?this.gameObject.height:0:-1)}},hasFlexibleWidth:{get:function(){return this.flexibleWidth>=0},set:function(t){this.hasFlexibleWidth!==t&&(this.flexibleWidth=t?1:-1)}},hasFlexibleHeight:{get:function(){return this.flexibleHeight>=0},set:function(t){this.hasFlexibleHeight!==t&&(this.flexibleHeight=t?1:-1)}}}),LayoutElement.getLayoutElement=function(t){var e=new LayoutElement,i=t.getScript("qc.LayoutElement");return i&&!i.ignoreLayout&&(e.ignoreLayout=i.ignoreLayout,e.minWidth=i.minWidth,e.minHeight=i.minHeight,e.preferredWidth=i.preferredWidth,e.preferredHeight=i.preferredHeight,e.flexibleWidth=i.flexibleWidth,e.flexibleHeight=i.flexibleHeight),e},LayoutElement.USE_RECTTRANSFORM=qc.Bounds.USE_RECTTRANSFORM,LayoutElement.USE_BOUNDS=qc.Bounds.USE_BOUNDS;var TableLayout=defineBehaviour("qc.TableLayout",qc.Bounds,function(){this._cellStyle=[[this._buildCellInfo()]],this._constraint=TableLayout.CONSTRAINT_FLEXIBLE,this.runInEditor=!0,this.cellAlignment=TableLayout.ALIGN_TOP_LEFT,this.gameObject.onChildrenChanged.add(this._doChildrenChanged,this),this.gameObject.onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this)},{constraint:qc.Serializer.NUMBER,stride:qc.Serializer.NUMBER,startCorner:qc.Serializer.NUMBER,startAxis:qc.Serializer.NUMBER,contentSizeProvider:qc.Serializer.NUMBER,style:qc.Serializer.NUMBER,_cellStyle:qc.Serializer.MAPPING,autoUpdate:qc.Serializer.BOOLEAN,contentAlignment:qc.Serializer.NUMBER,cellAlignment:qc.Serializer.NUMBER,spacingX:qc.Serializer.NUMBER,spacingY:qc.Serializer.NUMBER,ignoreX:qc.Serializer.BOOLEAN,ignoreY:qc.Serializer.BOOLEAN});TableLayout.__menu="UI/Layout/TableLayout",TableLayout._precision=1e-7,Object.defineProperties(TableLayout.prototype,{constraint:{get:function(){return isNaN(this._constraint)?TableLayout.CONSTRAINT_FLEXIBLE:this._constraint},set:function(t){this._constraint!==t&&(this._constraint=t,this.rebuildTable())}},stride:{get:function(){return isNaN(this._stride)?0:this._stride},set:function(t){t!==this._stride&&(this._stride=t,this.rebuildTable())}},startCorner:{get:function(){return this._startCorner||TableLayout.CORNER_TOP_LEFT},set:function(t){t!==this._startCorner&&(this._startCorner=t,this.rebuildTable())}},startAxis:{get:function(){return this._startAxis||TableLayout.AXIS_HORIZONTAL},set:function(t){t!==this._startAxis&&(this._startAxis=t,this.rebuildTable())}},contentSizeProvider:{get:function(){return this._contentSizeProvider||TableLayout.USE_BOUNDS},set:function(t){t!==this._contentSizeProvider&&(this._contentSizeProvider=t,this.rebuildTable())}},style:{get:function(){return this._style||TableLayout.STYLE_WRAP_ELEMENT},set:function(t){t!==this._style&&(this._style=t,this.rebuildTable())}},autoUpdate:{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate=t}},spacingX:{get:function(){return this._spacingX||0},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.rebuildTable())}},spacingY:{get:function(){return this._spacingY||0},set:function(t){this._spacingY!==t&&(this._spacingY=t,this.rebuildTable())}},cellWidth:{get:function(){return this.getCellStyle(null,null).cellWidth},set:function(t){this.setCellStyle(null,null,null,null,null,null,null,t)}},cellHeight:{get:function(){return this.getCellStyle(null,null).cellHeight},set:function(t){this.setCellStyle(null,null,null,null,null,null,null,null,t)}},contentAlignment:{get:function(){return this._contentAlignment||TableLayout.ALIGN_TOP_LEFT},set:function(t){this._contentAlignment!==t&&(this._contentAlignment=t,this.rebuildTable())}},cellAlignment:{get:function(){return this.getCellStyle(null,null).align},set:function(t){this.cellAlignment!==t&&(this.setCellStyle(null,null,t),this.rebuildTable())}},columnsCount:{get:function(){var t=this._calcColumnRow();return t.x}},rowsCount:{get:function(){var t=this._calcColumnRow();return t.y}},ignoreX:{get:function(){return!!this._ignoreX},set:function(t){this._ignoreX!==t&&(this._ignoreX=t)}},ignoreY:{get:function(){return!!this._ignoreY},set:function(t){this._ignoreY!==t&&(this._ignoreY=t)}}}),TableLayout.prototype.postUpdate=function(){this.enable&&(this.autoUpdate||this._needRebuildTable)&&(this.rebuildTable(),this._needRebuildTable=!1)},TableLayout.prototype._getChildrenCount=function(){for(var t=0,e=this.gameObject.children,i=0;i<e.length;++i)e[i]&&e[i].isWorldVisible()&&t++;return t},TableLayout.prototype._getChildren=function(){for(var t=[],e=this.gameObject.children,i=0;i<e.length;++i)e[i]&&e[i].isWorldVisible()&&t.push(e[i]);return t},TableLayout.prototype._mixinStyle=function(t,e){return{align:(0==(240&e.align)?240&t.align:240&e.align)|(0==(15&e.align)?15&t.align:15&e.align),timestamp:Math.max(e.timestamp,t.timestamp),paddingLeft:isNaN(e.paddingLeft)?t.paddingLeft:e.paddingLeft,paddingRight:isNaN(e.paddingRight)?t.paddingRight:e.paddingRight,paddingTop:isNaN(e.paddingTop)?t.paddingTop:e.paddingTop,paddingBottom:isNaN(e.paddingBottom)?t.paddingBottom:e.paddingBottom,cellWidth:isNaN(e.cellWidth)?t.cellWidth:e.cellWidth,cellHeight:isNaN(e.cellHeight)?t.cellHeight:e.cellHeight}},TableLayout._calcRectTransform=function(t,e){e=isNaN(e)?0:e;var i=t.rect;if(0!==e)return i;for(var r=t.children,n=r.length;n--;){var o=TableLayout._calcRectTransform(r[n],e-1);i.x=Math.min(i.x,o.x),i.y=Math.min(i.y,o.y),i.w=Math.max(i.x+i.width,o.x+o.width)-i.x,i.h=Math.max(i.y+i.height,o.y+o.height)-i.y}return i},TableLayout.prototype.getCellRect=function(t,e){return qc.Bounds.getBox(t,this.contentSizeProvider,e,0,this.gameObject)},TableLayout.prototype.getCellStyle=function(t,e){t=null==t?0:t+1,e=null==e?0:e+1;var i=this._cellStyle[0][0],r=this._cellStyle[e]&&this._cellStyle[e][0],n=this._cellStyle[0][t];!n||r&&r.timestamp>n.timestamp?(n&&(i=this._mixinStyle(i,n)),r&&(i=this._mixinStyle(i,r))):(r&&(i=this._mixinStyle(i,r)),n&&(i=this._mixinStyle(i,n)));var o=this._cellStyle[e]&&this._cellStyle[e][t];return o&&(i=this._mixinStyle(i,o)),i.paddingTop=isNaN(i.paddingTop)?0:i.paddingTop,i.paddingLeft=isNaN(i.paddingLeft)?0:i.paddingLeft,i.paddingRight=isNaN(i.paddingRight)?0:i.paddingRight,i.paddingBottom=isNaN(i.paddingBottom)?0:i.paddingBottom,i.cellWidth=isNaN(i.cellWidth)?0:i.cellWidth,i.cellHeight=isNaN(i.cellHeight)?0:i.cellHeight,i},TableLayout.prototype.setCellStyle=function(t,e,i,r,n,o,s,a,h){t=null==t?0:t+1,e=null==e?0:e+1,this._cellStyle[e]||(this._cellStyle[e]=[]),this._cellStyle[e][t]||(this._cellStyle[e][t]=this._buildCellInfo());var l=this._cellStyle[e][t];null!=i&&(l.align=i),null!=r&&(l.paddingTop=r),null!=n&&(l.paddingRight=n),null!=o&&(l.paddingBottom=o),null!=s&&(l.paddingLeft=s),null!=a&&(l.cellWidth=a),l.cellHeight=h,this._cellStyle[e][t].timestamp=this.gameObject.game.time.fixedTime,this.rebuildTable()},TableLayout.prototype.clearCellStyle=function(t,e){t=null==t?0:t+1,e=null==e?0:e+1,0!==t||0!==e?this._cellStyle[e]&&this._cellStyle[e][t]&&(this._cellStyle[e][t]=null):this._cellStyle[0][0]=this._buildCellInfo()},TableLayout.prototype._buildCellInfo=function(){return{align:0,timestamp:0,paddingLeft:NaN,paddingRight:NaN,paddingTop:NaN,paddingBottom:NaN,cellWidth:NaN,cellHeight:NaN}},TableLayout.prototype._calcColumnRow=function(){var t=this._getChildrenCount(),e=this.stride,i=this.constraint;if(i===TableLayout.CONSTRAINT_FLEXIBLE){var r=this.getCellStyle(null,null),n=qc.Bounds.getContentRect(this.gameObject);this.startAxis===TableLayout.AXIS_HORIZONTAL?(e=Math.min(Math.max(1,Math.floor((n.width+this.spacingX)/(r.cellWidth+this.spacingX))),t),i=TableLayout.CONSTRAINT_FIX_COLUMN_COUNT):(e=Math.min(Math.max(1,Math.floor((n.height+this.spacingY)/(r.cellHeight+this.spacingY))),t),i=TableLayout.CONSTRAINT_FIX_ROW_COUNT)}var o=i===TableLayout.CONSTRAINT_FIX_ROW_COUNT?Math.ceil(t/e):e,s=i===TableLayout.CONSTRAINT_FIX_ROW_COUNT?e:Math.ceil(t/e);return new qc.Point(o,s)},TableLayout.prototype._calcPos=function(t,e){var i=this._calcColumnRow();return e=e||new qc.Point(0,0),this.startAxis===TableLayout.AXIS_HORIZONTAL?(e.x=t%i.x,e.y=Math.floor(t/i.x)):(e.x=Math.floor(t/i.y),e.y=t%i.y),0!=(240&this.startCorner)&&(e.x=i.x-1-e.x),0!=(15&this.startCorner)&&(e.y=i.y-1-e.y),e},TableLayout.prototype._setCellPosition=function(t,e){if(!this.ignoreX||this.columnsCount>1){var i=t.node.x;0!=(t.style.align&TableLayout.ALIGN_RIGHT)?i+=e.x-t.bounds.x+(e.width-t.bounds.width):0!=(t.style.align&TableLayout.ALIGN_CENTER)?i+=e.x-t.bounds.x+(e.width-t.bounds.width)/2:i+=e.x-t.bounds.x,Math.abs(i-t.node.x)>TableLayout._precision&&(t.node.x=i)}if(!this.ignoreY||this.rowsCount>1){var r=t.node.y;0!=(t.style.align&TableLayout.ALIGN_BOTTOM)?r+=e.y-t.bounds.y+(e.height-t.bounds.height):0!=(t.style.align&TableLayout.ALIGN_MIDDLE)?r+=e.y-t.bounds.y+(e.height-t.bounds.height)/2:r+=e.y-t.bounds.y,Math.abs(r-t.node.y)>TableLayout._precision&&(t.node.y=r)}},TableLayout.prototype._setCellSize=function(t,e,i){if(!(Math.abs(t.bounds.width-e)<TableLayout._precision&&Math.abs(t.bounds.height-i)<TableLayout._precision)){var r=Bounds.getMargin(t.node),n=e-r.left-r.right,o=i-r.top-r.bottom,s=t.bounds.width-r.left-r.right,a=t.bounds.height-r.top-r.bottom;t.node.setAnchor(new qc.Point(0,0),new qc.Point(0,0),!1),t.node.x=0,t.node.y=0,s<=0?t.node.width=n:t.node.width*=n/s,a<=0?t.node.height=o:t.node.height*=o/a,t.node.setStretch(0,0,0,0),t.bounds=this.getCellRect(t.node,!0)}},TableLayout.prototype.relayout=function(){this.rebuildTable()},TableLayout.prototype.rebuildTable=function(){this.getCellStyle(null,null);this.style===TableLayout.STYLE_WRAP_ELEMENT?this._rebuildWrapTable():this._rebuildResizeTable()},TableLayout.prototype._getDefaultLayout=function(t){return{min:0,preferred:0,flexible:0,extra:0}},TableLayout.prototype.getCellLayout=function(t){return qc.LayoutElement.getLayoutElement(t)},TableLayout.prototype._rebuildResizeTable=function(){for(var t=this._getChildren(),e=[],i=[],r=[],n=[],o=[],s=t.length,a=new qc.Point(0,0),h=-1;++h<s;){this._calcPos(h,a);var l=this.getCellLayout(t[h]),c=this.getCellStyle(a.x,a.y),u=this.getCellRect(t[h]);(e[a.y]||(e[a.y]=[]))[a.x]={node:t[h],layout:l,bounds:u,style:c};var p=n[a.x]||(n[a.x]=this._getDefaultLayout("x")),d=o[a.y]||(o[a.y]=this._getDefaultLayout("y"));l.preferredWidth<0&&t[h].nativeSize&&(l.preferredWidth=t[h].nativeSize.width),l.preferredHeight<0&&t[h].nativeSize&&(l.preferredHeight=t[h].nativeSize.height),!isNaN(c.cellWidth)&&c.cellWidth>0&&(l.minWidth=c.cellWidth,l.preferredWidth=c.cellWidth),!isNaN(c.cellHeight)&&c.cellHeight>0&&(l.minHeight=c.cellHeight,l.preferredHeight=c.cellHeight),l.minWidth>=0&&(p.min=Math.max(p.min,l.minWidth)),l.minHeight>=0&&(d.min=Math.max(d.min,l.minHeight)),p.preferred=Math.max(p.preferred,l.preferredWidth,p.min),d.preferred=Math.max(d.preferred,l.preferredHeight,p.min),l.flexibleWidth>=0&&(p.flexible=Math.max(p.flexible,l.flexibleWidth)),l.flexibleHeight>=0&&(d.flexible=Math.max(d.flexible,l.flexibleHeight)),p.extra=Math.max(p.extra,c.paddingLeft+c.paddingRight),d.extra=Math.max(d.extra,c.paddingTop+c.paddingBottom)}var f={min:0,preferred:0,flexible:0,extra:0,fixed:0},g={min:0,preferred:0,flexible:0,extra:0,fixed:0};n.forEach(function(t){f.min+=t.min,f.preferred+=t.preferred,f.flexible+=t.flexible,f.extra+=t.extra}),o.forEach(function(t){g.min+=t.min,g.preferred+=t.preferred,g.flexible+=t.flexible,g.extra+=t.extra});var y=qc.Bounds.getContentRect(this.gameObject),m=Math.max(0,n.length-1)*this.spacingX,_=Math.max(0,o.length-1)*this.spacingY,v=new qc.Point(0,0);if(y.width<=f.min+f.extra+m)for(var x=0;x<n.length;++x)n[x]?i[x]=n[x].min+n[x].extra:i[x]=0;else if(y.width<=f.preferred+f.extra+m){var T=y.width-f.extra-f.min-m;for(x=0;x<n.length;++x)n[x]?i[x]=T*n[x].preferred/(f.preferred||1)+n[x].min+n[x].extra:i[x]=0}else{for(T=y.width-f.extra-f.preferred-m,x=0;x<n.length;++x)n[x]?i[x]=T*n[x].flexible/(f.flexible||1)+n[x].preferred+n[x].extra:i[x]=0;0===f.flexible&&(0!=(this.contentAlignment&TableLayout.ALIGN_RIGHT)?v.x=T:0!=(this.contentAlignment&TableLayout.ALIGN_CENTER)&&(v.x=T/2))}if(y.height<=g.min+g.extra+_)for(x=0;x<o.length;++x)o[x]?r[x]=o[x].min+o[x].extra:r[x]=0;else if(y.height<=g.preferred+g.extra+_)for(T=y.height-g.extra-g.min-_,x=0;x<o.length;++x)o[x]?r[x]=T*o[x].preferred/(g.preferred||1)+o[x].min+o[x].extra:r[x]=0;else{for(T=y.height-g.extra-g.preferred-_,x=0;x<o.length;++x)o[x]?r[x]=T*o[x].flexible/(g.flexible||1)+o[x].preferred+o[x].extra:r[x]=0;0===g.flexible&&(0!=(this.contentAlignment&TableLayout.ALIGN_BOTTOM)?v.y=T:0!=(this.contentAlignment&TableLayout.ALIGN_MIDDLE)&&(v.y=T/2))}for(var S=qc.Bounds.getContentRect(this.gameObject),w=new qc.Rectangle(0,0,0,0),b=0,P=0,A=0;A<r.length;A++){b=0;for(var C=0;C<i.length;C++){var E=e[A][C];if(E){w.x=S.x+b+E.style.paddingLeft+v.x,w.y=S.y+P+E.style.paddingTop+v.y,w.width=i[C]-E.style.paddingLeft-E.style.paddingRight,w.height=r[A]-E.style.paddingTop-E.style.paddingBottom;var I=w.width,O=w.height;E.layout.flexibleWidth<=0&&w.width>E.layout.preferredWidth&&E.layout.preferredWidth>0&&(I=E.layout.preferredWidth),E.layout.flexibleHeight<=0&&w.height>E.layout.preferredHeight&&E.layout.preferredHeight>0&&(O=E.layout.preferredHeight),this._setCellSize(E,I,O),this._setCellPosition(E,w),b+=i[C]+this.spacingX}else b+=i[C]+this.spacingX}P+=r[A]+this.spacingY}},TableLayout.prototype._rebuildWrapTable=function(){for(var t=this._getChildren(),e=[],i=[],r=[],n=t.length,o=new qc.Point(0,0);n--;){this._calcPos(n,o);var s=this.getCellStyle(o.x,o.y),a=this.getCellRect(t[n]);(e[o.y]||(e[o.y]=[]))[o.x]={node:t[n],bounds:a,style:s},s.cellWidth>0?i[o.x]=s.cellWidth:i[o.x]=Math.max(a.width+s.paddingLeft+s.paddingRight,i[o.x]||0,s.cellWidth),s.cellHeight>0?r[o.y]=s.cellHeight:r[o.y]=Math.max(a.height+s.paddingTop+s.paddingBottom,r[o.y]||0,s.cellHeight)}for(var h=0,l=0,c=0;c<i.length;c++)h+=i[c];for(var u=0;u<r.length;u++)l+=r[u];var p=qc.Bounds.getContentRect(this.gameObject),d=new qc.Point(0,0);0!=(this.contentAlignment&TableLayout.ALIGN_BOTTOM)?d.y=p.height-l:0!=(this.contentAlignment&TableLayout.ALIGN_MIDDLE)&&(d.y=(p.height-l)/2),0!=(this.contentAlignment&TableLayout.ALIGN_RIGHT)?d.x=p.width-h:0!=(this.contentAlignment&TableLayout.ALIGN_CENTER)&&(d.x=(p.width-h)/2);var f=new qc.Rectangle(0,0,0,0),g=0,y=0;for(u=0;u<r.length;u++){g=0;for(c=0;c<i.length;c++){var m=e[u][c];if(m)f.x=p.x+g+m.style.paddingLeft+d.x,f.y=p.y+y+m.style.paddingTop+d.y,f.width=i[c]-m.style.paddingLeft-m.style.paddingRight,f.height=r[u]-m.style.paddingTop-m.style.paddingBottom,this._setCellPosition(m,f),g+=i[c]+this.spacingX;else{s=this.getCellStyle(c,u);var _=i[c]===undefined?s.cellWidth:i[c];g+=_+this.spacingX}}y+=r[u]+this.spacingY}},TableLayout.prototype._doChildrenChanged=function(t){var e=t.children.length;if("add"===t.type)for(;e--;)t.children[e]&&t.children[e].onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this);else if("remove"===t.type)for(;e--;)t.children[e]&&t.children[e].onLayoutArgumentChanged.remove(this._doLayoutArgumentChanged,this);this._needRebuildTable=!0},TableLayout.prototype._doLayoutArgumentChanged=function(){this._needRebuildTable=!0},TableLayout.CONSTRAINT_FLEXIBLE=0,TableLayout.CONSTRAINT_FIX_COLUMN_COUNT=1,TableLayout.CONSTRAINT_FIX_ROW_COUNT=2,TableLayout.STYLE_WRAP_ELEMENT=0,TableLayout.STYLE_RESIZE_ELEMENT=1,TableLayout.USE_RECTTRANSFORM=qc.LayoutElement.USE_RECTTRANSFORM,TableLayout.USE_BOUNDS=qc.LayoutElement.USE_BOUNDS,TableLayout.AXIS_HORIZONTAL=0,TableLayout.AXIS_VERTICAL=1,TableLayout.CORNER_TOP_LEFT=0,TableLayout.CORNER_TOP_RIGHT=16,TableLayout.CORNER_BOTTOM_RIGHT=17,TableLayout.CORNER_BOTTOM_LEFT=1,TableLayout.ALIGN_LEFT=1,TableLayout.ALIGN_CENTER=2,TableLayout.ALIGN_RIGHT=4,TableLayout.ALIGN_TOP=16,TableLayout.ALIGN_MIDDLE=32,TableLayout.ALIGN_BOTTOM=64,TableLayout.ALIGN_TOP_LEFT=TableLayout.ALIGN_TOP|TableLayout.ALIGN_LEFT,TableLayout.ALIGN_TOP_CENTER=TableLayout.ALIGN_TOP|TableLayout.ALIGN_CENTER,TableLayout.ALIGN_TOP_RIGHT=TableLayout.ALIGN_TOP|TableLayout.ALIGN_RIGHT,TableLayout.ALIGN_MIDDLE_LEFT=TableLayout.ALIGN_MIDDLE|TableLayout.ALIGN_LEFT,TableLayout.ALIGN_MIDDLE_CENTER=TableLayout.ALIGN_MIDDLE|TableLayout.ALIGN_CENTER,TableLayout.ALIGN_MIDDLE_RIGHT=TableLayout.ALIGN_MIDDLE|TableLayout.ALIGN_RIGHT,TableLayout.ALIGN_BOTTOM_LEFT=TableLayout.ALIGN_BOTTOM|TableLayout.ALIGN_LEFT,TableLayout.ALIGN_BOTTOM_CENTER=TableLayout.ALIGN_BOTTOM|TableLayout.ALIGN_CENTER,TableLayout.ALIGN_BOTTOM_RIGHT=TableLayout.ALIGN_BOTTOM|TableLayout.ALIGN_RIGHT;var Animator=defineBehaviour("qc.Animator",qc.Behaviour,function(){var t=this;t.animatorMap={},t.animatorList=[],t.animators=null,t.runInEditor=!0},{animators:qc.Serializer.ANIMATORS});Animator.__menu="Action/Animator",Object.defineProperties(Animator.prototype,{animators:{get:function(){return this._animators},set:function(t){for(var e=0;e<this.animatorList.length;e++){var i=this.animatorList[e];i&&i.destroy()}if(this.animatorMap={},this.animatorList=[],this._animators=t,t)for(e=0;e<t.length;e++){var r=t[e];if(r){r instanceof qc.ActionManagerAsset?this.animatorList[e]=qc.ActionManager.restoreBundle(r,this.game,!this.game.serializer.isRestoring):r instanceof qc.ActionAsset&&(this.animatorList[e]=qc.Action.restoreBundle(r,this.game,!this.game.serializer.isRestoring)),this.animatorList[e].targetLocked||(this.animatorList[e].targetObject=this.gameObject);var n=this.animatorList[e].name;this.animatorMap[n]&&this.gameObject.game.log.error("Exist duplicate action's name: {0}",n),this.animatorMap[n]=this.animatorList[e]}}}}}),Animator.prototype.awake=function(){if(!(this.animatorList.length<1))for(var t=0;t<this.animatorList.length;t++)this.animatorList[t]&&this.animatorList[t].awake()},Animator.prototype.update=function(){for(var t=0;t<this.animatorList.length;t++){var e=this.animatorList[t];e&&e.isRunning&&e.update()}},Animator.prototype.getAction=function(t){return this.animatorMap[t]||this.animatorList[t]},Animator.prototype.play=function(t,e,i){t=t||0;var r=this.getAction(t);r&&(e=e||this.gameObject,i="boolean"!=typeof i||i,r.playAction(e,i))},Animator.prototype.stop=function(t){t=t||0;var e=this.getAction(t);e&&e.stop()},Animator.prototype.destroy=function(){this.animators=null,qc.Behaviour.prototype.destroy.call(this)};var AspectRatioFitter=defineBehaviour("qc.AspectRatioFitter",qc.Behaviour,function(){var t=this;t.mode=AspectRatioFitter.NONE,t.ratio=1,t.runInEditor=!0},{mode:qc.Serializer.NUMBER,ratio:qc.Serializer.NUMBER});AspectRatioFitter.__menu="UI/AspectRatioFitter",Object.defineProperties(AspectRatioFitter.prototype,{mode:{get:function(){return this._mode||AspectRatioFitter.NONE},set:function(t){this.mode!==t&&(this._mode=t,this._reset())}},ratio:{get:function(){return this._ratio||1},set:function(t){t<=0&&(t=.001),this.ratio!==t&&(this._ratio=t,this._reset())}}}),AspectRatioFitter.NONE=0,AspectRatioFitter.WIDTH_CONTROLS_HEIGHT=1,AspectRatioFitter.HEIGHT_CONTROLS_WIDTH=2,AspectRatioFitter.FIT_IN_PARENT=3,AspectRatioFitter.ENVELOPE_PARENT=4,AspectRatioFitter.prototype.awake=function(){var t=this;t._reset();var e=t.gameObject;t.addListener(e.onRelayout,function(){t._reset()})},AspectRatioFitter.prototype._reset=function(){var t=this;if(t.mode!==AspectRatioFitter.NONE){var e=t.gameObject
;if(t.mode!==AspectRatioFitter.WIDTH_CONTROLS_HEIGHT)if(t.mode!==AspectRatioFitter.HEIGHT_CONTROLS_WIDTH){var i=e.parent.rect;if(e.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),t.mode===AspectRatioFitter.FIT_IN_PARENT){var r=i.width,n=r/t.ratio;return n>i.height&&(n=i.height,r=n*t.ratio),void e.setStretch((i.width-r)/2,(i.width-r)/2,(i.height-n)/2,(i.height-n)/2)}if(t.mode===AspectRatioFitter.ENVELOPE_PARENT){r=i.width,n=r/t.ratio;return n<i.height&&(n=i.height,r=n*t.ratio),void e.setStretch((i.width-r)/2,(i.width-r)/2,(i.height-n)/2,(i.height-n)/2)}}else e.width=e.height*t.ratio;else e.height=e.width/t.ratio}};var CacheAsBitmap=defineBehaviour("qc.CacheAsBitmap",qc.Behaviour,function(){this._boundsType=CacheAsBitmap.BOUNDS_SELF,this._cacheType=CacheAsBitmap.CACHE_FOR_SCREEN,this._dirty=!0,this.boundsInScreen=!1,this.runInEditor=!0,this.offX=0,this.offY=0},{boundsType:qc.Serializer.NUMBER,cacheType:qc.Serializer.NUMBER,boundsInScreen:qc.Serializer.BOOLEAN});CacheAsBitmap.__menu="UI/CacheAsBitmap",Object.defineProperties(CacheAsBitmap.prototype,{boundsType:{get:function(){return this._boundsType},set:function(t){this._boundsType!==t&&(this._boundsType=t,this.dirty=!0)}},cacheType:{get:function(){return this._cacheType},set:function(t){this._cacheType!==t&&(this._cacheType=t,this.dirty=!0)}},dirty:{get:function(){return this._dirty},set:function(t){this._dirty!==t&&(this._dirty=t)}}}),CacheAsBitmap.prototype.awake=function(){var t=this,e=t.gameObject;t.addListener(t.game.assets.webFontLoaded,t._setDirty,t),e.onRelayout.add(t._setDirty,t)},CacheAsBitmap.prototype._setDirty=function(){this.dirty=!0},CacheAsBitmap.prototype.onEnable=function(){var t=this,e=t.gameObject;e._destroy||(t._cache||(t._cache=new qc.RenderTexture(100,100,this.game.phaser.render,null,this.game.resolution),t._cacheSprite=new PIXI.Sprite(t._cache)),t.dirty=!0,t.gameObject.phaser.setDisplayProxy(t._cacheSprite,!0),t._nodeRenderCanvas||(t._nodeRenderCanvas=t.gameObject.phaser._renderCanvas,t.gameObject.phaser._renderCanvas=t.renderCanvas.bind(t)),t._nodeRenderWebGL||(t._nodeRenderWebGL=t.gameObject.phaser._renderWebGL,t.gameObject.phaser._renderWebGL=t.renderWebGL.bind(t)))},CacheAsBitmap.prototype.onDisable=function(){var t=this;t.gameObject.phaser.setDisplayProxy(null,!1),t.gameObject._notifyCacheChanged(!1),t._nodeRenderCanvas&&(t.gameObject.phaser._renderCanvas=t._nodeRenderCanvas,t._nodeRenderCanvas=null),t._nodeRenderWebGL&&(t.gameObject.phaser._renderWebGL=t._nodeRenderWebGL,t._nodeRenderWebGL=null)},CacheAsBitmap.prototype.onDestroy=function(){var t=this;t.gameObject._notifyCacheChanged(!1),t._nodeRenderCanvas&&(t.gameObject.phaser._renderCanvas=t._nodeRenderCanvas,t._nodeRenderCanvas=null),t._nodeRenderWebGL&&(t.gameObject.phaser._renderWebGL=t._nodeRenderWebGL,t._nodeRenderWebGL=null),t._cache&&(t._cache.destroy(!0),t._cache=null),t._cacheSprite&&(t._cacheSprite=null),t.gameObject.onRelayout.remove(t._setDirty,t)},CacheAsBitmap.prototype._updateCache=function(){var t=this,e=t._cache,i=t._cacheSprite;t._updatingCache=!0;var r=null;r=this._cacheType!==CacheAsBitmap.CACHE_FOR_SCREEN?t._cacheBounds=t.getLocalBounds():t._cacheBounds=t.getBounds(),t.boundsInScreen?(r.x<0&&(r.width+=r.x,r.x=0),r.y<0&&(r.height+=r.y,r.y=0),r.width=Math.round(Math.max(1,Math.min(t.game.width*t.game.resolution-r.x,r.width))),r.height=Math.round(Math.max(1,Math.min(t.game.height*t.game.resolution-r.y,r.height)))):(r.width=Math.round(r.width),r.height=Math.round(r.height)),e.resize(r.width+(1&r.width),r.height+(1&r.height),!0);var n=t.gameObject.worldTransform;if(this._cacheType!==CacheAsBitmap.CACHE_FOR_SCREEN){var o=i.worldTransform;o.a=n.a,o.b=n.b,o.c=n.c,o.d=n.d,o.tx=n.tx,o.ty=n.ty,PIXI.DisplayObject._tempMatrix.tx=-r.x,PIXI.DisplayObject._tempMatrix.ty=-r.y,e.render(t.gameObject.phaser,PIXI.DisplayObject._tempMatrix,!0),i.anchor.x=-r.x/r.width,i.anchor.y=-r.y/r.height}else t.offX=r.x-n.tx,t.offY=r.y-n.ty,i.anchor.x=0,i.anchor.y=0,CacheAsBitmap._tempMatrix.a=n.a,CacheAsBitmap._tempMatrix.b=n.b,CacheAsBitmap._tempMatrix.c=n.c,CacheAsBitmap._tempMatrix.d=n.d,CacheAsBitmap._tempMatrix.tx=Math.round(n.tx-r.x),CacheAsBitmap._tempMatrix.ty=Math.round(n.ty-r.y),e.render(t.gameObject.phaser,CacheAsBitmap._tempMatrix,!0),n=i.worldTransform,n.identity(),n.tx=r.x,n.ty=r.y;t._updatingCache=!1,t.dirty=!1,t.gameObject._isTransformDirty=!0,i.displayChanged(qc.DisplayChangeStatus.TEXTURE|qc.DisplayChangeStatus.SIZE),t.gameObject.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE|qc.DisplayChangeStatus.SIZE),e.baseTexture.scaleMode=PIXI.scaleModes.NEAREST},CacheAsBitmap.prototype.postUpdate=function(){var t=this,e=t._cacheSprite;if(t._updateCache(),t.dirty)t.game.log.trace("[CacheAsBitmap]Update Cache.");else if(t._cacheType!==CacheAsBitmap.CACHE_FOR_SCREEN){var i=e.worldTransform,r=t.gameObject.worldTransform;i.a=r.a,i.b=r.b,i.c=r.c,i.d=r.d,i.tx=r.tx,i.ty=r.ty}else{var n=t.gameObject.worldTransform;r=e.worldTransform;r.identity(),r.tx=n.tx+t.offX,r.ty=n.ty+t.offY}},CacheAsBitmap.prototype.getBounds=function(){var t=this;return t.boundsType===CacheAsBitmap.BOUNDS_SELF?qc.Bounds.getBox(t.gameObject,qc.Bounds.USE_BOUNDS,!0,0):t.boundsType===CacheAsBitmap.BOUNDS_ALL?qc.Bounds.getBox(t.gameObject,qc.Bounds.USE_BOUNDS,!0,-1):new qc.Rectangle(0,0,1,1)},CacheAsBitmap.prototype.getLocalBounds=function(){var t=this;return t.boundsType===CacheAsBitmap.BOUNDS_SELF?qc.Bounds.getBox(t.gameObject,qc.Bounds.USE_BOUNDS,!0,0,t.gameObject):t.boundsType===CacheAsBitmap.BOUNDS_ALL?qc.Bounds.getBox(t.gameObject,qc.Bounds.USE_BOUNDS,!0,-1,t.gameObject):new qc.Rectangle(0,0,1,1)},CacheAsBitmap.prototype.renderCanvas=function(t){var e=this,i=e.gameObject;if(!1!==i.phaser.visible&&!1!==i.renderable){if(e._updatingCache&&e._nodeRenderCanvas)return e.gameObject._notifyCacheChanged(!0),void e._nodeRenderCanvas.call(e.gameObject.phaser,t);e._cacheSprite.worldAlpha=e._cacheSprite.alpha=e.gameObject.phaser.worldAlpha,e._cacheSprite._renderCanvas(t)}},CacheAsBitmap.prototype.renderWebGL=function(t){var e=this,i=e.gameObject;if(!1!==i.phaser.visible&&!1!==i.renderable){if(e._updatingCache&&e._nodeRenderWebGL)return e.gameObject._notifyCacheChanged(!0),void e._nodeRenderWebGL.call(e.gameObject.phaser,t);e._cacheSprite.worldAlpha=e._cacheSprite.alpha=e.gameObject.phaser.worldAlpha,e._cacheSprite._renderWebGL(t)}},CacheAsBitmap._tempMatrix=new PIXI.Matrix,Object.defineProperties(qc.Node.prototype,{cacheAsBitmap:{get:function(){var t=this.getScript("qc.CacheAsBitmap");return t&&t.enable},set:function(t){var e=this.getScript("qc.CacheAsBitmap");(t||e)&&(e||(e=this.addScript("qc.CacheAsBitmap")),e.enable=t)}}}),CacheAsBitmap.BOUNDS_SELF=0,CacheAsBitmap.BOUNDS_ALL=1,CacheAsBitmap.CACHE_FOR_SCREEN=0,CacheAsBitmap.CACHE_FOR_SELF=1;var DebugViewer=defineBehaviour("qc.DebugViewer",qc.Behaviour,function(){var t=this;t.count=1,t.now=t.game.time.now,t.runInEditor=!0,t.duration=1,t.detail=!1},{debugOn:qc.Serializer.BOOLEAN,duration:qc.Serializer.NUMBER,detail:qc.Serializer.BOOLEAN});DebugViewer.__menu="Debug/DebugViewer",Object.defineProperties(DebugViewer.prototype,{debugOn:{get:function(){return this.game.debug.on},set:function(t){this.game.debug.on=t}}}),DebugViewer.prototype.postUpdate=function(){var t=this.game.debug,e=this.game.time.now;if(e-this.now>=1e3*this.duration){var i=1e3*this.count/(e-this.now),r=(t.preUpdate/this.count).toFixed(1),n=(t.update/this.count).toFixed(1),o=(t.postUpdate/this.count).toFixed(1),s=(t.logic/this.count).toFixed(1),a=(t.render/this.count).toFixed(1),h=(t.total/this.count).toFixed(1),l=this.game.phaser.renderer.renderSession.drawCount;null==l&&(l="(N/A)");var c=this.game.phaser._calcTransformCount,u="FPS: "+i.toFixed(1)+"\nDraw Calls: "+l+"\nTotal: "+h+" ms\nLogic: "+s+" ms\nRender: "+a+" ms\nPreUpdate: "+r+" ms\nUpdate: "+n+" ms\nPostUpdate: "+o+" ms\nTransformCalc: "+c;if(this.detail){var p="Canvas";this.game.phaser.renderType===Phaser.WEBGL?p="WebGL":this.game.phaser.renderType==Phaser.HEADLESS&&(p="Headless"),u+="\n------------\nresolution="+this.game.phaser.resolution+"\ndevicePixelRatio="+window.devicePixelRatio+"\nsize="+this.game.width+"*"+this.game.height+"\nrenderType="+p+"\nantialias="+this.game.antialias}this.gameObject instanceof qc.UIText?this.gameObject.text=u:this.gameObject instanceof qc.Dom&&(u=u.replace(/\n/g,"<br/>"),this.gameObject.innerHTML=u),this.count=1,this.now=e,t.total=0,t.logic=0,t.preUpdate=0,t.update=0,t.postUpdate=0,t.render=0}else this.count++};var DropdownItem=defineBehaviour("qc.DropdownItem",qc.Behaviour,function(){var t=this;t.dropdown=null},{checkBackground:qc.Serializer.NODE,checkMark:qc.Serializer.NODE,text:qc.Serializer.NODE,image:qc.Serializer.NODE});DropdownItem.__menu="UI/DropdownItem",Object.defineProperties(DropdownItem.prototype,{index:{get:function(){return this._index},set:function(t){this._index!==t&&(this._index=t,this.redraw())}}}),DropdownItem.prototype.onDown=function(){this.checkBackground&&(this.checkBackground.visible=!0)},DropdownItem.prototype.onUp=function(){this.checkBackground&&(this.checkBackground.visible=!1)},DropdownItem.prototype.onClick=function(){var t=this;t.index!==t.dropdown.value&&(t.dropdown.value=t.index,t.dropdown.hide())},DropdownItem.prototype.redraw=function(){var t=this,e=t.gameObject,i=t.dropdown.options[t.index];"string"==typeof i?(t.image&&(t.image.visible=!1),t.text.visible=!0,t.text.text=i):(t.text&&(t.text.visible=!1),t.image.visible=!0,t.image.texture=i),t.checkMark&&(t.checkMark.visible=t.index===t.dropdown.value),e.anchoredY=t.index*e.height,t.checkBackground&&(t.checkBackground.visible=!1)};var FilterGroup=defineBehaviour("qc.FilterGroup",qc.Behaviour,function(){this._filters=[]},{filters:Serializer.FILTERS,inherited:Serializer.BOOLEAN});FilterGroup.__menu="UI/FilterGroup",Object.defineProperties(FilterGroup.prototype,{filters:{get:function(){return this._filters},set:function(t){this._filters=t,this.refresh()}},inherited:{get:function(){return!(this.gameObject&&this.gameObject.filterSelf)},set:function(t){this.gameObject&&(this.gameObject.filterSelf=!t)}}}),FilterGroup.prototype.onDisable=function(){this.gameObject&&!this.gameObject._destroy&&this.refresh()},FilterGroup.prototype.onEnable=function(){this.gameObject&&!this.gameObject._destroy&&this.refresh()},FilterGroup.prototype.onDestroy=function(){this.gameObject&&!this.gameObject._destroy&&this.gameObject.phaser&&(this.gameObject.phaser.filters=null)},FilterGroup.prototype.refresh=function(){this.gameObject&&!this.gameObject._destroy&&(this.enable?this.enable&&(this.gameObject.phaser.filters=this.filters&&this.filters.length>0?this.filters:null):this.gameObject.phaser.filters=null)},FilterGroup.prototype.findFilter=function(t){"string"==typeof t&&(t=qc.Util.findClass(t));var e=[];for(var i in this.filters)this.filters[i]instanceof t&&e.push(this.filters[i]);return e},FilterGroup.prototype.removeFilterAt=function(t){if(!(t<0||t>=this.filters.length)){var e=this.filters.splice(t,1);return this.refresh(),e}},FilterGroup.prototype.removeFilter=function(t){"string"==typeof t&&(t=qc.Util.findClass(t));var e=[],i=this.filters.length;if("function"==typeof t)for(;i-- >0;)this.filters[i]instanceof t&&e.push(this.filters.splice(i,1));else for(;i-- >0;)this.filters[i]===t&&e.push(this.filters.splice(i,1));return this.refresh(),e},FilterGroup.prototype.addFilter=function(t,e){if("string"==typeof t&&(t=qc.Util.findClass(t),"function"!=typeof t))return null;if("function"==typeof t)t=new t(this.game);else for(e=this.filters.length;e-- >0;)if(this.filters[e]===t)return;return isNaN(e)||e<0||e>this.filters.length?this.filters.push(t):this.filters.splice(e,0,t),this.refresh(),t};var HorizontalLayout=defineBehaviour("qc.HorizontalLayout",qc.TableLayout,function(){this.style=qc.TableLayout.STYLE_RESIZE_ELEMENT,this.constraint=qc.TableLayout.CONSTRAINT_FIX_ROW_COUNT,this.contentSizeProvider=qc.TableLayout.USE_RECTTRANSFORM,this.stride=1,this.startCorner=qc.TableLayout.CORNER_TOP_LEFT,this.startAxis=qc.TableLayout.AXIS_HORIZONTAL},{childForceExpandWidth:qc.Serializer.NUMBER,childForceExpandHeight:qc.Serializer.NUMBER});HorizontalLayout.__menu="UI/Layout/HorizontalLayout",Object.defineProperties(HorizontalLayout.prototype,{spacing:{get:function(){return this.spacingX},set:function(t){this.spacingX=t}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(t){this._childForceExpandWidth!==t&&(this._childForceExpandWidth=t,this.rebuildTable())}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(t){this._childForceExpandHeight!==t&&(this._childForceExpandHeight=t,this.rebuildTable())}}}),HorizontalLayout.prototype._getDefaultLayout=function(t){return"x"===t?{min:0,preferred:0,flexible:this.childForceExpandWidth?1:0,extra:0}:{min:0,preferred:this.childForceExpandHeight?this.gameObject.rect.height:-1,flexible:1,extra:0}},HorizontalLayout.prototype.getCellLayout=function(t){var e=qc.LayoutElement.getLayoutElement(t);return this.childForceExpandWidth&&(e.flexibleWidth=1),this.childForceExpandHeight&&(e.flexibleHeight=1),e};var NodeMask=defineBehaviour("qc.NodeMask",qc.Behaviour,function(){this._mask=this.gameObject.game.phaser.add.graphics(0,0),this._mask.parent&&this._mask.parent.remove(this._mask),this.gameObject.onTextureChanged&&this.addListener(this.gameObject.onTextureChanged,this._doTextureChange,this),this.gameObject.onTransformChanged&&this.addListener(this.gameObject.onTransformChanged,this._doTransformChanged,this),this.onEnable(),this.runInEditor=!0},{checkInField:qc.Serializer.BOOLEAN,minAnchor:qc.Serializer.GEOM,maxAnchor:qc.Serializer.GEOM,minRotation:qc.Serializer.NUMBER,maxRotation:qc.Serializer.NUMBER,clipType:qc.Serializer.NUMBER,mode:qc.Serializer.NUMBER});NodeMask.__menu="UI/NodeMask",Object.defineProperties(NodeMask.prototype,{checkInField:{get:function(){return!!this._checkInField},set:function(t){this._checkInField!==t&&(this._checkInField=t,t||this._resetRenderAble(this.gameObject))}},minAnchor:{get:function(){return this._minAnchor||new qc.Point(0,0)},set:function(t){this.setMask(t)}},maxAnchor:{get:function(){return this._maxAnchor||new qc.Point(1,1)},set:function(t){this.setMask(null,t)}},minRotation:{get:function(){return void 0!==this._minRotation||null===this._minRotation?this._minRotation:0},set:function(t){this.setMask(null,null,t)}},maxRotation:{get:function(){return void 0!==this._maxRotation||null===this._maxRotation?this._maxRotation:2*Math.PI},set:function(t){this.setMask(null,null,null,t)}},clipType:{get:function(){return NodeMask.CLIP_STENCIL},set:function(t){}},mode:{get:function(){return this._mode||NodeMask.MODE_DEFAULT},set:function(t){this._mode!==t&&(this._mode=t,this._refresh())}},customGraphics:{get:function(){return this._customGraphics||(this._customGraphics=this.game.phaser.add.graphics(0,0),this._customGraphics.parent&&this._customGraphics.parent.remove(this._customGraphics)),this._customGraphics}},_maskFilter:{get:function(){return this.__maskFilter||(this.__maskFilter=new qc.Filter.AlphaMask(this.game),this.__maskFilter.otherTexture=new qc.Filter.FilterTexture(this.game),this.__maskFilter.otherTexture.texture=this.gameObject.texture,this.__maskFilter.otherTexture.frame=this.gameObject.frame),this.__maskFilter}},_graphicsFilter:{get:function(){return this.__graphicsFilter||(this.__graphicsFilter=new qc.Filter.AlphaMask(this.game),this.__graphicsFilter.otherTexture=new qc.Filter.GraphicsTexture(this.game)),this.__graphicsFilter}}}),NodeMask.prototype.onEnable=function(){this._refresh()},NodeMask.prototype.onDisable=function(){this._refresh()},NodeMask.prototype.onDestroy=function(){this.gameObject.phaser.mask=null,this.gameObject.phaser.softClip=null,this.gameObject.phaser.maskPixel=null,this.gameObject.phaser._graphicsFilter=null,this.gameObject._destroy||this._resetRenderAble(this.gameObject)},NodeMask.prototype._doTextureChange=function(){this.__maskFilter&&(this.__maskFilter.otherTexture.texture=this.gameObject.texture,this.__maskFilter.otherTexture.frame=this.gameObject.frame)},NodeMask.prototype._doTransformChanged=function(){this.postUpdate()},NodeMask.prototype._isNeedUseClipReplaceStencil=function(){return!this.game.device.phaser.supportStencil&&this.game.phaser.renderType===Phaser.WEBGL&&this.clipType===NodeMask.CLIP_STENCIL},NodeMask.prototype._refresh=function(){this._isNeedUseClipReplaceStencil()?(this.gameObject.phaser.softClip=null,this.gameObject.phaser.mask=null,this.gameObject.phaser.maskPixel=null,this._graphicsFilter.otherTexture.updateTexture(),this.gameObject.phaser._graphicsFilter=this.enable?{target:this.gameObject.phaser,filterPasses:this._graphicsFilter.passes}:null):this.game.phaser.renderType!==Phaser.WEBGL||this.clipType===NodeMask.CLIP_STENCIL?(this.gameObject.phaser.mask=this.enable&&this.mode!==NodeMask.MODE_PIXEL?this.mode===NodeMask.MODE_GRAPHICS?this.customGraphics:this._mask:null,this.gameObject.phaser.maskPixel=this.enable&&this.mode===NodeMask.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null,this.gameObject.phaser.softClip=null,this.gameObject._destroy||this._resetRenderAble(this.gameObject),this.gameObject.phaser._clipTexture=null,this.gameObject.phaser._graphicsFilter=null):(this.gameObject.phaser.softClip=this.enable&&this.mode!==NodeMask.MODE_PIXEL?this._softClip:null,this.gameObject.phaser.maskPixel=this.enable&&this.mode===NodeMask.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null,this.gameObject.phaser.mask=null,this.gameObject.phaser._clipTexture=null,this.gameObject.phaser._graphicsFilter=null)},NodeMask.prototype.postUpdate=function(){if(this.enable&&this.mode===NodeMask.MODE_DEFAULT&&(this._updateMask(),this._checkInField))for(var t=this.gameObject.children,e=this.gameObject.getWorldBox(),i=0;i<t.length;i++)this._checkRenderable(e,t[i])},NodeMask.prototype.setMask=function(t,e,i,r){var n=t||this.minAnchor,o=e||this.maxAnchor;if(i=null==i?this.minRotation:i,r=null==r?this.maxRotation:r,n.x<0&&(n.x=0),n.y<0&&(n.y=0),n.x>1&&(n.x=1),n.y>1&&(n.y=1),o.x<0&&(o.x=0),o.y<0&&(o.y=0),o.x>1&&(o.x=1),o.y>1&&(o.y=1),n.x>o.x||n.y>o.y)throw new Error("Expected:min < max");if(r<i)throw new Error("Expected:minRotation < maxRotation");n.x===this.minAnchor.x&&n.y===this.minAnchor.y&&o.x===this.maxAnchor.x&&o.y===this.maxAnchor.y&&i===this.minRotation&&r===this.maxRotation||(this._minAnchor=n,this._maxAnchor=o,this._minRotation=i,this._maxRotation=r,this._maskForceChange=!0,this.gameObject.phaser.displayChanged(qc.DisplayChangeStatus.SIZE))},NodeMask.prototype._updateMask=function(){var t=this._mask,e=this.gameObject.worldTransform,i=this.gameObject.rect,r=[i.x,i.y,i.width,i.height,e.a,e.b,e.c,e.d,e.tx,e.ty];if(this._maskForceChange||!this._lastMaskRect||this._lastMaskRect[0]!==r[0]||this._lastMaskRect[1]!==r[1]||this._lastMaskRect[2]!==r[2]||this._lastMaskRect[3]!==r[3]||this._lastMaskRect[4]!==r[4]||this._lastMaskRect[5]!==r[5]||this._lastMaskRect[6]!==r[6]||this._lastMaskRect[7]!==r[7]||this._lastMaskRect[8]!==r[8]||this._lastMaskRect[9]!==r[9]){this._maskForceChange=!1,this._lastMaskRect=r;var n=this.minAnchor,o=this.maxAnchor,s=this.minRotation,a=this.maxRotation,h=i.x+n.x*i.width,l=i.y+n.y*i.height,c=i.x+o.x*i.width,u=i.y+o.y*i.height,p=this.gameObject.getWorldScale(),d=p.x*p.y<0,f=(h+c)/2,g=(l+u)/2,y=null;if(a-s>=2*Math.PI)y=[new qc.Point(h,l),new qc.Point(c,l),new qc.Point(c,u),new qc.Point(h,u)];else{for(var m,_,v,x=2*Math.PI,T=Math.atan2(u-l,c-h);s<-T||s>x-T;){var S=s<0?x:-x;s+=S,a+=S}s>=-T&&s<T?(m=c,_=g+(c-f)*Math.tan(s),v=0):s<Math.PI-T?(_=u,m=f+(u-g)/Math.tan(s),v=1):s<Math.PI+T?(m=h,_=g+(f-h)*Math.tan(Math.PI-s),v=2):(_=l,m=f+(g-l)/Math.tan(x-s),v=3);for(var w,b,P=0;a>x-T;)a-=x,P+=4;a>=-T&&a<T?(w=c,b=g+(c-f)*Math.tan(a),P+=0):a<Math.PI-T?(b=u,w=f+(u-g)/Math.tan(a),P+=1):a<Math.PI+T?(w=h,b=g+(f-h)*Math.tan(Math.PI-a),P+=2):(b=l,w=f+(g-l)/Math.tan(x-a),P+=3);var A=[new qc.Point(c,u),new qc.Point(h,u),new qc.Point(h,l),new qc.Point(c,l)];for(y=[new qc.Point(f,g),new qc.Point(m,_)];v<P;)y.push(A[v%4]),v++;y.push(new qc.Point(w,b))}if(!this._isNeedUseClipReplaceStencil()){for(var C=0;C<y.length;C++)y[C]=e.apply(y[C]);d&&y.reverse()}if(this._softClip=y,this._isNeedUseClipReplaceStencil()){var E=this.gameObject.phaser.getBounds(),I=this._graphicsFilter.otherTexture;I.resize(E.width,E.height),I.offset.x=-E.x,I.offset.y=-E.y;var O=I.graphics;O.clear(),O.beginFill(16777215),O.drawPolygon(y),O.worldTransform=this.gameObject.worldTransform}else t.clear(),t.beginFill(16777215),t.drawPolygon(y);this._refresh()}},NodeMask.prototype._checkRenderable=function(t,e){var i=e.getWorldBox();qc.Rectangle.intersects(t,i)?e.renderable=!0:e.renderable=!1;for(var r=e.children,n=0;n<r.length;n++)this._checkRenderable(t,r[n])},NodeMask.prototype._resetRenderAble=function(t){if(t){t.renderable=!0;for(var e=t.children,i=0;i<e.length;i++)this._resetRenderAble(e[i])}},NodeMask.MODE_DEFAULT=0,NodeMask.MODE_PIXEL=1,NodeMask.MODE_GRAPHICS=2,NodeMask.CLIP_STENCIL=1;var NonexistScript=defineBehaviour("qc.NonexistScript",qc.Behaviour,function(){this.script="",this.data={}},{});NonexistScript.__hiddenInMenu=!0;var ScaleAdapter=defineBehaviour("qc.ScaleAdapter",qc.Behaviour,function(){var t=this;t.target=null,t.referenceResolution=new qc.Point(0,0),t.manualType=ScaleAdapter.NONE,t.gameObjectRecord=t.gameObject?[t.gameObject.scaleX,t.gameObject.scaleY,t.gameObject.width,t.gameObject.height]:[],t._fullTarget=!1,t.runInEditor=!0},{target:qc.Serializer.NODE,referenceResolution:qc.Serializer.GEOM,manualType:qc.Serializer.NUMBER,fullTarget:qc.Serializer.BOOLEAN,gameObjectRecord:qc.Serializer.NUMBERS});ScaleAdapter.__hiddenInMenu=!0,Object.defineProperties(ScaleAdapter.prototype,{fullTarget:{get:function(){return this._fullTarget},set:function(t){this._fullTarget!==t&&(this._fullTarget=t,!t&&this.gameObject&&(this.gameObject.width=this.gameObjectRecord[2],this.gameObject.height=this.gameObjectRecord[3]),this._forceUpdate=!0)}}}),ScaleAdapter.NONE=0,ScaleAdapter.MANUAL_HEIGHT=1,ScaleAdapter.MANUAL_WIDTH=2,ScaleAdapter.EXPAND=3,ScaleAdapter.SHRINK=4,ScaleAdapter.FILL=5,ScaleAdapter.prototype.awake=function(){if(this.game.fixedGameSize){var t=this.gameObject;t.width=this.game.world.width,t.height=this.game.world.height,t.scaleX=1,t.scaleY=1}},ScaleAdapter.prototype.onEnable=function(){var t=this,e=t.gameObject,i=t.gameObjectRecord;i[0]=e.scaleX,i[1]=e.scaleY,i[2]=e.width,i[3]=e.height},ScaleAdapter.prototype.onDisable=function(){var t=this,e=t.gameObject,i=t.gameObjectRecord;i.length<4||null===i[0]||isNaN(i[0])||(e.scaleX=i[0],e.scaleY=i[1],e.width=i[2],e.height=i[3])},ScaleAdapter.prototype.preUpdate=function(){var t=this;if(!t.game.fixedGameSize){var e=t.gameObject;if(e&&e.scaleX){var i=t.getTargetSize(),r=t.getReferenceResolution();if(0!==i.x&&0!==i.y&&0!==r.x&&0!==r.y){var n=1,o=1;switch(this.manualType){case qc.ScaleAdapter.MANUAL_HEIGHT:o=n=i.y/r.y;break;case qc.ScaleAdapter.MANUAL_WIDTH:o=n=i.x/r.x;break;case qc.ScaleAdapter.EXPAND:o=n=Math.min(i.x/r.x,i.y/r.y);break;case qc.ScaleAdapter.SHRINK:o=n=Math.max(i.x/r.x,i.y/r.y);break;case qc.ScaleAdapter.FILL:n=i.x/r.x,o=i.y/r.y}isNaN(n)||isNaN(o)||(this.fullTarget&&(this.gameObject.width=i.x/n,this.gameObject.height=i.y/o),(this._forceUpdate||this.gameObject.scaleX!==n||this.gameObject.scaleY!==o)&&(this._forceUpdate=!1,this.gameObject.scaleX=n,this.gameObject.scaleY=o))}}}},ScaleAdapter.prototype.onDestroy=function(){this.target=null},ScaleAdapter.prototype.getTargetSize=function(){var t=this.target||this.gameObject.game.world;return t&&t.width&&t.height?new qc.Point(t.width,t.height):new qc.Point(0,0)},ScaleAdapter.prototype.getReferenceResolution=function(){return this.referenceResolution};var ToggleGroup=qc.defineBehaviour("qc.ToggleGroup",qc.Behaviour,function(){this._toggles=[],this.runInEditor=!0,this.onValueChange=new qc.Signal},{toggles:qc.Serializer.NODES,allowSwitchOff:qc.Serializer.BOOLEAN});ToggleGroup.__menu="UI/ToggleGroup",Object.defineProperties(ToggleGroup.prototype,{toggle:{get:function(){for(var t=0;t<this._toggles.length;t++){var e=this._toggles[t];if(e&&e.on)return e}return null},set:function(t){var e=this._toggles.indexOf(t);if(-1!==e){for(var i=0;i<this._toggles.length;i++){var r=this._toggles[i];r&&(r.on=r===t)}this.onValueChange.dispatch(this,t,!0)}else this.game.log.error("target is not in this group")}},toggles:{get:function(){return this._toggles},set:function(t){var e=this;e._toggles.forEach(function(t){t&&(t.onValueChange.remove(e._onValueChange,e),t.canValueChange.remove(e._canValueChange,e))}),e._toggles=t||[],e._toggles.forEach(function(t){t&&(t.onValueChange.add(e._onValueChange,e),t.canValueChange.add(e._canValueChange,e))})}},allowSwitchOff:{get:function(){var t=this._allowSwitchOff;return t===undefined||t},set:function(t){t=!!t;var e=this.allowSwitchOff;e!==t&&(this._allowSwitchOff=t,t||this._assureSelection())}}}),ToggleGroup.prototype._assureSelection=function(){if(null==this.toggle){var t=this.toggles;if(t&&t.length){var e=t[0];e&&(e.on=!0)}}},ToggleGroup.prototype.add=function(t){-1===this._toggles.indexOf(t)&&(this._toggles.push(t),t.on=!1,t.onValueChange.add(this._onValueChange,this),t.canValueChange.add(this._canValueChange,this),this.allowSwitchOff||this._assureSelection())},ToggleGroup.prototype.remove=function(t){var e=this._toggles.indexOf(t);-1!==e&&(this._toggles.splice(e,1),t.onValueChange.remove(this._onValueChange,this),t.canValueChange.remove(this._canValueChange,this),this.allowSwitchOff||this._assureSelection())},ToggleGroup.prototype._canValueChange=function(t,e,i,r){if(!this.allowSwitchOff&&i&&!e){for(var n=!1,o=0,s=this.toggles.length;o<s;o++){var a=this.toggles[o];if(a!==t){if(a&&a.on)return}else n=!0}n&&(r.ignore=!0)}},ToggleGroup.prototype._onValueChange=function(t){t.on?this.toggle=t:this.toggle||this.onValueChange.dispatch(this,t,!1)};var TransitionBehaviour=qc.defineBehaviour("qc.TransitionBehaviour",qc.Behaviour,function(){if(this.gameObject.state===undefined)throw new Error("The target node does not have the interactive function, and can not be added to this component.");this.target=this.gameObject,this._transition=qc.Transition.TEXTURE_SWAP},{target:qc.Serializer.NODE,_transition:qc.Serializer.NUMBER,_normalTexture:{get:function(t,e){return this._saveTexture(t._normalTexture,e)},set:function(t,e){this._normalTexture=this._restoreTexture(e,t)}},_pressedTexture:{get:function(t,e){return this._saveTexture(t._pressedTexture,e)},set:function(t,e){this._pressedTexture=this._restoreTexture(e,t)}},_disabledTexture:{get:function(t,e){return this._saveTexture(t._disabledTexture,e)},set:function(t,e){this._disabledTexture=this._restoreTexture(e,t)}},_normalColor:qc.Serializer.COLOR,_pressedColor:qc.Serializer.COLOR,_disabledColor:qc.Serializer.COLOR});TransitionBehaviour.__menu="UI/TransitionBehaviour",Object.defineProperties(TransitionBehaviour.prototype,{target:{get:function(){return this._target},set:function(t){this._target=t,this._reset()}},transition:{get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition=t,this.target&&this._reset())}},normalTexture:{get:function(){return this._normalTexture},set:function(t){t!==this._normalTexture&&(this._normalTexture=t,this.target&&this.gameObject.state===qc.UIState.NORMAL&&this.transition===qc.Transition.TEXTURE_SWAP&&(this.target.texture=this.normalTexture))}},pressedTexture:{get:function(){return this._pressedTexture},set:function(t){t!==this._pressedTexture&&(this._pressedTexture=t,this.target&&this.gameObject.state===qc.UIState.PRESSED&&this.transition===qc.Transition.TEXTURE_SWAP&&(this.target.texture=this.pressedTexture))}},disabledTexture:{get:function(){return this._disabledTexture},set:function(t){t!==this._disabledTexture&&(this._disabledTexture=t,this.target&&this.gameObject.state===qc.UIState.DISABLED&&this.transition===qc.Transition.TEXTURE_SWAP&&(this.target.texture=this.disabledTexture))}},normalColor:{get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&this.target&&(t=t||Color.white,t instanceof Color?(this._normalColor=t,this.gameObject.state===qc.UIState.NORMAL&&this.transition===qc.Transition.COLOR_TINT&&(this.target.colorTint=this.normalColor)):this.game.log.error("Expected qc.Color, got:{0}",t))}},pressedColor:{get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this.target&&(t=t||Color.grey,t instanceof Color?(this._pressedColor=t,this.gameObject.state===qc.UIState.PRESSED&&this.transition===qc.Transition.COLOR_TINT&&(this.target.colorTint=this.pressedColor)):this.game.log.error("Expected qc.Color, got:{0}",t))}},disabledColor:{get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&this.target&&(t=t||Color.grey,t instanceof Color?(this._disabledColor=t,this.gameObject.state===qc.UIState.DISABLED&&this.transition===qc.Transition.COLOR_TINT&&(this.target.colorTint=this.disabledColor)):this.game.log.error("Expected:qc.Color, got:{0}",t))}},pressedAnimation:{get:function(){return this._pressedAnimation},set:function(t){this._pressedAnimation!==t&&(this._pressedAnimation=t)}}}),TransitionBehaviour.prototype._normalColor=Color.white,TransitionBehaviour.prototype._pressedColor=Color.grey,TransitionBehaviour.prototype._disabledColor=Color.grey,TransitionBehaviour.prototype.awake=function(){this.addListener(this.gameObject.onStateChange,this._reset,this),this._reset()},TransitionBehaviour.prototype._saveTexture=function(t,e){return this.gameObject.game.serializer._saveTextureItem(t,e)},TransitionBehaviour.prototype._restoreTexture=function(t,e){if(t&&t.length&&t[0]===qc.Serializer.STRING){var i=e.gameObject.texture;return i&&i.atlas.frameNames.indexOf(t[1])>=0?e.gameObject.texture.atlas.getTexture(t[1]):null}return this.gameObject.game.serializer._restoreTextureItem(t)},TransitionBehaviour.prototype._reset=function(){if(this.target&&this.enable)switch(this.transition){case qc.Transition.NONE:break;case qc.Transition.TEXTURE_SWAP:switch(this.gameObject.state){case qc.UIState.NORMAL:this.normalTexture&&(this.target.texture=this.normalTexture);break;case qc.UIState.PRESSED:this.pressedTexture&&(this.target.texture=this.pressedTexture);break;case qc.UIState.DISABLED:this.disabledTexture&&(this.target.texture=this.disabledTexture)}break;case qc.Transition.COLOR_TINT:switch(this.gameObject.state){case qc.UIState.NORMAL:this.target.colorTint=this.normalColor;break;case qc.UIState.PRESSED:this.target.colorTint=this.pressedColor;break;case qc.UIState.DISABLED:this.target.colorTint=this.disabledColor}break;case qc.Transition.ANIMATION:}};var Tween=defineBehaviour("qc.Tween",qc.Behaviour,function(){this._curve=new qc.BezierCurve(new qc.Keyframe(0,0,1,1),new qc.Keyframe(1,1,1,1)),this._started=!1,this._startTime=0,this._amountPerDelta=1e3,this._factor=0,this.duration=1,this.runInEditor=!0,this.flag="",this.playOnAwake=!1,this.canRunInEditor=!1},{_curve:qc.Serializer.GEOM,sampleMethod:qc.Serializer.NUMBER,style:qc.Serializer.NUMBER,delay:qc.Serializer.NUMBER,duration:qc.Serializer.NUMBER,tweenGroup:qc.Serializer.NUMBER,flag:qc.Serializer.STRING,playOnAwake:qc.Serializer.BOOLEAN});Tween.__hiddenInMenu=!0,Object.defineProperties(Tween.prototype,{curve:{get:function(){return this._curve}},sampleMethod:{get:function(){return this._sampleMethod||Tween.SAMPLE_LINEAR},set:function(t){this._sampleMethod!==t&&(this._sampleMethod=t)}},style:{get:function(){return this._style||0},set:function(t){this._style!==t&&(this._style=t)}},delay:{get:function(){return isNaN(this._delay)||this._delay<0?0:this._delay},set:function(t){this._delay!==t&&(this._delay=t)}},duration:{get:function(){return isNaN(this._duration)||this._duration<0?0:this._duration},set:function(t){this._duration!==t&&(this._duration=t,this._amountPerDelta=Math.abs(t>0?1/(1e3*t):1e3)*(this._amountPerDelta>=0?1:-1))}},tweenGroup:{get:function(){return this._tweenGroup||0},set:function(t){
this._tweenGroup!==t&&(this._tweenGroup=t)}},onStart:{get:function(){return this._onStart||(this._onStart=new Phaser.Signal),this._onStart}},onFinished:{get:function(){return this._onFinished||(this._onFinished=new Phaser.Signal),this._onFinished}},onLoopFinished:{get:function(){return this._onLoopFinished||(this._onLoopFinished=new Phaser.Signal),this._onLoopFinished}},amountPerDelta:{get:function(){return this._amountPerDelta}},tweenFactor:{get:function(){return this._factor},set:function(t){this._factor=Phaser.Math.clamp(t,0,1)}},direction:{get:function(){return this.amountPerDelta<0?Tween.DIR_REVERSE:Tween.DIR_FORWARD}}}),Tween.prototype.awake=function(){var t=this;t._started||(t.enable=!1,t.playOnAwake&&(t.resetToBeginning(),t.playForward()))},Tween.prototype._lineSample=function(t){return t},Tween.prototype.start=function(){this.update()},Tween.prototype.update=function(){if(this.enable&&(!this.gameObject||!this.game.device.editor||this.canRunInEditor)){var t=this.game.time.deltaTime,e=this.game.time.scaledTime;this._started||(this._started=!0,this._dispatchStart=!1,this._startTime=e+1e3*this.delay),e<this._startTime||(e===this._startTime?t=0:e-this._startTime<t&&(t=e-this._startTime),this._dispatchStart||(this._dispatchStart=!0,this._onStart&&this._onStart.dispatch(this)),this._factor+=this.amountPerDelta*t,this.style===Tween.STYLE_LOOP?this._factor>1&&(this._factor-=Math.floor(this._factor),this._onLoopFinished&&this._onLoopFinished.dispatch(this)):this.style===Tween.STYLE_PINGPONG&&(this._factor>1?(this._factor=1-(this._factor-Math.floor(this._factor)),this._amountPerDelta=-this._amountPerDelta,this._onLoopFinished&&this._onLoopFinished.dispatch(this)):this._factor<0&&(this._factor=-this._factor,this._factor-=Math.floor(this._factor),this._amountPerDelta=-this._amountPerDelta,this._onLoopFinished&&this._onLoopFinished.dispatch(this))),this.style===Tween.STYLE_ONCE&&(0===this.duration||this._factor>1||this._factor<0)?(this._factor=Phaser.Math.clamp(this._factor,0,1),this.sample(this._factor,!0),this._onFinished&&this._onFinished.dispatch(this),(0===this.duration||1===this._factor&&this._amountPerDelta>0||0===this._factor&&this._amountPerDelta<0)&&(this.enable=!1)):this.sample(this._factor,!1))}},Tween.prototype.onDisable=function(){this._started=!1,this.canRunInEditor=!1},Tween.prototype.sample=function(t,e){var i=Phaser.Math.clamp(t,0,1);switch(this.sampleMethod){case Tween.SAMPLE_LINEAR:i=this._lineSample(i)}this.onUpdate(this.curve.evaluate(i),e)},Tween.prototype._funcGroup=function(t){var e=this;0!==e.tweenGroup?Tween._funcGroup(e.gameObject,e.tweenGroup,t):t(e)},Tween.prototype.reset=function(t){this._started||(t?this.setEndToCurrValue():this.setStartToCurrValue())},Tween.prototype.resetGroup=function(t){var e=function(e){e.reset(t)};this._funcGroup(e)},Tween.prototype.playForward=function(t){t&&this.resetToBeginning(),this.play(!1)},Tween.prototype.playGroupForward=function(t){var e=function(e){e.playForward(t)};this._funcGroup(e)},Tween.prototype.playReverse=function(t){t&&this.resetToBeginning(!0),this.play(!0)},Tween.prototype.playGroupReverse=function(t){var e=function(e){e.playReverse(t)};this._funcGroup(e)},Tween.prototype.stop=function(){this.enable=!1,this.canRunInEditor=!1},Tween.prototype.stopGroup=function(){var t=function(t){t.stop()};this._funcGroup(t)},Tween.prototype.play=function(t){this._amountPerDelta=Math.abs(this.amountPerDelta)*(t?-1:1),this.enable=!0,this.canRunInEditor=!0,this.update()},Tween.prototype.playGroup=function(t){var e=function(e){e.play(t)};this._funcGroup(e)},Tween.prototype.resetToBeginning=function(t){this._started=!1,this._amountPerDelta=Math.abs(this.amountPerDelta)*(t?-1:1),this._factor=this.amountPerDelta<0?1:0,this.sample(this._factor,!1),t?this.setEndToCurrValue():this.setStartToCurrValue()},Tween.prototype.resetGroupToBeginning=function(t){var e=function(e){e.resetToBeginning(t)};this._funcGroup(e)},Tween.prototype.toggle=function(){this._factor>0?this._amountPerDelta=-this.amountPerDelta:this._amountPerDelta=Math.abs(this.amountPerDelta),this.enable=!0},Tween.prototype.onUpdate=function(t,e){},Tween.prototype.setStartToCurrValue=function(){},Tween.prototype.setEndToCurrValue=function(){},Tween.prototype.setCurrToStartValue=function(){},Tween.prototype.setCurrToEndValue=function(){},Tween.begin=function(t,e,i){var r=e.getScript(t,!1);if(r&&0!=r.tweenGroup){r=null;for(var n=e.getScripts(t,!1),o=0;o<n.length;++o)if(n[o]&&0===n[o].tweenGroup){r=n[o];break}}if((r||(r=e.addScript(t),r))&&r instanceof Tween)return r._started=!1,r.duration=i,r._factor=0,r._amountPerDelta=Math.abs(r.amountPerDelta),r.style=Tween.STYLE_ONCE,r._curve=new qc.BezierCurve(new qc.Keyframe(0,0,1,1),new qc.Keyframe(1,1,1,1)),r.enable=!0,r},Tween._funcGroup=function(t,e,i){for(var r=t.getScripts?t.getScripts("qc.Tween"):[],n=r.length;n-- >0;)r[n].tweenGroup===e&&i(r[n]);var o=t.children;if(o)for(var s=o.length;s-- >0;){var a=o[s];Tween._funcGroup(a,e,i)}},Tween.resetGroup=function(t,e,i){var r=function(t){t.reset(i)};Tween._funcGroup(t,e,r)},Tween.playGroupForward=function(t,e){var i=function(t){t.playForward()};Tween._funcGroup(t,e,i)},Tween.playGroupReverse=function(t,e){var i=function(t){t.playReverse()};Tween._funcGroup(t,e,i)},Tween.stopGroup=function(t,e){var i=function(t){t.stop()};Tween._funcGroup(t,e,i)},Tween.playGroup=function(t,e,i){var r=function(t){t.play(i)};Tween._funcGroup(t,e,r)},Tween.resetGroupToBeginning=function(t,e,i){var r=function(t){t.resetToBeginning(i)};Tween._funcGroup(t,e,r)},Tween.STYLE_ONCE=0,Tween.STYLE_LOOP=1,Tween.STYLE_PINGPONG=2,Tween.DIR_FORWARD=0,Tween.DIR_REVERSE=1,Tween.SAMPLE_LINEAR=0;var TweenAlpha=defineBehaviour("qc.TweenAlpha",qc.Tween,function(){var t=this;t.from=0,t.to=1,t.enable=!1},{from:qc.Serializer.NUMBER,to:qc.Serializer.NUMBER});TweenAlpha.__menu="Tween/TweenAlpha",TweenAlpha.prototype.onUpdate=function(t,e){var i=this,r=i.from,n=i.to;i.gameObject.alpha=Phaser.Math.clamp(r+t*(n-r),0,1)},TweenAlpha.prototype.setStartToCurrValue=function(){this.gameObject.alpha=this.from},TweenAlpha.prototype.setEndToCurrValue=function(){this.gameObject.alpha=this.to},TweenAlpha.prototype.setCurrToStartValue=function(){this.from=this.gameObject.alpha},TweenAlpha.prototype.setCurrToEndValue=function(){this.to=this.gameObject.alpha},TweenAlpha.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenAlpha",t,e);return r.from=t.alpha,r.to=i,e<=0&&(r.sample(1,!0),r.enable=!1),r};var TweenColor=defineBehaviour("qc.TweenColor",qc.Tween,function(){var t=this;t.from=Color.black,t.to=Color.white,t.enable=!1},{from:qc.Serializer.COLOR,to:qc.Serializer.COLOR});TweenColor.__menu="Tween/TweenColor",TweenColor.prototype.onUpdate=function(t,e){var i=this,r=i.from.rgb,n=i.to.rgb,o=[Phaser.Math.clamp(Math.round(r[0]+t*(n[0]-r[0])),0,255),Phaser.Math.clamp(Math.round(r[1]+t*(n[1]-r[1])),0,255),Phaser.Math.clamp(Math.round(r[2]+t*(n[2]-r[2])),0,255),Phaser.Math.clamp(i.from.alpha+t*(i.to.alpha-i.from.alpha),0,1)],s=new Color(o);i.gameObject.colorTint=s},TweenColor.prototype.setStartToCurrValue=function(){this.gameObject.colorTint=new Color(this.from.toString())},TweenColor.prototype.setEndToCurrValue=function(){this.gameObject.colorTint=new Color(this.to.toString())},TweenColor.prototype.setCurrToStartValue=function(){this.from=new Color(this.gameObject.colorTint.toString())},TweenColor.prototype.setCurrToEndValue=function(){this.to=new Color(this.gameObject.colorTint.toString())},TweenColor.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenColor",t,e);return r.from=new Color(t.colorTint.toString()),r.to=i,e<=0&&(r.sample(1,!0),r.enable=!1),r};var TweenPosition=defineBehaviour("qc.TweenPosition",qc.Tween,function(){var t=this;t.from=new qc.Point(0,0),t.to=new qc.Point(0,0),t.moveAxis=TweenPosition.BOTH,t.enable=!1},{from:qc.Serializer.POINT,to:qc.Serializer.POINT,moveAxis:qc.Serializer.NUMBER});TweenPosition.__menu="Tween/TweenPosition",TweenPosition.prototype.onUpdate=function(t,e){var i=this,r=i.from,n=i.to;0!=(i.moveAxis&TweenPosition.ONLY_X)&&(i.gameObject.x=r.x+t*(n.x-r.x)),0!=(i.moveAxis&TweenPosition.ONLY_Y)&&(i.gameObject.y=r.y+t*(n.y-r.y))},TweenPosition.prototype.setStartToCurrValue=function(){0!=(this.moveAxis&TweenPosition.ONLY_X)&&(this.gameObject.x=this.from.x),0!=(this.moveAxis&TweenPosition.ONLY_Y)&&(this.gameObject.y=this.from.y)},TweenPosition.prototype.setEndToCurrValue=function(){0!=(this.moveAxis&TweenPosition.ONLY_X)&&(this.gameObject.x=this.to.x),0!=(this.moveAxis&TweenPosition.ONLY_Y)&&(this.gameObject.y=this.to.y)},TweenPosition.prototype.setCurrToStartValue=function(){this.from=new qc.Point(this.gameObject.x,this.gameObject.y)},TweenPosition.prototype.setCurrToEndValue=function(){this.to=new qc.Point(this.gameObject.x,this.gameObject.y)},TweenPosition.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenPosition",t,e);return r.from=new qc.Point(t.x,t.y),r.to=i.clone(),e<=0&&(r.sample(1,!0),r.enable=!1),r},TweenPosition.BOTH=255,TweenPosition.ONLY_X=1,TweenPosition.ONLY_Y=2;var TweenProperty=defineBehaviour("qc.TweenProperty",qc.Tween,function(){var t=this;t.from=0,t.to=1,t.property="",t.enable=!1},{from:qc.Serializer.NUMBER,to:qc.Serializer.NUMBER,property:qc.Serializer.STRING});TweenProperty.__menu="Tween/TweenProperty",Object.defineProperties(TweenProperty.prototype,{property:{get:function(){return this._property},set:function(t){if(t!==this._property){for(var e=t.split("."),i=this.gameObject,r=0;r<e.length-1;r++)if(i=i[e[r]],!i)return void this.game.log.important("The property({0}) non-exist.",t);this._ob=i,this._attrib=e[e.length-1],this._property=t}}}}),TweenProperty.prototype.onUpdate=function(t,e){var i=this,r=i.from,n=i.to;i._ob[i._attrib]=r+t*(n-r)},TweenProperty.prototype.setStartToCurrValue=function(){this._ob[this._attrib]=this.from},TweenProperty.prototype.setEndToCurrValue=function(){this._ob[this._attrib]=this.to},TweenProperty.prototype.setCurrToStartValue=function(){this.from=this._ob[this._attrib]},TweenProperty.prototype.setCurrToEndValue=function(){this.to=this._ob[this._attrib]},TweenProperty.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenProperty",t,e);return r.from=this._ob[this._attrib],r.to=i,e<=0&&(r.sample(1,!0),r.enable=!1),r};var TweenRotation=defineBehaviour("qc.TweenRotation",qc.Tween,function(){var t=this;t.from=0,t.to=1,t.enable=!1},{from:qc.Serializer.NUMBER,to:qc.Serializer.NUMBER});TweenRotation.__menu="Tween/TweenRotation",TweenRotation.prototype.onUpdate=function(t,e){var i=this,r=i.from,n=i.to;i.gameObject.rotation=r+t*(n-r)},TweenRotation.prototype.setStartToCurrValue=function(){this.gameObject.rotation=this.from},TweenRotation.prototype.setEndToCurrValue=function(){this.gameObject.rotation=this.to},TweenRotation.prototype.setCurrToStartValue=function(){this.from=this.gameObject.rotation},TweenRotation.prototype.setCurrToEndValue=function(){this.to=this.gameObject.rotation},TweenRotation.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenRotation",t,e);return r.from=t.rotation,r.to=i,e<=0&&(r.sample(1,!0),r.enable=!1),r};var TweenScale=defineBehaviour("qc.TweenScale",qc.Tween,function(){var t=this;t.from=new qc.Point(0,0),t.to=new qc.Point(1,1),t.enable=!1},{from:qc.Serializer.POINT,to:qc.Serializer.POINT});TweenScale.__menu="Tween/TweenScale",TweenScale.prototype.onUpdate=function(t,e){var i=this,r=i.from,n=i.to,o=new qc.Point(r.x+t*(n.x-r.x),r.y+t*(n.y-r.y));i.gameObject.scaleX=o.x,i.gameObject.scaleY=o.y},TweenScale.prototype.setStartToCurrValue=function(){this.gameObject.scaleX=this.from.x,this.gameObject.scaleY=this.from.y},TweenScale.prototype.setEndToCurrValue=function(){this.gameObject.scaleX=this.to.x,this.gameObject.scaleY=this.to.y},TweenScale.prototype.setCurrToStartValue=function(){this.from=new qc.Point(this.gameObject.scaleX,this.gameObject.scaleY)},TweenScale.prototype.setCurrToEndValue=function(){this.to=new qc.Point(this.gameObject.scaleX,this.gameObject.scaleY)},TweenScale.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenScale",t,e);return r.from=new qc.Point(t.scaleX,t.scaleY),r.to=i.clone(),e<=0&&(r.sample(1,!0),r.enable=!1),r};var TweenTransform=defineBehaviour("qc.TweenTransform",qc.Tween,function(){var t=this;t.enable=!1,t.localFrom=new qc.Point,t.localTo=new qc.Point},{from:qc.Serializer.NODE,to:qc.Serializer.NODE});TweenTransform.__menu="Tween/TweenTransform",Object.defineProperties(TweenTransform.prototype,{from:{get:function(){return this._from},set:function(t){if(this._from=t,t){var e=this._from.getWorldPosition();this.localFrom=this.gameObject.parent.toLocal(e)}}},to:{get:function(){return this._to},set:function(t){if(this._to=t,t){var e=this._to.getWorldPosition();this.localTo=this.gameObject.parent.toLocal(e)}}}}),TweenTransform.prototype.onUpdate=function(t,e){if(this._from&&this._to){var i=this;i.gameObject.x=i.localFrom.x+t*(i.localTo.x-i.localFrom.x),i.gameObject.y=i.localFrom.y+t*(i.localTo.y-i.localFrom.y)}};var VerticalLayout=defineBehaviour("qc.VerticalLayout",qc.TableLayout,function(){this.style=qc.TableLayout.STYLE_RESIZE_ELEMENT,this.constraint=qc.TableLayout.CONSTRAINT_FIX_COLUMN_COUNT,this.contentSizeProvider=qc.TableLayout.USE_RECTTRANSFORM,this.stride=1,this.startCorner=qc.TableLayout.CORNER_TOP_LEFT,this.startAxis=qc.TableLayout.AXIS_VERTICAL},{childForceExpandWidth:qc.Serializer.NUMBER,childForceExpandHeight:qc.Serializer.NUMBER});VerticalLayout.__menu="UI/Layout/VerticalLayout",Object.defineProperties(VerticalLayout.prototype,{spacing:{get:function(){return this.spacingY},set:function(t){this.spacingY=t}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(t){this._childForceExpandWidth!==t&&(this._childForceExpandWidth=t,this.rebuildTable())}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(t){this._childForceExpandHeight!==t&&(this._childForceExpandHeight=t,this.rebuildTable())}}}),VerticalLayout.prototype._getDefaultLayout=function(t){return"y"===t?{min:0,preferred:0,flexible:this.childForceExpandHeight?1:0,extra:0}:{min:0,preferred:this.childForceExpandWidth?this.gameObject.rect.width:-1,flexible:0,extra:0}},VerticalLayout.prototype.getCellLayout=function(t){var e=qc.LayoutElement.getLayoutElement(t);return this.childForceExpandWidth&&(e.flexibleWidth=1),this.childForceExpandHeight&&(e.flexibleHeight=1),e};var Prop=qc.Prop=function(t,e,i){var r=this;r.action=t,r.path=e,r.propertyId=i,r.propMap={},r.propDefaultValue={},r.keyIndexMap={}};Prop.prototype.constructor=Prop,Prop.prototype.destroy=function(){this.action=null,this.propMap={}},Prop.prototype.getPropMap=function(){return this.propMap},Prop.prototype.saveValue=function(t,e,i){var r;switch(t){case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:case Serializer.MAPPING:r=e;break;case Serializer.COLOR:r=e instanceof Color?e.toNumber(!0):null;break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:r=[e.class,e.toJson()];break;case Serializer.TEXTURE:if(e)if(e[0]instanceof qc.Atlas){var n=e[0],o=e[1];i.dependences.push({key:n.key,uuid:n.uuid}),r=[n.uuid,o]}else r=null;else r=null;break;case Serializer.AUDIO:e instanceof qc.SoundAsset?(i.dependences.push({key:e.key,uuid:e.uuid}),r=e.uuid):r=null;break;default:throw new Error("unsupported asset type:"+t)}return r},Prop.prototype.restoreValue=function(t,e){var i;switch(t){case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:case Serializer.MAPPING:i=e;break;case Serializer.COLOR:i=new Color(e);break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:if(e){var r=qc.Util.findClass(e[0]),n=new r;n.fromJson(e[1]),i=n}else i=null;break;case Serializer.TEXTURE:if(e){var o=e[0],s=e[1],a=this.action.game.assets.findByUUID(o);a?i=a instanceof qc.Atlas?[a,s]:[null,s]:(console.error("贴图资源尚未载入，无法反序列化。",e),i=[null,s])}else i=[];break;case Serializer.AUDIO:if(e){a=this.action.game.assets.findByUUID(e);a?i=a instanceof qc.SoundAsset?a:null:(console.error("音频资源尚未载入，无法反序列化。",e),i=null)}else i=null;break;default:throw new Error("unsupported asset type:"+t)}return i},Prop.prototype.setData=function(t,e){},Prop.prototype.fromJson=function(t,e){return 0},Prop.prototype.toJson=function(t){return[]},Prop.prototype.addKey=function(t,e,i){return 0},Prop.prototype.deleteKey=function(t,e){return 0},Prop.prototype.getDuration=function(){return{}},Prop.prototype.getValue=function(t,e){},Prop.prototype.getValueByIndex=function(t,e){},Prop.prototype.setValue=function(t,e,i){},Prop.prototype.isKey=function(t,e){return!1},Prop.prototype.update=function(t,e,i,r,n){},Prop.prototype.reset=function(){this.keyIndexMap={}};var KeyProp=qc.KeyProp=function(t,e,i){var r=this;qc.Prop.call(r,t,e,i)};KeyProp.prototype=Object.create(qc.Prop.prototype),KeyProp.prototype.constructor=KeyProp,KeyProp.prototype.fromJson=function(t,e){this.propertyInfo=t,this.forceUpdate=t.forceUpdate;for(var i=0,r=t.properties,n=0;n<r.length;n++){var o,s=r[n].attrib;if("string"==typeof s){var a=s.split(".");a.length>1&&(o=a)}if(this.propDefaultValue[s]=r[n].default,e){var h=e[n];if(h){for(var l=h[0],c=h[1],u=[],p=0;p<c.length;p++)u.push([c[p][0],this.restoreValue(l,c[p][1])]);if(this.propMap[s]=[l,u,o],u.length>0){var d=u[u.length-1][0];i<d&&(i=d)}}else this.propMap[s]||(this.propMap[s]=[r[n].type,[],o])}else this.propMap[s]=[r[n].type,[],o]}return i},KeyProp.prototype.toJson=function(t){for(var e=[],i=this.propertyInfo.properties,r=0;r<i.length;r++){var n=i[r].attrib,o=this.propMap[n],s=o[0],a=o[1];if(s&&a){for(var h=[],l=0;l<a.length;l++)h.push([a[l][0],this.saveValue(s,a[l][1],t)]);e.push([s,h])}}return e},KeyProp.prototype.addKey=function(t,e,i){var r=this.propMap[t];if(r){var n=function(t,e){return t[0]<e[0]};i!==undefined&&null!==i||this.propDefaultValue[t]==undefined||(i=this.propDefaultValue[t]);var o=qc.Util.insertSortedList(r[1],[e,i],n);return o}this.action.game.log.important("KeyProp not find attrib({0}) in addKey.",t)},KeyProp.prototype.deleteKey=function(t,e){var i=this.propMap[t];if(i)return i[1]?i[1].splice(e,1):null;this.action.game.log.important("KeyProp not find attrib({0}) in deleteKey.",t)},KeyProp.prototype.getKeyTimeList=function(t){var e=[],i=this.propMap[t];if(!i)return this.action.game.log.important("KeyProp not find attrib({0}) in getKeyTimeList.",t),[];for(var r=0;r<i[1].length;r++)e.push(i[1][r][0]);return e},KeyProp.prototype.getDuration=function(){var t=0;for(var e in this.propMap){var i=this.propMap[e];0!==i[1].length&&(i[1][i[1].length-1][0]>t&&(t=i[1][i[1].length-1][0]))}return t},KeyProp.prototype.isKey=function(t,e){var i=this.propMap[t];if(0===i[1].length)return!1;for(var r=0;r<i[1].length;r++)if(this.action.game.math.fuzzyEqual(i[1][r][0],e))return r},KeyProp.prototype.setValue=function(t,e,i){var r=this.isKey(t,e);if("number"!=typeof r)return this.addKey(t,e,i),e>this.action.duration&&(this.action.duration=e),!0;var n=this.propMap[t];n[1][r][1]=i},KeyProp.prototype.getValue=function(t,e){var i=this.propMap[t];if(0===i[1].length)return null;for(var r=0;r<i[1].length;r++)if(!(i[1][r][0]<=e))return r=r>0?r-1:0,i[1][r][1];return i[1][i[1].length-1][1]},KeyProp.prototype.getValueByIndex=function(t,e){var i=this.propMap[t];return 0===i[1].length?null:i[1][e]?i[1][e][1]:null},KeyProp.prototype.updateAttrib=function(t,e,i,r){if(r){var n=r.length;if(2===n&&t[r[0]])t[r[0]][r[1]]=i;else if(n>2){for(var o=t,s=0;s<n-1&&(o=o[r[s]],o);s++);o&&(o[r[n-1]]=i)}}else t[e]=i},KeyProp.prototype.update=function(t,e,i,r,n){for(var o in i&&(this.keyIndexMap={}),this.propMap){var s=this.keyIndexMap[o]||0,a=this.propMap[o];if(0!==a[1].length)if(s>a[1].length&&(this.keyIndexMap[o]=a[1].length,s=a[1].length),s<a[1].length&&a[1][s][0]<=e)for(var h=s;h<a[1].length&&a[1][h][0]<=e;h++)this.updateAttrib(t,o,a[1][h][1],a[2]),this.keyIndexMap[o]=h+1;else{var l=!1;for(h=s-1;h>=0;h--)if(a[1][h]){if(!(a[1][h][0]>e)){l=!0,(h!==s-1||r&&(n||this.forceUpdate))&&(this.updateAttrib(t,o,a[1][h][1],a[2]),this.keyIndexMap[o]=h+1);break}}else this.action.game.log.error("{0}:{1}~{2} update error: keyIndex({3}), propList({4})",this.path,this.propertyId,o,s,a[1]);l||(this.keyIndexMap[o]=0)}}};var LinearProp=qc.LinearProp=function(t,e,i){var r=this;qc.KeyProp.call(r,t,e,i)};LinearProp.prototype=Object.create(qc.KeyProp.prototype),LinearProp.prototype.constructor=LinearProp,LinearProp.prototype.calcValue=function(t,e,i){return t+i*(e-t)},LinearProp.prototype.getValue=function(t,e){var i=this.propMap[t];if(0===i[1].length)return null;if(e<=i[1][0][0])return i[1][0][1];for(var r=0;r<i[1].length;r++)if(!(i[1][r][0]<e)){r=r>0?r-1:0;var n=(e-i[1][r][0])/(i[1][r+1][0]-i[1][r][0]);return this.calcValue(i[1][r][1],i[1][r+1][1],n)}return i[1][i[1].length-1][1]},LinearProp.prototype.updateAttrib=function(t,e,i,r){if(r){var n=r.length;if(2===n&&t[r[0]])t[r[0]][r[1]]=i;else if(n>2){for(var o=t,s=0;s<n-1&&(o=o[r[s]],o);s++);o&&(o[r[n-1]]=i)}}else t[e]=i},LinearProp.prototype.update=function(t,e,i,r,n){for(var o in i&&(this.keyIndexMap={}),this.propMap){var s=this.keyIndexMap[o]||0,a=this.propMap[o];if(0!==a[1].length)if(s>=a[1].length&&(this.keyIndexMap[o]=a[1].length-1,s=a[1].length-1),a[1][s][0]<=e){for(var h=s;h<a[1].length;h++)if(h===a[1].length-1)h!==s&&(this.updateAttrib(t,o,a[1][h][1],a[2]),this.keyIndexMap[o]=h);else if(a[1][h][0]<=e&&a[1][h+1][0]>e){var l=(e-a[1][h][0])/(a[1][h+1][0]-a[1][h][0]);if(a[1][h][1]&&a[1][h+1][1]){var c=this.calcValue(a[1][h][1],a[1][h+1][1],l);this.updateAttrib(t,o,c,a[2])}this.keyIndexMap[o]=h;break}}else{if(a[1][0][0]>e){this.keyIndexMap[o]=0;continue}for(h=0;h<s;h++)if(a[1][h][0]<=e&&a[1][h+1][0]>e){l=(e-a[1][h][0])/(a[1][h+1][0]-a[1][h][0]);if(a[1][h][1]&&a[1][h+1][1]){c=this.calcValue(a[1][h][1],a[1][h+1][1],l);this.updateAttrib(t,o,c,a[2])}this.keyIndexMap[o]=h;break}}}};var CurveProp=qc.CurveProp=function(t,e,i){var r=this;qc.Prop.call(r,t,e,i)};CurveProp.prototype=Object.create(qc.Prop.prototype),CurveProp.prototype.constructor=CurveProp,CurveProp.prototype.fromJson=function(t,e){this.propertyInfo=t;for(var i=0,r=t.properties,n=0;n<r.length;n++){var o,s=r[n].attrib;if("string"==typeof s){var a=s.split(".");a.length>1&&(o=a)}if(this.propDefaultValue[s]=r[n].default,e){var h=e[n];if(h){var l=new qc.BezierCurve;if(this.propMap[s]={curveType:h[0],curve:l,to:0,attribArray:o},l.fromJson(h[1]),h[0]>=qc.CURVE_TYPE_TWEEN_RELATIVE&&(this.propMap[s].from=h[2][0],this.propMap[s].to=h[2][1]||0),l._keys.length>0){var c=l._keys[l._keys.length-1].time;i<c&&(i=c)}}}else this.propMap[s]={curveType:qc.CURVE_TYPE_ABSOLUTE,curve:new qc.BezierCurve,to:0,attribArray:o}}return i},CurveProp.prototype.toJson=function(t){for(var e=[],i=this.propertyInfo.properties,r=0;r<i.length;r++){var n=i[r].attrib,o=this.propMap[n],s=[o.curveType,o.curve.toJson()];o.curveType>=qc.CURVE_TYPE_TWEEN_RELATIVE&&s.push([o.from,o.to]),e.push(s)}return e},CurveProp.prototype.setData=function(t,e){var i=this.propMap[t];i?("number"==typeof e.curveType&&(i.curveType=e.curveType),"number"==typeof e.from&&(i.from=e.from),"number"==typeof e.to&&(i.to=e.to)):this.action.game.log.important("CurveProp not find attrib({0}) in setData.",t)},CurveProp.prototype.getMaxValue=function(t){var e=this.propMap[t];if(e){for(var i=!1,r=0;r<e.curve._keys.length;r++)!1===i?i=e.curve._keys[r].value:i<e.curve._keys[r].value&&(i=e.curve._keys[r].value);return e.curveType===qc.CURVE_TYPE_ABSOLUTE?i:e.curveType===qc.CURVE_TYPE_RELATIVE?e.from+i:e.curveType===qc.CURVE_TYPE_TWEEN_ABSOLUTE?e.from+i*(e.to-e.from):e.curveType===qc.CURVE_TYPE_TWEEN_RELATIVE?e.from+i*e.to:void 0}this.action.game.log.important("CurveProp not find attrib({0}) in getMaxValue.",t)},CurveProp.prototype.getFromValue=function(t,e,i){var r=this.propMap[e];if(r){if("number"==typeof r.from)return r.from;if(t){var n;if(r.attribArray){var o=r.attribArray.length;if(2===o)n=t[r.attribArray[0]]?t[r.attribArray[0]][r.attribArray[1]]:null;else if(o>2){for(var s=t,a=0;a<o-1&&(s=s[r.attribArray[a]],s);a++);s&&(n=s[r.attribArray[o-1]])}}else n=t[e];var h=this.getValue(e,i,!0)||0,l=r.to,c=h;return r.curveType===qc.CURVE_TYPE_RELATIVE?c=n-h:r.curveType===qc.CURVE_TYPE_TWEEN_RELATIVE&&(c=n-(l?l*h:0)),r.from=c,c}}else this.action.game.log.important("CurveProp not find attrib({0}) in getFromValue.",e)},CurveProp.prototype.addKey=function(t,e,i){var r=this.propMap[t];if(r){i!==undefined&&null!==i||this.propDefaultValue[t]==undefined||(i=this.propDefaultValue[t]),i=i||0;var n=r.curve.addKey(e,i);return r.curve.makeKeyframeLinear(n-1),r.curve.makeKeyframeLinear(n),r.curve.makeKeyframeLinear(n+1),n}this.action.game.log.important("CurveProp not find attrib({0}) in addKey.",t)},CurveProp.prototype.deleteKey=function(t,e){var i=this.propMap[t];i?i.curve.removeKey(e):this.action.game.log.important("CurveProp not find attrib({0}) in deleteKey.",t)},CurveProp.prototype.getKeyTimeList=function(t){var e=[],i=this.propMap[t];if(!i)return this.action.game.log.important("CurveProp not find attrib({0}) in getKeyTimeList.",t),[];for(var r=0;r<i.curve._keys.length;r++)e.push(i.curve._keys[r].time);return e},CurveProp.prototype.getDuration=function(){var t=0;for(var e in this.propMap){var i=this.propMap[e],r=i.curve;if(!(r._keys.length<1)){var n=r._keys[r._keys.length-1].time;t<n&&(t=n)}}return t},CurveProp.prototype.getValue=function(t,e,i){var r=this.propMap[t],n=r.from,o=r.to,s=r.curveType,a=r.curve,h=a.evaluate(e);return i?h:s===qc.CURVE_TYPE_ABSOLUTE?h:s===qc.CURVE_TYPE_RELATIVE?n+h:s===qc.CURVE_TYPE_TWEEN_ABSOLUTE?n+h*(o-n):n+h*o},CurveProp.prototype.getValueByIndex=function(t,e){var i=this.propMap[t],r=i.curve;return r._keys[e]?r._keys[e].value:null},CurveProp.prototype.setValue=function(t,e,i){var r=this.isKey(t,e);if("number"!=typeof r)return this.addKey(t,e,i),e>this.action.duration&&(this.action.duration=e),!0;var n=this.propMap[t],o=n.curve;o._keys[r].value=i,n.curve.makeKeyframeLinear(r-1),n.curve.makeKeyframeLinear(r),n.curve.makeKeyframeLinear(r+1)},CurveProp.prototype.isKey=function(t,e){var i=this.propMap[t],r=i.curve;if(0===r._keys.length)return!1;for(var n=0;n<r._keys.length;n++)if(this.action.game.math.fuzzyEqual(r._keys[n].time,e))return n},CurveProp.prototype.update=function(t,e,i,r,n){for(var o in i&&(this.keyIndexMap={}),this.propMap)if(r||!this.keyIndexMap[o]){var s,a=this.propMap[o],h=a.curve,l=a.curveType;if(i&&(l===qc.CURVE_TYPE_RELATIVE||l===qc.CURVE_TYPE_TWEEN_RELATIVE)){if(a.attribArray){var c=a.attribArray.length;if(2===c)s=t[a.attribArray[0]]?t[a.attribArray[0]][a.attribArray[1]]:null;else if(c>2){for(var u=t,p=0;p<c-1&&(u=u[a.attribArray[p]],u);p++);u&&(s=u[a.attribArray[c-1]])}}else s=t[o];a.from=s}if(!(h._keys.length<=0||h._keys[0].time>e)){var d=this.getFromValue(t,o,e),f=a.to,g=h.evaluate(e);if(!r&&h._keys[h._keys.length-1].time<=e&&(this.keyIndexMap[o]=1),s=l===qc.CURVE_TYPE_ABSOLUTE?g:l===qc.CURVE_TYPE_RELATIVE?d+g:l===qc.CURVE_TYPE_TWEEN_ABSOLUTE?d+g*(f-d):d+g*f,a.attribArray){c=a.attribArray.length;if(2===c&&t[a.attribArray[0]])t[a.attribArray[0]][a.attribArray[1]]=s;else if(c>2){for(u=t,p=0;p<c-1&&(u=u[a.attribArray[p]],u);p++);u&&(u[a.attribArray[c-1]]=s)}}else t[o]=s}}};var ActionState=qc.ActionState=function(t){var e=this;e.game=t,e.name="",e.targetObject=null,e.targetLocked=!1,e.eventList=[],e.samples=60,e.duration=0,e.speed=1,e.startTime=0,e.elapsedFrame=0,e.loop=!1,e.playEventInEditor=!0,e.isRunning=!1,e.onFinished=new qc.Signal,e.onLoopFinished=new qc.Signal,e.unpackDone=!1};ActionState.prototype.constructor=ActionState,ActionState.prototype.awake=function(){this.unpackDone=!0,"string"==typeof this.targetObject&&(this.targetObject=this.game.nodePool.find(this.targetObject))},ActionState.prototype.destroy=function(){var t=this;t.targetObject=null,t.isRunning=!1,t.eventList=[],t.onFinished.removeAll(),t.onLoopFinished.removeAll()},ActionState.prototype.getDuration=function(t){return this.duration},ActionState.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0},ActionState.prototype.playAction=function(t,e){return this.isRunning=!0,!this.targetLocked&&t&&(this.targetObject=t),e&&this.reset(),this.update(null,!0)},ActionState.prototype.stop=function(){this.isRunning=!1},ActionState.prototype.addEvent=function(t,e,i){var r=function(t,e){return t[0]<e[0]},n=qc.Util.insertSortedList(this.eventList,[t,e,i],r,!0);return n},ActionState.prototype.deleteEvent=function(t){return this.eventList?this.eventList.splice(t,1):null},ActionState.prototype.setEvent=function(t,e,i){var r=this.eventList[t];r&&(r[e]=i)},ActionState.prototype.getEventInfo=function(t){var e=this.eventList[t];if(e)return{func:e[1],para:e[2]}},ActionState.prototype.triggerEvent=function(t){var e=this.eventList[0][0],i=this.eventList[this.eventList.length-1][0];if(!(this.elapsedFrame<e||t>i))for(var r=0;r<this.eventList.length;r++)if(!(this.eventList[r][0]<=t)){if(!(this.eventList[r][0]<=this.elapsedFrame))break;if(this.eventList[r][1])for(var n=0;n<this.targetObject.scripts.length;n++){var o=this.targetObject.scripts[n];if(o[this.eventList[r][1]]){var s=this.eventList[r][2];Array.isArray(s)||(s="string"==typeof s?[s]:[]),o[this.eventList[r][1]].apply(o,s)}}}},ActionState.prototype.update=function(t,e,i,r){},ActionState.buildEmptyBundle=function(){return{}},ActionState.buildBundle=function(t){var e={dependences:[]};return t.targetObject&&(e.targetObject=t.targetObject.uuid),e.targetLocked=t.targetLocked,e.loop=t.loop,e.samples=t.samples,e.speed=t.speed,e.playEventInEditor=t.playEventInEditor,t.name&&(e.name=t.name),e.eventList=JSON.stringify(t.eventList),e},ActionState.restoreBundle=function(t,e,i){var r=e.json,n=t.game;if(t.uuid=e.uuid,t.key=e.key,r.name?t.name=r.name:t.name=e.key.match(/\/([^\/]+?).bin/)[1],r.__json&&(t.__json=r.__json),r.eventList)try{t.eventList=JSON.parse(r.eventList)}catch(t){n.log.error(t)}return t.targetLocked=r.targetLocked,t.loop=r.loop,t.samples=r.samples||60,t.speed=r.speed||1,t.playEventInEditor="boolean"!=typeof r.playEventInEditor||r.playEventInEditor,t.targetObject=i?n.nodePool.find(r.targetObject):n.nodePool.find(r.targetObject)||r.targetObject,i&&t.awake(),t};var Action=qc.Action=function(t){var e=this;e.propertyList={},e.actionList=[],qc.ActionState.call(e,t),e.class="qc.Action"};Action.prototype=Object.create(qc.ActionState.prototype),Action.prototype.constructor=Action,Object.defineProperties(Action.prototype,{targetObject:{get:function(){return this._targetObject},set:function(t){this.unpackDone&&t===this._targetObject&&this._targetObject||(this._targetObject=t,this.unpackDone&&(this.actionList=[],t&&this.refreshActionList()))}}}),Action.prototype.awake=function(){this.unpackDone=!0,"string"==typeof this.targetObject?this.targetObject=this.game.nodePool.find(this.targetObject):"object"==typeof this.targetObject&&0===this.actionList.length&&this.refreshActionList(),this.targetObject||!this.targetLocked||this.game.log.trace("Action({0}) can not find targetObject.",this.name)},Action.prototype.destroy=function(){var t=this;for(var e in t.targetObject=null,t.isRunning=!1,t.propertyList)t.propertyList[e].destroy();t.propertyList={},t.actionList=[],t.eventList=[],t.onFinished.removeAll(),t.onLoopFinished.removeAll()},Action.prototype.refreshActionList=function(){if(this.targetObject)for(var t in this.actionList=[],this.propertyList){var e=t.match(/(.*):(.*)/),i=e[1],r=(e[2],this.targetObject.find(i));r?this.actionList.push({target:r,propOb:this.propertyList[t]}):this.game.log.error("In action({0}), target({1}) not find child({2})",this.key,this.targetObject?this.targetObject.name:null,i)}else this.game.log.trace("Action({0}) can not find targetObject.",this.name)},Action.prototype.addProperty=function(t,e,i,r){var n=t+":"+e,o=this.propertyList[n];if(o)this.game.log.important("Action has duplicate key : {0} in addProperty",n);else{var s=qc.ActionProperties[e];if(s){var a=qc.Util.findClass(s.class);o=new a(this,t,e);var h=o.fromJson(s,i);this.duration<h&&(this.duration=h),
this.propertyList[n]=o,r&&this.refreshActionList()}else this.game.log.important("Can't find propertyId : {0} in addProperty",e)}},Action.prototype.removeProperty=function(t,e){var i=t+":"+e,r=this.propertyList[i];r?(r.destroy(),delete this.propertyList[i],this.refreshActionList(),this.duration=this.getDuration(!0,!0)):this.game.log.important("Action not find key : {0} in removeProperty",i)},Action.prototype.getPropertyInfo=function(t,e){var i=t+":"+e,r=this.propertyList[i];if(r)return r.getPropMap();this.game.log.important("Action not find key : {0} in getPropertyInfo",i)},Action.prototype.setData=function(t,e,i,r){var n=t+":"+e,o=this.propertyList[n];o?o.setData(i,r):this.game.log.important("Action has't property : {0} in setData",n)},Action.prototype.addKey=function(t,e,i,r,n){var o=t+":"+e,s=this.propertyList[o];if(s){s.addKey(i,r,n);r>this.duration&&(this.duration=r)}else this.game.log.important("Action has't property : {0} in addKey",o)},Action.prototype.deleteKey=function(t,e,i,r){var n=t+":"+e,o=this.propertyList[n];if(o){var s=o.getKeyTimeList(i),a=s[r];o.deleteKey(i,r),this.duration==a&&(this.duration=this.getDuration(!0,!0))}else this.game.log.important("Action has't property : {0} in deleteKey",n)},Action.prototype.getDuration=function(t,e){if(t){var i=0;for(var r in this.propertyList){var n=this.propertyList[r],o=n.getDuration();i<o&&(i=o)}this.duration=i}return this.loop&&!e?qc.MAX_DURATION:this.duration},Action.prototype.getValue=function(t,e,i,r,n){var o=t+":"+e,s=this.propertyList[o];if(s)return s.getValue(i,r,n);this.game.log.important("Action has't property : {0} in getValue",o)},Action.prototype.getValueByIndex=function(t,e,i,r){var n=t+":"+e,o=this.propertyList[n];if(o)return o.getValueByIndex(i,r);this.game.log.important("Action has't property : {0} in getValueByIndex",n)},Action.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0;for(var t=0;t<this.actionList.length;t++){var e=this.actionList[t];e.propOb.reset()}},Action.prototype.update=function(t,e,i,r){if((this.isRunning||i)&&this.targetObject){var n=this.game.time.scaledTime;if(this.elapsedFrame>=this.duration){if(!this.loop)return this.isRunning=!1,this.onFinished.dispatch(this),qc.FinishTrigger;this.onLoopFinished.dispatch(this),this.isRunning=!0;for(var o=this.elapsedFrame-this.duration;o>=this.duration;)o-=this.duration;t=o/(this.samples*this.speed)*1e3,this.reset(),this.startTime=n-t}t="number"==typeof t?t:this.game.time.deltaTime,this.startTime||(this.startTime=n),n===this.startTime&&(t=0);var s=e?-1:this.elapsedFrame;this.elapsedFrame+=t/1e3*this.samples*this.speed;for(var a=0;a<this.actionList.length;a++){var h=this.actionList[a];h.propOb.update(h.target,this.elapsedFrame,e,i,r)}i&&!this.playEventInEditor||this.eventList.length>0&&this.triggerEvent(s)}},Action.buildEmptyBundle=function(){return{propertyList:{}}},Action.buildBundle=function(t){var e=qc.ActionState.buildBundle(t),i={};for(var r in t.propertyList){var n=r.match(/(.*):(.*)/),o=n[1],s=n[2];i[o]=i[o]||{},i[o][s]=t.propertyList[r].toJson(e)}return e.propertyList=i,e},Action.restoreBundle=function(t,e,i){var r=t.json,n=new qc.Action(e);for(var o in r.propertyList)for(var s in r.propertyList[o])n.addProperty(o,s,r.propertyList[o][s]);return n=qc.ActionState.restoreBundle(n,t,i),n},qc.MAX_DURATION=4294967295,qc.CURVE_TYPE_RELATIVE=1,qc.CURVE_TYPE_ABSOLUTE=2,qc.CURVE_TYPE_TWEEN_RELATIVE=3,qc.CURVE_TYPE_TWEEN_ABSOLUTE=4,qc.PROP_POSITION=1,qc.PROP_ROTATION=2,qc.PROP_ALPHA=3,qc.PROP_SCALE=4,qc.PROP_COLOR_TINT=5,qc.PROP_VISIBLE=6,qc.PROP_SIZE=7,qc.PROP_SKEW=8,qc.PROP_TEXTURE=9,qc.PROP_ANIMATION=10,qc.PROP_COLOR=11,qc.PROP_TEXT=12,qc.PROP_PIVOT=13,qc.PROP_ANCHORED_POSITION=14,qc.PROP_TOGGLE_ON=15,qc.PROP_SCROLLBAR_VALUE=16,qc.PROP_SCROLLVIEW_POSITION=17,qc.PROP_PROGRESSBAR_VALUE=18,qc.PROP_SLIDER_VALUE=19,qc.PROP_SOUND=20,qc.PROP_DOM_INNERHTML=21,qc.PROP_TILEMAP_POSITION=22,qc.ActionProperties={},qc.ActionProperties[qc.PROP_POSITION]={name:"Position",class:"qc.CurveProp",curve:!0,properties:[{attrib:"x",type:Serializer.NUMBER},{attrib:"y",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_ANCHORED_POSITION]={name:"AnchoredPosition",class:"qc.CurveProp",curve:!0,properties:[{attrib:"anchoredX",type:Serializer.NUMBER},{attrib:"anchoredY",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_ROTATION]={name:"Rotation",class:"qc.CurveProp",curve:!0,properties:[{attrib:"rotation",type:"angle"}]},qc.ActionProperties[qc.PROP_ALPHA]={name:"Alpha",class:"qc.CurveProp",curve:!0,properties:[{attrib:"alpha",type:Serializer.NUMBER,min:0,max:1,precision:2}]},qc.ActionProperties[qc.PROP_SCALE]={name:"Scale",class:"qc.CurveProp",curve:!0,properties:[{attrib:"scaleX",type:Serializer.NUMBER},{attrib:"scaleY",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_COLOR_TINT]={name:"ColorTint",class:"qc.ColorLinearProp",properties:[{attrib:"colorTint",type:Serializer.COLOR,default:qc.Color.white}]},qc.ActionProperties[qc.PROP_VISIBLE]={name:"Visible",class:"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"visible",type:Serializer.BOOLEAN,default:!0}]},qc.ActionProperties[qc.PROP_SIZE]={name:"Size",class:"qc.CurveProp",curve:!0,properties:[{attrib:"width",type:Serializer.NUMBER},{attrib:"height",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_PIVOT]={name:"Pivot",class:"qc.CurveProp",curve:!0,properties:[{attrib:"pivotX",type:Serializer.NUMBER},{attrib:"pivotY",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SKEW]={name:"Skew",class:"qc.CurveProp",curve:!0,properties:[{attrib:"skewX",type:"angle"},{attrib:"skewY",type:"angle"}]},qc.ActionProperties[qc.PROP_TEXTURE]={name:"Texture",class:"qc.TextureKeyProp",forceUpdate:!0,properties:[{attrib:"texture",type:Serializer.TEXTURE}]},qc.ActionProperties[qc.PROP_ANIMATION]={name:"Animation",class:"qc.AnimationKeyProp",properties:[{attrib:"defaultAnimation",type:Serializer.STRING}]},qc.ActionProperties[qc.PROP_COLOR]={name:"Color",class:"qc.ColorLinearProp",properties:[{attrib:"color",type:Serializer.COLOR,default:qc.Color.white}]},qc.ActionProperties[qc.PROP_TEXT]={name:"Text",class:"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"text",type:Serializer.STRING,default:""}]},qc.ActionProperties[qc.PROP_TOGGLE_ON]={name:"ToggleOn",class:"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"on",type:Serializer.BOOLEAN,default:!0}]},qc.ActionProperties[qc.PROP_SCROLLBAR_VALUE]={name:"ScrollBarValue",class:"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SCROLLVIEW_POSITION]={name:"ScrollViewPosition",class:"qc.CurveProp",curve:!0,properties:[{attrib:"horizontalNormalizedPosition",type:Serializer.NUMBER},{attrib:"verticalNormalizedPosition",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_PROGRESSBAR_VALUE]={name:"ProgressBarValue",class:"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SLIDER_VALUE]={name:"SliderValue",class:"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SOUND]={name:"Sound",class:"qc.KeyProp",properties:[{attrib:"audio",type:Serializer.AUDIO},{attrib:"isPlaying",type:Serializer.BOOLEAN,default:!0}]},qc.ActionProperties[qc.PROP_DOM_INNERHTML]={name:"DomInnerHTML",class:"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"innerHTML",type:Serializer.STRING,default:""}]},qc.ActionProperties[qc.PROP_TILEMAP_POSITION]={name:"TilemapPosition",class:"qc.CurveProp",curve:!0,properties:[{attrib:"scrollX",type:Serializer.NUMBER},{attrib:"scrollY",type:Serializer.NUMBER}]},qc.FinishTrigger=1,qc.EventTrigger=2,qc.propertyList={"qc.Node":[qc.PROP_POSITION,qc.PROP_ANCHORED_POSITION,qc.PROP_ROTATION,qc.PROP_ALPHA,qc.PROP_SCALE,qc.PROP_COLOR_TINT,qc.PROP_VISIBLE,qc.PROP_SIZE,qc.PROP_PIVOT],"qc.UIImage":[qc.PROP_SKEW,qc.PROP_TEXTURE],"qc.Sprite":[qc.PROP_TEXTURE,qc.PROP_ANIMATION],"qc.UIText":[qc.PROP_COLOR,qc.PROP_TEXT],"qc.Button":[qc.PROP_TEXTURE],"qc.Toggle":[qc.PROP_TOGGLE_ON],"qc.ScrollBar":[qc.PROP_TEXTURE,qc.PROP_SCROLLBAR_VALUE],"qc.ScrollView":[qc.PROP_TEXTURE,qc.PROP_SCROLLVIEW_POSITION],"qc.ProgressBar":[qc.PROP_TEXTURE,qc.PROP_PROGRESSBAR_VALUE],"qc.Slider":[qc.PROP_TEXTURE,qc.PROP_SLIDER_VALUE],"qc.InputField":[qc.PROP_TEXTURE,qc.PROP_TEXT],"qc.Sound":[qc.PROP_SOUND],"qc.Dom":[qc.PROP_DOM_INNERHTML],"qc.Graphics":[],"qc.UIRoot":[],"qc.Tilemap":[qc.PROP_TILEMAP_POSITION]},qc.extend=qc.extend||{},qc.extend.addProperty=function(t,e,i){i===qc.Serializer.NUMBER?qc.ActionProperties[e]={name:e,class:"qc.CurveProp",curve:!0,isCustomProperty:!0,properties:[{attrib:e,type:qc.Serializer.NUMBER}]}:i===qc.Serializer.TEXTURE?qc.ActionProperties[e]={name:e,class:"qc.TextureKeyProp",forceUpdate:!0,isCustomProperty:!0,properties:[{attrib:e,type:qc.Serializer.TEXTURE}]}:i===qc.Serializer.COLOR?qc.ActionProperties[e]={name:e,class:"qc.ColorLinearProp",isCustomProperty:!0,properties:[{attrib:e,type:Serializer.COLOR,default:qc.Color.white}]}:qc.ActionProperties[e]={name:e,class:"qc.KeyProp",forceUpdate:!0,isCustomProperty:!0,properties:[{attrib:e,type:i}]},qc.propertyList[t]=qc.propertyList[t]||[],qc.propertyList[t].push(e)};var ActionManager=qc.ActionManager=function(t){var e=this;e.actionList=[],qc.ActionState.call(e,t),e.class="qc.ActionManager",e._endLinePos=-1,e.runningActions={}};ActionManager.prototype=Object.create(qc.ActionState.prototype),ActionManager.prototype.constructor=ActionManager,ActionManager.prototype.awake=function(){if(this.unpackDone=!0,"string"==typeof this.targetObject&&(this.targetObject=this.game.nodePool.find(this.targetObject)),this.targetObject||!this.targetLocked)for(var t=0;t<this.actionList.length;t++)this.actionList[t]&&this.actionList[t][1]&&this.actionList[t][1].awake();else this.game.log.trace("Action({0}) can not find targetObject.",this.name)},ActionManager.prototype.destroy=function(){var t=this;t.isRunning=!1,t._targetObject=null;for(var e=0;e<this.actionList.length;e++)this.actionList[e]&&this.actionList[e][1]&&this.actionList[e][1].destroy();t.actionList=[]},Object.defineProperties(ActionManager.prototype,{targetObject:{get:function(){return this._targetObject},set:function(t){if(!this.unpackDone||t!==this._targetObject||!this._targetObject){this._targetObject=t;for(var e=0;e<this.actionList.length;e++)if(this.actionList[e]){var i=this.actionList[e][1];i&&!i.targetLocked&&(i.targetObject=t)}}}},isRunning:{get:function(){return this._isRunning},set:function(t){this._isRunning=t;for(var e=0;e<this.actionList.length;e++)if(this.actionList[e]){var i=this.actionList[e][1];i&&(i.isRunning=t)}}},endLinePos:{get:function(){return this._endLinePos},set:function(t){this._endLinePos=t,t>-1?this.duration=t:this.getDuration(!0)}}}),ActionManager.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0,this.runningActions={};for(var t=0;t<this.actionList.length;t++)if(this.actionList[t]){var e=this.actionList[t][1];e&&e.reset()}},ActionManager.prototype.update=function(t,e,i,r){if((this.isRunning||i)&&this.targetObject){var n=this.game.time.scaledTime;if(this.elapsedFrame>=this.duration){if(!this.loop)return this.isRunning=!1,this.onFinished.dispatch(this),qc.FinishTrigger;this.onLoopFinished.dispatch(this),this.isRunning=!0;for(var o=this.elapsedFrame-this.duration;o>=this.duration;)o-=this.duration;t=o/(this.samples*this.speed)*1e3,this.reset();var s=function(t,e,i){t.startTime=e;var r=i*t.samples*t.speed/1e3;if(t.duration<r&&(t.elapsedFrame=r),t instanceof qc.ActionManager)for(var n=0;n<t.actionList.length;n++){var o=t.actionList[n];if(o){var a=o[1];s(a,e,i)}}};s(this,n-t,t)}t="number"==typeof t?t:this.game.time.deltaTime,this.startTime||(this.startTime=n),n===this.startTime&&(t=0);var a=e?-1:this.elapsedFrame;this.elapsedFrame+=t/1e3*this.samples*this.speed,this.eventList.length>0&&(!i||this.playEventInEditor)&&this.triggerEvent(a),t*=this.speed;for(var h=0;h<this.actionList.length;h++){var l=this.actionList[h];if(l){n=l[0];var c=l[1];if(!(this.elapsedFrame<n)){var u=!1;this.runningActions[h]||(u=!0),c.update(t,u,i,r),this.runningActions[h]=!0}}}}},ActionManager.prototype.addAction=function(t){var e=this,i=e.actionList.push(t),r=t[0],n=t[1];if(n.parent=e,e.endLinePos>-1)return i;var o=n.getDuration();if(o===qc.MAX_DURATION)e.duration=o;else{var s=e.samples,a=n.samples;o=o*s/a,e.duration<r+o&&(e.duration=r+o)}return i},ActionManager.prototype.deleteAction=function(t){var e=this;if(e.actionList[t]){var i=e.actionList[t][1],r=0;if(i){var n=i.getDuration();if(n===qc.MAX_DURATION)r=qc.MAX_DURATION;else{var o=e.samples,s=i.samples;n=n*o/s,r=e.actionList[t][0]+n}i.destroy(),i.parent=undefined}e.actionList.splice(t,1),this.duration===r&&this.getDuration(!0)}},ActionManager.prototype.updateActionTime=function(t,e){var i=this,r=i.actionList[t];r&&(r[0]=e,i.getDuration(!0))},ActionManager.prototype.getDuration=function(t,e){if(t&&this.endLinePos<=-1){for(var i=0,r=0;r<this.actionList.length;r++){var n=this.actionList[r];if(n){var o=n[1].getDuration(),s=n[0];if(o===qc.MAX_DURATION)i=qc.MAX_DURATION;else{var a=this.samples,h=n[1].samples;o=o*a/h/n[1].speed,i<s+o&&(i=s+o)}}}this.duration=i}return this.loop&&!e?qc.MAX_DURATION:this.endLinePos>-1?this.endLinePos:this.duration},ActionManager.buildEmptyBundle=function(){return{actionList:[]}},ActionManager.buildBundle=function(t){var e=qc.ActionState.buildBundle(t);e.endLinePos=t.endLinePos;for(var i=[],r=0;r<t.actionList.length;r++){var n=t.actionList[r];if(n){var o=n[1],s=n[0],a=o.uuid,h=o.loop,l=o.targetObject?o.targetObject.uuid:undefined;e.dependences.push({key:o.key,uuid:a}),i.push([s,a,h,l,o.targetLocked,o.speed])}}return e.actionList=i,e},ActionManager.restoreBundle=function(t,e,i,r){var n=t.json,o=new qc.ActionManager(e);if(r||(r={}),r[t.uuid])return e.log.error("Failed to add this action({0}) because of recursive reference.",t.key),!1;r[t.uuid]=!0,o.endLinePos=n.endLinePos?n.endLinePos:-1;for(var s=0;s<n.actionList.length;s++){var a=n.actionList[s]||[],h=a[0],l=a[1],c=a[2],u=a[3],p=a[4],d=a[5]||1,f=e.assets.findByUUID(l);if(f){var g;if(f instanceof qc.ActionAsset)g=qc.Action.restoreBundle(f,e,!e.serializer.isRestoring);else if(f instanceof qc.ActionManagerAsset&&(g=qc.ActionManager.restoreBundle(f,e,!e.serializer.isRestoring,r),!g))return delete r[t.uuid],!1;g.loop=c,g.speed=d,e.serializer.isRestoring?g.targetObject=e.nodePool.find(u)||u:g.targetObject=e.nodePool.find(u),g.targetLocked=p,o.addAction([h,g])}}return delete r[t.uuid],o=qc.ActionState.restoreBundle(o,t,i),o};var AnimationKeyProp=qc.AnimationKeyProp=function(t,e,i){var r=this;qc.KeyProp.call(r,t,e,i)};AnimationKeyProp.prototype=Object.create(qc.KeyProp.prototype),AnimationKeyProp.prototype.constructor=AnimationKeyProp,AnimationKeyProp.prototype.updateAttrib=function(t,e,i,r){for(var n=this.action,o=n.speed;n.parent;)o*=n.parent.speed,n=n.parent;t.playAnimation(i,o)};var ColorLinearProp=qc.ColorLinearProp=function(t,e,i){var r=this;qc.LinearProp.call(r,t,e,i)};ColorLinearProp.prototype=Object.create(qc.LinearProp.prototype),ColorLinearProp.prototype.constructor=ColorLinearProp,ColorLinearProp.prototype.calcValue=function(t,e,i){if(!t||!e)return qc.Color.white;var r=t.rgb,n=e.rgb,o=[Phaser.Math.clamp(Math.round(r[0]+i*(n[0]-r[0])),0,255),Phaser.Math.clamp(Math.round(r[1]+i*(n[1]-r[1])),0,255),Phaser.Math.clamp(Math.round(r[2]+i*(n[2]-r[2])),0,255),Phaser.Math.clamp(t.alpha+i*(e.alpha-t.alpha),0,1)],s=new Color(o);return s};var TextureKeyProp=qc.TextureKeyProp=function(t,e,i){var r=this;qc.KeyProp.call(r,t,e,i)};TextureKeyProp.prototype=Object.create(qc.KeyProp.prototype),TextureKeyProp.prototype.constructor=TextureKeyProp,TextureKeyProp.prototype.updateAttrib=function(t,e,i,r){if(!i){var n=this.action.game.assets.find("__builtin_resource__"),o=n?n.frameNames[0]:0;i=[n,o]}n=i[0],o=i[1];var s=n?new qc.Texture(n,o):null;if(r){var a=r.length;if(2===a&&t[r[0]])t[r[0]][r[1]]=s;else if(a>2){for(var h=t,l=0;l<a-1&&(h=h[r[l]],h);l++);h&&(h[r[a-1]]=s)}}else t[e]=s};var Time=qc.Time=function(t){this.phaser=t.phaser.time,this.phaser._qc=this,this.onFrameRateChanged=new qc.Signal};Time.prototype.constructor=Time,Object.defineProperties(Time.prototype,{game:{get:function(){return this.phaser.game._qc}},now:{get:function(){return Date.now()}},fixedTime:{get:function(){return 1e3*this.phaser.totalElapsedSeconds()}},scaledTime:{get:function(){return this.phaser._totalEscapeTime||0}},timeScale:{get:function(){return this.phaser.slowMotion},set:function(t){t<=0&&(t=1e-6),this.phaser.slowMotion=t}},frameRate:{get:function(){return this.phaser.desiredFps},set:function(t){this.phaser.desiredFps=t,this.onFrameRateChanged.dispatch(t)}},deltaTime:{get:function(){return this.phaser.frameDeltaTime}}}),Time.prototype.applyFrameRate=function(t){var e=this.game.device.desktop?t.desktop:t.mobile;this.frameRate=e};var LinkList=qc.LinkList=function(t){for(this.length=t,this.head=null,this.tail=null;t--;)this.push({})};LinkList.prototype={},LinkList.prototype.constructor=LinkList,LinkList.prototype.push=function(t){t.pre=null,t.next=null,this.head?(this.tail.next=t,t.pre=this.tail,this.tail=this.tail.next):(this.head=t,this.tail=this.head),this.length++},LinkList.prototype.insertBefore=function(t,e){if(t){var i=t.pre;t.pre=e,e.next=t,e.pre=i,i&&(i.next=e),e.pre||(this.head=e)}else this.push(e)},LinkList.prototype.remove=function(t){var e=t.pre,i=t.next;e&&(e.next=i),i&&(i.pre=e),t===this.head&&(this.head=i),t===this.tail&&(this.tail=e),t.pre=null,t.next=null,this.length--};var Timer=qc.Timer=function(t){var e=this;e.game=t,e.paused=!1,e.events=new qc.LinkList(0),e.loopEvents=new qc.LinkList(0),this._nextTimerBegin=0,this._nextLoopTimerBegin=0};Timer.prototype.constructor=Timer,Timer.prototype.create=function(t,e,i,r,n){t=Math.round(t);var o=new Phaser.TimerEvent(this,t,t,0,e,i,r,n);return this._pushEvent(e?this.loopEvents:this.events,o),o},Timer.prototype.add=function(t,e,i){t=t>0?t:1;return t+=this._nextTimerBegin,this.create(t,!1,e,i,Array.prototype.splice.call(arguments,3))},Timer.prototype.loop=function(t,e,i){t=t>0?t:1;return t+=this._nextLoopTimerBegin,this.create(t,!0,e,i,Array.prototype.splice.call(arguments,3))},Timer.prototype.remove=function(t){t.__delete=!0},Timer.prototype.update=function(t){if(!this.paused){this._now=this._now?this._now:t;var e=(t-this._now)/this.game.time.timeScale;this._now=t;for(var i=this.events.head,r=e,n=0;i&&(i.delta-=r,!(i.delta>0));){if(n++,n>2e3){console.log("timer loop forever!"),console.trace();break}this._nextTimerBegin=r=-i.delta,this.events.remove(i),i.__delete||i.callback.apply(i.callbackContext,i.args),i=this.events.head}this._nextTimerBegin=0;var o=[];for(i=this.loopEvents.head,r=e;i&&(i.delta-=r,!(i.delta>0));){if(this._nextLoopTimerBegin=r=-i.delta,this.loopEvents.remove(i),!i.__delete){o.push(i);try{i.callback.apply(i.callbackContext,i.args)}catch(t){throw t}}i=this.loopEvents.head}this._nextLoopTimerBegin=0;for(var s=0;s<o.length;s++)this._pushEvent(this.loopEvents,o[s])}},Timer.prototype._pushEvent=function(t,e){var i=t.head;if(!i)return e.delta=e.delay,void t.push(e);for(var r=e.delay;i;){if(!(r>=i.delta))return i.delta-=r,e.delta=r,t.insertBefore(i,e),e;r-=i.delta,i=i.next}return e.delta=r,t.push(e),e},qc.TimerEvent=Phaser.TimerEvent;var Filter=qc.Filter=function(t){Phaser.Filter.call(this,t),this._textureCount=1,this.extraAttribute=[],this.customInspectors={}};Filter.prototype=Object.create(Phaser.Filter.prototype),Filter.prototype.constructor=Filter,Object.defineProperties(Filter.prototype,{textureCount:{get:function(){return this._textureCount}}}),Filter.prototype.registerCustomInspector=function(t,e){this.customInspectors[t]=e},Filter.filters={},Filter.F1="1f",Filter.F1V="1fv",Filter.I1="1i",Filter.F2="2f",Filter.F2V="2fv",Filter.I2="2i",Filter.I2V="2iv",Filter.F3="3f",Filter.F3V="3fv",Filter.I3="3i",Filter.I3V="3iv",Filter.F4="4f",Filter.F4V="4fv",Filter.I4="4i",Filter.I4V="4iv",Filter.MAT2="mat2",Filter.MAT3="mat3",Filter.MAT4="mat4",Filter.SAMPLER2D="sampler2D",Filter.MAX_SAMPLE_COUNT=8,Filter.mixinUniform=function(t,e){if(e)for(var i in e){var r=e[i],n=r===Filter.SAMPLER2D;if(!(n&&t.textureCount>=Filter.MAX_SAMPLE_COUNT)){var o=function(){var e=i;return n?(t._textureCount++,function(){return t[e]&&t[e].filterTexture}):function(){return t[e]}};if(t.uniforms[i]=new UniformHelp(r,o()),n){var s="a"+i.substring(0,1).toUpperCase()+i.substring(1)+"Coord";t.extraAttribute.push({name:s,texture:i})}}}},Filter.uniformToJson=function(t,e,i){switch(t){case Filter.F1:case Filter.I1:case Filter.I2V:case Filter.F2V:case Filter.I3V:case Filter.F3V:case Filter.I4V:case Filter.F4V:case Filter.MAT2:case Filter.MAT3:case Filter.MAT4:return[t,e];case Filter.I2:case Filter.F2:return[t,[e.x,e.y]];case Filter.I3:case Filter.F3:return[t,[e.x,e.y,e.z]];case Filter.I4:case Filter.F4:return[t,[e.x,e.y,e.z,e.w]];case Filter.SAMPLER2D:if(!(e instanceof FilterTexture))return[t,[]];var r=e.texture;return r?(i.dependences.push({key:r.key,uuid:r.uuid}),[t,[r.key,r.url,r.uuid,e.frame]]):[t,[]]}return[t,[]]},Filter.uniformFromJson=function(t,e,i,r,n){if(n)switch(r){case Filter.F1:case Filter.I1:case Filter.I2V:case Filter.F2V:case Filter.I3V:case Filter.F3V:case Filter.I4V:case Filter.F4V:case Filter.MAT2:case Filter.MAT3:case Filter.MAT4:return void(e[i]=n);case Filter.I2:case Filter.F2:return void(e[i]?(e[i].x=n[0],e[i].y=n[1]):e[i]={x:n[0],y:n[1]});case Filter.I3:case Filter.F3:return void(e[i]?(e[i].x=n[0],e[i].y=n[1],e[i].z=n[2]):e[i]={x:n[0],y:n[1],z:n[2]});case Filter.I4:case Filter.F4:return void(e[i]?(e[i].x=n[0],e[i].y=n[1],e[i].z=n[2],e[i].w=n[3]):e[i]={x:n[0],y:n[1],z:n[2],w:n[3]});case Filter.SAMPLER2D:if(!n)return;var o=new FilterTexture(t);if(n.length>0){var s=t.assets.find(n[0],n[1]);if(s||(s=t.assets.findByUUID(n[2])),!s)return void t.log.error("Texture({0}) not loaded, deserialize fail.",n[1]);if(!(s instanceof qc.Atlas))return;o.texture=s,o.frame=n[3]}return void(e[i]=o)}},Serializer.prototype._saveFilter=function(t,e,i,r,n){n&&(e[r]=this._saveFilterItem(n,i))},Serializer.prototype._restoreFilter=function(t,e,i,r){t[i]=this._restoreFilterItem(r)},Serializer.prototype._saveFilterItem=function(t,e){var i=t.getExtraUniforms(),r={};for(var n in i){var o=i[n];r[n]=Filter.uniformToJson(o,t[n],e)}return[Serializer.FILTER,t.class,r]},Serializer.prototype._restoreFilterItem=function(t){var e=qc.Util.findClass(t[1]);if(e){var i=t[2],r=new e(this.game),n=r.getExtraUniforms();for(var o in n){var s=n[o];i[o]&&s===i[o][0]&&Filter.uniformFromJson(this.game,r,o,s,i[o][1])}return r}console.warn("着色器脚本：{0}未找到，无法反序列化。",t[1])};var defineFilter=qc.defineFilter=function(t,e,i,r){for(var n=t.split("."),o=window,s=0;s<n.length-1;s++)o[n[s]]||(o[n[s]]={}),o=o[n[s]];var a=n[n.length-1];return e=e||qc.Filter,"function"==typeof r&&(r=r.call(this)),r=r||{},o[a]=function(r){e.call(this,r),this.class=t,this.super=e.prototype;var n=this.getExtraUniforms();Filter.mixinUniform(this,n),"function"==typeof i&&i.call(this,r)},o[a].prototype=Object.create(e.prototype),o[a].prototype.constructor=o[a],o[a].prototype.getExtraUniforms=function(){var t=e.prototype.getExtraUniforms?e.prototype.getExtraUniforms.call(this):{};return mixin(t,r)},o[a].prototype.clazz=t,Filter.filters[t]=o[a],o[a]},FilterTexture=qc.Filter.FilterTexture=function(t){this._image=new qc.UIImage(t,null,!1),this._image.parent.removeChild(this._image)};FilterTexture.prototype={},FilterTexture.prototype.constructor=FilterTexture,Object.defineProperties(FilterTexture.prototype,{texture:{get:function(){return this._image.texture},set:function(t){this._image.texture=t}},frame:{get:function(){return this._image.frame},set:function(t){this._image.frame=t}},filterTexture:{get:function(){return this._image.phaser.texture}}});var UniformHelp=qc.Filter.UniformHelp=function(t,e){this._type=t,this._value=e,this._valueIsFunc="function"==typeof this._value};UniformHelp.prototype={},UniformHelp.prototype.constructor=UniformHelp,Object.defineProperties(UniformHelp.prototype,{type:{get:function(){return this._type}},value:{get:function(){return this._valueIsFunc?this._value():this._value}}});var BlendTexture=defineFilter("qc.Filter.AlphaMask",qc.Filter,function(t){this.otherTexture=null,this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = add.a * original;","}"]},{otherTexture:qc.Filter.SAMPLER2D}),BlendTexture=defineFilter("qc.Filter.BlendTexture",qc.Filter,function(t){this.mixing=.5,this.otherTexture=null,this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","uniform float mixing;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = mixing * add + (1.0 - mixing) * original;","}"]},{otherTexture:qc.Filter.SAMPLER2D,mixing:qc.Filter.F1}),BlurX=defineFilter("qc.Filter.BlurX",qc.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x - blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x + blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","gl_FragColor = sum;","}"],this.blur=1},{blur:qc.Filter.F1});Object.defineProperty(BlurX.prototype,"blur",{get:function(){return this._blur},set:function(t){this.dirty=!0,this._blur=t,this.padding=Math.max(0,t)}});var BlurY=defineFilter("qc.Filter.BlurY",qc.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur*pixelSize.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur*pixelSize.y)) * 0.05;","gl_FragColor = sum;","}"],this.blur=1},{blur:qc.Filter.F1});Object.defineProperty(BlurY.prototype,"blur",{get:function(){return this._blur},set:function(t){this.dirty=!0,this._blur=t,this.padding=Math.max(0,t)}});var Glow=defineFilter("qc.Filter.Glow",qc.Filter,function(t){this.distance=40,this.outerStrength=1.5,this.innerStrength=1,this.glowColor=[1,0,0],this.pixelWidth=1/t.phaser.renderer.width,this.pixelHeight=1/t.phaser.renderer.height,this._updateFragmentSrc(),this.registerCustomInspector("glowColor",qc.Color)},{distance:qc.Filter.F1,outerStrength:qc.Filter.F1,innerStrength:qc.Filter.F1,glowColor:qc.Filter.F3V});Object.defineProperty(Glow.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance=t,this._updateFragmentSrc(),this.shaders=[]}}),Glow.prototype._updateFragmentSrc=function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D texture;","uniform float distance;","uniform float outerStrength;","uniform float innerStrength;","uniform vec3 glowColor;","uniform float pixelWidth;","uniform float pixelHeight;","vec2 px = vec2("+this.pixelWidth+", "+this.pixelHeight+");","void main(void) {","    const float PI = 3.14159265358979323846264;","    vec4 ownColor = texture2D(texture, vTextureCoord);","    vec4 curColor;","    float totalAlpha = 0.;","    float maxTotalAlpha = 0.;","    float offset = 0.;","    for (float curDistance = 0.; curDistance <= "+this.distance.toFixed(7)+"; curDistance++) {","       offset = curDistance - distance / 2.;","       curColor = texture2D(texture, vec2(vTextureCoord.x + offset * px.x, vTextureCoord.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x, vTextureCoord.y + offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x + cos(PI * 0.25) * offset * px.x, vTextureCoord.y + sin(PI * 0.25) * offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x + cos(PI * 0.75) * offset * px.x, vTextureCoord.y + sin(PI * 0.75) * offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","    }","    maxTotalAlpha = max(maxTotalAlpha, 0.0001);","    ownColor.a = max(ownColor.a, 0.0001);","    ownColor.rgb = ownColor.rgb / ownColor.a;","    float outerGlowAlpha = (totalAlpha / maxTotalAlpha)  * outerStrength * (1. - ownColor.a);","    float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * innerStrength * ownColor.a;","    float resultAlpha = (ownColor.a + outerGlowAlpha);","    gl_FragColor = vec4(mix(mix(ownColor.rgb, glowColor, innerGlowAlpha / ownColor.a), glowColor.rgb, outerGlowAlpha / resultAlpha) * resultAlpha, resultAlpha);","}"]}
;var GraphicsTexture=qc.Filter.GraphicsTexture=function(t,e,i,r,n){var o=this;o.game=t,o._texture=new qc.RenderTexture(e||100,i||100,r||o.game.phaser.render,null,n||o.game.resolution),o.offset=new qc.Point(0,0),o._graphics=o.game.phaser.add.graphics(0,0),o._graphics.parent&&o._graphics.parent.remove(o._graphics)};GraphicsTexture.prototype={},GraphicsTexture.prototype.constructor=GraphicsTexture,Object.defineProperties(GraphicsTexture.prototype,{graphics:{get:function(){return this._graphics}},filterTexture:{get:function(){return this._texture}}}),GraphicsTexture.prototype.updateTexture=function(){var t=this,e=t._texture,i=t._graphics;i.dirty&&e.directRenderWebGL(i,t.offset,!0)},GraphicsTexture.prototype.resize=function(t,e){t=t<=1?1:t,e=e<=1?1:e,this._texture.resize(t,e,!0)};var Gray=defineFilter("qc.Filter.Gray",qc.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float gray = original.r * 0.3 + original.g * 0.59 + original.b * 0.11;","   gl_FragColor =  original;","   gl_FragColor.r = gray;","   gl_FragColor.g = gray;","   gl_FragColor.b = gray;","}"]},{}),Highlight=defineFilter("qc.Filter.Highlight",qc.Filter,function(t){this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float light;","uniform vec3 lightColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vLight = light * vec4(lightColor, 0.0);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   gl_FragColor = original + original.a * vLight;","}"],this.light=.5,this.lightColor=[1,1,1],this.registerCustomInspector("lightColor",qc.Color)},{light:qc.Filter.F1,lightColor:qc.Filter.F3V}),KeepSource=defineFilter("qc.Filter.KeepSource",qc.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec2 vMaskCoord;","varying vec4 vMaskLimit;","uniform sampler2D uSampler;","uniform sampler2D uSourceSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(uSourceSampler, vTextureCoord);","   gl_FragColor =  add.a * add + (1.0 - add.a) * original;","}"]},{})}}).call(this,this,Object),Phaser.Text=function(t,e,i,r,n){e=e||0,i=i||0,r=null==r?"":r.toString(),n=Phaser.Utils.extend({},n),this.type=Phaser.TEXT,this.realWidth=0,this.realHeight=0,this.physicsType=Phaser.SPRITE,this.padding=new Phaser.Point,this.textBounds=null,this.canvas=Phaser.Canvas.create(),this.context=this.canvas.getContext("2d"),this.colors=[],this.strokeColors=[],this.fontStyles=[],this.fontWeights=[],this.autoRound=!1,this.useAdvancedWrap=!1,this._res=1,this._text=r,this._fontComponents=null,this._lineSpacing=0,this._lineHeight=1,this._letterSpacing=0,this._enableUnderline=!1,this._underlineColor=[],this._underlineWidth=1,this._underlineSpacing=0,this._enableDeleteline=!1,this._deletelineColor=[],this._deletelineWidth=1,this._deletelineSpacing=0,this._gradientByLine=!0,this._charCount=0,this._width=0,this._height=0,this._canvasPadding={left:0,right:0,top:0,bottom:0},Phaser.Sprite.call(this,t,e,i,PIXI.Texture.fromCanvas(this.canvas)),this.setStyle(n),""!==r&&this.updateText()},Phaser.Text.prototype=Object.create(Phaser.Sprite.prototype),Phaser.Text.prototype.constructor=Phaser.Text,Phaser.Text.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},Phaser.Text.prototype.update=function(){},Phaser.Text.prototype.destroy=function(t){this.texture.destroy(!0),Phaser.Component.Destroy.prototype.destroy.call(this,t)},Phaser.Text.prototype.setShadow=function(t,e,i,r,n,o){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="rgba(0, 0, 0, 1)"),void 0===r&&(r=0),void 0===n&&(n=!0),void 0===o&&(o=!0),this.style.shadowOffsetX=t,this.style.shadowOffsetY=e,this.style.shadowColor=i,this.style.shadowBlur=r,this.style.shadowStroke=n,this.style.shadowFill=o,this.dirty=!0,this},Phaser.Text.prototype.setStyle=function(t,e){void 0===e&&(e=!1),t=t||{},t.font=t.font||"bold 20pt Arial",t.backgroundColor=t.backgroundColor||null,t.fill=t.fill||"black",t.align=t.align||"left",t.boundsAlignH=t.boundsAlignH||"left",t.boundsAlignV=t.boundsAlignV||"top",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.wordWrapHeight=t.wordWrapHeight||100,t.maxLines=t.maxLines||0,t.shadowOffsetX=t.shadowOffsetX||0,t.shadowOffsetY=t.shadowOffsetY||0,t.shadowColor=t.shadowColor||"rgba(0,0,0,0)",t.shadowBlur=t.shadowBlur||0,t.tabs=t.tabs||0,t.shadowFill=t.shadowFill||!0;var i=this.fontToComponents(t.font);return t.fontStyle&&(i.fontStyle=t.fontStyle),t.fontVariant&&(i.fontVariant=t.fontVariant),t.fontWeight&&(i.fontWeight=t.fontWeight),t.fontSize&&("number"==typeof t.fontSize&&(t.fontSize=t.fontSize+"px"),i.fontSize=t.fontSize),this._fontComponents=i,t.font=this.componentsToFont(this._fontComponents),this.style=t,this.dirty=!0,e&&this.updateText(),this},Phaser.Text.prototype.updatePaddingRect=function(){var t=0,e=0,i=0,r=0,n=0;if(this.enableUnderline&&(e=this.underlineSpacing+this.underlineWidth,i=this.underlineWidth/2,r=this.underlineWidth/2),this.style.strokeThickness&&(n=this.style.strokeThickness,i=Math.max(i,n/2),r=Math.max(r,n/2),t=Math.max(t,2*n),e=Math.max(e,2*n)),this.style.shadowFill){var o=this.style.shadowBlur+n,s=(this.style.shadowOffsetX,this.style.shadowOffsetY);"top"===this.boundsAlignV?t=Math.max(t,-s+o):"bottom"===this.boundsAlignV&&(e=Math.max(e,s+o))}if("italic"===this.fontStyle){var a=this.fontSize*Math.tan(.20943951);r+=a}this._canvasPadding.left=i,this._canvasPadding.right=r,this._canvasPadding.top=t,this._canvasPadding.bottom=e},Phaser.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var t,e=this.text;if(this.updatePaddingRect(),this.style.wordWrap)e=e.replace(/(?:\r\n|\r|\n)/g,"\n"),t=this.runWordWrap(e,this.wordWrapWidth);else{t=e.split(/(?:\r\n|\r|\n)/);for(var i=0;i<t.length-1;i++)t[i]+="\n"}var r=this.style.tabs,n=[],o=0,s=this.determineFontProperties(this.style.font),a=t.length;this.style.maxLines>0&&this.style.maxLines<t.length&&(a=this.style.maxLines),this._charCount=0;for(i=0;i<a;i++)lineWidth=this.measureLine(t[i],!0),n[i]=Math.ceil(lineWidth),o=Math.max(o,n[i],this.wordWrapWidth);this.canvas.width=o*this._res+this._canvasPadding.left+this._canvasPadding.right;var h=s.fontSize,l=h*a,c=this.lineSpacing;c<0&&Math.abs(c)>h&&(c=-h),0!==c&&(l+=c>0?c*t.length:c*(t.length-1));var u,p,d=Math.max(this.style.wordWrapHeight,l);this.canvas.height=d,this.realWidth=this.canvas.width,this.realHeight=this.canvas.height,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round",this._charCount=0;var f=h*(a-1),g=this._canvasPadding.top+s.ascent-s.descent;for("bottom"===this.style.boundsAlignV?g=this.canvas.height-f-this._canvasPadding.bottom:"middle"===this.style.boundsAlignV&&(g+=(this.canvas.height-f-this._canvasPadding.bottom-g)/2),i=0;i<a;i++)if(u=this._canvasPadding.left,p=g,p+=(h+c)*i,this.context.textAlign="left","right"===this.style.boundsAlignH?u+=o-n[i]:"center"===this.style.boundsAlignH&&(u+=(o-n[i])/2),this.autoRound&&(u=Math.round(u),p=Math.round(p)),this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0)this.updateLine(t[i],u,p);else{var y=["ar","my"],m=languagesMgr.getLang()?languagesMgr.getLang().toLocaleLowerCase():"";y.every(function(t){return m!==t})?this.updateLine(t[i],u,p):(this.style.stroke&&this.style.strokeThickness&&(0===r?this.context.strokeText(t[i],u,p):this.renderTabLine(t[i],u,p,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===r?this.context.fillText(t[i],u,p):this.renderTabLine(t[i],u,p,!0)))}this.updateTexture(),this.dirty=!1},Phaser.Text.prototype.renderTabLine=function(t,e,i,r){var n=t.split(/(?:\t)/),o=this.style.tabs,s=0;if(Array.isArray(o))for(var a=0,h=0;h<n.length;h++)h>0&&(a+=o[h-1]),s=e+a,r?this.context.fillText(n[h],s,i):this.context.strokeText(n[h],s,i);else for(h=0;h<n.length;h++){var l=Math.ceil(this.context.measureText(n[h]).width);s=this.game.math.snapToCeil(e,o),r?this.context.fillText(n[h],s,i):this.context.strokeText(n[h],s,i),e=s+l}},Phaser.Text.prototype.updateShadow=function(t){t?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)},Phaser.Text.prototype.measureLine=function(t,e){null==e&&(e=!1);var i=0,r=this.splitter||new GraphemeSplitter;this.splitter||(this.splitter=r);for(var n=r.splitGraphemes(t),o=0;o<n.length;o++){var s=n[o],a=this.context.measureText(s).width;e&&this.letterSpacing&&o!=t.length-1&&(a+=this.letterSpacing),i+=a,this._charCount++}return Math.ceil(i)},Phaser.Text.prototype.updateLine=function(t,e,i){var r=this.measureLine(t,!1),n=this.letterSpacing||0,o=this.splitter||new GraphemeSplitter;this.splitter||(this.splitter=o);var s=o.splitGraphemes(t);"justify"===this.boundsAlignH&&(n=(this.realWidth-r-this._canvasPadding.left-this._canvasPadding.right)/(s.length-1));var a=this.determineFontProperties(this.style.font),h=e,l=[],c=this;this.context.clearRect(e,i,this._width,this._height);for(var u=0;u<s.length;u++){var p=s[u];if(this.fontWeights.length>0||this.fontStyles.length>0){var d=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(d.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(d.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(d)}var f=this.context.measureText(p).width;if(this.context.save(),this.gradient&&this.gradientByLine){var g=this.context.createLinearGradient(e,i-a.fontSize,e,i);g.addColorStop(0,this.startColor),g.addColorStop(1,this.endColor)}this.style.fill&&(this.gradient&&this.gradientByLine?this.context.fillStyle=g:this.context.fillStyle=this.style.fill,this.updateShadow(this.style.shadowFill),this.context.fillText(p,e,i)),this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(!1),this.context.strokeText(p,e,i)),l.push([p,e,i]),l.forEach(function(t){c.gradient&&c.gradientByLine?c.context.fillStyle=g:c.context.fillStyle=c.style.fill,c.updateShadow(!1),c.context.fillText(t[0],t[1],t[2])}),u!==s.length-1&&(f+=n),e+=f,this._charCount++}if(this.enableUnderline){this.context.beginPath(),this.context.strokeStyle=this.underlineColor,this.context.lineWidth=this.underlineWidth,this.gradient&&(this.gradientByLine?this.context.strokeStyle=g:this.context.strokeStyle=this.fill);var y=this.underlineSpacing;y+=this.style.strokeThickness/2,this.context.moveTo(h,i+this.context.lineWidth/2+y),this.context.lineTo(e,i+this.context.lineWidth/2+y),this.updateShadow(this.style.shadowFill),this.context.stroke()}if(this.enableDeleteline){this.context.beginPath(),this.context.strokeStyle=this.deletelineColor,this.context.lineWidth=this.deletelineWidth,this.gradient&&(this.gradientByLine?this.context.strokeStyle=g:this.context.strokeStyle=this.fill);y=this.deletelineSpacing;this.context.moveTo(h,i-this.fontSize/3+y),this.context.lineTo(e,i-this.fontSize/3+y),this.updateShadow(this.style.shadowFill),this.context.stroke()}this.context.restore()},Phaser.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this},Phaser.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=!0,this},Phaser.Text.prototype.addColor=function(t,e){return this.colors[e]=t,this.dirty=!0,this},Phaser.Text.prototype.addStrokeColor=function(t,e){return this.strokeColors[e]=t,this.dirty=!0,this},Phaser.Text.prototype.addFontStyle=function(t,e){return this.fontStyles[e]=t,this.dirty=!0,this},Phaser.Text.prototype.addFontWeight=function(t,e){return this.fontWeights[e]=t,this.dirty=!0,this},Phaser.Text.prototype.precalculateWordWrap=function(t){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var e=this.runWordWrap(t);return e.split(/(?:\r\n|\r|\n)/)},Phaser.Text.prototype._getWorldWidth=function(t){if(t.length>0&&"\n"===t[t.length-1]){var e=t.substr(0,t.length-1);return this.context.measureText(e).width}return this.context.measureText(t).width},Phaser.Text.prototype._isLetter=function(t){return!(t<"a"||t>"z")||!(t<"A"||t>"Z")},Phaser.Text.prototype.runWordWrap=function(t,e){for(var i=e,r=[],n=0,o=!1,s=0;s<t.length;)if("\n"===t[s]){var a=t.substr(n,s-n+1);1===a.length&&r.length>0&&!o?r[r.length-1]+="\n":r.push(a),s++,n=s,o=!0}else{o=!1;for(var h=-1;s<t.length;){var l=t.charAt(s);if(!this._isLetter(l)){h>=0&&s--;break}-1===h&&(h=s),s++}s===t.length&&s--;var c=this._getWorldWidth(t.substr(n,s-n+1));if(c>i)if(h>=0&&h===n){a=t.substr(n,s-n+1);r.push(a),s++,n=s}else if(h>=0){var u=h-n;a=t.substr(n,u);r.push(a),s=n+u,n=s}else if(s-n==0){a=t.substr(n,s-n+1);r.push(a),s++,n=s}else{a=t.substr(n,s-n);r.push(a),n=s}else if(s++,s===t.length){a=t.substr(n,s-n+1);r.push(a)}}return r},Phaser.Text.prototype.advancedWordWrap=function(t){for(var e=this.context,i=this.style.wordWrapWidth,r="",n=t.replace(/ +/gi," ").split(/\r?\n/gi),o=n.length,s=0;s<o;s++){var a=n[s],h="";a=a.replace(/^ *|\s*$/gi,"");var l=e.measureText(a).width;if(l<i)r+=a+"\n";else{for(var c=i,u=a.split(" "),p=0;p<u.length;p++){var d=u[p],f=d+" ",g=e.measureText(f).width;if(g>c){if(0===p){for(var y=f;y.length&&(y=y.slice(0,-1),g=e.measureText(y).width,!(g<=c)););if(!y.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");var m=d.substr(y.length);u[p]=m,h+=y}var _=u[p].length?p:p+1,v=u.slice(_).join(" ").replace(/[ \n]*$/gi,"");n[s+1]=v+" "+(n[s+1]||""),o=n.length;break}h+=f,c-=g}r+=h.replace(/[ \n]*$/gi,"")+"\n"}}return r=r.replace(/[\s|\n]*$/gi,""),r},Phaser.Text.prototype.basicWordWrap=function(t){for(var e="",i=t.split("\n"),r=0;r<i.length;r++){for(var n=this.style.wordWrapWidth,o=i[r].split(" "),s=0;s<o.length;s++){var a=this.context.measureText(o[s]).width,h=a+this.context.measureText(" ").width;h>n?(s>0&&(e+="\n"),e+=o[s]+" ",n=this.style.wordWrapWidth-a):(n-=h,e+=o[s]+" ")}r<i.length-1&&(e+="\n")}return e},Phaser.Text.prototype.updateFont=function(t){var e=this.componentsToFont(t);this.style.font!==e&&(this.style.font=e,this.dirty=!0,this.parent&&this.updateTransform())},Phaser.Text.prototype.fontToComponents=function(t){var e=t.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(e){var i=e[5].trim();return/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(i)||/['",]/.exec(i)||(i="'"+i+"'"),{font:t,fontStyle:e[1]||"normal",fontVariant:e[2]||"normal",fontWeight:e[3]||"normal",fontSize:e[4]||"medium",fontFamily:i}}return console.warn("Phaser.Text - unparsable CSS font: "+t),{font:t}},Phaser.Text.prototype.componentsToFont=function(t){var e,i=[];return e=t.fontStyle,e&&"normal"!==e&&i.push(e),e=t.fontVariant,e&&"normal"!==e&&i.push(e),e=t.fontWeight,e&&"normal"!==e&&i.push(e),e=t.fontSize,e&&"medium"!==e&&i.push(e),e=t.fontFamily,e&&i.push(e),i.length||i.push(t.font),i.join(" ")},Phaser.Text.prototype.setText=function(t,e){return void 0===e&&(e=!1),this.text=t.toString()||"",e?this.updateText():this.dirty=!0,this},Phaser.Text.prototype.parseList=function(t){if(!Array.isArray(t))return this;for(var e="",i=0;i<t.length;i++)Array.isArray(t[i])?(e+=t[i].join("\t"),i<t.length-1&&(e+="\n")):(e+=t[i],i<t.length-1&&(e+="\t"));return this.text=e,this.dirty=!0,this},Phaser.Text.prototype.setTextBounds=function(t,e,i,r){return void 0===t?this.textBounds=null:(this.textBounds?this.textBounds.setTo(t,e,i,r):this.textBounds=new Phaser.Rectangle(t,e,i,r),this.style.wordWrapWidth>i&&(this.style.wordWrapWidth=i)),this.updateTexture(),this},Phaser.Text.prototype.updateTexture=function(){var t=this.texture.baseTexture,e=this.texture.crop,i=this.texture.frame,r=this.canvas.width,n=this.canvas.height;if(t.width=r,t.height=n,e.width=r,e.height=n,i.width=r,i.height=n,this.texture.width=r,this.texture.height=n,this._width=r,this._height=n,this.textBounds){var o=this.textBounds.x,s=this.textBounds.y;"right"===this.style.boundsAlignH?o+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(o+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?s+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(s+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=-o,this.pivot.y=-s}this.renderable=0!==r&&0!==n,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()},Phaser.Text.prototype._renderWebGL=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderWebGL.call(this,t)},Phaser.Text.prototype._renderCanvas=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderCanvas.call(this,t)},Phaser.Text.prototype.determineFontProperties=function(t){var e=Phaser.Text.fontPropertiesCache[t];if(!e){e={};var i=Phaser.Text.fontPropertiesCanvas,r=Phaser.Text.fontPropertiesContext;r.font=t;var n=Math.ceil(r.measureText("|MÉq").width),o=Math.ceil(r.measureText("|MÉq").width),s=2*o;if(o=1.4*o|0,i.width=n,i.height=s,r.fillStyle="#f00",r.fillRect(0,0,n,s),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|MÉq",0,o),!r.getImageData(0,0,n,s))return e.ascent=o,e.descent=o+6,e.fontSize=e.ascent+e.descent,Phaser.Text.fontPropertiesCache[t]=e,e;var a,h,l=r.getImageData(0,0,n,s).data,c=l.length,u=4*n,p=0,d=!1;for(a=0;a<o;a++){for(h=0;h<u;h+=4)if(255!==l[p+h]){d=!0;break}if(d)break;p+=u}for(e.ascent=o-a,p=c-u,d=!1,a=s;a>o;a--){for(h=0;h<u;h+=4)if(255!==l[p+h]){d=!0;break}if(d)break;p-=u}e.descent=a-o,e.descent+=6,e.fontSize=e.ascent+e.descent,Phaser.Text.fontPropertiesCache[t]=e}return e},Phaser.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,t)},Object.defineProperty(Phaser.Text.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(Phaser.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(t){t=t||"bold 20pt Arial",this._fontComponents=this.fontToComponents(t),this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(t){t=t||"Arial",t=t.trim(),/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)||/['",]/.exec(t)||(t="'"+t+"'"),this._fontComponents.fontFamily=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"fontSize",{get:function(){var t=this._fontComponents.fontSize;return t&&/(?:^0$|px$)/.exec(t)?parseInt(t,10):t},set:function(t){t=t||"0","number"==typeof t&&(t+="px"),this._fontComponents.fontSize=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontWeight=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontStyle=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontVariant=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){t!==this.style.fill&&(this.style.fill=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){t!==this.style.align&&(this.style.align=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"resolution",{get:function(){return this._res},set:function(t){t!==this._res&&(this._res=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(t){t!==this.style.tabs&&(this.style.tabs=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(t){t!==this.style.boundsAlignH&&(this.style.boundsAlignH=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(t){t!==this.style.boundsAlignV&&(this.style.boundsAlignV=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){t!==this.style.stroke&&(this.style.stroke=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){t!==this.style.strokeThickness&&(this.style.strokeThickness=Number(t),this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){t!==this.style.wordWrap&&(this.style.wordWrap=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){t!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"wordWrapHeight",{get:function(){return this.style.wordWrapHeight},set:function(t){t!==this.style.wordWrapHeight&&(this.style.wordWrapHeight=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing||0},set:function(t){if(t!==this._lineSpacing){this._lineSpacing=parseFloat(t);var e=this.determineFontProperties(this.style.font).fontSize;this._lineHeight=(this.lineSpacing+e)/e,this.dirty=!0,this.parent&&this.updateTransform()}}}),Object.defineProperty(Phaser.Text.prototype,"lineHeight",{get:function(){return null!=this._lineHeight?this._lineHeight:1},set:function(t){if(t!==this._lineHeight){this._lineHeight=t;var e=this.determineFontProperties(this.style.font).fontSize;this._lineSpacing=this.lineHeight*e-e,this.dirty=!0,this.parent&&this.updateTransform()}}}),Object.defineProperty(Phaser.Text.prototype,"letterSpacing",{get:function(){return this._letterSpacing||0},set:function(t){t!==this._letterSpacing&&(this._letterSpacing=t,this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(Phaser.Text.prototype,"enableUnderline",{get:function(){return this._enableUnderline||!1},set:function(t){t!==this._enableUnderline&&(this._enableUnderline=t,this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(Phaser.Text.prototype,"underlineColor",{get:function(){return this._underlineColor||qc.Color.black},set:function(t){t!==this._underlineColor&&(this._underlineColor=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"underlineWidth",{get:function(){return null!=this._underlineWidth?this._underlineWidth:1},set:function(t){t!==this._underlineWidth&&(this._underlineWidth=t,this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(Phaser.Text.prototype,"underlineSpacing",{get:function(){return this._underlineSpacing||0},set:function(t){t!==this._underlineSpacing&&(this._underlineSpacing=t,this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(Phaser.Text.prototype,"enableDeleteline",{get:function(){return this._enableDeleteline||!1},set:function(t){t!==this._enableDeleteline&&(this._enableDeleteline=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"deletelineColor",{get:function(){return this._deletelineColor||qc.Color.black},set:function(t){t!==this._deletelineColor&&(this._deletelineColor=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"deletelineWidth",{get:function(){return null!=this._deletelineWidth?this._deletelineWidth:1},set:function(t){t!==this._deletelineWidth&&(this._deletelineWidth=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"deletelineSpacing",{get:function(){return null!=this._deletelineSpacing?this._deletelineSpacing:10},set:function(t){t!==this._deletelineSpacing&&(this._deletelineSpacing=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"gradientByLine",{get:function(){return this._gradientByLine},set:function(t){t!==this._gradientByLine&&(this._gradientByLine=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){t!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){t!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){t!==this.style.shadowColor&&(this.style.shadowColor=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){t!==this.style.shadowBlur&&(this.style.shadowBlur=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(t){t!==this.style.shadowStroke&&(this.style.shadowStroke=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(t){t!==this.style.shadowFill&&(this.style.shadowFill=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(Phaser.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),Phaser.Text.fontPropertiesCache={},Phaser.Text.fontPropertiesCanvas=document.createElement("canvas"),Phaser.Text.fontPropertiesContext=Phaser.Text.fontPropertiesCanvas.getContext("2d"),"undefined"!=typeof module&&module.exports&&(module.exports=GraphemeSplitter);