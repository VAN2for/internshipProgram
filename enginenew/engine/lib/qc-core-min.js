(function(D,P,C){"use strict";if(D.qc&&D.qc.Node){return}var h=function(t){var r=[];var a=function(t,e){for(var i in t){if(t[i]==e)return true}return false};var n=function(t){if(typeof t!=="object"||t===null)return t;else if(a(r,t))return t;r.push(t);var e={};if(Array.isArray(t)){e=[]}for(var i in t){if(!t.hasOwnProperty(i))continue;e[i]=n(t[i])}return e};return n(t)};var l=function(t,e,i){for(var r in e){if(!i||t[r]===C){t[r]=e[r]}}return t};if(!D.qc){D.qc={}}var pt=D.qc,dt=D.Phaser,_t=D.PIXI;l(pt,{PHASER_VERSION:dt.VERSION,PUBLISH_VERSION:20220311,GAMES:dt.GAMES,AUTO:dt.AUTO,CANVAS:dt.CANVAS,WEBGL:dt.WEBGL,HEADLESS:dt.HEADLESS,NONE:dt.NONE,LEFT:dt.LEFT,RIGHT:dt.RIGHT,UP:dt.UP,DOWN:dt.DOWN,scaleModes:dt.scaleModes});this.qc=this.qc||{};var t=pt.Log=function(t){var e=this;e.game=t;e.enableTrace=false};t.prototype.trace=function(){if(!D["printingloading"])return;var t=pt.Util.formatString.apply(null,arguments);console.log(t)};t.prototype.important=function(){var t=pt.Util.formatString.apply(null,arguments);if(!D.__wx)console.log("%c"+t,"color:green");else console.log(t)};t.prototype.error=function(){var t=pt.Util.formatString.apply(null,arguments);if(!D.__wx)console.log("%c"+t,"color:red");else console.log(t);var e;for(var i=1;i<arguments.length;i++){if(arguments[i]&&arguments[i].stack){e=arguments[i].stack;console.error(e);break}}if(!e&&!D.__wx)console.trace()};t.prototype.remoteReply=function(){var t=pt.Util.formatString.apply(null,arguments);console.log("%c"+t,"color:green")};pt.Circle=dt.Circle;P.defineProperty(pt.Circle.prototype,"class",{get:function(){return"qc.Circle"}});pt.Circle.prototype.toJson=function(){return[this.x,this.y,this.diameter]};pt.Circle.prototype.fromJson=function(t){this.x=t[0];this.y=t[1];this.diameter=t[2]};pt.Ellipse=dt.Ellipse;P.defineProperty(pt.Ellipse.prototype,"class",{get:function(){return"qc.Ellipse"}});pt.Ellipse.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]};pt.Ellipse.prototype.fromJson=function(t){this.x=t[0];this.y=t[1];this.width=t[2];this.height=t[3]};pt.Line=dt.Line;P.defineProperty(pt.Line.prototype,"class",{get:function(){return"qc.Line"}});pt.Line.prototype.toJson=function(){return[this.start.x,this.start.y,this.end.x,this.end.y]};pt.Line.prototype.fromJson=function(t){this.start.setTo(t[0],t[1]);this.end.setTo(t[2],t[3])};pt.Matrix=dt.Matrix;P.defineProperty(pt.Matrix.prototype,"class",{get:function(){return"qc.Matrix"}});pt.Matrix.prototype.toJson=function(){return this.toArray()};pt.Matrix.prototype.fromJson=function(t){this.fromArray(t)};pt.Point=dt.Point;P.defineProperty(pt.Point.prototype,"class",{get:function(){return"qc.Point"}});pt.Point.prototype.toJson=function(){return[this.x,this.y]};pt.Point.prototype.fromJson=function(t){this.x=t[0];this.y=t[1]};pt.Polygon=dt.Polygon;P.defineProperty(pt.Polygon.prototype,"class",{get:function(){return"qc.Polygon"}});pt.Polygon.prototype.toJson=function(){return[this.toNumberArray(),this.closed]};pt.Polygon.prototype.fromJson=function(t){this.setTo(t[0]);this.closed=t[1]};pt.Rectangle=dt.Rectangle;P.defineProperty(pt.Rectangle.prototype,"class",{get:function(){return"qc.Rectangle"}});pt.Rectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]};pt.Rectangle.prototype.fromJson=function(t){this.setTo(t[0],t[1],t[2],t[3])};pt.RoundedRectangle=dt.RoundedRectangle;P.defineProperty(pt.RoundedRectangle.prototype,"class",{get:function(){return"qc.RoundedRectangle"}});pt.RoundedRectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height,this.radius]};pt.RoundedRectangle.prototype.fromJson=function(t){this.x=t[0];this.y=t[1];this.width=t[2];this.height=t[3];this.radius=t[4]};var o=pt.Keyframe=function(t,e,i,r){this.time=t;this.value=e;this.type=o.FREE_SMOOTH;this.inTangent=isNaN(i)?0:i;this.outTangent=isNaN(r)?0:r};o.prototype={};o.prototype.constructor=o;o.prototype.clone=function(){var t=new o(this.time,this.value,this.inTangent,this.outTangent);t.type=this.type;return t};o.AUTO=0;o.FREE_SMOOTH=1;o.FLAT=2;o.BROKEN=3;o.LINEAR=4;o.InfinityValue=Math.tan(Math.PI/2);P.defineProperties(o.prototype,{inAngle:{get:function(){return Math.atan(this.inTangent)},set:function(t){this.inTangent=Math.tan(t*Math.PI/180)}},outAngle:{get:function(){return Math.atan(this.outTangent)},set:function(t){this.outTangent=Math.tan(t*Math.PI/180)}},inTangent:{get:function(){return this._inTangent||0},set:function(t){this._inTangent=Math.abs(t)===o.InfinityValue?(t<0?-1:1)*Infinity:t}},outTangent:{get:function(){return this._outTangent||0},set:function(t){this._outTangent=Math.abs(t)===o.InfinityValue?(t<0?-1:1)*Infinity:t}},isFlat:{get:function(){return this.inTangent===this.outTangent&&this.outTangent===0}},isBroken:{get:function(){return this.inTangent!==this.outTangent}}});var p=pt.BezierCurve=function(t){this._keys=[];if(Array.isArray(t)){for(var e in t){this.addKey(t[e])}}else{for(var e=0;e<arguments.length;++e){this.addKey(arguments[e])}}};p.prototype={};p.prototype.constructor=p;P.defineProperties(p.prototype,{class:{get:function(){return"qc.BezierCurve"}},keys:{get:function(){return this._keys},set:function(t){this._keys=[];for(var e in t){this.addKey(t[e])}}},length:{get:function(){return this._keys.length}},startTime:{get:function(){if(!this.keys||!this.keys.length)return 0;else return this.keys[0].time}},endTime:{get:function(){if(!this.keys||!this.keys.length)return 0;else return this.keys[this.keys.length-1].time}},totalTime:{get:function(){if(!this.keys||!this.keys.length)return 0;else return this.keys[this.keys.length-1].time-this.keys[0].time}},postWrapMode:{get:function(){return isNaN(this._postWrapMode)?p.WRAP_CLAMP:this._postWrapMode},set:function(t){this._postWrapMode=t}},preWrapMode:{get:function(){return isNaN(this._preWrapMode)?p.WRAP_CLAMP:this._preWrapMode},set:function(t){this._preWrapMode=t}}});p.prototype.toJson=function(){var t=[];for(var e=0;e<this._keys.length;++e){t.push([this._keys[e].time,this._keys[e].value,this._keys[e].inTangent===Infinity?"Infinity":this._keys[e].inTangent,this._keys[e].outTangent===Infinity?"Infinity":this._keys[e].outTangent])}t.push([this.preWrapMode,this.postWrapMode]);return t};p.prototype.fromJson=function(t){for(var e=0;e<t.length;++e){if(t[e].length===4){this.addKey(t[e][0],t[e][1],t[e][2]==="Infinity"?Infinity:t[e][2],t[e][3]==="Infinity"?Infinity:t[e][3])}}if(t[t.length-1].length===2){this.preWrapMode=t[t.length-1][0];this.postWrapMode=t[t.length-1][1]}};p.prototype.sort=function(){this._keys.sort(function(t,e){return t.time-e.time})};p.prototype.addKey=function(t,e,i,r){var a=!(t instanceof o)&&(isNaN(i)||isNaN(r));var n=t instanceof o?t:new o(t,e,i,r);var s=pt.Util.insertSortedList(this._keys,n,this._keyframeLess);a&&this.makeKeyframeAuto(s);return s};p.prototype.removeKey=function(t){return this._keys?this._keys.splice(t,1):null};p.prototype._keyframeLess=function(t,e){return t.time<e.time};p.prototype._calc=function(t,e,i,r,a){var n=Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*i+3*(1-t)*Math.pow(t,2)*a+r*Math.pow(t,3);if(n===Infinity||isNaN(n)||Math.abs(n)>=2147483647)return t===1?r:e;return n};p.prototype._calcDerivative=function(t,e,i,r,a){var n=1-t;var s=-3*e*n*n+3*i*n*(1-3*t)+3*a*t*(2-3*t)+3*r*Math.pow(t,2);if(s===Infinity||isNaN(s))return 0;return s};p.prototype.evaluate=function(t,e){var i=0,r=this._keys?this._keys.length:0;if(r===0)return NaN;if(r===1)return this._keys[0].value;var a=this._keys[0].time;var n=this._keys[r-1].time;var s=n-a;if(a>t){if(s===0||this.preWrapMode===p.WRAP_CLAMP){return this._keys[0].value}else if(this.preWrapMode===p.WRAP_LOOP){var o=a-t;o=o-Math.floor(o/s)*s;return this.evaluate(n-o,e)}else if(this.preWrapMode===p.WRAP_PINGPONG){var o=a-t;o=o-Math.floor(o/(2*s))*2*s;if(o<=s){return this.evaluate(a+o,e)}else{return this.evaluate(n-o+s,e)}}}if(t>n){if(s===0||this.postWrapMode===p.WRAP_CLAMP){return this._keys[r-1].value}else if(this.postWrapMode===p.WRAP_LOOP){var o=t-n;o=o-Math.floor(o/s)*s;return this.evaluate(a+o,e)}else if(this.postWrapMode===p.WRAP_PINGPONG){var o=t-n;o=o-Math.floor(o/(2*s))*2*s;if(o<=s){return this.evaluate(n-o,e)}else{return this.evaluate(a+o-s,e)}}}if(t===a&&e&&this.preWrapMode!==p.WRAP_CLAMP){t=n}var h;while(++i<r){h=this._keys[i].time;if(h===a){continue}if(t<=h){var l=h-a;var u=this._keys[i].value-this._keys[i-1].value;var f=(t-a)/l;var c=this._calc(f,this._keys[i-1].value,this._keys[i-1].value+l*this._keys[i-1].outTangent/3,this._keys[i].value,this._keys[i].value-l*this._keys[i].inTangent/3);return c}a=this._keys[i].time}return NaN};p.prototype.evaluateDerivative=function(t){var e=0,i=this._keys?this._keys.length:0;if(i===0)return NaN;var r=this._keys[0].time;if(r>t||t>this._keys[i-1].time)return NaN;var a;while(++e<i){a=this._keys[e].time;if(a===r){continue}if(t<a){var n=a-r;var s=(t-r)/n;var o=this._calcDerivative(s,this._keys[e-1].value,this._keys[e-1].value+n*this._keys[e-1].outTangent/3,this._keys[e].value,this._keys[e].value-n*this._keys[e].inTangent/3);return o/n}r=this._keys[e].time}return NaN};p.prototype.makeKeyframeAuto=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null;var i=t>0&&t<this._keys.length?this._keys[t-1]:null;var r=t<=this._keys.length-1&&t>=0?this._keys[t+1]:null;var a=0;var n=0;if(!e){return}if(i){a++;n+=Math.atan2(e.value-i.value,e.time-i.time)}if(r){a++;n+=Math.atan2(r.value-e.value,r.time-e.time)}if(a>0)e.inTangent=e.outTangent=Math.tan(n/a)};p.prototype.makeKeyframeSmooth=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null;if(!e){return}var i=Math.atan(e.inTangent)+Math.atan(e.outTangent);e.inTangent=e.outTangent=Math.tan(i/2)};p.prototype.makeKeyframeFlat=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null;if(!e){return}e.inTangent=e.outTangent=0};p.prototype.makeKeyframeLinear=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null;var i=t>0&&t<this._keys.length?this._keys[t-1]:null;var r=t<=this._keys.length-1&&t>=0?this._keys[t+1]:null;if(!e){return}if(i){e.inTangent=(e.value-i.value)/(e.time-i.time)}if(r){e.outTangent=(r.value-e.value)/(r.time-e.time)}};p.prototype.clone=function(){var t=new p([]);for(var e in this._keys){t.addKey(this._keys[e].clone())}return t};p.WRAP_CLAMP=0;p.WRAP_LOOP=1;p.WRAP_PINGPONG=2;var b=pt.GeometricTool={};b.flattenPolygon=function(t){var e=new Array(t.length*2);var i=t.length;while(i--){e[2*i]=t[i].x;e[2*i+1]=t[i].y}return e};b.polygonContains=function(t,e,i){if(isNaN(t[0])){var r=t.length;var a=false;for(var n=-1,s=r-1;++n<r;s=n){var o=t[n].x;var h=t[n].y;var l=t[s].x;var u=t[s].y;if((h<=i&&i<u||u<=i&&i<h)&&e<(l-o)*(i-h)/(u-h)+o){a=!a}}return a}else{var r=t.length/2;var a=false;for(var n=-1,s=r-1;++n<r;s=n){var o=t[2*n];var h=t[2*n+1];var l=t[2*s];var u=t[2*s+1];if((h<=i&&i<u||u<=i&&i<h)&&e<(l-o)*(i-h)/(u-h)+o){a=!a}}return a}};b.pointOnLine=function(t,e,i,r){return(i-t.x)*(e.y-t.y)===(e.x-t.x)*(r-t.y)};b.pointOnSegment=function(t,e,i,r){var a=Math.min(t.x,e.x);var n=Math.max(t.x,e.x);var s=Math.min(t.y,e.y);var o=Math.max(t.y,e.y);return pt.GeometricTool.pointOnLine(t,e,i,r)&&(i>=a&&i<=n)&&(r>=s&&r<=o)};b.lineIntersectsPoints=function(t,e,i,r,a,n){if(typeof a==="undefined"){a=true}if(!n){n=new pt.Point}var s=e.y-t.y;var o=r.y-i.y;var h=t.x-e.x;var l=i.x-r.x;var u=e.x*t.y-t.x*e.y;var f=r.x*i.y-i.x*r.y;var c=s*l-o*h;if(c===0){return null}if(t.equals(i)||t.equals(r)){n.x=t.x;n.y=t.y;return n}else if(e.equals(i)||e.equals(r)){n.x=e.x;n.y=e.y;return n}n.x=(h*f-l*u)/c;n.y=(o*u-s*f)/c;if(a){var p=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);var d=((r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x))/p;var _=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/p;if(d>=0&&d<=1&&_>=0&&_<=1){return n}else{return null}}return n};var f=b._sutherlandHodgmanInside=function(t,e,i,r){return(e.x-t.x)*(i.y-t.y)+r>=(e.y-t.y)*(i.x-t.x)};var c=b._sutherlandHodgmanIntersection=function(t,e,i,r){var a=[t.x-e.x,t.y-e.y],n=[i.x-r.x,i.y-r.y],s=t.x*e.y-t.y*e.x,o=i.x*r.y-i.y*r.x,h=1/(a[0]*n[1]-a[1]*n[0]);return{x:(s*n[0]-o*a[0])*h,y:(s*n[1]-o*a[1])*h}};b.sutherlandHodgman=function(t,e){var i,r,a,n,s,o;var h=1e-6;var l=t;i=e[e.length-1];for(s in e){var r=e[s];var u=l;l=[];a=u[u.length-1];for(o in u){var n=u[o];if(f(i,r,n,h)){if(!f(i,r,a,h)){l.push(c(i,r,a,n))}l.push(n)}else if(f(i,r,a,h)){l.push(c(i,r,a,n))}a=n}i=r}return l};b.Triangulate=function(t){var e=true;var i=t.length;if(i<3)return[];var r=[];var a=[];for(var n=0;n<i;n++)a.push(n);n=0;var s=i;while(s>3){var o=a[(n+0)%s];var h=a[(n+1)%s];var l=a[(n+2)%s];var u=t[o].x,f=t[o].y;var c=t[h].x,p=t[h].y;var d=t[l].x,_=t[l].y;var g=false;if(_t.PolyK._convex(u,f,c,p,d,_,e)){g=true;for(var m=0;m<s;m++){var y=a[m];if(y===o||y===h||y===l)continue;if(_t.PolyK._PointInTriangle(t[y].x,t[y].y,u,f,c,p,d,_)){g=false;break}}}if(g){r.push(o,h,l);a.splice((n+1)%s,1);s--;n=0}else if(n++>3*s){if(e){r=[];a=[];for(n=0;n<i;n++)a.push(n);n=0;s=i;e=false}else{return null}}}r.push(a[0],a[1],a[2]);return r};b.area=function(t,e,i){if(!t||!e||!i){return 0}return(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)};b.left=function(t,e,i){return b.area(t,e,i)>0};b.leftOn=function(t,e,i){return b.area(t,e,i)>=0};b.right=function(t,e,i){return b.area(t,e,i)<0};b.rightOn=function(t,e,i){return b.area(t,e,i)<=0};b.distance=function(t,e){var i=e.x-t.x;var r=e.y-t.y;return i*i+r*r};b.atPolygon=function(t,e){var i=t.length;return t[e<0?e%i+i:e%i]};b.lineInt=function(t,e,i){i=i||0;var r=new pt.Point;var a,n,s,o,h,l,u;a=t[1].y-t[0].y;n=t[0].x-t[1].x;s=a*t[0].x+n*t[0].y;o=e[1].y-e[0].y;h=e[0].x-e[1].x;l=o*e[0].x+h*e[0].y;u=1/(a*h-o*n);if(!b._equals(u,0,i)){r.x=(h*s-n*l)*u;r.y=(a*l-o*s)*u}return r};b.isPolygonReflex=function(t,e){return b.right(b.atPolygon(t,e-1),b.atPolygon(t,e),b.atPolygon(t,e+1))};b.polygonCanSee=function(t,e,i){var r,a,n=[],s=[];if(b.leftOn(b.atPolygon(t,e+1),b.atPolygon(t,e),b.atPolygon(t,i))&&b.rightOn(b.atPolygon(t,e-1),b.atPolygon(t,e),b.atPolygon(t,i))){return false}a=b.distance(b.atPolygon(t,e),b.atPolygon(t,i));for(var o=0;o!=t.length;++o){if((o+1)%t.length===e||o===e)continue;if(b.leftOn(b.atPolygon(t,e),b.atPolygon(t,i),b.atPolygon(t,o+1))&&b.rightOn(b.atPolygon(t,e),b.atPolygon(t,i),b.atPolygon(t,o))){n[0]=b.atPolygon(t,e);n[1]=b.atPolygon(t,i);s[0]=b.atPolygon(t,o);s[1]=b.atPolygon(t,o+1);r=b.lineInt(n,s);if(b.distance(b.atPolygon(t,e),r)<a){return false}}}return true};b._equals=function(t,e,i){i=i||0;return Math.abs(t-e)<i};b.getIntersectionPoint=function(t,e,i,r,a){a=a||0;var n=e.y-t.y;var s=t.x-e.x;var o=n*t.x+s*t.y;var h=r.y-i.y;var l=i.x-r.x;var u=h*i.x+l*i.y;var f=n*l-h*s;if(!b._equals(f,0,a))return{x:(l*o-s*u)/f,y:(n*u-h*o)/f};else return{x:0,y:0}};b.quickDecomp=function(t,e,i,r,a,n,s){n=n||100;s=s||0;a=a||25;e=typeof e!="undefined"?e:[];i=i||[];r=r||[];var o=[0,0],h=[0,0],l=[0,0];var u=0,f=0,c=0,p=0;var d=0,_=0,g=0;var m=[],y=[];var v=t;if(v.length<3)return e;s++;if(s>n){return e}for(var T=0;T<v.length;++T){if(b.isPolygonReflex(v,T)){i.push(v[T]);u=f=Number.MAX_VALUE;for(var x=0;x<v.length;++x){if(b.left(b.atPolygon(v,T-1),b.atPolygon(v,T),b.atPolygon(v,x))&&b.rightOn(b.atPolygon(v,T-1),b.atPolygon(v,T),b.atPolygon(v,x-1))){l=b.getIntersectionPoint(b.atPolygon(v,T-1),b.atPolygon(v,T),b.atPolygon(v,x),b.atPolygon(v,x-1));if(b.right(b.atPolygon(v,T+1),b.atPolygon(v,T),l)){c=b.distance(v[T],l);if(c<f){f=c;h=l;_=x}}}if(b.left(b.atPolygon(v,T+1),b.atPolygon(v,T),b.atPolygon(v,x+1))&&b.rightOn(b.atPolygon(v,T+1),b.atPolygon(v,T),b.atPolygon(v,x))){l=b.getIntersectionPoint(b.atPolygon(v,T+1),b.atPolygon(v,T),b.atPolygon(v,x),b.atPolygon(v,x+1));if(b.left(b.atPolygon(v,T-1),b.atPolygon(v,T),l)){c=b.distance(v[T],l);if(c<u){u=c;o=l;d=x}}}}if(_==(d+1)%v.length){l.x=(h.x+o.x)/2;l.y=(h.y+o.y)/2;r.push(l);if(T<d){Array.prototype.push.apply(m,v.slice(T,d+1));m.push(l);y.push(l);if(_!=0){Array.prototype.push.apply(y,v.slice(_,v.length))}Array.prototype.push.apply(y,v.slice(0,T+1))}else{if(T!=0){Array.prototype.push.apply(m,v.slice(T,v.length))}Array.prototype.push.apply(m,v.slice(0,d+1));m.push(l);y.push(l);Array.prototype.push.apply(y,v.slice(_,T+1))}}else{if(_>d){d+=v.length}p=Number.MAX_VALUE;if(d<_){return e}for(var x=_;x<=d;++x){if(b.leftOn(b.atPolygon(v,T-1),b.atPolygon(v,T),b.atPolygon(v,x))&&b.rightOn(b.atPolygon(v,T+1),b.atPolygon(v,T),b.atPolygon(v,x))){c=b.distance(b.atPolygon(v,T),b.atPolygon(v,x));if(c<p){p=c;g=x%v.length}}}if(T<g){Array.prototype.push.apply(m,v.slice(T,g+1));if(g!=0){Array.prototype.push.apply(y,v.slice(g,v.length))}Array.prototype.push.apply(y,v.slice(0,T+1))}else{if(T!=0){Array.prototype.push.apply(m,v.slice(T,v.length))}Array.prototype.push.apply(m,v.slice(0,g+1));Array.prototype.push.apply(y,v.slice(g,T+1))}}if(m.length<y.length){b.quickDecomp(m,e,i,r,a,n,s);b.quickDecomp(y,e,i,r,a,n,s)}else{b.quickDecomp(y,e,i,r,a,n,s);b.quickDecomp(m,e,i,r,a,n,s)}return e}}e.push(v);return e};b.decomp=function(t){var e=b.getCutEdges(t);if(e.length>0)return b.polygonSlice(t,e);else return[t]};b.polygonSlice=function(t,e){if(e.length===0)return[this];if(e instanceof Array&&e.length&&e[0]instanceof Array&&e[0].length==2&&e[0][0]instanceof Array){var i=[t];for(var r=0;r<e.length;r++){var a=e[r];for(var n=0;n<i.length;n++){var s=i[n];var o=b.polygonSlice(s,a);if(o){i.splice(n,1);i.push(o[0],o[1]);break}}}return i}else{var a=e;var r=t.indexOf(a[0]);var n=t.indexOf(a[1]);if(r!=-1&&n!=-1){return[b.copyPolygon(t,r,n),b.copyPolygon(t,n,1)]}else{return false}}};b.copyPolygon=function(t,e,i,r){var a=r||[];if(e<i){for(var n=e;n<=i;n++){a.push(t[n])}}else{for(var n=0;n<=i;n++){a.push(t[n])}for(var n=e;n<t.length;n++){a.push(t[n])}}return a};b.getCutEdges=function(t){var e=[],i=[],r=[],a=[];var n=Number.MAX_VALUE;for(var s=0;s<t.length;++s){if(b.isPolygonReflex(t,s)){for(var o=0;o<t.length;++o){if(b.polygonCanSee(t,s,o)){i=b.getCutEdges(b.copyPolygon(t,s,o));r=b.getCutEdges(b.copyPolygon(t,o,s));for(var h=0;h<r.length;h++){i.push(r[h])}if(i.length<n){e=i;n=i.length;e.push([b.atPolygon(t,s),b.atPolygon(t,o)])}}}}}return e};var O=pt.AssetUtil={ASSET_SCENE:1,ASSET_PREFAB:2,ASSET_ATLAS:3,ASSET_TEXT:4,ASSET_FONT:5,ASSET_SOUND:6,ASSET_EXCEL:7,ASSET_WEBFONT:8,ASSET_ACTION:9,ASSET_ACTIONMANAGER:10,ASSET_TS:99,ASSET_JS:100,ASSET_UNKNOWN:101,parse:function(e,t,i,r){var a,n=t.key,s=t.url;var o=t.data;if(!/\.bin$/.test(s)){if(t.isRaw){this._addAtlasToCache(e,n,s)}else{var h=e.assets._cache.getSound(s);if(h){var l=new pt.SoundAsset(n,s,h.data,{uuid:n,type:O.ASSET_SOUND});e.assets.cache(n,s,l)}if(D.__wx){var u=e.storage.get("localFiles")||{};var f=e.storage.get("assetsMd5")||{};var n=s.replace("Assets/","");if(f[n]){var c=u[n];if(c){if(c["md5"]==f[n]){e.log.important("文件({0})md5一致，不缓存。",s);c["time"]=e.time.now;e.storage.delaySet("localFiles",u,1e4)}}else{c={};c["md5"]=f[n];c["time"]=e.time.now;u[n]=c;e.storage.delaySet("localFiles",u,1e4)}}}}if(i)i();return}else if(!t.isSound){o=o||e.assets._cache.getText(s);delete e.assets._cache._text[s];t.data=o;try{a=JSON.parse(o)}catch(t){e.log.error("Asset{0}/{1} Parse fail",n,s);pt.Util.popupError(t.message);if(i)i();return}}else{o=o||e.assets._cache.getBinary(s);delete e.assets._cache._binary[s];var p,d;var _=new Uint8Array(o);if(_[0]===81&&_[1]===67){p=_;d=2}else{e.log.error("Asset({0}) parse fail",s);e.assets._parsing--;return}var g=function(){var t=p[d]<<24|p[d+1]<<16|p[d+2]<<8|p[d+3];var e=d+4;d+=t+4;return[e,t]};a=[];var m;m=g();a.push(e.serializer.unpackUTF8(p.subarray(m[0],m[0]+m[1])));m=g();a.push(o.slice(m[0],m[1]))}var y=JSON.parse(a[0]);if(D.__wx&&!t.data)O.wxSaveAsset(e,s,o);switch(y.type){case O.ASSET_ATLAS:if(D.hasBase64&&D.hasBase64()||D.assetsPackage){console.log("使用data.js资源");var v=t.url.split("/");var T=v[v.length-1];var x=[];for(var b=0;b<y.source.length;b++){var A="";if(b==2&&y.source[b]==".json"){A=T.replace("_tex.bin","_ske.json")}else{A=T.replace(".bin",y.source[b])}var S=A.replace(".","_");x.push(S)}if(x.length==1){var w=D.getAssestByKey(x[0]);if(w){a[1]="{}";a[2]=w}}else{for(var b=0;b<x.length;b++){var w=D.getAssestByKey(x[b]);if(w){a[b+1]=w}}}}else{var x=[];for(var b=0;b<y.source.length;b++){if(b==2&&y.source[b]==".json"){var A=t.url.replace("_tex.bin","_ske.json");x.push(A)}else{var A=t.url.replace(".bin",y.source[b]);x.push(A)}}var P=false;for(var b=0;b<x.length;b++){if(t.override&&!t.hasLoadDep||e.phaser.cache.getText(x[b])==null&&e.phaser.cache.getImage(x[b])==null){t.hasLoadDep=true;P=true}}if(P){t.loadCnt=x.length;if(r){e.assets._uuid2UrlConf[y.uuid]=t.url;r(y.uuid,x)}return}else{if(x.length==1){a[1]="{}";a[2]=e.phaser.cache.getText(x[0])||e.phaser.cache.getImage(x[0])}else{for(var b=0;b<x.length;b++){if(e.phaser.cache.getText(x[b])||e.phaser.cache.getImage(x[b])){var E=e.phaser.cache.getText(x[b])||e.phaser.cache.getImage(x[b]);a[b+1]=E}}}}}return O._parseAtlas(e,y,JSON.parse(a[1]),a[2],a[3]?JSON.parse(a[3]):C,n,s,i);case O.ASSET_PREFAB:return O._parsePrefab(e,JSON.parse(a[1]),n,s,y,i);case O.ASSET_SCENE:return O._parseScene(e,JSON.parse(a[1]),n,s,y,i);case O.ASSET_TEXT:return O._parseText(e,a[1],n,s,y,i);case O.ASSET_FONT:return O._parseFont(e,y,a[1],a[2],n,s,i);case O.ASSET_SOUND:return O._parseSound(e,y,a[1],n,s,i);case O.ASSET_EXCEL:return O._parseExcel(e,y,JSON.parse(a[1]),n,s,i);case O.ASSET_WEBFONT:return O._parseWebFont(e,y,JSON.parse(a[1]),n,s,i);case O.ASSET_ACTION:return O._parseAction(e,JSON.parse(a[1]),n,s,y,i);case O.ASSET_ACTIONMANAGER:return O._parseActionManager(e,JSON.parse(a[1]),n,s,y,i);default:throw new Error("unsupported asset type："+y.type)}},isSound:function(t){if(pt.Util.isArray(t)){for(var e=0;e<t.length;e++){if(t[e]&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(t[e].toLowerCase()))return true}return false}return t&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(t.toLowerCase())},_parseAtlas:function(_,g,m,t,y,v,T,x){var b=new Image;b.url=T;var A=function(t){var e;var i={meta:{image:t.imagePath},frames:e={}};var r=t.SubTexture;var a=r.length;var n;for(var s=0;s<a;s++){n=r[s];e[n.name]={filename:n.name,frame:{x:n.x,y:n.y,w:n.width,h:n.height},rotated:false,trimmed:false,spriteSourceSize:{x:0,y:0,w:n.width,h:n.height},sourceSize:{w:n.width,h:n.height}}}return i};var S=function(t,e,i){D.drawcanvas||(D.drawcanvas=document.createElement("canvas"),D.drawctx=drawcanvas.getContext("2d")),drawcanvas.width=e,drawcanvas.height=i,drawctx.drawImage(t,0,0,e,i),t.key=null,t.remove();var r=drawcanvas.toDataURL("image/png");return r};var w=function(){b.onload=C;var t=_.assets._cache;{var e=T.split("/");var i=e[e.length-1];var r=i.replace(".","_");if(D.picDesc&&D.picDesc[r]){var a=D.picDesc[r];var n=a.split(",");var s=parseInt(n[0]);var o=parseInt(n[1]);if(s!=b.width){var h=S(b,s,o);return b.src=h,b.onload=w,void 0}}t._images[T]={url:T,data:b};_t.BaseTextureCache[T]=new _t.BaseTexture(b);_t.TextureCache[T]=new _t.Texture(_t.BaseTextureCache[T]);if(P.keys(m).length>0){if(y&&(g.animationType===_e.DRAGON_BONES||g.animationType===_e.FRAME_SAMPLES)){var l=A(m);t._images[T].frameData=dt.AnimationParser.JSONDataHash(_.phaser,l,T)}else{if(m&&pt.Util.isArray(m.frames))t._images[T].frameData=dt.AnimationParser.JSONData(_.phaser,m,T);else t._images[T].frameData=dt.AnimationParser.JSONDataHash(_.phaser,m,T)}}else{if(!g.spriteSheet){t._images[T].frameData=new dt.FrameData;t._images[T].frame=new dt.Frame(0,0,0,b.width,b.height,"","");t._images[T].frameData.addFrame(new dt.Frame(0,0,0,b.width,b.height,null,_.math.uuid()))}else{var u=b.width/(g.spriteSheet.columns||1);var f=b.height/(g.spriteSheet.rows||1);var c=g.spriteSheet.margin||0;var p=g.spriteSheet.spacing||0;t._images[T].frameData=dt.AnimationParser.spriteSheet(_.phaser,T,u,f,-1,c,p)}}t._resolveURL(T,t._images[T])}var d=new pt.Atlas(v,T,t._images[T],g,y);d.json=m;d.img=b;_.assets.cache(v,T,d);x()};if(typeof t=="string"){if(t.search("data")==0){b.src=t}else{b.src="data:image/png;base64,"+t}}else{b=t;w()}b.onerror=function(){b.onerror=C;x()};b.onload=w},addAtlasFromImage:function(t,e,i,r){t.assets._cache.addImage(i,i,r);return this._addAtlasToCache(t,e,i)},_addAtlasToCache:function(t,e,i){var r=t.assets._cache._images[i];var a=new pt.Atlas(e,i,r,{uuid:t.math.uuid(),type:O.ASSET_ATLAS});a.img=r.data;t.assets.cache(e,i,a);return a},_parseFont:function(r,a,t,n,s,o,h){if(!D.__wx)n=r.assets._loader.parseXml(n);var l=new Image;l.src="data:image/png;base64,"+t;l.onerror=function(){l.onerror=C;h()};l.onload=function(){l.onload=C;if(!D.__wx){var t=new pt.Font(s,o,l,n,a);t._fontFamily=pt.UIText.BITMAPFONT;r.assets._cache.addBitmapFont(o,o,l,n,t.xSpacing,t.ySpacing);r.assets.cache(s,o,t);h()}else if(D.Tautologistics){var e=new Tautologistics.NodeHtmlParser.DefaultHandler(function(t,e){if(t){r.log.error("解析字体文件{0}的 xml 失败。",o);h()}else{var i=new pt.Font(s,o,l,e,a);i._fontFamily=pt.UIText.BITMAPFONT;r.assets._cache.addBitmapFont(o,o,l,e,i.xSpacing,i.ySpacing);r.assets.cache(s,o,i);h()}});var i=new Tautologistics.NodeHtmlParser.Parser(e);i.parseComplete(n)}}},_parseText:function(t,e,i,r,a,n){t.assets._cache.addText(r,r,e);t.assets.cache(i,r,new pt.TextAsset(i,r,e,a));n()},_parseScene:function(t,e,i,r,a,n){return O._parsePrefab(t,e,i,r,a,n)},_parsePrefab:function(t,e,i,r,a,n){t.assets.cache(i,r,new s(i,r,e,a));n()},_parseAction:function(t,e,i,r,a,n){t.assets.cache(i,r,new v(i,r,e,a));n()},_parseActionManager:function(t,e,i,r,a,n){t.assets.cache(i,r,new T(i,r,e,a));n()},_parseSound:function(t,e,i,r,a,n){t.assets._cache.addSound(a,a,i);if(t.assets._cache.isSoundDecoded(a)){var s=new pt.SoundAsset(r,a,t.phaser.cache.getSound(a),e);t.assets.cache(r,a,s);n()}else{t.sound.phaser.decode(a,{url:a,key:r,meta:e,nextStep:n})}},_parseExcel:function(t,e,i,r,a,n){t.assets.cache(r,a,new pt.ExcelAsset(r,a,i,e));n()},_parseWebFont:function(r,e,t,a,n,i){O._deleteWebFont(e.uuid);O._loadWebFont(r,e.uuid,t.url);var s=new pt.Font(e.uuid,n,s,null,e);if(typeof t.url==="string"){s._fontUrl=[t.url]}else s._fontUrl=t.url;s._fontFamily=pt.UIText.WEBFONT;r.assets.cache(a,n.toString(),s);i();var o=function(t){if(r.world){P.keys(_t.Text.fontPropertiesCache).forEach(function(t){if(t.indexOf(e.uuid)>=0){delete _t.Text.fontPropertiesCache[t]}});O._refreshWebFont(t,r.world)}r.assets.webFontLoaded.dispatch()};if(D.__wx){for(var h=0;h<s._fontUrl.length;h++){var n=s._fontUrl[h];var l=wx.env.USER_DATA_PATH+"/"+n;var u=wx.getFileSystemManager();try{u.accessSync(l);var f=wx.loadFont(l);if(f){r.log.trace("Asset {0}->{1} load from local filesystem.",n,f);var s=r.assets.find(a);if(s)s.wxFontName=f;else r.log.error("加载本地字体"+n+"成功后取不到 font 资源");o(f)}}catch(t){O.wxAssureDirectory(r,n);wx.downloadFile({url:r.assets.baseURL+n,filePath:wx.env.USER_DATA_PATH+"/"+n,success:function(t){r.log.trace("字体 {0} 下载成功. res : {1}",n,JSON.stringify(t));var e=wx.loadFont(wx.env.USER_DATA_PATH+"/"+n);if(e){r.log.trace("Asset {0}->{1} load from local filesystem.",n,e);var i=r.assets.find(a);if(i){i.wxFontName=e}else r.log.error("从网络加载本地字体"+n+"成功后取不到 font 资源");o(e)}},fail:function(t){r.log.error("Download "+r.assets.baseURL+n+" fail："+JSON.stringify(t))}})}}}else if(D.WebFont){WebFont.load({timeout:6e4,custom:{families:[e.uuid]},fontactive:function(t){o(t)},fontinactive:function(t){r.log.error("Load "+t+" fail")}})}},_webFontType:{eot:"embedded-opentype",ttf:"truetype",ttc:"truetype",woff:"woff",svg:"svg"},_loadWebFont:function(t,e,i){var r=O._webFontType;var a=document.createElement("style");a.type="text/css";a.id="qc.webfont."+e;document.getElementsByTagName("head")[0].appendChild(a);var n="@font-face { font-family:"+e+"; src:";if(D.hasBase64&&D.hasBase64()){var s="data:application/octet-stream;base64,"+D.getAssestByKey(D.getKeyByUrl(i[0]));var o=new FontFace(e,'local(""),url(\''+s+"') format('ttf'),url('"+s+"')");o.load().then(function(t){document.fonts.add(t)})}else{if(pt.Util.isArray(i)){for(var h=0,l=i.length;h<l;h++){var u=i[h];var f=O._getSuffix(i[h]);if(i[h].indexOf("http")>=0)n+="url('"+i[h]+"') format('"+r[f]+"')";else n+="url('"+(t.assets.baseURL+i[h])+"') format('"+r[f]+"')";n+=h===l-1?";":","}}else{var f=O._getSuffix(i);n+="url('"+i+"') format('"+r[f]+"');"}}a.textContent+=n+"};"},_deleteWebFont:function(t){while(true){var e=document.getElementById("qc.webfont."+t);if(e)pt.Util.removeHTML(e);else break}},_refreshWebFont:function(t,e){if(e instanceof pt.UIText){e._refreshWebFont(t)}var i=e.children;var r=i.length;while(r--){var a=i[r];O._refreshWebFont(t,a)}},_getSuffix:function(t){var e=t.substr((Math.max(0,t.lastIndexOf("."))||Infinity)+1);return e.toLowerCase()},_createStandardXHR:function(){try{return new D.XMLHttpRequest}catch(t){}},_createActiveXHR:function(){try{return new D.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}},getXHR:function(){var e;try{e=location.href}catch(t){e=document.createElement("a");e.href="";e=e.href}var t=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;var i=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/;var r=t.exec(e.toLowerCase())||[];var a=i.test(r[1]);var n=D.ActiveXObject?function(){return!a&&O._createStandardXHR()||O._createActiveXHR()}:O._createStandardXHR;return n()},get:function(t,e,i){if(D.__wx){var r={};r["Content-Type"]="text/plain;charset=UTF-8";wx.request({url:t,header:r,dataType:"text",success:function(t){e(t.data)},fail:function(t){console.log("err:"+JSON.stringify(t));i()}});return}var a=O.getXHR();a.open("GET",t,true);a.responseType="text";a.onreadystatechange=function(){if(a.readyState===4){if(a.status===200){e(a.responseText)}else{if(i)i(a)}}else{}};a.send()},post:function(t,e,i,r){if(D.__wx){var a={};a["Content-Type"]="text/plain;charset=UTF-8";wx.request({url:t,method:"POST",data:e,header:a,dataType:"text",success:function(t){i(t.data)},fail:function(){r()}});return}var n=O.getXHR();n.open("POST",t,true);n.responseType="text";n.onreadystatechange=function(){if(n.readyState===4){if(n.status===200){i(n.responseText)}else{if(r)r(n)}}else{}};n.send(e)},createAtlasFromCanvas:function(t,e,i){var r=t.assets.find(e);if(r){var a=_t.BaseTextureCache[e];if(a&&a.source==i){a.dirty();return r}r.unload(t)}var n=t.assets._cache;_t.BaseTextureCache[e]=new _t.BaseTexture(i);_t.TextureCache[e]=new _t.Texture(_t.BaseTextureCache[e]);n._images[e]={url:e,data:i};n._images[e].frameData=new dt.FrameData;n._images[e].frame=new dt.Frame(0,0,0,i.width,i.height,"","");n._images[e].frameData.addFrame(new dt.Frame(0,0,0,i.width,i.height,null,t.math.uuid()));var r=new pt.Atlas(e,e,n._images[e],{});r.json={};r.img=i;t.assets.cache(e,e,r);return r},wxRemoveUnusedAssets:function(o){if(!D.__wx||typeof wx.getSharedCanvas=="function")return;var h=o.storage.get("assetsMd5")||{};var l=wx.getFileSystemManager();var u=wx.env.USER_DATA_PATH+"/Assets";var f=function(e){try{var t=l.readdirSync(e);for(var i=0;i<t.length;i++){var r=t[i];var a=e+"/"+r;try{var n=l.statSync(a);if(n.isDirectory()){f(a)}else{var s=a.replace(u+"/","");if(!h[s]){o.log.trace("本地文件({0})不在md5列表中，删除之！",s);l.unlink({filePath:a})}}}catch(t){o.log.important("wxRemoveUnusedAssets statSync({0}) 出错：{1}",a,t)}}}catch(t){o.log.important("wxRemoveUnusedAssets readdirSync({0}) 出错：{1}",e,t);return}};f(u)},wxCleanLocalFiles:function(e,t,i,r){if(!D.__wx||typeof wx.getSharedCanvas=="function")return;var a=e.storage.get("localFiles")||{};var n=[];for(var s in a){var o={key:s,time:a[s].time};pt.Util.insertSortedList(n,o,function(t,e){return t.time<e.time},true)}var h=wx.getFileSystemManager();var l=0;var u=20*1024*1024;for(var f=0;f<n.length;f++){if(l>=u)break;var s=n[f].key;try{var c=wx.env.USER_DATA_PATH+"/Assets/"+s;var p=h.statSync(c);l+=p.size;h.unlinkSync(c)}catch(t){e.log.important("wxCleanLocalFiles statSync({0}) 出错：{1}",c,t)}}if(r)return;if(t&&i)pt.AssetUtil.wxWriteFile(e,t,i,true)},wxAssureDirectory:function(e,t){if(!D.__wx||typeof wx.getSharedCanvas=="function")return;var i=wx.getFileSystemManager();var r="";var a=[wx.env.USER_DATA_PATH];a=a.concat(t.split("/"));for(var n=0;n<a.length-1;n++){if(n===0)r=a[0];else r=r+"/"+a[n];try{i.accessSync(r)}catch(t){try{i.mkdirSync(r)}catch(t){e.log.trace("创建目录{0}失败：{1}",r,JSON.stringify(t))}}}},wxWriteFile:function(e,i,r,a,t){if(!D.__wx)return;O.wxAssureDirectory(e,i);var n=wx.getFileSystemManager();var s=wx.env.USER_DATA_PATH+"/"+i;n.writeFile({filePath:s,data:r,encoding:"utf8",success:function(){e.log.trace("资源({0})写入本地文件",i);if(t)t.apply(null,[i])},fail:function(t){e.log.important("资源({0})写入本地文件{1}失败：{2}",i,s,t.errMsg);n.unlink({filePath:s});O.wxCleanLocalFiles(e,i,r,a)}})},wxSaveAsset:function(t,e,i){if(!D.__wx||typeof wx.getSharedCanvas=="function")return;var r=t.storage.get("localFiles")||{};var a=t.storage.get("assetsMd5")||{};var n=e.replace("Assets/","");if(!a[n]){t.log.important("文件({0})不在md5列表中，不缓存。",e);return}var s=r[n];if(s){if(s["md5"]==a[n]){t.log.important("文件({0})md5一致，不缓存。",e);s["time"]=t.time.now;t.storage.delaySet("localFiles",r,1e4);return}}else s={};s["md5"]=a[n];s["time"]=t.time.now;r[n]=s;t.storage.delaySet("localFiles",r,1e4);O.wxWriteFile(t,e,i)},wxReadAsset:function(n,s){if(!D.__wx||typeof wx.getSharedCanvas=="function")return;var o=s.url;var t=n.storage.get("localFiles")||{};var e=n.storage.get("assetsMd5")||{};var i=o.replace("Assets/","");var r=function(t){var e=wx.getFileSystemManager();var i;try{if(s.isSound){e.accessSync(t);var i=new Audio;i.name=o;var r=function(){i.removeEventListener("canplaythrough",r,false);i.removeEventListener("stalled",a,false);i.onerror=null};i.onerror=function(){i.removeEventListener("canplaythrough",r,false);i.removeEventListener("stalled",a,false);i.onerror=null;var t=n.assets.find(o);if(t)t.unload(n)};var a=function(){i.removeEventListener("canplaythrough",r,false);i.removeEventListener("stalled",a,false);i.onerror=null;var t=n.assets.find(o);if(t)t.unload(n)};i.preload="auto";i.src=t;i.addEventListener("canplaythrough",r,false);i.addEventListener("stalled",a,false);s.data=i;n.assets._cache.addSound(o,o,i,false,true);return i}else{i=e.readFileSync(t,"utf8");s.data=i;return i}}catch(t){}};var a=r(o);if(a){n.log.trace("Asset {0} load from package.",o);return a}if(!e[i]){n.log.important("文件({0})不在md5列表中，不尝试读取本地资源。",o);return}var h=t[i];if(h&&h["md5"]==e[i]){var l=wx.env.USER_DATA_PATH+"/"+o;var a=r(l);if(a){n.log.trace("Asset {0} load from local filesystem.",o);h["time"]=n.time.now;t[i]=h;n.storage.delaySet("localFiles",t,1e4);return a}else{delete t[i];n.storage.delaySet("localFiles",t,1e4);var u=wx.getFileSystemManager();u.unlink({filePath:l})}}},updateWxResMd5:function(a,n,s,o){O.get(n,function(t){try{var i=JSON.parse(t);a.log.trace("Download dislist success: {0}",t);var e=a.storage.get("version")||"";var r=a.storage.get("assetsMd5");if(e==i.version&&r){a.log.trace("资源版本一致。");if(typeof o=="function")o.apply(null,[i]);return}O.get(s,function(t){var e={};try{e=JSON.parse(t);a.log.trace("下载 md5List 成功。");a.storage.set("assetsMd5",e);a.storage.set("version",i.version);O.wxRemoveUnusedAssets(a);if(typeof o=="function")o.apply(null,[i])}catch(t){a.log.error("parse md5List({0}) fail.",s);if(typeof o=="function")o.apply(null,[])}},function(){a.log.error("download md5List({0}) fail.",s);if(typeof o=="function")o.apply(null,[])})}catch(t){a.log.error("parse dislist({0}) fail.",n);if(typeof o=="function")o.apply(null,[]);return}},function(){a.log.error("download dislist({0}) fail.",n);if(typeof o=="function")o.apply(null,[])})}};var e=pt.Assets=function(a,t,e){this._loader=t;this._cache=e;this.game=a;t._qc=this;e._qc=this;this._uuid2UrlConf=D.urlMapConfig||{};this._uuid2UrlConf["__builtin_resource__"]="__builtin_resource__";this.assetCountMap=D.assetCountMap||{};this.batchTotalCount=0;this.batchCurCount=0;this.batchLoadFlag=false;this.inBatchLoadFlag=false;this.maxRetryTimes=1;this.webFontLoaded=new pt.Signal;this._parsing=0;this._loaderTimerMutex=-1024;this._assets={};this._keyUrl={};this._complete={};var n=this;t.onFileComplete.add(function(t,e,i){if(!i){var r=n._complete[e];if(!r||r.length===0)return;if(r[0].retry>=n.maxRetryTimes){n.game.log.important("Asset({0}) load fail",e);n._callCb(e,null,r[0]);return}n.game.timer.add(1e3,function(){n.game.log.trace("Retry download:{0}",e);r[0].retry++;n._internalLoad(r[0])});return}n._parseAsset(e)});a.sound.phaser.onSoundDecode.add(function(t,e){var i=n.game.phaser.cache.getSound(t);if(i&&i.decoded){var r=a.assets.find(t);if(!r){var r=new pt.SoundAsset(t,t,i,{uuid:t,type:O.ASSET_SOUND});a.assets.cache(t,t,r)}}if(e&&e.nextStep)e.nextStep()});this._loadBuiltin()};e.prototype={};e.prototype.constructor=e;e.IMAGE=1;e.AUDIO=2;e.TEXT=3;e.BITMAPFONT=4;e.BINARY=5;e.ATLAS=6;e.JSON=7;P.defineProperties(e.prototype,{isLoading:{get:function(){return this._loader.isLoading}},hasLoaded:{get:function(){return this._loader.hasLoaded}},baseURL:{get:function(){return this._loader.baseURL},set:function(t){this._loader.baseURL=t}},parsing:{get:function(){return this._parsing>0}},loaded:{get:function(){return this.batchCurCount?this.batchCurCount:this._loader._loadedFileCount}},total:{get:function(){return this.batchTotalCount?this.batchTotalCount:this._loader._totalFileCount}}});e.prototype.loadBatch=function(){var t=this;var r=function(r,a,n,s){r.inBatchLoadFlag=true;a.loaded=false;r.load(a.key,a.url,function(t,e){if(t)a.loaded=true;a.asset=t;a.dependenceAsset=e;if(a.callback)a.callback(a);for(var i=0;i<n.length;i++){if(!n[i].loaded){return}}r.inBatchLoadFlag=false;s(n)},a.override,a.isRaw)};return function(t,e){this.beginBatchLoad();for(var i=0;i<t.length;i++){r(this,t[i],t,e)}this.endBatchLoad()}}();e.prototype._internalLoad=function(t){var e=this;if(!t.retry)t.retry=0;t.isSound=O.isSound(t.url);if(t.isSound)t.url=e.game.sound.tryGetUrl(t.url);var i=t.url;if(!t.override){var r=e.find(i);if(r&&(!r.hasUnloadedDependence||!r.hasUnloadedDependence(this.game))){e._keyUrl[t.key]=i;if(t.key!=="__builtin_resource__"&&e.batchTotalCount&&e.batchCurCount<e.batchTotalCount){if(!t.inPrefab){e.batchCurCount+=1;e.game.log.trace("Asset {0} load from cache: {1} / {2}",i,e.batchCurCount,e.batchTotalCount)}}if(t.callback)t.callback(r);return}}if(t.key==="__builtin_resource__")return;if(D.assetDataMap&&D.assetDataMap[i])t.data=D.assetDataMap[i];if(D.__wx)O.wxReadAsset(e.game,t);var a=e._loader;if(t.retry===0){if(!e._complete[i])e._complete[i]=[t];else e._complete[i].push(t)}if(t.data){a.onFileComplete.dispatch(0,i,true);return}e.game.log.trace("Asset {0} ready to download from network.",i);if(t.isSound){if(i.indexOf(".bin")<0)a.audio(i,i);else if(O.isSound(i))a.binary(i,i)}else{if(t.isRaw)a.image(i,i);else a.text(i,i)}e.start()};e.prototype.load=function(){var t=this;var e,i,r,a=false,n=false,s=false;if(arguments.length===1){i=arguments[0]}else if(arguments.length===2){if(typeof arguments[1]==="string"){e=arguments[0];i=arguments[1]}else{i=arguments[0];r=arguments[1]}}else{e=arguments[0];i=arguments[1];r=arguments[2];a=arguments[3];n=arguments[4];s=arguments[5]}e=e||i;if(!i){throw new Error("url is empty.");return}var o={key:e,url:i,callback:r,override:a,isRaw:n,inPrefab:s};if(t.batchLoadFlag&&e!=="__builtin_resource__"){var h=t.assetCountMap[i]||1;t.batchTotalCount+=h}else if(!t.batchLoadFlag&&e!=="__builtin_resource__"){if(t.batchTotalCount&&t.batchCurCount>=t.batchTotalCount)t.batchTotalCount=t.batchCurCount=0}if(!t.game.phaser.state._created)t._internalLoad(o);else{t.game.timer.add(1,function(){t._internalLoad(o)})}};e.prototype.beginBatchLoad=function(){this.batchLoadFlag=true;this.batchTotalCount=0;this.batchCurCount=0};e.prototype.endBatchLoad=function(){this.batchLoadFlag=false};e.prototype.loadByUUID=function(t,e,i,r){var a=this;var n=this._uuid2UrlConf[t];if(!n){this.game.log.important("UUID({0}) not found.",t);if(a.batchTotalCount&&a.batchCurCount<a.batchTotalCount){if(!r){a.batchCurCount+=1;a.game.log.trace("Asset {0} load failed: {1} / {2}",t,a.batchCurCount,a.batchTotalCount)}}if(e)e();return}this.load(t,n,e,i,false,r)};e.prototype.loadTexture=function(){var t=this;var e,i,r,a;if(arguments.length===1){if(typeof arguments[0]==="string"){i=arguments[0]}else{r=arguments[0]}}else if(arguments.length===2){if(typeof arguments[0]==="string"&&typeof arguments[1]==="function"){i=arguments[0];a=arguments[1]}else if(typeof arguments[1]==="function"){r=arguments[0];a=arguments[1]}else{e=arguments[0];i=arguments[1]}}else if(typeof arguments[1]==="string"){e=arguments[0];i=arguments[1];a=arguments[2]}else{e=arguments[0];r=arguments[1];a=arguments[2]}e=e||i;if(r){if(!e){throw new Error("key cannot be null.");return}t._keyUrl[e]=e;var n=O.addAtlasFromImage(t.game,e,e,r);if(t.batchTotalCount&&t.batchCurCount<t.batchTotalCount){t.batchCurCount+=1;t.game.log.trace("Asset {0} loaded: {1} / {2}",e,t.batchCurCount,t.batchTotalCount)}a(n)}else{t.load(e,i,a,false,true)}};e.prototype.find=function(t){if(O.isSound(t))t=this.game.sound.tryGetUrl(t);if(pt.Util.isArray(t)){for(var e=0;e<t.length;e++){var i=this.find(t[e]);if(i)return i}}else{var r=this._keyUrl[t];return r?this._assets[r]:null}};e.prototype.unload=function(t){if(typeof t==="string"&&!this._keyUrl[t]){var e=O.isSound(t);if(e)t=this.game.sound.tryGetUrl(t)}if(pt.Util.isArray(t)){for(var i=0;i<t.length;i++){this.unload(t[i])}}else{if(typeof t==="string"){var r=this._keyUrl[t];if(r){if(this._assets[r]&&this._assets[r].unload)this._assets[r].unload(this.game);delete this._assets[r];delete this._keyUrl[t]}}else{this.unload(t.url)}}};e.prototype.findByUUID=function(t){for(var e in this._assets){var i=this._assets[e];if(i.uuid===t)return i}};e.prototype.cache=function(t,e,i){t=t||e;this._assets[e]=i;this._keyUrl[t]=e;this._keyUrl[e]=e};e.prototype.clear=function(){var e=this;var t=P.keys(_t.TextureCache);t.forEach(function(t){if(t!=="__default"&&t!=="__missing"&&t!=="__builtin_resource__"){_t.TextureCache[t].destroy();delete _t.TextureCache[t]}});t=P.keys(_t.BaseTextureCache);t.forEach(function(t){if(t!=="__default"&&t!=="__missing"&&t!=="__builtin_resource__"){delete _t.BaseTextureCache[t]}});var i=e._cache._images["__builtin_resource__"];e._cache.destroy();e._cache._images["__builtin_resource__"]=i;t=P.keys(e._keyUrl);t.forEach(function(t){if(t!=="__builtin_resource__")delete e._keyUrl[t]});t=P.keys(e._assets);t.forEach(function(t){if(t!=="__builtin_resource__"){if(e._assets[t]&&e._assets[t].unload)e._assets[t].unload(e.game);delete e._assets[t]}})};e.prototype.start=function(){var t=this;if(t.game.time.fixedTime-t._loaderTimerMutex<1)return;t._loaderTimerMutex=t.game.time.fixedTime;t.game.timer.add(1,function(){t._loaderTimerMutex=-1024;t._loader.start()})};e.prototype.addUrlConf=function(t,e){this._uuid2UrlConf[t]=e};e.prototype._parseAsset=function(o){var h=this,t=o;var l=h._complete[o];if(!l||l.length==0)return;var n=function(t){h=h;var e=this.key;var i=h._uuid2UrlConf[e];var r=h._complete[i];if(!r){console.warn("error url:"+i)}else{r[0].loadCnt--;if(r[0].loadCnt==0){if(D["printingloading"])console.log("依赖资源加载完成:"+i);h._parseAsset(i)}}};var e=function(t,e){h._parsing--;var t=t;for(var i=0;i<e.length;i++){var r=e[i];if(D["printingloading"])console.log("loadDependenceRaw:"+t+" "+r);var a=r.indexOf(".png")>-1||r.indexOf(".jpg")>-1;h.load(t,r,n,false,a,true)}};var i=function(){h._parsing--;var s=h.find(o);if(s&&(s.meta.type!==O.ASSET_SCENE||h.inBatchLoadFlag)&&s.hasUnloadedDependence&&s.hasUnloadedDependence(h.game)){for(var t in s.dependences){var e=s.dependences[t];var i=function(n){var n=n;return function(t,e,i){if(!t&&!e){h.game.log.important("预制的依赖资源({0})加载失败.",n.uuid);var r=s.dependences[n.uuid];if(r)r.ok=true}if(h.inBatchLoadFlag&&!i){var a=h._complete[o];if(a){if(a[0]&&a[0].callback){a[0].callback(null,t,true)}}}if(s.hasUnloadedDependence(h.game))return;h._callCb(o,s,l[0])}};var r=true;if(h.inBatchLoadFlag)r=false;h.loadByUUID(e.uuid,i(e),false,r)}return}h._callCb(o,s,l[0])};h.nextStep=i;h.loadDependenceRaw=e;h._parsing++;try{O.parse(this.game,l[0],i,e)}catch(t){h._parsing--;h.game.log.error("Asset({0}) Parse fail",o,t);pt.Util.popupError(t.message);h._callCb(o,null,l[0])}};e.prototype._callCb=function(e,i,t){var r=this;var a=r._complete[e];if(!a)return;delete r._complete[e];a.forEach(function(t){if(i){r._keyUrl[t.key]=t.url}if(r.game.loadingProcessCallback){if(!t.inPrefab)r.game.loadingProcessCallback(e,i,t)}if(r.batchTotalCount&&r.batchCurCount<r.batchTotalCount){if(!t.inPrefab){r.batchCurCount+=1;if(i)r.game.log.trace("Asset {0} loaded: {1} / {2}",e,r.batchCurCount,r.batchTotalCount);else r.game.log.trace("Asset {0} load failed: {1} / {2}",e,r.batchCurCount,r.batchTotalCount)}}if(t.callback)t.callback(i)})};e.prototype._loadBuiltin=function(){var t=this;var e="__builtin_resource__";var i="iVBORw0KGgoAAAANSUhEUgAAAIAAAABACAYAAADS1n9/AAAURElEQVR4Xu1cCVRUR9au1w2NrL8LAoIoEFBJ0w8QIioJRBRB1BE1qCCLBCUaEyMBo6AnYlSYqIjGOaNxieKekBicIKIoZnFQiUjTiKgoIAoBo8ggi2z95tyXLv62pbtfb7Q61DkegXer6ta9X92qunVvEUiFQpLkSDabPUFfX5+HELJqbGy0pijqoYmJyROhUHitra2ttKOjI6ekpKRdhW5eqEpRFIEQGokQMlSx3WaE0C2CICim7URERERdu3ZtfF1dnUlTUxPTajSdkZERMjc3bxw9enReWlraPqaVeTzeBQ6H83ZHR4cOi8VCHA6HaVWUn58PspJaZH6U10sfAF5+AIAOZYFAYQC4uLi4GBgYLGltbQ1yc3Mb4Ofnh7hcLiIIAo0aNYrGzM2bNxFFUejKlSvo7NmzHaWlpVcJgthlb29/JD09vUsesOR937x5c3Z2drZfeXk5evLkiTzyHr8PGDAA2dnZIX9//zMrVqzwl9dIXFycz9GjRzdyOBz9hIQEWzs7O30Oh0PAOJkUkE97eztVXl7empSUVNHe3t4aEhKyesuWLbnS6ru6unoJhcKzlpaWeqGhoSgkJIRJVy/QENC5lMIYACRJ2hobG39tb2/vu2TJEuTh4aEQM7m5uSg1NfXhgwcPPuLz+ekKVRYRx8bGzjpy5MjxpqYm3bCwMDR9+nRka2uLwCyCIuQpA+QA/4RCIaqoqEA//fQTOnToEJjmjpCQEK+tW7de7omvNWvWOKSkpBxZt26dmZ+f3xCEEAf6VKZA3wih9jNnzvyxdu3ah7GxsfM3bNhQJtnWmDFjRrS3t99cu3YtERgYqExX3XVUBsDEiRO36+rqfrR48WLWjBkzVGLmwIED6JtvvrldX1/vW1JSUsW0sYSEBDI1NZUfFRVFzJ07F5mZmdGKh3+SAJcEQk/fQRHw7+HDh+jbb79F+/bto2JiYqySkpL+kOTJxsbmzOzZs4eHh4fbcTgcXfxdHuAk2xHno729vePgwYPlP/zww73Kyko/SVoej/d4xowZAxMTE1FHRwc9TswzU5lhOkNDQ+UsAJfLNTI1NT3v7e09BhgRHwAMvqur6zmmROimmYWCFcRms1+oGxkZ2czn86cXFRVdYDIge3v7/4wbN85kw4YNNLmuri6CdiXbFm8L+O1JSZh34B+EC2XNmjXo0qVLjXfu3Pk/sTa+gp8DAgJ8N2/eDBtcQ2VnvuQYQVYEQTSvWLHiflZW1gHR9y/d3d3pGfbGG29k7N+/n/6zokCT7EspAHC5XIv+/ftfmzlz5pDY2NjuNkFonZ2dtPIVKaAoHR0dWmG4xMbGCnNzcz/g8/l7ZbSVBt8sLS3DL1++TLcBu2A9PT26LawQGcvcc01jYYICYAxtbW2wNtNjGjt2LKqpqfm7qEI8Qugq/Hzjxg03aWBSRAY9WQTg58033ywQfXN3dnb+N/ycl5f3iCCIaTCPeh0AXC6XM2TIkBsBAQFvxMTEdKMQhIVnubIDB4WB8rDC4uLiqPPnz8/i8/kZUtqkd1lbt25F8+fPR/369XtO+XhdV4QfvF8QB8GzZ8/QkSNH0KeffoqbArNJA6C0tNSFoqj/R64incmhJQiiy9HRkY8BwOPxauDny5cv1xEE4aIVC+Dn55c1fvz4KZ9//jnNF54hahx390yGNhcsWNBRWFjIEwgEt3rogwbA1atX0ciRI1+Y+aryJA6CW7duIXd39xcAcPPmTRehUKgRALBYrK5Ro0aJA+ChCAA1BEE4Y2ZUsQIKLQF+fn7LjY2NU7/77jt6lsKsV9TcM1UKmHCwBjC4CRMmlJuZmY3o4ZhIA+Dx48fI2Nj4ObPPtB95dBgET58+RYMGDdIqAEiSvCECwFqE0He9CgAulzvQ2tq6ZtmyZXpTpkxBYBZVNfnyhA9LAph12Ilv3rw5rqCgIEWiDg0AUI6+vn6Pu355fcj7DgCEcba2ttIgE5XuJaA3LYCbm9sqUf/JFy9e7N4A9ooFIElyu7e397KvvvpKI2ZfmiLwxm7mzJlPy8rKTCVcxzQAWlpaaGuhrl24JC8AALB2BgYGWgUA7pwkybbY2FjOnDlzVJ6EjJaAcePG6ffv379h3bp1nNGjR9PC6M0Cyv3tt99QTExMNJ/P3yPWNw0AsEZw9NMkAOBICNZImxYAd/7WW29FdnR0fLNr1y7k7OzMyNElTV+MAODt7R2MEDr6888/06ZQFZOjDHBgvwEm3sPDoyQ/P99JEgAASAAA0+OeojzAeAEAAMSXAQDAg4uLy0aKolZ5enqyVq1ahQYPHqyUXgwMDOQ7gsLCwi7Y29u/Gx8f3+0cUVSIqtCDYmEpWLp0KZWXl2cKbZWUlNSDHwR+hpMIAECTBQAgdtOmlT2A5Pi8vLysnzx5UkAQxGCQD3hAxUDKSBwnT56UD4DZs2c3RkZGGk+cOFHlNYcRVz0QgXnPzMxEGzduBAcI4vP5pzAAwFEj7kRStg9Z9eC0A0J+WSwA8KEqAGQpH9onYOcPP1haWj5OTU0FF6RWAXD37l0UHh6+CXi6du3aSgwAmJ1iytGE/mlvoJiV0YojSCMDk9Eo4ezsPAa+6+joXMnOzkaGhoZKrTPqYByWgebmZuTr63taZAECMABgdmpqA4h5h5OAmJXpBsDt27dHd3V1Mb76ZSoLGC+bzaZGjBhxTVSH9kJRKm7AZN3+SfJGODk5+Yr+eBZ87fhqlekg1EmH/e1jx469BO0WFxePfxkAkJGRYWdjY2PSr18/trr8IiDnZ8+edVVWVjYGBgaWYwCoqvzu9YvhbplwcXGZCpU6OzszXyIAFIoAMBoDAK6R582bp/AGiClA4ZRx/PhxcEt3y/CDDz7wgl+ysrL+8eOPP9oaGhoaqTg5u9kRWbummTNnVgQEBHwEH77++utfex0APB7PGzrncDg/v0RLwK+iJcDbx8fnB/j54sWLsxobGzUKABMTE/T222+fgP5yc3NnY21ZWVldWLhw4fDAwMBhYAVEZpoptp6jwxMTZn9GRkbV3r1771VXV0/ARL0OAFdX1zehc3Nz85JNmzYhBwcHrW4Cy8rKUFRU1HHg6ffffwffBF2GDRv2dNKkSUY7d+6k+RNz2CilCFwJHExgjiHK6dy5c01VVVXdvmBMs3LlyvG7du3aFh8fb+7r62uhq6vLYWhhX+BN5G9oz8nJqU1OTq5bvHjx8i+//DJPawCAq1/onCTJZ/PmzSMmT56sNQDABgys0Pr16+OAJ/F7AYjb271796ng4GAWxCfY29urpHhc+c6dOyglJQUdO3ZMGB0dPRXiDXtqGMcEGhgYGMbHx9vY2trqw6mE6Z4AQAanjIqKitbk5OTKlpaW5p5iAnvdAuDBfvjhh9WDBg2yXL16NT0oda11TLUEMwqEBB6vCxcu0AGHRUVF+eL1RTGBx5qbmzkQjArX1TweRKQrXoqLi9EXX3yBzpw5Ayef9vnz5wenpKTQ5l9aiY6O1m1ra4u8evWq559//mmgTFj44MGDW9zd3f+tp6e3f/fu3X+FI4kVrQHg/fff33v37t2onJwcGqnaAADMKG9v72dDhw41Apn0FEGcmJjIqa6uTrx3715kS0uLBVwSKVPg0sfAwKB2+PDh+62srBITExPl5i681gDg8Xhu9vb2V5cvX05H/GoqBkCassD85+fngwX4V15entTIU20CQBmgKVpHaxYAGOVyuVXvvvuuNYRfAQB6ywqIHCIoOjoavH/uxcXFOEZOUfm9MvQ8Hi+SIIi5XV1dfxO//tYqAHx8fIIHDRp0FBIQICCkt6wAzP7Tp0+jbdu2CX755ZfuMChp2oyIiFhTWFjoX1dXN1CZddjc3Lze1dU1Oy0t7a8QYy0UcQBA9xgEWgUAMBITE3OzpqZmJDheoDDd5SorQ+zenTt3LlVVVTWaz+fj+DipTb7qAODxeIcIgggVDXAp/C8QCP4J/2sdAOAX8PT0FJiamrLhaljZZAQmgMB5A+vXr4c0sn05OTkLZdWDU8Dhw4ePNjc368EpYOPGjXSgqCIFAj/hpCPa/beFhoaGyNv9K9K+PFqSJJchhLaL0dHZSAKBYNxLAQBgIiQkJBwhlObi4oI++eQTjYAAK3/79u1w9r9dV1fHk5VFLMoMKoyKimIBMC0tLeXJWub3mpoalJycDBlBwpiYGNekpCSBSg0yqMzj8bwIgoBEGPG8MvqoKxAI6KOv1i0AHseCBQtSqqurP4WZ9vHHH6sVBFj5O3bsQCdOnHjc2trqWFhY+KcsGdrY2PzxzjvvWBw8eJCBqJmThIeHQyhabWVlJeT8aaw4OTmZs1isSoRQd8wZQqitq6uLRrIo+OXlAQAwFRwcvImiqBWQ9bty5cruxEplTwfY2QP1k5KSIPulvLa21rOkpKRWhuTpiCCY8dXV1TQZDt9SZnnC4BMPL7OysoKMIMwC44RZRdBCkiTkHFqI1yEIYnZRUdFzzqeXxgJgRidPnjzfwcHhwKNHj3TgNi4gIOA5T6E8MGCfOVZ+VlYWOnz4MGpqajrd2Ng4+9KlS61yBEkDAOpAZhBO51JE+NJocXoZZARB+rWoqB0AJEleRAh5ivNBUdSPxcXFsyR5e+kAAAzCxtDLy+tIRUWFi7W1NX0tO2bMmBdi1jEYxJUO9eF3cPIcPXoU3b59u5kgiBXnzp3byVCJNADu378PF1Zqj1cES1BXV4dgXJoAAEmS2xBCn0iM9ZFAIBgsbfyqgkChgBCGSqDJxo4dO8nDw2P/vXv3htbX1yMfHx96Fw5LBJhWR0dHmq60tJS2EvBQBOy6z58/D27XdhaLldrQ0LCOwax/brLALzhDSZ7FUWQ8GJw4Q0kaAMBLShCEp0Ag+AecjJn24ezsHEpR1CEJeqFQKHS9fv26xjedTPhUytzB0zCenp5LdXV1ZzQ0NAyDtC1QOMTzwWyHlzfgd1NT02YdHZ3fqqqqdpqamp5S8nWQ7qhgTdxR4GhkiWhgWnb4ppTNZuMkCbgpfE8gEMDbQjKLk5MTyWKxINRLMqdwnUAgSJRVOSgiZAmiqOUIdfqmH0zv8Q2FoPDgZITQVETpzEg/dKhCHj/SvisFAMnGnJ2drYRCoQVFUQMJgoBQ7vZiuG5TT9EaAHg8HgSlAqhxyjj8ms9ms6fJOrXAuwpsNhs2tpKPWAkEAoFMTyetfCgKAADIlQVBHwBE+Qg9WQAej0c/ekQQBNxNdOeMIYRgxk0UCAQ9zjySJO8ihOwk8E8f+fBxT9rcCAoPpsPhIC8EIaIKoY53JK1AUETwBkSh1YhAN3TakQ8QHzt2rE6Z+aYWACjTsQJ1tGYBMI9OTk7WLBarBCEkHi1Uz2Kx/Pl8/u/iY+HxeJkEQdBxluKlpyNfTzIICgqir8KRvk4mQshbEgRBEcHrEIUgb78AsTunpO9Pl+k/kSfnHgFQW1trePDgwdgrV65MKykpcYSNl6IhULgOl8st9fDwyAwPD0+xsLCQu3b2wLDWAQA8iRw5pQihAWI8thIEMaeoqAiUBVFVsLZDWvdzRdqRT5ZygoKCOEhf5wjsOTAIEKETJVL+JdSvc0r67vT/yFOwvO99AJCxBEgKD5Jo2Gw2PGJBp66JShdFUR+yWKwGiqIgllFSpjKPfPIUFBQ+bwdCBEQNg7Lh/aJc1No5Iz09XbFHCqV09AIA0tLSQrds2bIjLCysv5OTE72jlzb75b2bA1YA3vK7fv06PMfWEBcX93FERMRheYOWnEDwO36rQBPHQPxGgahfmcuiaIMHIJC8jIBHkyR3/Go58gWFBcN6D+t+NnrWOSs9PV2e84yxiJ8b7KJFizKNjIyeBAYGhlpYWKiUkow5wG/41NbWooyMjMNNTU0D9uzZQ+f+MSz0EgD3/ppIWgH+4MgKz7gyAQDQwPFQZAls5IxB7pGPoQzQnPCQSVRrx6/p6elyQ9eYtgl03QDYtGnT5w8fPrRbtGhRBH5ESV2zDYMA/t+zZ0+amZlZ+WefffYFQ0ZpAED0Lvjs1R2fAKCCOwaxKGNGG2MRCCB24S/v14tF7pGP4fhpMo0BoKyszAQ6mDZtWvX3339vBK5RdQsZDxSEDUme7733XlNmZqYV/N3BwaFRjiBoAODMIHVGLOP7CcmMIEUUQ5JkEez/JOowOvIp0o+maAmY+aLG18EroOoUsCTTWOAnT56ET/RuWZ4liIqKmg50hw4d+hdkBuH3fNQhEPzKKGQEhYWF/Q3a3Ldv30+Ktk2SJOQyjsX1mB75FO1HE/TE1KlTaY9dTEyM09ChQzU2+8WtwIMHD+Dd4Ovwt1OnTjEK7Le0tHzi7+/fH2cG4WVKGaHgJQlnBGVnZzfU1NSIH+8UbpYkyRyE0CRljnwKd6bGCoSbmxvtQdq7d68ZpFupa92XxiMIH3b0CxcupN/DKygoMGcyHsnMILi9UwYEWPlwu8gkI4gJb5jG2dn570VFRfiVL0Wqao2WcHV1pT1JBw4cMAV3aG8AAJ57WbBgwSPot7CwUOq1qKRUcExgS0sLHRMImUH4iXqmEoQbSpwRZGBgoNaYwFcSAK/KEoAVDIkh5eXlCQUFBVMePXpkrExYuKmp6VM3N7fTdnZ2SUwygpiC61WkI5KSkjYC43p6egnTpk3TeC4A3L3DO0BtbW1J0G9CQsJqRQTXBwBFpCWflqioqOgPZP7+/vdPnDgB15ga2wjCpgtCumbNmtWUnZ1Nh+DY2to2yGezj0JTEuh2eoAlqK+vt+oNR9DAgQOrFZ35mhLA/3q7r4Ir+H9dRxodv8zLIJIk6csgVQpcBgkEAlUug1Tpvq+uHAnIvA7Oy8sLLC0tdVBFio6OjmXjx4/PUCEeQJXu++r2AaAPA7IkwOjmq0+Er68E+gDw+uqW0cj6AMBITK8vUR8AXl/dMhpZHwAYien1JeoDwOurW0Yj+y97o2/XSZsB1wAAAABJRU5ErkJggg==";var r={ver:1,uuid:e,padding:{"button.png":[10,9,10,9],"button2.png":[10,9,10,9],"slider.png":[12,10,12,10],"sliderbg.png":[13,7,13,7],"sliderbg2.png":[14,0,0,0]}};var a=JSON.parse('{"frames":{"circle.png":{"frame":{"x":1,"y":1,"w":37,"h":37},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":37},"sourceSize":{"w":37,"h":37}},"sliderbg.png":{"frame":{"x":1,"y":41,"w":30,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":30,"h":16},"sourceSize":{"w":30,"h":16}},"slider.png":{"frame":{"x":41,"y":1,"w":28,"h":24},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":28,"h":24},"sourceSize":{"w":28,"h":24}},"button.png":{"frame":{"x":41,"y":28,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"button2.png":{"frame":{"x":72,"y":1,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"ok.png":{"frame":{"x":72,"y":27,"w":25,"h":22},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":25,"h":22},"sourceSize":{"w":25,"h":22}},"sliderbg2.png":{"frame":{"x":101,"y":1,"w":19,"h":14},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":19,"h":14},"sourceSize":{"w":19,"h":14}},"empty.png":{"frame":{"x":101,"y":18,"w":16,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":16,"h":16},"sourceSize":{"w":16,"h":16}},"arrow.png":{"frame":{"x":101,"y":37,"w":12,"h":7},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":12,"h":7},"sourceSize":{"w":12,"h":7}}},"meta":{"app":"QCEngine","version":"1.0","image":"__builtin_resource__","format":"RGBA8888","size":{"w":128,"h":64},"scale":"1"}}');t._parsing++;O._parseAtlas(this.game,r,a,i,C,r.uuid,e,function(){t._parsing--;t._callCb(e,t.find(e))})};var i=pt.Atlas=function(t,e,i,r,a){this.key=e;this.url=e;this.meta=r;this.animation=C;this.json=C;this.img=C;this._data=i;if(a){this.animation={type:r.animationType,data:a}}};i.prototype.constructor=i;P.defineProperties(i.prototype,{count:{get:function(){return this._data.frameData.total}},frames:{get:function(){return this._data.frameData._frames}},frameNames:{get:function(){var t=this.frames;if(!t||t.length<1)return[0];var e=[];for(var i in t){e.push(t[i].name)}return e}},uuid:{get:function(){return this.meta.uuid}},class:{get:function(){return"qc.Atlas"}}});i.prototype.getFrame=function(t){if(typeof t==="number")return this._data.frameData.getFrame(t);return this._data.frameData.getFrameByName(t)};i.prototype.getTexture=function(t){return new pt.Texture(this,t)};i.prototype.getPadding=function(t){if(!this.meta||!this.meta.padding)return[0,0,0,0];if(this.count==1){var e=P.keys(this.meta.padding);t=e.length>0?e[0]:0}if(t===C)t=0;var i=this.meta.padding[t];if(i){i[0]*=1;i[1]*=1;i[2]*=1;i[3]*=1}return i||[0,0,0,0]};i.prototype.unload=function(t){t.assets._cache.removeImage(this.key,false);delete _t.TextureCache[this.key];delete _t.BaseTextureCache[this.key]};var r=pt.Texture=function(t,e){var i=this;i.atlas=t;i.frame=e||0};r.prototype.constructor=r;P.defineProperties(r.prototype,{padding:{get:function(){return this.atlas.getPadding(this.frame)}},class:{get:function(){return"qc.Texture"}}});var s=pt.Prefab=function(t,e,i,r){this.key=t;this.url=e;this.meta=r;this.json=i};s.prototype.constructor=s;P.defineProperties(s.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}});s.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(i.ok)continue;if(i.uuid===this.uuid)continue;var r=t.assets.find(i.uuid);if(!r)return true;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return true;i.ok=true}return false};var a=pt.Font=function(t,e,i,r,a){this.key=t;this.url=e;this.meta=a;this.xml=r;this.image=i;this._fontUrl;this._fontFamily=pt.UIText.SYSTEMFONT};a.prototype.constructor=a;P.defineProperties(a.prototype,{uuid:{get:function(){return this.meta.uuid}},xSpacing:{get:function(){return this.meta.xSpacing}},ySpacing:{get:function(){return this.meta.ySpacing}}});a.prototype.unload=function(t){t.assets._cache.removeBitmapData(this.key);t.assets._cache.removeBitmapFont(this.key)};var n=pt.SoundAsset=function(t,e,i,r){this.key=e;this.url=e;this.meta=r;this.sound=i};n.prototype.constructor=n;P.defineProperties(n.prototype,{uuid:{get:function(){return this.meta.uuid}}});n.prototype.unload=function(t){if(D.__wx){this.sound.destroy()}t.assets._cache.removeSound(this.key)};var u=pt.TextAsset=function(t,e,i,r){this.key=e;this.url=e;this.meta=r;this.text=i};u.prototype.constructor=u;P.defineProperties(u.prototype,{uuid:{get:function(){return this.meta.uuid}}});u.prototype.unload=function(t){t.assets._cache.removeText(this.key)};var d=pt.ExcelAsset=function(t,e,i,r){this.key=e;this.url=e;this._meta=r;this._data=typeof i==="string"?JSON.parse(i):i;this._sheets={};this._makeSheetData()};d.prototype.constructor=d;P.defineProperties(d.prototype,{uuid:{get:function(){return this.meta.uuid}},sheetsName:{get:function(){return this._sheets?P.keys(this._sheets):[]}},sheets:{get:function(){return this._sheets}},meta:{get:function(){return this._meta}}});d.prototype._makeSheetData=function(){var t=this._data?P.keys(this._data):[];for(var e=0;e<t.length;e++){var i=t[e];var r=this._data[i].rows;var a=this._data[i].cols;var n=this._meta[i]?this._meta[i].primaryKey||[]:[];var s=new pt.ExcelSheet(a,r,n);this._sheets[i]=s}};d.prototype.findSheet=function(t){return this.sheets[t]};d.prototype.unload=function(t){};d._EXCEL_DATE_OFF=-22089888e5;d._TIMEZONE_OFF=(new Date).getTimezoneOffset()*60*1e3;d.parseToDate=function(t){return new Date(d._EXCEL_DATE_OFF+t*864e5+d._TIMEZONE_OFF)};var _=pt.ExcelSheet=function(t,e,i){this._cols=t||[];this._rows=e||[];this._indexes={};this._primaryKey=i;this._buildPrimaryIndex()};_.prototype.constructor=_;P.defineProperties(_.prototype,{columns:{get:function(){return this._cols}},rows:{get:function(){return this._rows}}});_.prototype._buildPrimaryIndex=function(){this.addSortIndex("primary",this._primaryKey)};_.prototype.addSortIndex=function(t){var e=this;var i=Array.prototype.slice.call(arguments,1);var r;if(Array.isArray(i[0])){r=new pt.ExcelSortSheetIndex(this,i[0])}else{r=new pt.ExcelSortSheetIndex(this,i)}this._indexes[t]=r;return r};_.prototype.addHashIndex=function(t,e,i){var r=new pt.ExcelHashSheetIndex(this,e,i===C||i);this._indexes[t]=r;return r};_.prototype.getIndex=function(t){return this._indexes[t]};_.prototype.getPrimary=function(){return this.getIndex("primary")};_.prototype.find=function(t){var e=this._rows;var i=e.length;var r=-1;while(++r<i){if(t(e[r])){return r}}return-1};_.prototype.findLast=function(t){var e=this._rows;var i=e.length;while(i-- >0){if(t(e[i])){return i}}return-1};_.prototype.matches=function(t){var e=this._rows;var i=e.length;var r=-1;var a=[];while(++r<i){if(t(e[r])){a.push(r)}}return a};_.prototype.parseColumnToData=function(t){var e=this._rows;var i=e.length;var r=-1;var a=[];while(++r<i){if(t in e[r]){e[r][t]=d.parseToDate(e[r][t])}}return a};var g=pt.ExcelSortSheetIndex=function(t,e){this.sheet=t;this._keys=e;this._buildIndex()};g.prototype={};g.prototype.constructor=g;P.defineProperties(g.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}}});g.prototype._buildIndex=function(){var i=this;var r=this.sheet.columns.slice(0);if(this._keys){for(var t=0;t<this._keys.length;t++){var e=r.indexOf(this._keys[t]);r.splice(e,1)}Array.prototype.unshift.apply(r,this._keys)}i._cols=r;i._rows=this.sheet.rows.slice(0);i._rows.sort(function(t,e){i._rowCompare(r,t,e)})};g.prototype.first=function(){var t=arguments.length;if(t===0)return 0;var i=this;return this._dichotomySearchFirst(this._rows,arguments,function(t,e){return i._searchCompare(t,e)})};g.prototype.last=function(){var t=arguments.length;if(t===0)return 0;var i=this;return this._dichotomySearchLast(this._rows,arguments,function(t,e){return i._searchCompare(t,e)})};g.prototype.matches=function(){var t=arguments.length;if(t===0)return[0,this._rows.length];var i=this;var e=this._dichotomySearchFirst(this._rows,arguments,function(t,e){return i._searchCompare(t,e)});if(e<0){return null}var r=this._dichotomySearchFirst(this._rows,arguments,function(t,e){return i._searchCompare(t,e)},e);return[e,r]};g.prototype._cellCompare=function(t,e){if(!t){if(!e)return 0;else return 1}if(!e)return-1;if(t===e)return 0;else if(t<e)return-1;else return 1};g.prototype._searchCompare=function(t,e){if(!e){return 1}var i=this._cols;var r=t.length;var a=-1;var n;while(++a<r){n=this._cellCompare(t[a],e[i[a]]);if(n>0)return 1;else if(n<0)return-1}return 0};g.prototype._rowCompare=function(t,e,i,r,a){if(!t){if(!e)return 0;else return 1}if(!e)return-1;r=r||0;var n=r+(a||i.length-r);var s,o;for(var h=r;h<n;h++){s=i[h];o=this._cellCompare(t[s],e[s]);if(o===0)continue;return o}return 0};g.prototype._dichotomySearch=function(t,e,i){var r=0;var a=t.length-1;var n=0;var s=0;while(r<=a){n=Math.floor((r+a)/2);s=i(e,t[n]);if(s<0){a=n-1}else if(s>0){r=n+1}else{return n}}return-1};g.prototype._dichotomySearchFirst=function(t,e,i,r,a){var r=r||0;var a=a||t.length-1;var n=0;var s=0;while(r<a){n=Math.floor((r+a)/2);s=i(e,t[n]);if(s<=0){a=n}else{r=n+1}}if(i(e,t[r])===0){return r}return-1};g.prototype._dichotomySearchLast=function(t,e,i,r,a){var r=r||0;var a=a||t.length-1;var n=0;var s=0;while(r<a){n=Math.ceil((r+a)/2);s=i(e,t[n]);if(s<0){a=n-1}else{r=n}}if(i(e,t[a])===0){return r}return-1};var m=pt.ExcelHashSheetIndex=function(t,e,i){this._buildIndex(t,e,i)};m.prototype={};m.prototype.constructor=m;P.defineProperties(m.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}},keys:{get:function(){return this._keys}}});m.prototype._buildIndex=function(t,e,i){var r=t.rows;this._rows=r;this._cols=t.columns.slice(0);this._keys=[];var a=r.length,n=-1;while(++n<a){var s=r[n];var o=s[e];if(i){this[o]=s;this._keys.push(o)}else{if(o in this){this[o].push(s)}else{this[o]=[s];this._keys.push(o)}}}};var y=dt.Loader.prototype.fileComplete;dt.Loader.prototype.fileComplete=function(t,e){if(!this.game.cache)return;y.call(this,t,e)};var v=pt.ActionAsset=function(t,e,i,r){this.key=e;this.url=e;this.meta=r;this.json=i};v.prototype.constructor=v;P.defineProperties(v.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}});v.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(i.ok)continue;if(i.uuid===this.uuid)continue;var r=t.assets.find(i.uuid);if(!r)return true;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return true;i.ok=true}return false};var T=pt.ActionManagerAsset=function(t,e,i,r){this.key=e;this.url=e;this.meta=r;this.json=i};T.prototype.constructor=T;P.defineProperties(T.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}});T.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(i.ok)continue;if(i.uuid===this.uuid)continue;var r=t.assets.find(i.uuid);if(!r)return true;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return true;i.ok=true}return false};var x=pt.Math=function(t){this.phaserMath=dt.Math;this.arrayUtils=dt.ArrayUtils;this.phaserRnd=t};x.prototype={};x.prototype.constructor=x;x.prototype.fuzzyEqual=function(t,e,i){return this.phaserMath.fuzzyEqual(t,e,i)};x.prototype.shuffle=function(t){return this.arrayUtils.shuffle(t)};x.prototype.fuzzyLessThan=function(t,e,i){return this.phaserMath.fuzzyLessThan(t,e,i)};x.prototype.fuzzyGreaterThan=function(t,e,i){return this.phaserMath.fuzzyGreaterThan(t,e,i)};x.prototype.fuzzyCeil=function(t,e){return this.phaserMath.fuzzyCeil(t,e)};x.prototype.fuzzyFloor=function(t,e){return this.phaserMath.fuzzyFloor(t,e)};x.prototype.average=function(){return this.phaserMath.average.apply(null,arguments)};x.prototype.shear=function(t){return this.phaserMath.shear(t)};x.prototype.snapTo=function(t,e,i){return this.phaserMath.snapTo(t,e,i)};x.prototype.snapToFloor=function(t,e,i){return this.phaserMath.snapToFloor(t,e,i)};x.prototype.snapToCeil=function(t,e,i){return this.phaserMath.snapToCeil(t,e,i)};x.prototype.roundTo=function(t,e,i){return this.phaserMath.roundTo(t,e,i)};x.prototype.floorTo=function(t,e,i){return this.phaserMath.floorTo(t,e,i)};x.prototype.ceilTo=function(t,e,i){return this.phaserMath.ceilTo(t,e,i)};x.prototype.angleBetween=function(t,e,i,r){return this.phaserMath.angleBetween(t,e,i,r)};x.prototype.angleBetweenY=function(t,e,i,r){return this.phaserMath.angleBetweenY(t,e,i,r)};x.prototype.reverseAngle=function(t){return this.phaserMath.reverseAngle(t)};x.prototype.normalizeAngle=function(t){return this.phaserMath.normalizeAngle(t)};x.prototype.maxAdd=function(t,e,i){return this.phaserMath.maxAdd(t,e,i)};x.prototype.minSub=function(t,e,i){return this.phaserMath.minSub(t,e,i)};x.prototype.wrap=function(t,e,i){if(e<i)return this.phaserMath.wrap(t,e,i);return this.phaserMath.wrap(t,i,e)};x.prototype.wrapValue=function(t,e,i){return this.phaserMath.wrapValue(t,e,i)};x.prototype.isOdd=function(t){return!!this.phaserMath.isOdd(t)};x.prototype.isEven=function(t){return!!this.phaserMath.isEven(t)};x.prototype.min=function(){return this.phaserMath.min.apply(null,arguments)};x.prototype.max=function(){return this.phaserMath.max.apply(null,arguments)};x.prototype.wrapAngle=function(t,e){return this.phaserMath.wrapAngle(t,e)};x.prototype.linear=function(t,e,i){return this.phaserMath.linear(t,e,i)};x.prototype.factorial=function(t){return this.phaserMath.factorial(t)};x.prototype.getRandom=function(t,e,i){return dt.ArrayUtils.getRandomItem(t,e,i)};x.prototype.distance=function(t,e,i,r){return this.phaserMath.distance(t,e,i,r)};x.prototype.clamp=function(t,e,i){return this.phaserMath.clamp(t,e,i)};x.prototype.within=function(t,e,i){return this.phaserMath.within(t,e,i)};x.prototype.sign=function(t){return this.phaserMath.sign(t)};x.prototype.degToRad=function(t){return this.phaserMath.degToRad(t)};x.prototype.radToDeg=function(t){return this.phaserMath.radToDeg(t)};x.prototype.random=function(t,e){if(typeof t==="undefined"||typeof e==="undefined")return this.phaserRnd.frac();if(t>e)return this.phaserRnd.integerInRange(e,t);return this.phaserRnd.integerInRange(t,e)};x.prototype.uuid=function(){return this.phaserRnd.uuid()};x.prototype.id=function(){var t=1;return function(){return++t}}();x.prototype.invert=function(t,e){var i=e[0],r=e[1],a=e[2],n=e[3],s=e[4],o=e[5],h=e[6],l=e[7],u=e[8],f=u*s-o*l,c=-u*n+o*h,p=l*n-s*h,d=i*f+r*c+a*p;if(!d){return null}d=1/d;t[0]=f*d;t[1]=(-u*r+a*l)*d;t[2]=(o*r-a*s)*d;t[3]=c*d;t[4]=(u*i-a*h)*d;t[5]=(-o*i+a*n)*d;t[6]=p*d;t[7]=(-l*i+r*h)*d;t[8]=(s*i-r*n)*d;return t};x.prototype.multiply=function(t,e,i){var r=e[0],a=e[1],n=e[2],s=e[3],o=e[4],h=e[5],l=e[6],u=e[7],f=e[8],c=i[0],p=i[1],d=i[2],_=i[3],g=i[4],m=i[5],y=i[6],v=i[7],T=i[8];t[0]=c*r+p*s+d*l;t[1]=c*a+p*o+d*u;t[2]=c*n+p*h+d*f;t[3]=_*r+g*s+m*l;t[4]=_*a+g*o+m*u;t[5]=_*n+g*h+m*f;t[6]=y*r+v*s+T*l;t[7]=y*a+v*o+T*u;t[8]=y*n+v*h+T*f;return t};x.prototype.smoothDamp=function(t,e,i,r,a,n){r=Math.max(1e-4,r);var s=2/r;var o=s*n;var h=1/(1+o+.48*o*o+.235*o*o*o);var l=t-e;var u=e;var f=a*r;l=this.clamp(l,-f,f);e=t-l;var c=(i+s*l)*n;i=(i-s*c)*h;var p=e+(l+c)*h;if(u-t>0&&p>u){p=u;i=(p-u)/n}return[p,i]};pt.CleanPIXISpriteRetainer=function(t,e){this._frameCount=0;this.game=t};pt.CleanPIXISpriteRetainer.prototype={postRender:function(){this._frameCount++;if(this._frameCount<100)return;this._frameCount=0;var t=this.game.phaser.renderer;if(!(t instanceof _t.WebGLRenderer))return;var e=t.spriteBatch.sprites;var i=t.spriteBatch.currentBatchSize;var r=e.length;for(var a=i;a<r;a++){e[a]=null}}};pt.CleanPIXISpriteRetainer.prototype.constructor=pt.CleanPIXISpriteRetainer;var A=pt.NodePool=function(t){this._game=t;this._nodes={};this._nameUuidMap={}};A.prototype={};A.prototype.constructor=A;P.defineProperties(A.prototype,{game:{get:function(){return this._game}}});A.prototype.add=function(t,e){if(this._nodes[t]){this.game.log.error("uuid {0} already exists",t)}this._nodes[t]=e;if(e.uniqueName&&!this._nameUuidMap[e.uniqueName])this._nameUuidMap[e.uniqueName]=t};A.prototype.remove=function(t){if(this._nodes[t]){if(this._nodes[t].uniqueName)delete this._nameUuidMap[this._nodes[t].uniqueName];delete this._nodes[t]}};A.prototype.find=function(t){if(this._nodes[t])return this._nodes[t]};A.prototype.findByName=function(t){var e=this._nameUuidMap[t];if(e)return this._nodes[e]};A.prototype.removeName=function(t){delete this._nameUuidMap[t]};A.prototype.addName=function(t,e){this._nameUuidMap[t]=e};var S=pt.Behaviour=function(t){this._gameObject=t;this.cookie=0;this._events={};this.__hadUpdateOrRender=this.preUpdate||this.update||this.postUpdate?true:false};S.prototype.constructor=S;pt._userScripts={};var w=pt.defineBehaviour=function(e,i,r,a){var t=e.split(".");var n=D;for(var s=0;s<t.length-1;s++){if(!n[t[s]])n[t[s]]={};n=n[t[s]]}var o=t[t.length-1];i=i||pt.Behaviour;if(typeof a==="function"){a=a.call(this)}a=a||{};n[o]=function(t){i.call(this,t);this.class=e;this.super=i.prototype;if(typeof r==="function")r.call(this)};n[o].prototype=P.create(i.prototype);n[o].prototype.constructor=n[o];n[o].prototype.getMeta=function(){var t=i.prototype.getMeta.call(this);return l(t,a)};n[o].prototype.clazz=e;pt._userScripts[e]=n[o];return n[o]};pt.registerBehaviour=function(t,e){var i=t.split(".");var r=D;for(var a=0;a<i.length-1;a++){if(!r[i[a]])r[i[a]]={};r=r[i[a]]}var n=i[i.length-1];r[n]=e;var s=e.prototype.getMeta;e.prototype.getMeta=function(){var t=s.call(this);return l(t,this.serializableFields||{})};e.prototype.clazz=t;pt._userScripts[t]=e};P.defineProperties(S.prototype,{uuid:{get:function(){return this._uuid},set:function(t){this._uuid=t}},gameObject:{get:function(){return this._gameObject}},name:{get:function(){return this.gameObject.name},set:function(t){this.gameObject.name=t}},key:{get:function(){if(this._key)return this._key;if(this.class){var t=this.class.match(/([^\..]*)$/);if(t)this._key=t[1]}return this._key},set:function(t){if(this._key){if(this.gameObject&&this.gameObject[this._key]&&this.gameObject[this._key].uuid===this.uuid)delete this.gameObject[this._key]}this._key=t;if(this.gameObject&&!this.gameObject[t])this.gameObject[t]=this}},enable:{get:function(){return this._enable},set:function(t){if(this._enable!==t){this._enable=t;if(this._enable&&this.onEnable){this.onEnable()}else if(!this._enable&&this.onDisable){this.onDisable()}}}},runInEditor:{get:function(){return this._runInEditor===true},set:function(t){this._runInEditor=t}},game:{get:function(){return this.gameObject.game}}});S.prototype.addScript=function(t){return this.gameObject.addScript(t)};S.prototype.getScript=function(t){return this.gameObject.getScript(t)};S.prototype.getScripts=function(t){return this.gameObject.getScripts(t)};S.prototype.destroy=function(){this.gameObject.removeScript(this);if(this.onDestroy)this.onDestroy();for(var t in this._events){var e=this._events[t];if(!e)continue;e[0].remove(e[1],e[2])}this._events=[]};S.prototype.isEnable=function(){return this._enable};S.prototype.getMeta=function(){return{uuid:pt.Serializer.STRING,enable:{get:function(t){return t.enable},set:function(t,e){t._enable=e}}}};S.prototype._restoreInit=function(){this.gameObject._initGetSetField.call(this)};S.prototype.addListener=function(t,e,i,r){t.add(e,i,r);this.cookie++;this._events[this.cookie]=[t,e,i];return this.cookie};S.prototype.addListenerOnce=function(t,e,i,r){t.addOnce(e,i,r)};S.prototype.removeListener=function(t){var e=this._events[t];if(!e)return;e[0].remove(e[1],e[2]);delete this._events[t]};var E=pt.Storage=function(t){this.game=t;this._data={};this.timerMap={}};E.prototype={};E.prototype.constructor=E;P.defineProperties(E.prototype,{key:{get:function(){return this.game.localStorageID}}});E.prototype.restore=function(){};E.prototype.save=function(){};E.prototype.set=function(t,e){var i=this.key+"_"+t;this._data[i]=e;var r=JSON.stringify(e);if(!D.__wx)D.localStorage.setItem(i,r);else wx.setStorage({key:i,data:r})};E.prototype.delaySet=function(t,e,i){if(this.timerMap[t])return;var r=this.key+"_"+t;this._data[r]=e;var a=this;this.timerMap[t]=this.game.timer.add(i,function(){delete a.timerMap[t];a.set(t,e)})};E.prototype.del=function(t){var e=this.key+"_"+t;if(this._data[e])delete this._data[e];if(!D.__wx)D.localStorage.removeItem(e);else wx.removeStorageSync(e)};E.prototype.get=function(t){var e=this.key+"_"+t;if(this._data[e])return this._data[e];var i;if(!D.__wx)i=D.localStorage.getItem(e);else i=wx.getStorageSync(e);var r;if(i){r=JSON.parse(i);this._data[e]=r}return r};var M=pt.Node=function(e,t,i){var r=this;r.game=e.game._qc;r.phaser=e;e._qc=this;r.uuid=i||r.game.math.uuid();r._uniqueName="";r._interactive=false;r._draggable=false;r._children=null;r._prefab="";r.scripts=[];r.scriptMap={};r.static=false;r._localZOrder=0;r.hitArea=C;this.cookie=0;r._events=[];var a=e.destroy;e.destroy=function(){if(r._destroy)return;this.maybeOutWorld&&this.maybeOutWorld();if(r===r.game.world){a.call(e,true,true);r._dispatchModelChangeEvent("destroy",r)}else{r.onDestroy();a.call(e);var t=r.scripts.length;while(t--){r.scripts[t].destroy()}r.scripts=[];r.scriptMap={};r._dispatchModelChangeEvent("destroy",r);r._destroy=true}};if(t!==this){(t||this.game.world).addChild(this);if(this instanceof dragonBones.PhaserArmatureDisplay||this instanceof dragonBones.PhaserSlotDisplay){}else{this.pivotX=this.pivotY=.5;this.minAnchor.x=this.minAnchor.y=this.maxAnchor.x=this.maxAnchor.y=.5;this.anchoredX=this.anchoredY=0}}this._defaultTransform()};M.prototype.constructor=M;P.defineProperties(M.prototype,{uuid:{get:function(){return this._uuid},set:function(t){if(this._uuid){this.game.nodePool.remove(this.uuid)}this._uuid=t;this.game.nodePool.add(this.uuid,this)}},name:{get:function(){return this.phaser.name},set:function(t){t=t||"";t=t.replace(/\//g,"");this.phaser.name=t;this._dispatchModelChangeEvent("name",this)}},uniqueName:{get:function(){return this._uniqueName},set:function(t){if(this._uniqueName)this.game.nodePool.removeName(this._uniqueName);this._uniqueName=t;if(this._uniqueName&&!this.game.nodePool.findByName(this._uniqueName))this.game.nodePool.addName(this._uniqueName,this.uuid)}},ignoreDestroy:{get:function(){return this.parent===this.game.world&&this.phaser.ignoreDestroy},set:function(t){if(this.parent===this.game.world)this.phaser.ignoreDestroy=t;else{this.phaser.ignoreDestroy=false;if(t)this.game.log.error("Only Root Node can set: ignoreDestroy=true")}}},alpha:{get:function(){return this.phaser.alpha},set:function(t){this.phaser.alpha=t;this.phaser.displayChanged(pt.DisplayChangeStatus.ALPHA)}},visible:{get:function(){return this.phaser.visible},set:function(t){if(this.phaser.visible===t)return;if(t&&this._toDestroy)return;this.phaser.visible=t;this._isTransformDirty=true;this._dispatchLayoutArgumentChanged("size");this.phaser.displayChanged(t?pt.DisplayChangeStatus.SHOW:pt.DisplayChangeStatus.HIDE);this._notifyVisibleChanged(t);this._dispatchEnable()}},parent:{get:function(){var t=this.phaser.parent;return t?t._qc:null},set:function(t){if(t){t.addChild(this)}else{if(this.parent instanceof M){this.parent.removeChild(this)}}}},worldVisible:{get:function(){return this.phaser&&this.phaser.worldVisible}},mask:{get:function(){return this.phaser.mask},set:function(t){this.phaser.mask=t}},children:{get:function(){if(!this._children){this._children=[];var t=this.phaser.children;for(var e=0,i=t.length;e<i;e++){var r=t[e]._qc;if(r){this._children.push(r)}}}return this._children}},localZOrder:{get:function(){return this._localZOrder},set:function(t){this._localZOrder=t;if(this.parent)this.parent._orderDirty=true}},colorTint:{get:function(){return new yt(this.phaser.tint)},set:function(t){t=t||new yt(16777215);if(!(t instanceof yt)){console.error(t);this.game.log.error("Expected qc.Color");return}this.phaser.tint=t.toNumber();this.phaser.displayChanged(pt.DisplayChangeStatus.TINT)}},onChildrenChanged:{get:function(){return this._onChildrenChanged||(this._onChildrenChanged=new dt.Signal)}}});M.prototype.preUpdate=function(){if(!this._orderDirty)return;this._orderDirty=C;if(!this.phaser||typeof this.phaser.updateZ!=="function")return;var t=this.getChildren();t.sort(function(t,e){var i=(t._localZOrder||0)-(e._localZOrder||0);if(i===0)return t.phaser.z-e.phaser.z;else return i});var e=[];for(var i=0,r=t.length;i<r;i++){var a=t[i];e.push(a.phaser)}this.phaser.children=e;this.phaser.updateZ();this._children=null};M.prototype.isVisible=function(){return this.phaser.visible};M.prototype.isWorldVisible=function(){var t=this;do{if(!t.phaser.visible)return false;t=t.parent}while(t);return true};M.prototype.addScript=function(t,e){var i=t;if(typeof t==="string")i=pt.Util.findClass(t);if(typeof i!=="function"){this.game.log.error("Class:{0} not exists",t);return}var r=new i(this);if(!(r instanceof pt.Behaviour)){this.game.log.error("Must inherit from qc.Behaviour");return}r.uuid=this.game.math.uuid();r._clazz=t;r.class=t;this[r.key]=r;this.scripts.push(r);this.scriptMap[t]=r;if(e||e===C){if(r.awake&&(this.game.device.editor!==true||r.runInEditor===true))r.awake()}if(r._enable===C&&e!==false){if(this.game.device.editor===true&&r.runInEditor!==true)r._enable=true;else r.enable=true}return r};M.prototype.removeScript=function(t){var e=this.scripts.indexOf(t);if(e>-1)this.scripts.splice(e,1);delete this.scriptMap[t.class];if(this[t._key]&&this[t._key].uuid===t.uuid)delete this[t._key];if(this.__json&&this.__json[t.uuid])delete this.__json[t.uuid]};M.prototype.getScript=function(t,e){var i=t;if(typeof t!="string")t=i.prototype.clazz;if(this.scriptMap[t])return this.scriptMap[t];if(typeof t==="string")i=pt.Util.findClass(t);if(!i){if(t!=="playsmart.editor.data"){this.game.log.error("Class:{0} not exists",t)}return null}if(arguments.length===1||e){for(var r in this.scripts){if(this.scripts[r]instanceof i){return this.scripts[r]}}}else{for(var r in this.scripts){if(this.scripts[r].class===i.prototype.clazz){return this.scripts[r]}}}};M.prototype.getScripts=function(t,e){var i=t;if(typeof t==="string")i=pt.Util.findClass(t);var r=[];if(!i){this.game.log.error("Class:{0} not exists",t);return r}if(arguments.length===1||e){for(var a in this.scripts){if(this.scripts[a]instanceof i){r.push(this.scripts[a])}}}else{for(var a in this.scripts){if(this.scripts[a].class===i.prototype.clazz){r.push(this.scripts[a])}}}return r};M.prototype.isDescendantOf=function(t){var e=this.parent;while(e){if(t===e){return true}else{e=e.parent}}return false};M.prototype.getChildren=function(){var t=this._children;if(!t){t=this.children}return t};M.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)};M.prototype.addChildAt=function(t,e){if(t.parent===this){return}if(!(t instanceof M)){throw new Error("Expected qc.Node")}if(t===this){throw new Error("The child is myself")}if(this.isDescendantOf(t)){throw new Error("child is my parent")}var i=t.parent;if(i instanceof M){i._children=null}if(this.phaser.addAt){this.phaser.addAt(t.phaser,e)}else{this.phaser.addChildAt(t.phaser,e)}this._orderDirty=true;this._dispatchModelChangeEvent("parent",t);t._callChildrenFunc("onAddToWorld");return t};M.prototype.swapChildren=function(t,e){this.phaser.swapChildren(t.phaser,e.phaser);this._dispatchModelChangeEvent("parent",t);this._dispatchModelChangeEvent("parent",e)};M.prototype.getChildIndex=function(t){return this.children.indexOf(t)};M.prototype.setChildIndex=function(t,e){if(t.parent!==this){return}var i=this.phaser.children;var r=i.indexOf(t.phaser);if(r===e){return}i.splice(r,1);i.splice(e,0,t.phaser);if(this.phaser.updateZ)this.phaser.updateZ();t.phaser.displayChanged(pt.DisplayChangeStatus.ORDER);this._dispatchModelChangeEvent("parent",t);this._dispatchChildrenChanged("order",[t])};M.prototype.getChildAt=function(t){return this.children[t]};M.prototype.removeChild=function(t){if(this.phaser.remove){this.phaser.remove(t.phaser)}else{this.phaser.removeChild(t.phaser)}this._children=null;this._dispatchModelChangeEvent("parent",t);t._callChildrenFunc("onRemoveFromWorld");return t};M.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.removeChild(e)};M.prototype.removeChildren=function(){var t=this.children;if(this.phaser.removeAll){this.phaser.removeAll()}else{this.phaser.removeChildren()}this._dispatchModelChangeEvent("removeChildren",this);t.forEach(function(t){if(t)t._callChildrenFunc("onRemoveFromWorld")})};M.prototype.onDestroy=function(){this.parent=null;this.game.nodePool.remove(this.uuid)};M.prototype.destroy=function(){if(this._toDestroy)return;this._toDestroy=true;this.visible=false;this.game.world.addToDestroy(this)};M.prototype.destroyImmediately=function(){if(this._destroy||this._destroying)return;for(var t in this._events){var e=this._events[t];if(!e)continue;e[0].remove(e[1],e[2])}this._events=[];this.visible=false;this._destroying=true;if(this.phaser)this.phaser.destroy();this._destroying=false};M.prototype.find=function(t){if(t===""||t==="."||t==="./")return this;var e=t.split("/");var i=this;for(var r=0;r<e.length-1;r++){var a=e[r];if(a==="")continue;if(a===".."){i=this.parent;if(i===this.game.stage)return null;continue}i=i._findByName(e[r]);if(!i)return i}var a=e[e.length-1];if(a===""||a===".")return i;if(a==="..")return i.parent===this.game.stage?null:i.parent;return i._findByName(a)};M.prototype._findByName=function(t){var e=this.children;for(var i in e){if(e[i].name===t){return e[i]}if(e[i].uniqueName===t){return e[i]}}};M.prototype._dispatchModelChangeEvent=function(t,e){if(t!=="name"){this._children=null}var i=this.game.world;i.onModelChange.dispatch({type:t,target:e})};M.prototype._sendMessage=function(t,e){if(!this.scripts)return;var i=this.scripts.length;var r=Array.prototype.slice.call(arguments,2);for(var a=0;a<i;a++){var n=this.scripts[a];if(n&&n.enable){var s=n[t];if(!s)continue;var o=s.apply(n,r);if(e===true&&o===true)return true}}};M.prototype._broadcast=function(t){if(!this.scripts)return;var e=this.scripts.length;var i=Array.prototype.slice.call(arguments,1);while(e--){var r=this.scripts[e];if(!r||!r.enable)continue;if(this.game.device.editor===true&&r.runInEditor!==true)continue;if(this._toDestroy||this._destroy)return;var a=r[t];if(!a)continue;a.apply(r,i)}var n=this._children;if(!n)n=this.getChildren();var s=n.length;for(e=0;e<s;e++){n[e][t](i)}};M.prototype._dispatchChildrenChanged=function(t,e){var i=this;var r={source:this,type:t,children:e};while(i){if(i._onChildrenChanged){i._onChildrenChanged.dispatch(r)}i=i.parent}};M.prototype._notifyVisibleChanged=function(t){if(this.onVisibleChange)this.onVisibleChange();var e=this._children;if(!e)e=this.children;var i=e.length;while(i--){if(!e[i].visible)continue;e[i]._notifyVisibleChanged(t)}};M.prototype._notifyCacheChanged=function(t){this.cacheEnable=t;var e=this._children;if(!e)e=this.children;var i=e.length;while(i--){e[i]._notifyCacheChanged(t)}};M.prototype._callChildrenFunc=function(t){var e=this[t];if(e)e.apply(this,arguments);var i=this._children;if(!i)i=this.children;var r=i.length;while(r--){var a=i[r];if(!a)continue;e=a[t];if(e)e.apply(a,arguments)}};M.prototype.addListener=function(t,e,i,r){t.add(e,i,r);this.cookie++;this._events[this.cookie]=[t,e,i];return this.cookie};M.prototype.addListenerOnce=function(t,e,i,r){t.addOnce(e,i,r)};M.prototype.removeListener=function(t){var e=this._events[t];if(!e)return;e[0].remove(e[1],e[2]);delete this._events[t]};P.defineProperties(M.prototype,{x:{get:function(){return this.phaser.x},set:function(t){if(this.x===t)return;if(this.minAnchor.x<this.maxAnchor.x){this._left=this.left+(t-this.x);this._right=this.right-(t-this.x)}this.phaser.x=t;this._calcAnchoredX();this.phaser.displayChanged(pt.DisplayChangeStatus.OFFSET);this._isTransformDirty=true}},y:{get:function(){return this.phaser.y},set:function(t){if(this.y===t)return;if(this.minAnchor.y<this.maxAnchor.y){this._top=this.top+(t-this.y);this._bottom=this.bottom-(t-this.y)}this.phaser.y=t;this._calcAnchoredY();this.phaser.displayChanged(pt.DisplayChangeStatus.OFFSET);this._isTransformDirty=true}},anchoredX:{get:function(){if(this._anchoredX===C){this._calcAnchoredX()}return this._anchoredX},set:function(t){if(t===this.anchoredX)return;this._anchoredX=t;this._calcX();this._isTransformDirty=true}},anchoredY:{get:function(){if(this._anchoredY===C){this._calcAnchoredY()}return this._anchoredY},set:function(t){if(t===this.anchoredY)return;this._anchoredY=t;this._calcY();this._isTransformDirty=true}},scaleX:{get:function(){return this.phaser.scale.x},set:function(t){if(t===this.scaleX)return;this.phaser.scale.x=t;this.phaser.displayChanged(pt.DisplayChangeStatus.SCALE);this._isTransformDirty=true}},scaleY:{get:function(){return this.phaser.scale.y},set:function(t){if(t===this.scaleY)return;this.phaser.scale.y=t;this.phaser.displayChanged(pt.DisplayChangeStatus.SCALE);this._isTransformDirty=true}},pivotX:{get:function(){if(!this.phaser.anchor)this.phaser.anchor=new pt.Point(.5,.5);return this.phaser.anchor.x},set:function(t){if(!this.phaser.anchor)this.phaser.anchor=new pt.Point(.5,.5);if(this.phaser.anchor.x===t)return;this.phaser.anchor.x=t;this.phaser.displayChanged(pt.DisplayChangeStatus.ROTATION);this.relayout()}},pivotY:{get:function(){if(!this.phaser.anchor)this.phaser.anchor=new pt.Point(.5,.5);return this.phaser.anchor.y},set:function(t){if(!this.phaser.anchor)this.phaser.anchor=new pt.Point(.5,.5);if(this.phaser.anchor.y===t)return;this.phaser.anchor.y=t;this.phaser.displayChanged(pt.DisplayChangeStatus.ROTATION);this.relayout()}},rotation:{get:function(){return this.phaser.rotation},set:function(t){if(this.phaser.rotation===t){return}this.phaser.rotation=t;this.phaser.displayChanged(pt.DisplayChangeStatus.ROTATION);this._isTransformDirty=true}},skewX:{get:function(){return this._skewX},set:function(t){if(this._skewX===t){return}this._skewX=t;this.phaser.displayChanged(pt.DisplayChangeStatus.ROTATION);this._isTransformDirty=true}},skewY:{get:function(){return this._skewY},set:function(t){if(this._skewY===t){return}this._skewY=t;this.phaser.displayChanged(pt.DisplayChangeStatus.ROTATION);this._isTransformDirty=true}},width:{get:function(){return this._width=this._width||0},set:function(t){if(this.game.math.fuzzyEqual(this._width,t,.001))return;if(this.minAnchor.x<this.maxAnchor.x){var e=t-this.width;var i=e*this.pivotX;var r=e-i;this._left-=i;this._right-=r}else this.setWidth(t);this.relayout()}},height:{get:function(){return this._height=this._height?this._height:0},set:function(t){if(this.game.math.fuzzyEqual(this._height,t,.001))return;if(this.minAnchor.y<this.maxAnchor.y){var e=t-this.height;var i=e*this.pivotY;var r=e-i;this._top-=i;this._bottom-=r}else this.setHeight(t);this.relayout()}},minAnchor:{get:function(){if(!this._minAnchor)this._minAnchor=new pt.Point(0,0);return this._minAnchor},set:function(t){throw new Error("user function:setAnchor")}},maxAnchor:{get:function(){if(!this._maxAnchor)this._maxAnchor=new pt.Point(0,0);return this._maxAnchor},set:function(t){throw new Error("use function:setAnchor")}},left:{get:function(){if(this._left===C)this._left=0;return this._left},set:function(t){if(this._left===t)return;this._left=t;this.relayout()}},right:{get:function(){if(this._right===C)this._right=0;return this._right},set:function(t){if(this._right===t)return;this._right=t;this.relayout()}},top:{get:function(){if(this._top===C)this._top=0;return this._top},set:function(t){if(this._top===t)return;this._top=t;this.relayout()}},bottom:{get:function(){if(this._bottom===C)this._bottom=0;return this._bottom},set:function(t){if(this._bottom===t)return;this._bottom=t;this.relayout()}},rect:{get:function(){var t=this.width;var e=this.height;return new pt.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,t,e)}},worldTransform:{get:function(){this.nodeUpdateTransform();return this.phaser.worldTransform}},localBounds:{get:function(){return this.phaser.getLocalBounds()}},_isTransformDirty:{get:function(){return!this.phaser._isNotNeedCalcTransform},set:function(t){if(this.phaser._isNotNeedCalcTransform===!t){return}this.phaser._isNotNeedCalcTransform=!t}},onLayoutArgumentChanged:{get:function(){return this._onLayoutArgumentChanged||(this._onLayoutArgumentChanged=new dt.Signal)}},onRelayout:{get:function(){return this._onRelayout||(this._onRelayout=new dt.Signal)}},onTransformChanged:{get:function(){return this.phaser._onTransformChanged||(this.phaser._onTransformChanged=new dt.Signal)}}});M.prototype.setStretch=function(t,e,i,r){var a=false;if(this.minAnchor.x>=this.maxAnchor.x){if(this._anchoredX!==t){this._anchoredX=t;a=true}}else{if(t!==C&&this._left!==t){this._left=t;a=true}if(e!==C&&this._right!==e){this._right=e;a=true}}if(this.minAnchor.y>=this.maxAnchor.y){if(this._anchoredY!==i){this._anchoredY=i;a=true}}else{if(i!==C&&this._top!==i){this._top=i;a=true}if(r!==C&&this._bottom!==r){this._bottom=r;a=true}}if(a){this.relayout()}};M.prototype.setAnchor=function(t,e,i){i=i===C?true:i;t=t||this.minAnchor;e=e||this.maxAnchor;if(t.x<0)t.x=0;if(t.y<0)t.y=0;if(t.x>1)t.x=1;if(t.y>1)t.y=1;if(e.x<0)e.x=0;if(e.y<0)e.y=0;if(e.x>1)e.x=1;if(e.y>1)e.y=1;if(t.x>e.x||t.y>e.y)throw new Error("Expected:min < max");if(t.x===this.minAnchor.x&&t.y===this.minAnchor.y&&e.x===this.maxAnchor.x&&e.y===this.maxAnchor.y)return;this._minAnchor=t;this._maxAnchor=e;if(i){this._calcAnchoredX();this._calcAnchoredY();this._calcMargin()}else{this.relayout()}};M.prototype.relayout=function(){var t=this.parent.rect;if(this.minAnchor.x<this.maxAnchor.x){var e=t.x+t.width*this.minAnchor.x+this.left;var i=t.x+t.width*this.maxAnchor.x-this.right;var r=i-e;this.setWidth(r);this.phaser.x=e+r*this.pivotX;this._calcAnchoredX()}else{this.phaser.x=t.x+t.width*this.minAnchor.x+this.anchoredX}if(this.minAnchor.y<this.maxAnchor.y){var a=t.y+t.height*this.minAnchor.y+this.top;var n=t.y+t.height*this.maxAnchor.y-this.bottom;var s=n-a;this.setHeight(s);this.phaser.y=a+s*this.pivotY;this._calcAnchoredY()}else{this.phaser.y=t.y+t.height*this.minAnchor.y+this.anchoredY}this._isTransformDirty=true;var o=this.children;for(var h=0;h<o.length;h++){o[h].relayout()}this._calcWorldCorners(true);this._dispatchLayoutArgumentChanged("size");this._lastRectInfo=new pt.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height);if(this._onRelayout)this._onRelayout.dispatch()};M.prototype.setWidth=function(t){this._width=t;this.phaser.displayChanged(pt.DisplayChangeStatus.SIZE)};M.prototype.setHeight=function(t){this._height=t;this.phaser.displayChanged(pt.DisplayChangeStatus.SIZE)};M.prototype._defaultTransform=function(){if(!this.parent||this.parent===this.game.stage)return;this.x=0;this.y=0;this.width=100;this.height=100};M.prototype._calcMargin=function(){var t=this.parent.rect;if(this.minAnchor.x>=this.maxAnchor.x){this._left=this._right=0}else{var e=this.x-this.pivotX*this.width;var i=t.x+t.width*this.minAnchor.x;this._left=e-i;var r=t.x+t.width*this.maxAnchor.x;this._right=r-(e+this.width)}if(this.minAnchor.y>=this.maxAnchor.y){this._top=this._bottom=0}else{var a=this.y-this.pivotY*this.height;var n=t.y+t.height*this.minAnchor.y;this._top=a-n;var s=t.y+t.height*this.maxAnchor.y;this._bottom=s-(a+this.height)}};M.prototype._calcAnchoredX=function(){var t=this.parent.rect;this._anchoredX=this.x-(t.width*this.minAnchor.x+t.x)};M.prototype._calcAnchoredY=function(){var t=this.parent.rect;this._anchoredY=this.y-(t.height*this.minAnchor.y+t.y)};M.prototype._calcX=function(){var t=this.parent.rect;this.x=this._anchoredX+(t.width*this.minAnchor.x+t.x)};M.prototype._calcY=function(){var t=this.parent.rect;this.y=this._anchoredY+(t.height*this.minAnchor.y+t.y)};M.prototype.toLocal=function(t){return this.worldTransform.applyInverse(t)};M.prototype.toGlobal=function(t){return this.worldTransform.apply(t)};M.prototype.nodeUpdateTransform=function(){var t=false;if(this.parent&&this.parent.nodeUpdateTransform){t=this.parent.nodeUpdateTransform()}if(!this._isTransformDirty)return t;if(!t){this.phaser.updateTransform()}return true};M.prototype.getWorldPosition=function(){var t=this.worldTransform;return new pt.Point(t.tx,t.ty)};M.prototype.getWorldScale=function(){var t=this.worldTransform;var e=Math.atan2(t.b,t.a);var i=Math.atan2(-t.c,t.d);if(t.b/t.a===-t.c/t.d&&i!==e){e=Math.atan(t.b/t.a);i=Math.atan(-t.c/t.d)}var r=e===Math.PI||e===0||t.b===0&&t.a!==0?t.a/Math.cos(e):t.b/Math.sin(e);var a=i===Math.PI||i===0||t.c===0&&t.d!==0?t.d/Math.cos(i):-t.c/Math.sin(i);return new pt.Point(r,a)};M.prototype.getWorldSkew=function(){var t=this.worldTransform;if(t.b/t.a===-t.c/t.d)return new pt.Point(0,0);return new pt.Point(Math.atan2(-t.c,t.d),Math.atan2(t.b,t.a))};M.prototype.getWorldRotation=function(){if(this.worldRotationTmp!=C){return this.worldRotationTmp}var t=this.worldTransform;if(t.b/t.a!==-t.c/t.d)return 0;return Math.atan2(t.b,t.a)};M.prototype.setTransformToWorld=function(t,e,i,r,a){this.setTransformTo(this.game.world,t,e,i,r,a)};M.prototype.setTransformTo=function(t,e,i,r,a,n){e=e||0;i=i||0;r=r||1;a=a||1;n=n||0;var s=0;var o=0;if(arguments.length>6&&typeof arguments[6]==="number")s=arguments[6];if(arguments.length>7&&typeof arguments[7]==="number")o=arguments[7];var h=Math.cos(s);var l=Math.sin(s);var u=Math.cos(o);var f=Math.sin(o);var c=Math.cos(n);var p=Math.sin(n);var d=(c*u-p*l)*r;var _=(c*f+p*h)*r;var g=(-p*u-c*l)*a;var m=(-p*f+c*h)*a;var y=e;var v=i;this.setTransformToWithMatrix(t,d,_,g,m,y,v)};M.prototype.setTransformToWithMatrix=function(t,e,i,r,a,n,s){var o=[e,i,0,r,a,0,n,s,1];if(t){var h=t?t.worldTransform||new pt.Matrix:new pt.Matrix;var l=h.toArray(true);this.game.math.multiply(o,l,o)}var u=this.parent?this.parent.worldTransform||new pt.Matrix:new pt.Matrix;var f=u.toArray(true);var c=[];this.game.math.invert(c,f);this.game.math.multiply(c,c,o);var e=c[0];var i=c[1];var r=c[3];var a=c[4];this.x=c[6];this.y=c[7];if(i/e!==-r/a){var p=Math.atan2(i,e);var d=Math.atan2(-r,a);this.rotation=p;this.scaleX=p===0||i===0&&e!==0?e/Math.cos(p):i/Math.sin(p);this.scaleY=d===0||r===0&&a!==0?a/Math.cos(d):-r/Math.sin(d)}else{var _=this.rotation;this.scaleX=_===0||i===0&&e!==0?e/Math.cos(_):i/Math.sin(_);this.scaleY=_===0||r===0&&a!==0?a/Math.cos(_):-r/Math.sin(_)}this._calcAnchoredX();this._calcAnchoredY();this._calcMargin()};var I=M.prototype.addChildAt;M.prototype.addChildAt=function(t,e){I.call(this,t,e);if(!t._isSwitchParent){t.relayout()}t._isTransformDirty=true};M.prototype.switchParent=function(t,e){if(t===this||t.isDescendantOf(this))return;var i=this.worldTransform;var r=i.a;var a=i.b;var n=i.c;var s=i.d;var o=i.tx;var h=i.ty;this._isSwitchParent=true;this.parent=t;delete this._isSwitchParent;if(typeof e!=="undefined"){this.parent.setChildIndex(this,e)}this.setTransformToWithMatrix(null,r,a,n,s,o,h)};M.prototype._calcWorldCorners=function(t){if(t||this.nodeUpdateTransform()){var e=this.rect;var i=new pt.Point(e.x,e.y);var r=new pt.Point(e.x+e.width,e.y);var a=new pt.Point(e.x+e.width,e.y+e.height);var n=new pt.Point(e.x,e.y+e.height);var s=this.phaser.worldTransform;this._worldLeftTop=s.apply(i);this._worldRightTop=s.apply(r);this._worldRightBottom=s.apply(a);this._worldLeftBottom=s.apply(n);var o=Math.min(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x);var h=Math.max(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x);var l=Math.min(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y);var u=Math.max(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y);this._worldBox=new pt.Rectangle(o,l,h-o,u-l)}};M.prototype.getWorldCorners=function(){this._calcWorldCorners(true);return[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]};M.prototype.getCornersIn=function(t){var e=t&&t.phaser.worldTransform;this._calcWorldCorners();return!e?[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]:[e.applyInverse(this._worldLeftTop),e.applyInverse(this._worldRightTop),e.applyInverse(this._worldRightBottom),e.applyInverse(this._worldLeftBottom)]};M.prototype.getWorldBox=function(){this._calcWorldCorners(true);return this._worldBox};M.prototype.getBoxIn=function(t){var e=this.getCornersIn(t);var i=new pt.Point(-Number.MAX_VALUE,-Number.MAX_VALUE);var r=new pt.Point(Number.MAX_VALUE,Number.MAX_VALUE);for(var a=0;a<4;a++){var n=e[a];i.x=Math.max(i.x,n.x);i.y=Math.max(i.y,n.y);r.x=Math.min(r.x,n.x);r.y=Math.min(r.y,n.y)}return new pt.Rectangle(r.x,r.y,i.x-r.x,i.y-r.y)};M.prototype.rectContains=function(t){var e=this.toLocal(t);return this.rect.contains(e.x,e.y)};M.prototype._dispatchLayoutArgumentChanged=function(t){if(this._onLayoutArgumentChanged){this._onLayoutArgumentChanged.dispatch(t)}};P.defineProperties(M.prototype,{hitArea:{get:function(){return this.phaser.hitArea===C?this.rect:this.phaser.hitArea},set:function(t){this.phaser.hitArea=t}},serializeHitArea:{get:function(){return this.phaser.hitArea},set:function(t){this.phaser.hitArea=t}},onDown:{get:function(){if(!this._onDown){this._onDown=new dt.Signal}return this._onDown}},onUp:{get:function(){if(!this._onUp){this._onUp=new dt.Signal}return this._onUp}},onClick:{get:function(){if(!this._onClick){this._onClick=new dt.Signal}return this._onClick}},onDragStart:{get:function(){if(!this._onDragStart){this._onDragStart=new dt.Signal}return this._onDragStart}},onDrag:{get:function(){if(!this._onDrag){this._onDrag=new dt.Signal}return this._onDrag}},onDragEnd:{get:function(){if(!this._onDragEnd){this._onDragEnd=new dt.Signal}return this._onDragEnd}},onDragDrop:{get:function(){if(!this._onDragDrop){this._onDragDrop=new dt.Signal}return this._onDragDrop}},onWheel:{get:function(){if(!this._onWheel){this._onWheel=new dt.Signal}return this._onWheel}},onEnter:{get:function(){if(!this._onEnter){this._onEnter=new dt.Signal}return this._onEnter}},onExit:{get:function(){if(!this._onExit){this._onExit=new dt.Signal}return this._onExit}},onInteractive:{get:function(){if(!this._onInteractive){this._onInteractive=new dt.Signal}return this._onInteractive}},interactive:{get:function(){return this._interactive},set:function(t){this._interactive=t;if(this._onInteractive){this._onInteractive.dispatch()}}},passEvent:{get:function(){return this._passEvent},set:function(t){this._passEvent=t}}});M.prototype.checkAllowDrop=function(t){var e=false;var i=this.scripts.length;for(var r=0;r<i;r++){var a=this.scripts[r];if(a){var n=a["isAllowDrop"];if(!n)continue;if(n.call(a,t))return true;e=true}}return!this.isAllowDrop?!e:this.isAllowDrop(t)};M.prototype.canHandleInputEvent=function(t){if(!this.interactive)return false;var e=this["_"+t];if(e&&e.getNumListeners()>0)return true;var i=this.scripts.length;for(var r=0;r<i;r++){var a=this.scripts[r];if(a){var n=a[t];if(!n)continue;return true}}return false};M.prototype.getInputEventHandle=function(t,e,i){var r=Array.isArray(t)?t:[t];var a=this;var n=this.game.stage;var s;var o=[];while(a&&a!==n){s=r.length;var h=a.phaser.worldTransform.applyInverse({x:e,y:i});while(s--){if(a.canHandleInputEvent(r[s])&&a.checkHit(h.x,h.y)){o.push(a);if(!a.passEvent)return o;break}}a=a.parent}return o};M.prototype.getInputEventHandleAndEventType=function(t,e,i){var r=Array.isArray(t)?t:[t];var a=this;var n=this.game.stage;var s;var o=[];while(a&&a!==n){s=r.length;var h=a.phaser.worldTransform.applyInverse({x:e,y:i});while(s--){if(a.canHandleInputEvent(r[s])&&a.checkHit(h.x,h.y)){o.push([a,r[s]]);if(!a.passEvent)return o;break}}a=a.parent}return o};M.prototype.fireInputEvent=function(t,e){if(!this.interactive||this.state===pt.UIState.DISABLED)return false;var i=this._sendMessage(t,true,e);if(i===true){return true}var r=this["_"+t];if(r&&r.getNumListeners()>0){r.dispatch(this,e)}};M.prototype.checkHit=function(t,e){var i=this;if(!i._interactive){return}var r=i.phaser.hitArea===C?this._lastRectInfo:this.phaser.hitArea;return r&&r.contains&&r.contains(t,e)};P.defineProperty(M.prototype,"class",{get:function(){return"qc.Node"}});M.prototype.getMeta=function(){var t=pt.Serializer;var i=this;return{uuid:{type:t.STRING,get:function(t,e){return t.uuid},set:function(t,e){i.game.serializer.restoreContext[e]=i.uuid}},_prefab:t.STRING,__lock:t.BOOLEAN,name:t.STRING,uniqueName:t.STRING,ignoreDestroy:t.BOOLEAN,alpha:t.NUMBER,visible:t.BOOLEAN,colorTint:t.COLOR,static:t.BOOLEAN,scripts:{get:function(t,e){return i._packScripts.call(t,e)},set:function(t,e){i._unpackScripts.call(t,e)}},position:{get:function(t,e){return[t.pivotX,t.pivotY,t.anchoredX,t.anchoredY,t.x,t.y,t.width,t.height,t.left,t.right,t.top,t.bottom,t.minAnchor.x,t.minAnchor.y,t.maxAnchor.x,t.maxAnchor.y]},set:function(t,e){var i=t;i._minAnchor=new pt.Point(e[12],e[13]);i._maxAnchor=new pt.Point(e[14],e[15]);i.phaser.anchor=new pt.Point(e[0],e[1]);i._anchoredX=e[2];i._anchoredY=e[3];if(i._minAnchor.x<i._maxAnchor.x){i._left=e[8];i._right=e[9]}else{i.setWidth(e[6])}if(i._minAnchor.y<i._maxAnchor.y){i._top=e[10];i._bottom=e[11]}else{i.setHeight(e[7])}i.relayout()}},scaleX:t.NUMBER,scaleY:t.NUMBER,rotation:t.NUMBER,serializeHitArea:t.AUTO,interactive:t.BOOLEAN,isFiltersThrough:t.BOOLEAN,children:{get:function(t,e){return i._packChildren.call(t,e)},set:function(t,e){i._unpackChildren.call(t,e)}}}};M.prototype._packChildren=function(t){var e=this.children;if(e.length===0)return[];if(this instanceof pt.UIText||this instanceof pt.Sprite)return[];var i=[];for(var r in e){var a=e[r];var n=this.game.serializer.buildBundle(a,t);i.push(n)}return i};M.prototype._unpackChildren=function(t){for(var e in t){var i=this.game.serializer.restoreBundle(t[e],this,true)}};M.prototype._packScripts=function(t){var e=this.scripts;if(!e||e.length===0)return[];var i=[];for(var r in e){var a=e[r],n=null;if(a._clazz==="qc.NonexistScript"){i.push({clazz:a.script,data:a.data.uuid[1]});continue}else{if(this.__json&&this.__json[a.uuid]){n=this.__json[a.uuid].data}n=this.game.serializer.buildBundle(a,t,n)}i.push({clazz:a._clazz,data:a.uuid});if(!this.__json){this.__json={}}this.__json[a.uuid]=n}return i};M.prototype._unpackScripts=function(t){for(var e in t){var i=t[e];var r=i.data;if(typeof r==="string"){r=this.__json[r].data}else{r=r.data}var a=pt.Util.findClass(i.clazz);if(typeof a!=="function"){if(r&&r.uuid){var n=this.addScript("qc.NonexistScript");n.script=i.clazz;n.data=r}console.error("Class: "+i.clazz+" is not exist!");continue}try{var n=this.addScript(i.clazz,false);var s={};if(n.getMeta)s=n.getMeta();for(var o in s){try{this.game.serializer.fromJson(n,r,o,s[o])}catch(t){console.error("Deserialize fail!",t);pt.Util.popupError(t.message)}}}catch(t){console.error("Deserialize error!",t);pt.Util.popupError(t.message)}}if(!this.game.device.editor){delete this.__json}};M.prototype._findPath=function(t,e){var i="";if(t===this)return i;if(e===C)e=true;var r=this.children;for(var a in r){var n=r[a];var s=n._findPath(t,false);if(s===""){i+=n.name;return i}else if(s){i+=n.name+"/"+s;return i}}if(!e)return null;var o=this.parent;i+="/..";while(o!==this.game.stage){var s=o._findPath(t,false);if(s===""){return i}else if(s){i+="/"+s;return i}o=o.parent;i+="/.."}return null};M.prototype._restoreNodeRef=function(){var t={};if(this.getMeta)t=this.getMeta();for(var e in t){var i="__BUILTIN_NODE__"+e;if(this[i]&&typeof this[i]==="string"){this[e]=this.game.serializer.findNodeRef(this[i]);delete this[i]}var r="__BUILTIN_NODE_ARRAY__"+e;if(this[r]&&typeof this[r]==="object"){var a=[];for(var n in this[r]){if(this[r][n]&&this[r][n][1])a.push(this.game.serializer.findNodeRef(this[r][n][1]));else a.push(null)}this[e]=a;delete this[r]}}for(var n in this.scripts){var s=this.scripts[n];var t={};if(s.getMeta)t=s.getMeta();for(var e in t){var i="__BUILTIN_NODE__"+e;if(s[i]&&typeof s[i]==="string"){s[e]=this.game.serializer.findNodeRef(s[i]);delete s[i]}var r="__BUILTIN_NODE_ARRAY__"+e;if(s[r]&&typeof s[r]==="object"){var a=[];for(var n in s[r]){if(s[r][n]&&s[r][n][1])a.push(this.game.serializer.findNodeRef(s[r][n][1]));else a.push(null)}s[e]=a;delete s[r]}}}var o=this.children;for(var e in o){o[e]._restoreNodeRef()}};M.prototype._restoreInit=function(){this._initGetSetField();for(var t in this.scripts){var e=this.scripts[t];if(e._restoreInit)e._restoreInit()}var i=this.children;for(var r in i){i[r]._restoreInit()}};M.prototype._dispatchAwake=function(){var t=this.children;for(var e in t){t[e]._dispatchAwake()}for(var i in this.scripts){var r=this.scripts[i];if(this.game.device.editor===true&&!r.runInEditor)continue;if(r.awake)r.awake.call(r)}};M.prototype._dispatchEnable=function(){if(!this.visible)return;var t=this.children;for(var e in t){t[e]._dispatchEnable()}for(var i in this.scripts){var r=this.scripts[i];if(this.game.device.editor===true&&!r.runInEditor)continue;if(r.enable&&r.onEnable)r.onEnable()}};M.prototype._initGetSetField=function(){var t=this.__GET_SET__;if(!t)return;for(var e in t){var i=t[e];this[i]=this["__BUILTIN_SET__"+i];delete this["__BUILTIN_SET__"+i]}delete this.__GET_SET__};var R=function(i,t){return{type:t,get:function(t){return t[i]},set:function(t,e){t["__BUILTIN_SET__"+i]=e;if(t.__GET_SET__)t.__GET_SET__.push(i);else t.__GET_SET__=[i]}}};M.prototype.generateTexture=function(t,e,i,r,a,n){if(!this.phaser){return new pt.RenderTexture(0,0,renderer,e,t)}var s=this.localBounds;s.x+=i||0;s.y+=r||0;isNaN(a)||(s.width=a);isNaN(n)||(s.height=n);var o=new pt.RenderTexture(s.width|0,s.height|0,null,e,t);_t.DisplayObject._tempMatrix.tx=-s.x;_t.DisplayObject._tempMatrix.ty=-s.y;o.render(this.phaser,_t.DisplayObject._tempMatrix);return o};M._snapTempMatrix=new _t.Matrix;M.prototype._snapshotAsRenderTexture=function(t,e,i,r){if(!this.phaser){return new pt.RenderTexture(0,0)}var a=t;var n=this.getWorldScale();if(!a){a=pt.Bounds.getBounds(this)}e=e||a.width*n.x;i=i||a.height*n.y;var s=e/a.width;var o=i/a.height;r=r||this.game.resolution;M._snapTempMatrix.a=s;M._snapTempMatrix.d=o;M._snapTempMatrix.tx=-a.x*s;M._snapTempMatrix.ty=-a.y*o;var h=this.game.phaser;var l=new pt.RenderTexture(1,1,h.renderer,h.scale.scaleMode,r);l.resize(e,i,true);l.render(this.phaser,M._snapTempMatrix);return l};M.prototype.snapshotAsImage=function(t,e,i,r,a){var n=this._snapshotAsRenderTexture(t,e,i,r);var s=n.getBase64();n.destroy(true);var o=new Image;o.src=s;if(a){o.onload=function(){a(o)}}return o};M.prototype.snapshotAsAtlas=function(t,e,i,r,a){var n=this._snapshotAsRenderTexture(e,i,r,a);var s=this.game.assets._cache;if(s.checkImageKey(t))s.removeImage(t,false);var o=pt.AssetUtil.addAtlasFromImage(this.game,t,t,n.getCanvas());return o};var N=pt.Serializer=function(t){this.game=t};N.prototype={};N.prototype.constructor=N;N.customDeserializers={};N.AUTO=0;N.INT=1;N.INTS=2;N.NUMBER=3;N.NUMBERS=4;N.BOOLEAN=5;N.BOOLEANS=6;N.STRING=7;N.STRINGS=8;N.MAPPING=9;N.TEXTURE=10;N.TEXTURES=11;N.AUDIO=12;N.AUDIOS=13;N.COLOR=14;N.COLORS=15;N.PREFAB=16;N.PREFABS=17;N.NODE=18;N.NODES=19;N.SCRIPT=20;N.SCRIPTS=21;N.GEOM=22;N.GEOMS=23;N.POINT=24;N.POINTS=25;N.RECTANGLE=26;N.RECTANGLES=27;N.CIRCLE=28;N.CIRCLES=29;N.ELLIPSE=30;N.ELLIPSES=31;N.FONT=32;N.FONTS=33;N.FILTER=34;N.FILTERS=35;N.TEXTASSET=36;N.TEXTASSETS=37;N.EXCELASSET=38;N.EXCELASSETS=39;N.ACTION=40;N.ACTIONMANAGER=41;N.ANIMATOR=42;N.ANIMATORS=43;N.prototype.buildBundle=function(t,e,i){if(!e.dependences)e.dependences=[];var r={};if(t.getMeta)r=t.getMeta();i=i||{};for(var a in r){this.toJson(t,i,e,a,t[a],r[a])}return{class:t.class,data:i,__json:t.__json}};N.prototype.combineDependence=function(t){var e={};for(var i in t.dependences){var r=t.dependences[i];if(!e[r.uuid])e[r.uuid]=r}return e};N.prototype.restoreBundle=function(t,e,i){if(!i){this.restoreContext={}}this.isRestoring=true;var r=t.data.uuid;if(this.game.nodePool.find(r))r=this.game.math.uuid();var a=this.newNode(t.class,e,r);if(t.__json)a.__json=h(t.__json);var n={};if(a.getMeta)n=a.getMeta();var s=t.data;for(var o in n){if(o==="scripts")continue;this.fromJson(a,s,o,n[o])}if(n.scripts)this.fromJson(a,s,"scripts",n.scripts);if(a.onDeserialized)a.onDeserialized();if(i)return a;a._restoreNodeRef();a._restoreInit();a._dispatchAwake();a._dispatchEnable();this.restoreContext={};this.isRestoring=false;return a};N.prototype.restoreState=function(t){var e=[];this.restoreContext={};this.isRestoring=true;for(var i in t.children){var r=this.restoreBundle(t.children[i],this.game.world,true);e.push(r)}for(var i in e){e[i]._restoreNodeRef()}for(var i in e){e[i]._restoreInit()}for(var i in e){e[i]._dispatchAwake()}for(var i in e){e[i]._dispatchEnable()}this.restoreContext={};this.isRestoring=false};N.prototype.toJson=function(t,e,i,r,a,n){n=n||N.AUTO;if(typeof n==="object"&&typeof n.get==="function"&&typeof n.set==="function"){e[r]=n.get.call(t,t,i);return}switch(n){case N.AUTO:n=this.getAutoType(a);if(n===C)e[r]=a;else this.toJson(t,e,i,r,a,n);break;case N.INT:case N.NUMBER:case N.STRING:case N.BOOLEAN:this._saveCommonType(t,e,i,r,a,n);break;case N.INTS:case N.NUMBERS:case N.STRINGS:case N.BOOLEANS:this._saveCommonArray(t,e,i,r,a,n);break;case N.MAPPING:this._saveMapping(t,e,i,r,a,n);break;case N.COLOR:this.saveColor(t,e,i,r,a);break;case N.COLORS:this._saveArray(t,e,i,r,a,n,this._saveColorItem);break;case N.GEOM:case N.POINT:case N.RECTANGLE:case N.CIRCLE:case N.ELLIPSE:this.saveGeom(t,e,i,r,a);break;case N.POINTS:case N.RECTANGLES:case N.CIRCLES:case N.ELLIPSES:this._saveArray(t,e,i,r,a,n,this._saveGeomItem);break;case N.PREFAB:this.savePrefab(t,e,i,r,a);break;case N.PREFABS:this._saveArray(t,e,i,r,a,n,this._savePrefabItem);break;case N.TEXTURE:this.saveTexture(t,e,i,r,a);break;case N.TEXTURES:this._saveArray(t,e,i,r,a,n,this._saveTextureItem);break;case N.AUDIO:this.saveAudio(t,e,i,r,a);break;case N.AUDIOS:this._saveArray(t,e,i,r,a,n,this._saveAudioItem);break;case N.TEXTASSET:this.saveTextAsset(t,e,i,r,a);break;case N.TEXTASSETS:this._saveArray(t,e,i,r,a,n,this._saveTextAssetItem);break;case N.EXCELASSET:this.saveExcelAsset(t,e,i,r,a);break;case N.EXCELASSETS:this._saveArray(t,e,i,r,a,n,this._saveExcelAssetItem);break;case N.FONT:this.saveFont(t,e,i,r,a);break;case N.FONTS:this._saveArray(t,e,i,r,a,n,this._saveFontItem);break;case N.NODE:this.saveNode(t,e,i,r,a);break;case N.NODES:this._saveArray(t,e,i,r,a,n,this._saveNodeItem);break;case N.FILTER:this._saveFilter(t,e,i,r,a);break;case N.FILTERS:this._saveArray(t,e,i,r,a,n,this._saveFilterItem);break;case N.ACTION:this.saveAction(t,e,i,r,a);break;case N.ACTIONMANAGER:this.saveActionManager(t,e,i,r,a);break;case N.ANIMATOR:if(a instanceof pt.ActionAsset)this.saveAction(t,e,i,r,a);else if(a instanceof pt.ActionManagerAsset)this.saveActionManager(t,e,i,r,a);break;case N.ANIMATORS:if(a){e[r]=[n,[]];for(var s in a){var o=a[s];if(o instanceof pt.ActionAsset)e[r][1].push(this._saveActionItem(o,i));else if(o instanceof pt.ActionManagerAsset)e[r][1].push(this._saveActionManagerItem(o,i))}}break;default:throw new Error("unsupported asset type:"+n)}};N.prototype.fromJson=function(t,e,i,r){r=r||N.AUTO;if(typeof r==="object"&&typeof r.get==="function"&&typeof r.set==="function"){r.set.call(t,t,e[i]);return}var a=e[i];if(a===C){return}if(a===null||a===NaN){t[i]=a;return}switch(a[0]){case N.INT:case N.NUMBER:case N.STRING:case N.BOOLEAN:this._restoreCommonType(t,e,i,a[0]);break;case N.INTS:case N.NUMBERS:case N.STRINGS:case N.BOOLEANS:this._restoreCommonArray(t,e,i,a);break;case N.MAPPING:this._restoreMapping(t,e,i,a);break;case N.COLOR:this.restoreColor(t,e,i,a);break;case N.COLORS:this._restoreArray(t,e,i,a,this._restoreColorItem);break;case N.GEOM:case N.POINT:case N.RECTANGLE:case N.CIRCLE:case N.ELLIPSE:this.restoreGeom(t,e,i,a);break;case N.POINTS:case N.RECTANGLES:case N.CIRCLES:case N.ELLIPSES:this._restoreArray(t,e,i,a,this._restoreGeomItem);break;case N.PREFAB:this.restorePrefab(t,e,i,a);break;case N.PREFABS:this._restoreArray(t,e,i,a,this._restorePrefabItem);break;case N.TEXTURE:this.restoreTexture(t,e,i,a);break;case N.TEXTURES:this._restoreArray(t,e,i,a,this._restoreTextureItem);break;case N.EXCELASSET:this.restoreExcelAsset(t,e,i,a);break;case N.EXCELASSETS:this._restoreArray(t,e,i,a,this._restoreExcelAssetItem);break;case N.AUDIO:this.restoreAudio(t,e,i,a);break;case N.AUDIOS:this._restoreArray(t,e,i,a,this._restoreAudioItem);break;case N.TEXTASSET:this.restoreTextAsset(t,e,i,a);break;case N.TEXTASSETS:this._restoreArray(t,e,i,a,this._restoreTextAssetItem);break;case N.FONT:this.restoreFont(t,e,i,a);break;case N.FONTS:this._restoreArray(t,e,i,a,this._restoreFontItem);break;case N.NODE:this.restoreNode(t,e,i,a);break;case N.NODES:this.restoreNodes(t,e,i,a);break;case N.FILTER:this._restoreFilter(t,e,i,a);break;case N.FILTERS:this._restoreArray(t,e,i,a,this._restoreFilterItem);break;case N.ACTION:this.restoreAction(t,e,i,a);break;case N.ACTIONMANAGER:this.restoreActionManager(t,e,i,a);break;case N.ANIMATORS:var n=[];if(a){for(var s in a[1]){if(a[1][s][0]===N.ACTION)n.push(this._restoreActionItem(a[1][s]));else if(a[1][s][0]===N.ACTIONMANAGER)n.push(this._restoreActionManagerItem(a[1][s]))}}t[i]=n;break;default:throw new Error("unsupported asset type:"+r)}};N.prototype.atob=function(t){return decodeURIComponent(atob(t))};N.prototype.btoa=function(t){return btoa(encodeURIComponent(t))};N.prototype.unpackUTF8=function(t){var e,i,r,a;var n,s;var i=0,r=t.length;e="";while(i<r){a=t[i++];switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(a);break;case 12:case 13:n=t[i++];e+=String.fromCharCode((a&31)<<6|n&63);break;case 14:n=t[i++];s=t[i++];e+=String.fromCharCode((a&15)<<12|(n&63)<<6|(s&63)<<0);break}}return e};N.prototype.findNodeRef=function(t){var e=this.restoreContext[t]?this.restoreContext[t]:t;return this.game.nodePool.find(e)};N.prototype.saveAudio=function(t,e,i,r,a){e[r]=this._saveAudioItem(a,i)};N.prototype.restoreAudio=function(t,e,i,r){t[i]=this._restoreAudioItem(r)};N.prototype._saveAudioItem=function(t,e){if(!(t instanceof pt.SoundAsset))return null;e.dependences.push({key:t.key,uuid:t.uuid});return[N.AUDIO,t.key,t.uuid]};N.prototype._restoreAudioItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);if(!e)e=this.game.assets.findByUUID(t[2]);if(!e){console.error("音频资源尚未载入, 无法反序列化.",t[1]);return null}return e instanceof pt.SoundAsset?e:null};N.prototype.saveAction=function(t,e,i,r,a){e[r]=this._saveActionItem(a,i)};N.prototype.restoreAction=function(t,e,i,r){t[i]=this._restoreActionItem(r)};N.prototype._saveActionItem=function(t,e){if(!(t instanceof pt.ActionAsset))return null;e.dependences.push({key:t.key,uuid:t.uuid});return[N.ACTION,t.uuid]};N.prototype._restoreActionItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof pt.ActionAsset?e:null};N.prototype.saveActionManager=function(t,e,i,r,a){e[r]=this._saveActionManagerItem(a,i)};N.prototype.restoreActionManager=function(t,e,i,r){t[i]=this._restoreActionManagerItem(r)};N.prototype._saveActionManagerItem=function(t,e){if(!(t instanceof pt.ActionManagerAsset))return null;e.dependences.push({key:t.key,uuid:t.uuid});return[N.ACTIONMANAGER,t.uuid]};N.prototype._restoreActionManagerItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof pt.ActionManagerAsset?e:null};N.prototype.saveColor=function(t,e,i,r,a){e[r]=this._saveColorItem(a)};N.prototype.restoreColor=function(t,e,i,r){t[i]=this._restoreColorItem(r)};N.prototype._saveColorItem=function(t){if(!(t instanceof yt))return null;return[N.COLOR,t.toNumber(true)]};N.prototype._restoreColorItem=function(t){if(!t)return null;return new yt(t[1])};N.prototype.saveExcelAsset=function(t,e,i,r,a){e[r]=this._saveExcelAssetItem(a,i)};N.prototype.restoreExcelAsset=function(t,e,i,r){t[i]=this._restoreExcelAssetItem(r)};N.prototype._saveExcelAssetItem=function(t,e){if(!(t instanceof pt.ExcelAsset))return null;e.dependences.push({key:t.key,uuid:t.uuid});return[N.EXCELASSET,t.key,t.uuid]};N.prototype._restoreExcelAssetItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);if(!e)e=this.game.assets.findByUUID(t[2]);if(!e){return null}return e instanceof pt.ExcelAsset?e:null};N.prototype.saveFont=function(t,e,i,r,a){e[r]=this._saveFontItem(a,i)};N.prototype.restoreFont=function(t,e,i,r){t[i]=this._restoreFontItem(r)};N.prototype._saveFontItem=function(t,e){if(t instanceof pt.Font){var i=t}if(i&&i instanceof pt.Font){e.dependences.push({key:i.key,uuid:i.uuid});var r=i.uuid;t=i.key}return[N.FONT,t,r]};N.prototype._restoreFontItem=function(t,e){if(!t)return null;e=e||this;var i=e.game.assets.find(t[1]);if(!i)i=e.game.assets.findByUUID(t[2]);if(!i){i=t[1]}return i};N.prototype.isGeom=function(t){return t instanceof pt.Circle||t instanceof pt.Ellipse||t instanceof pt.Line||t instanceof pt.Matrix||t instanceof pt.Polygon||t instanceof pt.Rectangle||t instanceof pt.RoundedRectangle||t instanceof pt.Point};N.prototype.saveGeom=function(t,e,i,r,a){e[r]=this._saveGeomItem(a,i)};N.prototype.restoreGeom=function(t,e,i,r){t[i]=this._restoreGeomItem(r)};N.prototype._saveGeomItem=function(t,e){var i=N.GEOM;if(t instanceof pt.Point)i=N.POINT;else if(t instanceof pt.Rectangle)i=N.RECTANGLE;else if(t instanceof pt.Circle)i=N.CIRCLE;else if(t instanceof pt.Ellipse)i=N.ELLIPSE;if(t)return[i,t.class,t.toJson()];else return null};N.prototype._restoreGeomItem=function(t){if(!t)return null;var e=pt.Util.findClass(t[1]);var i=new e;i.fromJson(t[2]);return i};N.prototype.saveNode=function(t,e,i,r,a){e[r]=this._saveNodeItem(a,i)};N.prototype.restoreNode=function(t,e,i,r){t["__BUILTIN_NODE__"+i]=r[1]};N.prototype.restoreNodes=function(t,e,i,r){t["__BUILTIN_NODE_ARRAY__"+i]=r[1]};N.prototype._saveNodeItem=function(t,e){if(!(t instanceof pt.Node))return null;return[N.NODE,t.uuid]};N.prototype.savePrefab=function(t,e,i,r,a){e[r]=this._savePrefabItem(a,i)};N.prototype.restorePrefab=function(t,e,i,r){t[i]=this._restorePrefabItem(r)};N.prototype._savePrefabItem=function(t,e){if(!(t instanceof s))return null;e.dependences.push({key:t.uuid,uuid:t.uuid});return[N.PREFAB,t.uuid]};N.prototype._restorePrefabItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof s?e:null};N.prototype.saveTexture=function(t,e,i,r,a){e[r]=this._saveTextureItem(a,i)};N.prototype.restoreTexture=function(t,e,i,r){t[i]=this._restoreTextureItem(r)};N.prototype._saveTextureItem=function(t,e){if(!(t instanceof pt.Texture))return null;var i=t.atlas;e.dependences.push({key:i.key,uuid:i.uuid});return[N.TEXTURE,i.key,i.uuid,t.frame]};N.prototype._restoreTextureItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);if(!e)e=this.game.assets.findByUUID(t[2]);if(!e){console.error("贴图资源尚未载入，无法反序列化。",t[1]);return null}if(!(e instanceof pt.Atlas))return null;return new pt.Texture(e,t[3])};N.prototype.saveTextAsset=function(t,e,i,r,a){e[r]=this._saveTextAssetItem(a,i)};N.prototype.restoreTextAsset=function(t,e,i,r){t[i]=this._restoreTextAssetItem(r)};N.prototype._saveTextAssetItem=function(t,e){if(!(t instanceof pt.TextAsset))return null;e.dependences.push({key:t.key,uuid:t.uuid});return[N.TEXTASSET,t.key,t.uuid]};N.prototype._restoreTextAssetItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);if(!e)e=this.game.assets.findByUUID(t[2]);if(!e){console.error("文本资源尚未载入, 无法反序列化.",t[1]);return null}return e instanceof pt.TextAsset?e:null};N.registerCustomDeserializer=function(t,e){var i=N.customDeserializers;if(i[t]){console.error("Duplicate custom deserializer");return}i[t]=e};N.prototype.getAutoType=function(t){if(t===C||t===null||t===NaN)return C;if(typeof t==="number")return N.NUMBER;if(typeof t==="string")return N.STRING;if(typeof t==="boolean")return N.BOOLEAN;if(t instanceof pt.Node)return N.NODE;if(t instanceof pt.Texture)return N.TEXTURE;if(t instanceof pt.SoundAsset)return N.AUDIO;if(t instanceof pt.TextAsset)return N.TEXTASSET;if(t instanceof pt.ActionAsset)return N.ACTION;if(t instanceof pt.ActionManagerAsset)return N.ACTIONMANAGER;if(this.isGeom(t))return N.GEOM;console.error(t);throw new Error("")};N.prototype.newNode=function(t,e,i){switch(t){case"qc.UIImage":return this.game.add.image(e,i);case"qc.Sprite":return this.game.add.sprite(e,i);case"qc.UIRoot":return new pt.UIRoot(this.game,i);case"qc.Button":return this.game.add.button(e,i);case"qc.Toggle":return new pt.Toggle(this.game,e,i);case"qc.UIText":return this.game.add.text(e,i);case"qc.Sound":return this.game.add.sound(e,i);case"qc.Video":return this.game.add.video(e,i);case"qc.Node":return this.game.add.node(e,i);case"qc.ScrollView":return this.game.add.scrollView(e,i);case"qc.ScrollBar":return this.game.add.scrollBar(e,false,i);case"qc.InputField":return this.game.add.inputField(e,i);case"qc.ProgressBar":return this.game.add.progressBar(e,false,i);case"qc.Slider":return this.game.add.slider(e,false,i);case"qc.Tilemap":return this.game.add.tilemap(e,i);case"qc.TileLayer":return this.game.add.tileLayer(e,i);case"qc.ObjectLayer":return this.game.add.objectLayer(e,i);case"qc.Dom":return this.game.add.dom(e,i);case"qc.Graphics":return this.game.add.graphics(e,i);case"qc.Dropdown":return this.game.add.dropdown(e,i);default:var r=N.customDeserializers[t];if(r)return r(this.game,e,i);else throw new Error("unsupported class:"+t)}};N.prototype._saveCommonType=function(t,e,i,r,a,n){e[r]=[n,a]};N.prototype._restoreCommonType=function(t,e,i,r){t[i]=e[i][1]};N.prototype._saveCommonArray=function(t,e,i,r,a,n){e[r]=[n,[]];if(!a)return;for(var s in a){e[r][1].push(a[s])}};N.prototype._restoreCommonArray=function(t,e,i,r){var a=[];if(r){for(var n in r[1]){a.push(r[1][n])}}t[i]=a};N.prototype._saveMapping=function(t,e,i,r,a,n){e[r]=[n,{}];if(!a)return;for(var s in a){e[r][1][s]=a[s]}};N.prototype._restoreMapping=function(t,e,i,r){var a={};if(r){for(var n in r[1]){a[n]=r[1][n]}}t[i]=a};N.prototype._saveArray=function(t,e,i,r,a,n,s){e[r]=[n,[]];if(!a)return;for(var o in a){var h=a[o];var l=s.call(this,h,i);e[r][1].push(l)}};N.prototype._restoreArray=function(t,e,i,r,a){var n=this;var s=[];if(r){for(var o in r[1]){s.push(a.call(this,r[1][o],n))}}t[i]=s};var B=pt.Camera=function(t){this.phaser=t;t._qc=this;t.roundPx=false};B.prototype={};B.prototype.constructor=B;P.defineProperties(B.prototype,{game:{get:function(){return this.phaser.game._qc}},world:{get:function(){return this.phaser.world._qc}},id:{get:function(){return this.phaser.id}},view:{get:function(){return this.phaser.view}},position:{get:function(){return this.phaser.position},set:function(t){this.phaser.position=t}},size:{get:function(){return new pt.Point(this.view.width,this.view.height)},set:function(t){this.setSize(t.x,t.y)}},x:{get:function(){return this.phaser.x},set:function(t){this.phaser.x=t}},y:{get:function(){return this.phaser.y},set:function(t){this.phaser.y=t}},width:{get:function(){return this.phaser.width},set:function(t){this.phaser.width=t}},height:{get:function(){return this.phaser.height},set:function(t){this.phaser.height=t}},bounds:{get:function(){return this.phaser.bounds},set:function(t){this.phaser.bounds=t}},visible:{get:function(){return this.phaser.visible},set:function(t){this.phaser.visible=t}},target:{get:function(){return this.phaser.target}}});B.FOLLOW_LOCKON=dt.Camera.FOLLOW_LOCKON;B.FOLLOW_PLATFORMER=dt.Camera.FOLLOW_PLATFORMER;B.FOLLOW_TOPDOWN=dt.Camera.FOLLOW_TOPDOWN;B.FOLLOW_TOPDOWN_TIGHT=dt.Camera.FOLLOW_TOPDOWN_TIGHT;B.prototype.follow=function(t,e){if(t===null)this.phaser.unfollow();else this.phaser.follow(t,e)};B.prototype.focusOn=function(t,e){this.phaser.focusOnXY(t,e)};B.prototype.reset=function(){this.phaser.reset()};var L=pt.Game=function(t,e,i,r,a,n,s,o){var h=this;h.onStart=new pt.Signal;h.log=new pt.Log(h);h._debug=new pt.Debug(h);h._device=new pt.Device(h,dt.Device);var l;if(typeof arguments[0]==="object"&&arguments.length===1){l=arguments[0]}else{l={width:t,height:e,parent:i,state:r,transparent:a,physicsConfig:o}}h.debug.on=l.debug;h.device.editor=l.editor;if(l.width>0&&l.height>0){h.fixedGameSize={width:l.width,height:l.height}}else{h.fixedGameSize=null}r=l.state;r=r||{preload:function(){},create:function(){}};var u=r.init;r.init=function(){var t=h.phaser;D.qc_game=h;h._nodePool=new pt.NodePool(h);new pt.SceneManager(t.state);new pt.PluginManager(t.plugins);t.math._qc=new pt.Math(t.rnd);h.timer=new pt.Timer(h);h.time=new pt.Time(h);h.sound=new pt.SoundManager(h);h._assets=new pt.Assets(h,t.load,t.cache);new pt.Stage(t.stage);new pt.Camera(t.camera);new pt.World(t.world);new pt.Input(t.input);h.dirtyRectangle=new pt.DirtyRectangle(t);t.renderer.dirtyRectangle=h.dirtyRectangle;h.dirtyRectangle.enable=l.dirtyRectangles;h.dirtyRectangle.showDirtyRegion=l.dirtyRectanglesShow;h.canvas.style.outline=0;if(h.container&&h.container.style&&h.container.style.setProperty)h.container.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null);h.plugins.add(pt.dragonBonesDriver);h.plugins.add(pt.CleanPIXISpriteRetainer);h._serializer=new pt.Serializer(h);h._storage=new pt.Storage(h);h.phaser.scale.pageAlignHorizontally=true;h.phaser.scale.pageAlignVertically=true;h.phaser.scale.scaleMode=dt.ScaleManager.SHOW_ALL;h.phaser.scale.onSizeChange.add(function(){h.device.resetOrientation()});h.device.resetOrientation();if(u){u.call(r)}if(D.qc.initGame)D.qc.initGame(h);h.onStart.dispatch()};l.state=r;l.renderer=l.renderer==null?dt.AUTO:l.renderer;if(!("antialias"in l)){var f;switch(l.renderer){case dt.HEADLESS:case dt.CANVAS:f=false;break;case dt.AUTO:var c=function(){try{if(D.__wx)return true;var t=document.createElement("canvas");t.screencanvas=false;return!!D.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return false}}();f=c?true:false;default:f=true;break}l.antialias=f}l.disableVisibilityChange=l.runInBackground;l.disableVisibilityChange=l.disableVisibilityChange==null?true:l.disableVisibilityChange;if(!l.resolution){var p=D.devicePixelRatio;if(typeof l.resolutionRatio==="number"){l.resolution=1+Math.max(0,(p-1)*l.resolutionRatio)}else{if(h.device.desktop)l.resolution=p;else l.resolution=1+Math.max(0,(p-1)/4)}}var d=l.backgroundColor;if(d==null){d=yt.background}if(d instanceof yt){d=d.toNumber()}l.backgroundColor=d;h.phaser=new dt.Game(l);h.phaser._qc=this;this.phaser._calcTransformCount=0;h.phaser.forceSingleUpdate=true;h.add=new ne(h)};P.defineProperties(L.prototype,{id:{get:function(){return this.phaser.id}},config:{get:function(){return this.phaser.config},set:function(t){this.phaser.config=t}},physicsConfig:{get:function(){return this.phaser.physicsConfig},set:function(t){this.phaser.physicsConfig=t}},parent:{get:function(){return this.phaser.parent}},width:{get:function(){return this.phaser.width}},height:{get:function(){return this.phaser.height}},resolution:{get:function(){return this.phaser.resolution}},transparent:{get:function(){return this.phaser.renderer.transparent},set:function(t){this.phaser.renderer.transparent=t}},antialias:{get:function(){return this.phaser.antialias},set:function(t){var e=this.phaser;if(e.antialias===t)return;e.antialias=t;e.stage.smoothed=t;for(var i in _t.BaseTextureCache){_t.BaseTextureCache[i].scaleMode=t?_t.scaleModes.LINEAR:_t.scaleModes.NEAREST;if(this.phaser.renderType===dt.WEBGL)_t.BaseTextureCache[i].dirty()}this.dirtyRectangle.forceDirty=true}},isBooted:{get:function(){return this.phaser.isBooted}},isRunning:{get:function(){return this.phaser.isRunning}},camera:{get:function(){return this.phaser.camera._qc}},canvas:{get:function(){return this.phaser.canvas}},onPause:{get:function(){return this.phaser.onPause}},onResume:{get:function(){return this.phaser.onResume}},onBlur:{get:function(){return this.phaser.onBlur}},onFocus:{get:function(){return this.phaser.onFocus}},state:{get:function(){return this.phaser.state._qc}},scene:{get:function(){return this.phaser.state._qc}},stage:{get:function(){return this.phaser.stage._qc}},container:{get:function(){return this.phaser.canvas.parentNode}},input:{get:function(){return this.phaser.input._qc}},plugins:{get:function(){return this.phaser.plugins._qc}},math:{get:function(){return this.phaser.math._qc}},assets:{get:function(){return this._assets}},world:{get:function(){if(!this.phaser.world)return null;return this.phaser.world._qc}},serializer:{get:function(){return this._serializer}},nodePool:{get:function(){return this._nodePool}},storage:{get:function(){return this._storage}},paused:{get:function(){return this.phaser.paused},set:function(t){this.phaser.paused=t}},stepCount:{get:function(){return this.phaser.stepCount}},stepping:{get:function(){return this.phaser.stepping}},device:{get:function(){return this._device}},debug:{get:function(){return this._debug}}});L.prototype.shutdown=function(){this.input.enable=false;this.state.clearWorld(true);this.assets.clear();this.phaser.destroy()};L.prototype.enableStep=function(){this.phaser.enableStep()};L.prototype.disableStep=function(){this.phaser.disableStep()};L.prototype.step=function(){this.phaser.step()};L.prototype.updateScale=function(t){var e=this.phaser.scale;if(e){e._lastUpdate=0;if(t){e.preUpdate()}}};L.prototype.fullScreen=function(){var r=this;if(r._adjustToFullScreen){return}var a,n;r._adjustToFullScreen=function(t){if(r.isBooted&&r.input.inputting){return}var e=document.documentElement.clientWidth||D.innerWidth;if(D.innerWidth&&D.innerWidth<e){e=D.innerWidth}var i=document.documentElement.clientHeight||D.innerHeight;if(D.innerHeight&&D.innerHeight<i){i=D.innerHeight}if(a===e&&n===i&&!t){return}a=e;n=i;if(r.device.iOS){r.setGameSize(e-5,i+5);r.phaser.time.events.add(1,function(){r.setGameSize(e,i)})}else{r.setGameSize(e,i)}if(r.container&&r.container.style){r.container.style.width=e+"px";r.container.style.height=i+"px"}r.updateScale();if(r.device.phaser.UCBrowser){D.scrollTo(0,1);setTimeout(function(){var t=document.createElement("div");t.style.position="absolute";t.style.top=i+"px";t.style.width="100px";t.style.height="100px";document.body.appendChild(t);D.scrollTo(0,i);setTimeout(function(){D.scrollTo(0,1);document.body.removeChild(t)},10)},10)}};D.addEventListener("orientationchange",r.updateGameLayout.bind(r,false),false);D.addEventListener("resize",r.updateGameLayout.bind(r,false),false);D.scrollTo(0,1);r._adjustToFullScreen()};L.prototype.setGameSize=function(t,e){if(!this.fixedGameSize){this.phaser.scale.setGameSize(t,e)}this.updateScale()};L.prototype.updateGameLayout=function(t){if(this._adjustToFullScreen){this._adjustToFullScreen(t)}this.world.updateDomRoot()};L.prototype.update=function(t){var e=this.phaser;if(this.time){var t=this.time.now;if(!this._lastUpdateGameSizeTime||t-this._lastUpdateGameSizeTime>1e3){this._lastUpdateGameSizeTime=t;this.updateGameLayout()}}e._calcTransformCount=0;e.time.update(t);var i=1/e.time.desiredFps;try{if(e._kickstart){this.updateLogic(i);e._calcTransformCount=0;e.stage.updateTransform();this.updateRender(e.time.slowMotion*e.time.desiredFps);e._kickstart=false;return}if(e._spiraling>1&&!e.forceSingleUpdate){if(e.time.time>e._nextFpsNotification){e._nextFpsNotification=e.time.time+1e3*10;e.fpsProblemNotifier.dispatch()}e._deltaTime=0;e._spiraling=0;e.updateRender(e.time.slowMotion*e.time.desiredFps)}else{var r=e.time.slowMotion*1e3/e.time.desiredFps;e._deltaTime+=Math.max(Math.min(r*3,e.time.elapsed),0);var a=0;e.updatesThisFrame=Math.floor(e._deltaTime/r);if(e.forceSingleUpdate){e.updatesThisFrame=Math.min(1,e.updatesThisFrame)}var n=false;while(e._deltaTime>=r){e._deltaTime-=r;e.currentUpdateID=a;if(!n){if(!this._paused&&!this.pendingStep){n=true}}if(n){e.updateFrameDelta();this.updateLogic(i);e._calcTransformCount=0;e.stage.updateTransform()}a++;if(e.forceSingleUpdate&&a===1){break}}if(a>e._lastCount){e._spiraling++}else if(a<e._lastCount){e._spiraling=0}e._lastCount=a;if(n)this.updateRender(e._deltaTime/r);return n}}catch(t){this.log.error("{0}",t)}};L.prototype.updateLogic=function(t){var e=Date.now();var i=this.phaser;if(!i._paused&&!i.pendingStep){if(this.timer)this.timer.update(this.time.now);if(i.stepping){i.pendingStep=true}var r=Date.now();i.scale.preUpdate();i.debug.preUpdate();i.world.camera.preUpdate();i.state.preUpdate(t);i.plugins.preUpdate(t);i.stage.preUpdate();i.physics.preUpdate();this.debug.preUpdate+=Date.now()-r;r=Date.now();i.input.update();i.state.update();i.stage.update();i.tweens.update(t);i.sound.update();i.physics.update();i.plugins.update();this.debug.update+=this.time.now-r;r=Date.now();i.stage.postUpdate();i.plugins.postUpdate();this.debug.postUpdate+=Date.now()-r;r=Date.now()}else{i.scale.pauseUpdate();i.state.pauseUpdate();i.debug.preUpdate()}this.debug.logic+=Date.now()-e};L.prototype.updateRender=function(t){var e=Date.now();var i=this.phaser;if(i.lockRender){return}i.state.preRender(t);i.renderer.render(i.stage);i.plugins.render(t);i.state.render(t);i.plugins.postRender(t);pt.CanvasPool.postRender();this.debug.render+=Date.now()-e};dt.Game.prototype.gamePaused=function(t){if(!this._paused){this._paused=true;this.time.gamePaused();this.sound.setMute();this.onPause.dispatch(t);if(this.device.cordova&&this.device.iOS){this.lockRender=true}}};dt.Game.prototype.gameResumed=function(t){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();this.sound.unsetMute();this.onResume.dispatch(t);if(this.device.cordova&&this.device.iOS){this.lockRender=false}}};var F=dt.Game.prototype.parseConfig;dt.Game.prototype.parseConfig=function(t){F.call(this,t);if("antialias"in t){this.antialias=!!t["antialias"]}};var k=dt.RequestAnimationFrame.prototype.updateSetTimeout;dt.RequestAnimationFrame.prototype.updateSetTimeout=function(){try{k.call(this)}catch(t){this.game._qc.log.error("Error：{0}",t)}};var U=dt.RequestAnimationFrame.prototype.updateRAF;dt.RequestAnimationFrame.prototype.updateRAF=function(t){try{U.call(this,t)}catch(t){this.game._qc.log.error("Error：{0}",t)}};dt.Game.prototype.updateFrameDelta=function(t){var e=this,i=e.time;var r=i.time;var a=e.__lastFrameTime?r-e.__lastFrameTime:t;e.__lastFrameTime=r;i.frameDeltaTime=a/i.slowMotion;i._totalEscapeTime=i.frameDeltaTime+(i._totalEscapeTime||0)};var j=pt.Plugin=dt.Plugin;var W=pt.PluginManager=function(t){t._qc=this;this.phaser=t};W.prototype={};W.prototype.constructor=W;P.defineProperties(W.prototype,{game:{get:function(){return this.phaser.game._qc}},plugins:{get:function(){return this.phaser.plugins}}});W.prototype.add=function(t){var t=this.phaser.add.apply(this.phaser,arguments);t.game=this.game;return t};W.prototype.remove=function(t){this.phaser.remove(t)};W.prototype.removeAll=function(){this.phaser.removeAll()};W.prototype.destroy=function(){this.phaser.destroy();delete this.phaser};pt.Signal=dt.Signal;pt.SignalBinding=dt.SignalBinding;var V=pt.Stage=function(t){this.phaser=t;t._qc=this};V.prototype={};V.prototype.constructor=V;P.defineProperties(V.prototype,{game:{get:function(){return this.phaser.game._qc}},name:{get:function(){return this.phaser.name},set:function(t){this.phaser.name=t}},runInBackground:{get:function(){return this.phaser.disableVisibilityChange},set:function(t){this.phaser.disableVisibilityChange=t}},useLanguages:{get:function(){return this.phaser.useLanguages},set:function(t){this.phaser.useLanguages=t}},backgroundColor:{get:function(){return new yt(this.phaser.backgroundColor)},set:function(t){t=t||yt.background;if(!(t instanceof yt))throw new Error("Expected qc.Color");this.phaser.backgroundColor=t.toNumber()}},x:{get:function(){return 0}},y:{get:function(){return 0}},rect:{get:function(){return new pt.Rectangle(0,0,this.game.width,this.game.height)}},pivotX:{get:function(){return 0},set:function(t){throw new Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(t){throw new Error("pivotY cannot be modified")}},worldTransform:{get:function(){return this.phaser.worldTransform}}});V.prototype.updateTransform=function(){this.phaser.updateTransform()};V.prototype.destroy=function(){this.phaser.destroy();delete this.phaser};var z=pt.State=function(){var t=new dt.State;this.phaser=t;t._qc=this};z.prototype={};z.prototype.constructor=z;P.defineProperties(z.prototype,{game:{get:function(){return this.phaser.game}},key:{get:function(){return this.phaser.key},set:function(t){this.phaser.key=t}},add:{get:function(){return this.phaser.add._qc},set:function(t){this.phaser.add=t.phaser;t.phaser._qc=t}},make:{get:function(){return this.phaser.make._qc},set:function(t){this.phaser.make=t.phaser;t.phaser._qc=t}},camera:{get:function(){return this.phaser.camera._qc},set:function(t){this.phaser.camera=t.phaser;t.phaser._qc=t}},assets:{get:function(){return this._assets},set:function(t){this._assets=t}},input:{get:function(){return this.phaser.input._qc},set:function(t){this.phaser.input=t.phaser;t.phaser._qc=t}},math:{get:function(){return this.phaser.math._qc},set:function(t){this.phaser.math=t.phaser;t.phaser._qc=t}},time:{get:function(){return this.phaser.time._qc},set:function(t){this.phaser.time=t.phaser;t.phaser._qc=t}},tweens:{get:function(){return this.phaser.tweens._qc},set:function(t){this.phaser.tweens=t.phaser;t.phaser._qc=t}},world:{get:function(){if(!this.phaser.world)return null;return this.phaser.world._qc},set:function(t){this.phaser.world=t.phaser;t.phaser._qc=t}},physics:{get:function(){return this.phaser.physics._qc},set:function(t){this.phaser.physics=t.phaser;t.phaser._qc=t}}});var G=pt.SceneManager=function(t){t._qc=this;this.phaser=t;this._onPreload=new pt.Signal;this._onCreate=new pt.Signal;this.onStartLoad=new pt.Signal;this.onEndLoad=new pt.Signal};G.prototype={};G.prototype.constructor=G;P.defineProperties(G.prototype,{game:{get:function(){return this.phaser.game._qc}},entry:{get:function(){return this._entry},set:function(t){this._entry=t}},list:{get:function(){return this._list},set:function(t){this._list=t;var r=this;for(var e in t){var i=t[e];var a={preload:function(){r._onPreload.dispatch();var t=r.game.assets.find(r.current+".bin");if(t){for(var e in t.dependences){var i=t.dependences[e];r.game.assets.loadByUUID(i.uuid,function(t){if(!t){r.game.log.important("场景的依赖资源({0})加载失败.",i.uuid);if(typeof r.game.loadingProcessCallback=="function"){r.game.loadingProcessCallback(i.key)}}})}}},create:function(){try{r._parse()}catch(t){r.game.log.error("Parse scene fail：{0}",t);pt.Util.popupError(t.message)}r.loading=false;r._onCreate.dispatch();r.onEndLoad.dispatch(a)}};this.phaser.add(i,a,false)}}},loading:{get:function(){return this._loading||false},set:function(t){this._loading=t}},current:{get:function(){return this.phaser.current}}});G.prototype.download=function(t,e){t=t||this.entry;var i=t+".bin";this.game.log.trace("Start downloading scene:{0}",t);this.game.assets.beginBatchLoad();this.game.assets.load(i,i,e);this.game.assets.endBatchLoad()};G.prototype.load=function(e,i,r,a){var n=this;if(n.loading){console.warn("Cannot call when switching scene.");return}e=e||n.entry;if(!/\//.test(e))e="Assets/scene/"+e;if(n.list.indexOf(e)<0){n.game.log.error("Scene:{0} not exists",e);return}n.loading=true;n.onStartLoad.dispatch(e);n.clearWorld();if(i!==true)i=false;if(i)n.game.assets.clear();n.download(e,function(t){if(typeof r==="function")n._onPreload.addOnce(r);if(typeof a==="function")n._onCreate.addOnce(a);n.phaser.start(e,false,i)})};G.prototype.clearWorld=function(e){var t=this.game.world.children.slice(0);t.forEach(function(t){if(e||!t.ignoreDestroy){t.destroy()}})};G.prototype.destroy=function(){this.entry=C;this.list=[];this.phaser.destroy()};G.prototype._parse=function(){var t=this.current+".bin";var e=this.game.assets.find(t);if(e){var i=e.json.data;this.game.serializer.restoreState(i);this.game.world._prefab=t}else{this.game.log.error("Can not find scene {0} from assets",state)}};var Y=pt.World=function(t){var e=this;e.onModelChange=new pt.Signal;pt.Node.call(e,t,e);e.name="world";e.onSizeChange.add(function(){e.relayout()});e._toDestroyQ=[];if(D.__wx){e.backDomRoot=null;e.frontDomRoot=null;return}e.game.container.style.overflow="hidden";e.backDomRoot=document.createElement("div");e.backDomRoot.style.position="absolute";e.backDomRoot.style.left="0px";e.backDomRoot.style.top="0px";e.backDomRoot.style.overflow="hidden";e.game.container.insertBefore(e.backDomRoot,e.game.canvas);e.frontDomRoot=document.createElement("div");e.frontDomRoot.style.position="absolute";e.frontDomRoot.style.left="0px";e.frontDomRoot.style.top="0px";e.frontDomRoot.style.overflow="hidden";e.game.container.appendChild(e.frontDomRoot)};Y.prototype=P.create(pt.Node.prototype);Y.prototype.constructor=Y;Y.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.Node.prototype.getMeta.call(this);delete e["uuid"];return e};Y.prototype.relayout=function(){var t=this.children;for(var e=0;e<t.length;e++){t[e].relayout()}};P.defineProperties(Y.prototype,{bounds:{get:function(){return this.phaser.bounds},set:function(t){this.phaser.setBounds(t.x,t.y,t.width,t.height)}},camera:{get:function(){return this.phaser.camera}},width:{get:function(){if(this._editorWidth!==C)return this._editorWidth;return this.phaser.width},set:function(t){if(this.width===t)return;this.phaser.width=t;this.phaser.displayChanged(pt.DisplayChangeStatus.SIZE);P.getOwnPropertyDescriptor(pt.Node.prototype,"width").set.call(this,t)}},height:{get:function(){if(this._editorHeight!==C)return this._editorHeight;return this.phaser.height},set:function(t){if(this.height===t)return;this.phaser.height=t;this.phaser.displayChanged(pt.DisplayChangeStatus.SIZE);P.getOwnPropertyDescriptor(pt.Node.prototype,"height").set.call(this,t)}},centerX:{get:function(){return this.phaser.centerX}},centerY:{get:function(){return this.phaser.centerY}},pivotX:{get:function(){return 0},set:function(t){throw new Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(t){throw new Error("pivotY cannot be modified")}},onSizeChange:{get:function(){return this.game.phaser.scale.onSizeChange}}});Y.prototype.preUpdate=function(){this._toDestroyQ.forEach(function(t){t.destroyImmediately()});this._toDestroyQ.length=0};Y.prototype.addToDestroy=function(t){this._toDestroyQ.push(t)};Y.prototype.updateDomRoot=function(){if(D.__wx||this.game.isBooted&&this.game.input.inputting){return}var t=this.frontDomRoot.style;var e=this.backDomRoot.style;var i=this.game.canvas.style;t.width=e.width=i.width;t.height=e.height=i.height;t.marginLeft=e.marginLeft=i.marginLeft;t.marginTop=e.marginTop=i.marginTop;t.marginRight=e.marginRight=i.marginRight;t.marginBottom=e.marginBottom=i.marginBottom};var H=pt.Input=function(t){var e=this;t._qc=e;var i=t.destroy;t.destroy=function(){e.destroy();i.call(t)};var r=t.update;t.update=function(){e.update();r.call(t)};e.phaser=t;e.game=t.game._qc;e._inputting=0;e.cursorPosition=new pt.Point(NaN,NaN);e.onKeyDown=new dt.Signal;e.onKeyUp=new dt.Signal;e.onKeyRepeat=new dt.Signal;e.onCursorMove=new dt.Signal;e.onWheel=new dt.Signal;e.onPointerUp=new dt.Signal;e.onPointerDown=new dt.Signal;e.onPointerMove=new dt.Signal;e.nativeMode=false;e.keyboard=new pt.Keyboard(this);e.mouse=new pt.Mouse(this);e.touch=new pt.Touch(this);e.module=new pt.BaseInputModule(e.game,e);e._init()};H.prototype={};H.prototype.constructor=H;P.defineProperties(H.prototype,{wheelDeltaX:{get:function(){return this._wheelDeltaX}},wheelDeltaY:{get:function(){return this._wheelDeltaY}},keyCount:{get:function(){return this.keyboard.keyCount}},keyCodes:{get:function(){return this.keyboard.keyCodes}},mouseCount:{get:function(){return this.mouse.mouseCount}},mouseIds:{get:function(){return this.mouse.mouseIds}},touchCount:{get:function(){return this.touch.touchCount}},touchIds:{get:function(){return this.touch.touchIds}},pointerCount:{get:function(){return this.mouseCount+this.touchCount}},pointers:{get:function(){return this.mouseIds.concat(this.touchIds)}},enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},inputting:{get:function(){return this._inputting>0}}});H.prototype._init=function(){var t=this;t.phaser.game.onBlur.add(this._onBlur,this);t.keyboard.onKeyUp.add(this.processKeyUp,this);t.keyboard.onKeyDown.add(this.processKeyDown,this);t.keyboard.onKeyRepeat.add(this.processKeyRepeat,this);t.mouse.onMouseDown.add(this.processPointerDown,this);t.mouse.onMouseUp.add(this.processPointerUp,this);t.mouse.onMousePressMove.add(this.processPointerMove,this);t.mouse.onMouseMove.add(this.processMouseMove,this);t.mouse.onMouseWheel.add(this.processMouseWheel,this);t.touch.onTouchStart.add(this.processPointerDown,this);t.touch.onTouchEnd.add(this.processPointerUp,this);t.touch.onTouchMove.add(this.processPointerMove,this);t.enable=true};H.prototype.destroy=function(){this.phaser.game.onBlur.remove(this._onBlur,this);this.keyboard.onKeyUp.remove(this.processKeyUp,this);this.keyboard.onKeyDown.remove(this.processKeyDown,this);this.keyboard.onKeyRepeat.remove(this.processKeyRepeat,this);this.mouse.onMouseDown.remove(this.processPointerDown,this);this.mouse.onMouseUp.remove(this.processPointerUp,this);this.mouse.onMousePressMove.remove(this.processPointerDown,this);this.mouse.onMouseMove.remove(this.processMouseMove,this);this.mouse.onMouseWheel.remove(this.processMouseWheel,this);this.touch.onTouchStart.remove(this.processPointerDown,this);this.touch.onTouchEnd.remove(this.processPointerUp,this);this.touch.onTouchMove.remove(this.processPointerMove,this);if(this.module)this.module.destroy();if(this.keyboard)this.keyboard.destroy();if(this.mouse)this.mouse.destroy();if(this.touch)this.touch.destroy();this.onKeyDown.removeAll();this.onKeyUp.removeAll();this.onKeyRepeat.removeAll();this.onCursorMove.removeAll();this.onWheel.removeAll();this.onPointerDown.removeAll();this.onPointerMove.removeAll();this.onPointerUp.removeAll();this.phaser=null;this.module=null;this.keyboard=null;this.mouse=null;this.touch=null};H.prototype._setEnable=function(t){if(this._enable===t){return}this._enable=t;if(this.touch)this.touch.enable=t;if(this.mouse)this.mouse.enable=t;if(this.keyboard)this.keyboard.enable=t};H.prototype.update=function(){this._wheelDeltaX=0;this._wheelDeltaY=0;this.keyboard.update();this.touch.update();this.mouse.update();this.module.update()};H.prototype._onBlur=function(){this.module.lossFocus();this.keyboard.lossFocus();this.mouse.lossFocus();this.touch.lossFocus()};H.prototype.processKeyDown=function(t,e){this.onKeyDown.dispatch(t,e)};H.prototype.processKeyUp=function(t,e){this.onKeyUp.dispatch(t,e)};H.prototype.processKeyRepeat=function(t,e){this.onKeyRepeat.dispatch(t,e)};H.prototype.isKeyDown=function(t){return this.keyboard.isKeyDown(t)};H.prototype.isAnyKeyDown=function(){return this.keyboard.isAnyKeyDown()};H.prototype.isAnyKey=function(){return this.keyboard.isAnyKey()};H.prototype.isAltDown=function(){return this.isKeyDown(pt.Keyboard.ALT)};H.prototype.isControlDown=function(){return this.isKeyDown(pt.Keyboard.CONTROL)};H.prototype.isShiftDown=function(){return this.isKeyDown(pt.Keyboard.SHIFT)};H.prototype.isMetaDown=function(){return this.isKeyDown(pt.Keyboard.META)||this.isKeyDown(pt.Keyboard.META_RWIN)||this.isKeyDown(pt.Keyboard.META_RMAC)};H.prototype.hasCursor=function(){return!isNaN(this.cursorPosition.x)&&!isNaN(this.cursorPosition.y)};H.prototype.isMouse=function(t){return t<0&&t>=pt.Mouse.BUTTON_FORWORD};H.prototype.isAnyMouse=function(){return this.mouse.isAnyMouse()};H.prototype.isAnyMouseDown=function(){return this.mouse.isAnyMouseDown()};H.prototype.isMouseDown=function(t){return this.mouse.isMouseDown(t)};H.prototype.isAnyTouch=function(){return this.touch.isAnyTouch()};H.prototype.isAnyTouchStart=function(){return this.touch.isAnyTouchStart()};H.prototype.isTouchStart=function(t){return this.touch.isTouchStart(t)};H.prototype.isAnyPointer=function(){return this.touch.isAnyTouch()||this.mouse.isAnyMouse()};H.prototype.isAnyPointerStart=function(){return this.touch.isAnyTouchStart()||this.mouse.isAnyMouseDown()};H.prototype.isPointerStart=function(t){return this.isMouse(t)?this.isMouseDown(t):this.isTouchStart(t)};H.prototype.getPointer=function(t){if(t<0&&t>=pt.Mouse.BUTTON_FORWORD)return this.mouse.getMouseById(t);return this.touch.getTouchById(t)};H.prototype.processMouseMove=function(t,e){this.cursorPosition.x=t;this.cursorPosition.y=e;this.onCursorMove.dispatch(t,e)};H.prototype.processMouseWheel=function(t,e){this._wheelDeltaX=t;this._wheelDeltaY=e;this.onWheel.dispatch(t,e)};H.prototype.processPointerDown=function(t,e,i){this.onPointerDown.dispatch(t,e,i)};H.prototype.processPointerUp=function(t,e,i){this.onPointerUp.dispatch(t,e,i)};H.prototype.processPointerMove=function(t,e,i){this.onPointerMove.dispatch(t,e,i)};H.prototype.ignoreDomEvent=function(t){var e=this;var i=e.findDomNodeWithEvent(t);return i&&i.interactive&&i.hitArea};H.prototype.findDomNodeWithEvent=function(t){var e=this;var i=t.target;if(!i||i===e.game.world.frontDomRoot||i===e.game.world.backDomRoot||i===e.game.canvas.parentNode){return null}while(i&&!i._qc){i=i.parentNode}if(!i){return null}return i._qc};var X=pt.Debug=function(t){var e=this;e._game=t;e.on=false;e.animation=0;e.total=0;e.logic=0;e.render=0;e.preUpdate=0;e.update=0;e.postUpdate=0;e.clientId=0};X.prototype={};X.prototype.constructor=X;P.defineProperties(X.prototype,{game:{get:function(){return this._game}},on:{get:function(){return this._on||false},set:function(t){this._on=t;if(t){this.game.log.enableTrace=true}}},remoteLogUrl:{set:function(t){}}});var q=pt.Device=function(t,e){var i=this;i.phaser=e;i._game=t;i._orientation=q.PORTRAIT;i.onOrientationChange=new pt.Signal};q.prototype={};q.prototype.constructor=X;P.defineProperties(q.prototype,{game:{get:function(){return this._game}},desktop:{get:function(){if(this.phaser.initialized)return this.phaser.desktop;else{if(this._isDesktop===C)this.checkOS();return this._isDesktop}}},iOS:{get:function(){return this.phaser.iOS}},android:{get:function(){return this.phaser.android}},webGL:{get:function(){return this.phaser.webGL}},vibration:{get:function(){return this.phaser.vibration}},browser:{get:function(){if(this.phaser.chrome)return q.CHROME;if(this.phaser.arora)return q.ARORA;if(this.phaser.epiphany)return q.EPIPHANY;if(this.phaser.firefox)return q.FIREFOX;if(this.phaser.trident)return q.TRIDENT;if(this.phaser.ie)return q.IE;if(this.phaser.mobileSafari)return q.MOBILE_SAFARI;if(this.phaser.midori)return q.MIDORI;if(this.phaser.opera)return q.OPERA;if(this.phaser.safari)return q.SAFARI;if(this.phaser.silk)return q.SILK;if(this.phaser.UCBrowser)return q.UCBROWSER;return q.UNKNOW}},resolution:{get:function(){return D.devicePixelRatio}},fullscreen:{get:function(){return this.phaser.fullscreen}},editor:{get:function(){return this._editor||false},set:function(t){this._editor=t;if(t){this.game.debug.on=true}}},orientation:{get:function(){return this._orientation},set:function(t){if(this.orientation===t)return;this._orientation=t;this.onOrientationChange.dispatch(t)}}});q.UNKNOW=-1;q.CHROME=0;q.ARORA=1;q.EPIPHANY=2;q.FIREFOX=3;q.IE=4;q.TRIDENT=5;q.MOBILE_SAFARI=6;q.MIDORI=7;q.OPERA=8;q.SAFARI=9;q.WEBAPP=10;q.SILK=11;q.UCBROWSER=12;q.AUTO=0;q.PORTRAIT=1;q.LANDSCAPE=2;q.prototype.resetOrientation=function(){if(this.game.world.width>this.game.world.height)this.orientation=q.LANDSCAPE;else this.orientation=q.PORTRAIT};q.prototype.isCanvasRenderer=function(){return this.game.phaser.renderType===dt.CANVAS};q.prototype.isWebGLRenderer=function(){return this.game.phaser.renderType===dt.WEBGL};q.prototype.checkOS=function(){var t=navigator.userAgent;var e={};if(/Playstation Vita/.test(t)){e.vita=true}else if(/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)){e.kindle=true}else if(/Android/.test(t)){e.android=true}else if(/CrOS/.test(t)){e.chromeOS=true}else if(/iP[ao]d|iPhone/i.test(t)){e.iOS=true}else if(/Linux/.test(t)){e.linux=true}else if(/Mac OS/.test(t)){e.macOS=true}else if(/Windows/.test(t)){e.windows=true;if(/Windows Phone/i.test(t)){e.windowsPhone=true}}var i=/Silk/.test(t);this._isDesktop=false;if(e.windows||e.macOS||e.linux&&!i||e.chromeOS){this._isDesktop=true}if(e.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t)){this._isDesktop=false}};pt.RenderTexture=_t.RenderTexture;pt.RenderTexture.prototype.resize=function(t,e,i){if(t===this.width&&e===this.height)return;this.valid=t>0&&e>0;this.width=t;this.height=e;this.frame.width=this.crop.width=t*this.resolution;this.frame.height=this.crop.height=e*this.resolution;if(i){this.baseTexture.width=Math.round(this.width*this.resolution);this.baseTexture.height=Math.round(this.height*this.resolution)}if(this.renderer.type===_t.WEBGL_RENDERER){this.projection.x=this.width/2;this.projection.y=-this.height/2}if(!this.valid)return;this.textureBuffer.resize(Math.round(this.width*this.resolution),Math.round(this.height*this.resolution))};pt.RenderTexture.prototype.directRenderWebGL=function(t,e,i){if(!this.valid)return;var r={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=e?e.x:0;this.renderer.offset.y=e?e.y:0;var a=this.renderer.gl;if(a.isContextLost()){return false}if(!a.replace){var n=a.viewport;a.viewport=function(t,e,i,r){if(i===0||r===0||i*r<0){console.log("viewPort:",t,e,i,r,i*r)}n.call(a,t,e,i,r)};a.replace=true}a.viewport(0,0,this.width*this.resolution,this.height*this.resolution);a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(i)this.textureBuffer.clear();var s=a.getError();if(s){console.log("webgl gl.getError(",s,")")}this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer);this.renderer.spriteBatch.dirty=true;this.renderer.offset.x=r.x;this.renderer.offset.y=r.y};_t.RenderTexture.prototype.directRenderCanvas=function(t,e,i){if(!this.valid)return;var r={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=e?e.x:0;this.renderer.offset.y=e?e.y:0;if(i)this.textureBuffer.clear();var a=this.textureBuffer.context;var n=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(t,a);this.renderer.resolution=n;this.renderer.offset.x=r.x;this.renderer.offset.y=r.y};pt.RenderTexture.prototype.renderWebGL=function(t,e,i){if(!this.valid)return;t.game._qc.renderInRenderTexture=true;var r=t.getWorldTransform();r.identity();r.translate(0,this.projection.y*2);if(e)r.append(e);r.scale(1,-1);t.worldAlpha=1;t._isSubNeedCalcTransform=true;var a=t.children;for(var n=0,s=a.length;n<s;n++){a[n].updateTransform()}t.game._qc.renderInRenderTexture=false;var o=this.renderer.gl;o.viewport(0,0,this.width*this.resolution,this.height*this.resolution);o.bindFramebuffer(o.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(i)this.textureBuffer.clear();this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer);this.renderer.spriteBatch.dirty=true;t._isNotNeedCalcTransform=false};_t.RenderTexture.prototype.renderCanvas=function(t,e,i){if(!this.valid)return;t.game._qc.renderInRenderTexture=true;var r=t.worldTransform;r.identity();if(e)r.append(e);t.worldAlpha=1;t._isSubNeedCalcTransform=true;var a=t.children;for(var n=0,s=a.length;n<s;n++){a[n].updateTransform()}t.game._qc.renderInRenderTexture=false;if(i)this.textureBuffer.clear();var o=this.textureBuffer.context;var h=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(t,o);this.renderer.resolution=h;t._isNotNeedCalcTransform=false};var K=pt.SoftClipManager=function(t){this.renderSession=t;this._polygons=[]};K.prototype={};K.prototype.constructor=K;P.defineProperties(K.prototype,{needClip:{get:function(){return!!this._polygons.length}}});K.getManager=function(t){var e=t.softClipManager;if(!e){e=t.softClipManager=new K(t)}return e};K.prototype.pushPolygon=function(t){var e=this;var i=[];e.renderSession.spriteBatch.batchType=pt.BATCH_TRIANGLES;if(!e._polygons.length){var r=arguments.length;while(r--){var a=arguments[r];var n=pt.GeometricTool.quickDecomp(a);if(n.length)Array.prototype.push.apply(i,n);else{var s=b.Triangulate(a);for(var o=0;o<s.length;o+=3){var h=s[o];var l=s[o+1];var u=s[o+2];i.push([a[h],a[l],a[u]])}}}e._polygons.push(i);return}var f=e._polygons[e._polygons.length-1];var c=f.length;while(c--){var p=f[c];var r=arguments.length;while(r--){t=arguments[r];var n=pt.GeometricTool.sutherlandHodgman(t,p);i.push(n)}}e._polygons.push(i)};K.prototype.popPolygon=function(){var t=this;if(t._polygons.length){t._polygons.splice(t._polygons.length-1,1)}if(!t._polygons.length){t.renderSession.spriteBatch.batchType=pt.BATCH_QUAD}};K.prototype.getClipPolygon=function(t,e,i,r,a,n){var s=this;var o=[];var h=s._polygons[s._polygons.length-1];var l=h.length;var u=1/(t*r+i*-e);t*=u;e*=u;i*=u;r*=u;var f=n*i-a*r;var c=-n*t+a*e;var p=-1;while(++p<l){var d=h[p];var _=[];var g=d.length;var m=-1;while(++m<g){var y=d[m];_.push(new pt.Point(r*y.x-i*y.y+f,t*y.y-e*y.x+c))}o.push(_)}return o};K.prototype.renderSprite=function(t,e,i,r,a,n,s,o,h,l,u,f,c,p,d,_,g){var m=this.getClipPolygon(u,f,c,p,d,_);if(m.length===0)return;var y=[new pt.Point(i,r),new pt.Point(a,r),new pt.Point(a,n),new pt.Point(i,n)];var v={x:i,y:r,width:a-i,height:n-r};if(!v.width||!v.height){return}var T=function(t,e,i,r,a,n){return{x:e+(t.x-n.x)/n.width*(i-e),y:r+(t.y-n.y)/n.height*(a-r)}};var x=m.length;while(x--){var b=m[x];var A=pt.GeometricTool.sutherlandHodgman(b,y);var S=A.length;if(S<3)continue;var w=[];var P=[];var E=-1;while(++E<S){w[E]=T(A[E],s,h,o,l,v);P.push({x:u*A[E].x+c*A[E].y+d,y:p*A[E].y+f*A[E].x+_})}var D=pt.GeometricTool.Triangulate(P);if(!D)continue;for(var E=0;E<D.length;E+=3){var C=D[E];var O=D[E+1];var M=D[E+2];this._addWebGLTriangle(t.spriteBatch,e,g,P[C],P[O],P[M],w[C],w[O],w[M])}}};K.prototype._addWebGLTriangle=function(t,e,i,r,a,n,s,o,h){if(t.currentBatchSize>=t.triangleSize){t.flush();t.currentBaseTexture=e.texture.baseTexture}var l=t.colors;var u=t.positions;var f=t.currentBatchSize*3*t.vertSize;if(t.renderSession.roundPixels){u[f]=r.x|0;u[f+1]=r.y|0;u[f+5]=a.x|0;u[f+6]=a.y|0;u[f+10]=n.x|0;u[f+11]=n.y|0}else{u[f]=r.x;u[f+1]=r.y;u[f+5]=a.x;u[f+6]=a.y;u[f+10]=n.x;u[f+11]=n.y}u[f+2]=s.x;u[f+3]=s.y;u[f+7]=o.x;u[f+8]=o.y;u[f+12]=h.x;u[f+13]=h.y;l[f+4]=l[f+9]=l[f+14]=i;t.sprites[t.currentBatchSize++]=e};var J=pt.SoundManager=function(t){this.game=t;this.phaser=t.phaser.sound;this.phaser._qc=this;var e=this;t.onStart.add(function(){e._boot()});this._soundDurationMap=D.soundDurationMap||{}};J.prototype.constructor=J;J.prototype._boot=function(){var t=this.phaser;var e=this.game.input;if(!D.__wx&&!t.game.device.cocoonJS&&t.game.device.iOS||D["PhaserGlobal"]&&D["PhaserGlobal"].fakeiOSTouchLock){e.touch.callbackContext=t;if(t.game.device.iOSVersion>8){e.touch.touchEndCallback=t.unlock}else{e.touch.touchStartCallback=t.unlock}e.mouse.callbackContext=t;e.mouse.mouseDownCallback=t.unlock;t.touchLocked=true}else{t.touchLocked=false}};P.defineProperties(J.prototype,{mute:{get:function(){return this.phaser.mute},set:function(t){this.phaser.mute=t}},volume:{get:function(){return this.phaser.volume},set:function(t){this.phaser.volume=t}},usingWebAudio:{get:function(){return this.phaser.usingWebAudio}},usingAudioTag:{get:function(){return this.phaser.usingAudioTag}},mp3Support:{get:function(){return this.game.phaser.device.mp3}},oggSupport:{get:function(){return this.game.phaser.device.ogg||this.game.phaser.device.opus}},webAudioSupport:{get:function(){return this.game.phaser.sound.usingWebAudio}}});J.prototype._getAudioTagDurationInConfig=function(t){var e=t.key;if(!/\.bin$/i.test(e))e=e+".bin";return this._soundDurationMap[e]||t._sound.duration};J.prototype.tryGetUrl=function(t){var e=t;if(e.indexOf(".mp3.bin")>0){if(!this.mp3Support){e=e.replace(".mp3.bin",".ogg.bin")}}else if(e.indexOf(".ogg.bin")>0){if(!this.oggSupport){e=e.replace(".ogg.bin",".mp3.bin")}}if(!this.webAudioSupport){e=e.replace(".bin","")}return e};var Z=pt.Key=function(t,e){this.game=t;this._keycode=e;this._isDown=false;this._justDown=false;this._justUp=false;this.downTime=0;this.repeats=0;this._lastRepeatTime=0;this._eventList=[]};Z.prototype={};Z.prototype.constructor=Z;P.defineProperties(Z.prototype,{keyCode:{get:function(){return this._keycode}},currCharCode:{get:function(){return this._charCode},set:function(t){this._charCode=t}},isJustDown:{get:function(){var t=this._justDown;if(t){this._justDown=false;this._isDown=true}return t}},isJustUp:{get:function(){var t=this._justUp;if(t){this._justUp=false;this._isDown=false}return t}},isDown:{get:function(){return this._isDown}},duringTime:{get:function(){if(!this.isDown){return-1}return this.game.time.fixedTime-this.downTime}}});Z.prototype.destroy=function(){this.game=null};Z.prototype.hasEvent=function(){return!!this._eventList.length};Z.prototype.nextEvent=function(){if(!this._eventList.length){return false}var t=this._eventList.shift();do{if(!t)break;switch(t.type){case Z.DOWN:this._onDown(t.time);break;case Q.UP:this._onUp();break}return true}while(false);return false};Z.prototype.onDown=function(){this._eventList.push({type:Z.DOWN,time:this.game.time.fixedTime});return true};Z.prototype.onUp=function(){this._eventList.push({type:Z.UP});return true};Z.prototype._onDown=function(t){if(this.isDown||this._justDown)return false;this._justDown=true;this.downTime=t;this._lastRepeatTime=this.downTime;return true};Z.prototype._onUp=function(){if(!(this._isDown||this._justDown)||this._justUp){return false}this._justUp=true;return true};Z.prototype.setState=function(t){var e=(this._isDown||this._justDown)&&!this._justUp;this._isDown=t;this._justDown=false;this._justUp=false;return e^t};Z.prototype.checkRepeat=function(t){if(!this.isDown)return false;var e=this.game.time.fixedTime;if(e-this._lastRepeatTime-t>0){this.repeats++;this._lastRepeatTime=e;return true}return false};Z.UP=-1;Z.DOWN=0;var Q=pt.Pointer=function(t,e){this.game=t;this._id=e;this._isDown=false;this._justDown=false;this._justUp=false;this.downTime=0;this.withinGame=false;this.previousStatus=[];this._eventList=[]};Q.prototype={};Q.prototype.constructor=Q;P.defineProperties(Q.prototype,{id:{get:function(){return this._id}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},startX:{get:function(){return this._startX}},startY:{get:function(){return this._startY}},isMouse:{get:function(){return this._id<pt.Mouse.NONE&&this._id>=pt.Mouse.BUTTON_FORWORD}},isJustDown:{get:function(){var t=this._justDown;if(t){this._justDown=false;this._isDown=true}return t}},isJustUp:{get:function(){var t=this._justUp;if(t){this._justUp=false;this._isDown=false}return t}},isDown:{get:function(){return this._isDown}},isDowning:{get:function(){return this._justDown}},isUpping:{get:function(){return this._justUp}},deltaX:{get:function(){return this._deltaX}},deltaY:{get:function(){return this._deltaY}},distanceX:{get:function(){return this.x-this.startX}},distanceY:{get:function(){return this.y-this.startY}},deviceId:{get:function(){return this._deviceId||this.id},set:function(t){this._deviceId=t}},eventId:{get:function(){return this._eventId||this.id},set:function(t){this._eventId=t}},duringTime:{get:function(){if(!this.isDown){return-1}return this.game.time.fixedTime-this.downTime}}});Q.prototype.destroy=function(){this.game=null};Q.prototype.update=function(){this._deltaX=this._tempX-this._x;this._deltaY=this._tempY-this._y;this._x=this._tempX;this._y=this._tempY};Q.prototype.hasEvent=function(){return!!this._eventList.length};Q.prototype.nextEvent=function(){if(!this._eventList.length){return false}var t=this._eventList.shift();do{if(!t)break;switch(t.type){case Q.DOWN:this.withinGame=true;this._onDown(t.x,t.y,t.time);break;case Q.UP:this._onUp(t.time);break;case Q.LEAVE:this.withinGame=false;this._onMove(t.x,t.y);break;case Q.ENTER:this.withinGame=true;this._onMove(t.x,t.y);break;case Q.MOVE:this._onMove(t.x,t.y);break;case Q.CANCEL:this._onCancel(t.time);break}return true}while(false);return false};Q.prototype.onDown=function(t,e){this._eventList.push({type:Q.DOWN,x:t,y:e,time:this.game.time.fixedTime});return true};Q.prototype.onMove=function(t,e){var i=this._eventList.length;if(i>0&&this._eventList[i-1].type===Q.MOVE){this._eventList[i-1].x=t;this._eventList[i-1].y=e}else{this._eventList.push({type:Q.MOVE,x:t,y:e})}return true};Q.prototype.onLeave=function(t,e){this._eventList.push({type:Q.LEAVE,x:t,y:e});return true};Q.prototype.onEnter=function(t,e){this._eventList.push({type:Q.ENTER,x:t,y:e});return true};Q.prototype.onUp=function(){this._eventList.push({type:Q.UP,time:this.game.time.fixedTime});return true};Q.prototype.onCancel=function(){this._eventList.push({type:Q.CANCEL,time:this.game.time.fixedTime});return true};Q.prototype._onDown=function(t,e,i){if(this.isDown||this._justDown)return false;this._justDown=true;this.downTime=i;this._x=t;this._y=e;this._startX=t;this._startY=e;this._tempX=t;this._tempY=e;this._deltaX=0;this._deltaY=0;return true};Q.prototype._onUp=function(t){if(!(this._isDown||this._justDown)||this._justUp)return false;this._justUp=true;this.previousStatus.unshift({startX:this._startX,startY:this._startY,endX:this.x,endY:this.y,downTime:this.downTime,upTime:t});while(this.previousStatus.length>10){this.previousStatus.pop()}return true};Q.prototype._onCancel=function(t){if(this._justUp)return false;this._onUp(t);return true};Q.prototype._onMove=function(t,e){this._tempX=t;this._tempY=e};Q.prototype.isDouble=function(t,e){};Q.UP=-1;Q.DOWN=0;Q.MOVE=1;Q.ENTER=2;Q.LEAVE=3;Q.CANCEL=4;var $=pt.Keyboard=function(t,e){this.input=t;this.game=t.game;this.repeatInterval=100;this.onKeyDown=new dt.Signal;this.onKeyUp=new dt.Signal;this.onKeyRepeat=new dt.Signal;this._keys=[];this._keyCodes={};this._capture={};this._keyDownNum=0;this._anyKeyDown=false;this._init(e)};$.prototype={};$.prototype.constructor=$;P.defineProperties($.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||D},set:function(t){if(t===this._generator)return;var e=this.enable;this.enable=false;this._generator=t;if(e){this.enable=true}}},gainFocusType:{get:function(){return this._gainFocusType},set:function(t){this._gainFocusType=t}},keyCount:{get:function(){return this._keyDownNum}},keyCodes:{get:function(){return P.keys(this._keyCodes)}}});$.prototype._init=function(t){this._onKeyDown=this._processKeyDown.bind(this);this._onKeyUp=this._processKeyUp.bind(this);this._onBlur=this.lossFocus.bind(this);this._onMouseOver=this._onOver.bind(this);this._onMouseClick=this._onClick.bind(this);this.generator=t;this.gainFocusType=$.GAINFOCUS_CLICK;this.enable=true;if(this.game.device.phaser.windows&&this.game.device.phaser.desktop)this.addKeyCapture($.ALT)};$.prototype.destroy=function(){this.enable=false;this.input=null;this.generator=null;this._onKeyDown=null;this._onKeyUp=null;this._onBlur=null;this._onMouseOver=null;this._onMouseClick=null};$.prototype.update=function(){if(!this.enable)return;this._anyKeyDown=false;var t=this._keys.length;var e;while(t--){e=this._keys[t];if(!e)continue;while(e.nextEvent()){if(e.isJustDown){this._anyKeyDown=true;this._recordKey(e.keyCode,true);this.onKeyDown.dispatch(e.keyCode)}if(e.isJustUp){this._recordKey(e.keyCode,false);this.onKeyUp.dispatch(e.keyCode)}if(e.checkRepeat(this.repeatInterval))this.onKeyRepeat.dispatch(e._keycode)}}};$.prototype.isKeyDown=function(t){return this._keys[t]&&this._keys[t].isDown};$.prototype.isAnyKey=function(){return this._keyDownNum>0};$.prototype.isAnyKeyDown=function(){return this._anyKeyDown};$.prototype._recordKey=function(t,e){if(e){this._keyDownNum++;this._keyCodes[t]=true}else{this._keyDownNum--;delete this._keyCodes[t]}};$.prototype._setEnable=function(t){if(this._enable===t){return}this._enable=t;var e=this.generator;if(t){e.addEventListener("keydown",this._onKeyDown,false);e.addEventListener("keyup",this._onKeyUp,false);e.addEventListener("blur",this._onBlur,false);this._addFocusAbility(e,true)}else{e.removeEventListener("keydown",this._onKeyDown);e.removeEventListener("keyup",this._onKeyUp);e.removeEventListener("blur",this._onBlur);this._removeFocusAbility(e);this._clearKeys()}};$.prototype._addFocusAbility=function(t,e){if(t===D&&(!D.parent||D.parent===D))return;t.tabIndex=t.tabIndex||-1;var i=this;t.addEventListener("mouseover",i._onMouseOver,false);t.addEventListener("click",i._onMouseClick,false);this.input.onPointerDown.add(i._onMouseClick,i);if(e){setTimeout(function(){i.gainFocus()},1)}};$.prototype._removeFocusAbility=function(t){if(t===D&&(!D.parent||D.parent===D))return;t.removeEventListener("mouseover",this._onMouseOver);t.removeEventListener("click",this._onMouseClick);this.input.onPointerDown.remove(this._onMouseClick,this)};$.prototype._prepareKey=function(t){if(!this._keys[t])this._keys[t]=new pt.Key(this.game,t)};$.prototype.setModifierKeysState=function(t,e){if(t.altKey===C)return;this._setKeyCodeState($.ALT,t.altKey,e);this._setKeyCodeState($.SHIFT,t.shiftKey,e);this._setKeyCodeState($.CONTROL,t.ctrlKey,e);if(e!=$.META&&e!=$.META_RWIN&&e!=$.META_RMAC){this._setKeyCodeState($.META,t.metaKey,e)}};$.prototype._setKeyCodeState=function(t,e,i){if(t===i)return;this._prepareKey(t);if(this._keys[t].setState(e))this._recordKey(t,e)};$.prototype._processKeyDown=function(t){this._prepareKey(t.keyCode);if(this._capture[t.keyCode]){t.preventDefault()}this._keys[t.keyCode].onDown();this._keys[t.keyCode].currCharCode=t.charCode;this.setModifierKeysState(t,t.keyCode);this.update()};$.prototype._processKeyUp=function(t){this._prepareKey(t.keyCode);if(this._capture[t.keyCode]){t.preventDefault()}this._keys[t.keyCode].onUp();this.setModifierKeysState(t,t.keyCode);this.update()};$.prototype._onOver=function(t){if(this.gainFocusType===$.GAINFOCUS_OVER)this.gainFocus()};$.prototype._onClick=function(t){if(this.gainFocusType===$.GAINFOCUS_CLICK)this.gainFocus()};$.prototype.gainFocus=function(t){if(this.generator!==D||D.parent&&D.parent!==D){this.generator.focus()}};$.prototype._clearKeys=function(){while(this._keys.length>0){var t=this._keys.pop();if(t)t.destroy()}this._keyDownNum=0;this._keyCodes={}};$.prototype.lossFocus=function(){this._clearKeys()};$.prototype.addKeyCapture=function(t){if(typeof t==="object"){for(var e in t){this._capture[t[e]]=true}}else{this._capture[t]=true}};$.prototype.removeKeyCapture=function(t){delete this._capture[t]};$.prototype.clearCapture=function(){this._capture={}};$.GAINFOCUS_OVER=0;$.GAINFOCUS_CLICK=1;$.A="A".charCodeAt(0);$.B="B".charCodeAt(0);$.C="C".charCodeAt(0);$.D="D".charCodeAt(0);$.E="E".charCodeAt(0);$.F="F".charCodeAt(0);$.G="G".charCodeAt(0);$.H="H".charCodeAt(0);$.I="I".charCodeAt(0);$.J="J".charCodeAt(0);$.K="K".charCodeAt(0);$.L="L".charCodeAt(0);$.M="M".charCodeAt(0);$.N="N".charCodeAt(0);$.O="O".charCodeAt(0);$.P="P".charCodeAt(0);$.Q="Q".charCodeAt(0);$.R="R".charCodeAt(0);$.S="S".charCodeAt(0);$.T="T".charCodeAt(0);$.U="U".charCodeAt(0);$.V="V".charCodeAt(0);$.W="W".charCodeAt(0);$.X="X".charCodeAt(0);$.Y="Y".charCodeAt(0);$.Z="Z".charCodeAt(0);$.ZERO="0".charCodeAt(0);$.ONE="1".charCodeAt(0);$.TWO="2".charCodeAt(0);$.THREE="3".charCodeAt(0);$.FOUR="4".charCodeAt(0);$.FIVE="5".charCodeAt(0);$.SIX="6".charCodeAt(0);$.SEVEN="7".charCodeAt(0);$.EIGHT="8".charCodeAt(0);$.NINE="9".charCodeAt(0);$.NUMPAD_0=96;$.NUMPAD_1=97;$.NUMPAD_2=98;$.NUMPAD_3=99;$.NUMPAD_4=100;$.NUMPAD_5=101;$.NUMPAD_6=102;$.NUMPAD_7=103;$.NUMPAD_8=104;$.NUMPAD_9=105;$.NUMPAD_MULTIPLY=106;$.NUMPAD_ADD=107;$.NUMPAD_ENTER=108;$.NUMPAD_SUBTRACT=109;$.NUMPAD_DECIMAL=110;$.NUMPAD_DIVIDE=111;$.F1=112;$.F2=113;$.F3=114;$.F4=115;$.F5=116;$.F6=117;$.F7=118;$.F8=119;$.F9=120;$.F10=121;$.F11=122;$.F12=123;$.F13=124;$.F14=125;$.F15=126;$.COLON=186;$.EQUALS=187;$.UNDERSCORE=189;$.QUESTION_MARK=191;$.TILDE=192;$.OPEN_BRACKET=219;$.BACKWARD_SLASH=220;$.CLOSED_BRACKET=221;$.QUOTES=222;$.BACKSPACE=8;$.TAB=9;$.CLEAR=12;$.ENTER=13;$.SHIFT=16;$.CONTROL=17;$.ALT=18;$.META=91;$.META_RWIN=92;$.META_RMAC=93;$.CAPS_LOCK=20;$.ESC=27;$.SPACEBAR=32;$.PAGE_UP=33;$.PAGE_DOWN=34;$.END=35;$.HOME=36;$.LEFT=37;$.UP=38;$.RIGHT=39;$.DOWN=40;$.INSERT=45;$.DELETE=46;$.HELP=47;$.NUM_LOCK=144;$.PLUS=43;$.MINUS=45;var tt=pt.Mouse=function(t,e){this.input=t;this.game=t.game;this._wheelEvent=null;this.capture=true;this.callbackContext=this.game;this.mouseDownCallback=null;this.onMouseDown=new dt.Signal;this.onMouseUp=new dt.Signal;this.onMouseMove=new dt.Signal;this.onMousePressMove=new dt.Signal;this.onMouseWheel=new dt.Signal;this._mouses=[];this._mouseIds={};this._mouseDownNum=0;this._anyMouseDown=false;this._checkEventHandledByTouch=this.game.phaser.device.android&&this.game.phaser.device.chrome===false;this._wheelInfo={deltaX:0,deltaY:0};this._init(e)};tt.prototype={};tt.prototype.constructor=tt;P.defineProperties(tt.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(t){if(t===this._generator)return;var e=this.enable;this.enable=false;this._generator=t;if(e){this.enable=true}}},mouseWheel:{get:function(){return this._wheelInfo}},mouseCount:{get:function(){return this._mouseDownNum}},mouseIds:{get:function(){return P.keys(this._mouseIds)}}});tt.prototype._init=function(t){this._mouseKeyMap={0:tt.BUTTON_LEFT,1:tt.BUTTON_MIDDLE,2:tt.BUTTON_RIGHT,3:tt.BUTTON_BACK,4:tt.BUTTON_FORWORD};this._mouseKeyMap[-1]=tt.NONE;this._onMouseDown=this.processMouseDown.bind(this);this._onMouseUp=this.processMouseUp.bind(this);this._onMouseOver=this.processMouseOver.bind(this);this._onMouseOut=this.processMouseOut.bind(this);this._onMouseUpGlobal=this.processMouseUpGlobal.bind(this);this._onMouseMove=this.processMouseMove.bind(this);this._onMouseWheel=this.processMouseWheel.bind(this);this.generator=t;this.enable=true};tt.prototype.update=function(){if(!this.enable)return;this._anyMouseDown=false;var t=this._mouses.length;var e;while(t-- >1){e=this._mouses[t];if(!e)continue;while(e.nextEvent()){if(e.isJustDown){this._anyMouseDown=true;this._recordMouse(e.id,true);this.onMouseDown.dispatch(e.id,e.x,e.y)}e.update();if(e.isDown&&(e.deltaX||e.deltaY)){this.onMousePressMove.dispatch(e.id,e.x,e.y)}if(e.isJustUp){this._recordMouse(e.id,false);this.onMouseUp.dispatch(e.id,e.x,e.y)}}}e=this.getMouseById(tt.NONE);if(e){while(e.nextEvent()){e.update();if(e.deltaX||e.deltaY){this.onMouseMove.dispatch(e.x,e.y)}}}var i=this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0});if(i&&(i.deltaX||i.deltaY)){this._wheelInfo.deltaX=i.deltaX||0;this._wheelInfo.deltaY=i.deltaY||0;this.onMouseWheel.dispatch(this._wheelInfo.deltaX,this._wheelInfo.deltaY)}else{this._wheelInfo.deltaX=0;this._wheelInfo.deltaY=0}i.deltaX=0;i.deltaY=0};tt.prototype.destroy=function(){this.enable=false;this._onMouseDown=null;this._onMouseUp=null;this._onMouseOver=null;this._onMouseOut=null;this._onMouseUpGlobal=null;this._onMouseMove=null;this._onMouseWheel=null;this.input=null;this.game=null;this.generator=null};tt.prototype._setEnable=function(t){if(this._enable===t){return}if(this.game.phaser.device.android&&this.game.phaser.device.chrome===false&&this.game.phaser.device.touch){return}this._enable=t;var e=this.generator;var i=this.game.phaser.device;if(t){e.addEventListener("mousedown",this._onMouseDown,false);e.addEventListener("mouseup",this._onMouseUp,false);e.addEventListener("mousemove",this._onMouseMove,false);if(!i.cocoonJS){e===D||D.addEventListener("mouseup",this._onMouseUpGlobal,false);e.addEventListener("mouseout",this._onMouseOut,false);e.addEventListener("mouseover",this._onMouseOver,false)}var r=i.wheelEvent;if(r){e.addEventListener(r,this._onMouseWheel,false);if(r==="mousewheel"){this._wheelEvent=new et(-1/40,1)}else if(r==="DOMMouseScroll"){this._wheelEvent=new et(1,1)}}this.getMouseById(tt.NONE)}else{e.removeEventListener("mousedown",this._onMouseDown);e.removeEventListener("mousemove",this._onMouseMove);e.removeEventListener("mouseup",this._onMouseUp);e.removeEventListener("mouseout",this._onMouseOut);e.removeEventListener("mouseover",this._onMouseOver);var r=i.wheelEvent;if(r){e.removeEventListener(r,this._onMouseWheel)}e===D||D.removeEventListener("mouseup",this._onMouseUpGlobal);this._clearMouses()}};tt.prototype._clearMouses=function(){while(this._mouses.length>0){var t=this._mouses.pop();if(t)t.destroy()}this._mouseDownNum=0;this._mouseIds={}};tt.prototype.lossFocus=function(){this._clearMouses();this.getMouseById(tt.NONE)};tt.prototype.isAnyMouse=function(){return this._mouseDownNum>0};tt.prototype.isAnyMouseDown=function(){return this._anyMouseDown};tt.prototype.isMouseDown=function(t){return!!this._mouseIds[t]};tt.prototype._recordMouse=function(t,e){if(e){this._mouseDownNum++;this._mouseIds[t]=true}else{this._mouseDownNum--;delete this._mouseIds[t]}};tt.prototype.getMouseById=function(t){var e=Math.abs(t);if(!this._mouses[e])this._mouses[e]=new pt.Pointer(this.game,t);return this._mouses[e]};tt.prototype._updateMousesPosition=function(t,e,i){var r=this._mouses.length;var a;while(r--){a=this._mouses[r];if(!a)continue;if(i===pt.Pointer.ENTER){a.onEnter(t,e)}else if(i===pt.Pointer.LEAVE){a.onLeave(t,e)}else{a.onMove(t,e)}}};tt.prototype._toWorld=function(t,e,i){var r=this.game.canvas;var a=this.game.phaser.scale.scaleFactor;var n=r.ownerDocument===(this.generator.ownerDocument||this.generator.document)?r.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(e-n.left)*a.x,y:(i-n.top)*a.y}};tt.prototype.processMouseDown=function(t){if(!this.input.ignoreDomEvent(t)&&this.capture)t.preventDefault();if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,t)}var e=this._mouseKeyMap[t.button];if(e==C)return;var i=this._toWorld(this.generator,t.clientX,t.clientY);if(this._checkEventHandledByTouch&&this.input.touch.checkEventHandled(true,i.x,i.y))return;var r=this.getMouseById(e);r.deviceId=t.button;r.onDown(i.x,i.y);this.input.keyboard.setModifierKeysState(t);this.update()};tt.prototype.processMouseUp=function(t){if(!this.input.ignoreDomEvent(t)&&this.capture)t.preventDefault();var e=this._mouseKeyMap[t.button];if(e==C)return;var i=this.getMouseById(e);i.deviceId=t.button;i.onUp();this.input.keyboard.setModifierKeysState(t);this.update()};tt.prototype.processMouseUpGlobal=function(t){var e=this._mouseKeyMap[t.button];if(e==C)return;var i=this.getMouseById(e);i.onUp();if(this.input&&this.input.keyboard)this.input.keyboard.setModifierKeysState(t);this.update()};tt.prototype.processMouseOut=function(t){if(!this.input.ignoreDomEvent(t)&&this.capture)t.preventDefault();var e=this._mouseKeyMap[t.button];if(e==C)return;var i=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(i.x,i.y,pt.Pointer.LEAVE);this.update()};tt.prototype.processMouseOver=function(t){if(!this.input.ignoreDomEvent(t)&&this.capture)t.preventDefault();var e=this._mouseKeyMap[t.button];if(e==C)return;var i=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(i.x,i.y,pt.Pointer.ENTER);this.input.keyboard.setModifierKeysState(t);this.update()};tt.prototype.processMouseMove=function(t){if(!this.input.ignoreDomEvent(t)&&this.capture)t.preventDefault();var e=this._mouseKeyMap[t.button];if(e==C)return;var i=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(i.x,i.y,pt.Pointer.MOVE);this.input.keyboard.setModifierKeysState(t);this.update()};tt.prototype.processMouseWheel=function(t){if(this._wheelEvent){t=this._wheelEvent.bindEvent(t)}if(!this.input.ignoreDomEvent(t)&&this.capture)t.preventDefault();var e=dt.Math.clamp(-t.deltaY,-1,1);var i=this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0});i.deltaX+=t.deltaX;i.deltaY+=t.deltaY;this.input.keyboard.setModifierKeysState(t);this.update()};tt.NONE=0;tt.BUTTON_LEFT=-1;tt.BUTTON_MIDDLE=-2;tt.BUTTON_RIGHT=-3;tt.BUTTON_BACK=-4;tt.BUTTON_FORWORD=-5;function et(t,e){this._scaleFactor=t;this._deltaMode=e;this.originalEvent=null}et.prototype={};et.prototype.constructor=et;et.prototype.bindEvent=function(t){if(!et._stubsGenerated&&t){var e=function(e){return function(){var t=this.originalEvent[e];return typeof t!=="function"?t:t.bind(this.originalEvent)}};for(var i in t){if(!(i in et.prototype)){P.defineProperty(et.prototype,i,{get:e(i)})}}et._stubsGenerated=true}this.originalEvent=t;return this};P.defineProperties(et.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});var it=pt.Touch=function(t,e){this.input=t;this.game=t.game;this.capture=true;this.onTouchStart=new dt.Signal;this.onTouchEnd=new dt.Signal;this.onTouchMove=new dt.Signal;this._touches=[];this._touchIds={};this._deviceIdMap={};this._touchesStartPosition=[];this._touchStartNum=0;this._anyTouchStart=false;this._init(e);this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null};it.prototype={};it.prototype.constructor=it;P.defineProperties(it.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(t){if(t===this._generator)return;var e=this.enable;this.enable=false;this._generator=t;if(e){this.enable=true}}},touchCount:{get:function(){return this._touchStartNum}},touchIds:{get:function(){return P.keys(this._touchIds)}}});it.prototype._init=function(t){this._onTouchStart=this.processTouchStart.bind(this);this._onTouchCancel=this.processTouchCancel.bind(this);this._onTouchEnd=this.processTouchEnd.bind(this);this._onTouchEnter=this.processTouchEnter.bind(this);this._onTouchLeave=this.processTouchLeave.bind(this);this._onTouchMove=this.processTouchMove.bind(this);this.generator=t;this.enable=true};it.prototype.update=function(){if(!this.enable)return;this._touchesStartPosition.splice(0,this._touchesStartPosition.length);this._anyTouchStart=false;var t=this._touches.length;var e;while(t--){e=this._touches[t];if(!e)continue;while(e.nextEvent()){if(e.isJustDown){this._anyTouchStart=true;this._recordTouch(e.id,true);this.onTouchStart.dispatch(e.id,e.x,e.y)}e.update();if(e.isDown&&(e.deltaX||e.deltaY)){this.onTouchMove.dispatch(e.id,e.x,e.y)}if(e.isJustUp){this._recordTouch(e.id,false);this.onTouchEnd.dispatch(e.id,e.x,e.y)}if(!e.isDown){this._removeTouch(e.id)}}}};it.prototype.destroy=function(){this.enable=false;this._onTouchStart=null;this._onTouchCancel=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchMove=null;this.input=null;this.game=null;this.generator=null};it.prototype.checkEventHandled=function(t,e,i){var r=this._touchesStartPosition.length;while(r--){var a=this._touchesStartPosition[r];if(a.isDown===t&&a.x===e&&a.y===i)return true}return false};it.prototype._setEnable=function(t){if(this._enable===t){return}var e=this.generator;var i=this.game.phaser.device;if(!i.touch){this._enable=false;return}this._enable=t;if(t){e.addEventListener("touchstart",this._onTouchStart,false);e.addEventListener("touchmove",this._onTouchMove,false);e.addEventListener("touchend",this._onTouchEnd,false);e.addEventListener("touchcancel",this._onTouchCancel,false);if(!i.cocoonJS){e.addEventListener("touchenter",this._onTouchEnter,false);e.addEventListener("touchleave",this._onTouchLeave,false)}}else{e.removeEventListener("touchstart",this._onTouchStart);e.removeEventListener("touchmove",this._onTouchMove);e.removeEventListener("touchend",this._onTouchEnd);e.removeEventListener("touchcancel",this._onTouchCancel);e.removeEventListener("touchenter",this._onTouchEnter);e.removeEventListener("touchleave",this._onTouchLeave);this._clearTouches()}};it.prototype._clearTouches=function(){var t;while(this._touches.length>0){t=this._touches.pop();if(t)t.destroy()}this._deviceIdMap={};this._touchStartNum=0;this._touchIds={}};it.prototype.lossFocus=function(){this._clearTouches()};it.prototype.isAnyTouch=function(){return this._touchStartNum>0};it.prototype.isAnyTouchStart=function(){return this._anyTouchStart};it.prototype.isTouchStart=function(t){return!!this._touchIds[t]};it.prototype._recordTouch=function(t,e){if(e){this._touchStartNum++;this._touchIds[t]=true}else{this._touchStartNum--;delete this._touchIds[t]}};it.prototype.getTouchById=function(t){return this._touches[t]};it.prototype._getFirstInvalidTouch=function(){var t=-1;var e=this._touches.length+1;while(++t<e){var i=this._touches[t];if(!i){break}if(!i.isDown&&!i.hasEvent()){return i}}var r=new pt.Pointer(this.game,t);this._touches[t]=r;return r};it.prototype._removeTouch=function(t){var e=this._touches[t];if(e){delete this._deviceIdMap[e.deviceId]}};it.prototype.getTouchByDeviceId=function(t,e){if(this._deviceIdMap[t]===C){if(e){var i=this._getFirstInvalidTouch();i.deviceId=t;this._deviceIdMap[t]=i.id;return i}return null}return this.getTouchById(this._deviceIdMap[t])};it.prototype._toWorld=function(t,e,i){var r=this.game.canvas;var a=this.game.phaser.scale.scaleFactor;var n=r.ownerDocument===(this.generator.ownerDocument||this.generator.document)?r.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(e-n.left)*a.x,y:(i-n.top)*a.y}};it.prototype._updateTouchWithTouches=function(t){var e=t.length;var i={};while(e--){var r=t[e];i[r.identifier]=true;var a=this._toWorld(this.generator,r.clientX,r.clientY);var n=this.getTouchByDeviceId(r.identifier);if(n){n.deviceId=r.identifier;n.onMove(a.x,a.y)}}var e=this._touches.length;while(e--){var r=this._touches[e];if(!r||i[r.deviceId])continue;r.onCancel(false)}};it.prototype.processTouchStart=function(t){if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,t)}if(!this.input.ignoreDomEvent(t)&&this.capture)t.preventDefault();var e=t.changedTouches.length;while(e--){var i=t.changedTouches[e];if(!i)continue;var r=this.getTouchByDeviceId(i.identifier,true);var a=this._toWorld(this.generator,i.clientX,i.clientY);this._touchesStartPosition.push({isDown:true,x:a.x,y:a.y});r.onDown(a.x,a.y)}this._updateTouchWithTouches(t.touches);this.input.keyboard.setModifierKeysState(t);this.update()};it.prototype.processTouchEnd=function(t){if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,t)}if(!this.input.ignoreDomEvent(t)&&this.capture)t.preventDefault();var e=t.changedTouches.length;while(e--){var i=t.changedTouches[e];if(!i)continue;var r=this.getTouchByDeviceId(i.identifier);if(!r){continue}var a=this._toWorld(this.generator,i.clientX,i.clientY);this._touchesStartPosition.push({isDown:false,x:a.x,y:a.y});r.onUp(a.x,a.y)}this._updateTouchWithTouches(t.touches);this.input.keyboard.setModifierKeysState(t);this.update()};it.prototype.processTouchCancel=function(t){if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,t)}this.processTouchEnd(t,true)};it.prototype.processTouchLeave=function(t){if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,t)}this.processTouchMove(t,true)};it.prototype.processTouchEnter=function(t){if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,t)}this.processTouchMove(t,true)};it.prototype.processTouchMove=function(t,e){if(!e&&this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,t)}if(!this.input.ignoreDomEvent(t)&&this.capture)t.preventDefault();var i=t.changedTouches.length;while(i--){var r=t.changedTouches[i];if(!r)continue;var a=this.getTouchByDeviceId(r.identifier);if(!a)continue;var n=this._toWorld(this.generator,r.clientX,r.clientY);a.onMove(n.x,n.y)}this._updateTouchWithTouches(t.touches);this.input.keyboard.setModifierKeysState(t);this.update()};it.MAIN=0;var rt=pt.BaseInputEvent=function(t){this.source=t;this.effect=true};rt.prototype={};rt.prototype.constructor=rt;var at=pt.WheelEvent=function(t,e){rt.call(this,{deltaX:t,deltaY:e})};at.prototype=P.create(rt.prototype);at.prototype.constructor=at;P.defineProperties(at.prototype,{deltaX:{get:function(){return this.source.deltaX}},deltaY:{get:function(){return this.source.deltaY}}});var nt=pt.CursorMoveEvent=function(t,e){rt.call(this,{x:t,y:e})};nt.prototype=P.create(rt.prototype);nt.prototype.constructor=nt;P.defineProperties(nt.prototype,{x:{get:function(){return this.source.x}},y:{get:function(){return this.source.y}}});var st=pt.PointerEvent=function(t){rt.call(this,t)};st.prototype=P.create(rt.prototype);st.prototype.constructor=st;var ot=pt.ClickEvent=function(t){st.call(this,t);this.isTap=false;this.isDoubleTap=false;this.isDoubleClick=false};ot.prototype=P.create(st.prototype);ot.prototype.constructor=ot;var ht=pt.DragStartEvent=function(t){st.call(this,t);this.started=true};ht.prototype=P.create(st.prototype);ht.prototype.constructor=ht;var lt=pt.DragEvent=function(t){st.call(this,t)};lt.prototype=P.create(st.prototype);lt.prototype.constructor=lt;var ut=pt.DragEndEvent=function(t,e){st.call(this,t);this.result=e};ut.prototype=P.create(st.prototype);ut.prototype.constructor=ut;var ft=pt.DropEvent=function(t,e){st.call(this,t);this.dragging=e;this.result=null};ft.prototype=P.create(st.prototype);ft.prototype.constructor=ft;var ct=pt.BaseInputModule=function(t,e){this.game=t;this.input=e;this.handleTouchAsMouse=true;this._currMainPointerId=NaN;this._needHandleEventTypes=["onDown","onUp","onClick"];this._needHandleDragTypes=["onDragStart","onDrag","onDragEnd"];this._needHandleClickAndDragType=["onClick","onDragStart","onDrag","onDragEnd"];this._startDragMoveDistance=10;this.tapDuringTime=200;this.doubleClickDuringTime=600;this._pointersEvent={};this._init()};ct.prototype={};ct.prototype.constructor=ct;ct.prototype._init=function(){this.input.onPointerDown.add(this.onPointerDown,this);this.input.onPointerUp.add(this.onPointerUp,this);this.input.onPointerMove.add(this.onPointerMove,this);this.input.onWheel.add(this.onWheel,this);this.input.onCursorMove.add(this.onCursorMove,this)};ct.prototype._buildPointerRecord=function(t,e){return{eventId:t,deviceId:t,isMouse:e,downNodeList:null,draggingNodeList:null,overNode:null}};ct.prototype.destroy=function(){this.input.onPointerDown.remove(this.onPointerDown,this);this.input.onPointerUp.remove(this.onPointerUp,this);this.input.onPointerMove.remove(this.onPointerMove,this);this.input.onWheel.remove(this.onWheel,this);this.input.onCursorMove.remove(this.onCursorMove,this);this.reset()};ct.prototype.lossFocus=function(){this.reset()};ct.prototype.update=function(){};ct.prototype.reset=function(){for(var t in this._pointersEvent){var e=this._pointersEvent[t];var i;if(!isNaN(e.deviceId)){i=this.input.getPointer(e.deviceId);e.deviceId=NaN}if(e.downNodeList){for(var r=0;r<e.downNodeList.length;r++){var a=new pt.PointerEvent(i);e.downNodeList[r].fireInputEvent("onUp",a)}e.downNodeList=null}if(e.draggingNodeList){for(var r=0;r<e.draggingNodeList.length;r++){var n=new pt.DragEndEvent(i,null);e.draggingNodeList[r].fireInputEvent("onDragEnd",n)}e.draggingNodeList=null}if(e.overNode){var s=new pt.CursorMoveEvent(NaN,NaN);this.doPointerExitAndEnter(e,s,null);e.overNode=null}}this._pointersEvent={};this._currMainPointerId=NaN};ct.prototype.checkEventRecordNode=function(t){if(t.draggingNodeList){var e=[];for(var i=0;i<t.draggingNodeList.length;i++){if(t.draggingNodeList[i]._destroy)e.push(t.draggingNodeList[i])}for(var i=0;i<e.length;i++)t.draggingNodeList.remove(e[i]);if(t.draggingNodeList.length===0)t.draggingNodeList=null}if(t.downNodeList){var e=[];for(var i=0;i<t.downNodeList.length;i++){if(t.downNodeList[i]._destroy)e.push(t.downNodeList[i])}for(var i=0;i<e.length;i++)t.downNodeList.remove(e[i]);if(t.downNodeList.length===0)t.downNodeList=null}if(t.overNode&&t.overNode._destroy){t.overNode=null}};ct.prototype.onPointerDown=function(t,e,i){var r=this.input.getPointer(t);var a=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));if(this.handleTouchAsMouse){if(t===pt.Mouse.BUTTON_LEFT||t===pt.Touch.MAIN){if(!isNaN(this._currMainPointerId)&&this._currMainPointerId!==t)return;this._currMainPointerId=t;r.eventId=pt.Mouse.BUTTON_LEFT;a.eventId=pt.Mouse.BUTTON_LEFT}}this.checkEventRecordNode(a);var n=this._fetchNodeInParent(this.game.world,e,i);if(!a.isMouse){var s=new pt.CursorMoveEvent(e,i);this.doPointerExitAndEnter(a,s,n)}var o=n?n.getInputEventHandle(this._needHandleEventTypes,e,i):[];if(o.length===0){return}a.downNodeList=o;var h=new pt.PointerEvent(r);for(var l=0;l<o.length;l++){o[l].fireInputEvent("onDown",h)}};ct.prototype.onPointerUp=function(t,e,i){var r=this.input.getPointer(t);var a=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));if(this.handleTouchAsMouse){if(t===pt.Mouse.BUTTON_LEFT||t===pt.Touch.MAIN){if(this._currMainPointerId!==t)return;this._currMainPointerId=NaN;r.eventId=pt.Mouse.BUTTON_LEFT;a.eventId=r.eventId}}this.checkEventRecordNode(a);var n=this._fetchNodeInParent(this.game.world,e,i,a.draggingNodeList);var s=n?n.getInputEventHandle(this._needHandleEventTypes,e,i):[];var o=new pt.PointerEvent(r);if(a.draggingNodeList&&a.draggingNodeList.length>0){var h=n?n.getInputEventHandle("onDragDrop",e,i):[];for(var l=0;l<a.draggingNodeList.length;l++){var u=a.draggingNodeList[l];var f=new pt.DropEvent(r,u);for(var c=0;c<h.length;c++){var p=h[c];if(p&&p.checkAllowDrop(u)){p.fireInputEvent("onDragDrop",f)}}var d=new pt.DragEndEvent(r,f.result);u.fireInputEvent("onDragEnd",d)}a.draggingNodeList=null}else{for(var l=0;l<s.length;l++){var _=s[l];if(pt.Util.isArray(a.downNodeList)){for(var c=0;c<a.downNodeList.length;c++){var g=a.downNodeList[c];if(_&&_===g){var m=new pt.ClickEvent(r);if(r.previousStatus.length){var y=r.previousStatus[0];var v=r.previousStatus[1];m.isTap=y.upTime-y.downTime<this.tapDuringTime;m.isDoubleTap=v&&y.upTime-v.downTime<2*this.tapDuringTime;m.isDoubleClick=v&&y.upTime-v.downTime<this.doubleClickDuringTime}_.fireInputEvent("onClick",m);break}}}}}if(pt.Util.isArray(a.downNodeList)){for(var l=0;l<a.downNodeList.length;l++){var g=a.downNodeList[l];o.downInside=true;o.upInside=false;for(var c=0;c<s.length;c++){var _=s[c];if(g===_){o.upInside=true;break}}g.fireInputEvent("onUp",o)}}for(var l=0;l<s.length;l++){var _=s[l];o.downInside=false;o.upInside=true;var T;if(pt.Util.isArray(a.downNodeList)){for(var c=0;c<a.downNodeList.length;c++){var g=a.downNodeList[c];if(_===g){T=true;break}}}if(!T)_.fireInputEvent("onUp",o)}a.downNodeList=null;if(!a.isMouse){var x=new pt.CursorMoveEvent(e,i);this.doPointerExitAndEnter(a,x,null)}delete this._buildPointerRecord[a.deviceId]};ct.prototype.onPointerMove=function(t,e,i){var r=this.input.getPointer(t);var a=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));this.checkEventRecordNode(a);var n=this._fetchNodeInParent(this.game.world,e,i);if(!a.isMouse){var s=new pt.CursorMoveEvent(e,i);this.doPointerExitAndEnter(a,s,n)}if(!a.draggingNodeList||a.draggingNodeList.length===0){var o=this._fetchNodeInParent(this.game.world,r.startX,r.startY);var h={x:r.x,y:r.y};var l=[];do{if(!o)break;var u=o.getInputEventHandleAndEventType(this._needHandleClickAndDragType,r.startX,r.startY);if(u.length===0)break;for(var f=0;f<u.length;f++){var c=u[f];if(c[1]==="onClick"&&(Math.abs(r.distanceX)<this._startDragMoveDistance||Math.abs(r.distanceY)<this._startDragMoveDistance)){continue}l.push(c[0])}}while(false);var p=new pt.DragStartEvent(r);r._x=r.startX;r._y=r.startY;for(var f=0;f<l.length;f++){l[f].fireInputEvent("onDragStart",p)}r._x=h.x;r._y=h.y;a.draggingNodeList=l}if((!a.draggingNodeList||a.draggingNodeList.length===0)&&(Math.abs(r.distanceX)>=this._startDragMoveDistance||Math.abs(r.distanceY)>=this._startDragMoveDistance)){var o=this._fetchNodeInParent(this.game.world,r.startX,r.startY);var h={x:r.x,y:r.y};var l=o?o.getInputEventHandle(this._needHandleDragTypes,r.startX,r.startY):[];var p=new pt.DragStartEvent(r);r._x=r.startX;r._y=r.startY;for(var f=0;f<l.length;f++){l[f].fireInputEvent("onDragStart",p)}r._x=h.x;r._y=h.y;a.draggingNodeList=l}if(a.draggingNodeList&&a.draggingNodeList.length>0){var l=n?n.getInputEventHandle("onDragDrop",e,i):[];for(var f=0;f<l.length;f++){var d=l[f];for(var _=0;_<a.draggingNodeList.length;_++){var g=a.draggingNodeList[_];var m=new pt.DropEvent(r,g);if(d&&(!d.isAllowDrop||d.isAllowDrop(g))){d.fireInputEvent("onDragOver",m)}}}var y=new pt.DragEvent(r);for(var _=0;_<a.draggingNodeList.length;_++){var g=a.draggingNodeList[_];g.fireInputEvent("onDrag",y)}}};ct.prototype.onWheel=function(t,e){if(this.input.hasCursor){var i=this.input.cursorPosition;var r=this._fetchNodeInParent(this.game.world,i.x,i.y);var a=r?r.getInputEventHandle("onWheel"):[];for(var n=0;n<a.length;n++){var s=a[n];var o=new pt.WheelEvent(-t,-e);s.fireInputEvent("onWheel",o);this.onCursorMove(i.x,i.y)}}};ct.prototype.onCursorMove=function(t,e){var i=this._fetchNodeInParent(this.game.world,t,e);var r=new pt.CursorMoveEvent(t,e);this.checkEventRecordNode(this);this.doPointerExitAndEnter(this,r,i)};ct.prototype.doPointerExitAndEnter=function(t,e,i){if(t.overNode===i){return}var r=this.findCommonRoot(t.overNode,i);if(t.overNode){var a=t.overNode;while(a&&a!==this.game.world){if(r&&r===a)break;a.fireInputEvent("onExit",e);a=a.parent}}if(i){var a=i;while(a&&a!==r&&a!==this.game.world){a.fireInputEvent("onEnter",e);a=a.parent}}t.overNode=i};ct.prototype._flattenPolygonContains=function(t,e,i){var r=t.length/2;var a=false;for(var n=-1,s=r-1;++n<r;s=n){var o=t[2*n];var h=t[2*n+1];var l=t[2*s];var u=t[2*s+1];if((h<=i&&i<u||u<=i&&i<h)&&e<(l-o)*(i-h)/(u-h)+o){a=!a}}return a};ct.prototype.findCommonRoot=function(t,e){if(!t||!e){return null}var i=t;var r=e;while(i){r=e;while(r){if(i===r){return i}r=r.parent}i=i.parent}return null};ct.prototype._fetchNodeInParent=function(t,e,i,r){if(!t||!t.phaser.visible)return null;var a=t.phaser.worldTransform.applyInverse({x:e,y:i});if(t===this.game.world){if(!t.rect.contains(a.x,a.y))return null}if(pt.Util.isArray(r)){for(var n=0;n<r.length;n++){if(t===r[n])return null}}else if(t===r){return null}if(t.phaser.mask){var s=t.phaser.mask.graphicsData.length;var o=false;for(var n=0;n<t.phaser.mask.graphicsData.length;n++){var h=t.phaser.mask.graphicsData[n];if(!h.fill){continue}if(h.shape){if(h.shape.points&&h.shape.points.length>0&&!(h.shape.points[0]instanceof pt.Point)&&this._flattenPolygonContains(h.shape.points,e,i)){o=true}else if(h.shape.contains(e,i)){o=true}break}}if(s!=0&&!o){return null}}if(t.phaser.softClip&&t.phaser.softClip.length){if(!pt.GeometricTool.polygonContains(t.phaser.softClip,e,i)){return null}}var l=null;var u=t.children,n=u.length;while(n--){l=this._fetchNodeInParent(u[n],e,i,r);if(l)return l}if(t.checkHit(a.x,a.y)){return t}return null};var gt=pt.DirtyRectangle=function(t){var e=this;e._destroyRegion=[];e.game=t;e.game.world.getSelfWidth=function(){return this.width};e.game.world.getSelfHeight=function(){return this.height};e.game.scale.onSizeChange.add(e.onSizeChange,e);e.enable=false;e.showDirtyRegion=false;e.forceDirty=false};gt.prototype={};gt.prototype.constructor=gt;P.defineProperties(gt.prototype,{enable:{get:function(){return this._enable},set:function(t){if(t===this._enable)return;this._enable=t;this._recalcAll=t;if(!t){this.releaseDirtyCanvas()}}},showDirtyRegion:{get:function(){return this._showDirtyRegion},set:function(t){if(t===this._showDirtyRegion)return;this._showDirtyRegion=t;if(!t){this.releaseDirtyCanvas()}}}});gt.prototype.redirectDirty=function(t){var e=this;e._enable&&t&&e._destroyRegion.push(t)};gt.prototype.onSizeChange=function(){var t=this;t.game.world.displayChanged(pt.DisplayChangeStatus.SIZE)};gt.prototype._unionRect=function(t,e){var i=t.x+t.width,r=t.y+t.height,a=e.x+e.width,n=e.y+e.height,s=t.x<e.x?t.x:e.x,o=t.y<e.y?t.y:e.y,h=i<a?a:i,l=r<n?n:r,u=h-s,f=l-o;return{x:s,y:o,width:u,height:f,area:u*f}};gt.prototype._insersectionRect=function(t,e){var i=t.x+t.width,r=t.y+t.height,a=e.x+e.width,n=e.y+e.height,s=t.x>e.x?t.x:e.x,o=t.y>e.y?t.y:e.y,h=i>a?a:i,l=r>n?n:r,u=h-s,f=l-o;if(u<0||f<0){return null}var c={x:s,y:o,width:u,height:f,area:u*f};return c};gt.prototype._mergeRect=function(t,e){var i=this;var r=t.length;if(r<2){return true}var a=-1;var n=false;var s=null;var o=0;while(!n&&++a<r){var h=t[a];h.clip&&(h=h.clip);o=a;while(!n&&++o<r){var l=t[o];l.clip&&(l=l.clip);s=i._unionRect(h,l);n=s.area*.8-h.area-l.area<0}}if(n&&s){t[a]=s;t.splice(o,1);return false}return true};gt.prototype.collectDirtyRegion=function(t,e,i){var r=this;i=i||[];if(!e)return i;var a=t;if(e instanceof dt.Text){if(e.dirty){e.updateText();e.getWorldTransform();e.dirty=false}}var n=e.isSkipChildrenRender&&e.isSkipChildrenRender();var s=e.getDisplayProxy&&e.getDisplayProxy()||e;if(s!==e){s.displayChanged(e._displayChangeStatus)}if(s._updateBounds){n|=s._updateBounds(r._recalcAll)}if(s._mask){var o=s._currWorldBounds;if(o){a=a?r._insersectionRect(a,o):o}}if(s._dirtyBounds){var h=s._currWorldBounds;if(h&&a){var l=r._insersectionRect(h,a);if(!l){h=null}else{s._currWorldBounds.clip=l}}if(s._lastWorldBounds){var u=s._lastWorldBounds.length;while(u--){var f=s._lastWorldBounds[u];if(f){i.push(f)}}}s._lastWorldBounds=[];h&&i.push(h);s._dirtyBounds=false}if(s._displayChangeStatus===0){n|=!e._subDisplayChanged}e._subDisplayChanged=false;if(r._recalcAll||!n){var c=e.children.length;while(c--){r.collectDirtyRegion(a,e.children[c],i)}}e._resetDisplayChangeStatus&&e._resetDisplayChangeStatus();if(s!==e){s._resetDisplayChangeStatus&&s._resetDisplayChangeStatus()}return i};gt.prototype.updateDirtyRegion=function(t,e,i){var r=this;var a=Date.now();if(i._displayChangeStatus==null){i._displayChangeStatus=-1}var n=r._currDirtyRegion=r.collectDirtyRegion(null,i);if(r._destroyRegion){Array.prototype.push.apply(n,r._destroyRegion);r._destroyRegion=[]}if(r._recalcAll||r.forceDirty||n.length>500){r._recalcAll=false;r._currDirtyRegion=n=[{x:0,y:0,width:r.game.width,height:r.game.height}];r.forceDirty=false}else{while(!r._mergeRect(n)){}}var s=n.length;if(!s){return false}t.save();r._saveContext=true;t.beginPath();while(s--){var o=n[s];if(!o||o.clip===0)continue;if(o.clip)o=o.clip;t.rect(o.x*e-1|0,o.y*e-1|0,o.width*e+3|0,o.height*e+3|0)}t.clip();i._displayChangeStatus=0;return true};gt.prototype.restore=function(t){var e=this;if(e._saveContext){t.restore();e._saveContext=false}};gt.prototype.checkShowDirtyCanvas=function(){var t=this;var e=t.game.canvas;var i=t._dirtyCanvas;if(!e)return false;if(!i){i=t._dirtyCanvas=document.createElement("canvas");t._dirtyContext=t._dirtyCanvas.getContext("2d");e.parentNode.insertBefore(t._dirtyCanvas,e);i.style.left=i.style.top="0px";i.style.position="absolute"}if(i.style.width!==e.style.width||i.style.height!==e.style.height||i.width!==e.width||i.height!==e.height){i.width=e.width;i.height=e.height;i.style.width=e.style.width;i.style.height=e.style.height}return true};gt.prototype.releaseDirtyCanvas=function(){var t=this,e=t._dirtyCanvas;if(!e)return;this.dirtyContext=null;this._dirtyCanvas=null;if(e.parentElement){e.parentElement.removeChild(e)}};gt.prototype.showDirtyRectangle=function(t,e){if(!this._showDirtyRegion){return}var i=this;if(!i.checkShowDirtyCanvas())return;var r=i._dirtyCanvas;var a=i._dirtyContext;a.clearRect(0,0,r.width,r.height);a.beginPath();var n=this._currDirtyRegion;var s=n.length;var o=.9;if(s===0&&this._lastShowAlpha>0){n=this._lastShowRegion;o=this._lastShowAlpha-.05;s=n.length}else{this._lastShowRegion=n}this._lastShowAlpha=o;while(s--){var h=n[s];if(!h)continue;if(h.clip){a.rect(h.clip.x*e,h.clip.y*e,h.clip.width*e,h.clip.height*e)}else{a.rect(h.x*e,h.y*e,h.width*e,h.height*e)}}a.lineWidth=3;a.strokeStyle="rgba(255,255,0, "+this._lastShowAlpha+")";a.stroke()};var mt=function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];function r(){this.constructor=t}r.prototype=e.prototype;t.prototype=new r};pt.dragonBonesDriver=function(t,e){if(D.dragonBones){dragonBones.PhaserFactory.init(t);pt.dragonBones.game=t}};pt.dragonBonesDriver.prototype={update:function(){}};pt.dragonBonesDriver.prototype.constructor=pt.dragonBonesDriver;pt.Transition={NONE:0,COLOR_TINT:1,TEXTURE_SWAP:2,ANIMATION:3};pt.UIState={NORMAL:0,PRESSED:1,DISABLED:2};pt.Util={findClass:function(t){var e=t.split(".");var i=D;for(var r=0;r<e.length-1;r++){if(!i[e[r]])return;i=i[e[r]]}return i[e[e.length-1]]},clone:function(t){if(null===t||"object"!==typeof t)return t;var e=new t.constructor;for(var i in t){if(t.hasOwnProperty(i))e[i]=t[i]}return e},isArray:Array.isArray||function(t){return toString.call(t)==="[object Array]"},removeHTML:function(){var e;return function(t){if(t&&t.parentNode){if(e===t){return}e=t;t.parentNode.removeChild(t);e=null}}}(),updateTransform:function(t,e){var i=t.game;var r=i.phaser.scale.scaleFactorInversed;var a=e.style;var n=t.rect;var s=t.worldTransform;var o=(-n.x).toFixed(5)+"px "+(-n.y).toFixed(5)+"px";var h="matrix("+(s.a*r.x).toFixed(5)+","+(s.b*r.x).toFixed(5)+","+(s.c*r.y).toFixed(5)+","+(s.d*r.y).toFixed(5)+","+(s.tx*r.x).toFixed(0)+","+(s.ty*r.y).toFixed(0)+")";a.left=n.x.toFixed(5)+"px";a.top=n.y.toFixed(5)+"px";a.width=n.width.toFixed(5)+"px";a.height=n.height.toFixed(5)+"px";a.webkitTransform=h;a.mozTransform=h;a.msTransform=h;a.oTransform=h;a.transform=h;a.webkitTransformOrigin=o;a.mozTransformOrigin=o;a.msTransformOrigin=o;a.oTransformOrigin=o;a.transformOrigin=o},formatString:function(t){var i=arguments;if(i.length<=1)return pt.Util.formatValue(t).replace(/^\'|\'$/g,"");return t.replace(/\{(\d+)\}/g,function(t,e){return pt.Util.formatValue(i[parseInt(e)+1]).replace(/^\'|\'$/g,"")})},popupError:function(t){if(D.parent&&D.parent.G&&D.parent.G.notification){var e=D.parent.G;var i=pt.Util.formatString(e._("Exception notification"),t);e.notification.error(i)}else{var i="Error: "+t;if(typeof qici!=="undefined"&&qici.config){var r=qici.config.gameInstance;var a=D[r];if(a){a.log.error(i);if(a.debug.on)if(!D.__wx)alert(i);else{wx.showModal({title:"",content:i,showCancel:false})}}}else console.error(i)}},formatValue:function(t,e,i){if(typeof e!=="number")e=0;i=i||[];var r=function(t){if(t===C)return"undefined";if(t===null)return"null";var e=typeof t;var i=P.prototype.toString.call(t);if(e==="string"){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return r}if(e==="number"){if(t===0&&1/t<0)return"-0";return""+t}if(e==="boolean")return""+t;if(e==="symbol")return t.toString();if(e==="function"){var a=t.name?":"+t.name:"";return"[Function"+a+"]"}if(i==="[object RegExp]")return"[RegExp: "+RegExp.prototype.toString.call(t)+"]";if(i==="[object Error]")return"[Error: "+t.stack+"]";if(i==="[object Date]")return"[Date: "+Date.prototype.toString.call(t)+"]"};var a=r(t);if(a){return a}var n=P.keys(t);if(n.length===0){var s=t;try{s=t.valueOf()}catch(t){}a=r(s);if(a){return a}}var o=function(e,i,t,r){var a=[];for(var n=0,s=e.length;n<s;++n){if(P.prototype.hasOwnProperty.call(e,String(n))){a.push(f(r,e,i,String(n),true))}else{a.push("")}}t.forEach(function(t){if(typeof t==="symbol"||!t.match(/^\d+$/)){a.push(f(r,e,i,t,true))}});return a};var h=function(e,i,t,r){return t.map(function(t){return f(r,e,i,t,false)})};var l,u;if(Array.isArray(t)){l=["[","]"];u=o}else{l=["{","}"];u=h}if(n.length===0){return l[0]+""+l[1]}var f=function(t,e,i,r,a){var n,s,o;o=P.getOwnPropertyDescriptor(e,r)||{value:e[r]};if(o.get){if(o.set){s="[Getter/Setter]"}else{s="[Getter]"}}else{if(o.set){s="[Setter]"}}if(!s){if(t.indexOf(o.value)<0){if(i===null){s=pt.Util.formatValue(o.value,null,t)}else{s=pt.Util.formatValue(o.value,i-1,t)}if(s.indexOf("\n")>-1){if(a){s=s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2)}else{s="\n"+s.split("\n").map(function(t){return"   "+t}).join("\n")}}}else{s="[Circular]"}}if(a&&r.match(/^\d+$/)){return s}n=JSON.stringify(""+r);if(n.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){n=n.substr(1,n.length-2)}else{n=n.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'").replace(/\\\\/g,"\\")}return n+": "+s};if(e<0){var c="Object";if(Array.isArray(t))c="Array";else{if(t.class&&typeof t.class==="string")c=t.class;if(t.name&&typeof t.class==="string")c=c+"("+t.name+")"}return"["+c+"]"}i.push(t);var p=u(t,e,n,i);i.pop();var d=function(t,e){var i=t.reduce(function(t,e){return t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(i>60){return e[0]+(e[0].length===1?"":"\n ")+" "+t.join(",\n  ")+" "+e[1]}return e[0]+" "+t.join(", ")+" "+e[1]};return d(p,l)},insertSortedList:function(t,e,i,r){var a=function(t,e,i){var r=0;var a=t.length-1;if(a<0){return-1}var n=0;while(r<a){n=Math.floor((r+a)/2);i(t[n],e)?r=n+1:a=n}return i(t[r],e)?-1:r};var n=a(t,e,i);var s;if(r){s=n<0?t.push(e)-1:t.splice(n,0,e)&&n}else{s=n<0?t.push(e)-1:t.splice(n,i(e,t[n])?0:1,e)&&n}return s}};D.onerror=function(t,e,i,r,a){pt.Util.popupError(t)};var yt=pt.Color=function(t){this.alpha=1;this._rgb=[255,255,255];if(t==null)return;if(typeof t==="number"){this._rgb[0]=t>>16&255;this._rgb[1]=t>>8&255;this._rgb[2]=t&255;this.alpha=(t>>>24)/255}else if(pt.Util.isArray(t)){this.rgb=t}else if(typeof t==="string"){t=t.toLowerCase();if(t.indexOf("rgb")===0){var e=dt.Color.webToColor(t)}else{var e=this._hexToColor(t);e.a=e.a/255}this._rgb[0]=e.r;this._rgb[1]=e.g;this._rgb[2]=e.b;this.alpha=e.a}else throw new Error("Invalid color")};yt.prototype={};yt.prototype.constructor=yt;P.defineProperties(yt.prototype,{alpha:{get:function(){return this._alpha},set:function(t){if(t<0||t>1)t=1;this._alpha=t}},rgb:{get:function(){return this._rgb},set:function(t){if(!pt.Util.isArray(t))throw new Error("Expected:Array");if(t.length<3)throw new Error("Invalid rgb");this._rgb[0]=t[0];this._rgb[1]=t[1];this._rgb[2]=t[2];if(t.length===4)this.alpha=t[3];else this.alpha=1}},r:{get:function(){return this._rgb[0]},set:function(t){this._rgb[0]=t}},g:{get:function(){return this._rgb[1]},set:function(t){this._rgb[1]=t}},b:{get:function(){return this._rgb[2]},set:function(t){this._rgb[2]=t}},class:{get:function(){return"qc.Color"}}});yt.prototype.toString=function(t){switch(t){case"#rgb":return"#"+dt.Color.componentToHex(this._rgb[0])+dt.Color.componentToHex(this._rgb[1])+dt.Color.componentToHex(this._rgb[2]);case"#argb":return"#"+dt.Color.componentToHex(Math.round(this.alpha*255))+dt.Color.componentToHex(this._rgb[0])+dt.Color.componentToHex(this._rgb[1])+dt.Color.componentToHex(this._rgb[2]);case"rgb":return"rgb("+this._rgb[0].toString()+","+this._rgb[1].toString()+","+this._rgb[2].toString()+")";default:return"rgba("+this._rgb[0].toString()+","+this._rgb[1].toString()+","+this._rgb[2].toString()+","+this.alpha+")"}};yt.prototype.toNumber=function(t){if(t)return(this.alpha*255<<24|this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0;return(this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0};yt.prototype._hexToColor=function(t){if(t.length<=0||t[0]!=="#")return{r:255,g:255,b:255,a:255};t=t.substr(1,t.length-1);var e=false;if(t.length>6&&t.length<=8){e=true;while(t.length<8)t="0"+t}while(t.length<6)t="0"+t;var i=255;var r=0;if(e){i=parseInt(t.substr(r,2),16);r+=2}var a=parseInt(t.substr(r,2),16);r+=2;var n=parseInt(t.substr(r,2),16);r+=2;var s=parseInt(t.substr(r,2),16);return{r:a,g:n,b:s,a:i}};yt.black=new yt(4278190080);yt.white=new yt(4294967295);yt.red=new yt(4294901760);yt.yellow=new yt(4294967040);yt.blue=new yt(4278255615);yt.green=new yt(4278255360);yt.grey=new yt(4291611852);yt.shadow=new yt(2147483648);yt.background=new yt(4282861383);pt.CanvasPool={pool:{},unused:[],cookie:19870101,get:function(t){var e=pt.CanvasPool.pool;var i=e[t];var r=false;if(!i){r=true;var a=pt.CanvasPool.unused;if(a.length)e[t]=i=a.pop();else e[t]=i=dt.Canvas.create(1,1)}i._cookie=pt.CanvasPool.cookie;return{canvas:i,dirty:r}},stat:function(){var t=0;var e=0;var i=pt.CanvasPool.pool;for(var r in i){var a=i[r];if(!a)continue;t++;e+=a.width*a.height}console.info("当前Canvas使用中："+t+"，总像素为："+e+"，未使用的Canvas数量："+pt.CanvasPool.unused.length)},postRender:function(){var t=pt.CanvasPool;var e=t.cookie;t.cookie=e+1;var i=t.pool;var r=t.unused;var a=P.keys(i);for(var n=0,s=a.length;n<s;n++){var o=a[n];var h=i[o];if(h._cookie!==e){delete i[o];h.width=1;h.height=1;r.push(h)}}}};var vt=D.applicationCache;if(!!vt){var Tt=function(t){};var xt=function(t){};vt.addEventListener("cached",Tt,false);vt.addEventListener("checking",Tt,false);vt.addEventListener("downloading",Tt,false);vt.addEventListener("error",xt,false);vt.addEventListener("noupdate",Tt,false);vt.addEventListener("obsolete",Tt,false);vt.addEventListener("progress",Tt,false);vt.addEventListener("updateready",Tt,false)}var bt=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964),At=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697),St=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272),wt=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144),Pt=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256),Et=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488),Dt=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746),Ct=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568),Ot=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578),Mt=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488),It=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800),Rt=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744),Nt=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128),Bt=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261);var Lt=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756);var Ft=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344);var kt=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584);var Ut=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928);var jt=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080);var Wt=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312);var Vt=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154);var zt=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696);pt.Des={encrypt:function(t,e,i,r,a){return pt.Des._des(t,e,true,i,r,a)},decrypt:function(t,e,i,r,a){return pt.Des._des(t,e,false,i,r,a)},_des:function(t,e,i,r,a,n){var s=pt.Des.des_createKeys(t);var o=0,h,l,u,f,c,p,d,_,g;var m,y,v,T;var x,b;var A=e.length;var S=0;var w=s.length==32?3:9;if(w==3){g=i?new Array(0,32,2):new Array(30,-2,-2)}else{g=i?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2)}if(n==2)e+="        ";else if(n==1){u=8-A%8;e+=String.fromCharCode(u,u,u,u,u,u,u,u);if(u==8)A+=8}else if(!n)e+="\0\0\0\0\0\0\0\0";var P="";var E="";if(r==1){m=a.charCodeAt(o++)<<24|a.charCodeAt(o++)<<16|a.charCodeAt(o++)<<8|a.charCodeAt(o++);v=a.charCodeAt(o++)<<24|a.charCodeAt(o++)<<16|a.charCodeAt(o++)<<8|a.charCodeAt(o++);o=0}while(o<A){d=e.charCodeAt(o++)<<24|e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++);_=e.charCodeAt(o++)<<24|e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++);if(r==1){if(i){d^=m;_^=v}else{y=m;T=v;m=d;v=_}}u=(d>>>4^_)&252645135;_^=u;d^=u<<4;u=(d>>>16^_)&65535;_^=u;d^=u<<16;u=(_>>>2^d)&858993459;d^=u;_^=u<<2;u=(_>>>8^d)&16711935;d^=u;_^=u<<8;u=(d>>>1^_)&1431655765;_^=u;d^=u<<1;d=d<<1|d>>>31;_=_<<1|_>>>31;for(l=0;l<w;l+=3){x=g[l+1];b=g[l+2];for(h=g[l];h!=x;h+=b){c=_^s[h];p=(_>>>4|_<<28)^s[h+1];u=d;d=_;_=u^(Ft[c>>>24&63]|Ut[c>>>16&63]|Wt[c>>>8&63]|zt[c&63]|Lt[p>>>24&63]|kt[p>>>16&63]|jt[p>>>8&63]|Vt[p&63])}u=d;d=_;_=u}d=d>>>1|d<<31;_=_>>>1|_<<31;u=(d>>>1^_)&1431655765;_^=u;d^=u<<1;u=(_>>>8^d)&16711935;d^=u;_^=u<<8;u=(_>>>2^d)&858993459;d^=u;_^=u<<2;u=(d>>>16^_)&65535;_^=u;d^=u<<16;u=(d>>>4^_)&252645135;_^=u;d^=u<<4;if(r==1){if(i){m=d;v=_}else{d^=y;_^=T}}E+=String.fromCharCode(d>>>24,d>>>16&255,d>>>8&255,d&255,_>>>24,_>>>16&255,_>>>8&255,_&255);S+=8;if(S==512){P+=E;E="";S=0}}return P+E},des_createKeys:function(t){var e=t.length>8?3:1;var i=new Array(32*e);var r=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0);var a,n,s=0,o=0,h;for(var l=0;l<e;l++){var u=t.charCodeAt(s++)<<24|t.charCodeAt(s++)<<16|t.charCodeAt(s++)<<8|t.charCodeAt(s++);var f=t.charCodeAt(s++)<<24|t.charCodeAt(s++)<<16|t.charCodeAt(s++)<<8|t.charCodeAt(s++);h=(u>>>4^f)&252645135;f^=h;u^=h<<4;h=(f>>>-16^u)&65535;u^=h;f^=h<<-16;h=(u>>>2^f)&858993459;f^=h;u^=h<<2;h=(f>>>-16^u)&65535;u^=h;f^=h<<-16;h=(u>>>1^f)&1431655765;f^=h;u^=h<<1;h=(f>>>8^u)&16711935;u^=h;f^=h<<8;h=(u>>>1^f)&1431655765;f^=h;u^=h<<1;h=u<<8|f>>>20&240;u=f<<24|f<<8&16711680|f>>>8&65280|f>>>24&240;f=h;for(var c=0;c<r.length;c++){if(r[c]){u=u<<2|u>>>26;f=f<<2|f>>>26}else{u=u<<1|u>>>27;f=f<<1|f>>>27}u&=-15;f&=-15;a=bt[u>>>28]|At[u>>>24&15]|St[u>>>20&15]|wt[u>>>16&15]|Pt[u>>>12&15]|Et[u>>>8&15]|Dt[u>>>4&15];n=Ct[f>>>28]|Ot[f>>>24&15]|Mt[f>>>20&15]|It[f>>>16&15]|Rt[f>>>12&15]|Nt[f>>>8&15]|Bt[f>>>4&15];h=(n>>>16^a)&65535;i[o++]=a^h;i[o++]=n^h<<16}}return i}};dt.Game.prototype.update=function(t){var e=Date.now();this._qc.update(t);this._qc.debug.total+=Date.now()-e};var Gt=dt.Game.prototype.setUpRenderer;dt.Game.prototype.setUpRenderer=function(){if(this.device.webGL&&!this.device.desktop&&!this.device.iOS){if(pt.isSupportWebGL&&!pt.isSupportWebGL(this._qc)){this.device.webGL=false}}Gt.call(this)};dt.Group.prototype.preUpdate=function(){var t=this._qc;if(t&&t.static)return true;if(t){if(t.preUpdate)t.preUpdate();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.preUpdate)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;r.preUpdate();if(!this.visible)return}}var a=this.children;var i=a.length;while(i--){if(!a[i])continue;if(a[i].visible){a[i].preUpdate()}else{a[i].renderOrderID=-1}}return true};dt.Group.prototype.update=function(){var t=this._qc;if(t&&t.static)return true;if(t){if(t.update)t.update();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.update)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;r.update();if(!this.visible)return}}var a=this.children;var i=a.length;while(i--){if(a[i]&&a[i].visible)a[i].update()}};dt.Group.prototype.postUpdate=function(){if(this.fixedToCamera){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}var t=this._qc;if(t&&t.static)return;if(t){if(t.postUpdate)t.postUpdate();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.postUpdate)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;r.postUpdate();if(!this.visible)return}}var a=this.children;var i=a.length;while(i--){if(a[i]&&a[i].visible)a[i].postUpdate()}};dt.StateManager.prototype.loadComplete=function(){var t=this;if(t._created===true)return;var e=t.game._qc;if(e.assets.parsing||e.state.pendLoadComplete){e.timer.add(15,function(){t.loadComplete()});return}if(t._created===false&&t.onCreateCallback){t._created=true;t.onCreateCallback.call(t.callbackContext,t.game)}else{t._created=true}};var Yt=dt.StateManager.prototype.clearCurrentState;dt.StateManager.prototype.clearCurrentState=function(){Yt.call(this);this.game.world.displayChanged(pt.DisplayChangeStatus.SIZE)};var Ht=dt.Device._initialize;dt.Device._initialize=function(){Ht.call(this);var t=D.navigator.userAgent;this.UCBrowser=/UCBrowser/.test(t);if(this.iOS){navigator.appVersion.match(/OS (\d+)/);this.iOSVersion=parseInt(RegExp.$1,10)}var e=/AppleWebKit\/([0-9\.]+)/;var i=e.exec(navigator.userAgent);if(i&&i.length>0){this.AppleWebKit=true;this.AppleWebKitVersion=i[1].split(".")}else{this.AppleWebKit=false}this.supportStencil=!this.AppleWebKit||this.AppleWebKitVersion[0]>534;if(this.android&&this.UCBrowser){pt.__IS_ANDROID_UC=true}};dt.Animation=function(t,e,i,r,a,n,s){if(typeof s==="undefined"){s=false}this.game=t;this._parent=e;this._frameData=r;this.name=i;this._frames=[];this._frames=this._frames.concat(a);this.delay=1e3/n;this.loop=s;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex;this.onStart=new dt.Signal;this.onUpdate=null;this.onComplete=new dt.Signal;this.onLoop=new dt.Signal;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};dt.Animation.prototype={play:function(t,e,i){if(typeof t==="number"){this.delay=1e3/t}if(typeof e==="boolean"){this.loop=e}if(typeof i!=="undefined"){this.killOnComplete=i}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.updateCurrentFrame(false);this._parent.events.onAnimationStart$dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex;this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},setFrame:function(t,e){var i;if(typeof e==="undefined"){e=false}if(typeof t==="string"){for(var r=0;r<this._frames.length;r++){if(this._frameData&&this._frameData.getFrame(this._frames[r]).name===t){i=r}}}else if(typeof t==="number"){if(e){i=t}else{for(var r=0;r<this._frames.length;r++){if(this._frames[r]===i){i=r}}}}if(i){this._frameIndex=i-1;this._timeNextFrame=this.game.time.time;this.update()}},stop:function(t,e){if(typeof t==="undefined"){t=false}if(typeof e==="undefined"){e=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(t){this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[0]):0;this._parent.setFrame(this.currentFrame)}if(e){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.time}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.time+this._frameDiff}},update:function(){if(this.isPaused){return false}if(this.isPlaying&&this.game.time.time>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.time-this._timeNextFrame;this._timeLastFrame=this.game.time.time;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=this._frameSkip*this.delay;this._frameSkip+=1}this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff);this._frameIndex+=this._frameSkip;if(this._frameIndex>=this._frames.length){if(this.loop){this._frameIndex%=this._frames.length;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex;this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this);return this.updateCurrentFrame(true)}else{this.complete();return false}}else{return this.updateCurrentFrame(true)}}return false},updateCurrentFrame:function(t){if(!this._frameData){return false}this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}}if(this.onUpdate&&t){this.onUpdate.dispatch(this,this.currentFrame);return!!this._frameData}else{return true}},next:function(t){if(typeof t==="undefined"){t=1}var e=this._frameIndex+t;if(e>=this._frames.length){if(this.loop){e%=this._frames.length}else{e=this._frames.length-1}}if(e!==this._frameIndex){this._frameIndex=e;this.updateCurrentFrame(true)}},previous:function(t){if(typeof t==="undefined"){t=1}var e=this._frameIndex-t;if(e<0){if(this.loop){e=this._frames.length+e}else{e++}}if(e!==this._frameIndex){this._frameIndex=e;this.updateCurrentFrame(true)}},updateFrameData:function(t){this._frameData=t;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):this._frameIndex%this._frames.length},destroy:function(){if(!this.game){return}this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose();if(this.onUpdate){this.onUpdate.dispose()}},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex;this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};dt.Animation.prototype.constructor=dt.Animation;P.defineProperty(dt.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t;if(t){this._pauseStartTime=this.game.time.time}else{if(this.isPlaying){this._timeNextFrame=this.game.time.time+this.delay}}}});P.defineProperty(dt.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});P.defineProperty(dt.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(t){this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[t]):t;if(this.currentFrame!==null){this._frameIndex=t;this._parent.setFrame(this.currentFrame);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame)}}}});P.defineProperty(dt.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(t){if(t>=1){this.delay=1e3/t}}});P.defineProperty(dt.Animation.prototype,"enableUpdate",{get:function(){return this.onUpdate!==null},set:function(t){if(t&&this.onUpdate===null){this.onUpdate=new dt.Signal}else if(!t&&this.onUpdate!==null){this.onUpdate.dispose();this.onUpdate=null}}});dt.Animation.generateFrameNames=function(t,e,i,r,a){if(typeof r==="undefined"){r=""}var n=[];var s="";if(e<i){for(var o=e;o<=i;o++){if(typeof a==="number"){s=dt.Utils.pad(o.toString(),a,"0",1)}else{s=o.toString()}s=t+s+r;n.push(s)}}else{for(var o=e;o>=i;o--){if(typeof a==="number"){s=dt.Utils.pad(o.toString(),a,"0",1)}else{s=o.toString()}s=t+s+r;n.push(s)}}return n};dt.AnimationManager=function(t){this.sprite=t;this.game=t.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};dt.AnimationManager.prototype={loadFrameData:function(t,e){if(typeof t==="undefined"){return false}if(this.isLoaded){for(var i in this._anims){this._anims[i].updateFrameData(t)}}this._frameData=t;if(typeof e==="undefined"||e===null){this.frame=0}else{if(typeof e==="string"){this.frameName=e}else{this.frame=e}}this.isLoaded=true;return true},copyFrameData:function(t,e){this._frameData=t.clone();if(this.isLoaded){for(var i in this._anims){this._anims[i].updateFrameData(this._frameData)}}if(typeof e==="undefined"||e===null){this.frame=0}else{if(typeof e==="string"){this.frameName=e}else{this.frame=e}}this.isLoaded=true;return true},add:function(t,e,i,r,a){e=e||[];i=i||60;if(typeof r==="undefined"){r=false}if(typeof a==="undefined"){if(e&&typeof e[0]==="number"){a=true}else{a=false}}this._outputFrames.length=0;if(this.sprite._qc&&this.sprite._qc.animationType===pt.Sprite.FRAME_ANIMATION){this._frameData.getFrameIndexes(e,a,this._outputFrames);this._anims[t]=new dt.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,r)}else{var n=this.sprite._qc._animation[t].last;var s=new Array(n);for(var o=0,h=n;o<h;o++)s[o]=o;this._anims[t]=new dt.Animation(this.game,this.sprite,t,null,s,i,r)}this.currentAnim=this._anims[t];if(this.sprite._qc&&this.sprite._qc.animationType===pt.Sprite.FRAME_ANIMATION)this.currentFrame=this.currentAnim.currentFrame;if(this.sprite.__tilePattern){this.sprite.__tilePattern=false;this.tilingTexture=false}return this._anims[t]},validateFrames:function(t,e){if(typeof e==="undefined"){e=true}for(var i=0;i<t.length;i++){if(e===true){if(t[i]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(t[i])===false){return false}}}return true},play:function(t,e,i,r){if(this._anims[t]){var a=this.currentAnim;if(a===this._anims[t]){if(a.isPlaying===false){a.paused=false;return a.play(e,i,r)}if(typeof e==="number"&&a.delay!==1e3/e){a.delay=1e3/e;a._timeNextFrame=a._timeLastFrame+a.delay}if(typeof i==="boolean")a.loop=i;if(typeof r!=="undefined")a.killOnComplete=r;return a}else{if(a&&a.isPlaying){a.stop()}a=this._anims[t];a.paused=false;if(this.sprite._qc&&this.sprite._qc.animationType===pt.Sprite.FRAME_ANIMATION)this.currentFrame=a.currentFrame;return a.play(e,i,r)}}},stop:function(t,e){if(typeof e==="undefined"){e=false}if(typeof t==="string"){if(this._anims[t]){this.currentAnim=this._anims[t];this.currentAnim.stop(e)}}else{if(this.currentAnim){this.currentAnim.stop(e)}}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()){if(this.sprite._qc&&this.sprite._qc.animationType===pt.Sprite.FRAME_ANIMATION)this.currentFrame=this.currentAnim.currentFrame;return true}return false},next:function(t){if(this.currentAnim){this.currentAnim.next(t);if(this.sprite._qc&&this.sprite._qc.animationType===pt.Sprite.FRAME_ANIMATION)this.currentFrame=this.currentAnim.currentFrame}},previous:function(t){if(this.currentAnim){this.currentAnim.previous(t);if(this.sprite._qc&&this.sprite._qc.animationType===pt.Sprite.FRAME_ANIMATION)this.currentFrame=this.currentAnim.currentFrame}},getAnimation:function(t){if(typeof t==="string"){if(this._anims[t]){return this._anims[t]}}return null},refreshFrame:function(){this.sprite.setTexture(_t.TextureCache[this.currentFrame.uuid]);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}},destroy:function(){var t=null;for(var t in this._anims){if(this._anims.hasOwnProperty(t)){this._anims[t].destroy()}}this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};dt.AnimationManager.prototype.constructor=dt.AnimationManager;P.defineProperty(dt.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});P.defineProperty(dt.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});P.defineProperty(dt.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}});P.defineProperty(dt.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim){return this.currentAnim.name}}});P.defineProperty(dt.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this.currentFrame.index}},set:function(t){if(typeof t==="number"&&this._frameData&&this._frameData.getFrame(t)!==null){this.currentFrame=this._frameData.getFrame(t);if(this.currentFrame){this.sprite.setFrame(this.currentFrame);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}}});P.defineProperty(dt.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(t){if(typeof t==="string"&&this._frameData.getFrameByName(t)!==null){this.currentFrame=this._frameData.getFrameByName(t);if(this.currentFrame){this._frameIndex=this.currentFrame.index;this.sprite.setFrame(this.currentFrame);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}else{}}});pt.BATCH_QUAD=0;pt.BATCH_TRIANGLES=1;var Xt=_t.WebGLSpriteBatch.prototype.setContext;_t.WebGLSpriteBatch.prototype.setContext=function(t){Xt.call(this,t);this.quadSize=this.size;this.triangleSize=300;this.batchIndexNumber=6;var e=this.triangleSize*3;this.triangleIndices=new _t.Uint16Array(e);for(var i=0;i<e;++i){this.triangleIndices[i]=i}this._batchType=pt.BATCH_QUAD;this.quadIndexBuffer=this.indexBuffer;this.triangleIndexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.triangleIndices,t.STATIC_DRAW)};var qt=_t.WebGLSpriteBatch.prototype.destroy;_t.WebGLSpriteBatch.prototype.destroy=function(){this.triangleIndices=null;this.gl.deleteBuffer(this.triangleIndexBuffer);qt.call(this)};P.defineProperties(_t.WebGLSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(t){if(t===this._batchType){return}this.stop();if(t===pt.BATCH_TRIANGLES){this.size=this.triangleSize;this.indexBuffer=this.triangleIndexBuffer;this._batchType=t;this.batchIndexNumber=3}else{this.size=this.quadSize;this.indexBuffer=this.quadIndexBuffer;this._batchType=t;this.batchIndexNumber=6}this.start()}}});_t.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(e===0)return;var r=this.gl;if(t._dirty[r.id]){this.renderSession.renderer.updateTexture(t)}else{r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id])}r.drawElements(r.TRIANGLES,e*this.batchIndexNumber,r.UNSIGNED_SHORT,i*this.batchIndexNumber*2);this.renderSession.drawCount++};_t.CanvasMaskManager.prototype.popMask=function(t){t.context.restore();if(pt.__IS_ANDROID_UC){var e=pt._tempCanvas;if(!e){e=pt._tempCanvas=document.createElement("canvas");e.width=128;e.height=128}t.context.drawImage(e,0,0,2,2,-5,-5,1,1)}};_t.CanvasTinter.getTintedTexture=function(t,e){var i=t.tintedTexture||document.createElement("canvas");_t.CanvasTinter.tintMethod(t.texture,e,i);return i};var Kt=pt.DisplayChangeStatus={OFFSET:1,SCALE:2,ROTATION:4,SIZE:8,TINT:16,ALPHA:32,SHOW:64,HIDE:128,TEXTURE:256,ORDER:512};Kt.VISIBLE_MASK=Kt.SHOW|Kt.HIDE;Kt.INHERIT_MASK=Kt.SIZE|Kt.ORDER|Kt.OFFSET|Kt.SCALE|Kt.ROTATION|Kt.VISIBLE_MASK;Kt.RECALC_MASK=Kt.ROTATION|Kt.VISIBLE_MASK|Kt.SIZE|Kt.SCALE;Kt.REOFFSET_MASK=Kt.OFFSET;var Jt=_t.DisplayObject.prototype.destroy;_t.DisplayObject.prototype.destroy=function(){this.maybeOutWorld();Jt.call(this)};_t.DisplayObject.prototype.setDisplayProxy=function(t,e){this._displayProxy=t;this._skipChildren=e};_t.DisplayObject.prototype.getDisplayProxy=function(){return this._displayProxy};_t.DisplayObject.prototype.isSkipChildrenRender=function(){return this._skipChildren};_t.DisplayObject.prototype.maybeOutWorld=function(){if(this.game)this.game._qc&&this.game._qc.dirtyRectangle.redirectDirty(this._currWorldBounds);else if(this.stage){this.stage.game._qc&&this.stage.game._qc.dirtyRectangle.redirectDirty(this._currWorldBounds)}};_t.DisplayObject.prototype.displayChanged=function(t){if(t===0||t==null){return}var e=this;if(e._displayChangeStatus==null){e._displayChangeStatus=Kt.SHOW}e._displayChangeStatus|=t;if(t&Kt.HIDE){this.displayObjectUpdateTransform();for(var i=0,r=this.children.length;i<r;++i){this.children[i].updateTransform()}}else if(t&Kt.SHOW){e._displayChangeStatus&=~Kt.HIDE}var a=e;while((a=a.parent)&&!a._subDisplayChanged){a._subDisplayChanged=true}};_t.DisplayObject.prototype._fastCalcBounds=function(t,e){var i=this,r=i.getSelfWidth&&i.getSelfWidth(),a=i.getSelfHeight&&i.getSelfHeight();if(e&Kt.HIDE||!i.worldAlpha||!i.worldVisible||!r||!a)return null;var n=i.worldTransform,s=n.a,o=n.b,h=n.c,l=n.d,u=n.tx,f=n.ty;if(!t||e&Kt.RECALC_MASK){var c=i.anchor?i.anchor.x:0,p=i.anchor?i.anchor.y:0;var d=r*-c,_=a*-p,g=d+r,m=_+a;var y;if(r<0){y=d;d=g;g=y}if(a<0){y=_;_=m;m=y}var v,T,x,b;if(o===0&&h===0){if(s<0){v=s*g+u;T=s*d+u}else{v=s*d+u;T=s*g+u}if(l<0){x=l*m+f;b=l*_+f}else{x=l*_+f;b=l*m+f}}else{var A,S,w,P,E,D,C,O;if(s>=0){A=s*d;S=s*g}else{A=s*g;S=s*d}if(o>=0){w=o*d;P=o*g}else{w=o*g;P=o*d}if(h>=0){E=h*_;D=h*m}else{E=h*m;D=h*_}if(l>=0){C=l*_;O=l*m}else{C=l*m;O=l*_}v=A+E+u;T=S+D+u;x=w+C+f;b=P+O+f}return{x:v,y:x,width:T-v,height:b-x,tx:u,ty:f,area:(T-v)*(b-x)}}else if(e&Kt.REOFFSET_MASK){var M=u-t.tx,I=f-t.ty;return{x:t.x+u-t.tx,y:t.y+f-t.ty,width:t.width,height:t.height,tx:u,ty:f,area:t.area}}else{return{x:t.x,y:t.y,tx:t.tx,ty:t.ty,width:t.width,height:t.height,area:t.area}}};_t.DisplayObject.prototype._updateBounds=function(t){var e=this,i=e.worldTransform,r=e.parent;var a=r?r._displayChangeStatus:0;if(e._displayChangeStatus==null||t){e._displayChangeStatus=Kt.SHOW}var n=e._displayChangeStatus;n=n|a&Kt.INHERIT_MASK;if(!e.worldVisible&&!(n&Kt.HIDE)){return true}if(n===0)return false;e._lastWorldBounds||(e._lastWorldBounds=[]);var s=e._qc&&e._qc.animationType===pt.Sprite.FRAME_SAMPLES;var o=e._currWorldBounds;e._currWorldBounds&&e._lastWorldBounds.push(e._currWorldBounds);e._displayChangeStatus=n;if(s){var h=e._qc.getSampledAnimationBounds();var l=e.worldTransform.apply(new pt.Point(h.x,h.y));var u=e.worldTransform.apply(new pt.Point(h.x+h.width,h.y));var f=e.worldTransform.apply(new pt.Point(h.x+h.width,h.y+h.height));var c=e.worldTransform.apply(new pt.Point(h.x,h.y+h.height));var p=Math.min(l.x,u.x,f.x,c.x);var d=Math.max(l.x,u.x,f.x,c.x);var _=Math.min(l.y,u.y,f.y,c.y);var g=Math.max(l.y,u.y,f.y,c.y);e._currWorldBounds={x:p,y:_,width:d-p,height:g-_,area:(d-p)*(g-_)}}else{e._currWorldBounds=e._fastCalcBounds(e._lastWorldBounds[e._lastWorldBounds.length-1],n)}e._dirtyBounds=o!==e._currWorldBounds;return false};_t.DisplayObject.prototype._resetDisplayChangeStatus=function(){var t=this;t._displayChangeStatus=0};_t.DisplayObject.prototype.updateTransform=function(){var t=this.parent;if(!t){return}this.worldAlpha=this.alpha*this.parent.worldAlpha;if(this._lastWorldAlpha!==this.worldAlpha){this._lastWorldAlpha=this.worldAlpha;this.displayChanged(Kt.ALPHA)}if(!this._isNotNeedCalcTransform||t._isSubNeedCalcTransform){this.game&&this.game._calcTransformCount++;var e=this.parent.worldTransform;var i=this.worldTransform;var r,a,n,s,o,h;i.inUpdate=true;if(this.rotation%_t.PI_2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}r=this._cr*this.scale.x;a=this._sr*this.scale.x;n=-this._sr*this.scale.y;s=this._cr*this.scale.y;o=this.position.x;h=this.position.y;if(this.pivot.x||this.pivot.y){o-=this.pivot.x*r+this.pivot.y*n;h-=this.pivot.x*a+this.pivot.y*s}i.a=r*e.a+a*e.c;i.b=r*e.b+a*e.d;i.c=n*e.a+s*e.c;i.d=n*e.b+s*e.d;i.tx=o*e.a+h*e.c+e.tx;i.ty=o*e.b+h*e.d+e.ty}else{r=this.scale.x;s=this.scale.y;o=this.position.x-this.pivot.x*r;h=this.position.y-this.pivot.y*s;i.a=r*e.a;i.b=r*e.b;i.c=s*e.c;i.d=s*e.d;i.tx=o*e.a+h*e.c+e.tx;i.ty=o*e.b+h*e.d+e.ty}this._isNotNeedCalcTransform=true;this._isSubNeedCalcTransform=true;if(this.worldTransformChangedCallback){this.worldTransformChangedCallback.call(this.worldTransformChangedContext)}if(this.transformCallback){i.inUpdate=false;this.transformCallback.call(this.transformCallbackContext,i,e)}if(this._onTransformChanged){this._onTransformChanged.dispatch(i,e)}}else{this._isSubNeedCalcTransform=false;var i=this.worldTransform;var e=t.worldTransform;if(this.transformCallback){i.inUpdate=false;this.transformCallback.call(this.transformCallbackContext,i,e)}}};_t.DisplayObject.prototype.displayObjectUpdateTransform=_t.DisplayObject.prototype.updateTransform;_t.DisplayObject.prototype.getWorldTransform=function(){var t=false;var e=this;var i=null;while(e){if(!e._isNotNeedCalcTransform){t=true;i=e}e=e.parent}if(t){i.updateTransform()}return this.worldTransform};_t.DisplayObjectContainer.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0)return;if(this._cacheAsBitmap){this._renderCachedSprite(t);return}var e;if(this.softClip){K.getManager(t).pushPolygon(this.softClip)}var i=false;if(this._graphicsFilter||this._mask||this._filters){if(this._graphicsFilter){t.spriteBatch.flush();t.filterManager.pushFilter(this._graphicsFilter)}if(this._filters&&!this.filterSelf){t.spriteBatch.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){t.spriteBatch.stop();t.maskManager.pushMask(this.mask,t);t.spriteBatch.start()}if(this._renderSelfWebGL){i=this._renderSelfWebGL(t)}if(!i){for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}}t.spriteBatch.stop();if(this._mask)t.maskManager.popMask(this._mask,t);if(this._filters&&!this.filterSelf)t.filterManager.popFilter();if(this._graphicsFilter)t.filterManager.popFilter();t.spriteBatch.start()}else{if(this._renderSelfWebGL){i=this._renderSelfWebGL(t)}if(!i){for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}}}if(this.softClip){K.getManager(t).popPolygon()}};_t.DisplayObjectContainer.prototype._renderCanvas=function(t){if(this.visible===false||this.alpha===0)return;if(this._cacheAsBitmap){this._renderCachedSprite(t);return}var e=false;if(this._mask){t.maskManager.pushMask(this._mask,t)}if(this._renderSelfCanvas){e=this._renderSelfCanvas(t)}if(!e){for(var i=0;i<this.children.length;i++){this.children[i]._renderCanvas(t)}}if(this._mask){t.maskManager.popMask(t)}};_t.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length){if(t.parent){t.parent.removeChild(t)}t.parent=this;this.children.splice(e,0,t);this._qc&&this._qc._dispatchChildrenChanged("add",[t._qc]);if(this.stage)t.setStageReference(this.stage);return t}else{throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)}};_t.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t===e){return}var i=this.getChildIndex(t);var r=this.getChildIndex(e);if(i<0||r<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.")}this.children[i]=e;this.children[r]=t;this._qc&&this._qc._dispatchChildrenChanged("order",[t._qc,e._qc]);t.displayChanged(pt.DisplayChangeStatus.ORDER);e.displayChanged(pt.DisplayChangeStatus.ORDER)};_t.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length){throw new Error("The supplied index is out of bounds")}var i=this.getChildIndex(t);this.children.splice(i,1);this.children.splice(e,0,t);this._qc&&this._qc._dispatchChildrenChanged("order",[t._qc]);t.displayChanged(pt.DisplayChangeStatus.ORDER)};_t.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);e.maybeOutWorld();if(this.stage)e.removeStageReference();e.parent=C;this.children.splice(t,1);this._qc&&this._qc._dispatchChildrenChanged("remove",[e._qc]);return e};_t.DisplayObjectContainer.prototype.remove=function(t){return this.removeChild(t)};_t.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0;var r=typeof e==="number"?e:this.children.length;var a=r-i;if(a>0&&a<=r){var n=this.children.splice(i,a);var s=[];for(var o=0;o<n.length;o++){var h=n[o];h.maybeOutWorld();if(this.stage)h.removeStageReference();h.parent=C;if(h._qc){s.push(h._qc)}}this._qc&&this._qc._dispatchChildrenChanged("remove",s);return n}else if(a===0&&this.children.length===0){this._qc&&this._qc._dispatchChildrenChanged("remove",[]);return[]}else{throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")}};_t.DisplayObjectContainer.prototype.getLocalBounds=function(){var t=this.worldTransform;this._isSubNeedCalcTransform=true;this.worldTransform=_t.identityMatrix;for(var e=0,i=this.children.length;e<i;e++){this.children[e].updateTransform()}var r=this.getBounds();this.worldTransform=t;this._isSubNeedCalcTransform=true;this._isNotNeedCalcTransform=false;return r};_t.DisplayObjectContainer.prototype.displayMaybeOutWorld=_t.DisplayObject.prototype.maybeOutWorld;_t.DisplayObjectContainer.prototype.maybeOutWorld=function(){this.displayMaybeOutWorld();var t=this.children;for(var e=0,i=t.length;e<i;e++){t[e].maybeOutWorld()}};_t.PixiShader.prototype.init=function(){var t=this.gl;var e=_t.compileProgram(t,this.vertexSrc||_t.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(e);this.uSampler=t.getUniformLocation(e,"uSampler");this.uSourceSampler=t.getUniformLocation(e,"uSourceSampler");this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.dimensions=t.getUniformLocation(e,"dimensions");this.pixelSize=t.getUniformLocation(e,"pixelSize");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");this.colorAttribute=t.getAttribLocation(e,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];if(this.extraAttribute){for(var i in this.extraAttribute){var r=this.extraAttribute[i].name;this[r]=t.getAttribLocation(e,r);this.attributes.push(this[r])}}for(var r in this.uniforms){this.uniforms[r].uniformLocation=t.getUniformLocation(e,r)}this.initUniforms();this.program=e};var Zt=_t.Sprite.prototype.setTexture;_t.Sprite.prototype.setTexture=function(t){Zt.call(this,t);this.displayChanged(pt.DisplayChangeStatus.TEXTURE|pt.DisplayChangeStatus.SIZE)};_t.Sprite.prototype.getSelfWidth=function(){if(this._qc){return this._qc.width}return this.texture&&this.texture.frame&&this.texture.frame.width};_t.Sprite.prototype.getSelfHeight=function(){if(this._qc){return this._qc.height}return this.texture&&this.texture.frame&&this.texture.frame.height};_t.Sprite.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0||!this.renderable)return;var e,i;if(this.softClip){K.getManager(t).pushPolygon(this.softClip)}if(this.maskPixel){var r=t.spriteBatch;r.flush();t.filterManager.pushFilter(this.maskPixel);for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}r.stop();t.filterManager.popFilter();r.start()}else if(this._graphicsFilter||this._mask||this._filters){var r=t.spriteBatch;if(this._graphicsFilter){r.flush();t.filterManager.pushFilter(this._graphicsFilter)}if(this._filters&&!this.filterSelf){r.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){r.stop();t.maskManager.pushMask(this.mask,t);r.start()}if(this._filters&&this.filterSelf){r.stop();var a=this.texture.baseTexture._glTextures[t.gl.id];var n=t.filterManager.buildFilterTexture(t,this._filterBlock,this);r.start();var s=this.texture._uvs;if(n){this.texture.baseTexture._glTextures[t.gl.id]=n.texture}this._renderWebGLImpl(t);r.flush();if(n){this.texture.baseTexture._glTextures[t.gl.id]=a;t.filterManager.texturePool.push(n);this.texture._uvs=s}}else{this._renderWebGLImpl(t)}for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}r.stop();if(this._mask)t.maskManager.popMask(this._mask,t);if(this._filters&&!this.filterSelf)t.filterManager.popFilter();if(this._graphicsFilter)t.filterManager.popFilter();r.start()}else{this._renderWebGLImpl(t);for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}}if(this.softClip){K.getManager(t).popPolygon()}};_t.WebGLStencilManager.prototype.pushSpriteStencil=function(t,e){var i=this.gl;if(this.stencilStack.length===0){i.enable(i.STENCIL_TEST);i.clear(i.STENCIL_BUFFER_BIT);this.reverse=true;this.count=0}this.stencilStack.push(t);var r=this.count;i.colorMask(false,false,false,false);i.stencilFunc(i.ALWAYS,0,255);i.stencilOp(i.KEEP,i.KEEP,i.INVERT);if(!this.reverse){i.stencilFunc(i.EQUAL,255-r,255);i.stencilOp(i.KEEP,i.KEEP,i.DECR)}else{i.stencilFunc(i.EQUAL,r,255);i.stencilOp(i.KEEP,i.KEEP,i.INCR)}t._renderWebGLImpl(e);e.spriteBatch.flush();if(!this.reverse){i.stencilFunc(i.EQUAL,255-(r+1),255)}else{i.stencilFunc(i.EQUAL,r+1,255)}i.colorMask(true,true,true,true);i.stencilOp(i.KEEP,i.KEEP,i.KEEP);this.count++};_t.WebGLStencilManager.prototype.popSpriteStencil=function(t,e){var i=this.gl;this.stencilStack.pop();this.count--;if(this.stencilStack.length===0){i.disable(i.STENCIL_TEST)}else{var r=this.count;i.colorMask(false,false,false,false);if(!this.reverse){i.stencilFunc(i.EQUAL,255-(r+1),255);i.stencilOp(i.KEEP,i.KEEP,i.INCR)}else{i.stencilFunc(i.EQUAL,r+1,255);i.stencilOp(i.KEEP,i.KEEP,i.DECR)}t._renderWebGLImpl(e);e.spriteBatch.flush();if(!this.reverse){i.stencilFunc(i.EQUAL,255-r,255)}else{i.stencilFunc(i.EQUAL,r,255)}i.colorMask(true,true,true,true);i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}};_t.Sprite.prototype._renderWebGLImpl=function(t){var e=t.softClipManager;var i=t.spriteBatch;if(e&&e.needClip){var r=this.texture;var a=r.baseTexture.resolution;var n=this.worldTransform;var s=r._uvs;if(!s)return;var o=n.a/a;var h=n.b/a;var l=n.c/a;var u=n.d/a;var f=n.tx;var c=n.ty;var p,d,_,g;var m=this.anchor.x;var y=this.anchor.y;if(r.trim){var v=r.trim;d=v.x-m*v.width;p=d+r.crop.width;g=v.y-y*v.height;_=g+r.crop.height}else{p=r.frame.width*(1-m);d=r.frame.width*-m;_=r.frame.height*(1-y);g=r.frame.height*-y}var T=this.tint;T=(T>>16)+(T&65280)+((T&255)<<16)+(this.worldAlpha*255<<24);e.renderSprite(t,this,d,g,p,_,s.x0,s.y0,s.x2,s.y2,o,h,l,u,f,c,T)}else{i.render(this)}};_t.Sprite.prototype._renderCanvas=function(t){if(this.visible===false||this.alpha===0||this.renderable===false||this.texture.crop.width<=0||this.texture.crop.height<=0)return;if(this.maskPixel){var e=t.bufferPool||(t.bufferPool=[]);var i=t.context;var r=i.globalOffX||0;var a=i.globalOffY||0;var n=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds();var s=Math.max(r,n.x);var o=Math.max(a,n.y);var h=Math.min(n.x+n.width,i.canvas.width+r);var l=Math.min(n.y+n.height,i.canvas.height+a);n.x=s;n.y=o;n.width=h-s;n.height=l-o;var u=e.pop();if(!u){u=new _t.CanvasBuffer(t.context.canvas.width*t.resolution,t.context.canvas.height*t.resolution);u.context._setTransform=u.context.setTransform;u.context.setTransform=function(t,e,i,r,a,n){this._setTransform(t,e,i,r,a-(this.globalOffX||0),n-(this.globalOffY||0))}}u.resize(n.width*t.resolution,n.height*t.resolution);u.context.clearRect(0,0,n.width*t.resolution,n.height*t.resolution);u.context.globalOffX=n.x*t.resolution+r;u.context.globalOffY=n.y*t.resolution+a;t.context=u.context}if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;t.context.globalCompositeOperation=_t.blendModesCanvas[t.currentBlendMode]}if(this._mask){t.maskManager.pushMask(this._mask,t)}if(this.texture.valid){var f=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha;if(t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode){t.scaleMode=this.texture.baseTexture.scaleMode;t.context[t.smoothProperty]=t.scaleMode===_t.scaleModes.LINEAR}var c=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var p=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;if(t.roundPixels){t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0);c=c|0;p=p|0}else{t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution)}if(!this.maskPixel){if(this.tint!==16777215){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;this.tintedTexture=_t.CanvasTinter.getTintedTexture(this,this.tint)}t.drawCount++;t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,c/f,p/f,this.texture.frame.width/f,this.texture.frame.height/f)}else{t.drawCount++;t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,c/f,p/f,this.texture.frame.width/f,this.texture.frame.height/f)}}}for(var d=0;d<this.children.length;d++){this.children[d]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}if(this.maskPixel&&this.texture.valid){var _=t.context;_.globalCompositeOperation="destination-in";if(t.roundPixels){_.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0);c=c|0;p=p|0}else{_.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution)}t.drawCount++;_.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,c/f,p/f,this.texture.crop.width/f,this.texture.crop.height/f);_.globalCompositeOperation="source-over";t.context=i;if(t.roundPixels){t.context.setTransform(1,0,0,1,n.x*t.resolution|0,n.y*t.resolution|0)}else{t.context.setTransform(1,0,0,1,n.x*t.resolution,n.y*t.resolution)}t.drawCount++;t.context.drawImage(u.canvas,0,0,u.canvas.width,u.canvas.height,0,0,u.canvas.width,u.canvas.height);e.push(u)}};var Qt=_t.WebGLFastSpriteBatch.prototype.setContext;_t.WebGLFastSpriteBatch.prototype.setContext=function(t){Qt.call(this,t);this.quadSize=this.size;this.triangleSize=300;this.batchIndexNumber=6;var e=this.triangleSize*3;this.triangleIndices=new _t.Uint16Array(e);for(var i=0;i<e;++i){this.triangleIndices[i]=i}this._batchType=pt.BATCH_QUAD;this.quadIndexBuffer=this.indexBuffer;this.triangleIndexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.triangleIndices,t.STATIC_DRAW)};var $t=_t.WebGLFastSpriteBatch.prototype.destroy;_t.WebGLFastSpriteBatch.prototype.destroy=function(){this.triangleIndices=null;this.gl.deleteBuffer(this.triangleIndexBuffer);$t.call(this)};P.defineProperties(_t.WebGLFastSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(t){if(t===this._batchType){return}this.stop();if(t===pt.BATCH_TRIANGLES){this.size=this.triangleSize;this.indexBuffer=this.triangleIndexBuffer;this._batchType=t;this.batchIndexNumber=3}else{this.size=this.quadSize;this.indexBuffer=this.quadIndexBuffer;this._batchType=t;this.batchIndexNumber=6}this.start()}}});_t.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0)return;var t=this.gl;if(!this.currentBaseTexture._glTextures[t.id])this.renderSession.renderer.updateTexture(this.currentBaseTexture,t);t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]);if(this.currentBatchSize>this.size*.5){t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices)}else{var e=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,this.currentBatchSize*this.batchIndexNumber,t.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};_t.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer();this.uvBuffer=t.createBuffer();this.colorBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.vertexArray=new _t.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW);this.uvArray=new _t.Float32Array(xi.MAX_SAMPLE_COUNT*8);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW);this.colorArray=new _t.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)};_t.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl;var i=this.renderSession.projection;var r=this.renderSession.offset;var a=t._filterArea=(t.target.filterArea||t.target.getBounds()).clone();t._previous_stencil_mgr=this.renderSession.stencilManager;this.renderSession.stencilManager=new _t.WebGLStencilManager;this.renderSession.stencilManager.setContext(e);e.disable(e.STENCIL_TEST);this.filterStack.push(t);var n=t.filterPasses.length;var s=0;while(n--){var o=t.filterPasses[n];if(o.padding>s){s=o.padding}}a.x-=s;a.y-=s;a.width+=s*2;a.height+=s*2;var h=Math.max(this.offsetX,a.x);var l=Math.max(this.offsetY,a.y);var u=Math.max(h,Math.min(a.x+a.width,this.width+this.offsetX));var f=Math.max(l,Math.min(a.y+a.height,this.height+this.offsetY));a.x=h;a.y=l;a.width=u-h;a.height=f-l;this.offsetX+=a.x;this.offsetY+=a.y;var c=this.texturePool.pop();if(!c){c=new _t.FilterTexture(this.gl,this.width,this.height)}else{c.resize(this.width,this.height)}e.bindTexture(e.TEXTURE_2D,c.texture);e.bindFramebuffer(e.FRAMEBUFFER,c.frameBuffer);e.viewport(0,0,a.width,a.height);i.x=a.width/2;i.y=-a.height/2;r.x=-a.x;r.y=-a.y;e.colorMask(true,true,true,true);e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT);t._glFilterTexture=c};_t.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl;var e=this.filterStack.pop();var i=e._filterArea;var r=e._glFilterTexture;var a=e._glFilterTexture;var n=this.renderSession.projection;var s=this.renderSession.offset;if(e.filterPasses.length>1){t.viewport(0,0,i.width,i.height);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=i.height;this.vertexArray[2]=i.width;this.vertexArray[3]=i.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=i.width;this.vertexArray[7]=0;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[0]=0;this.uvArray[1]=0;this.uvArray[2]=i.width/this.width;this.uvArray[3]=0;this.uvArray[4]=0;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var o=r;var h=this.texturePool.pop();if(!h)h=new _t.FilterTexture(this.gl,this.width,this.height);h.resize(this.width,this.height);t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer);t.clear(t.COLOR_BUFFER_BIT);t.disable(t.BLEND);for(var l=0;l<e.filterPasses.length-1;l++){var u=e.filterPasses[l];var f=u.extraAttribute;if(f){t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);for(var c=0;c<f.length;++c){var p=u.uniforms[f[c].texture].value;if(!p)continue;var d=p._uvs;this.uvArray[8*(c+1)]=d.x3;this.uvArray[8*(c+1)+1]=d.y3;this.uvArray[8*(c+1)+2]=d.x2;this.uvArray[8*(c+1)+3]=d.y2;this.uvArray[8*(c+1)+4]=d.x0;this.uvArray[8*(c+1)+5]=d.y0;this.uvArray[8*(c+1)+6]=d.x1;this.uvArray[8*(c+1)+7]=d.y1}t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray)}t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,o.texture);this.applyFilterPass(u,i,i.width,i.height,a);var _=o;o=h;if(_===a){h=this.texturePool.pop();if(!h)h=new _t.FilterTexture(this.gl,this.width,this.height)}else{h=_}}t.enable(t.BLEND);r=o;this.texturePool.push(h)}var g=e.filterPasses[e.filterPasses.length-1];this.offsetX-=i.x;this.offsetY-=i.y;var m=this.width;var y=this.height;var v=0;var T=0;var x=this.buffer;if(this.filterStack.length===0){t.colorMask(true,true,true,true)}else{var b=this.filterStack[this.filterStack.length-1];i=b._filterArea;m=i.width;y=i.height;v=i.x;T=i.y;x=b._glFilterTexture.frameBuffer}n.x=m/2;n.y=-y/2;s.x=v;s.y=T;i=e._filterArea;var A=i.x-v;var S=i.y-T;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=A;this.vertexArray[1]=S+i.height;this.vertexArray[2]=A+i.width;this.vertexArray[3]=S+i.height;this.vertexArray[4]=A;this.vertexArray[5]=S;this.vertexArray[6]=A+i.width;this.vertexArray[7]=S;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[0]=0;this.uvArray[1]=0;this.uvArray[2]=i.width/this.width;this.uvArray[3]=0;this.uvArray[4]=0;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;var f=g.extraAttribute;if(f){for(var c=0;c<f.length;++c){var p=g.uniforms[f[c].texture].value;if(!p)continue;var d=p._uvs;this.uvArray[8*(c+1)]=d.x3;this.uvArray[8*(c+1)+1]=d.y3;this.uvArray[8*(c+1)+2]=d.x2;this.uvArray[8*(c+1)+3]=d.y2;this.uvArray[8*(c+1)+4]=d.x0;this.uvArray[8*(c+1)+5]=d.y0;this.uvArray[8*(c+1)+6]=d.x1;this.uvArray[8*(c+1)+7]=d.y1}}t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);t.viewport(0,0,m*this.renderSession.resolution,y*this.renderSession.resolution);t.bindFramebuffer(t.FRAMEBUFFER,x);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,r.texture);if(this.renderSession.stencilManager){this.renderSession.stencilManager.destroy()}this.renderSession.stencilManager=e._previous_stencil_mgr;e._previous_stencil_mgr=null;if(this.renderSession.stencilManager.count>0){t.enable(t.STENCIL_TEST)}else{t.disable(t.STENCIL_TEST)}this.applyFilterPass(g,i,m,y,a);if(r!==a){this.texturePool.push(a)}this.texturePool.push(r);e._glFilterTexture=null};_t.WebGLFilterManager.prototype.buildFilterTexture=function(t,e,i){var r=t.gl;var a=r.isEnabled(r.STENCIL_TEST);if(a){r.disable(r.STENCIL_TEST)}var n=i.texture.baseTexture;if(!n._glTextures[r.id]){t.renderer.updateTexture(n,r)}var s=n._glTextures[r.id];var o={texture:s};var h=new pt.Rectangle(0,0,n.width,n.height);var l=i.texture.crop;var u=i.texture._uvs;var f=this.texturePool.pop();if(!f){f=new _t.FilterTexture(this.gl,h.width,h.height)}f.resize(h.width,h.height);r.bindFramebuffer(r.FRAMEBUFFER,f.frameBuffer);r.viewport(0,0,h.width,h.height);r.colorMask(true,true,true,true);r.clearColor(0,0,0,0);r.clear(r.COLOR_BUFFER_BIT);r.disable(r.BLEND);r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=l.x;this.vertexArray[1]=h.height-l.y;this.vertexArray[2]=l.x+l.width;this.vertexArray[3]=h.height-l.y;this.vertexArray[4]=l.x;this.vertexArray[5]=h.height-l.y-l.height;this.vertexArray[6]=l.x+l.width;this.vertexArray[7]=h.height-l.y-l.height;r.bufferSubData(r.ARRAY_BUFFER,0,this.vertexArray);var c=e.filterPasses[0];r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer);this.uvArray[0]=u.x0;this.uvArray[1]=u.y0;this.uvArray[2]=u.x1;this.uvArray[3]=u.y1;this.uvArray[4]=u.x3;this.uvArray[5]=u.y3;this.uvArray[6]=u.x2;this.uvArray[7]=u.y2;var p=c.extraAttribute;if(p){for(var d=0;d<p.length;++d){var _=c.uniforms[p[d].texture].value;if(!_)continue;var u=_._uvs;this.uvArray[8*(d+1)]=u.x0;this.uvArray[8*(d+1)+1]=u.y0;this.uvArray[8*(d+1)+2]=u.x1;this.uvArray[8*(d+1)+3]=u.y1;this.uvArray[8*(d+1)+4]=u.x3;this.uvArray[8*(d+1)+5]=u.y3;this.uvArray[8*(d+1)+6]=u.x2;this.uvArray[8*(d+1)+7]=u.y2}}r.bufferSubData(r.ARRAY_BUFFER,0,this.uvArray);r.activeTexture(r.TEXTURE0);r.bindTexture(r.TEXTURE_2D,o.texture);this.applyFilterPass(c,new pt.Rectangle(0,0,h.width,h.height),h.width,h.height,o,h.width,h.height);var g=null;for(var m=1;m<e.filterPasses.length;m++){var y=g;g=f;f=y;if(!f){f=this.texturePool.pop();if(!f){f=new _t.FilterTexture(this.gl,h.width,h.height)}f.resize(h.width,h.height)}r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer);r.bufferSubData(r.ARRAY_BUFFER,0,this._filterSelfUVArray);var c=e.filterPasses[m];var p=c.extraAttribute;if(p){r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer);for(var d=0;d<p.length;++d){var _=c.uniforms[p[d].texture].value;if(!_)continue;var u=_._uvs;this.uvArray[8*(d+1)]=u.x0;this.uvArray[8*(d+1)+1]=u.y0;this.uvArray[8*(d+1)+2]=u.x1;this.uvArray[8*(d+1)+3]=u.y1;this.uvArray[8*(d+1)+4]=u.x3;this.uvArray[8*(d+1)+5]=u.y3;this.uvArray[8*(d+1)+6]=u.x2;this.uvArray[8*(d+1)+7]=u.y2}r.bufferSubData(r.ARRAY_BUFFER,0,this.uvArray)}r.bindFramebuffer(r.FRAMEBUFFER,f.frameBuffer);r.activeTexture(r.TEXTURE0);r.bindTexture(r.TEXTURE_2D,g.texture);this.applyFilterPass(c,new pt.Rectangle(0,0,h.width,h.height),h.width,h.height,o,h.width,h.height)}if(a){r.enable(r.STENCIL_TEST)}r.enable(r.BLEND);r.viewport(0,0,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);r.bindFramebuffer(r.FRAMEBUFFER,this.buffer);r.colorMask(true,true,true,true);return f};_t.WebGLFilterManager.prototype.applyFilterPass=function(t,e,i,r,a,n,s){var o=this.gl;var h=t.shaders[o.id];if(!h){h=new _t.PixiShader(o);h.fragmentSrc=t.fragmentSrc;if(t.vertexSrc){h.vertexSrc=t.vertexSrc}h.uniforms=t.uniforms;if(t.extraAttribute){h.extraAttribute=t.extraAttribute}h.init();t.shaders[o.id]=h}this.renderSession.shaderManager.setShader(h);n=isNaN(n)?this.width:n;s=isNaN(s)?this.height:s;o.uniform2f(h.projectionVector,i/2,-r/2);o.uniform2f(h.offsetVector,0,0);if(h.pixelSize){o.uniform2f(h.pixelSize,1/n,1/s)}if(t.uniforms.dimensions){t.uniforms.dimensions.value[0]=n;t.uniforms.dimensions.value[1]=s;t.uniforms.dimensions.value[2]=this.vertexArray[0];t.uniforms.dimensions.value[3]=this.vertexArray[5]}h.syncUniforms();if(h.uSourceSampler&&a){var l=h.textureCount++;o.activeTexture(o["TEXTURE"+l]);o.bindTexture(o.TEXTURE_2D,a.texture);o.uniform1i(h.uSourceSampler,l)}o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer);o.vertexAttribPointer(h.aVertexPosition,2,o.FLOAT,false,0,0);var u=32;var f=t.extraAttribute;o.bindBuffer(o.ARRAY_BUFFER,this.uvBuffer);o.vertexAttribPointer(h.aTextureCoord,2,o.FLOAT,false,0,0);if(f){for(var c=0;c<f.length;++c){o.vertexAttribPointer(h[f[c].name],2,o.FLOAT,false,0,(c+1)*32)}}o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer);o.vertexAttribPointer(h.colorAttribute,2,o.FLOAT,false,0,0);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.indexBuffer);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0);this.renderSession.drawCount++};_t.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;if(!t._webGL[i.id].data.length)return;e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)};var te=_t.Text.prototype.updateTexture;_t.Text.prototype.updateTexture=function(){te.call(this);this.displayChanged(pt.DisplayChangeStatus.SIZE|pt.DisplayChangeStatus.TEXTURE)};_t.Text.prototype.getSelfWidth=function(){return this.texture&&this.texture.frame&&this.texture.frame.width*(this._canvasDownScale?this._canvasDownScale.x:1)};_t.Text.prototype.getSelfHeight=function(){return this.texture&&this.texture.frame&&this.texture.frame.height*(this._canvasDownScale?this._canvasDownScale.y:1)};_t.Text.prototype._uploadToRenderTexture=function(){var t=this._frameTexture;var e=t.baseTexture;var i=this.game.renderer;e.source=this.canvas;i.updateTexture(e);this.texture=t;e.resolution=this.resolution;e.scaleMode=_t.scaleModes.NEAREST;e.width=t.crop.width=t.frame.width=this.canvas.width;e.height=t.crop.height=t.frame.height=this.canvas.height};P.defineProperty(dt.Text.prototype,"dirty",{get:function(){return this._dirty},set:function(t){if(this._dirty===t)return;this._dirty=t;this.displayChanged(pt.DisplayChangeStatus.SIZE|pt.DisplayChangeStatus.TEXTURE)}});P.defineProperty(dt.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*this.texture.frame.width/this.resolution},set:function(t){this.scale.x=t/this.texture.frame.width;this._width=t}});P.defineProperty(dt.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*this.texture.frame.height/this.resolution},set:function(t){this.scale.y=t/this.texture.frame.height;this._height=t}});var ee=200;var ie=_t.Sprite.prototype._renderCanvas;var re=_t.Sprite.prototype._renderWebGL;var ae=function(f){return function(t){var e=this._canvasDownScale;var i;var r=this._nqc.roundPixels!==false;if(r){i=t.roundPixels;t.roundPixels=true}if(!e){f.call(this,t)}else{var a=this.worldTransform;var n=a.a;var s=a.b;var o=a.c;var h=a.d;var l=e.x;var u=e.y;a.a*=l;a.b*=l;a.c*=u;a.d*=u;if(this.game.antialias&&(a.a!==a.d||a.b!==0||a.c!==0)){this.texture.baseTexture.scaleMode=_t.scaleModes.LINEAR}else{this.texture.baseTexture.scaleMode=_t.scaleModes.NEAREST}f.call(this,t);a.a=n;a.b=s;a.c=o;a.d=h}if(r){t.roundPixels=i}}};_t.Text.prototype.getBounds=function(t){if(this.dirty){this.updateText();this.dirty=false}var e=this._canvasDownScale;var i=this.worldTransform;i.tx=i.tx||0;i.ty=i.ty||0;var r=i.a;var a=i.b;var n=i.c;var s=i.d;var o=e.x;var h=e.y;i.a*=o;i.b*=o;i.c*=h;i.d*=h;var l=_t.Sprite.prototype.getBounds.call(this,t);i.a=r;i.b=a;i.c=n;i.d=s;return l};_t.Text.prototype._renderCanvas=function(){return ae(ie)}();_t.Text.prototype._renderWebGL=function(){return ae(re)}();dt.Text.prototype.updateLine=function(t,e,i,r,a,n,s,o,h,l){for(var u=0;u<t.length;u++){var f=t[u];if(this.colors[this._charCount]){if(this.colors[this._charCount]==="defaultColor"){r.fillStyle=n}else{r.fillStyle=this.colors[this._charCount]}}var c=r.measureText(f).width;if(this.style.stroke&&a){this._clearShadowStyle(r);r.strokeText(f,e,i);this._restoreShadowStyle(r)}if(this.style.fill){if(h===r.fillStyle&&l){r.save();r.fillStyle="black";r.fillText(f,e,i);r.globalCompositeOperation="source-in";r.fillStyle=h;r.beginPath();r.rect(e,i-o/2,c,o);r.clip();r.fillRect(e,i-o/2,c,o);r.restore();if(pt.__IS_ANDROID_UC){var p=pt._tempCanvas;if(!p){p=pt._tempCanvas=document.createElement("canvas");p.width=128;p.height=128}r.drawImage(p,0,0,2,2,-5,-5,1,1)}}else{r.fillText(f,e,i)}}e+=c;this._charCount++}};dt.Text.prototype._clearShadowStyle=function(t){if(this.style.fill&&this._nqc&&this._nqc.enableShadow){t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowColor=null}};dt.Text.prototype._restoreShadowStyle=function(t){if(this.style.fill&&this._nqc&&this._nqc.enableShadow){if(this._shadowOffset){t.shadowOffsetX=this._shadowOffset[0];t.shadowOffsetY=this._shadowOffset[1]}else{t.shadowOffsetX=this.style.shadowOffsetX;t.shadowOffsetY=this.style.shadowOffsetY}t.shadowColor=this.style.shadowColor;t.shadowBlur=this.style.shadowBlur}};dt.Text.prototype._getWorldWidth=function(t){if(t.length>0&&t[t.length-1]==="\n"){var e=t.substr(0,t.length-1);return this.context.measureText(e).width}return this.context.measureText(t).width};dt.Text.prototype._isLetter=function(t){if((t<"a"||t>"z")&&(t<"A"||t>"Z")){return false}return true};dt.Text.prototype.runWordWrap=function(t,e){var i=e;var r=[];var a=0;var n=false;for(var s=0;s<t.length;){if(t[s]==="\n"){var o=t.substr(a,s-a+1);if(o.length===1&&r.length>0&&!n){r[r.length-1]+="\n"}else r.push(o);s++;a=s;n=true}else{n=false;var h=-1;while(s<t.length){var l=t.charAt(s);if(this._isLetter(l)){if(h===-1)h=s;s++}else{if(h>=0)s--;break}}if(s===t.length)s--;var u=this._getWorldWidth(t.substr(a,s-a+1));if(u>i){if(h>=0&&h===a){var o=t.substr(a,s-a+1);r.push(o);s++;a=s}else if(h>=0){var f=h-a;var o=t.substr(a,f);r.push(o);s=a+f;a=s}else{if(s-a===0){var o=t.substr(a,s-a+1);r.push(o);s++;a=s}else{var o=t.substr(a,s-a);r.push(o);a=s}}}else{s++;if(s===t.length){var o=t.substr(a,s-a+1);r.push(o)}}}}return r};dt.Text.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){if(t.preUpdate)t.preUpdate();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.preUpdate)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;if(!this.visible)return;r.preUpdate()}}if(this.fresh){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.inUpdate=true;this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this._isNotNeedCalcTransform=false;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;var i=this.children.length;while(i--){if(this.children[i].visible){this.children[i].preUpdate()}else{this.children[i].renderOrderID=-1}}return true};dt.Text.prototype.update=function(){var t=this._qc;if(t&&!t.static){if(t.preUpdate)t.preUpdate();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.preUpdate)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;if(!this.visible)return;r.preUpdate()}}};dt.BitmapText.prototype._isLetter=dt.Text.prototype._isLetter;dt.BitmapText.prototype.runWordWrap=dt.Text.prototype.runWordWrap;dt.BitmapText.prototype._getWorldWidth=function(t){var e=0;var i=_t.BitmapText.fonts[this.fontName];if(!i||!t)return e;var r=this.fontSize/i.size;var a=null;for(var n=0;n<t.length;n++){var s=t.charCodeAt(n);var o=i.chars[s];if(!o)continue;if(a&&o.kerning[a]){e+=o.kerning[a]}e+=o.xAdvance;a=s}return e*r};_t.BitmapText.prototype.updateText=function(){var t=this.text;if(!this._nqc)return;var e=_t.BitmapText.fonts[this.fontName];if(!e)return;var i=new _t.Point;var r=null;var a=[];var n=0;var s=[];var o=0;var h=this.fontSize/e.size;var l=0;var u=0;var f=[];if(this._nqc.wrap){t=t.replace(/\r/gi,"").replace(/\n/gi,"\n");var f=this.runWordWrap(t,this._nqc.width)}else{var f=t.split(/(?:\r\n|\r|\n)/);for(var c=0;c<f.length-1;c++){f[c]+="\n"}}i.x=0;i.y=0;for(var c=0;c<f.length;c++){i.x=0;r=null;var p=f[c];for(var d=0;d<p.length;d++){var _=p.charCodeAt(d);var g=e.chars[_];if(!g)continue;if(r&&g.kerning[r]){i.x+=g.kerning[r]}a.push({texture:g.texture,line:c,charCode:_,position:new _t.Point(i.x+g.xOffset,i.y+g.yOffset)});i.x+=g.xAdvance;r=_}s.push(i.x);n=Math.max(n,i.x);i.y+=e.lineHeight}var m=[];for(c=0;c<=f.length;c++){var y=0;if(this.style.align==="right"){y=n-s[c]}else if(this.style.align==="center"){y=(n-s[c])/2}m.push(y)}var v=this.children.length;var T=a.length;var x=this.tint||16777215;this.textWidth=n*h;this.textHeight=e.lineHeight*h;var b=this.textWidth*this.anchor.x;var A=this.textHeight*this.anchor.y;for(c=0;c<T;c++){var S=c<v?this.children[c]:this._pool.pop();if(S)S.setTexture(a[c].texture);else S=new _t.Sprite(a[c].texture);S.position.x=(a[c].position.x+m[a[c].line])*h-b;S.position.y=Math.floor(a[c].position.y*h-A);S.scale.x=S.scale.y=h;S.tint=x;if(!S.parent)this.addChild(S)}while(this.children.length>T){var w=this.getChildAt(this.children.length-1);this._pool.push(w);this.removeChild(w)}this._nqc.textRealWidth=this.textWidth;this._nqc.textRealHeight=this.textHeight;this.realWidth=this.textWidth;this.realHeight=this.textHeight;this._nqc._adjustTextPos(this.textWidth,this.textHeight)};dt.BitmapText.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){if(t.preUpdate)t.preUpdate();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.preUpdate)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;if(!this.visible)return;r.preUpdate()}}if(this.fresh){if(t)t._isTransformDirty=true;this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.renderOrderID=this.game.stage.currentRenderOrderID++;var i=this.children.length;while(i--){if(this.children[i].visible){this.children[i].preUpdate()}else{this.children[i].renderOrderID=-1}}return true};dt.BitmapText.prototype.postUpdate=function(){if(this.fixedToCamera){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}var t=this._qc;if(t&&!t.static){if(t.postUpdate)t.postUpdate();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.postUpdate)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;r.postUpdate();if(!this.visible)return}}};dt.Graphics.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){if(t.preUpdate)t.preUpdate();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.preUpdate)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;if(!this.visible)return;r.preUpdate()}}if(this.fresh){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(t)t._isTransformDirty=true;this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.renderOrderID=this.game.stage.currentRenderOrderID++;var i=this.children.length;while(i--){if(this.children[i].visible){this.children[i].preUpdate()}else{this.children[i].renderOrderID=-1}}return true};dt.Graphics.prototype.update=function(){var t=this._qc;if(t&&!t.static){if(t.update)t.update();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.update)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;r.update();if(!this.visible)return}}var i=this.children.length;while(i--){if(this.children[i].visible){this.children[i].update()}}};dt.Graphics.prototype.postUpdate=function(){if(this.key instanceof dt.BitmapData){this.key.render()}var t=this._qc;if(t&&!t.static){if(t.postUpdate)t.postUpdate();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.postUpdate)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;r.postUpdate();if(!this.visible)return}}var i=this.children.length;while(i--){if(this.children[i].visible)this.children[i].postUpdate()}};P.defineProperty(_t.Graphics.prototype,"dirty",{get:function(){return this._dirty},set:function(t){if(t===this._dirty){return}this._dirty=t;this.displayChanged(pt.DisplayChangeStatus.RECALC_MASK)}});_t.Graphics.prototype._updateBounds=function(){var t=this,e=t.worldTransform,i=t.parent;var r=i?i._displayChangeStatus:0;if(t._displayChangeStatus==null){t._displayChangeStatus=Kt.SHOW}var a=t._displayChangeStatus;a=a|r&Kt.INHERIT_MASK;if(!t.worldVisible&&!(a&Kt.HIDE)){return true}if(a===0)return false;t._lastWorldBounds||(t._lastWorldBounds=[]);t._currWorldBounds&&t._lastWorldBounds.push(t._currWorldBounds);t._displayChangeStatus=a;t._currentBounds=null;var n=this.getBounds();t._currWorldBounds={x:n.x,y:n.y,tx:n.x,ty:n.y,width:n.width,height:n.height,area:n.width*n.height};t._dirtyBounds=true;return false};dt.Sprite.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){if(t.preUpdate)t.preUpdate();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.preUpdate)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;if(!this.visible)return;r.preUpdate()}}if(this.fresh){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(t)t._isTransformDirty=true;this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(this.lifespan>0){this.lifespan-=this.game.time.physicsElapsedMS;if(this.lifespan<=0){this.kill();return false}}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.renderOrderID=this.game.stage.currentRenderOrderID++;if(this.animations){this.animations.update()}var i=this.children.length;while(i--){if(this.children[i].visible){this.children[i].preUpdate()}else{this.children[i].renderOrderID=-1}}return true};dt.Sprite.prototype.update=function(){var t=this._qc;if(t&&!t.static){if(t.update)t.update();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.update)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;r.update();if(!this.visible)return}}var i=this.children.length;while(i--){if(this.children[i].visible){this.children[i].update()}}};dt.Sprite.prototype.postUpdate=function(){if(this.key instanceof dt.BitmapData){this.key.render()}if(this.fixedToCamera){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}var t=this._qc;if(t&&!t.static){if(t.postUpdate)t.postUpdate();var e=t.scripts;var i=e.length;while(i--){var r=e[i];if(!r||!r._enable||!r.__hadUpdateOrRender||!r.postUpdate)continue;if(t.game.device.editor===true&&r.runInEditor!==true)continue;r.postUpdate();if(!this.visible)return}}var i=this.children.length;while(i--){if(this.children[i].visible)this.children[i].postUpdate()}};dt.Tileset.prototype.updateTileData=function(t,e){t-=this.tileMargin;e-=this.tileMargin;var i;var r;if(e>this.tileHeight){i=(e-this.tileHeight)/(this.tileHeight+this.tileSpacing)+1}else{i=e/this.tileHeight}if(t>this.tileWidth){r=(t-this.tileWidth)/(this.tileWidth+this.tileSpacing)+1}else{r=t/this.tileWidth}if(i%1!==0||r%1!==0){}i=Math.floor(i);r=Math.floor(r);if(this.rows&&this.rows!==i||this.columns&&this.columns!==r){console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ")}this.rows=i;this.columns=r;this.total=i*r;this.drawCoords.length=0;var a=this.tileMargin;var n=this.tileMargin;for(var s=0;s<this.rows;s++){for(var o=0;o<this.columns;o++){this.drawCoords.push(a);this.drawCoords.push(n);a+=this.tileWidth+this.tileSpacing}a=this.tileMargin;n+=this.tileHeight+this.tileSpacing}};dt.Cache.prototype.getSound=function(t){if(this._sounds[t]){return this._sounds[t]}else{return null}};dt.Loader.prototype.loadAudioTag=function(t){var e=this;if(this.game.sound.touchLocked){t.data=new Audio;t.data.name=t.key;t.data.preload="auto";t.data.src=t.localPath||this.transformUrl(t.url,t);this.fileComplete(t)}else{t.data=new Audio;t.data.name=t.key;var i=function(){t.data.removeEventListener("canplaythrough",i,false);t.data.removeEventListener("stalled",r,false);t.data.onerror=null;dt.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener("canplaythrough",i,false);t.data.removeEventListener("stalled",r,false);t.data.onerror=null;e.fileError(t)};var r=function(){t.data.removeEventListener("canplaythrough",i,false);t.data.removeEventListener("stalled",r,false);t.data.onerror=null;e.fileError(t)};t.data.preload="auto";t.data.src=t.localPath||this.transformUrl(t.url,t);t.data.addEventListener("canplaythrough",i,false);t.data.addEventListener("stalled",r,false)}};dt.Sound.prototype.soundHasUnlocked=function(t){if(t===this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this.game._qc.sound._getAudioTagDurationInConfig(this)}};dt.Sound.prototype.play=function(t,e,i,r,a){if(typeof t==="undefined"||t===false||t===null){t=""}if(typeof a==="undefined"){a=true}if(this.isPlaying&&!this.allowMultiple&&!a&&!this.override){return this}if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||a)){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(t){}}}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}if(t===""&&P.keys(this.markers).length>0){return this}if(t!==""){this.currentMarker=t;if(this.markers[t]){this.position=this.markers[t].start;this.volume=this.markers[t].volume;this.loop=this.markers[t].loop;this.duration=this.markers[t].duration;this.durationMS=this.markers[t].durationMS;if(typeof i!=="undefined"){this.volume=i}if(typeof r!=="undefined"){this.loop=r}this._tempMarker=t;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{return this}}else{e=e||0;if(typeof i==="undefined"){i=this._volume}if(typeof r==="undefined"){r=this.loop}this.position=e;this.volume=i;this.loop=r;this.duration=0;this.durationMS=0;this._tempMarker=t;this._tempPosition=e;this._tempVolume=i;this._tempLoop=r}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){if(this._buffer===null){this._buffer=this.game.cache.getSoundData(this.key)}this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop&&t===""){this._sound.loop=true}if(!this.loop&&t===""){this._sound.onended=this.onEndedHandler.bind(this)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=Math.ceil(this.totalDuration*1e3)}if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,this.position,this.duration)}else{if(this.loop&&t===""){this._sound.start(0)}else{this._sound.start(0,this.position,this.duration)}}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4||D.__wx&&this._sound.readyState>=2)){this._sound.play();this.totalDuration=this.game._qc.sound._getAudioTagDurationInConfig(this);if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1e3}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}return this};dt.Sound.prototype.resume=function(){if(this.paused&&this._sound){if(this.usingWebAudio){var t=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop){this._sound.loop=true}if(!this.loop&&this.currentMarker===""){this._sound.onended=this.onEndedHandler.bind(this)}var e=this.duration-this.pausedPosition/1e3;if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,t,e)}else{if(this.loop){this._sound.start(0,t)}else{this._sound.start(0,t,e)}}}else{this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=this.game.time.time-this.pausedTime;this.onResume.dispatch(this)}};dt.SoundManager.prototype.decode=function(e,i){i=i||null;var t=this.game.cache.getSoundData(e);if(t){if(this.game.cache.isSoundDecoded(e)===false){this.game.cache.updateSound(e,"isDecoding",true);var r=this;try{var a=this.context.decodeAudioData(t,function(t){if(!r.game.cache)return;if(t){r.game.cache.decodedSound(e,t)}r.onSoundDecode.dispatch(e,i)},function(){r.game._qc.log.trace("Sound decode failed: {0}",e);r.onSoundDecode.dispatch(e,i)});if(a&&a.catch){a.catch(function(){})}}catch(t){this.game._qc.log.trace("{0}",t.stack);r.onSoundDecode.dispatch(e,i)}}}};dt.SoundManager.prototype.boot=function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(D["PhaserGlobal"]){if(D["PhaserGlobal"].disableAudio===true){this.usingWebAudio=false;this.noAudio=true;return}if(D["PhaserGlobal"].disableWebAudio===true){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false;return}}if(D["PhaserGlobal"]&&D["PhaserGlobal"].audioContext){this.context=D["PhaserGlobal"].audioContext}else{if(!!D["AudioContext"]){try{this.context=new D["AudioContext"]}catch(t){this.context=null;this.usingWebAudio=false;this.noAudio=true;console.error("SoundManager boot error!",t);pt.Util.popupError(t.message)}}else if(!!D["webkitAudioContext"]){try{this.context=new D["webkitAudioContext"]}catch(t){this.context=null;this.usingWebAudio=false;this.noAudio=true;console.error("SoundManager boot error!",t);pt.Util.popupError(t.message)}}}if(!!D["Audio"]&&this.context===null){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false}if(this.context!==null){if(typeof this.context.createGain==="undefined"){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}};dt.SoundManager.prototype.unlock=function(){if(this.touchLocked===false){return}if(this.game.device.webAudio===false||D["PhaserGlobal"]&&D["PhaserGlobal"].disableWebAudio===true){this.touchLocked=false;this._unlockSource=null;this.game.input._qc.touch.callbackContext=null;if(this.game.device.iOSVersion>8){this.game.input._qc.touch.touchEndCallback=null}else{this.game.input._qc.touch.touchStartCallback=null}this.game.input._qc.mouse.callbackContext=null;this.game.input._qc.mouse.mouseDownCallback=null}else{var t=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=t;this._unlockSource.connect(this.context.destination);if(typeof this._unlockSource.start==="undefined"){this._unlockSource.noteOn(0)}else{this._unlockSource.start(0)}}};dt.SoundManager.prototype.update=function(){if(this.touchLocked){if(this.game.device.webAudio&&this._unlockSource!==null){if(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE){this.touchLocked=false;this._unlockSource=null;this.game.input._qc.touch.callbackContext=null;if(this.game.device.iOSVersion>8){this.game.input._qc.touch.touchEndCallback=null}else{this.game.input._qc.touch.touchStartCallback=null}}}}for(var t=0;t<this._sounds.length;t++){this._sounds[t].update()}if(this._watching){var e=this._watchList.first;while(e){if(this.game.cache.isSoundDecoded(e)){this._watchList.remove(e)}e=this._watchList.next}if(this._watchList.total===0){this._watching=false;this._watchCallback.call(this._watchContext)}}};dt.Loader.prototype.transformUrl=function(t){if(/^http(s|):\/\//i.test(t))return t;else return this.baseURL+t};dt.Loader.prototype.asyncComplete=function(t,e){if(typeof e==="undefined"){e=""}t.loaded=true;t.error=!!e;if(!D.__wx&&t.requestObject&&t.requestObject.status!==200&&t.requestObject.status!==304){t.error=true}if(e){t.errorMessage=e;console.warn("Phaser.Loader - "+t.type+"["+t.key+"]"+": "+e)}this.processLoadQueue()};_t.CanvasRenderer.prototype.render=function(t){this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.drawCount=0;this.renderSession.currentBlendMode=_t.blendModes.NORMAL;this.context.globalCompositeOperation=_t.blendModesCanvas[_t.blendModes.NORMAL];if(this.dirtyRectangle.enable){if(!this.dirtyRectangle.updateDirtyRegion(this.context,this.resolution,t)){this.context.fillStyle="rgba(0, 0, 0, 0)";this.context.fillRect(0,0,1,1);this.dirtyRectangle.showDirtyRectangle(this.context,this.resolution);return}}else if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(this.clearBeforeRender){if(this.transparent){this.context.clearRect(0,0,this.width,this.height)}else{this.context.fillStyle=t.backgroundColorString;this.context.fillRect(0,0,this.width,this.height)}}this.renderDisplayObject(t);if(this.dirtyRectangle.enable){this.dirtyRectangle.restore(this.context);this.dirtyRectangle.showDirtyRectangle(this.context,this.resolution)}};_t.WebGLRenderer.prototype.render=function(t){if(this.contextLost)return;if(this.__stage!==t){this.__stage=t}var e=this.gl;e.viewport(0,0,this.width,this.height);e.bindFramebuffer(e.FRAMEBUFFER,null);if(this.clearBeforeRender){if(this.transparent){e.clearColor(0,0,0,0)}else{e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1)}e.clear(e.COLOR_BUFFER_BIT)}this.renderDisplayObject(t,this.projection)};var ne=pt.GameObjectFactory=function(t){this.game=t};ne.prototype.constructor=ne;ne.prototype.clone=function(t,e){if(!t)return null;if(t instanceof s){var i=this.game.serializer.restoreBundle(t.json,e);i._prefab=t.uuid;return i}var r={};var a=this.game.serializer.buildBundle(t,r);a.dependences=this.game.serializer.combineDependence(r);var i=this.game.serializer.restoreBundle(a,e?e:t.parent);return i};ne.prototype.node=function(t,e){var i=new M(new dt.Group(this.game.phaser,null),t,e);i.name="node";return i};ne.prototype.text=function(t,e){return new xe(this.game,t,e)};ne.prototype.image=function(t,e){return new se(this.game,t,e)};ne.prototype.button=function(t,e){return new be(this.game,t,e)};ne.prototype.toggle=function(t,e){return new Ae(this.game,t,e)};ne.prototype.sprite=function(t,e){return new _e(this.game,t,e)};ne.prototype.sound=function(t,e){return new Se(this.game,t,e)};ne.prototype.video=function(t,e){return new we(this.game,t,e)};ne.prototype.scrollView=function(t,e){return new Pe(this.game,t,e)};ne.prototype.scrollBar=function(t,e,i){var r=new Ee(this.game,t,i);var a=i!==C;if(a)return r;r.width=160;r.height=20;r.size=.2;r.direction=pt.ScrollBar.LEFT_TO_RIGHT;if(e){var n=this.node(r);n.name="slidingArea";n.setAnchor(new pt.Point(0,0),new pt.Point(1,1));n.setStretch(0,0,0,0);n.pivotX=n.pivotY=.5;var s=this.image(n);s.name="sliders";s.setAnchor(new pt.Point(0,0),new pt.Point(1,1));s.setStretch(0,0,0,0);s.pivotX=s.pivotY=.5;r.sliders=s;r.interactive=true}return r};ne.prototype.progressBar=function(t,e,i){var r=new De(this.game,t,i);var a=i!==C;if(a)return r;r.width=160;r.height=20;if(e){var n=this.node(r);n.name="progressArea";n.setAnchor(new pt.Point(0,0),new pt.Point(1,1));n.setStretch(0,0,0,0);n.pivotX=n.pivotY=.5;var s=this.image(n);s.name="sliders";s.setAnchor(new pt.Point(0,0),new pt.Point(1,1));s.setStretch(0,0,0,0);s.pivotX=s.pivotY=.5;r.sliders=s}return r};ne.prototype.slider=function(t,e,i){var r=new Ce(this.game,t,i);var a=i!==C;if(a)return r;r.interactive=true;r.width=160;r.height=20;if(e){var n=this.node(r);n.name="slidingArea";n.setAnchor(new pt.Point(0,0),new pt.Point(1,1));n.setStretch(0,0,0,0);n.pivotX=n.pivotY=.5;var s=this.image(n);s.name="sliders";s.setAnchor(new pt.Point(.5,.5),new pt.Point(.5,.5));s.setStretch(0,0,0,0);s.pivotX=s.pivotY=.5;r.sliders=s}return r};ne.prototype.inputField=function(t,e){return new Oe(this.game,t,e)};ne.prototype.dropdown=function(t,e){return new pt.Dropdown(this.game,t,e)};ne.prototype.tilemap=function(t,e){return new Me(this.game,t,e)};ne.prototype.tileLayer=function(t,e){return new Ie(this.game,t,e)};ne.prototype.objectLayer=function(t,e){return new Re(this.game,t,e)};ne.prototype.dom=function(t,e){return new Ne(this.game,t,e)};ne.prototype.graphics=function(t,e){return new Be(this.game,t,e)};var se=pt.UIImage=function(t,e,i){var r=this;var a=new dt.Sprite(t.phaser);pt.Node.call(r,a,e,i);r._oldUpdateTransformFunc=a.updateTransform;a._renderWebGL=oe;a._renderCanvas=fe;r._borderLeft=0;r._borderRight=0;r._borderTop=0;r._borderBottom=0;r._imageType=pt.UIImage.IMAGE_TYPE_SIMPLE;r.name="UIImage"};se.prototype=P.create(pt.Node.prototype);se.prototype.constructor=se;se.IMAGE_TYPE_SIMPLE=0;se.IMAGE_TYPE_SLICED=1;se.IMAGE_TYPE_TILED=2;P.defineProperties(se.prototype,{texture:{get:function(){if(!this._atlas)return null;return new pt.Texture(this._atlas,this.frame)},set:function(t){var e=this;if(!t){e._atlas=null;e.phaser.loadTexture(null,e.frame);return}if(t instanceof pt.Atlas){t=t.getTexture(this.frame)}else if(typeof t==="string"){if(e._atlas){t=e._atlas.getTexture(t);if(!t){return}}else return}if(e._atlas===t.atlas&&e.frame===t.frame)return;e._atlas=t.atlas;if(!t.atlas.getFrame(t.frame))t.frame=0;e.phaser.key=t.atlas.key;e.frame=t.frame;if(e instanceof dragonBones.PhaserSlotDisplay){e.change_texture=t}}},frame:{get:function(){return this.phaser.frameName},set:function(t){if(!this.texture)return;var e=this.texture.atlas.frameNames||[0];if(typeof t==="string"&&e.indexOf(t)===-1)return;this.phaser.loadTexture(this.texture.atlas.key,t);this.setWidth(this.width);this.setHeight(this.height);this._resetNinePadding();this._dispatchLayoutArgumentChanged("size");this.phaser.displayChanged(pt.DisplayChangeStatus.TEXTURE);if(this._onTextureChanged){this._onTextureChanged.dispatch()}}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new pt.Rectangle(0,0,0,0)}},imageType:{get:function(){return this._imageType},set:function(t){if(this._imageType===t){return}this._imageType=t;this.phaser.displayChanged(pt.DisplayChangeStatus.TEXTURE)}},borderTop:{get:function(){return this._borderTop},set:function(t){this._borderTop=t}},borderBottom:{get:function(){return this._borderBottom},set:function(t){this._borderBottom=t}},borderLeft:{get:function(){return this._borderLeft},set:function(t){this._borderLeft=t}},borderRight:{get:function(){return this._borderRight},set:function(t){this._borderRight=t}},onTextureChanged:{get:function(){if(!this._onTextureChanged){this._onTextureChanged=new dt.Signal}return this._onTextureChanged}},skewX:{get:function(){return this._skewX},set:function(t){var e=this;if(e._skewX===t){return}e._skewX=t;e.phaser.displayChanged(pt.DisplayChangeStatus.ROTATION);e._isTransformDirty=true;if(e._skewX||e._skewY){this.phaser.updateTransform=pe}else{e.phaser.updateTransform=e._oldUpdateTransformFunc}}},skewY:{get:function(){return this._skewY},set:function(t){var e=this;if(e._skewY===t){return}e._skewY=t;e.phaser.displayChanged(pt.DisplayChangeStatus.ROTATION);e._isTransformDirty=true;if(e._skewX||e._skewY){this.phaser.updateTransform=pe}else{e.phaser.updateTransform=e._oldUpdateTransformFunc}}},class:{get:function(){return"qc.UIImage"}}});se.prototype.resetNativeSize=function(){if(this.parent){this.width=this.nativeSize.width;this.height=this.nativeSize.height}else{this.setWidth(this.nativeSize.width);this.setHeight(this.nativeSize.height)}};se.prototype.loadImg=function(e){var i=this;this.game.assets.load(e,e,function(){var t=qc_game.assets.find(e);i.texture=t;i.resetNativeSize();if(i instanceof dragonBones.PhaserSlotDisplay){i.change_texture=t}})};se.prototype.setWidth=function(t){M.prototype.setWidth.call(this,t);if(!this.phaser.texture.trim){this.phaser.texture.frame.width=t;this.phaser.displayChanged(pt.DisplayChangeStatus.SIZE)}};se.prototype.setHeight=function(t){M.prototype.setHeight.call(this,t);if(!this.phaser.texture.trim){this.phaser.texture.frame.height=t;this.phaser.displayChanged(pt.DisplayChangeStatus.SIZE)}};se.prototype._resetNinePadding=function(){if(!this.texture)return;var t=this.texture.padding;this._borderLeft=t[0];this._borderTop=t[1];this._borderRight=t[2];this._borderBottom=t[3]};se.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.Node.prototype.getMeta.call(this);e.texture=t.TEXTURE;e.frame=t.AUTO;e.imageType=t.NUMBER;e.skewX=t.NUMBER;e.skewY=t.NUMBER;return e};var oe=function(t){var e=this._qc;if(e.imageType===pt.UIImage.IMAGE_TYPE_SIMPLE){return dt.Sprite.prototype._renderWebGL.call(this,t)}if(!this.visible||this.alpha<=0||!this.renderable)return;var i,r;if(this.softClip){K.getManager(t).pushPolygon(this.softClip)}if(this._graphicsFilter||this._mask||this._filters){var a=t.spriteBatch;if(this._graphicsFilter){a.flush();t.filterManager.pushFilter(this._graphicsFilter)}if(this._filters&&!this.filterSelf){a.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){a.stop();t.maskManager.pushMask(this.mask,t);a.start()}if(this._filters&&this.filterSelf){a.flush();t.filterManager.pushFilter(this._filterBlock)}ce(a,this);if(this._filters&&this.filterSelf){a.stop();t.filterManager.popFilter();a.start()}for(i=0;i<this.children.length;i++){this.children[i]._renderWebGL(t)}a.stop();if(this._mask)t.maskManager.popMask(this._mask,t);if(this._filters&&!this.filterSelf)t.filterManager.popFilter();if(this._graphicsFilter)t.filterManager.popFilter();a.start()}else{ce(t.spriteBatch,this);for(i=0;i<this.children.length;i++){this.children[i]._renderWebGL(t)}}if(this.softClip){K.getManager(t).popPolygon()}};var he=function(t,e){var i=e.texture;var r=i._uvs;if(!r)return;var a=e._qc;var n=a.borderLeft;var s=a.borderRight;var o=a.borderTop;var h=a.borderBottom;var l=e.anchor.x;var u=e.anchor.y;var f,c,p,d;if(i.trim){var _=i.trim;c=_.x-l*_.width;f=c+i.crop.width;d=_.y-u*_.height;p=d+i.crop.height}else{f=i.frame.width*(1-l);c=i.frame.width*-l;p=i.frame.height*(1-u);d=i.frame.height*-u}var g=i.baseTexture.width;var m=i.baseTexture.height;var y=[new dt.Point(r.x0,r.y0),new dt.Point(r.x0+n/g,r.y0+o/m),new dt.Point(r.x2-s/g,r.y2-h/m),new dt.Point(r.x2,r.y2)];var v=Math.abs(f-c);var T=Math.abs(p-d);if(v<n+s){n=v*n/(n+s);s=v-n}if(c>f){n=-n;s=-s}if(T<o+h){o=T*o/(o+h);h=T-o}if(d>p){o=-o;h=-h}var x=[new dt.Point(c,d),new dt.Point(c+n,d+o),new dt.Point(f-s,p-h),new dt.Point(f,p)];var b=e.tint;b=(b>>16)+(b&65280)+((b&255)<<16)+(e.worldAlpha*255<<24);var A=i.baseTexture.resolution;var S=e.worldTransform;var w=S.a/A;var P=S.b/A;var E=S.c/A;var D=S.d/A;var C=S.tx;var O=S.ty;for(var M=0;M<3;++M){var I=M+1;for(var R=0;R<3;++R){var N=R+1;le(t,e,x[M].x,x[R].y,x[I].x,x[N].y,y[M].x,y[R].y,y[I].x,y[N].y,w,P,E,D,C,O,b)}}};var le=function(t,e,i,r,a,n,s,o,h,l,u,f,c,p,d,_,g){var m=t.renderSession.softClipManager;if(m&&m.needClip){m.renderSprite(t.renderSession,e,i,r,a,n,s,o,h,l,u,f,c,p,d,_,g);return}if(t.currentBatchSize>=t.size){t.flush();t.currentBaseTexture=e.texture.baseTexture}var y=t.colors;var v=t.positions;var T=t.currentBatchSize*4*t.vertSize;if(t.renderSession.roundPixels){v[T]=u*i+c*r+d|0;v[T+1]=p*r+f*i+_|0;v[T+5]=u*a+c*r+d|0;v[T+6]=p*r+f*a+_|0;v[T+10]=u*a+c*n+d|0;v[T+11]=p*n+f*a+_|0;v[T+15]=u*i+c*n+d|0;v[T+16]=p*n+f*i+_|0}else{v[T]=u*i+c*r+d;v[T+1]=p*r+f*i+_;v[T+5]=u*a+c*r+d;v[T+6]=p*r+f*a+_;v[T+10]=u*a+c*n+d;v[T+11]=p*n+f*a+_;v[T+15]=u*i+c*n+d;v[T+16]=p*n+f*i+_}v[T+2]=s;v[T+3]=o;v[T+7]=h;v[T+8]=o;v[T+12]=h;v[T+13]=l;v[T+17]=s;v[T+18]=l;y[T+4]=y[T+9]=y[T+14]=y[T+19]=g;t.sprites[t.currentBatchSize++]=e};var ue=function(t,e){var i=e.texture;var r=i._uvs;if(!r)return;var a=e._qc;var n=a.borderLeft;var s=a.borderRight;var o=a.borderTop;var h=a.borderBottom;var l=e.anchor.x;var u=e.anchor.y;var f,c,p,d;if(i.trim){var _=i.trim;c=_.x-l*_.width;f=c+i.crop.width;d=_.y-u*_.height;p=d+i.crop.height}else{f=i.frame.width*(1-l);c=i.frame.width*-l;p=i.frame.height*(1-u);d=i.frame.height*-u}var g=i.baseTexture.width;var m=i.baseTexture.height;var y=[new dt.Point(r.x0,r.y0),new dt.Point(r.x0+n/g,r.y0+o/m),new dt.Point(r.x2-s/g,r.y2-h/m),new dt.Point(r.x2,r.y2)];var v=r.x0+n/g;var T=r.y0+o/m;var x=r.x2-s/g;var b=r.y2-h/m;var A=Math.abs(f-c);var S=Math.abs(p-d);if(A<n+s){n=A*n/(n+s);s=A-n}if(c>f){n=-n;s=-s}if(S<o+h){o=S*o/(o+h);h=S-o}if(d>p){o=-o;h=-h}var w=f-s;var P=p-h;var E=c+n;var D=d+o;var C=[new dt.Point(c,d),new dt.Point(E,D),new dt.Point(w,P),new dt.Point(f,p)];var O=e.tint;O=(O>>16)+(O&65280)+((O&255)<<16)+(e.worldAlpha*255<<24);var M=i.baseTexture.resolution;var I=e.worldTransform;var R=I.a/M;var N=I.b/M;var B=I.c/M;var L=I.d/M;var F=I.tx;var k=I.ty;var U=(r.x2-r.x0)*g-n-s;var j=(r.y2-r.y0)*m-o-h;if(A-n-s>U*32)U=(A-n-s)/32;if(S-o-h>j*32)j=(S-o-h)/32;var W=x;var V=b;if(U>0&&j>0){for(var z=D;z<P;z+=j){var G=z+j;if(G>P){V=T+(b-T)*(P-z)/(G-z);G=P}W=x;for(var Y=E;Y<w;Y+=U){var H=Y+U;if(H>w){W=v+(x-v)*(w-Y)/(H-Y);H=w}le(t,e,Y,z,H,G,v,T,W,V,R,N,B,L,F,k,O)}}}W=x;V=b;if(j){for(var z=D;z<P;z+=j){var G=z+j;if(G>P){V=T+(b-T)*(P-z)/(G-z);G=P}le(t,e,c,z,E,G,r.x0,T,v,V,R,N,B,L,F,k,O);le(t,e,w,z,f,G,x,T,r.x2,V,R,N,B,L,F,k,O)}}W=x;V=b;if(U){for(var Y=E;Y<w;Y+=U){var H=Y+U;if(H>w){W=v+(x-v)*(w-Y)/(H-Y);H=w}le(t,e,Y,d,H,D,v,r.y0,W,T,R,N,B,L,F,k,O);le(t,e,Y,P,H,p,v,b,W,r.y2,R,N,B,L,F,k,O)}}le(t,e,C[0].x,C[0].y,C[1].x,C[1].y,y[0].x,y[0].y,y[1].x,y[1].y,R,N,B,L,F,k,O);le(t,e,C[2].x,C[0].y,C[3].x,C[1].y,y[2].x,y[0].y,y[3].x,y[1].y,R,N,B,L,F,k,O);le(t,e,C[2].x,C[2].y,C[3].x,C[3].y,y[2].x,y[2].y,y[3].x,y[3].y,R,N,B,L,F,k,O);le(t,e,C[0].x,C[2].y,C[1].x,C[3].y,y[0].x,y[2].y,y[1].x,y[3].y,R,N,B,L,F,k,O)};var fe=function(u){if(this.visible===false||this.alpha===0||this.renderable===false||this.texture.crop.width<=0||this.texture.crop.height<=0)return;var t=this.texture.valid;var e=this._qc;var i=e.imageType;if(this.maskPixel&&t&&i===pt.UIImage.IMAGE_TYPE_SIMPLE){var r=u.bufferPool||(u.bufferPool=[]);var a=u.context;var n=a.globalOffX||0;var s=a.globalOffY||0;var o=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds();var h=Math.max(n,o.x);var l=Math.max(s,o.y);var f=Math.min(o.x+o.width,a.canvas.width+n);var c=Math.min(o.y+o.height,a.canvas.height+s);o.x=h;o.y=l;o.width=f-h;o.height=c-l;var p=r.pop();if(!p){p=new _t.CanvasBuffer(u.context.canvas.width*u.resolution,u.context.canvas.height*u.resolution);p.context._setTransform=p.context.setTransform;p.context.setTransform=function(t,e,i,r,a,n){this._setTransform(t,e,i,r,a-(this.globalOffX||0),n-(this.globalOffY||0))}}p.resize(o.width*u.resolution,o.height*u.resolution);p.context.clearRect(0,0,o.width*u.resolution,o.height*u.resolution);p.context.globalOffX=o.x*u.resolution+n;p.context.globalOffY=o.y*u.resolution+s;u.context=p.context}var d=u.context;if(this.blendMode!==u.currentBlendMode){u.currentBlendMode=this.blendMode;d.globalCompositeOperation=_t.blendModesCanvas[u.currentBlendMode]}if(this._mask){u.maskManager.pushMask(this._mask,u)}if(t){var _=this.texture.baseTexture.resolution/u.resolution;d.globalAlpha=this.worldAlpha;if(u.smoothProperty&&(u.scaleMode!==this.texture.baseTexture.scaleMode||d[u.smoothProperty]!==(u.scaleMode===_t.scaleModes.LINEAR))){u.scaleMode=this.texture.baseTexture.scaleMode;d[u.smoothProperty]=u.scaleMode===_t.scaleModes.LINEAR}var g=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var m=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;var y=this.texture.trim?this.texture.crop.width:this.texture.frame.width;var v=this.texture.trim?this.texture.crop.height:this.texture.frame.height;if(u.roundPixels){d.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*u.resolution|0,this.worldTransform.ty*u.resolution|0);g=g|0;m=m|0}else{d.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*u.resolution,this.worldTransform.ty*u.resolution)}var T=function(t,e,i,r,a,n,s,o,h,l){if(!h||!l)return;u.drawCount++;t.drawImage(e,i,r,a||1,n||1,s,o,h,l)};var x;var b,A,S,w;if(this.tint!==16777215){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;this.tintedTexture=_t.CanvasTinter.getTintedTexture(this,this.tint)}x=this.tintedTexture;b=0;A=0;S=this.texture.crop.width;w=this.texture.crop.height}else{x=this.texture.baseTexture.source;b=this.texture.crop.x;A=this.texture.crop.y;S=this.texture.crop.width;w=this.texture.crop.height}g=Math.round(g/_);m=Math.round(m/_);y=Math.round(y/_);v=Math.round(v/_);if(i===pt.UIImage.IMAGE_TYPE_SIMPLE){if(!this.maskPixel){T(d,x,b,A,S,w,g,m,y,v)}}else if(e.texture&&y&&v){var P=""+e.texture.atlas.uuid+i+e.frame+this.tint+y+v;var E=pt.CanvasPool.get(P);var D=E.canvas;if(E.dirty){var C=D.getContext("2d");if(u.smoothProperty&&C[u.smoothProperty]!==(u.scaleMode===_t.scaleModes.LINEAR))C[u.smoothProperty]=u.scaleMode===_t.scaleModes.LINEAR;D.width=y;D.height=v;C.clearRect(0,0,y,v);var O=e.borderLeft;var M=e.borderRight;var I=e.borderTop;var R=e.borderBottom;var N=[new dt.Point(b,A),new dt.Point(b+O,A+I),new dt.Point(b+S-M,A+w-R),new dt.Point(b+S,A+w)];O/=_;I/=_;M/=_;R/=_;if(y<O+M){O=y*O/(O+M);M=y-O}if(v<I+R){I=v*I/(I+R);R=v-I}var B=[new dt.Point(0,0),new dt.Point(O,I),new dt.Point(y-M,v-R),new dt.Point(y,v)];if(i==pt.UIImage.IMAGE_TYPE_SLICED){for(var L=0;L<3;++L){var F=L+1;for(var k=0;k<3;++k){var U=k+1;var j=N[L].x;var W=N[k].y;var V=N[F].x;var z=N[U].y;var G=B[L].x;var Y=B[k].y;var H=B[F].x;var X=B[U].y;if(V-j<=0||z-W<=0||H-G<=0||X-Y<=0){continue}T(C,x,j,W,V-j,z-W,G,Y,H-G,X-Y)}}}else{var q=N[1].x;var K=N[1].y;var J=N[2].x;var Z=N[2].y;var Q=y-M;var $=v-R;var tt=O;var et=I;var it=S/_-O-M;var rt=w/_-I-R;if(y-O-M>it*32)it=(y-O-M)/32;if(v-I-R>rt*32)rt=(v-I-R)/32;var at=J;var nt=Z;if(it>0&&rt>0){for(var st=et;st<$;st+=rt){var U=st+rt;if(U>$){nt=K+(Z-K)*($-st)/(U-st);U=$}at=J;for(var ot=tt;ot<Q;ot+=it){var F=ot+it;if(F>Q){at=q+(J-q)*(Q-ot)/(F-ot);F=Q}if(at-q<=0||nt-K<=0||F-ot<=0||U-st<=0){continue}T(C,x,q,K,at-q,nt-K,ot,st,F-ot,U-st)}}}nt=Z;if(rt){for(var st=et;st<$;st+=rt){var U=st+rt;if(U>$){nt=K+(Z-K)*($-st)/(U-st);U=$}T(C,x,b,K,q-b,nt-K,0,st,O,U-st);T(C,x,J,K,b+S-J,nt-K,Q,st,M,U-st)}}at=J;if(it){for(var ot=tt;ot<Q;ot+=it){var F=ot+it;if(F>Q){at=q+(J-q)*(Q-ot)/(F-ot);F=Q}T(C,x,q,A,at-q,K-A,ot,0,F-ot,I);T(C,x,q,Z,at-q,A+w-Z,ot,$,F-ot,R)}}T(C,x,N[0].x,N[0].y,N[1].x-N[0].x,N[1].y-N[0].y,B[0].x,B[0].y,B[1].x-B[0].x,B[1].y-B[0].y);T(C,x,N[2].x,N[0].y,N[3].x-N[2].x,N[1].y-N[0].y,B[2].x,B[0].y,B[3].x-B[2].x,B[1].y-B[0].y);T(C,x,N[2].x,N[2].y,N[3].x-N[2].x,N[3].y-N[2].y,B[2].x,B[2].y,B[3].x-B[2].x,B[3].y-B[2].y);T(C,x,N[0].x,N[2].y,N[1].x-N[0].x,N[3].y-N[2].y,B[0].x,B[2].y,B[1].x-B[0].x,B[3].y-B[2].y)}}T(d,D,0,0,y,v,g,m,y,v)}}for(var ht=0;ht<this.children.length;ht++){this.children[ht]._renderCanvas(u)}if(this._mask){u.maskManager.popMask(u)}if(this.maskPixel&&t&&i===pt.UIImage.IMAGE_TYPE_SIMPLE){d.globalCompositeOperation="destination-in";if(u.roundPixels){d.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*u.resolution|0,this.worldTransform.ty*u.resolution|0);g=g|0;m=m|0}else{d.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*u.resolution,this.worldTransform.ty*u.resolution)}T(d,x,b,A,S,w,g,m,y,v);d.globalCompositeOperation="source-over";u.context=a;if(u.roundPixels){u.context.setTransform(1,0,0,1,o.x*u.resolution|0,o.y*u.resolution|0)}else{u.context.setTransform(1,0,0,1,o.x*u.resolution,o.y*u.resolution)}if(!p.canvas.height||!p.canvas.width){return}u.drawCount++;u.context.drawImage(p.canvas,0,0,p.canvas.width,p.canvas.height,0,0,p.canvas.width,p.canvas.height);r.push(p)}};var ce=function(t,e){switch(e._qc.imageType){case se.IMAGE_TYPE_SLICED:he(t,e);break;case se.IMAGE_TYPE_TILED:ue(t,e);break}};var pe=function(){var t=this,e=t.parent;if(!e||!t.visible){return}t.worldAlpha=t.alpha*e.worldAlpha;if(!t._isNotNeedCalcTransform||e._isSubNeedCalcTransform){t.game&&t.game._calcTransformCount++;if(t.rotation!==t.rotationCache){t.rotationCache=t.rotation;t._sr=Math.sin(t.rotation);t._cr=Math.cos(t.rotation)}var i,r,a,n,s,o;var h,l,u,f,c,p;var d,_,g,m,y,v;var T,x,b,A;h=Math.cos(t._qc._skewY||0);l=Math.sin(t._qc._skewY||0);u=-Math.sin(t._qc._skewX||0);f=Math.cos(t._qc._skewX||0);c=t.position.x;p=t.position.y;d=t._cr*t.scale.x;_=t._sr*t.scale.x;g=-t._sr*t.scale.y;m=t._cr*t.scale.y;y=0;v=0;i=d*h+_*u;r=d*l+_*f;a=g*h+m*u;n=g*l+m*f;s=y*h+v*u+c;o=y*l+v*f+p;var S=t.worldTransform;var w=e.worldTransform;T=w.a;x=w.b;b=w.c;A=w.d;S.a=i*T+r*b;S.b=i*x+r*A;S.c=a*T+n*b;S.d=a*x+n*A;S.tx=s*T+o*b+w.tx;S.ty=s*x+o*A+w.ty;this._isNotNeedCalcTransform=true;this._isSubNeedCalcTransform=true;if(t.transformCallback){S.inUpdate=false;t.transformCallback.call(t.transformCallbackContext,S,w)}}else{t._isSubNeedCalcTransform=false;var S=t.worldTransform;var w=e.worldTransform;if(t.transformCallback){S.inUpdate=false;t.transformCallback.call(t.transformCallbackContext,S,w)}}if(t._cacheAsBitmap)return;for(var P=0,E=t.children.length;P<E;P++){t.children[P].updateTransform()}};var de=pt.UIRoot=function(t,e){pt.Node.call(this,new dt.Group(t.phaser,null),null,e);this.name="UIRoot";var i=e!==C;if(!i){var r=this.addScript("qc.ScaleAdapter");r.referenceResolution=new pt.Point(640,960);r.manualType=pt.ScaleAdapter.EXPAND;r.fullTarget=true}this.setAnchor(new pt.Point(0,0),new pt.Point(0,0));this.pivotX=0;this.pivotY=0;var a=this.getWorldScale();this.setTransformToWorld(0,0,a.x,a.y,this.getWorldRotation())};de.prototype=P.create(pt.Node.prototype);de.prototype.constructor=de;P.defineProperties(de.prototype,{class:{get:function(){return"qc.UIRoot"}}});de.prototype.postUpdate=function(){this.x=0;this.y=0};var _e=pt.Sprite=function(t,e,i){var r=new dt.Sprite(t.phaser);pt.Node.call(this,r,e,i);this.name="Sprite";this.animationType=pt.Sprite.NONE_ANIMATION;this._phaserImageSetFrame=r.setFrame;r.setFrame=me;r._renderWebGL=ve;r._renderCanvas=Te};_e.prototype=P.create(pt.Node.prototype);_e.prototype.constructor=_e;_e.NONE_ANIMATION=0;_e.FRAME_ANIMATION=1;_e.DRAGON_BONES=2;_e.FRAME_SAMPLES=3;var ge=8;_e.prototype.playAnimation=function(t,e,i){var r=this;var a=r.animationType;if(a===_e.NONE_ANIMATION||!t)return;if(a===_e.DRAGON_BONES){var n=r._armature.animation;if(n.animationNameList.indexOf(t)<0){console.warn("Animation is not exist.",t);return}if(!e){e=1}var s=C;var o=n.animationNameList.length;var h;while(o--){if(n.animationNameList[o]==t){h=n.animations[t];break}}if(typeof e==="number"&&e!=1&&e>0){if(h){s=h.duration/e}}var l;if(i==C){l=h.playTimes==0?2097152:h.playTimes}else{if(i===true){l=2097152}else if(i===false){l=1}else{l=C}}r.paused=false;r._armature.animation.timeScale=e;r._armature.animation.play(t,l);return}var h=this._animation[t];if(!h){r.game.log.error("Animation {0} not exists",t);return}var u=h["rate"]?h["rate"]:60;if(a===_e.FRAME_SAMPLES)u=u*ge;if(!r.phaser.animations._anims[t]){r.phaser.animations.add(t,h["frames"],u);var n=r.phaser.animations._anims[t];n.onStart.add(function(){if(r._onStart)r._onStart.dispatch(r.lastAnimationName)});n.onComplete.add(function(){if(r._onFinished)r._onFinished.dispatch(r.lastAnimationName)});n.onLoop.add(function(){if(r._onLoopFinished)r._onLoopFinished.dispatch(r.lastAnimationName)})}if(typeof i!=="boolean"){i=!!h["loop"]}this._slowMotion=this.game.time.timeScale;this._speed=(e?e:1)*u;r.phaser.animations.play(t,this._speed/this._slowMotion,i)};_e.prototype.stop=function(){var t=this;var e=t.animationType;if(e===_e.NONE_ANIMATION)return;if(!t.isPlaying)return;if(e===_e.DRAGON_BONES){var i=t._armature.animation;i.stop();return}var r=t.phaser.animations.currentAnim;if(r)r.stop(C,true)};_e.prototype.update=function(){if(this.animationType===pt.Sprite.FRAME_SAMPLES&&this.isPlaying){this.phaser.displayChanged(pt.DisplayChangeStatus.TEXTURE)}if(this.animationType===pt.Sprite.DRAGON_BONES&&this._armature){if(this.isPaused())return;var t=.001*this.game.time.deltaTime;this._armature.advanceTime(t);dragonBones.PhaserFactory.factory.dragonBones.advanceTime(t)}else if(this.animationType===pt.Sprite.FRAME_ANIMATION||this.animationType===pt.Sprite.FRAME_SAMPLES){var e=this.game.time.timeScale;if(e===this._slowMotion)return;this._slowMotion=e;var i=this.phaser.animations.currentAnim;if(i)i.speed=this._speed/e}};_e.prototype.bindDragonBonesEvent=function(){var t=this;t._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.START,function(){if(t._onStart)t._onStart.dispatch(t.lastAnimationName)});t._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,function(){if(t._onStart){t._onStart.dispatch(t.lastAnimationName)}});t._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.COMPLETE,function(){if(t._onFinished)t._onFinished.dispatch(t.lastAnimationName)});t._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.SOUND_EVENT,function(t){console.log("播放龙骨音效");if(t&&t.name){D.soundIsPause=false;D.webIsActivate&&D.playSoundEff&&D.playSoundEff("resource/game/audio/"+t.name+".mp3",1)}})};_e.prototype.getAnimationInfo=function(t){var e=this;var i=this.animationType;if(i===_e.NONE_ANIMATION)return;if(i===_e.DRAGON_BONES){var r=this._armature.animation;if(r.animationNameList.indexOf(t)<0){return}var a=r.animationNameList.length;var n;while(a--){if(r.animationNameList[a]==t){n=r.animations[t];break}}return n}else{var n=this._animation[t];if(!n)return;var s=n["frames"]||[];var o=n["rate"]?parseFloat(n["rate"]):30;return{frames:s,frameRate:o,loop:n["loop"]?0:1,duration:s.length/o}}};P.defineProperties(_e.prototype,{texture:{get:function(){if(!this._atlas)return null;return new pt.Texture(this._atlas,this.frame)},set:function(t){var e=this;if(e.animationType===_e.DRAGON_BONES&&e._boneBase){e.removeChild(e._boneBase);e._armature=null;e._boneBase=null}if(!t){e._atlas=null;e.phaser.loadTexture(null,e.frame);e.animationType=_e.NONE_ANIMATION;return}if(t instanceof pt.Atlas)t=new pt.Texture(t,e.frame);var i=e._atlas=t.atlas;e.animationType=i.animation?i.animation.type:_e.NONE_ANIMATION;if(e.animationType===_e.DRAGON_BONES){var r=e._armature=pt.dragonBones.makeQcArmature(i.animation.data,i.json,i.img,i.key);if(!r){console.warn("makeQcArmature failed:(img:",i.img,"atlas:",i.json,"skeleton:",i.animation.data,")");return}e._armature=r;var a=r.display;e.addChild(a);e._boneBase=a;e.colorTint=e.colorTint;var n=i.animation.data.armature[0].canvas;var s=e.getChildAt(0);if(n){e.width=n.width;e.height=n.height}else{var o=s.getChildAt(0).width;var h=s.getChildAt(0).height;var l=s.getChildAt(0)._anchoredX;var u=s.getChildAt(0)._anchoredY;var f=s.getChildAt(0)._anchoredX;var c=s.getChildAt(0)._anchoredY;for(var p=0;p<s._children.length;p++){var d=s.getChildAt(p);var _=d.width;var g=d.height;var m=d._anchoredX;var y=d._anchoredY;if(_>=o){o=_}if(g>=h){h=g}if(m<=f){f=m}if(m>=l){l=m}if(y<=c){c=y}if(y>=u){u=y}}var v=Math.round(Math.abs(f))+Math.round(Math.abs(l));var T=Math.round(Math.abs(c))+Math.round(Math.abs(u));e.width=v+o;e.height=T+h}s.pivotX=e.pivotX;s.pivotY=e.pivotY;s.maxAnchor.x=s.maxAnchor.y=.5;s.minAnchor.x=s.minAnchor.y=.5;s.resetNativeSize()}else if(e.animationType===_e.FRAME_ANIMATION){e._animation=i.animation.data.animations;e.phaser.animations=new dt.AnimationManager(e.phaser)}else if(e.animationType===_e.FRAME_SAMPLES){e._animation=i.animation.data.samples;e.phaser.animations=new dt.AnimationManager(e.phaser)}if(!i.getFrame(t.frame))t.frame=0;e.phaser.key=i.key;e.frame=t.frame;e.paused=false;if(e.animationType===_e.DRAGON_BONES){e.bindDragonBonesEvent()}if(e.defaultAnimation){if(!e.animationNameList||e.animationNameList.indexOf(e.defaultAnimation)<0){e.defaultAnimation=null}else e.playAnimation(e.defaultAnimation)}e._dispatchLayoutArgumentChanged("size");if(e._onTextureChanged){e._onTextureChanged.dispatch()}}},frame:{get:function(){return this.phaser.frameName},set:function(t){if(!this.texture)return;var e=this.texture.atlas.frameNames||[0];if(typeof t==="string"&&e.indexOf(t)===-1)return;this.phaser.loadTexture(this.texture.atlas.key,t,false);this._dispatchLayoutArgumentChanged("size");if(this._onTextureChanged){this._onTextureChanged.dispatch()}}},defaultAnimation:{get:function(){return this._defaultAnimation},set:function(t){if(t==="")t=null;this._defaultAnimation=t;this.playAnimation(t)}},addInfo:{get:function(){var s={};var t=this.name;o(this,t);function o(t,e){for(var i=0;i<t.children.length;i++){var r=t.children[i];var a=r.getScript(ps.Layout);var n;if(D.PlaySmartEditorData){n=r.getScript("playsmart.editor.data")}if(a){if(!s[e+"_"+r.name]){s[e+"_"+r.name]={}}s[e+"_"+r.name]["layout"]=a.layout}if(D.PlaySmartEditorData&&n){if(!s[e+"_"+r.name]){s[e+"_"+r.name]={}}s[e+"_"+r.name]["playsmart_editor_data_screenAdapter"]=n.screenAdapter}if(r.texture){if(!s[e+"_"+r.name]){s[e+"_"+r.name]={}}s[e+"_"+r.name]["url"]=r.texture.atlas.url;h+=r.uuid+" "+r.texture}if(r instanceof dragonBones.PhaserArmatureDisplay||r instanceof pt.Sprite){if(!s[e+"_"+r.name]){s[e+"_"+r.name]={}}s[e+"_"+r.name]["x"]=r.x;s[e+"_"+r.name]["y"]=r.y}if(r.children&&r.children.length>0){o(r,e)}}}var h=JSON.stringify(s);return h},set:function(t){var o=JSON.parse(t);this.changeData=o;var e=this.name;h(this,e);function h(t,e){for(var i=0;i<t.children.length;i++){var r=t.children[i];var a=e+"_"+r.name;if(o[a]){if(o[a]["layout"]){var n=r.addScript("ps.Layout");n.layout=o[a]["layout"]}if(o[a]["playsmart_editor_data_screenAdapter"]){if(D.PlaySmartEditorData){var s=r.addScript("playsmart.editor.data");if(typeof s!=="undefined"){s["screenAdapter"]=o[a]["playsmart_editor_data_screenAdapter"]}}}if(r instanceof dragonBones.PhaserArmatureDisplay||r instanceof pt.Sprite){r.x=o[a]["x"];r.y=o[a]["y"]}if(o[a]["url"]!=null){r.texture=null;if(dragonBones.game._qc.assets.find(o[a]["url"])){r.texture=dragonBones.game._qc.assets.find(o[a]["url"]);r.resetNativeSize()}else{r.loadImg(o[a]["url"])}}}if(r.children&&r.children.length>0){h(r,e)}}}}},paused:{get:function(){return this.isPaused()},set:function(t){switch(this.animationType){case pt.Sprite.FRAME_ANIMATION:case pt.Sprite.FRAME_SAMPLES:if(!this.phaser.animations.currentAnim)return;this.phaser.animations.paused=t;break;case pt.Sprite.DRAGON_BONES:this._paused=t;break;default:break}}},isPlaying:{get:function(){switch(this.animationType){case pt.Sprite.FRAME_ANIMATION:case pt.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return!!t&&t.isPlaying;case pt.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsPlaying();default:return false}}},isComplete:{get:function(){switch(this.animationType){case pt.Sprite.FRAME_ANIMATION:case pt.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return!!t&&t.isFinished;case pt.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsComplete();default:return false}}},lastAnimationName:{get:function(){switch(this.animationType){case pt.Sprite.FRAME_ANIMATION:case pt.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;if(!t)return null;return t.name;case pt.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getLastAnimationName();default:return false}}},onStart:{get:function(){if(!this._onStart){this._onStart=new dt.Signal}return this._onStart}},onFinished:{get:function(){if(!this._onFinished){this._onFinished=new dt.Signal}return this._onFinished}},onLoopFinished:{get:function(){if(!this._onLoopFinished){this._onLoopFinished=new dt.Signal}return this._onLoopFinished}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new pt.Rectangle(0,0,0,0)}},armature:{get:function(){return this._armature}},animationNameList:{get:function(){switch(this.animationType){case pt.Sprite.FRAME_ANIMATION:if(!this.texture)return null;var t=this.texture.atlas.animation.data.animations;if(!t)return null;return P.keys(t);case pt.Sprite.DRAGON_BONES:if(!this._armature)return null;return this._armature.animation.animationNameList;case pt.Sprite.FRAME_SAMPLES:var e=this._animation;if(!e)return null;return P.keys(e);default:return null}}},colorTint:{get:function(){return new yt(this.phaser.tint)},set:function(t){if(!(t instanceof yt))throw new Error("Expected:qc.Color");this.phaser.tint=t.toNumber()}},onTextureChanged:{get:function(){if(!this._onTextureChanged){this._onTextureChanged=new dt.Signal}return this._onTextureChanged}},class:{get:function(){return"qc.Sprite"}}});_e.prototype.resetNativeSize=function(){this.width=this.nativeSize.width;this.height=this.nativeSize.height};_e.prototype.isPaused=function(){switch(this.animationType){case pt.Sprite.FRAME_ANIMATION:case pt.Sprite.FRAME_SAMPLES:if(!this.phaser.animations.currentAnim)return false;return this.phaser.animations.paused;case pt.Sprite.DRAGON_BONES:return this._paused;default:return false}};var me=function(t){var e=this._qc;e._phaserImageSetFrame.call(this,t);if(e.animationType!==pt.Sprite.DRAGON_BONES){e.setWidth(e.width);e.setHeight(e.height)}};var ye=function(t,e,i,r,a,n,s,o,h,l,u,f,c,p,d,_,g,m,y,v,T){if(t.currentBatchSize>=t.size){t.flush();t.currentBaseTexture=e.texture.baseTexture}var x=t.colors;var b=t.positions;var A=t.currentBatchSize*4*t.vertSize;if(t.renderSession.roundPixels){b[A]=d*i+g*r+y|0;b[A+1]=m*r+_*i+v|0;b[A+5]=d*a+g*n+y|0;b[A+6]=m*n+_*a+v|0;b[A+10]=d*s+g*o+y|0;b[A+11]=m*o+_*s+v|0;b[A+15]=d*h+g*l+y|0;b[A+16]=m*l+_*h+v|0}else{b[A]=d*i+g*r+y;b[A+1]=m*r+_*i+v;b[A+5]=d*a+g*n+y;b[A+6]=m*n+_*a+v;b[A+10]=d*s+g*o+y;b[A+11]=m*o+_*s+v;b[A+15]=d*h+g*l+y;b[A+16]=m*l+_*h+v}b[A+2]=u;b[A+3]=f;b[A+7]=c;b[A+8]=f;b[A+12]=c;b[A+13]=p;b[A+17]=u;b[A+18]=p;x[A+4]=x[A+9]=x[A+14]=x[A+19]=T;t.sprites[t.currentBatchSize++]=e};var ve=function(t){var e=this._qc;var i=e.animationType;if(i===pt.Sprite.FRAME_SAMPLES){if(!this.visible||this.alpha<=0||!this.renderable)return;if(!this.animations.currentAnim)return;var r=t.spriteBatch;var a=this;var n=this.animations.currentAnim._frameIndex;var s=e.texture.atlas.animation.data;var o=s.uvs;var h=e.lastAnimationName;var l=e._animation[h];var u=l.frames;var f=a.texture;var c=f.baseTexture.resolution;var p=a.worldTransform;var d=p.a/c;var _=p.b/c;var g=p.c/c;var m=p.d/c;var y=p.tx;var v=p.ty;var T=a.tint;var x=a.parent.worldAlpha*a.alpha;var b=l.last;var A,S,w,P;T=(T>>16)+(T&65280)+((T&255)<<16);var E=-1;var D,C;var O;var M;if(!s.convert)s.convert={};if(!s.convert[h])s.convert[h]=O=new Array(u.length);else O=s.convert[h];if((n&7)===0){E=n>>3;if(!O[E])M=[E]}else if(n===b-1){E=(n>>3)+1;if(!O[E])M=[E]}else{D=n>>3;C=D+1;if(!O[D]&&!O[C])M=[D,C];else if(!O[D])M=[D];else if(!O[C])M=[C]}var I,R,N,B,L,F,k,U;var j;if(M){var W=a.texture.baseTexture.width;var V=a.texture.baseTexture.height;var z=o.length>>2;for(var G=0,Y=M.length;G<Y;G++){var H=M[G];var X=u[H];if(!X){console.log(H,M);continue}P=new Array(z);for(var q=0,K=X.length/10;q<K;q++){A=q*10;S=X[A]*4;P[S]=q;var J=X[A+1];var Z=X[A+2];var Q=X[A+3];var $=X[A+4];var tt=X[A+5];var et=X[A+6];var it=X[A+7];var rt=X[A+8];var at=(o[S+2]-o[S])*W;var nt=(o[S+3]-o[S+1])*V;var st=at*-it;var ot=nt*-rt;var ht=at*(1-it);var lt=nt*(1-rt);X[A+1]=J*st+Q*ot+tt;X[A+2]=Z*st+$*ot+et;X[A+3]=J*ht+Q*ot+tt;X[A+4]=Z*ht+$*ot+et;X[A+5]=J*ht+Q*lt+tt;X[A+6]=Z*ht+$*lt+et;X[A+7]=J*st+Q*lt+tt;X[A+8]=Z*st+$*lt+et}s.convert[h][H]=true;if(!s.uvmap)s.uvmap={};if(!s.uvmap[h])s.uvmap[h]={};s.uvmap[h][H]=P}}if(E>=0){var X=u[E];for(var q=0,K=X.length/10;q<K;q++){A=q*10;S=X[A]*4;I=X[A+1];R=X[A+2];N=X[A+3];B=X[A+4];L=X[A+5];F=X[A+6];k=X[A+7];U=X[A+8];j=X[A+9];ye(r,a,I,R,N,B,L,F,k,U,o[S],o[S+1],o[S+2],o[S+3],d,_,g,m,y,v,T+(j*x<<24))}}else{var ut=(n-(D<<3))/(C===b?b-(D<<3):8);var X=u[D];var ft=u[C];var P=s.uvmap[h][C];for(var q=0,K=X.length/10;q<K;q++){A=q*10;S=X[A]*4;w=P[S]*10;if(isNaN(w)){I=X[A+1];R=X[A+2];N=X[A+3];B=X[A+4];L=X[A+5];F=X[A+6];k=X[A+7];U=X[A+8];j=X[A+9]}else{I=X[A+1];R=X[A+2];N=X[A+3];B=X[A+4];L=X[A+5];F=X[A+6];k=X[A+7];U=X[A+8];j=X[A+9];I=I+(ft[w+1]-I)*ut;R=R+(ft[w+2]-R)*ut;N=N+(ft[w+3]-N)*ut;B=B+(ft[w+4]-B)*ut;L=L+(ft[w+5]-L)*ut;F=F+(ft[w+6]-F)*ut;k=k+(ft[w+7]-k)*ut;U=U+(ft[w+8]-U)*ut;j=j+(ft[w+9]-j)*ut}ye(r,a,I,R,N,B,L,F,k,U,o[S],o[S+1],o[S+2],o[S+3],d,_,g,m,y,v,T+(j*x<<24))}}return _t.DisplayObjectContainer.prototype._renderWebGL.call(this,t)}else if(i===pt.Sprite.DRAGON_BONES&&e._armature){return _t.DisplayObjectContainer.prototype._renderWebGL.call(this,t)}else{return dt.Sprite.prototype._renderWebGL.call(this,t)}};var Te=function(t){var e=this._qc;var i=e.animationType;if(i===pt.Sprite.FRAME_SAMPLES){if(this.visible===false||this.alpha===0||this.renderable===false||this.texture.crop.width<=0||this.texture.crop.height<=0)return;if(!this.animations.currentAnim)return;var r=t.context;if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;r.globalCompositeOperation=_t.blendModesCanvas[t.currentBlendMode]}if(this._mask)t.maskManager.pushMask(this._mask,t);if(this.texture.valid){var a=this.texture.baseTexture.resolution/t.resolution;if(t.smoothProperty&&(t.scaleMode!==this.texture.baseTexture.scaleMode||r[t.smoothProperty]!==(t.scaleMode===_t.scaleModes.LINEAR))){t.scaleMode=this.texture.baseTexture.scaleMode;r[t.smoothProperty]=t.scaleMode===_t.scaleModes.LINEAR}var n;var s=this.texture.baseTexture.width;var o=this.texture.baseTexture.height;if(this.tint!==16777215){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;var h=this.texture.crop;var l=h.x;var u=h.y;var f=h.width;var c=h.height;h.x=0;h.y=0;h.width=s;h.height=o;this.tintedTexture=_t.CanvasTinter.getTintedTexture(this,this.tint);h.x=l;h.y=u;h.width=f;h.height=c}n=this.tintedTexture}else{n=this.texture.baseTexture.source}var p=this;var d=this.animations.currentAnim._frameIndex;var _=e.texture.atlas.animation.data;var g=_.uvs;var m=e.lastAnimationName;var y=e._animation[m].frames;var v=p.texture.baseTexture.resolution;var T=p.worldTransform;var x=T.a/v;var b=T.b/v;var A=T.c/v;var S=T.d/v;var w=T.tx;var P=T.ty;var E=e._animation[m].last;var D,C,O,M,I,R,N,B,L,F,k;if((d&7)===0){D=d>>3;R=y[D]}else if(d===E-1){D=(d>>3)+1;R=y[D]}else{C=d>>3;O=C+1;R=y[C];N=y[O];B=(d-(C<<3))/(O===E?E-(C<<3):8);if(!_.uvmap)_.uvmap={};if(!_.uvmap[m])_.uvmap[m]=M=new Array(y.length);else M=_.uvmap[m];if(!M[O]){var U=g.length>>2;I=new Array(U);N=y[O];for(var j=0,W=N.length/10;j<W;j++){F=N[j*10]*4;I[F]=j}M[O]=I}else I=M[O]}var V=this.parent.worldAlpha*p.alpha;for(var j=0,W=R.length/10;j<W;j++){L=j*10;F=R[L]*4;var z=R[L+1];var G=R[L+2];var Y=R[L+3];var H=R[L+4];var X=R[L+5];var q=R[L+6];var K=R[L+7];var J=R[L+8];var Z=R[L+9];if(O){k=I[F]*10;if(!isNaN(k)){z=z+(N[k+1]-z)*B;G=G+(N[k+2]-G)*B;Y=Y+(N[k+3]-Y)*B;H=H+(N[k+4]-H)*B;X=X+(N[k+5]-X)*B;q=q+(N[k+6]-q)*B;K=K+(N[k+7]-K)*B;J=J+(N[k+8]-J)*B;Z=Z+(N[k+9]-Z)*B}}var Q=g[F]*s;var $=g[F+1]*o;var tt=g[F+2]*s;var et=g[F+3]*o;var it=z*x+G*A;var rt=z*b+G*S;var at=Y*x+H*A;var nt=Y*b+H*S;var st=(X*x+q*A+w)*t.resolution;var ot=(X*b+q*S+P)*t.resolution;var ht=tt-Q;var lt=et-$;var ut=ht*-K;var ft=lt*-J;if(t.roundPixels){r.setTransform(it,rt,at,nt,st|0,ot|0);ut=ut|0;ft=ft|0}else{r.setTransform(it,rt,at,nt,st,ot)}r.globalAlpha=V*(Z/255);r.drawImage(n,Q,$,ht,lt,ut/a,ft/a,ht/a,lt/a)}}var ct=this.children;for(var j=0;j<ct.length;j++){ct[j]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}}else if(i===pt.Sprite.DRAGON_BONES&&e._armature){return _t.DisplayObjectContainer.prototype._renderCanvas.call(this,t)}else{return dt.Sprite.prototype._renderCanvas.call(this,t)}};_e.prototype.getSampledAnimationBounds=function(){var t=this.animationType;if(t!==pt.Sprite.FRAME_SAMPLES)return new pt.Rectangle(0,0,0,0);var e=this.lastAnimationName;if(!e)return new pt.Rectangle(0,0,0,0);var i=this.texture.atlas.animation.data;var r=i.bounds;if(!r)r=i.bounds={};var a=r[e];if(a)return a;var n=i.uvs;var s=this.phaser.texture.baseTexture.width;var o=this.phaser.texture.baseTexture.height;var h=this._animation[e];var l=i.convert?i.convert[e]||{}:{};var u,f,c;var p,d,_;var g,m;var y,v,T,x,b,A,S,w,P,E,D,C,O,M;var I,R,N,B,L,F,k,U;var j=Infinity,W=Infinity,V=-Infinity,z=-Infinity;for(u=0,f=h.frames.length;u<f;u++){c=h.frames[u];_=l[u];for(p=0,d=c.length/10;p<d;p++){g=p*10;m=c[g]*4;if(!_){y=c[g+1];v=c[g+2];T=c[g+3];x=c[g+4];b=c[g+5];A=c[g+6];S=c[g+7];w=c[g+8];P=(n[m+2]-n[m])*s;E=(n[m+3]-n[m+1])*o;D=P*-S;C=E*-w;O=P*(1-S);M=E*(1-w);I=y*D+T*C+b,L=v*D+x*C+A;R=y*O+T*C+b,F=v*O+x*C+A;N=y*O+T*M+b,k=v*O+x*M+A;B=y*D+T*M+b,U=v*D+x*M+A}else{I=c[g+1],L=c[g+2];R=c[g+3],F=c[g+4];N=c[g+5],k=c[g+6];B=c[g+7],U=c[g+8]}j=Math.min(j,I,R,N,B);V=Math.max(V,I,R,N,B);W=Math.min(W,L,F,k,U);z=Math.max(z,L,F,k,U)}}a=r[e]=new pt.Rectangle(j,W,V-j,z-W);return a};_e.prototype.setWidth=function(t){M.prototype.setWidth.call(this,t);if(!this.phaser.texture.trim){this.phaser.texture.frame.width=t}};_e.prototype.setHeight=function(t){M.prototype.setHeight.call(this,t);if(!this.phaser.texture.trim){this.phaser.texture.frame.height=t}};_e.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.Node.prototype.getMeta.call(this);e.texture=t.TEXTURE;e.frame=t.AUTO;e.defaultAnimation=t.STRING;e.addInfo=t.STRING;return e};var xe=pt.UIText=function(t,e,i){pt.Node.call(this,new dt.Group(t.phaser,null),e,i);this.textPhaser=new dt.Text(t.phaser);this.textPhaser._nqc=this;this.textPhaser.wordWrapWidth=this.width;this.textPhaser.wordWrapHeight=this.height;this.phaser.addChildAt(this.textPhaser,0);this.textRealWidth=0;this.textRealHeight=0;this.fontSize=12;this._glowText=null;this.name="UIText";this._data="";this._colors=[];this.color=yt.black;this.colorfill;this._gradient=false;this.startColor=yt.red;this.endColor=yt.black;this._gradientByLine=true;this._fontFamily=xe.SYSTEMFONT;this.textPhaser.determineFontProperties=xe._phaserDetermineFontProperties;this.shadowBlur=10;this.shadowOffsetX=0;this.shadowOffsetY=0;this.shadowColor=yt.shadow;this._enableShadow=false;this._enableGlow=false;this.glowColor=yt.red;this.stroke=yt.black;this._strokeThickness=0;this._glowBlur=1;this._wrap=false;this._wrapWidth=this.width;this._wrapHeight=this.height;this._autoSize=false;this._onPhaseTextSizeChange=new dt.Signal;this._onPhaseTextSizeChange.add(function(t,e){if(this.autoSize){this.width=t;this.height=e}},this);var r=i!==C;if(r!==true){this.bold=false;this.alignH=xe.LEFT;this.alignV=xe.MIDDLE;this.overflow=false}var a=this;this.onTransformChanged.add(function(t,e){if(a.textPhaser&&a.game.renderInRenderTexture&&!a.isUpating){a.isUpating=true;a.textPhaser.updateText();a.isUpating=false}})};xe.prototype=P.create(pt.Node.prototype);xe.prototype.constructor=xe;xe.LEFT=0;xe.RIGHT=1;xe.CENTER=2;xe.JUSTIFY=3;xe.TOP=0;xe.BOTTOM=1;xe.MIDDLE=2;xe.SYSTEMFONT=0;xe.WEBFONT=1;xe.BITMAPFONT=2;xe._SYMBOL_COLOR=0;xe._SYMBOL_END_COLOR=1;xe.scaleImmediatelyUpdateText=true;xe.freezeScaleUpdateText=false;P.defineProperties(xe.prototype,{colorTint:{get:function(){return new yt(this.textPhaser.tint)},set:function(t){t=t||new yt(16777215);if(!(t instanceof yt))throw new Error("Expected qc.Color");this.textPhaser.tint=t.toNumber()}},autoSize:{get:function(){return this._autoSize},set:function(t){if(t===this._autoSize)return;this._autoSize=t;if(t&&this.textPhaser){this.width=this.textPhaser.width;this.height=this.textPhaser.height}}},fontFamily:{get:function(){return this._fontFamily},set:function(t){if(this._fontFamily===t)return;this._fontFamily=t;this._changeText("");this._isTransformDirty=true}},alignH:{get:function(){return this._alignH},set:function(t){if(t===this._alignH)return;this._alignH=t;if(t==0){this.textPhaser.boundsAlignH="left"}if(t==1){this.textPhaser.boundsAlignH="right"}if(t==2){this.textPhaser.boundsAlignH="center"}if(t==3){this.textPhaser.boundsAlignH="justify"}this.textPhaser.dirty=true;this._adjustTextPos();if(this._enableGlow){this.enableGlow=!this.enableGlow;this.enableGlow=!this.enableGlow}this._isTransformDirty=true}},alignV:{get:function(){return this._alignV},set:function(t){if(t===this._alignV)return;this._alignV=t;if(t==0){this.textPhaser.boundsAlignV="top"}if(t==2){this.textPhaser.boundsAlignV="middle"}if(t==1){this.textPhaser.boundsAlignV="bottom"}this.textPhaser.dirty=true;this._adjustTextPos();if(this._enableGlow){this.enableGlow=!this.enableGlow;this.enableGlow=!this.enableGlow}this._isTransformDirty=true}},font:{get:function(){var t=this.textPhaser.font.replace(/\'/g,"");if(this.fontFamily!==xe.SYSTEMFONT){return this.game.assets.find(this._fontKey||t)}return t},set:function(t){if(!t)return;var e=t;if(this.fontFamily!==xe.SYSTEMFONT){if(!(t instanceof pt.Font)){this.game.log.error("Expected qc.Font");return}if(this.fontFamily!==t._fontFamily){this.game.log.error("Invalid font asset");return}if(this.fontFamily===xe.WEBFONT){if(D.__wx&&t.wxFontName){e=t.wxFontName}else e=t.uuid;this._fontKey=t.uuid}else{e=t.url;this._fontKey=t.url}}else{if(typeof t!=="string"){this.game.log.error("Expected string");return}}if(e!==this.textPhaser.font){this._changeText(e);if(this.enableGlow){this._glowText.font=e}this._isTransformDirty=true}}},bold:{get:function(){return this.textPhaser.fontWeight!=="normal"},set:function(t){var e=t?"bold":"normal";if(e===this.textPhaser.fontWeight)return;this.textPhaser.fontWeight=e;if(this._enableGlow){this._glowText.fontWeight=e}this._isTransformDirty=true}},italic:{get:function(){return this.textPhaser.fontStyle!=="normal"},set:function(t){var e=t?"italic":"normal";if(e===this.textPhaser.fontStyle)return;this.textPhaser.fontStyle=e;if(this._enableGlow){this._glowText.fontStyle=e}this._isTransformDirty=true}},fontSize:{get:function(){return this.textPhaser.fontSize},set:function(t){if(typeof t!=="number")throw new Error("Expected number");if(t===this.textPhaser.fontSize)return;this.textPhaser.fontSize=t;if(this._enableGlow){this._glowText.fontSize=t}this._isTransformDirty=true;this._changeGradient(true)}},color:{get:function(){return new yt(this.colorfill)},set:function(t){if(!(t instanceof yt))throw new Error("Expected qc.Color");if(this._gradient){return}var e=t.toString("rgb");if(e===this.textPhaser.fill)return;this.textPhaser.tint=new yt(16777215).toNumber();this.colorfill=e;this.textPhaser.fill=e;this._isTransformDirty=true;this.textPhaser.dirty=true}},text:{get:function(){return this._data},set:function(t){if(typeof t!=="string")throw new Error("Expected string");if(t===this._data)return;this._colors=[];this._data=t;this._parseTextColor(t);this._setTextColor(this.textPhaser);if(this._enableGlow){this._glowText.text=this.textPhaser.text}this._isTransformDirty=true;this._changeGradient(true)}},lineSpacing:{get:function(){return this.textPhaser.lineSpacing},set:function(t){if(t===this.textPhaser.lineSpacing)return;this.textPhaser.lineSpacing=t;if(this._enableGlow){this._glowText.lineSpacing=t}this._isTransformDirty=true;this._changeGradient(true)}},lineHeight:{get:function(){return this.textPhaser.lineHeight},set:function(t){if(t===this.textPhaser.lineHeight)return;this.textPhaser.lineHeight=t;if(this._enableGlow){this._glowText.lineHeight=t}this._isTransformDirty=true}},letterSpacing:{get:function(){return this.textPhaser.letterSpacing},set:function(t){if(t===this.textPhaser.letterSpacing)return;this.textPhaser.letterSpacing=t;if(this._enableGlow){this._glowText.lineSpacing=t}this._isTransformDirty=true;this.textPhaser.dirty=true}},enableUnderline:{get:function(){return this.textPhaser.enableUnderline},set:function(t){if(t===this.textPhaser.enableUnderline)return;this.textPhaser.enableUnderline=t;this._isTransformDirty=true;this.textPhaser.dirty=true}},underlineColor:{get:function(){return this.textPhaser.underlineColor},set:function(t){if(t===this.textPhaser.underlineColor)return;this.textPhaser.underlineColor=t;this._isTransformDirty=true;this.textPhaser.dirty=true}},underlineWidth:{get:function(){return this.textPhaser.underlineWidth},set:function(t){if(t===this.textPhaser.underlineWidth)return;this.textPhaser.underlineWidth=t;this._isTransformDirty=true;this.textPhaser.dirty=true}},underlineSpacing:{get:function(){return this.textPhaser.underlineSpacing},set:function(t){if(t===this.textPhaser.underlineSpacing)return;this.textPhaser.underlineSpacing=t;this._isTransformDirty=true;this.textPhaser.dirty=true}},enableDeleteline:{get:function(){return this.textPhaser.enableDeleteline},set:function(t){if(t===this.textPhaser.enableDeleteline)return;this.textPhaser.enableDeleteline=t;this._isTransformDirty=true;this.textPhaser.dirty=true}},deletelineColor:{get:function(){return this.textPhaser.deletelineColor},set:function(t){if(t===this.textPhaser.deletelineColor)return;this.textPhaser.deletelineColor=t;this._isTransformDirty=true;this.textPhaser.dirty=true}},deletelineWidth:{get:function(){return this.textPhaser.deletelineWidth},set:function(t){if(t===this.textPhaser.deletelineWidth)return;this.textPhaser.deletelineWidth=t;this._isTransformDirty=true;this.textPhaser.dirty=true}},deletelineSpacing:{get:function(){return this.textPhaser.deletelineSpacing},set:function(t){if(t===this.textPhaser.deletelineSpacing)return;this.textPhaser.deletelineSpacing=t;this._isTransformDirty=true;this.textPhaser.dirty=true}},wrap:{get:function(){return this._wrap},set:function(t){if(t===this._wrap)return;this._wrap=t;this.textPhaser.wordWrap=t;this.textPhaser.useAdvancedWrap=true;this.textPhaser.style.wordWrap=this._wrap;this.textPhaser.dirty=true;if(this._enableGlow)this._glowText.wordWrap=t;this._isTransformDirty=true;this._changeGradient(true)}},overflow:{get:function(){var t=this.getScript("qc.NodeMask");if(!t||!t.enable)return false;return true},set:function(t){var e=this.getScript("qc.NodeMask");if(!e)e=this.addScript("qc.NodeMask");e.enable=t}},pivotX:{get:function(){return P.getOwnPropertyDescriptor(pt.Node.prototype,"pivotX").get.call(this)},set:function(t){P.getOwnPropertyDescriptor(pt.Node.prototype,"pivotX").set.call(this,t);if(this.textPhaser){this.textPhaser.dirty=true;this._adjustTextPos()}this._isTransformDirty=true}},pivotY:{get:function(){return P.getOwnPropertyDescriptor(pt.Node.prototype,"pivotY").get.call(this)},set:function(t){P.getOwnPropertyDescriptor(pt.Node.prototype,"pivotY").set.call(this,t);if(this.textPhaser){this.textPhaser.dirty=true;this._adjustTextPos()}this._isTransformDirty=true}},width:{get:function(){return P.getOwnPropertyDescriptor(pt.Node.prototype,"width").get.call(this)},set:function(t){if(t===this.width)return;P.getOwnPropertyDescriptor(pt.Node.prototype,"width").set.call(this,t);this._wrapWidth=t;if(this._enableGlow){this._glowText.wordWrapWidth=t;this._glowText.x=this.textPhaser.x;this._glowText.y=this.textPhaser.y;this._glowText.dirty=true}if(this.textPhaser){this.textPhaser.wordWrapWidth=t;this._adjustTextPos()}this._isTransformDirty=true}},height:{get:function(){return P.getOwnPropertyDescriptor(pt.Node.prototype,"height").get.call(this)},set:function(t){if(t===this.height)return;P.getOwnPropertyDescriptor(pt.Node.prototype,"height").set.call(this,t);this._wrapHeight=t;if(this.textPhaser){this.textPhaser.dirty=true;this.textPhaser.wordWrapHeight=t;this._adjustTextPos()}this._isTransformDirty=true}},class:{get:function(){return"qc.UIText"}},startColor:{get:function(){return new yt(this._startColor)},set:function(t){if(!(t instanceof yt))throw new Error("Expected qc.Color");var e=t.toString();this._startColor=e;this.textPhaser.dirty=true;this.textPhaser.startColor=e;this._changeGradient(true)}},endColor:{get:function(){return new yt(this._endColor)},set:function(t){if(!(t instanceof yt))throw new Error("Expected qc.Color");var e=t.toString();this._endColor=e;this.textPhaser.dirty=true;this.textPhaser.endColor=e;this._changeGradient(true)}},gradient:{get:function(){return this._gradient},set:function(t){if(t===this._gradient)return;this._gradient=t;this.textPhaser.dirty=true;this._isTransformDirty=true;this.textPhaser.gradient=t;this._changeGradient(true)}},gradientByLine:{get:function(){return this._gradientByLine},set:function(t){if(t===this._gradientByLine)return;this._gradientByLine=t;this.textPhaser.dirty=true;this._isTransformDirty=true;this.textPhaser.gradientByLine=t;this._changeGradient(true)}},stroke:{get:function(){return new yt(this.textPhaser.stroke)},set:function(t){if(!(t instanceof yt))throw new Error("Expected qc.Color");var e=t.toString();if(e===this.textPhaser.stroke)return;this.textPhaser.stroke=e;this._isTransformDirty=true}},strokeThickness:{get:function(){return this._strokeThickness},set:function(t){if(t===this._strokeThickness)return;this._strokeThickness=t;this.textPhaser.strokeThickness=t;if(this._enableGlow){this._glowText.strokeThickness=this.textPhaser.strokeThickness;this._glowText.dirty=true}this.textPhaser.shadowStroke=t>0&&this.enableShadow;this.textPhaser.dirty=true;this._isTransformDirty=true}},enableShadow:{get:function(){return this._enableShadow},set:function(t){this._enableShadow=t;this.textPhaser.shadowFill=t;this.textPhaser.shadowStroke=t&&this.strokeThickness>0;this.textPhaser.dirty=true;this._isTransformDirty=true}},shadowColor:{get:function(){return new yt(this.textPhaser.shadowColor)},set:function(t){if(!(t instanceof yt))throw new Error("Expected qc.Color");var e=t.toString();if(e===this.textPhaser.shadowColor)return;this.textPhaser.style.shadowColor=e;this.textPhaser.shadowColor=e;this.textPhaser.dirty=true;this._isTransformDirty=true}},shadowBlur:{get:function(){return this.textPhaser.shadowBlur},set:function(t){if(t===this.textPhaser.shadowBlur)return;this.textPhaser.style.shadowBlur=t;this.textPhaser.shadowBlur=t;this.textPhaser.dirty=true;this._isTransformDirty=true}},shadowOffsetX:{get:function(){return this.textPhaser.shadowOffsetX},set:function(t){this.textPhaser.shadowOffsetX=t;this.textPhaser.style.shadowOffsetX=t;this.textPhaser.dirty=true;this._isTransformDirty=true}},shadowOffsetY:{get:function(){return this.textPhaser.shadowOffsetY},set:function(t){this.textPhaser.shadowOffsetY=t;this.textPhaser.style.shadowOffsetY=t;this.textPhaser.dirty=true;this._isTransformDirty=true}},glowColor:{get:function(){return new yt(this._glowColor)},set:function(t){if(!(t instanceof yt))throw new Error("Expected qc.Color");var e=t.toString();if(e===this._glowColor)return;this._glowColor=e;if(this._glowText){this._glowText.fill=e;this._glowText.stroke=e;this._glowText.shadowColor=e;this._glowText.dirty=true}}},glowBlur:{get:function(){return this._glowBlur},set:function(t){if(t===this._glowBlur)return;this._glowBlur=t;if(this.enableGlow){this._glowText.filterX.blur=t;this._glowText.filterY.blur=t}}},enableGlow:{get:function(){return this._enableGlow},set:function(t){if(t===this._enableGlow)return;this._enableGlow=t;if(t){this._glowText=new dt.Text(this.game.phaser);this._glowText._nqc=this;this._copyProperty(this._glowText,this.textPhaser);this._glowText.x=this.textPhaser.x;this._glowText.y=this.textPhaser.y;this._glowText.fill=this._glowColor;this._glowText.stroke=this._glowColor;this._glowText.shadowColor=this._glowColor;this._glowText.underlineColor=this._glowColor;this._glowText.determineFontProperties=xe._phaserDetermineFontProperties;this.phaser.addChildAt(this._glowText,0);var e=new pt.Filter.BlurX(this.game);var i=new pt.Filter.BlurY(this.game);e.blur=this.glowBlur;i.blur=this.glowBlur;this._glowText.filters=[e,i];this._glowText.filterX=e;this._glowText.filterY=i}else{this.phaser.removeChild(this._glowText);this._glowText.destroy();this._glowText=null;this.textPhaser.dirty=true}this._isTransformDirty=true}},nativeSize:{get:function(){var t=this.rect;t.width=this.textRealWidth;t.height=this.textRealHeight;return t}}});xe.prototype._changeGradient=function(t){if(this._gradient){if(!this.gradientByLine){if(t||!this._grid){this._grid=this.textPhaser.context.createLinearGradient(0,0,0,this.textPhaser.height)}var e;var i=this.textPhaser.text;if(this.textPhaser.style.wordWrap){i=i.replace(/(?:\r\n|\r|\n)/g,"\n");e=this.textPhaser.runWordWrap(i,this.textPhaser.wordWrapWidth)}else{e=i.split(/(?:\r\n|\r|\n)/);for(var r=0;r<e.length-1;r++){e[r]+="\n"}}var a=1/e.length;this._grid.addColorStop(0,this.startColor);this._grid.addColorStop(1,this.endColor);this.textPhaser.fill=this._grid}}else{this.textPhaser.fill=this.color.toString()}};xe.prototype._changeText=function(t){var e=_t.BitmapText.fonts[t];var i;if(e){i=new dt.BitmapText(this.game.phaser,0,0,t);if(this._glowText)this._glowText.visible=false}else{i=new dt.Text(this.game.phaser);i.determineFontProperties=xe._phaserDetermineFontProperties;if(this._glowText){this._glowText.visible=true}}i.font=t;i._nqc=this;this.textPhaser.font=t;this._copyProperty(i,this.textPhaser);i.style.shadowFill=this.enableShadow;i.x=this.textPhaser.x;i.y=this.textPhaser.y;if(this._glowText){this._glowText.font=i.font}var r=this.phaser.getChildIndex(this.textPhaser);if(this.phaser.removeAt){this.phaser.removeAt(r)}else{this.phaser.removeChildAt(r)}if(this.phaser.addAt){this.phaser.addAt(i,r)}else{this.phaser.addChildAt(i,r)}this.textPhaser.destroy();this.textPhaser=i;this._isTransformDirty=true;this._setTextColor(this.textPhaser)};xe.prototype.setWidth=function(t){pt.Node.prototype.setWidth.call(this,t);this._wrapWidth=t;if(this.textPhaser){this.textPhaser.wordWrapWidth=t;this._adjustTextPos()}};xe.prototype.setHeight=function(t){pt.Node.prototype.setHeight.call(this,t);this._wrapHeight=t;if(this.textPhaser){this.textPhaser.dirty=true;this.textPhaser.wordWrapHeight=t;this._adjustTextPos()}};xe.prototype.postUpdate=function(){var t=this;var e=this.textPhaser;this._adjustTextPos();if(e.dirty){e.updateText()}};xe.prototype._copyProperty=function(t,e){t.align=e.align;t.boundsAlignH=e.boundsAlignH;t.boundsAlignV=e.boundsAlignV;t.fontWeight=e.fontWeight;t.fontSize=e.fontSize;t.lineSpacing=e.lineSpacing;t.lineHeight=e.lineHeight;t.letterSpacing=e.letterSpacing;t.enableUnderline=e.enableUnderline;t.underlineColor=e.underlineColor;t.underlineWidth=e.underlineWidth;t.underlineSpacing=e.underlineSpacing;t.enableDeleteline=e.enableDeleteline;t.deletelineColor=e.deletelineColor;t.deletelineWidth=e.deletelineWidth;t.deletelineSpacing=e.deletelineSpacing;t.wordWrap=this._wrap;t.name=e.name;t.scale=e.scale;t.pivot=e.pivot;t.rotation=e.rotation;t.alpha=e.alpha;t.visible=e.visible;t.renderable=e.renderable;t.mask=e.mask;t.text=e.text;t.wordWrapWidth=this._wrapWidth;t.wordWrapHeight=this._wrapHeight;t.stroke=e.stroke;t.strokeThickness=e.strokeThickness;t.shadowColor=e.shadowColor;t.shadowOffsetX=e.shadowOffsetX;t.shadowOffsetY=e.shadowOffsetY;t.shadowBlur=e.shadowBlur;t.fill=e.fill;t.fontFamily=this.fontFamily;t.fontWeight=e.fontWeight;t.fontStyle=e.fontStyle;t.font=e.font;t.gradient=e.gradient;t.startColor=e.startColor;t.endColor=e.endColor};xe.prototype._getColor=function(t){switch(t){case"red":return"#8d1d16";case"gray":return"#6a6a6a";case"gold":return"#fde67b";case"yellow":return"#f3e1a3";case"blue":return"#3e65c7";case"brown":return"#322310";case"green":return"#168d3d";case"light_green":return"#7fe39e";case"light_blue":return"#9ed4ec";case"light_red":return"#f86662";case"cyan":return"#52b1ff";case"black":return"#101010";case"gray2":return"#c0c0c0";case"orange":return"#f29f55";case"light_orange":return"#f2c440";case"orange2":return"#9d621c"}};xe.prototype._parseSymbol=function(t,e,i){var r={};r.result=false;if(t[e]!=="[")return r;var a=e;while(++a){if(t[a]==="["||a>=t.length||a-e>25){return r}if(t[a]==="]"){break}}var n=a-e;if(n>2&&t[e+1]==="#"){r.color=t.slice(e+1,a);r.result=true;r.type=xe._SYMBOL_COLOR}else if(n>6&&t[e+1]==="r"&&t[e+2]==="g"&&t[e+3]==="b"){r.color=t.slice(e+1,a);r.result=true;r.type=xe._SYMBOL_COLOR}else if(t[e+1]==="-"&&t[e+2]==="]"){if(i.length>0)r.result=true;r.type=xe._SYMBOL_END_COLOR}else if(n>=4){var s=t.slice(e+1,a);var o=this._getColor(s);if(o){r.color=o;r.result=true;r.type=xe._SYMBOL_COLOR}}if(r.result){r.pos=a}return r};xe.prototype._pushColor=function(t,e){var i={};i.color=t;i.pos=e;this._colors.push(i);this._isTransformDirty=true};xe.prototype._setTextColor=function(t){if(t.clearColors)t.clearColors();if(!t.addColor)return;for(var e=0;e<this._colors.length;e++){var i=this._colors[e].color==="defaultColor"?"defaultColor":this._colors[e].color;t.addColor(i,this._colors[e].pos)}this._isTransformDirty=true};xe.prototype._parseTextColor=function(t){t=t.replace(/(?:\r\n|\r|\n)/g,"\n");var e="";var i=[];for(var r=0;r<t.length;r++){var a=this._parseSymbol(t,r,i);if(a.result){r=a.pos;if(a.type===xe._SYMBOL_COLOR){i.push(a.color);this._pushColor(a.color,e.length)}else if(a.type===xe._SYMBOL_END_COLOR){i.pop();var n=i.length>0?i[i.length-1]:"defaultColor";this._pushColor(n,e.length)}}else e+=t[r]}this.textPhaser.text=e;this._isTransformDirty=true};xe.prototype.getMeta=function(){var t=M.prototype.getMeta.call(this);t.fontFamily=N.NUMBER;t.alignH=N.NUMBER;t.alignV=N.NUMBER;t.font=N.FONT;t.bold=N.BOOLEAN;t.italic=N.BOOLEAN;t.fontSize=N.NUMBER;t.color=N.COLOR;t.text=N.STRING;t.lineSpacing=N.NUMBER;t.lineHeight=N.NUMBER;t.letterSpacing=N.NUMBER;t.wrap=N.BOOLEAN;t.enableGlow=N.BOOLEAN;t.startColor=N.COLOR;t.endColor=N.COLOR;t.gradient=N.BOOLEAN;t.gradientByLine=N.BOOLEAN;t.stroke=N.COLOR;t.strokeThickness=N.NUMBER;t.glowColor=N.COLOR;t.autoSize=N.BOOLEAN;t.shadowColor=N.COLOR;t.shadowBlur=N.NUMBER;t.shadowOffsetX=N.NUMBER;t.shadowOffsetY=N.NUMBER;t.enableShadow=N.BOOLEAN;t.enableUnderline=N.BOOLEAN;t.underlineColor=N.COLOR;t.underlineWidth=N.NUMBER;t.underlineSpacing=N.NUMBER;t.enableDeleteline=N.BOOLEAN;t.deletelineColor=N.COLOR;t.deletelineWidth=N.NUMBER;t.deletelineSpacing=N.NUMBER;return t};xe.prototype._adjustTextPos=function(){this.textPhaser.x=-this.pivotX*this.width;this.textPhaser.y=-this.pivotY*this.height;this._isTransformDirty=true;return;var t=this.textPhaser.realWidth;var e=this.textPhaser.realHeight;if(this._alignH===xe.RIGHT){this.textPhaser.x=this.textPhaser.x+this.width-t}else if(this._alignH===xe.CENTER){this.textPhaser.x=this.textPhaser.x+(this.width-t)/2}if(this._alignV===xe.BOTTOM){this.textPhaser.y=this.textPhaser.y+this.height-e}else if(this._alignV===xe.MIDDLE){this.textPhaser.y=this.textPhaser.y+(this.height-e)/2}if(this._shiftCanvas){this.textPhaser.x-=this._shiftCanvas[0];this.textPhaser.y-=this._shiftCanvas[1]}if(this._enableGlow){this._glowText.x=this.textPhaser.x;this._glowText.y=this.textPhaser.y;this._glowText.dirty=true}};xe.prototype._refreshWebFont=function(t){if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)&&!/['",]/.exec(t)){t="'"+t+"'"}if(t===this.textPhaser.font){if(D.__wx)this.font=this.font;this.textPhaser.dirty=true;if(this._glowText){this._glowText.dirty=true}this._isTransformDirty=true}};xe._phaserUpdateText=function(){return;var t=!this._canvasMode;if(t)this.texture=_t.Text.drawSprite;var e=this._nqc;var i=this.canvas;var r=this.context;var a=e.getWorldScale();var n=e.game.device.desktop;var s=n?1920:Math.max(960,e.game.world.width);var o=n?1920:Math.max(960,e.game.world.height);var h=e.game.device.phaser.UCBrowser;this._worldScale=new pt.Point(a.x,a.y);var l=Math.max(.2,Math.min(10,Math.abs(a.x)));var u=Math.max(.2,Math.min(10,Math.abs(a.y)));var f=this.resolution=e.game.resolution;this.texture.baseTexture.resolution=f;this.texture.baseTexture.scaleMode=_t.scaleModes.NEAREST;r.font=this.style.font;var c=this.text;var p=e.width;if(this.style.wordWrap){c=c.replace(/(?:\r\n|\r|\n)/g,"\n");var d=this.runWordWrap(c,p)}else{var d=c.split(/(?:\r\n|\r|\n)/);for(var _=0;_<d.length-1;_++){d[_]+="\n"}}var g=e;var m=[];var y=0;var v=this.determineFontProperties(r.font).fontSize;for(var _=0;_<d.length;_++){var T=this._getWorldWidth(d[_]);m[_]=T;y=Math.max(y,T)}y=Math.ceil(y);var x=this.style.stroke?g._strokeThickness:0;var b=e.enableShadow?this.style.shadowOffsetX:0;var A=e.enableShadow?this.style.shadowOffsetY:0;var S=this.realWidth=y;this.realWidth=S;if(S*f*l>s)l=s/(S*f);var w=v;var P=w*d.length;var E=this.lineSpacing;if(E<0&&Math.abs(E)>w){E=-w}if(E!==0){var D=E*(d.length-1);P+=D}var C=this.realHeight=P;if(C*f*u>o)u=o/(C*f);g.textRealWidth=y;g.textRealHeight=P;var O=Math.min(l,u);b*=O*f;A*=O*f;this._shadowOffset=[b,A];var M=x*O*f/2;S=S*f*O+M+Math.max(Math.abs(b),M);C=C*f*O+M+Math.max(Math.abs(A),M);i.width=Math.max(Math.ceil(S),1);i.height=Math.max(Math.ceil(C),1);r.save();this._canvasDownScale=new pt.Point(1/O,1/O);r.scale(f*O,f*O);var I,R;I=R=M;if(b<0)I=Math.max(I,-b);if(A<0)R=Math.max(R,-A);I/=O*f;R/=O*f;e._shiftCanvas=[I,R];r.translate(I,R);var N=[];for(_=0;_<d.length;_++){var B=0;if(g._alignH===xe.RIGHT){B=this.realWidth-m[_]}else if(g._alignH===xe.CENTER){B=(this.realWidth-m[_])/2}N.push(B)}var L=0;if(g._alignV===xe.BOTTOM){L=this.realHeight-P}else if(g._alignV===xe.MIDDLE){L=(this.realHeight-P)/2}if(navigator.isCocoonJS){r.clearRect(0,0,this.realWidth,this.realHeight)}r.font=this.style.font;r.strokeStyle=this.style.stroke;r.textBaseline="middle";if(g.enableShadow){r.shadowOffsetX=b;r.shadowOffsetY=A;r.shadowColor=this.style.shadowColor;r.shadowBlur=this.style.shadowBlur}r.lineCap="round";r.lineJoin="round";r.lineWidth=x;this._charCount=0;var F;if(g._gradient){F=r.createLinearGradient(0,L,0,L+P*this.scale.y);var k=1/d.length;F.addColorStop(0,g._startColor);for(var _=1;_<d.length;_++){F.addColorStop(k*_,g._endColor);F.addColorStop(k*_,g._startColor)}F.addColorStop(1,g._endColor);r.fillStyle=F}else{r.fillStyle=this.style.fill}var U=r.fillStyle;var j=r.strokeStyle;var W;var V;for(_=0;_<d.length;_++){W=N[_];V=L+_*w+w/2;if(_>0){V+=E*_}if(this.colors.length>0){this.updateLine(d[_],W,V,r,x,U,j,w,F,h)}else{if(this.style.stroke&&x){this._clearShadowStyle(r);r.strokeText(d[_],W,V);this._restoreShadowStyle(r)}if(this.style.fill){if(F&&h){r.save();r.fillStyle="black";r.fillText(d[_],W,V);r.globalCompositeOperation="source-in";r.fillStyle=F;r.beginPath();r.rect(W,V-w/2,m[_],w);r.clip();r.fillRect(W,V-w/2,m[_],w);r.restore();if(pt.__IS_ANDROID_UC){var z=pt._tempCanvas;if(!z){z=pt._tempCanvas=document.createElement("canvas");z.width=128;z.height=128}r.drawImage(z,0,0,2,2,-5,-5,1,1)}}else{r.fillText(d[_],W,V)}}}}r.restore();this.updateTexture();if(t)this._uploadToRenderTexture();this.cachedTint=null;e._adjustTextPos();if(!e.game.renderInRenderTexture)this.getWorldTransform();this.dirty=false};xe._phaserDetermineFontProperties=function(t){var e=_t.Text.fontPropertiesCache[t];if(!e){e={};if(!_t.Text.fontPropertiesCanvas){_t.Text.fontPropertiesCanvas=_t.sharedCanvas;_t.Text.fontPropertiesContext=_t.Text.fontPropertiesCanvas.getContext("2d")}var i=_t.Text.fontPropertiesCanvas;var r=_t.Text.fontPropertiesContext;r.font=t;var a=Math.ceil(r.measureText("|MÉq").width);if(a===0)a=1;var n=Math.ceil(r.measureText("M").width);var s=2*n;if(s===0)s=1;n=n*1.4|0;i.width=a;i.height=s;r.fillStyle="#f00";r.fillRect(0,0,a,s);r.font=t;r.textBaseline="alphabetic";r.fillStyle="#000";r.fillText("|MÉq",0,n);var o=r.getImageData(0,0,a,s).data;var h=o.length;var l=a*4;var u,f;var c=0;var p=false;for(u=0;u<n;u++){for(f=0;f<l;f+=4){if(o[c+f]!==255){p=true;break}}if(!p){c+=l}else{break}}e.ascent=n-u;c=h-l;p=false;for(u=s;u>n;u--){for(f=0;f<l;f+=4){if(o[c+f]!==255){p=true;break}}if(!p){c-=l}else{break}}e.descent=u-n;e.fontSize=e.ascent+e.descent;_t.Text.fontPropertiesCache[t]=e}return e};var be=pt.Button=function(t,e,i){pt.UIImage.call(this,t,e,i);this.name="Button";this.onStateChange=new pt.Signal;var r=i!==C;if(r!==true){this.text=t.add.text(this);this.text.text="Button";this.text.name="Text";this.text.interactive=false;this.interactive=true;this.state=pt.UIState.NORMAL;var a=this.addScript("qc.TransitionBehaviour");a.target=this;this.width=120;this.height=40;this.text.setAnchor(new pt.Point(0,0),new pt.Point(1,1));this.text.left=0;this.text.right=0;this.text.top=0;this.text.bottom=0;this.text.alignH=xe.CENTER}var n=this;this.onDown.add(function(){if(n.state!==pt.UIState.DISABLED){n.state=pt.UIState.PRESSED}});this.onUp.add(function(){if(n.state===pt.UIState.PRESSED){n.state=pt.UIState.NORMAL}});this._onNativeElementClick=this._processNativeClick.bind(this)};be.prototype=P.create(pt.UIImage.prototype);be.prototype.constructor=be;P.defineProperties(be.prototype,{state:{get:function(){return this._state||pt.UIState.NORMAL},set:function(t){if(this.state===t)return;this._state=t;this.onStateChange.dispatch()}},colorTint:{get:function(){return P.getOwnPropertyDescriptor(pt.Node.prototype,"colorTint").get.call(this)},set:function(t){P.getOwnPropertyDescriptor(pt.Node.prototype,"colorTint").set.call(this,t);if(this.text)this.text.colorTint=t}},supportNativeEvent:{get:function(){return this._supportNativeEvent},set:function(t){if(t===this._supportNativeEvent){return}this._supportNativeEvent=t;this._checkNativeElement()}},onNativeClick:{get:function(){if(!this._onNativeClick){this._onNativeClick=new dt.Signal}return this._onNativeClick}},class:{get:function(){return"qc.Button"}}});be.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.UIImage.prototype.getMeta.call(this);e.text=t.NODE;e.state=t.NUMBER;e.supportNativeEvent=t.BOOLEAN;return e};be.prototype.update=function(t){if(this.isWorldVisible()&&this.supportNativeEvent){this._checkNativeElement();if(t)this._updateNativeElement()}else{this._removeNativeElement()}};be.prototype.onVisibleChange=function(){this.update(true)};be.prototype.onDestroy=function(){this._removeNativeElement();pt.UIImage.prototype.onDestroy.call(this)};be.prototype._checkNativeElement=function(){if(this.supportNativeEvent&&this.worldVisible&&!this._nativeElement){this._createNativeElement()}else if(this._nativeElement&&(!this.supportNativeEvent||!this.worldVisible)){this._removeNativeElement()}};be.prototype._createNativeElement=function(){var t=this;if(!t._nativeElement){var e=t._nativeElement=document.createElement("div");e.addEventListener("click",t._onNativeElementClick,false);e.addEventListener("touchstart",t._onNativeElementClick,false);var i=e.style;i.position="absolute";i.padding=0;i.margin=0;i.border=0;i.outline=0;i.background="none";t.game.world.frontDomRoot.appendChild(e);t._updateNativeElement();t.phaser.worldTransformChangedCallback=t._updateNativeElement.bind(t);t.phaser.worldTransformChangedContext=t}};be.prototype._removeNativeElement=function(){var t=this._nativeElement;if(t){this._nativeElement=null;t.removeEventListener("click",this._onNativeElementClick,false);t.removeEventListener("touchstart",this._onNativeElementClick,false);pt.Util.removeHTML(t)}};be.prototype._updateNativeElement=function(){var t=this,e=t._nativeElement;if(!e){return}e._lastUpdate=t.game.time.now;pt.Util.updateTransform(t,e)};be.prototype._processNativeClick=function(t){if(!this.worldVisible){this._checkNativeElement()}if(this._onNativeClick&&this._onNativeClick.getNumListeners()>0){this._onNativeClick.dispatch(this,t)}};var Ae=pt.Toggle=function(t,e,i){pt.Node.call(this,new dt.Group(t.phaser,null),e,i);this.name="Toggle";this.interactive=true;this.onStateChange=new pt.Signal;this.onValueChange=new pt.Signal;this.canValueChange=new pt.Signal;var r=i!==C;if(r!==true){this.background=t.add.image(this);this.background.name="Background";this.background.interactive=false;this.background.width=80;this.background.height=80;this.checkMark=t.add.image(this.background);this.checkMark.name="CheckMark";this.checkMark.interactive=false;this.text=t.add.text(this);this.text.text="Button";this.text.name="Text";this.text.interactive=false;this.on=false;this.state=pt.UIState.NORMAL;this.checkMark.pivotX=.5;this.checkMark.pivotY=.5;this.checkMark.setAnchor(new pt.Point(.5,.5),new pt.Point(.5,.5));this.checkMark.anchoredX=0;this.checkMark.anchoredY=0;this.checkMark.width=50;this.checkMark.height=50;this.text.x=this.background.width+5;this.text.height=this.background.height;var a=this.addScript("qc.TransitionBehaviour");a.target=this.background;a.transition=pt.Transition.TEXTURE_SWAP}var n=this;this.onDown.add(function(){if(n.state!==pt.UIState.DISABLED)n.state=pt.UIState.PRESSED});this.onUp.add(function(){if(n.state===pt.UIState.PRESSED)n.state=pt.UIState.NORMAL});this.onClick.add(function(){n.on=!n.on;n.checkMark.visible=n.on})};Ae.prototype=P.create(pt.Node.prototype);Ae.prototype.constructor=Ae;P.defineProperties(Ae.prototype,{on:{get:function(){return!!this._on},set:function(t){var e=this.on;var i={};this.canValueChange.dispatch(this,t,e,i);if(i.ignore)return;this._on=t;this.checkMark.visible=t;if(e!==t)this.onValueChange.dispatch(this)}},state:{get:function(){return this._state||pt.UIState.NORMAL},set:function(t){if(this.state===t)return;this._state=t;this.onStateChange.dispatch()}},class:{get:function(){return"qc.Toggle"}}});Ae.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.Node.prototype.getMeta.call(this);e.background=t.NODE;e.checkMark=t.NODE;e.text=t.NODE;e.on=R("on",t.BOOLEAN);e.state=R("state",t.NUMBER);return e};var Se=pt.Sound=function(t,e,i){this.soundPhaser=new dt.Sound(t.phaser);this.soundPhaser._qc=this;this._loop=false;this.game=t;pt.Node.call(this,new dt.Group(this.game.phaser,null),e,i);this.name="Sound";this._related();t.phaser.sound._sounds.push(this.soundPhaser);this._playOnAwake=false;this.destroyWhenStop=true};Se.prototype=P.create(pt.Node.prototype);Se.prototype.constructor=Se;P.defineProperties(Se.prototype,{loop:{get:function(){return this.soundPhaser.loop},set:function(t){this._loop=t;this.soundPhaser.loop=t;if(this.soundPhaser._sound){this.soundPhaser._sound.loop=t}}},audio:{get:function(){return this.audioUrl},set:function(t){if(!t)return;var e=this.audio;var i=this.soundPhaser;if(!t){if(D.__wx){if(e)this.game.assets.unload(e)}i.key=t;return}if(e&&e.key===t.key)return;var r=t.key;if(i&&i.key){var a=this.loop,n=this.mute,s=this.volume;i.destroy();if(D.__wx){if(e)this.game.assets.unload(e)}i=this.soundPhaser=new dt.Sound(this.game.phaser,r);i._qc=this;this._related();this.game.phaser.sound._sounds.push(i);this.loop=a;this.mute=n;this.volume=s}else{i.key=r;if(i.usingAudioTag){if(i.game.cache.getSound(r)&&i.game.cache.isSoundReady(r)){i._sound=i.game.cache.getSoundData(r);i.totalDuration=0;if(i._sound.duration){i.totalDuration=i._sound.duration}}else{i.game.cache.onSoundUnlock.add(i.soundHasUnlocked,i)}}}}},volume:{get:function(){return this.soundPhaser.volume},set:function(t){this.soundPhaser.volume=t}},playOnAwake:{get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},mute:{get:function(){return this.soundPhaser.mute},set:function(t){this.soundPhaser.mute=t}},destroyWhenStop:{get:function(){return this._destroyWhenStop||false},set:function(t){this._destroyWhenStop=t}},class:{get:function(){return"qc.Sound"}},isPlaying:{get:function(){return this.soundPhaser.isPlaying},set:function(t){if(t){this.soundPhaser.isPlaying=true;D.playSoundEff(this.audioUrl)}else{this.soundPhaser.isPlaying=false;D.stopSoundEff(this.audioUrl)}}},isPaused:{get:function(){return this.soundPhaser.paused}}});Se.prototype._dispatchAwake=function(){var t=this;M.prototype._dispatchAwake.call(t);if(!t.game.device.editor&&t.playOnAwake){t.play()}};Se.prototype._related=function(){var e=this;e.onDecoded=e.soundPhaser.onDecoded;e.onStop=e.soundPhaser.onStop;this.onStop.add(function(t){if(!e.game.device.editor&&e.destroyWhenStop){e.destroy()}},e);e.onLoop=e.soundPhaser.onLoop};Se.prototype.play=function(){if(this.isPaused){this.soundPhaser.resume();return this}if(this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio){this.soundPhaser._sound.onended=null}var t=this.marker?this.marker.name:null;this.soundPhaser.play(t);return this};Se.prototype.fadeIn=function(t){this.soundPhaser.fadeIn(t)};Se.prototype.fadeOut=function(t){this.soundPhaser.fadeOut(t)};Se.prototype.pause=function(){this.soundPhaser.pause()};Se.prototype.resume=function(){this.soundPhaser.resume()};Se.prototype.stop=function(){if(this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio){this.soundPhaser._sound.onended=null}this.soundPhaser.stop()};Se.prototype.addMarker=function(t,e,i){this.removeMarker();this.marker={};this.marker.name="s";this.marker.start=t;this.marker.duration=e;this.marker.volume=i;this.soundPhaser.addMarker(this.marker.name,t,e,i)};Se.prototype.removeMarker=function(){if(!this.marker){return}this.soundPhaser.currentMarker="";this.soundPhaser.markers={};this.marker=null};Se.prototype.onDestroy=function(){if(D.__wx){var t=this.audio;if(t)this.game.assets.unload(t)}this.game.phaser.sound.remove(this.soundPhaser);pt.Node.prototype.onDestroy.call(this)};Se.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.Node.prototype.getMeta.call(this);e.audioUrl=t.STRING;e.audio=t.AUDIO;e.loop=t.BOOLEAN;e.volume=t.NUMBER;e.playOnAwake=t.BOOLEAN;e.mute=t.BOOLEAN;e.destroyWhenStop=t.BOOLEAN;return e};var we=pt.Video=function(t,e,i){this.game=t;pt.Node.call(this,new dt.Group(this.game.phaser,null),e,i);this.name="video";this.keepLastFrame=false;this.canPlay=true;this.triggerNode=""};we.prototype=P.create(pt.Node.prototype);we.prototype.constructor=we;P.defineProperties(we.prototype,{url:{get:function(){return this.videoUrl},set:function(t){this.videoUrl=t}},class:{get:function(){return"qc.Video"}},isPlaying:{get:function(){return this.isVideoPlaying},set:function(t){this.isVideoPlaying=t;var e=pt.gameOb.world.children[0]._findByName("gamePlay").getScript("ps.VideoManager");if(typeof e==="undefined"){return}if(t){e.setVideoShow(this.uuid);if(!this.canPlay){e.setVideoPauseByTime(this.uuid,0);return}if(this.triggerNode!==""&&e.videoIsPlaying(this.uuid)){return}var i=this.startTime||0;var r=this.endTime||C;e.setVideoPlayByTime(this.uuid,i,r);e.setVideoMuted(this.uuid,this.muted);e.setVideoLoop(this.uuid,this.videoLoop)}else{if(this.triggerNode!==""&&e.videoIsPlaying(this.uuid)){return}if(!this.keepLastFrame&&!this.videoLoop){e.setVideoHide(this.uuid)}}}}});we.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.Node.prototype.getMeta.call(this);e.url=t.STRING;e.keepLastFrame=t.BOOLEAN;e.muted=t.BOOLEAN;e.videoLoop=t.BOOLEAN;e.startTime=t.NUMBER;e.endTime=t.NUMBER;e.cutVideo=t.BOOLEAN;e.canPlay=t.BOOLEAN;e.triggerNode=t.STRING;return e};var Pe=pt.ScrollView=function(t,e,i){pt.UIImage.call(this,t,e,i);this.name="ScrollView";this.canHorizontal=true;this.canVertical=true;this.movementType=Pe.MOVEMENT_ELASTIC;this.elasticity=1;this.inertia=true;this.decelerationRate=.03;this.scrollSensitivity=1;this.propagationScroll=false;this.onValueChange=new dt.Signal;this._contentRect=null;this._viewRect=null;this._preContentPosition=null;this._preContentRect=null;this._preViewRect=null;this._velocity=new pt.Point(0,0);this._isDragging=false;this.onWheel.add(this._doWheel,this);this.onDragStart.add(this._doDragStart,this);this.onDrag.add(this._doDrag,this);this.onDragEnd.add(this._doDragEnd,this)};Pe.prototype=P.create(pt.UIImage.prototype);Pe.prototype.constructor=Pe;P.defineProperties(Pe.prototype,{class:{get:function(){return"qc.ScrollView"}},content:{get:function(){if(this._content&&this._content._destroy){this._content=null}return this._content},set:function(t){this._content=t;this._updateBounds()}},horizontalScrollBar:{get:function(){if(this._horizontalScrollBar&&this._horizontalScrollBar._destroy){this._horizontalScrollBar=null}return this._horizontalScrollBar},set:function(t){if(this._horizontalScrollBar){this._horizontalScrollBar.onValueChange.remove(this._setHorizontalNormalizedPosition,this)}this._horizontalScrollBar=t;if(this._horizontalScrollBar){this._horizontalScrollBar.onValueChange.add(this._setHorizontalNormalizedPosition,this)}}},verticalScrollBar:{get:function(){if(this._verticalScrollBar&&this._verticalScrollBar._destroy){this._verticalScrollBar=null}return this._verticalScrollBar},set:function(t){if(this._verticalScrollBar){this._verticalScrollBar.onValueChange.remove(this._setVerticalNormalizedPosition,this)}this._verticalScrollBar=t;if(this._verticalScrollBar){this._verticalScrollBar.onValueChange.add(this._setVerticalNormalizedPosition,this)}}},horizontalNormalizedPosition:{get:function(){this._updateBounds();if(this._contentRect.width<=this._viewRect.width){return this._viewRect.x>this._contentRect.x?1:0}return(this._viewRect.x-this._contentRect.x)/(this._contentRect.width-this._viewRect.width)},set:function(t){this.setNormalizedPosition(t,0)}},verticalNormalizedPosition:{get:function(){this._updateBounds();if(this._contentRect.height<=this._viewRect.height){return this._viewRect.y>this._contentRect.y?1:0}return(this._viewRect.y-this._contentRect.y)/(this._contentRect.height-this._viewRect.height)},set:function(t){this.setNormalizedPosition(t,1)}}});Pe.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.UIImage.prototype.getMeta.call(this);e.content=t.NODE;e.canHorizontal=t.BOOLEAN;e.canVertical=t.BOOLEAN;e.movementType=t.NUMBER;e.elasticity=t.NUMBER;e.inertia=t.BOOLEAN;e.decelerationRate=t.NUMBER;e.scrollSensitivity=t.NUMBER;e.horizontalScrollBar=t.NODE;e.verticalScrollBar=t.NODE;e.propagationScroll=t.BOOLEAN;return e};Pe.prototype.onDestroy=function(){pt.UIImage.prototype.onDestroy.call(this);this.content=null;this.horizontalScrollBar=null;this.verticalScrollBar=null;this.phaser.mask=null};Pe.prototype.update=function(){};Pe.prototype.postUpdate=function(){this._updateVelocity()};Pe.prototype._setHorizontalNormalizedPosition=function(t){this.setNormalizedPosition(t,0)};Pe.prototype._setVerticalNormalizedPosition=function(t){this.setNormalizedPosition(t,1)};Pe.prototype._setContentPosition=function(t,e){this.content.x=t;this.content.y=e};Pe.prototype._calculateOffset=function(t,e){var i=new pt.Point(0,0);if(this.movementType===Pe.MOVEMENT_UNRESTRICTED){return i}var r=this.rect;var a=this._contentRect;var n=new pt.Point(a.x,a.y);var s=new pt.Point(a.x+a.width,a.y+a.height);if(this.canHorizontal){n.x+=t;s.x+=t;if(n.x>r.x){i.x=r.x-n.x}else if(s.x<r.x+r.width){i.x=r.x+r.width-s.x}}if(this.canVertical){n.y+=e;s.y+=e;if(n.y>r.y){i.y=r.y-n.y}else if(s.y<r.y+r.height){i.y=r.y+r.height-s.y}}return i};Pe.prototype._calcVelocityEffect=function(t,e,i,r){if(this.movementType===Pe.MOVEMENT_ELASTIC&&e[r]!==0){var a=this["_lastOffset_"+r]||0;if(Math.abs(a)<Math.abs(e[r])){this["_lastOffset_"+r]=e[r];this._currSmoothetTime=i}else{this["_lastOffset_"+r]=e[r];this._currSmoothetTime+=i}var n=this.elasticity<=0?i:this.elasticity;var s=this.game.math.smoothDamp(t[r],t[r]+e[r],this._velocity[r],this.elasticity,Number.MAX_VALUE,i/100);if(Math.abs(t[r]+e[r]-s[0])<1e-4){t[r]=t[r]+e[r];this._velocity[r]=0}else{t[r]=s[0];this._velocity[r]=s[1]}}else if(this.movementType===Pe.MOVEMENT_CLAMPED&&e[r]!==0){t[r]=t[r]+e[r]}else if(this.inertia){var o=this._velocity[r]*Math.pow(Math.abs(this.decelerationRate),i/1e3);if(Math.abs(o)<1){o=0}this._velocity[r]=o;t[r]=t[r]+o*i/1e3}else{this._velocity[r]=0}};Pe.prototype._rubberDelta=function(t,e){return(1-1/(Math.abs(t)*.55/e+1))*e*this.game.math.sign(t)};Pe.prototype._updateVelocity=function(){if(!this.content){return}var t=this.game.time.deltaTime;var e=this._calculateOffset(0,0);var i=new pt.Point(this.content.x,this.content.y);if(!this._isDragging&&(e.x!==0||e.y!==0||(this._velocity.x!==0||this._velocity.y!==0))){this._updateBounds();this._calcVelocityEffect(i,e,t,"x");this._calcVelocityEffect(i,e,t,"y");if(this._velocity.x!==0||this._velocity.y!==0){if(this.movementType===Pe.MOVEMENT_CLAMPED){e=this._calculateOffset(i.x-this.content.x,i.y-this.content.y);i.x+=e.x;i.y+=e.y}}this._setContentPosition(i.x,i.y)}if(this._isDragging&&this.inertia){this._updateBounds();var r=this.content.x-this._preContentPosition.x;var a=this.content.y-this._preContentPosition.y;var n=this.game.math.clamp(t/1e3,0,1);this._velocity.x=r/n;this._velocity.y=a/n}if(!this._preViewRect||!pt.Rectangle.equals(this._viewRect,this._preViewRect)||!this._preContentRect||!pt.Rectangle.equals(this._contentRect,this._preContentRect)||!this._preContentPosition||!pt.Point.equals(this._preContentPosition,i)){this._updateScrollBars(e.x,e.y);this.onValueChange.dispatch(new pt.Point(this.horizontalNormalizedPosition,this.verticalNormalizedPosition));this._updatePrevData()}};Pe.prototype.setNormalizedPosition=function(t,e){this._updateBounds();if(!this.content||!this._contentRect){return}var i=e?"height":"width";var r=e?"y":"x";var a=this._contentRect[i]-this._viewRect[i];var n=this._viewRect[r]-t*a;var s=this.content[r]+n-this._contentRect[r];var o=this.content[r];if(Math.abs(o-s)>1){this.content[r]=s;this._velocity[r]=0;this._updateBounds()}};Pe.prototype._updatePrevData=function(){if(this.content){this._preContentPosition=new pt.Point(this.content.x,this.content.y)}else{this._preContentPosition=new pt.Point(0,0)}this._preContentRect=this._contentRect;this._preViewRect=this._viewRect};Pe.prototype._updateScrollBars=function(t,e){if(this.horizontalScrollBar){if(this._contentRect.width>0){var i=(this._viewRect.width-Math.abs(t))/this._contentRect.width;this.horizontalScrollBar.size=dt.Math.clamp(i,0,1)}else{this.horizontalScrollBar.size=1}this.horizontalScrollBar.value=this.horizontalNormalizedPosition}if(this.verticalScrollBar){if(this._contentRect.height>0){var i=(this._viewRect.height-Math.abs(e))/this._contentRect.height;this.verticalScrollBar.size=dt.Math.clamp(i,0,1)}else{this.verticalScrollBar.size=1}this.verticalScrollBar.value=this.verticalNormalizedPosition}};Pe.prototype._updateBounds=function(){this._viewRect=this.rect;this._updateContentBounds();if(!this.content)return;var t=this.rect;var e=t.width-this._contentRect.width;var i=t.height-this._contentRect.height;if(e>0){this._contentRect.width=t.width;this._contentRect.x-=e*this.content.pivotX}if(i>0){this._contentRect.height=t.height;this._contentRect.y-=i*this.content.pivotY}};Pe.prototype._updateContentBounds=function(){if(!this.content){this._contentRect=new pt.Rectangle(0,0,0,0);return}this._contentRect=pt.Bounds.getBox(this.content,pt.Bounds.USE_BOUNDS,false,1,this)};Pe.prototype._doWheel=function(t,e){if(!this.content){return}this._updateBounds();var i=new pt.Point(e.source.deltaX,e.source.deltaY);if(!this.canVertical){i.y=0}if(!this.canHorizontal){i.x=0}var r=i.x*this.scrollSensitivity;var a=i.y*this.scrollSensitivity;this.doScroll(r,a,false)};Pe.prototype._doDragStart=function(t,e){if(e.source.eventId!==pt.Mouse.BUTTON_LEFT){return}this._updateBounds();this._contentStartPosition=new pt.Point(this.content.x,this.content.y);this._pointerStartCursor=this.toLocal(new pt.Point(e.source.startX,e.source.startY));this._isDragging=true};Pe.prototype._doDragEnd=function(t,e){if(e.source.eventId!==pt.Mouse.BUTTON_LEFT){return}this._isDragging=false};Pe.prototype._doDrag=function(t,e){if(e.source.eventId!==pt.Mouse.BUTTON_LEFT){return}this._updateBounds();var i=this.toLocal(new pt.Point(e.source.x,e.source.y));if(!this._pointerStartCursor)return;var r=this.canHorizontal?i.x-this._pointerStartCursor.x:0;var a=this.canVertical?i.y-this._pointerStartCursor.y:0;this.doScroll(this._contentStartPosition.x+r-this.content.x,this._contentStartPosition.y+a-this.content.y,true)};Pe.prototype.doScroll=function(t,e,i){var r=new pt.Point(this.content.x,this.content.y);r.x+=t;r.y+=e;var a=this._calculateOffset(t,e);r.x+=a.x;r.y+=a.y;if(this.movementType===Pe.MOVEMENT_CLAMPED&&this.propagationScroll){var n=this.parent;while(!(n instanceof Pe)&&n!==this.game.world){n=n.parent}if(n instanceof Pe){n.doScroll(-a.x,-a.y,i)}}else if(this.movementType===Pe.MOVEMENT_ELASTIC){if(i){if(a.x!==0){r.x=r.x-this._rubberDelta(a.x,this._viewRect.width)}if(a.y!==0){r.y=r.y-this._rubberDelta(a.y,this._viewRect.height)}}else{r.x-=a.x;r.y-=a.y;if(Math.abs(a.x)>this._viewRect.width){r.x+=a.x-this.game.math.sign(a.x)*this._viewRect.width}if(Math.abs(a.y)>this._viewRect.height){r.y+=a.y-this.game.math.sign(a.y)*this._viewRect.height}}}this._setContentPosition(r.x,r.y);if(!i){this._updateBounds()}};Pe.MOVEMENT_UNRESTRICTED=0;Pe.MOVEMENT_ELASTIC=1;Pe.MOVEMENT_CLAMPED=2;var Ee=pt.ScrollBar=function(t,e,i){pt.UIImage.call(this,t,e,i);this.name="ScrollBar";this.autoHide=false;this._setValue(0,false);this.onWheel.add(this._doWheel,this);this.onDown.add(this._doDown,this);this.onUp.add(this._doUp,this);this.onDragStart.add(this._doDragStart,this);this.onDrag.add(this._doDrag,this);this.onDragEnd.add(this._doDragEnd,this)};Ee.prototype=P.create(pt.UIImage.prototype);Ee.prototype.constructor=Ee;P.defineProperties(Ee.prototype,{class:{get:function(){return"qc.ScrollBar"}},sliders:{get:function(){if(this._sliders&&this._sliders._destroy){this._sliders=null}return this._sliders},set:function(t){this._sliders=t;this._updateSliders()}},direction:{get:function(){return this._direction||Ee.LEFT_TO_RIGHT},set:function(t){this._setDirection(t,false)}},value:{get:function(){return this._value},set:function(t){this._setValue(t,true)}},size:{get:function(){return this._size},set:function(t){var e=dt.Math.clamp(t,0,1);this.visible=!(this.autoHide&&this.game.math.fuzzyEqual(e,1));if(this.visible&&!this.fixSlidersSize){this._size=e;this._size=Math.max(5/Math.max(this.height,this.width),this._size);this._updateSliders()}}},numberOfStep:{get:function(){return this._numberOfStep},set:function(t){this._numberOfStep=t}},onValueChange:{get:function(){if(!this._onValueChange){this._onValueChange=new dt.Signal}return this._onValueChange}},stepSize:{get:function(){return this.numberOfStep>1?1/(this.numberOfStep-1):.1}},fixSlidersSize:{get:function(){return this._fixSlidersSize},set:function(t){this._fixSlidersSize=t}},_axisPos:{get:function(){return this.direction===Ee.LEFT_TO_RIGHT||this.direction===Ee.RIGHT_TO_LEFT?"x":"y"}},_axisSize:{get:function(){return this.direction===Ee.LEFT_TO_RIGHT||this.direction===Ee.RIGHT_TO_LEFT?"width":"height"}},_reverseValue:{get:function(){return this.direction===Ee.RIGHT_TO_LEFT||this.direction===Ee.BOTTOM_TO_TOP}},_slidingRect:{get:function(){if(!this.sliders||!this.sliders.parent)return null;else return this.sliders.parent.rect}}});Ee.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.UIImage.prototype.getMeta.call(this);e.sliders=t.NODE;e.value=t.NUMBER;e.size=t.NUMBER;e.numberOfStep=t.NUMBER;e.direction=t.NUMBER;e.fixSlidersSize=t.BOOLEAN;e.autoHide=t.BOOLEAN;return e};Ee.prototype.onDestroy=function(){pt.UIImage.prototype.onDestroy.call(this);this.sliders=null};Ee.prototype._setDirection=function(t,e){if(this._direction===t)return;var i=this._axisPos;var r=this._reverseValue;this._direction=t;if(e&&i!=this._axisPos){var a=this.width;this.width=this.height;this.height=a}this._updateSliders()};Ee.prototype._setValue=function(t,e){var i=this._value;this._value=dt.Math.clamp(t,0,1);if(i===this.value){return}this._updateSliders();if(e){this.onValueChange.dispatch(this.value)}};Ee.prototype.postUpdate=function(){if(this._isMoveNotDragging){this._doPursued()}};Ee.prototype._updateSliders=function(){if(!this._slidingRect){return}var t=new pt.Point(0,0);var e=new pt.Point(1,1);var i=this.value*(1-this.size);var r=this._axisPos;if(this._reverseValue){t[r]=1-i-this.size;e[r]=1-i}else{t[r]=i;e[r]=i+this.size}this.sliders.setAnchor(t,e,false)};Ee.prototype._getSlidersRectInBar=function(){var t=this.sliders.minAnchor;var e=this.sliders.maxAnchor;var i=this._slidingRect;var r=i.width*t.x;var a=i.height*t.y;var n=i.width*(e.x-t.x);var s=i.height*(e.y-t.y);var o=i.width/this.rect.width;var h=i.height/this.rect.height;return new pt.Rectangle(this.rect.x+r*o,this.rect.y+a*h,n*o,s*h)};Ee.prototype._getSlidersPointInBar=function(t){var e=this.sliders.minAnchor;var i=this.sliders.maxAnchor;var r=this._slidingRect;var a=this.sliders.rect.width/r.width;var n=this.sliders.rect.height/r.height;var s=r.width*e.x+t.x*a;var o=r.height*e.y+t.y*n;var h=r.width/this.rect.width;var l=r.height/this.rect.height;return new pt.Point(this.rect.x+s*h,this.rect.y+o*l)};Ee.prototype._doPursued=function(){var t=this._getSlidersRectInBar();var e=this._axisPos;var i=this._axisSize;if(this._pursuedPoint>=t[e]&&this._pursuedPoint<=t[e]+t[i]){this._isMoveNotDragging=false;this._offset=this._pursuedPoint-t[e]-t[i]/2;this._pursuedPoint=0;this._pursuedType=0;return}if(this._pursuedPoint<t[e]^this._reverseValue){if(this._pursuedType!==2){this.value-=this.stepSize;this._pursuedType=1}}else{if(this._pursuedType!==1){this.value+=this.stepSize;this._pursuedType=2}}};Ee.prototype._doDown=function(t,e){if(!this.sliders||e.source.eventId!=pt.Mouse.BUTTON_LEFT){return}var i=new pt.Point(e.source.x,e.source.y);if(!this.sliders.rectContains(i)){var r=this.toLocal(i);this._isMoveNotDragging=true;this._pursuedPoint=r[this._axisPos];this._pursuedType=0}};Ee.prototype._doUp=function(t,e){this._isMoveNotDragging=false};Ee.prototype._doDragStart=function(t,e){if(!this.sliders||e.source.eventId!=pt.Mouse.BUTTON_LEFT){return}this._isMoveNotDragging=false;var i=new pt.Point(e.source.x,e.source.y);var r=this.toLocal(i);var a=this._getSlidersRectInBar();var n=this._axisPos;var s=this._axisSize;this._offset=r[n]-a[n]-a[s]/2};Ee.prototype._doDragEnd=function(t,e){this._isMoveNotDragging=false};Ee.prototype._doDrag=function(t,e){if(!this.sliders||e.source.eventId!=pt.Mouse.BUTTON_LEFT){return}var i=new pt.Point(e.source.x,e.source.y);var r=this.toLocal(i);var a=this._getSlidersRectInBar();var n=this._axisPos;var s=this._axisSize;var o=r[n]-this._offset-this.rect[n]-a[s]/2;var h=this.rect[s]*(1-this.size);switch(this.direction){case Ee.LEFT_TO_RIGHT:case Ee.TOP_TO_BOTTOM:this._setValue(o/h,true);break;case Ee.RIGHT_TO_LEFT:case Ee.BOTTOM_TO_TOP:this._setValue(1-o/h,true);break}};Ee.prototype._doWheel=function(t,e){if(!this.sliders){return}var i=e.source["delta"+this._axisPos.toUpperCase()];var r=this.value;r+=(this._reverseValue?-1:1)*Math.sign(i)*this.stepSize;this._setValue(r,true)};Ee.LEFT_TO_RIGHT=0;Ee.RIGHT_TO_LEFT=1;Ee.TOP_TO_BOTTOM=2;Ee.BOTTOM_TO_TOP=3;var De=pt.ProgressBar=function(t,e,i){pt.UIImage.call(this,t,e,i);this.name="ProgressBar";this.style=De.STYLE_HORIZONTAL;this.value=0;this.minValue=0;this.maxValue=1;this.indeterminable=false;this.loopTime=3e3;this.numberOfStep=0;this.fixedSize=-1;this._canSlideOut=true;this.clipSliders=false;this.showMode=De.SHOW_PROCESSED;this.reverse=false};De.prototype=P.create(pt.UIImage.prototype);De.prototype.constructor=De;P.defineProperties(De.prototype,{class:{get:function(){return"qc.ProgressBar"}},style:{get:function(){return this._style},set:function(t){this._setStyle(t)}},sliders:{get:function(){if(this._sliders&&this._sliders._destroy){this._sliders=null}return this._sliders},set:function(t){this._sliders=t;this._updateSliders()}},indeterminable:{get:function(){return this._indeterminable},set:function(t){this._indeterminable=t}},minValue:{get:function(){return isNaN(this._minValue)||this._minValue===null?0:this._minValue},set:function(t){this.setMinMax(t)}},maxValue:{get:function(){return isNaN(this._maxValue)||this._maxValue===null?1:this._maxValue},set:function(t){this.setMinMax(null,t)}},length:{get:function(){return this.maxValue-this.minValue}},stepValue:{get:function(){var t=this.stepSize;if(t>0){return this.minValue+Math.round((this.value-this.minValue)/t)*t}else{return this.value}},set:function(t){var e=this.stepSize;if(e>0){this._setValue(this.minValue+Math.round((t-this.minValue)/e)*e,true)}else{this._setValue(t)}}},value:{get:function(){return this._value||0},set:function(t){if(t!==this._value){this._setValue(t,true)}}},loopTime:{get:function(){return this._loopTime},set:function(t){this._loopTime=t}},numberOfStep:{get:function(){return this._numberOfStep},set:function(t){this._numberOfStep=t}},stepSize:{get:function(){if(this.numberOfStep>1){return this.length/(this.numberOfStep-1)}else if(this.style===De.STYLE_CIRCLE){return this.length/360}else if(this.style===De.STYLE_HORIZONTAL){return this.length/(this._slidingRect?this._slidingRect.width:this.width)}else{return this.length/(this._slidingRect?this._slidingRect.height:this.height)}}},fixedSize:{get:function(){return this._fixedSize},set:function(t){if(this._fixedSize===t){return}this._fixedSize=t;this._updateSliders()}},onValueChange:{get:function(){if(!this._onValueChange){this._onValueChange=new dt.Signal}return this._onValueChange}},clipSliders:{get:function(){if(!this.sliders){return false}var t=this.sliders.getScript(pt.NodeMask);return t&&t.enable},set:function(t){this._setClipSliders(t)}},showMode:{get:function(){return this._showMode},set:function(t){this._setShowMode(t)}},reverse:{get:function(){return this._reverse},set:function(t){this._reverse=t;this._updateSliders()}},startRadian:{get:function(){return this._startRadian||0},set:function(t){this.setCircleScope(t)}},endRadian:{get:function(){return this._endRadian||Math.PI*2},set:function(t){this.setCircleScope(null,t)}},startAngle:{get:function(){return this.startRadian*180/Math.PI},set:function(t){this.setCircleAngle(t)}},endAngle:{get:function(){return this.endRadian*180/Math.PI},set:function(t){this.setCircleAngle(null,t)}},showRadian:{get:function(){return this.endRadian-this.startRadian}},_slidingRect:{get:function(){if(!this.sliders||!this.sliders.parent)return null;else return this.sliders.parent.rect}},_axisPos:{get:function(){return this.style===De.STYLE_CIRCLE?"rotation":this.style===De.STYLE_HORIZONTAL?"x":"y"}},_axisSize:{get:function(){return this.style===De.STYLE_CIRCLE?"rotation":this.style===De.STYLE_HORIZONTAL?"width":"height"}}});De.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.UIImage.prototype.getMeta.call(this);e.style=pt.Serializer.NUMBER;e.sliders=pt.Serializer.NODE;e._minValue=pt.Serializer.NUMBER;e._maxValue=pt.Serializer.NUMBER;e.value=pt.Serializer.NUMBER;e._startRadian=pt.Serializer.NUMBER;e._endRadian=pt.Serializer.NUMBER;e.indeterminable=pt.Serializer.BOOLEAN;e.loopTime=pt.Serializer.NUMBER;e.numberOfStep=pt.Serializer.NUMBER;e.fixedSize=pt.Serializer.NUMBER;e.showMode=pt.Serializer.NUMBER;e.reverse=pt.Serializer.NUMBER;return e};De.prototype.onDestroy=function(){pt.UIImage.prototype.onDestroy.call(this);this.sliders=null};De.prototype._resetSliders=function(){if(!this.sliders){return}this.sliders.rotation=0;this.sliders.setAnchor(new pt.Point(0,0),new pt.Point(1,1),false);var t=this.sliders.getScript(pt.NodeMask);if(t){t.setMask(new pt.Point(0,0),new pt.Point(1,1),0,Math.PI*2)}};De.prototype._setStyle=function(t){if(this._style===t)return;this._style=t;this._resetSliders();this._updateSliders()};De.prototype._setClipSliders=function(t){if(this.clipSliders===t)return;if(this.sliders){this._resetSliders();var e=this.sliders.getScript(pt.NodeMask);if(!e&&t){e=this.sliders.addScript("qc.NodeMask")}if(e){e.enable=t}}this._updateSliders()};De.prototype._setShowMode=function(t){if(this._showMode===t){return}this._showMode=t;if(this.sliders){this._resetSliders()}this._updateSliders()};De.prototype.update=function(){if(this._indeterminable){this._processIndeterminable()}};De.prototype.setMinMax=function(t,e){t=typeof t==="undefined"||t===null?this.minValue:t;e=typeof e==="undefined"||e===null?this.maxValue:e;if(t>=e){throw new Error("Expected:min < max")}this._minValue=t;this._maxValue=e;this._setValue(this.value,true)};De.prototype.setCircleScope=function(t,e){t=typeof t==="undefined"||t===null?this.startRadian:t;e=typeof e==="undefined"||e===null?this.endRadian:e;if(t>=e||e>t+Math.PI*2){throw new Error("Expected:start < end and end <= 2*PI + start")}this._startRadian=t;this._endRadian=e;this._updateSliders()};De.prototype.setCircleAngle=function(t,e){t=typeof t==="undefined"||t===null?this.startAngle:t;e=typeof e==="undefined"||e===null?this.endAngle:e;if(t>=e||e>t+360){throw new Error("Expected:start < end and end <= 360 + start")}this._startRadian=t*Math.PI/180;this._endRadian=e*Math.PI/180;this._updateSliders()};De.prototype._setValue=function(t,e){var i=this.stepValue;this._value=dt.Math.clamp(t,this.minValue,this.maxValue);if(i!==this.stepValue){this._updateSliders()}if(e){this.onValueChange.dispatch(this.value)}};De.prototype._processIndeterminable=function(){this._loopValue=this._loopValue||this.value;this._loopValue+=this.length*this.game.time.deltaTime/this.loopTime;if(this._loopValue>this.maxValue+this.stepSize){this._loopValue=this.minValue}this.value=this._loopValue};De.prototype._updateSliders=function(){if(!this._slidingRect){return}var t=this.sliders.getScript(pt.NodeMask);var e=(this.stepValue-this.minValue)/this.length;if(this.reverse){e=1-e}if(!this.clipSliders||!t){switch(this.style){case De.STYLE_HORIZONTAL:case De.STYLE_VERTICAL:var i=new pt.Point(0,0);var r=new pt.Point(1,1);var a=this._axisPos;if(this.fixedSize>=0){if(this._canSlideOut){e*=1+this.fixedSize;r[a]=Math.min(1,e);i[a]=Math.max(0,e-this.fixedSize-1e-5)}else{e*=1-this.fixedSize;i[a]=Math.max(0,e);r[a]=Math.min(1,e+this.fixedSize+1e-5)}}else{if(this.showMode===De.SHOW_PROCESSED){r[a]=Math.max(1e-5,Math.min(1,e))}else{i[a]=Math.min(1-1e-5,e)}}this.sliders.setAnchor(i,r,false);break;case De.STYLE_CIRCLE:this.sliders.rotation=e*this.showRadian+this.startRadian;break}}else{switch(this.style){case De.STYLE_HORIZONTAL:case De.STYLE_VERTICAL:var i=new pt.Point(0,0);var r=new pt.Point(1,1);var a=this._axisPos;if(this.fixedSize>=0){if(this._canSlideOut){e*=1+this.fixedSize;r[a]=Math.min(1,e);i[a]=Math.max(0,e-this.fixedSize-1e-5)}else{e*=1-this.fixedSize;i[a]=Math.max(0,e);r[a]=Math.min(1,e+this.fixedSize+1e-5)}}else{if(this.showMode===De.SHOW_PROCESSED){r[a]=Math.min(1,e)}else{i[a]=Math.min(1,e)}}t.setMask(i,r);break;case De.STYLE_CIRCLE:if(this.fixedSize>=0){var n=this.startRadian+(e-this.fixedSize)*this.showRadian;var s=this.startRadian+e*this.showRadian;if(this.showMode===De.SHOW_REMAINED&&this.showRadian===Math.PI*2){var o=s;s=n+Math.PI*2;n=o}t.setMask(null,null,n,s)}else{var n=-Math.PI/2+this.startRadian;var s=-Math.PI/2+this.endRadian;if(this.showMode===De.SHOW_PROCESSED){s=n+e*this.showRadian}else{n=n+e*this.showRadian}t.setMask(null,null,n,s)}break}}};De.STYLE_HORIZONTAL=0;De.STYLE_VERTICAL=1;De.STYLE_CIRCLE=2;De.SHOW_PROCESSED=0;De.SHOW_REMAINED=1;var Ce=pt.Slider=function(t,e,i){pt.ProgressBar.call(this,t,e,i);this.name="Slider";this.canPursue=true;this._canSlideOut=false;this.onWheel.add(this._doWheel,this);this.onDown.add(this._doDown,this);this.onUp.add(this._doUp,this);this.onDragStart.add(this._doDragStart,this);this.onDrag.add(this._doDrag,this);this.onDragEnd.add(this._doDragEnd,this);var r=i!==C;if(r!==true){this.state=pt.UIState.NORMAL;var a=this.addScript("qc.TransitionBehaviour");a.target=this.sliders;a.transition=pt.Transition.TEXTURE_SWAP}};Ce.prototype=P.create(pt.ProgressBar.prototype);Ce.prototype.constructor=Ce;P.defineProperties(Ce.prototype,{state:{get:function(){return this._state||pt.UIState.NORMAL},set:function(t){if(this.state===t)return;this._state=t;if(this._onStateChange){this._onStateChange.dispatch()}}},sliders:{get:function(){if(this._sliders&&this._sliders._destroy){this._sliders=null}return this._sliders},set:function(t){this._sliders=t;var e=this.getScript("qc.TransitionBehaviour");if(e){e.target=t?t:this}this._updateSliders()}},onStateChange:{get:function(){if(!this._onStateChange){this._onStateChange=new pt.Signal}return this._onStateChange}},class:{get:function(){return"qc.Slider"}},canPursue:{get:function(){return this._canPursue},set:function(t){this._canPursue=t}},interactive:{get:function(){return this._interactive},set:function(t){this._interactive=t;if(this._onInteractive){this._onInteractive.dispatch()}this.state=this.interactive?pt.UIState.NORMAL:pt.UIState.DISABLED}}});Ce.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.ProgressBar.prototype.getMeta.call(this);e.canPursue=pt.Serializer.BOOLEAN;return e};Ce.prototype.update=function(){pt.ProgressBar.prototype.update.call(this);if(this._isMoveNotDragging&&this._canPursue){this._doPursued()}};Ce.prototype._setStyle=function(t){pt.ProgressBar.prototype._setStyle.call(this,t);this.fixedSize=t===Ce.STYLE_CIRCLE?0:-1};Ce.prototype._calcPointValue=function(t,e){var i=0;var r=this.rect;switch(this.style){case Ce.STYLE_HORIZONTAL:case Ce.STYLE_VERTICAL:i=this.minValue+(t[this._axisPos]-r[this._axisPos])*this.length/r[this._axisSize];break;case Ce.STYLE_CIRCLE:var a=2*Math.PI;var n=Math.atan2(t.x-r.centerX,r.centerY-t.y);if(n<0){n+=a}if(e){if(typeof this._tempDragAngle==="undefined"||this._tempDragAngle===null){this._tempDragAngle=n;this._recordDragAngle=n}else{var s=n-this._tempDragAngle;this._tempDragAngle=n;if(Math.abs(s)>Math.PI){s=dt.Math.sign(s)*(a-Math.abs(s))}this._recordDragAngle+=s;n=this._recordDragAngle}}i=this.minValue+(n-this.startRadian)*this.length/this.showRadian;break}if(this.reverse){i=this.maxValue-i+this.minValue}return i};Ce.prototype._doWheel=function(t,e){if(!this.sliders){return}var i=Math.abs(e.source.deltaX)>=Math.abs(e.source.deltaY)?e.source.deltaX:e.source.deltaY;var r=this.value;r+=(this.reverse?-1:1)*Math.sign(i)*this.stepSize;this.value=r};Ce.prototype._doDown=function(t,e){if(!this.sliders||e.source.eventId!=pt.Mouse.BUTTON_LEFT){return}this.state=pt.UIState.PRESSED;this._tempDragAngle=null;this._recordDragAngle=null;var i=new pt.Point(e.source.x,e.source.y);if(!this.sliders.rectContains(i)||this.fixedSize<0){var r=this.toLocal(i);this._isMoveNotDragging=true;this._pursuedPoint=this._calcPointValue(r);this._pursuedType=0}};Ce.prototype._doUp=function(t,e){this._isMoveNotDragging=false;if(this.state===pt.UIState.PRESSED){this.state=pt.UIState.NORMAL}};Ce.prototype._doDragStart=function(t,e){if(!this.sliders||e.source.eventId!=pt.Mouse.BUTTON_LEFT){return}this.state=pt.UIState.PRESSED;this._isMoveNotDragging=false;var i=new pt.Point(e.source.x,e.source.y);var r=this.toLocal(i);this._offset=this._calcPointValue(r,true)-this.value};Ce.prototype._doDragEnd=function(t,e){this._isMoveNotDragging=false;this._tempDragAngle=null;this._recordDragAngle=null;if(this.state===pt.UIState.PRESSED){this.state=pt.UIState.NORMAL}};Ce.prototype._doDrag=function(t,e){if(!this.sliders||e.source.eventId!=pt.Mouse.BUTTON_LEFT){return}var i=new pt.Point(e.source.x,e.source.y);var r=this.toLocal(i);var a=this._calcPointValue(r,true)-this._offset;this._setValue(a,true)};Ce.prototype._doPursued=function(){var t=this.stepSize;var e=Math.max(1,Math.ceil(this.length/10/t));while(e--){if(this._pursuedPoint>=this.value&&this._pursuedPoint<=this.value+t){this._isMoveNotDragging=false;this._offset=this._pursuedPoint-this.value;this._pursuedPoint=0;this._pursuedType=0;return}if(this._pursuedPoint<this.value^this.reverse){if(this._pursuedType!==2){this.value-=t;this._pursuedType=1}}else{if(this._pursuedType!==1){this.value+=t;this._pursuedType=2}}}};Ce.STYLE_HORIZONTAL=pt.ProgressBar.STYLE_HORIZONTAL;Ce.STYLE_VERTICAL=pt.ProgressBar.STYLE_VERTICAL;Ce.STYLE_CIRCLE=pt.ProgressBar.STYLE_CIRCLE;Ce.SHOW_PROCESSED=pt.ProgressBar.SHOW_PROCESSED;Ce.SHOW_REMAINED=pt.ProgressBar.SHOW_REMAINED;var Oe=pt.InputField=function(t,e,i){var r=this;pt.UIImage.call(r,t,e,i);r.name="InputField";r.onStateChange=new pt.Signal;r.onValueChange=new pt.Signal;r.interactive=true;var a=r.div=document.createElement("div");if(!D.__wx){var n=a.style;n.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null);n.position="absolute";n.padding=0;n.margin=0;n.border=0;n.outline=0;n.background="none";r.game.world.frontDomRoot.appendChild(a)}var s=i!==C;if(s!==true){var o=r.textComponent=t.add.text(r);o.text="";o.name="Text";o.setAnchor(new pt.Point(0,0),new pt.Point(1,1));o.left=5;o.right=5;o.top=5;o.bottom=5;o.interactive=false;o.color=yt.black;o.alignV=xe.MIDDLE;o.alignH=xe.LEFT;var h=r.placeholder=t.add.text(r);h.text="Enter text...";h.name="Placeholder";h.setAnchor(new pt.Point(0,0),new pt.Point(1,1));h.left=5;h.right=5;h.top=5;h.bottom=5;h.interactive=false;h.color=yt.grey;h.alignV=xe.MIDDLE;h.alignH=xe.LEFT;this.state=pt.UIState.NORMAL;var l=this.addScript("qc.TransitionBehaviour");l.target=this}var u=function(t){t.preventDefault();if(r.state!==pt.UIState.DISABLED){r.startEditing()}};a.addEventListener("mouseup",u,false);a.addEventListener("touchend",u,false);this.onDown.add(function(){if(r.state!==pt.UIState.DISABLED){r.state=pt.UIState.PRESSED}});this.onUp.add(function(t,e){if(r.state===pt.UIState.PRESSED){r.state=pt.UIState.NORMAL}if(D.__wx){if(r.state!==pt.UIState.DISABLED){r.startEditing()}}});r.phaser.worldTransformChangedCallback=r._updateNativeDiv.bind(r);r.phaser.worldTransformChangedContext=r;this.text="";this.width=120;this.height=30;this._checkVisibility()};Oe.SINGLE_LINE=0;Oe.MULTI_LINE=1;Oe.STANDARD=0;Oe.INT=1;Oe.NUMBER=2;Oe.TEL=3;Oe.EMAIL=4;Oe.PASSWORD=5;Oe.prototype=P.create(pt.UIImage.prototype);Oe.prototype.constructor=Oe;Oe.prototype._characterLimit=-1;Oe.prototype._lineType=Oe.SINGLE_LINE;Oe.prototype._contentType=Oe.STANDARD;Oe.prototype._input=null;Oe.prototype._password="";Oe.prototype.textComponent=null;Oe.prototype.placeholder=null;P.defineProperties(Oe.prototype,{class:{get:function(){return"qc.InputField"}},state:{get:function(){return this._state||pt.UIState.NORMAL},set:function(t){if(this.state===t)return;this._state=t;this.onStateChange.dispatch()}},lineType:{get:function(){return this._lineType},set:function(t){this._lineType=t}},contentType:{get:function(){return this._contentType},set:function(t){if(this._contentType===t)return;this._contentType=t;this.text=this.text}},textComponent:{get:function(){if(this._textComponent&&this._textComponent._destroy){this._textComponent=null}return this._textComponent},set:function(t){this._textComponent=t}},placeholder:{get:function(){if(this._placeholder&&this._placeholder._destroy){this._placeholder=null}return this._placeholder},set:function(t){this._placeholder=t}},placeholderText:{get:function(){var t=this.placeholder;if(!t){return""}return t.text},set:function(t){var e=this.placeholder;if(e){e.text=t}}},text:{get:function(){var t=this.textComponent;if(!t){return""}if(this._contentType===Oe.PASSWORD){return this._password}return this.textComponent.text},set:function(t){if(!this.textComponent){return}t=this.toValidateText(t);if(t===this.text){return}if(this._contentType===Oe.PASSWORD){this._password=t;var e="";for(var i=0;i<t.length;i++){e+="·"}this.textComponent.text=e}else{this.textComponent.text=t}this.onValueChange.dispatch(t)}},characterLimit:{get:function(){if(D.__wx&&this._characterLimit===-1)return 99999;return this._characterLimit},set:function(t){if(this.characterLimit===t)return;this._characterLimit=t;this.text=this.text}},overflow:{get:function(){if(!this.textComponent){return false}return this.textComponent.overflow},set:function(t){if(!this.textComponent)return;this.textComponent.overflow=t}},isFocused:{get:function(){return!!this.getInput()},set:function(t){if(t){this.startEditing()}else{this.stopEditing()}}}});Oe.prototype.getMeta=function(){var t=pt.Serializer;var e=pt.UIImage.prototype.getMeta.call(this);e.lineType=t.NUMBER;e.contentType=t.NUMBER;e.placeholder=t.NODE;e.textComponent=t.NODE;e.text=t.STRING;e.overflow=t.BOOLEAN;e.state=t.NUMBER;e._password=t.STRING;e.characterLimit=t.NUMBER;return e};Oe.prototype.update=function(){var t=this.getInput(),e=this.textComponent,i=this.placeholder;var r=e.textPhaser.renderable;if(t){if(e){e.textPhaser.renderable=false}if(i){i.textPhaser.renderable=false}this._updateInput(t)}else{if(e){e.textPhaser.renderable=true}if(i){i.textPhaser.renderable=this.text===""}}if(e.textPhaser.renderable!==r){e.textPhaser.displayChanged(e.textPhaser.renderable?pt.DisplayChangeStatus.SHOW:pt.DisplayChangeStatus.HIDE);this.phaser.displayChanged(e.textPhaser.renderable?pt.DisplayChangeStatus.SHOW:pt.DisplayChangeStatus.HIDE)}};Oe.prototype.toValidateText=function(t){t=t||"";switch(this.contentType){case Oe.INT:t=t.replace(/[^\d\-]/g,"");break;case Oe.NUMBER:t=t.replace(/[^\d\.\-]/g,"");break;case Oe.EMAIL:t=t.replace(/[^\w0-9\@\.]/g,"");break;case Oe.TEL:t=t.replace(/[^\d\(\)\+\-\s]/g,"");break;default:break}if(this.characterLimit>0&&t.length>this.characterLimit){t=t.substr(0,this.characterLimit)}return t};Oe.prototype.startEditing=function(){var r=this,t=r.textComponent;if(!t){return}var e=this._input;if(!e){if(D.__wx){var i={defaultValue:r.text,maxLength:r.characterLimit,multiple:r.lineType===Oe.MULTI_LINE,confirmHold:true,confirmType:"done",success:function(){r._input={value:r.text,_lastValue:r.text};var t=function(t){r._input._lastValue=r._input.value;r._input.value=t.value};var e=function(t){r._input._lastValue=r._input.value;r._input.value=t.value;r.stopEditing()};var i=function(t){r.cancelEditing()};wx.onKeyboardConfirm(e);wx.onKeyboardInput(t);wx.onKeyboardComplete(i)},fail:function(t){r.game.log.trace("showKeyboard fail : {0}",JSON.stringify(t))}};wx.showKeyboard(i)}else{if(this.lineType===Oe.MULTI_LINE){e=r._input=document.createElement("textarea");e.onkeydown=function(t){if($.ESC===t.keyCode){r.cancelEditing()}}}else{e=r._input=document.createElement("input");e.onkeydown=function(t){if($.ENTER===t.keyCode){r.stopEditing()}else if($.ESC===t.keyCode){r.cancelEditing()}};switch(r.contentType){case Oe.PASSWORD:e.type="password";break;case Oe.EMAIL:e.type="email";break;case Oe.TEL:e.type="tel";break;case Oe.INT:case Oe.NUMBER:e.type="number";break;default:e.type="text";break}switch(t.alignH){case xe.LEFT:e.style.textAlign="left";break;case xe.RIGHT:e.style.textAlign="right";break;default:e.style.textAlign="center";break}switch(t.alignV){case xe.TOP:e.style.verticalAlign="top";break;case xe.BOTTOM:e.style.verticalAlign="bottom";break;default:e.style.verticalAlign="middle";break}}if(this.characterLimit>0){e.setAttribute("maxlength",this.characterLimit)}e._qc=r;e.value=r.text;var a=e.style;a.position="absolute";a.padding=0;a.margin=0;a.border=0;a.outline=0;a.background="none";e.onblur=function(t){r.stopEditing()};e._handleClick=function(t){if(t.target!==r.div&&t.target!==e){r.stopEditing()}};var n=r.game.world.frontDomRoot;n.addEventListener("mousedown",e._handleClick,false);n.addEventListener("touchstart",e._handleClick,false);r.game.input._inputting++;var s=document.createElement("div");s.style.width=this.game.canvas.style.width;s.style.height=this.game.canvas.style.height;s.style.position="absolute";s.style.overflow="hidden";s.appendChild(e);n.appendChild(s);r._updateInput(e);e.focus();r._updateNativeInput();t.phaser.worldTransformChangedCallback=this._updateNativeInput.bind(r);t.phaser.worldTransformChangedContext=t}}};Oe.prototype._updateInput=function(t){var e=this.game.time.now;if(t._lastUpdate&&e-t._lastUpdate<100){return}t._lastUpdate=e;if(!D.__wx){var i=this.textComponent;if(i.textPhaser instanceof dt.Text){t.style.font=i.textPhaser.style.font}t.style.fontSize=i.fontSize+"px";t.style.color=i.color.toString()}if(t._lastValue!==t.value){t._lastValue=t.value;this.text=t.value}};Oe.prototype.getInput=function(){if(this._input&&!this.textComponent){this.cancelEditing()}return this._input};Oe.prototype.cancelEditing=function(){var t=this._input;if(t){if(D.__wx){this._input=null;wx.hideKeyboard();wx.offKeyboardConfirm();wx.offKeyboardInput();wx.offKeyboardComplete()}else{this._input=null;this.game.input._inputting--;var e=this.game.world.frontDomRoot;e.removeEventListener("mousedown",t._handleClick,false);e.removeEventListener("touchstart",t._handleClick,false);pt.Util.removeHTML(t.parentNode)}}};Oe.prototype.stopEditing=function(){var t=this.getInput();if(!t){return}this.text=t.value;this.cancelEditing()};Oe.prototype.onDestroy=function(){this.cancelEditing();pt.Util.removeHTML(this.div);pt.UIImage.prototype.onDestroy.call(this)};Oe.prototype._dispatchAwake=function(){M.prototype._dispatchAwake.call(this);this._checkVisibility()};Oe.prototype.onVisibleChange=function(){this._checkVisibility()};Oe.prototype._checkVisibility=function(){var t=this.isWorldVisible();this.div.style.display=t?"block":"none";if(!t){this.stopEditing()}};Oe.prototype._updateNativeDiv=function(){var t=this;var e=t.div;e._lastUpdate=t.game.time.now;pt.Util.updateTransform(t,e)};Oe.prototype._updateNativeInput=function(){var t=this;var e=t.getInput();if(e)pt.Util.updateTransform(t.textComponent,e)};var Me=pt.Tilemap=function(t,e,i){pt.Node.call(this,new dt.Group(t.phaser,null),e,i);this.name="Tilemap";this._copyCanvas=dt.Canvas.create(1,1);this._copyContext=this._copyCanvas.getContext("2d")};Me.prototype=P.create(pt.Node.prototype);Me.prototype.constructor=Me;Me.prototype._data=null;Me.prototype._scrollX=0;Me.prototype._scrollY=0;Me.prototype._layers=0;Me.prototype._tilesets=0;Me.prototype.getMeta=function(){var t=pt.Node.prototype.getMeta.call(this);t.data=N.TEXTASSET;t.scrollX=N.NUMBER;t.scrollY=N.NUMBER;t.layers=N.NODES;t.tilesets=N.TEXTURES;return t};Me.prototype.generateLayers=function(s){var o=this;var t=o.data;if(t){var h=o.game;var e=o._dataInfo;var l=e.json;var i=l.tilesets;var u=[];for(var r=0;r<i.length;r++){u.push({key:i[r].name,url:e.prefix+i[r].name+".bin"})}h.assets.loadBatch(u,function(){var t=[];for(var e=0;e<u.length;e++){t.push(new pt.Texture(u[e].asset))}o.tilesets=t;o.removeChildren();var i=[];for(var e=0;e<l.layers.length;e++){var r=l.layers[e];if(r.type==="tilelayer"){var a=new Ie(h,o);a.name=r.name;a.tilemap=o;a.layerIndex=e;i.push(a)}else if(r.type==="objectgroup"){var n=new Re(h,o);n.name=r.name;n.tilemap=o;n.layerIndex=e;i.push(n)}}o.layers=i;if(s){s()}})}};Me.prototype.getLayerByIndex=function(t){var e=this._layers;if(e&&t>=0&&t<e.length){return e[t]}return null};Me.prototype.getLayerByName=function(t){var e=this._layers;if(e){for(var i=0;i<e.length;i++){if(e[i].name===t){return e[i]}}}return null};Me.prototype._getLayerJson=function(t,e){if(!this._dataInfo){return}var i=this._dataInfo.json.layers;if(t>=0&&t<i.length){var r=i[t];if(r.type===e){return r}}return null};Me.prototype.resetNativeSize=function(){var t=this.nativeSize;if(t){this.width=t.width;this.height=t.height}};Me.prototype.getTilePosition=function(t,e){return new pt.Point(Math.floor(t/this.tileWidth),Math.floor(e/this.tileHeight))};P.defineProperties(Me.prototype,{nativeSize:{get:function(){var t=this._dataInfo;if(t){return new pt.Rectangle(0,0,t.map.widthInPixels,t.map.heightInPixels)}return null}},layers:{get:function(){return this._layers},set:function(t){this._layers=t}},tilesets:{get:function(){return this._tilesets},set:function(t){this._tilesets=t}},scrollX:{get:function(){return this._scrollX},set:function(t){this._scrollX=t}},scrollY:{get:function(){return this._scrollY},set:function(t){this._scrollY=t}},tileWidth:{get:function(){return this._dataInfo.json.tilewidth}},tileHeight:{get:function(){return this._dataInfo.json.tileheight}},mapWidth:{get:function(){return this._dataInfo.json.width}},mapHeight:{get:function(){return this._dataInfo.json.height}},data:{get:function(){return this._data},set:function(e){var t=this,i=t.game;var r=null;if(e){if(!(e instanceof u)){return}try{var a=JSON.parse(e.text);if(!a.layers||!a.tilesets){throw new Error("Invalid tilemap data format")}i.phaser.load.tilemap(e.url,null,a,dt.Tilemap.TILED_JSON);var n=i.phaser.add.tilemap(e.url);var s=0;var o=0;for(var h=0;h<n.tilesets.length;h++){s=Math.max(s,n.tilesets[h].tileWidth);o=Math.max(o,n.tilesets[h].tileHeight)}n.maxTileWidth=s;n.maxTileHeight=o;var l=e.url.lastIndexOf("/");r={json:a,map:n,prefix:l>=0?e.url.substring(0,l+1):""}}catch(t){i.log.error("Asset{0}/{1} Parse fail",e.key,e.url,t);pt.Util.popupError(t.message);return}}t._data=e;t._dataInfo=r}},class:{get:function(){return"qc.Tilemap"}}});var Ie=pt.TileLayer=function(t,e,i){var r=this;var a=new dt.Sprite(t.phaser);pt.Node.call(r,a,e,i);r.name="TileLayer";r._cache={};r._dirtyTiles=null;a.canvas=dt.Canvas.create(1,1);a.context=a.canvas.getContext("2d");a.baseTexture=new _t.BaseTexture(a.canvas);a.texture=new _t.Texture(a.baseTexture);r.setAnchor(new pt.Point(0,0),new pt.Point(1,1));r.setStretch(0,0,0,0);var n=a._renderCanvas,s=a._renderWebGL;a._renderCanvas=function(){r._renderTiles();n.apply(a,arguments)};a._renderWebGL=function(){r._renderTiles();s.apply(a,arguments)}};Ie.prototype=P.create(pt.Node.prototype);Ie.prototype.constructor=Ie;Ie.prototype._tilemap=null;Ie.prototype._layerIndex=-1;Ie.prototype._scrollXRatio=1;Ie.prototype._scrollYRatio=1;Ie.prototype.getMeta=function(){var t=pt.Node.prototype.getMeta.call(this);t.tilemap=N.NODE;t.layerIndex=N.INT;t.scrollXRatio=N.NUMBER;t.scrollYRatio=N.NUMBER;return t};Ie.prototype.getTile=function(t,e){var i=this._cache;var r=this.tilemap;if(!r){return C}var a=i.phaserLayer;if(!a||i.tilemap!==r||i.layerIndex!==this.layerIndex){a=null;var n=r._getLayerJson(this.layerIndex,"tilelayer");if(n){var s=r._dataInfo.map;var o=s.getLayerIndex(n.name);if(o>=0){a=s.layers[o]}}}if(!a||!a.data||!a.data[e]){return C}return a.data[e][t]};Ie.prototype.getTileIndex=function(t,e){var i=this.getTile(t,e);return i?i.index:Infinity};Ie.prototype.setTileIndex=function(t,e,i){var r=this.getTile(t,e);if(r&&r.index!==i){r.index=i;if(!this._dirtyTiles){this._dirtyTiles={}}this._dirtyTiles[t+"|"+e]={x:t,y:e}}};Ie.prototype.redrawAll=function(){this._redrawAllFlag=true};Ie.prototype._renderTiles=function(){var t=this;var e=t.tilemap;if(!e){return}var i=t._cache,r=t.phaser,a=e._dataInfo.map;var n=t._checkTileLayerChange(a);var s=i.phaserLayer;if(!s){return}if(t._redrawAllFlag){n=true;t._redrawAllFlag=false}var o=r.context,h=s.data,l=Math.round(t.width),u=Math.round(t.height),f=e.scrollX,c=e.scrollY,p=t.scrollXRatio,d=t.scrollYRatio;n=t._checkSizeChange(l,u)||n;var _=false;if(n||i.scrollX!==f||i.scrollY!==c||i.scrollXRatio!==p||i.scrollYRatio!==d){var g=Math.round(f*p),m=Math.round(c*d),y=i.viewRect,v=new dt.Rectangle(-g,-m,l,u);if(!n){var T=dt.Rectangle.intersection(y,v);if(T.width>10&&T.height>10){var x=T.x-y.x;var b=T.y-y.y;var A=T.width;var S=T.height;if(e._copyCanvas.width!==l)e._copyCanvas.width=l;if(e._copyCanvas.height!==u)e._copyCanvas.height=u;e._copyContext.clearRect(x,b,A,S);e._copyContext.drawImage(r.canvas,x,b,A,S,x,b,A,S)}else{n=true}}o.clearRect(0,0,l,u);o.translate(g,m);if(n){t._dirtyTiles=null;t._drawRect(o,a,h,-g,-m,l,u)}else{o.drawImage(e._copyCanvas,x,b,A,S,T.x,T.y,A,S);if(v.contains(y.left,y.top)){t._drawRect(o,a,h,v.x,v.y,T.x-v.x,v.height);t._drawRect(o,a,h,T.x,v.y,v.right-T.x,T.y-v.y)}else if(v.contains(y.right,y.top)){t._drawRect(o,a,h,v.x,v.y,T.right-v.x,T.y-v.y);t._drawRect(o,a,h,T.right,v.y,v.right-T.right,v.height)}else if(v.contains(y.left,y.bottom)){t._drawRect(o,a,h,v.x,v.y,T.x-v.x,v.height);t._drawRect(o,a,h,T.x,T.bottom,v.right-T.x,v.bottom-T.bottom)}else if(v.contains(y.right,y.bottom)){t._drawRect(o,a,h,v.x,T.bottom,T.right-v.x,v.bottom-T.bottom);t._drawRect(o,a,h,T.right,v.y,v.right-T.right,v.height)}}o.translate(-g,-m);_=true;i.scrollX=f;i.scrollY=c;i.scrollXRatio=p;i.scrollYRatio=d;i.viewRect=v}var w=t._renderDirtyTiles(o,a,h);if(_||w){r.texture.baseTexture.dirty();r.displayChanged(pt.DisplayChangeStatus.TEXTURE)}};Ie.prototype._renderDirtyTiles=function(t,e,i){var r=this,a=false;if(r._dirtyTiles){var n=e.maxTileWidth,s=e.maxTileHeight,o=e.tileWidth,h=e.tileHeight,l=r._cache.viewRect,u=n>o?-n:0,f=s>h?s:0,c=Math.floor((l.x+u)/o),p=Math.floor(l.y/h),d=Math.ceil((l.x+l.width)/o),_=Math.ceil((l.y+l.height+f)/h);t.translate(-l.x,-l.y);for(var g in r._dirtyTiles){var m=r._dirtyTiles[g],y=m.x,v=m.y;if(y>=c&&y<=d&&v>=p&&v<=_){r._drawRect(t,e,i,y*o,v*h+h-s,n,s,true);a=true}}t.translate(l.x,l.y);r._dirtyTiles=null}return a};Ie.prototype._checkTileLayerChange=function(t){var e=this._cache;var i=this.tilemap;var r=this.layerIndex;if(e.tilemap!==i||e.layerIndex!==r){e.phaserLayer=null;var a=i._getLayerJson(r,"tilelayer");if(a){var n=t.getLayerIndex(a.name);if(n>=0){e.phaserLayer=t.layers[n]}}e.tilemap=i;e.layerIndex=r;return true}return false};Ie.prototype._checkSizeChange=function(t,e){var i=this._cache;var r=this.phaser;var a=r.texture;if(i.width!==t||i.height!==e){r.canvas.width=t;r.canvas.height=e;a.frame.width=t;a.frame.height=e;a.width=t;a.height=e;a.crop.width=t;a.crop.height=e;a.baseTexture.width=t;a.baseTexture.height=e;a.baseTexture.dirty();i.width=t;i.height=e;return true}return false};Ie.prototype._drawRect=function(t,e,i,r,a,n,s,o){if(!n||!s){return}if(o){t.clearRect(r,a,n,s)}t.save();t.beginPath();t.rect(r,a,n,s);t.clip();var h=e.maxTileWidth,l=e.maxTileHeight,u=e.tileWidth,f=e.tileHeight,c=Math.floor((h>u?r-h:r)/u),p=Math.floor(a/f),d=Math.ceil((r+n)/u),_=Math.ceil((l>f?a+s+l:a+s)/f);if(c<0)c=0;if(p<0)p=0;if(d>e.width)d=e.width;if(_>e.height)_=e.height;for(a=p;a<_;a++){var g=i[a];for(r=c;r<d;r++){this._drawTile(t,e,g[r],r,a)}}t.restore()};Ie.prototype._drawTile=function(t,e,i,r,a){var n=i.index;if(n<=0){return}var s=e.tiles[n];var o=e.tilesets[s[2]];var h=o.asset;if(h===C){var l=this.tilemap._dataInfo.prefix+o.name+".bin";var u=this.tilemap.tilesets;if(u){for(var f=0;f<u.length;f++){if(u[f].atlas.url===l){h=u[f];break}}}if(!h){o.asset=null}else{o.asset=h}}if(h){t.drawImage(h.atlas.img,s[0],s[1],o.tileWidth,o.tileHeight,i.worldX,i.worldY+e.tileHeight-o.tileHeight,o.tileWidth,o.tileHeight)}};P.defineProperties(Ie.prototype,{tilemap:{get:function(){if(this._tilemap&&this._tilemap._destroy){this._tilemap=null}return this._tilemap},set:function(t){if(t&&!(t instanceof Me)){return}this._tilemap=t}},layerIndex:{get:function(){return this._layerIndex},set:function(t){this._layerIndex=t}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(t){this._scrollXRatio=t}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(t){this._scrollYRatio=t}},class:{get:function(){return"qc.TileLayer"}}});var Re=pt.ObjectLayer=function(t,e,i){pt.Node.call(this,new dt.Group(t.phaser,null),e,i);this.name="ObjectLayer";this.setAnchor(new pt.Point(0,0),new pt.Point(1,1));this.setStretch(0,0,0,0)};Re.prototype=P.create(pt.Node.prototype);Re.prototype.constructor=Re;Re.prototype._tilemap=null;Re.prototype._layerIndex=-1;Re.prototype._scrollXRatio=1;Re.prototype._scrollYRatio=1;Re.prototype.getMeta=function(){var t=pt.Node.prototype.getMeta.call(this);t.tilemap=N.NODE;t.layerIndex=N.INT;t.scrollXRatio=N.NUMBER;t.scrollYRatio=N.NUMBER;return t};Re.prototype.update=function(){if(this._tilemap&&this._tilemap._destroy){this._tilemap=null}var t=this._tilemap;if(t){this.x=t.scrollX*this.scrollXRatio;this.y=t.scrollY*this.scrollXRatio}};P.defineProperties(Re.prototype,{tilemap:{get:function(){if(this._tilemap&&this._tilemap._destroy){this._tilemap=null}return this._tilemap},set:function(t){if(t&&!(t instanceof Me)){return}this._tilemap=t}},layerIndex:{get:function(){return this._layerIndex},set:function(t){this._layerIndex=t}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(t){this._scrollXRatio=t}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(t){this._scrollYRatio=t}},class:{get:function(){return"qc.ObjectLayer"}}});var Ne=pt.Dom=function(t,e,i){var r=this;r.game=t;pt.Node.call(this,new dt.Group(this.game.phaser,null),e,i);r.name="dom";var a=r.div=document.createElement("div");a.style.position="absolute";a.setAttribute("id",r.uuid);a._qc=r;r.overflow="hidden";r.serializable=true;r.phaser.worldTransformChangedCallback=r._updateDomTransform;r.phaser.worldTransformChangedContext=r;r.pos=Ne.POS_FRONT;r._updateDomTransform();if(r.game.device.android){r.game.timer.add(1,function(){if(!r._destroy){r.rotation+=.001}});r.game.timer.add(40,function(){if(!r._destroy){r.rotation-=.002}});r.game.timer.add(300,function(){if(!r._destroy){r.rotation+=5e-4}});r.game.timer.add(1e3,function(){if(!r._destroy){r.rotation+=5e-4}})}};Ne.prototype=P.create(pt.Node.prototype);Ne.prototype.constructor=Ne;Ne.POS_NONE=-1;Ne.POS_BACK=0;Ne.POS_FRONT=1;P.defineProperties(Ne.prototype,{class:{get:function(){return"qc.Dom"}},pos:{get:function(){return this._pos},set:function(t){if(this.pos===t)return;this._pos=t;if(this.div.parentNode)this.div.parentNode.removeChild(this.div);if(t===Ne.POS_BACK){this.game.world.backDomRoot.appendChild(this.div);if(this.zIndex>=0)this.zIndex=-1}else if(t===Ne.POS_FRONT){this.game.world.frontDomRoot.appendChild(this.div);if(this.zIndex<=0)this.zIndex=1}}},zIndex:{get:function(){return this.div.style.zIndex||0},set:function(t){if(t===this.div.style.zIndex)return;if(this._pos===Ne.POS_BACK&&t>=0)t=-1;else if(this._pos===Ne.POS_FRONT&&t<=0)t=1;this.div.style.zIndex=t}},innerHTML:{get:function(){return this.div.innerHTML},set:function(t){this.div.innerHTML=t}},className:{get:function(){return this.div.className},set:function(t){this.div.className=t}},overflow:{get:function(){return this._overflow},set:function(t){if(t===this._overflow)return;this._overflow=t;this.div.style.overflow=t}},alpha:{get:function(){var t=this.div,e=t.style.opacity;if(e)return e*1;return 1},set:function(t){var e=this,i=e.div;if(t===i.alpha)return;i.style.filter="alpha(opacity:"+t*100+")";i.style.opacity=t}}});Ne.prototype._dispatchAwake=function(){M.prototype._dispatchAwake.call(this);this._updateDomTransform()};Ne.prototype.onVisibleChange=function(){this._updateDomTransform()};Ne.prototype.onRemoveFromWorld=function(){if(this.div&&this.div.parentNode)this.div.parentNode.removeChild(this.div)};Ne.prototype.onAddToWorld=function(){if(!this.div||this.div.parentNode)return;var t=this.pos;if(t===Ne.POS_BACK){this.game.world.backDomRoot.appendChild(this.div);if(this.zIndex>=0)this.zIndex=-1}else if(t===Ne.POS_FRONT){this.game.world.frontDomRoot.appendChild(this.div);if(this.zIndex<=0)this.zIndex=1}};Ne.prototype.onDestroy=function(){this.div._qc=null;if(this.div.parentNode)this.div.parentNode.removeChild(this.div);pt.Node.prototype.onDestroy.call(this)};Ne.prototype.getMeta=function(){var i=this;var t=pt.Serializer;var e=pt.Node.prototype.getMeta.call(this);e.pos=t.NUMBER;e.className=t.STRING;e.overflow=t.STRING;e.innerHTML={get:function(t,e){return t.serializable?[true,t.innerHTML]:C},set:function(t,e){if(!e){i.serializable=false;i.innerHTML=""}else{i.serializable=true;i.innerHTML=e[1]}}};e.zIndex=t.INT;return e};Ne.prototype._updateDomTransform=function(){pt.Util.updateTransform(this,this.div);this.div.style.display=this.isWorldVisible()?"block":"none"};var Be=pt.Graphics=function(t,e,i){var r=this;r.game=t;pt.Node.call(this,new dt.Graphics(this.game.phaser),e,i);r.name="graphics"};Be.prototype=P.create(pt.Node.prototype);Be.prototype.constructor=Be;P.defineProperties(Be.prototype,{class:{get:function(){return"qc.Graphics"}},fillAlpha:{get:function(){return this.phaser.fillAlpha},set:function(t){this.phaser.fillAlpha=t}},lineWidth:{get:function(){return this.phaser.lineWidth},set:function(t){this.phaser.lineWidth=t}},lineColor:{get:function(){return this.phaser.lineColor},set:function(t){this.phaser.lineColor=t}},blendMode:{get:function(){return this.phaser.blendMode},set:function(t){this.phaser.blendMode=t}},boundsPadding:{get:function(){return this.phaser.boundsPadding},set:function(t){this.phaser.boundsPadding=t}}});Be.prototype.getMeta=function(){var t=this;var e=pt.Serializer;var i=pt.Node.prototype.getMeta.call(this);return i};Be.prototype.drawTriangle=function(t,e){return this.phaser.drawTriangle(t,e)};Be.prototype.drawTriangles=function(t,e,i){return this.phaser.drawTriangles(t,e,i)};Be.prototype.lineStyle=function(t,e,i){return this.phaser.lineStyle(t,e,i)};Be.prototype.moveTo=function(t,e){return this.phaser.moveTo(t,e)};Be.prototype.lineTo=function(t,e){return this.phaser.lineTo(t,e)};Be.prototype.quadraticCurveTo=function(t,e,i,r){return this.quadraticCurveTo(t,e,i,r)};Be.prototype.bezierCurveTo=function(t,e,i,r,a,n){return this.phaser.bezierCurveTo(t,e,i,r,a,n)};Be.prototype.arcTo=function(t,e,i,r,a){return this.phaser.arcTo(t,e,i,r,a)};Be.prototype.arc=function(t,e,i,r,a,n){return this.phaser.arc(t,e,i,r,a,n)};Be.prototype.beginFill=function(t,e){return this.phaser.beginFill(t,e)};Be.prototype.endFill=function(){return this.phaser.endFill()};Be.prototype.drawRect=function(t,e,i,r){return this.phaser.drawRect(t,e,i,r)};Be.prototype.drawRoundedRect=function(t,e,i,r,a){return this.phaser.drawRoundedRect(t,e,i,r,a)};Be.prototype.drawCircle=function(t,e,i){return this.phaser.drawCircle(t,e,i)};Be.prototype.drawEllipse=function(t,e,i,r){return this.phaser.drawEllipse(t,e,i,r)};Be.prototype.drawPolygon=function(t){return this.phaser.drawPolygon(t)};Be.prototype.clear=function(){return this.phaser.clear()};Be.prototype.generateTexture=function(t,e){return this.phaser.generateTexture(t,e)};Be.prototype.containsPoint=function(t){return this.phaser.containsPoint(t)};Be.prototype.drawShape=function(t){return this.phaser.drawShape(t)};var Le=pt.Dropdown=function(t,e,i){var r=this;pt.UIImage.call(r,t,e,i);r.onStateChange=new pt.Signal;r.onValueChange=new pt.Signal;r.captionImage=null;r.captionText=null;r.item=null;r.options=[];r.template=null;var a=i!==C;r.name="Dropdown";r.interactive=true;r._items=[];r._value=-1;if(a!==true){r.captionText=t.add.text(r);r.captionText.name="Label";r.captionImage=t.add.image(r);r.captionImage.name="Image";r.template=t.add.scrollView(r);r.template.interactive=true;r.template.name="Template";var n=r.template.addScript("qc.NodeMask");n.checkInField=false;r.template.content=t.add.node(r.template);r.template.visible=false;r.template.content.name="Content";var s=r.item=t.add.node(r.template.content);s.name="Item";s.interactive=true;var o=s.addScript("qc.DropdownItem");o.checkBackground=t.add.image(s);o.checkBackground.name="Background";o.checkMark=t.add.image(s);o.checkMark.name="CheckMark";o.text=t.add.text(s);o.text.name="Text";o.image=t.add.image(s);o.image.name="Image";o.image.visible=false}r.addListener(r.onDown,function(){if(r.state!==pt.UIState.DISABLED){r.state=pt.UIState.PRESSED}});r.addListener(r.onUp,function(){if(r.state===pt.UIState.PRESSED){r.state=pt.UIState.NORMAL}});r.addListener(r.onClick,function(t){r.isFocused=!r.isFocused});r.phaser.worldTransformChangedCallback=r._updatePosition;r.phaser.worldTransformChangedContext=r;r._updatePosition()};Le.prototype=P.create(pt.UIImage.prototype);Le.prototype.constructor=Le;P.defineProperties(Le.prototype,{class:{get:function(){return"qc.Dropdown"}},state:{get:function(){return this._state||pt.UIState.NORMAL},set:function(t){if(this.state===t)return;this._state=t;this.onStateChange.dispatch()}},value:{get:function(){return this.options.length>0?this._value:-1},set:function(t){if(this._value===t||t>=this.options.length)return;if(typeof this._value==="number"){var e=this._items[this._value],i=this._items[t];this._value=t;if(e)e.getScript("qc.DropdownItem").redraw();if(i)i.getScript("qc.DropdownItem").redraw();this._redraw();this.onValueChange.dispatch(t)}}},isFocused:{get:function(){return this._list&&this._list.visible},set:function(t){if(t===this.isFocused)return;if(t)this.show();else this.hide()}}});Le.prototype._dispatchAwake=function(){var t=this;M.prototype._dispatchAwake.call(t);if(!t._value||t.options.length===0)t._value=-1;t._redraw()};Le.prototype.addOptions=function(t){var e=this;var i=e.options.concat(t);if(e.options.length===0){e.options=i;this.value=0}else{e.options=i}if(e.isFocused){e.show()}};Le.prototype.clearOptions=function(){var t=this;t.options=[];if(t._value>=0){t._value=-1;t.onValueChange.dispatch(t._value)}if(t.isFocused){t.hide()}t._redraw()};Le.prototype.show=function(){var t=this,e=t._list;t.hide();t._maskNode=t.game.add.node(t.game.world);t._maskNode.interactive=true;t._maskNode.name="mask";t._maskNode.addListener(t._maskNode.onClick,function(){t.hide()});t._items=[];t.item.visible=false;e=t._list=t.game.add.clone(t.template,t.game.world);var i="",r=t.item.parent;while(r!==t.template){i=i===""?r.name:r.name+"/"+i;r=r.parent}var a=i===""?e:e.find(i);for(var n=0;n<t.options.length;n++){var s=t.game.add.clone(t.item,a);s.visible=true;var o=s.getScript("qc.DropdownItem");o.dropdown=t;o.index=n;t._items.push(s)}e.visible=true;t._updatePosition()};Le.prototype.hide=function(){var t=this,e=t._list;if(e){e.destroy();delete t._list}if(t._maskNode){t._maskNode.destroy();delete t._maskNode}t._items=[]};Le.prototype.getMeta=function(){var n=this;var t=pt.Serializer;var e=pt.UIImage.prototype.getMeta.call(n);e.captionImage=t.NODE;e.captionText=t.NODE;e.template=t.NODE;e.item=t.NODE;e.maskNode=t.NODE;e.state=t.NUMBER;e._value=t.NUMBER;e.options={get:function(t,e){var i=[];for(var r=0;r<n.options.length;r++){var a=n.options[r];if(!a){i.push(C);continue}if(typeof a==="string"){i.push(a);continue}i.push(n.game.serializer._saveTextureItem(a,e))}return i},set:function(t,e){e.forEach(function(t){if(!t||typeof t==="string"){n.options.push(t);return}n.options.push(n.game.serializer._restoreTextureItem(t))})}};return e};Le.prototype._redraw=function(){var t=this;if(t.options.length===0||t.value<0||t.value>=t.options.length){if(t.captionImage)t.captionImage.visible=false;if(t.captionText)t.captionText.visible=false;return}var e=t.options[t.value];if(typeof e==="string"){if(t.captionImage)t.captionImage.visible=false;if(t.captionText){t.captionText.visible=true;t.captionText.text=e}}else if(e){if(t.captionText)t.captionText.visible=false;if(t.captionImage){t.captionImage.visible=true;t.captionImage.texture=e}}};Le.prototype._updatePosition=function(){var t=this,e=t._list;if(!e)return;t.template.visible=true;var i=pt.Bounds.getBox(t,Fe.USE_BOUNDS,true,0),r=pt.Bounds.getBox(t.template,Fe.USE_BOUNDS,true,0),a=r.y;if(r.height<t.game.world.height/2&&r.y+r.height>t.game.world.height){var n=r.y-(i.y+i.height);a=i.y-n-r.height}var s=t.template.getWorldPosition();e.setAnchor(new pt.Point(0,0),new pt.Point(0,0));e.x=s.x,e.y=a-e.pivotY*e.height;var o=t.template.getWorldScale();e.scaleX=o.x,e.scaleY=o.y;e.rotation=t.template.getWorldRotation();e.width=t.template.width;e.height=t.template.height;t._maskNode.x=t._maskNode.y=0;t._maskNode.width=t.game.world.width;t._maskNode.height=t.game.world.height;t.template.visible=false};var Fe=w("qc.Bounds",pt.Behaviour,function(){this._sizeProvider=Fe.USE_BOUNDS;this._autoCalcBounds=true;this._marginTop=this._marginBottom=this._marginLeft=this._marginRight=0;this._paddingTop=this._paddingBottom=this._paddingLeft=this._paddingRight=0;this._deep=1},{_sizeProvider:pt.Serializer.NUMBER,_marginTop:pt.Serializer.NUMBER,_marginBottom:pt.Serializer.NUMBER,_marginLeft:pt.Serializer.NUMBER,_marginRight:pt.Serializer.NUMBER,_paddingTop:pt.Serializer.NUMBER,_paddingBottom:pt.Serializer.NUMBER,_paddingLeft:pt.Serializer.NUMBER,_paddingRight:pt.Serializer.NUMBER,_autoCalcBounds:pt.Serializer.BOOLEAN});Fe.__hiddenInMenu=true;P.defineProperties(Fe.prototype,{sizeProvider:{get:function(){return this._sizeProvider},set:function(t){if(this._sizeProvider===t){return}this._sizeProvider=t;this.getBounds(true)}},marginTop:{get:function(){return this._marginTop},set:function(t){this.setMargin(t)}},marginBottom:{get:function(){return this._marginBottom},set:function(t){this.setMargin(null,null,t)}},marginLeft:{get:function(){return this._marginLeft},set:function(t){this.setMargin(null,null,null,t)}},marginRight:{get:function(){return this._marginRight},set:function(t){this.setMargin(null,t)}},paddingTop:{get:function(){return this._paddingTop},set:function(t){this.setPadding(t)}},paddingBottom:{get:function(){return this._paddingBottom},set:function(t){this.setPadding(null,null,t)}},paddingLeft:{get:function(){return this._paddingLeft},set:function(t){this.setPadding(null,null,null,t)}},paddingRight:{get:function(){return this._paddingRight},set:function(t){this.setPadding(null,t)}},autoCalcBounds:{get:function(){return this._autoCalcBounds},set:function(t){this._autoCalcBounds=t}}});Fe.prototype.setPadding=function(t,e,i,r){typeof t!=="undefined"&&t!==null&&(this._paddingTop=t);typeof e!=="undefined"&&e!==null&&(this._paddingRight=e);typeof i!=="undefined"&&i!==null&&(this._paddingBottom=i);typeof r!=="undefined"&&r!==null&&(this._paddingLeft=r);this._lastWrapTime=null;if(this.relayout){this.relayout()}this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")};Fe.prototype.setMargin=function(t,e,i,r){typeof t!=="undefined"&&t!==null&&(this._marginTop=t);typeof e!=="undefined"&&e!==null&&(this._marginRight=e);typeof i!=="undefined"&&i!==null&&(this._marginBottom=i);typeof r!=="undefined"&&r!==null&&(this._marginLeft=r);this._lastWrapTime=null;if(this.relayout){this.relayout()}this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")};Fe.prototype.calcBounds=function(){this.getBounds(true)};Fe.prototype.getBounds=function(t){var e=this._recordBounds||new pt.Rectangle(0,0,0,0);if(!this.enable||!this.gameObject||!this.gameObject.isWorldVisible()){return e}if(this._recordBounds&&!t&&(!this.autoCalcBounds||this._lastWrapTime===this.gameObject.game.time.fixedTime)){return this._recordBounds}this._lastWrapTime=this.gameObject.game.time.fixedTime;var i=new pt.Point(0,0);var r=new pt.Point(0,0);Fe._calcBounds(i,r,this.sizeProvider,this.gameObject,this._deep);e.x=i.x;e.y=i.y;e.width=r.x-i.x;e.height=r.y-i.y;this._recordBounds=e;return e};Fe.prototype.getWorldCorners=function(t){var e=this.getBounds(t);var i=new pt.Point(e.x,e.y);var r=new pt.Point(e.x+e.width,e.y);var a=new pt.Point(e.x+e.width,e.y+e.height);var n=new pt.Point(e.x,e.y+e.height);var s=this.gameObject.worldTransform;return[s.apply(i),s.apply(r),s.apply(a),s.apply(n)]};Fe._calcBounds=function(t,e,i,r,a){var n=r.getScript("qc.Bounds");i=n&&n.enable?n.sizeProvider:i;if(i===Fe.USE_BOUNDS){this._calcRealBounds(t,e,r,a)}else{this._calcRectBounds(t,e,r,a)}};Fe._calcRectBounds=function(t,e,i,r){var a=i.getScript("qc.Bounds");var n=i.rect;var s=n.x,o=n.y,h=n.x+n.width,l=n.y+n.height;if(r!==0){var u=i.children;var f=u.length;while(f--){var c=u[f];if(!c.isWorldVisible()){continue}var p=c.getScript("qc.Bounds");var d=new pt.Point(0,0);var _=new pt.Point(0,0);if(p){var g=p.getBounds();d.x=g.x;d.y=g.y;_.x=g.x+g.width;_.y=g.y+g.height}else{Fe._calcRectBounds(d,_,c,r-1)}if(a&&a.enable){d.x-=a.paddingLeft;d.y-=a.paddingTop;_.x+=a.paddingRight;_.y+=a.paddingBottom}s=Math.min(s,d.x);o=Math.min(o,d.y);h=Math.max(h,_.x);l=Math.max(l,_.y)}}if(a&&a.enable){s-=a.marginLeft;o-=a.marginTop;h+=a.marginRight;l+=a.marginBottom}t.x=Math.min(t.x,s);t.y=Math.min(t.y,o);e.x=Math.max(e.x,h);e.y=Math.max(e.y,l)};Fe._calcRealBounds=function(t,e,i,r){var a=i.getScript("qc.Bounds");var n=i.rect;var s=n.x,o=n.y,h=n.x+n.width,l=n.y+n.height;if(r!==0){var u=i.worldTransform;var f=i.children;var c=f.length;while(c--){var p=f[c];if(!p.isWorldVisible()){continue}var d=p.getScript("qc.Bounds");var _=new pt.Point(0,0);var g=new pt.Point(0,0);if(d){var m=d.getBounds();_.x=m.x;_.y=m.y;g.x=m.x+m.width;g.y=m.y+m.height}else{Fe._calcRealBounds(_,g,p,r-1)}var y=new pt.Point(_.x,_.y);var v=new pt.Point(g.x,_.y);var T=new pt.Point(g.x,g.y);var x=new pt.Point(_.x,g.y);var b=p.worldTransform;y=u.applyInverse(b.apply(y));v=u.applyInverse(b.apply(v));T=u.applyInverse(b.apply(T));x=u.applyInverse(b.apply(x));var A=Math.min(y.x,v.x,T.x,x.x);var S=Math.min(y.y,v.y,T.y,x.y);var w=Math.max(y.x,v.x,T.x,x.x);var P=Math.max(y.y,v.y,T.y,x.y);if(a&&a.enable){A-=a.paddingLeft;S-=a.paddingTop;w+=a.paddingRight;P+=a.paddingBottom}s=Math.min(s,A);o=Math.min(o,S);h=Math.max(h,w);l=Math.max(l,P)}}if(a&&a.enable){s-=a.marginLeft;o-=a.marginTop;h+=a.marginRight;l+=a.marginBottom}t.x=Math.min(t.x,s);t.y=Math.min(t.y,o);e.x=Math.max(e.x,h);e.y=Math.max(e.y,l)};Fe.getBounds=function(t,e,i,r){r=typeof r==="undefined"||r===null?0:r;var a=t.getScript("qc.Bounds");if(a&&a.enable){return a.getBounds(i)}var n=new pt.Point(0,0);var s=new pt.Point(0,0);Fe._calcBounds(n,s,e,t,r);var o=new pt.Rectangle(0,0,0,0);o.x=n.x;o.y=n.y;o.width=s.x-n.x;o.height=s.y-n.y;return o};Fe.getCorners=function(t,e,i,r,a){var n=Fe.getBounds(t,e,i,r);var s=t.worldTransform;var o=a&&a.worldTransform;if(e===Fe.USE_RECTTRANSFORM){var h=Fe.findCommonRoot(t,a||t.game.world);var l=0;var u=0;var f=t;while(f&&f!==t.game.world&&f!==h){l+=f.x;u+=f.y;f=f.parent}f=a;while(f&&f!==t.game.world&&f!==h){l-=f.x;u-=f.y}var c=new pt.Point(n.x+l,n.y+u);var p=new pt.Point(n.x+n.width+l,n.y+u);var d=new pt.Point(n.x+n.width+l,n.y+n.height+u);var _=new pt.Point(n.x+l,n.y+n.height+u);return[c,p,d,_]}else{var c=new pt.Point(n.x,n.y);var p=new pt.Point(n.x+n.width,n.y);var d=new pt.Point(n.x+n.width,n.y+n.height);var _=new pt.Point(n.x,n.y+n.height);return!o?[s.apply(c),s.apply(p),s.apply(d),s.apply(_)]:[o.applyInverse(s.apply(c)),o.applyInverse(s.apply(p)),o.applyInverse(s.apply(d)),o.applyInverse(s.apply(_))]}};Fe.getBox=function(t,e,i,r,a){var n=Fe.getCorners(t,e,i,r,a);var s=new pt.Point(-Number.MAX_VALUE,-Number.MAX_VALUE);var o=new pt.Point(Number.MAX_VALUE,Number.MAX_VALUE);for(var h=0;h<4;h++){var l=n[h];s.x=Math.max(s.x,l.x);s.y=Math.max(s.y,l.y);o.x=Math.min(o.x,l.x);o.y=Math.min(o.y,l.y)}return new pt.Rectangle(o.x,o.y,s.x-o.x,s.y-o.y)};Fe.getContentRect=function(t){var e=t.rect;var i=t.getScript("qc.Bounds");if(i&&i.enable){e.x+=i.paddingLeft;e.y+=i.paddingTop;e.width-=i.paddingLeft+i.paddingRight;e.height-=i.paddingTop+i.paddingBottom}return e};Fe.getMargin=function(t){var e=t.getScript("qc.Bounds");if(e&&e.enable){return{top:e._marginTop,bottom:e._marginBottom,left:e._marginLeft,right:e._marginRight}}else{return{top:0,bottom:0,left:0,right:0}}};Fe.findCommonRoot=function(t,e){if(!t||!e){return null}var i=t;var r=e;while(i){r=e;while(r){if(i===r){return i}r=r.parent}i=i.parent}return null};Fe.USE_BOUNDS=0;Fe.USE_RECTTRANSFORM=1;var ke=w("qc.LayoutElement",pt.Bounds,function(){this.ignoreLayout=false;this.minWidth=-1;this.minHeight=-1;this.preferredWidth=-1;this.preferredHeight=-1;this.flexibleWidth=-1;this.flexibleHeight=-1;this._deep=0},{ignoreLayout:pt.Serializer.BOOLEAN,minWidth:pt.Serializer.NUMBER,minHeight:pt.Serializer.NUMBER,preferredWidth:pt.Serializer.NUMBER,preferredHeight:pt.Serializer.NUMBER,flexibleWidth:pt.Serializer.NUMBER,flexibleHeight:pt.Serializer.NUMBER});ke.__menu="UI/Layout/LayoutElement";P.defineProperties(ke.prototype,{ignoreLayout:{get:function(){return this._ignoreLayout},set:function(t){if(t===this._ignoreLayout)return;this._ignoreLayout=t}},minWidth:{get:function(){return this._minWidth},set:function(t){if(t===this._minWidth)return;this._minWidth=t;this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")}},minHeight:{get:function(){return this._minHeight},set:function(t){if(t===this._minHeight)return;this._minHeight=t;this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")}},preferredWidth:{get:function(){return this._preferredWidth},set:function(t){if(t===this._preferredWidth)return;this._preferredWidth=t;this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")}},preferredHeight:{get:function(){return this._preferredHeight},set:function(t){if(t===this._preferredHeight)return;this._preferredHeight=t;this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")}},flexibleWidth:{get:function(){return this._flexibleWidth},set:function(t){if(t===this._flexibleWidth)return;this._flexibleWidth=t;this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")}},flexibleHeight:{get:function(){return this._flexibleHeight},set:function(t){if(t===this._flexibleHeight)return;this._flexibleHeight=t;this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")}},hasMinWidth:{get:function(){return this.minWidth>=0},set:function(t){if(this.hasMinWidth===t){return}this.minWidth=t?0:-1}},hasMinHeight:{get:function(){return this.minHeight>=0},set:function(t){if(this.hasMinHeight===t){return}this.minHeight=t?0:-1}},hasPreferredWidth:{get:function(){return this.preferredWidth>=0},set:function(t){if(this.hasPreferredWidth===t){return}this.preferredWidth=!t?-1:this.gameObject?this.gameObject.width:0}},hasPreferredHeight:{get:function(){return this.preferredHeight>=0},set:function(t){if(this.hasPreferredHeight===t){return}this.preferredHeight=!t?-1:this.gameObject?this.gameObject.height:0}},hasFlexibleWidth:{get:function(){return this.flexibleWidth>=0},set:function(t){if(this.hasFlexibleWidth===t){return}this.flexibleWidth=t?1:-1}},hasFlexibleHeight:{get:function(){return this.flexibleHeight>=0},set:function(t){if(this.hasFlexibleHeight===t){return}this.flexibleHeight=t?1:-1}}});ke.getLayoutElement=function(t){var e=new ke;var i=t.getScript("qc.LayoutElement");if(i&&!i.ignoreLayout){e.ignoreLayout=i.ignoreLayout;e.minWidth=i.minWidth;e.minHeight=i.minHeight;e.preferredWidth=i.preferredWidth;e.preferredHeight=i.preferredHeight;e.flexibleWidth=i.flexibleWidth;e.flexibleHeight=i.flexibleHeight}return e};ke.USE_RECTTRANSFORM=pt.Bounds.USE_RECTTRANSFORM;ke.USE_BOUNDS=pt.Bounds.USE_BOUNDS;var Ue=w("qc.TableLayout",pt.Bounds,function(){this._cellStyle=[[this._buildCellInfo()]];this._constraint=Ue.CONSTRAINT_FLEXIBLE;this.runInEditor=true;this.cellAlignment=Ue.ALIGN_TOP_LEFT;this.gameObject.onChildrenChanged.add(this._doChildrenChanged,this);this.gameObject.onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this)},{constraint:pt.Serializer.NUMBER,stride:pt.Serializer.NUMBER,startCorner:pt.Serializer.NUMBER,startAxis:pt.Serializer.NUMBER,contentSizeProvider:pt.Serializer.NUMBER,style:pt.Serializer.NUMBER,_cellStyle:pt.Serializer.MAPPING,autoUpdate:pt.Serializer.BOOLEAN,contentAlignment:pt.Serializer.NUMBER,cellAlignment:pt.Serializer.NUMBER,spacingX:pt.Serializer.NUMBER,spacingY:pt.Serializer.NUMBER,ignoreX:pt.Serializer.BOOLEAN,ignoreY:pt.Serializer.BOOLEAN});Ue.__menu="UI/Layout/TableLayout";Ue._precision=1e-7;P.defineProperties(Ue.prototype,{constraint:{get:function(){return isNaN(this._constraint)?Ue.CONSTRAINT_FLEXIBLE:this._constraint},set:function(t){if(this._constraint===t){return}this._constraint=t;this.rebuildTable()}},stride:{get:function(){return isNaN(this._stride)?0:this._stride},set:function(t){if(t===this._stride){return}this._stride=t;this.rebuildTable()}},startCorner:{get:function(){return this._startCorner||Ue.CORNER_TOP_LEFT},set:function(t){if(t===this._startCorner){return}this._startCorner=t;this.rebuildTable()}},startAxis:{get:function(){return this._startAxis||Ue.AXIS_HORIZONTAL},set:function(t){if(t===this._startAxis){return}this._startAxis=t;this.rebuildTable()}},contentSizeProvider:{get:function(){return this._contentSizeProvider||Ue.USE_BOUNDS},set:function(t){if(t===this._contentSizeProvider){return}this._contentSizeProvider=t;this.rebuildTable()}},style:{get:function(){return this._style||Ue.STYLE_WRAP_ELEMENT},set:function(t){if(t===this._style){return}this._style=t;this.rebuildTable()}},autoUpdate:{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate=t}},spacingX:{get:function(){return this._spacingX||0},set:function(t){if(this._spacingX===t){return}this._spacingX=t;this.rebuildTable()}},spacingY:{get:function(){return this._spacingY||0},set:function(t){if(this._spacingY===t){return}this._spacingY=t;this.rebuildTable()}},cellWidth:{get:function(){return this.getCellStyle(null,null).cellWidth},set:function(t){this.setCellStyle(null,null,null,null,null,null,null,t)}},cellHeight:{get:function(){return this.getCellStyle(null,null).cellHeight},set:function(t){this.setCellStyle(null,null,null,null,null,null,null,null,t)}},contentAlignment:{get:function(){return this._contentAlignment||Ue.ALIGN_TOP_LEFT},set:function(t){if(this._contentAlignment===t){return}this._contentAlignment=t;this.rebuildTable()}},cellAlignment:{get:function(){return this.getCellStyle(null,null).align},set:function(t){if(this.cellAlignment===t){return}this.setCellStyle(null,null,t);this.rebuildTable()}},columnsCount:{get:function(){var t=this._calcColumnRow();return t.x}},rowsCount:{get:function(){var t=this._calcColumnRow();return t.y}},ignoreX:{get:function(){return!!this._ignoreX},set:function(t){if(this._ignoreX===t)return;this._ignoreX=t}},ignoreY:{get:function(){return!!this._ignoreY},set:function(t){if(this._ignoreY===t)return;this._ignoreY=t}}});Ue.prototype.postUpdate=function(){if(this.enable&&(this.autoUpdate||this._needRebuildTable)){this.rebuildTable();this._needRebuildTable=false}};Ue.prototype._getChildrenCount=function(){var t=0;var e=this.gameObject.children;for(var i=0;i<e.length;++i){if(e[i]&&e[i].isWorldVisible()){t++}}return t};Ue.prototype._getChildren=function(){var t=[];var e=this.gameObject.children;for(var i=0;i<e.length;++i){if(e[i]&&e[i].isWorldVisible()){t.push(e[i])}}return t};Ue.prototype._mixinStyle=function(t,e){return{align:((e.align&240)===0?t.align&240:e.align&240)|((e.align&15)===0?t.align&15:e.align&15),timestamp:Math.max(e.timestamp,t.timestamp),paddingLeft:isNaN(e.paddingLeft)?t.paddingLeft:e.paddingLeft,paddingRight:isNaN(e.paddingRight)?t.paddingRight:e.paddingRight,paddingTop:isNaN(e.paddingTop)?t.paddingTop:e.paddingTop,paddingBottom:isNaN(e.paddingBottom)?t.paddingBottom:e.paddingBottom,cellWidth:isNaN(e.cellWidth)?t.cellWidth:e.cellWidth,cellHeight:isNaN(e.cellHeight)?t.cellHeight:e.cellHeight}};Ue._calcRectTransform=function(t,e){e=isNaN(e)?0:e;var i=t.rect;if(e!==0){return i}var r=t.children;var a=r.length;while(a--){var n=Ue._calcRectTransform(r[a],e-1);i.x=Math.min(i.x,n.x);i.y=Math.min(i.y,n.y);i.w=Math.max(i.x+i.width,n.x+n.width)-i.x;i.h=Math.max(i.y+i.height,n.y+n.height)-i.y}return i};Ue.prototype.getCellRect=function(t,e){return pt.Bounds.getBox(t,this.contentSizeProvider,e,0,this.gameObject)};Ue.prototype.getCellStyle=function(t,e){t=t==null?0:t+1;e=e==null?0:e+1;var i=this._cellStyle[0][0];var r=this._cellStyle[e]&&this._cellStyle[e][0];var a=this._cellStyle[0][t];if(!a||r&&r.timestamp>a.timestamp){a&&(i=this._mixinStyle(i,a));r&&(i=this._mixinStyle(i,r))}else{r&&(i=this._mixinStyle(i,r));a&&(i=this._mixinStyle(i,a))}var n=this._cellStyle[e]&&this._cellStyle[e][t];n&&(i=this._mixinStyle(i,n));i.paddingTop=isNaN(i.paddingTop)?0:i.paddingTop;i.paddingLeft=isNaN(i.paddingLeft)?0:i.paddingLeft;i.paddingRight=isNaN(i.paddingRight)?0:i.paddingRight;i.paddingBottom=isNaN(i.paddingBottom)?0:i.paddingBottom;i.cellWidth=isNaN(i.cellWidth)?0:i.cellWidth;i.cellHeight=isNaN(i.cellHeight)?0:i.cellHeight;return i};Ue.prototype.setCellStyle=function(t,e,i,r,a,n,s,o,h){t=t==null?0:t+1;e=e==null?0:e+1;if(!this._cellStyle[e]){this._cellStyle[e]=[]}if(!this._cellStyle[e][t])this._cellStyle[e][t]=this._buildCellInfo();var l=this._cellStyle[e][t];i!=null&&(l.align=i);r!=null&&(l.paddingTop=r);a!=null&&(l.paddingRight=a);n!=null&&(l.paddingBottom=n);s!=null&&(l.paddingLeft=s);o!=null&&(l.cellWidth=o);h!=null&(l.cellHeight=h);this._cellStyle[e][t].timestamp=this.gameObject.game.time.fixedTime;this.rebuildTable()};Ue.prototype.clearCellStyle=function(t,e){t=t==null?0:t+1;e=e==null?0:e+1;if(t===0&&e===0){this._cellStyle[0][0]=this._buildCellInfo();return}this._cellStyle[e]&&this._cellStyle[e][t]&&(this._cellStyle[e][t]=null)};Ue.prototype._buildCellInfo=function(){return{align:0,timestamp:0,paddingLeft:NaN,paddingRight:NaN,paddingTop:NaN,paddingBottom:NaN,cellWidth:NaN,cellHeight:NaN}};Ue.prototype._calcColumnRow=function(){var t=this._getChildrenCount();var e=this.stride;var i=this.constraint;if(i===Ue.CONSTRAINT_FLEXIBLE){var r=this.getCellStyle(null,null);var a=pt.Bounds.getContentRect(this.gameObject);if(this.startAxis===Ue.AXIS_HORIZONTAL){e=Math.min(Math.max(1,Math.floor((a.width+this.spacingX)/(r.cellWidth+this.spacingX))),t);i=Ue.CONSTRAINT_FIX_COLUMN_COUNT}else{e=Math.min(Math.max(1,Math.floor((a.height+this.spacingY)/(r.cellHeight+this.spacingY))),t);i=Ue.CONSTRAINT_FIX_ROW_COUNT}}var n=i===Ue.CONSTRAINT_FIX_ROW_COUNT?Math.ceil(t/e):e;var s=i===Ue.CONSTRAINT_FIX_ROW_COUNT?e:Math.ceil(t/e);return new pt.Point(n,s)};Ue.prototype._calcPos=function(t,e){var i=this._calcColumnRow();e=e||new pt.Point(0,0);if(this.startAxis===Ue.AXIS_HORIZONTAL){e.x=t%i.x;e.y=Math.floor(t/i.x)}else{e.x=Math.floor(t/i.y);e.y=t%i.y}(this.startCorner&240)!==0&&(e.x=i.x-1-e.x);(this.startCorner&15)!==0&&(e.y=i.y-1-e.y);return e};Ue.prototype._setCellPosition=function(t,e){if(!this.ignoreX||this.columnsCount>1){var i=t.node.x;if((t.style.align&Ue.ALIGN_RIGHT)!==0){i+=e.x-t.bounds.x+(e.width-t.bounds.width)}else if((t.style.align&Ue.ALIGN_CENTER)!==0){i+=e.x-t.bounds.x+(e.width-t.bounds.width)/2}else{i+=e.x-t.bounds.x}if(Math.abs(i-t.node.x)>Ue._precision){t.node.x=i}}if(!this.ignoreY||this.rowsCount>1){var r=t.node.y;if((t.style.align&Ue.ALIGN_BOTTOM)!==0){r+=e.y-t.bounds.y+(e.height-t.bounds.height)}else if((t.style.align&Ue.ALIGN_MIDDLE)!==0){r+=e.y-t.bounds.y+(e.height-t.bounds.height)/2}else{r+=e.y-t.bounds.y}if(Math.abs(r-t.node.y)>Ue._precision){t.node.y=r}}};Ue.prototype._setCellSize=function(t,e,i){if(Math.abs(t.bounds.width-e)<Ue._precision&&Math.abs(t.bounds.height-i)<Ue._precision){return}var r=Fe.getMargin(t.node);var a=e-r.left-r.right,n=i-r.top-r.bottom,s=t.bounds.width-r.left-r.right,o=t.bounds.height-r.top-r.bottom;t.node.setAnchor(new pt.Point(0,0),new pt.Point(0,0),false);t.node.x=0;t.node.y=0;s<=0?t.node.width=a:t.node.width*=a/s;o<=0?t.node.height=n:t.node.height*=n/o;t.node.setStretch(0,0,0,0);t.bounds=this.getCellRect(t.node,true)};Ue.prototype.relayout=function(){this.rebuildTable()};Ue.prototype.rebuildTable=function(){var t=this.getCellStyle(null,null);if(this.style===Ue.STYLE_WRAP_ELEMENT){this._rebuildWrapTable()}else{this._rebuildResizeTable()}};Ue.prototype._getDefaultLayout=function(t){return{min:0,preferred:0,flexible:0,extra:0}};Ue.prototype.getCellLayout=function(t){return pt.LayoutElement.getLayoutElement(t)};Ue.prototype._rebuildResizeTable=function(){var t=this._getChildren();var e=[];var i=[];var r=[];var a=[];var n=[];var s=t.length;var o=new pt.Point(0,0);var h=-1;while(++h<s){this._calcPos(h,o);var l=this.getCellLayout(t[h]);var u=this.getCellStyle(o.x,o.y);var f=this.getCellRect(t[h]);(e[o.y]||(e[o.y]=[]))[o.x]={node:t[h],layout:l,bounds:f,style:u};var c=a[o.x]||(a[o.x]=this._getDefaultLayout("x"));var p=n[o.y]||(n[o.y]=this._getDefaultLayout("y"));l.preferredWidth<0&&t[h].nativeSize&&(l.preferredWidth=t[h].nativeSize.width);l.preferredHeight<0&&t[h].nativeSize&&(l.preferredHeight=t[h].nativeSize.height);if(!isNaN(u.cellWidth)&&u.cellWidth>0){l.minWidth=u.cellWidth;l.preferredWidth=u.cellWidth}if(!isNaN(u.cellHeight)&&u.cellHeight>0){l.minHeight=u.cellHeight;l.preferredHeight=u.cellHeight}l.minWidth>=0&&(c.min=Math.max(c.min,l.minWidth));l.minHeight>=0&&(p.min=Math.max(p.min,l.minHeight));c.preferred=Math.max(c.preferred,l.preferredWidth,c.min);p.preferred=Math.max(p.preferred,l.preferredHeight,c.min);l.flexibleWidth>=0&&(c.flexible=Math.max(c.flexible,l.flexibleWidth));l.flexibleHeight>=0&&(p.flexible=Math.max(p.flexible,l.flexibleHeight));c.extra=Math.max(c.extra,u.paddingLeft+u.paddingRight);p.extra=Math.max(p.extra,u.paddingTop+u.paddingBottom)}var d={min:0,preferred:0,flexible:0,extra:0,fixed:0};var _={min:0,preferred:0,flexible:0,extra:0,fixed:0};a.forEach(function(t){d.min+=t.min;d.preferred+=t.preferred;d.flexible+=t.flexible;d.extra+=t.extra});n.forEach(function(t){_.min+=t.min;_.preferred+=t.preferred;_.flexible+=t.flexible;_.extra+=t.extra});var g=pt.Bounds.getContentRect(this.gameObject);var m=Math.max(0,a.length-1)*this.spacingX;var y=Math.max(0,n.length-1)*this.spacingY;var v=new pt.Point(0,0);if(g.width<=d.min+d.extra+m){for(var T=0;T<a.length;++T){if(!a[T]){i[T]=0;continue}i[T]=a[T].min+a[T].extra}}else if(g.width<=d.preferred+d.extra+m){var x=g.width-d.extra-d.min-m;for(var T=0;T<a.length;++T){if(!a[T]){i[T]=0;continue}i[T]=x*a[T].preferred/(d.preferred||1)+a[T].min+a[T].extra}}else{var x=g.width-d.extra-d.preferred-m;for(var T=0;T<a.length;++T){if(!a[T]){i[T]=0;continue}i[T]=x*a[T].flexible/(d.flexible||1)+a[T].preferred+a[T].extra}if(d.flexible===0){if((this.contentAlignment&Ue.ALIGN_RIGHT)!==0){v.x=x}else if((this.contentAlignment&Ue.ALIGN_CENTER)!==0){v.x=x/2}}}if(g.height<=_.min+_.extra+y){for(var T=0;T<n.length;++T){if(!n[T]){r[T]=0;continue}r[T]=n[T].min+n[T].extra}}else if(g.height<=_.preferred+_.extra+y){var x=g.height-_.extra-_.min-y;for(var T=0;T<n.length;++T){if(!n[T]){r[T]=0;continue}r[T]=x*n[T].preferred/(_.preferred||1)+n[T].min+n[T].extra}}else{var x=g.height-_.extra-_.preferred-y;for(var T=0;T<n.length;++T){if(!n[T]){r[T]=0;continue}r[T]=x*n[T].flexible/(_.flexible||1)+n[T].preferred+n[T].extra}if(_.flexible===0){if((this.contentAlignment&Ue.ALIGN_BOTTOM)!==0){v.y=x}else if((this.contentAlignment&Ue.ALIGN_MIDDLE)!==0){v.y=x/2}}}var b=pt.Bounds.getContentRect(this.gameObject);var A=new pt.Rectangle(0,0,0,0);var S=0;var w=0;for(var P=0;P<r.length;P++){S=0;for(var E=0;E<i.length;E++){var D=e[P][E];if(!D){S+=i[E]+this.spacingX;continue}A.x=b.x+S+D.style.paddingLeft+v.x;A.y=b.y+w+D.style.paddingTop+v.y;A.width=i[E]-D.style.paddingLeft-D.style.paddingRight;A.height=r[P]-D.style.paddingTop-D.style.paddingBottom;var C=A.width;var O=A.height;if(D.layout.flexibleWidth<=0&&A.width>D.layout.preferredWidth&&D.layout.preferredWidth>0){C=D.layout.preferredWidth}if(D.layout.flexibleHeight<=0&&A.height>D.layout.preferredHeight&&D.layout.preferredHeight>0){O=D.layout.preferredHeight}this._setCellSize(D,C,O);this._setCellPosition(D,A);S+=i[E]+this.spacingX}w+=r[P]+this.spacingY}};Ue.prototype._rebuildWrapTable=function(){var t=this._getChildren();var e=[];var i=[];var r=[];var a=t.length;var n=new pt.Point(0,0);while(a--){this._calcPos(a,n);var s=this.getCellStyle(n.x,n.y);var o=this.getCellRect(t[a]);(e[n.y]||(e[n.y]=[]))[n.x]={node:t[a],bounds:o,style:s};if(s.cellWidth>0){i[n.x]=s.cellWidth}else{i[n.x]=Math.max(o.width+s.paddingLeft+s.paddingRight,i[n.x]||0,s.cellWidth)}if(s.cellHeight>0){r[n.y]=s.cellHeight}else{r[n.y]=Math.max(o.height+s.paddingTop+s.paddingBottom,r[n.y]||0,s.cellHeight)}}var h=0;var l=0;for(var u=0;u<i.length;u++){h+=i[u]}for(var f=0;f<r.length;f++){l+=r[f]}var c=pt.Bounds.getContentRect(this.gameObject);var p=new pt.Point(0,0);if((this.contentAlignment&Ue.ALIGN_BOTTOM)!==0){p.y=c.height-l}else if((this.contentAlignment&Ue.ALIGN_MIDDLE)!==0){p.y=(c.height-l)/2}if((this.contentAlignment&Ue.ALIGN_RIGHT)!==0){p.x=c.width-h}else if((this.contentAlignment&Ue.ALIGN_CENTER)!==0){p.x=(c.width-h)/2}var d=new pt.Rectangle(0,0,0,0);var _=0;var g=0;for(var f=0;f<r.length;f++){_=0;for(var u=0;u<i.length;u++){var m=e[f][u];if(!m){var s=this.getCellStyle(u,f);var y=i[u]===C?s.cellWidth:i[u];_+=y+this.spacingX;continue}d.x=c.x+_+m.style.paddingLeft+p.x;d.y=c.y+g+m.style.paddingTop+p.y;d.width=i[u]-m.style.paddingLeft-m.style.paddingRight;d.height=r[f]-m.style.paddingTop-m.style.paddingBottom;this._setCellPosition(m,d);_+=i[u]+this.spacingX}g+=r[f]+this.spacingY}};Ue.prototype._doChildrenChanged=function(t){var e=t.children.length;if(t.type==="add"){while(e--){if(t.children[e]){t.children[e].onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this)}}}else if(t.type==="remove"){while(e--){if(t.children[e]){t.children[e].onLayoutArgumentChanged.remove(this._doLayoutArgumentChanged,this)}}}this._needRebuildTable=true};Ue.prototype._doLayoutArgumentChanged=function(){this._needRebuildTable=true};Ue.CONSTRAINT_FLEXIBLE=0;Ue.CONSTRAINT_FIX_COLUMN_COUNT=1;Ue.CONSTRAINT_FIX_ROW_COUNT=2;Ue.STYLE_WRAP_ELEMENT=0;Ue.STYLE_RESIZE_ELEMENT=1;Ue.USE_RECTTRANSFORM=pt.LayoutElement.USE_RECTTRANSFORM;Ue.USE_BOUNDS=pt.LayoutElement.USE_BOUNDS;Ue.AXIS_HORIZONTAL=0;Ue.AXIS_VERTICAL=1;Ue.CORNER_TOP_LEFT=0;Ue.CORNER_TOP_RIGHT=16;Ue.CORNER_BOTTOM_RIGHT=17;Ue.CORNER_BOTTOM_LEFT=1;Ue.ALIGN_LEFT=1;Ue.ALIGN_CENTER=2;Ue.ALIGN_RIGHT=4;Ue.ALIGN_TOP=16;Ue.ALIGN_MIDDLE=32;Ue.ALIGN_BOTTOM=64;Ue.ALIGN_TOP_LEFT=Ue.ALIGN_TOP|Ue.ALIGN_LEFT;Ue.ALIGN_TOP_CENTER=Ue.ALIGN_TOP|Ue.ALIGN_CENTER;Ue.ALIGN_TOP_RIGHT=Ue.ALIGN_TOP|Ue.ALIGN_RIGHT;Ue.ALIGN_MIDDLE_LEFT=Ue.ALIGN_MIDDLE|Ue.ALIGN_LEFT;Ue.ALIGN_MIDDLE_CENTER=Ue.ALIGN_MIDDLE|Ue.ALIGN_CENTER;Ue.ALIGN_MIDDLE_RIGHT=Ue.ALIGN_MIDDLE|Ue.ALIGN_RIGHT;Ue.ALIGN_BOTTOM_LEFT=Ue.ALIGN_BOTTOM|Ue.ALIGN_LEFT;Ue.ALIGN_BOTTOM_CENTER=Ue.ALIGN_BOTTOM|Ue.ALIGN_CENTER;Ue.ALIGN_BOTTOM_RIGHT=Ue.ALIGN_BOTTOM|Ue.ALIGN_RIGHT;var je=w("qc.Animator",pt.Behaviour,function(){var t=this;t.animatorMap={};t.animatorList=[];t.animators=null;t.runInEditor=true},{animators:pt.Serializer.ANIMATORS,playActionManager:pt.Serializer.STRING});je.__menu="Action/Animator";P.defineProperties(je.prototype,{animators:{get:function(){return this._animators},set:function(t){for(var e=0;e<this.animatorList.length;e++){var i=this.animatorList[e];if(i)i.destroy()}this.animatorMap={};this.animatorList=[];this._animators=t;if(!t)return;for(var e=0;e<t.length;e++){var r=t[e];if(!r)continue;if(r instanceof pt.ActionManagerAsset)this.animatorList[e]=pt.ActionManager.restoreBundle(r,this.game,!this.game.serializer.isRestoring);else if(r instanceof pt.ActionAsset)this.animatorList[e]=pt.Action.restoreBundle(r,this.game,!this.game.serializer.isRestoring);if(!this.animatorList[e].targetLocked)this.animatorList[e].targetObject=this.gameObject;var a=this.animatorList[e].name;if(this.animatorMap[a])this.gameObject.game.log.error("Exist duplicate action's name: {0}",a);this.animatorMap[a]=this.animatorList[e]}}}});je.prototype.awake=function(){if(this.animatorList.length<1)return;for(var t=0;t<this.animatorList.length;t++)if(this.animatorList[t])this.animatorList[t].awake()};je.prototype.refresh=function(){var t=this.playActionManager;if(ps.ScrFix.isP){console.log("Animator.refresh.p");if(!qici.config.editor){for(var e in this.gameObject.children){if(this.gameObject.children[e].uuid===t){this.gameObject.children[e].visible=true}else{this.gameObject.children[e].visible=false}}this.play(this.playActionManager)}}else{console.log("Animator.refresh.l");if(!qici.config.editor){for(var e in this.gameObject.children){if(this.gameObject.children[e].uuid===t){this.gameObject.children[e].visible=true}else{this.gameObject.children[e].visible=false}}this.play(this.playActionManager)}}};je.prototype.update=function(){for(var t=0;t<this.animatorList.length;t++){var e=this.animatorList[t];if(!e||!e.isRunning)continue;e.update()}};je.prototype.getAction=function(t){return this.animatorMap[t]||this.animatorList[t]};je.prototype.play=function(t,e,i){t=t||0;this.playActionManager=t;var r=this.getAction(t);if(!r)return;e=e||this.gameObject;i=typeof i==="boolean"?i:true;var a=pt.gameOb.world.children[0]._findByName("gamePlay").getScript("ps.VideoManager");if(typeof a!=="undefined"){a.setVideoAllHide()}r.playAction(e,i)};je.prototype.stop=function(t){t=t||0;var e=this.getAction(t);if(!e)return;e.stop()};je.prototype.destroy=function(){this.animators=null;pt.Behaviour.prototype.destroy.call(this)};je.prototype.vpEmitEvent=function(t){console.log(t);ps.mainState.dispatch("VPEMITEVENT",t)};var We=w("qc.AspectRatioFitter",pt.Behaviour,function(){var t=this;t.mode=We.NONE;t.ratio=1;t.runInEditor=true},{mode:pt.Serializer.NUMBER,ratio:pt.Serializer.NUMBER});We.__menu="UI/AspectRatioFitter";P.defineProperties(We.prototype,{mode:{get:function(){return this._mode||We.NONE},set:function(t){if(this.mode===t)return;this._mode=t;this._reset()}},ratio:{get:function(){return this._ratio||1},set:function(t){if(t<=0)t=.001;if(this.ratio===t)return;this._ratio=t;this._reset()}}});We.NONE=0;We.WIDTH_CONTROLS_HEIGHT=1;We.HEIGHT_CONTROLS_WIDTH=2;We.FIT_IN_PARENT=3;We.ENVELOPE_PARENT=4;We.prototype.awake=function(){var t=this;t._reset();var e=t.gameObject;t.addListener(e.onRelayout,function(){t._reset()})};We.prototype._reset=function(){var t=this;if(t.mode===We.NONE)return;var e=t.gameObject;if(t.mode===We.WIDTH_CONTROLS_HEIGHT){e.height=e.width/t.ratio;return}if(t.mode===We.HEIGHT_CONTROLS_WIDTH){e.width=e.height*t.ratio;return}var i=e.parent.rect;e.setAnchor(new pt.Point(0,0),new pt.Point(1,1));if(t.mode===We.FIT_IN_PARENT){var r=i.width;var a=r/t.ratio;if(a>i.height){a=i.height;r=a*t.ratio}e.setStretch((i.width-r)/2,(i.width-r)/2,(i.height-a)/2,(i.height-a)/2);return}if(t.mode===We.ENVELOPE_PARENT){var r=i.width;var a=r/t.ratio;if(a<i.height){a=i.height;r=a*t.ratio}e.setStretch((i.width-r)/2,(i.width-r)/2,(i.height-a)/2,(i.height-a)/2);return}};var Ve=w("qc.CacheAsBitmap",pt.Behaviour,function(){this._boundsType=Ve.BOUNDS_SELF;this._cacheType=Ve.CACHE_FOR_SCREEN;this._dirty=true;this.boundsInScreen=false;this.runInEditor=true;this.offX=0;this.offY=0},{boundsType:pt.Serializer.NUMBER,cacheType:pt.Serializer.NUMBER,boundsInScreen:pt.Serializer.BOOLEAN});Ve.__menu="UI/CacheAsBitmap";P.defineProperties(Ve.prototype,{boundsType:{get:function(){return this._boundsType},set:function(t){if(this._boundsType===t){return}this._boundsType=t;this.dirty=true}},cacheType:{get:function(){return this._cacheType},set:function(t){if(this._cacheType===t){return}this._cacheType=t;this.dirty=true}},dirty:{get:function(){return this._dirty},set:function(t){if(this._dirty===t){return}this._dirty=t}}});Ve.prototype.awake=function(){var t=this,e=t.gameObject;t.addListener(t.game.assets.webFontLoaded,t._setDirty,t);e.onRelayout.add(t._setDirty,t)};Ve.prototype._setDirty=function(){this.dirty=true};Ve.prototype.onEnable=function(){var t=this,e=t.gameObject;if(e._destroy){return}if(!t._cache){t._cache=new pt.RenderTexture(100,100,this.game.phaser.render,null,this.game.resolution);t._cacheSprite=new _t.Sprite(t._cache)}t.dirty=true;t.gameObject.phaser.setDisplayProxy(t._cacheSprite,true);if(!t._nodeRenderCanvas){t._nodeRenderCanvas=t.gameObject.phaser._renderCanvas;t.gameObject.phaser._renderCanvas=t.renderCanvas.bind(t)}if(!t._nodeRenderWebGL){t._nodeRenderWebGL=t.gameObject.phaser._renderWebGL;t.gameObject.phaser._renderWebGL=t.renderWebGL.bind(t)}};Ve.prototype.onDisable=function(){var t=this;t.gameObject.phaser.setDisplayProxy(null,false);t.gameObject._notifyCacheChanged(false);if(t._nodeRenderCanvas){t.gameObject.phaser._renderCanvas=t._nodeRenderCanvas;t._nodeRenderCanvas=null}if(t._nodeRenderWebGL){t.gameObject.phaser._renderWebGL=t._nodeRenderWebGL;t._nodeRenderWebGL=null}};Ve.prototype.onDestroy=function(){var t=this;t.gameObject._notifyCacheChanged(false);if(t._nodeRenderCanvas){t.gameObject.phaser._renderCanvas=t._nodeRenderCanvas;t._nodeRenderCanvas=null}if(t._nodeRenderWebGL){t.gameObject.phaser._renderWebGL=t._nodeRenderWebGL;t._nodeRenderWebGL=null}if(t._cache){t._cache.destroy(true);t._cache=null}if(t._cacheSprite){t._cacheSprite=null}t.gameObject.onRelayout.remove(t._setDirty,t)};Ve.prototype._updateCache=function(){var t=this,e=t._cache,i=t._cacheSprite;t._updatingCache=true;var r=null;if(this._cacheType!==Ve.CACHE_FOR_SCREEN)r=t._cacheBounds=t.getLocalBounds();else r=t._cacheBounds=t.getBounds();if(t.boundsInScreen){if(r.x<0){r.width+=r.x;r.x=0}if(r.y<0){r.height+=r.y;r.y=0}r.width=Math.round(Math.max(1,Math.min(t.game.width*t.game.resolution-r.x,r.width)));r.height=Math.round(Math.max(1,Math.min(t.game.height*t.game.resolution-r.y,r.height)))}else{r.width=Math.round(r.width);r.height=Math.round(r.height)}e.resize(r.width+(r.width&1),r.height+(r.height&1),true);var a=t.gameObject.worldTransform;if(this._cacheType!==Ve.CACHE_FOR_SCREEN){var n=i.worldTransform;n.a=a.a;n.b=a.b;n.c=a.c;n.d=a.d;n.tx=a.tx;n.ty=a.ty;_t.DisplayObject._tempMatrix.tx=-r.x;_t.DisplayObject._tempMatrix.ty=-r.y;e.render(t.gameObject.phaser,_t.DisplayObject._tempMatrix,true);i.anchor.x=-(r.x/r.width);i.anchor.y=-(r.y/r.height)}else{t.offX=r.x-a.tx;t.offY=r.y-a.ty;i.anchor.x=0;i.anchor.y=0;Ve._tempMatrix.a=a.a;Ve._tempMatrix.b=a.b;Ve._tempMatrix.c=a.c;Ve._tempMatrix.d=a.d;Ve._tempMatrix.tx=Math.round(a.tx-r.x);Ve._tempMatrix.ty=Math.round(a.ty-r.y);e.render(t.gameObject.phaser,Ve._tempMatrix,true);a=i.worldTransform;a.identity();a.tx=r.x;a.ty=r.y}t._updatingCache=false;t.dirty=false;t.gameObject._isTransformDirty=true;i.displayChanged(pt.DisplayChangeStatus.TEXTURE|pt.DisplayChangeStatus.SIZE);t.gameObject.phaser.displayChanged(pt.DisplayChangeStatus.TEXTURE|pt.DisplayChangeStatus.SIZE);e.baseTexture.scaleMode=_t.scaleModes.NEAREST};Ve.prototype.postUpdate=function(){var t=this,e=t._cacheSprite;t._updateCache();if(t.dirty){t.game.log.trace("[CacheAsBitmap]Update Cache.")}else if(t._cacheType!==Ve.CACHE_FOR_SCREEN){var i=e.worldTransform,r=t.gameObject.worldTransform;i.a=r.a;i.b=r.b;i.c=r.c;i.d=r.d;i.tx=r.tx;i.ty=r.ty}else{var a=t.gameObject.worldTransform;var r=e.worldTransform;r.identity();r.tx=a.tx+t.offX;r.ty=a.ty+t.offY}};Ve.prototype.getBounds=function(){var t=this;if(t.boundsType===Ve.BOUNDS_SELF){return pt.Bounds.getBox(t.gameObject,pt.Bounds.USE_BOUNDS,true,0)}else if(t.boundsType===Ve.BOUNDS_ALL){return pt.Bounds.getBox(t.gameObject,pt.Bounds.USE_BOUNDS,true,-1)}else{return new pt.Rectangle(0,0,1,1)}};Ve.prototype.getLocalBounds=function(){var t=this;if(t.boundsType===Ve.BOUNDS_SELF){return pt.Bounds.getBox(t.gameObject,pt.Bounds.USE_BOUNDS,true,0,t.gameObject)}else if(t.boundsType===Ve.BOUNDS_ALL){return pt.Bounds.getBox(t.gameObject,pt.Bounds.USE_BOUNDS,true,-1,t.gameObject)}else{return new pt.Rectangle(0,0,1,1)}};Ve.prototype.renderCanvas=function(t){var e=this,i=e.gameObject;if(i.phaser.visible===false||i.renderable===false)return;if(e._updatingCache&&e._nodeRenderCanvas){e.gameObject._notifyCacheChanged(true);e._nodeRenderCanvas.call(e.gameObject.phaser,t);return}e._cacheSprite.worldAlpha=e._cacheSprite.alpha=e.gameObject.phaser.worldAlpha;e._cacheSprite._renderCanvas(t)};Ve.prototype.renderWebGL=function(t){var e=this,i=e.gameObject;if(i.phaser.visible===false||i.renderable===false)return;if(e._updatingCache&&e._nodeRenderWebGL){e.gameObject._notifyCacheChanged(true);e._nodeRenderWebGL.call(e.gameObject.phaser,t);return}e._cacheSprite.worldAlpha=e._cacheSprite.alpha=e.gameObject.phaser.worldAlpha;e._cacheSprite._renderWebGL(t)};Ve._tempMatrix=new _t.Matrix;P.defineProperties(pt.Node.prototype,{cacheAsBitmap:{get:function(){var t=this.getScript("qc.CacheAsBitmap");return t&&t.enable},set:function(t){var e=this.getScript("qc.CacheAsBitmap");if(!t&&!e){return}if(!e){e=this.addScript("qc.CacheAsBitmap")}e.enable=t}}});Ve.BOUNDS_SELF=0;Ve.BOUNDS_ALL=1;Ve.CACHE_FOR_SCREEN=0;Ve.CACHE_FOR_SELF=1;var ze=w("qc.DebugViewer",pt.Behaviour,function(){var t=this;t.count=1;t.now=t.game.time.now;t.runInEditor=true;t.duration=1;t.detail=false},{debugOn:pt.Serializer.BOOLEAN,duration:pt.Serializer.NUMBER,detail:pt.Serializer.BOOLEAN});ze.__menu="Debug/DebugViewer";P.defineProperties(ze.prototype,{debugOn:{get:function(){return this.game.debug.on},set:function(t){this.game.debug.on=t}}});ze.prototype.postUpdate=function(){var t=this.game.debug;var e=this.game.time.now;if(e-this.now>=this.duration*1e3){var i=this.count*1e3/(e-this.now);var r=(t.preUpdate/this.count).toFixed(1);var a=(t.update/this.count).toFixed(1);var n=(t.postUpdate/this.count).toFixed(1);var s=(t.logic/this.count).toFixed(1);var o=(t.render/this.count).toFixed(1);var h=(t.total/this.count).toFixed(1);var l=this.game.phaser.renderer.renderSession.drawCount;if(l==null){l="(N/A)"}var u=this.game.phaser._calcTransformCount;var f="FPS: "+i.toFixed(1)+"\n"+"Draw Calls: "+l+"\n"+"Total: "+h+" ms\n"+"Logic: "+s+" ms\n"+"Render: "+o+" ms\n"+"PreUpdate: "+r+" ms\n"+"Update: "+a+" ms\n"+"PostUpdate: "+n+" ms\n"+"TransformCalc: "+u+"";if(this.detail){var c="Canvas";if(this.game.phaser.renderType===dt.WEBGL){c="WebGL"}else if(this.game.phaser.renderType==dt.HEADLESS){c="Headless"}f+="\n------------\n"+"resolution="+this.game.phaser.resolution+"\n"+"devicePixelRatio="+D.devicePixelRatio+"\n"+"size="+this.game.width+"*"+this.game.height+"\n"+"renderType="+c+"\n"+"antialias="+this.game.antialias}if(this.gameObject instanceof pt.UIText)this.gameObject.text=f;else if(this.gameObject instanceof pt.Dom){f=f.replace(/\n/g,"<br/>");this.gameObject.innerHTML=f}this.count=1;this.now=e;t.total=0;t.logic=0;t.preUpdate=0;t.update=0;t.postUpdate=0;t.render=0}else{this.count++}};var Ge=w("qc.DropdownItem",pt.Behaviour,function(){var t=this;t.dropdown=null},{checkBackground:pt.Serializer.NODE,checkMark:pt.Serializer.NODE,text:pt.Serializer.NODE,image:pt.Serializer.NODE});Ge.__menu="UI/DropdownItem";P.defineProperties(Ge.prototype,{index:{get:function(){return this._index},set:function(t){if(this._index===t)return;this._index=t;this.redraw()}}});Ge.prototype.onDown=function(){if(this.checkBackground)this.checkBackground.visible=true};Ge.prototype.onUp=function(){if(this.checkBackground)this.checkBackground.visible=false};Ge.prototype.onClick=function(){var t=this;if(t.index===t.dropdown.value)return;t.dropdown.value=t.index;t.dropdown.hide()};Ge.prototype.redraw=function(){var t=this,e=t.gameObject,i=t.dropdown.options[t.index];if(typeof i==="string"){if(t.image)t.image.visible=false;t.text.visible=true;t.text.text=i}else{if(t.text)t.text.visible=false;t.image.visible=true;t.image.texture=i}if(t.checkMark){t.checkMark.visible=t.index===t.dropdown.value}e.anchoredY=t.index*e.height;if(t.checkBackground)t.checkBackground.visible=false};var Ye=w("qc.FilterGroup",pt.Behaviour,function(){this._filters=[]},{filters:N.FILTERS,inherited:N.BOOLEAN});Ye.__menu="UI/FilterGroup";P.defineProperties(Ye.prototype,{filters:{get:function(){return this._filters},set:function(t){this._filters=t;this.refresh()}},inherited:{get:function(){return!(this.gameObject&&this.gameObject.filterSelf)},set:function(t){this.gameObject&&(this.gameObject.filterSelf=!t)}}});Ye.prototype.onDisable=function(){if(!this.gameObject||this.gameObject._destroy)return;this.refresh()};Ye.prototype.onEnable=function(){if(!this.gameObject||this.gameObject._destroy)return;this.refresh()};Ye.prototype.onDestroy=function(){if(!this.gameObject||this.gameObject._destroy)return;this.gameObject.phaser&&(this.gameObject.phaser.filters=null)};Ye.prototype.refresh=function(){if(!this.gameObject||this.gameObject._destroy){return}if(!this.enable){this.gameObject.phaser.filters=null}else if(this.enable){this.gameObject.phaser.filters=this.filters&&this.filters.length>0?this.filters:null}};Ye.prototype.findFilter=function(t){if(typeof t==="string")t=pt.Util.findClass(t);var e=[];for(var i in this.filters){if(this.filters[i]instanceof t){e.push(this.filters[i])}}return e};Ye.prototype.removeFilterAt=function(t){if(t<0||t>=this.filters.length){return}var e=this.filters.splice(t,1);this.refresh();return e};Ye.prototype.removeFilter=function(t){if(typeof t==="string"){t=pt.Util.findClass(t)}var e=[];var i=this.filters.length;if(typeof t==="function"){while(i-- >0){if(this.filters[i]instanceof t){e.push(this.filters.splice(i,1))}}}else{while(i-- >0){if(this.filters[i]===t){e.push(this.filters.splice(i,1))}}}this.refresh();return e};Ye.prototype.addFilter=function(t,e){if(typeof t==="string"){t=pt.Util.findClass(t);if(typeof t!=="function"){return null}}if(typeof t==="function"){t=new t(this.game)}else{var e=this.filters.length;while(e-- >0){if(this.filters[e]===t){return}}}if(isNaN(e)||e<0||e>this.filters.length){this.filters.push(t)}else{this.filters.splice(e,0,t)}this.refresh();return t};var He=w("qc.HorizontalLayout",pt.TableLayout,function(){this.style=pt.TableLayout.STYLE_RESIZE_ELEMENT;this.constraint=pt.TableLayout.CONSTRAINT_FIX_ROW_COUNT;this.contentSizeProvider=pt.TableLayout.USE_RECTTRANSFORM;this.stride=1;this.startCorner=pt.TableLayout.CORNER_TOP_LEFT;this.startAxis=pt.TableLayout.AXIS_HORIZONTAL},{childForceExpandWidth:pt.Serializer.NUMBER,childForceExpandHeight:pt.Serializer.NUMBER});He.__menu="UI/Layout/HorizontalLayout";P.defineProperties(He.prototype,{spacing:{get:function(){return this.spacingX},set:function(t){this.spacingX=t}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(t){if(this._childForceExpandWidth===t){return}this._childForceExpandWidth=t;this.rebuildTable()}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(t){if(this._childForceExpandHeight===t){return}this._childForceExpandHeight=t;this.rebuildTable()}}});He.prototype._getDefaultLayout=function(t){if(t==="x"){return{min:0,preferred:0,flexible:this.childForceExpandWidth?1:0,extra:0}}else{return{min:0,preferred:this.childForceExpandHeight?this.gameObject.rect.height:-1,flexible:1,extra:0}}};He.prototype.getCellLayout=function(t){var e=pt.LayoutElement.getLayoutElement(t);this.childForceExpandWidth&&(e.flexibleWidth=1);this.childForceExpandHeight&&(e.flexibleHeight=1);return e};var Xe=w("qc.NodeMask",pt.Behaviour,function(){this._mask=this.gameObject.game.phaser.add.graphics(0,0);if(this._mask.parent){this._mask.parent.remove(this._mask)}if(this.gameObject.onTextureChanged){this.addListener(this.gameObject.onTextureChanged,this._doTextureChange,this)}if(this.gameObject.onTransformChanged){this.addListener(this.gameObject.onTransformChanged,this._doTransformChanged,this)}this.onEnable();this.runInEditor=true},{checkInField:pt.Serializer.BOOLEAN,minAnchor:pt.Serializer.GEOM,maxAnchor:pt.Serializer.GEOM,minRotation:pt.Serializer.NUMBER,maxRotation:pt.Serializer.NUMBER,clipType:pt.Serializer.NUMBER,mode:pt.Serializer.NUMBER});Xe.__menu="UI/NodeMask";P.defineProperties(Xe.prototype,{checkInField:{get:function(){return!!this._checkInField},set:function(t){if(this._checkInField===t){return}this._checkInField=t;if(!t){this._resetRenderAble(this.gameObject)}}},minAnchor:{get:function(){return this._minAnchor||new pt.Point(0,0)},set:function(t){this.setMask(t)}},maxAnchor:{get:function(){return this._maxAnchor||new pt.Point(1,1)},set:function(t){this.setMask(null,t)}},minRotation:{get:function(){return typeof this._minRotation!=="undefined"||this._minRotation===null?this._minRotation:0},set:function(t){this.setMask(null,null,t)}},maxRotation:{get:function(){return typeof this._maxRotation!=="undefined"||this._maxRotation===null?this._maxRotation:2*Math.PI},set:function(t){this.setMask(null,null,null,t)}},clipType:{get:function(){return Xe.CLIP_STENCIL},set:function(t){}},mode:{get:function(){return this._mode||Xe.MODE_DEFAULT},set:function(t){if(this._mode===t){return}this._mode=t;this._refresh()}},customGraphics:{get:function(){if(!this._customGraphics){this._customGraphics=this.game.phaser.add.graphics(0,0);if(this._customGraphics.parent){this._customGraphics.parent.remove(this._customGraphics)}}return this._customGraphics}},_maskFilter:{get:function(){if(!this.__maskFilter){this.__maskFilter=new pt.Filter.AlphaMask(this.game);this.__maskFilter.otherTexture=new pt.Filter.FilterTexture(this.game);this.__maskFilter.otherTexture.texture=this.gameObject.texture;this.__maskFilter.otherTexture.frame=this.gameObject.frame}return this.__maskFilter}},_graphicsFilter:{get:function(){if(!this.__graphicsFilter){this.__graphicsFilter=new pt.Filter.AlphaMask(this.game);this.__graphicsFilter.otherTexture=new pt.Filter.GraphicsTexture(this.game)}return this.__graphicsFilter}}});Xe.prototype.onEnable=function(){this._refresh()};Xe.prototype.onDisable=function(){this._refresh()};Xe.prototype.onDestroy=function(){this.gameObject.phaser.mask=null;this.gameObject.phaser.softClip=null;this.gameObject.phaser.maskPixel=null;this.gameObject.phaser._graphicsFilter=null;if(!this.gameObject._destroy){this._resetRenderAble(this.gameObject)}};Xe.prototype._doTextureChange=function(){if(this.__maskFilter){this.__maskFilter.otherTexture.texture=this.gameObject.texture;this.__maskFilter.otherTexture.frame=this.gameObject.frame}};Xe.prototype._doTransformChanged=function(){this.postUpdate()};Xe.prototype._isNeedUseClipReplaceStencil=function(){return!this.game.device.phaser.supportStencil&&this.game.phaser.renderType===dt.WEBGL&&this.clipType===Xe.CLIP_STENCIL};Xe.prototype._refresh=function(){if(this._isNeedUseClipReplaceStencil()){this.gameObject.phaser.softClip=null;this.gameObject.phaser.mask=null;this.gameObject.phaser.maskPixel=null;this._graphicsFilter.otherTexture.updateTexture();this.gameObject.phaser._graphicsFilter=this.enable?{target:this.gameObject.phaser,filterPasses:this._graphicsFilter.passes}:null}else if(this.game.phaser.renderType!==dt.WEBGL||this.clipType===Xe.CLIP_STENCIL){this.gameObject.phaser.mask=this.enable&&this.mode!==Xe.MODE_PIXEL?this.mode===Xe.MODE_GRAPHICS?this.customGraphics:this._mask:null;this.gameObject.phaser.maskPixel=this.enable&&this.mode===Xe.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null;this.gameObject.phaser.softClip=null;if(!this.gameObject._destroy){this._resetRenderAble(this.gameObject)}this.gameObject.phaser._clipTexture=null;this.gameObject.phaser._graphicsFilter=null}else{this.gameObject.phaser.softClip=this.enable&&this.mode!==Xe.MODE_PIXEL?this._softClip:null;this.gameObject.phaser.maskPixel=this.enable&&this.mode===Xe.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null;this.gameObject.phaser.mask=null;this.gameObject.phaser._clipTexture=null;this.gameObject.phaser._graphicsFilter=null}};Xe.prototype.postUpdate=function(){if(this.enable&&this.mode===Xe.MODE_DEFAULT){this._updateMask();if(this._checkInField){var t=this.gameObject.children;var e=this.gameObject.getWorldBox();for(var i=0;i<t.length;i++){this._checkRenderable(e,t[i])}}}};Xe.prototype.setMask=function(t,e,i,r){var a=t||this.minAnchor;var n=e||this.maxAnchor;i=typeof i==="undefined"||i===null?this.minRotation:i;r=typeof r==="undefined"||r===null?this.maxRotation:r;if(a.x<0)a.x=0;if(a.y<0)a.y=0;if(a.x>1)a.x=1;if(a.y>1)a.y=1;if(n.x<0)n.x=0;if(n.y<0)n.y=0;if(n.x>1)n.x=1;if(n.y>1)n.y=1;if(a.x>n.x||a.y>n.y)throw new Error("Expected:min < max");if(r<i)throw new Error("Expected:minRotation < maxRotation");if(a.x===this.minAnchor.x&&a.y===this.minAnchor.y&&n.x===this.maxAnchor.x&&n.y===this.maxAnchor.y&&i===this.minRotation&&r===this.maxRotation){return}this._minAnchor=a;this._maxAnchor=n;this._minRotation=i;this._maxRotation=r;this._maskForceChange=true;this.gameObject.phaser.displayChanged(pt.DisplayChangeStatus.SIZE)};Xe.prototype._updateMask=function(){var t=this._mask;var e=this.gameObject.worldTransform;var i=this.gameObject.rect;var r=[i.x,i.y,i.width,i.height,e.a,e.b,e.c,e.d,e.tx,e.ty];if(!this._maskForceChange&&this._lastMaskRect&&this._lastMaskRect[0]===r[0]&&this._lastMaskRect[1]===r[1]&&this._lastMaskRect[2]===r[2]&&this._lastMaskRect[3]===r[3]&&this._lastMaskRect[4]===r[4]&&this._lastMaskRect[5]===r[5]&&this._lastMaskRect[6]===r[6]&&this._lastMaskRect[7]===r[7]&&this._lastMaskRect[8]===r[8]&&this._lastMaskRect[9]===r[9]){return}this._maskForceChange=false;this._lastMaskRect=r;var a=this.minAnchor;var n=this.maxAnchor;var s=this.minRotation;var o=this.maxRotation;var h=i.x+a.x*i.width;var l=i.y+a.y*i.height;var u=i.x+n.x*i.width;var f=i.y+n.y*i.height;var c=this.gameObject.getWorldScale();var p=c.x*c.y<0;var d=(h+u)/2;var _=(l+f)/2;var g=null;if(o-s>=Math.PI*2){g=[new pt.Point(h,l),new pt.Point(u,l),new pt.Point(u,f),new pt.Point(h,f)]}else{var m=2*Math.PI;var y=Math.atan2(f-l,u-h);while(s<-y||s>m-y){var v=s<0?m:-m;s+=v;o+=v}var T,x,b;if(s>=-y&&s<y){T=u;x=_+(u-d)*Math.tan(s);b=0}else if(s<Math.PI-y){x=f;T=d+(f-_)/Math.tan(s);b=1}else if(s<Math.PI+y){T=h;x=_+(d-h)*Math.tan(Math.PI-s);b=2}else{x=l;T=d+(_-l)/Math.tan(m-s);b=3}var A,S,w=0;while(o>m-y){o-=m;w+=4}if(o>=-y&&o<y){A=u;S=_+(u-d)*Math.tan(o);w+=0}else if(o<Math.PI-y){S=f;A=d+(f-_)/Math.tan(o);w+=1}else if(o<Math.PI+y){A=h;S=_+(d-h)*Math.tan(Math.PI-o);w+=2}else{S=l;A=d+(_-l)/Math.tan(m-o);w+=3}var P=[new pt.Point(u,f),new pt.Point(h,f),new pt.Point(h,l),new pt.Point(u,l)];g=[new pt.Point(d,_),new pt.Point(T,x)];while(b<w){g.push(P[b%4]);b++}g.push(new pt.Point(A,S))}if(!this._isNeedUseClipReplaceStencil()){for(var E=0;E<g.length;E++){g[E]=e.apply(g[E])}p&&g.reverse()}this._softClip=g;if(this._isNeedUseClipReplaceStencil()){var D=this.gameObject.phaser.getBounds();var C=this._graphicsFilter.otherTexture;C.resize(D.width,D.height);C.offset.x=-D.x;C.offset.y=-D.y;var O=C.graphics;O.clear();O.beginFill(16777215);O.drawPolygon(g);O.worldTransform=this.gameObject.worldTransform}else{t.clear();t.beginFill(16777215);t.drawPolygon(g)}this._refresh()};Xe.prototype._checkRenderable=function(t,e){var i=e.getWorldBox();if(!pt.Rectangle.intersects(t,i)){e.renderable=false}else{e.renderable=true}var r=e.children;for(var a=0;a<r.length;a++){this._checkRenderable(t,r[a])}};Xe.prototype._resetRenderAble=function(t){if(!t)return;t.renderable=true;var e=t.children;for(var i=0;i<e.length;i++){this._resetRenderAble(e[i])}};Xe.MODE_DEFAULT=0;Xe.MODE_PIXEL=1;Xe.MODE_GRAPHICS=2;Xe.CLIP_STENCIL=1;var qe=w("qc.NonexistScript",pt.Behaviour,function(){this.script="";this.data={}},{});qe.__hiddenInMenu=true;var Ke=w("qc.ScaleAdapter",pt.Behaviour,function(){var t=this;t.target=null;t.referenceResolution=new pt.Point(0,0);t.manualType=Ke.NONE;t.gameObjectRecord=t.gameObject?[t.gameObject.scaleX,t.gameObject.scaleY,t.gameObject.width,t.gameObject.height]:[];t._fullTarget=false;t.runInEditor=true},{target:pt.Serializer.NODE,referenceResolution:pt.Serializer.GEOM,manualType:pt.Serializer.NUMBER,fullTarget:pt.Serializer.BOOLEAN,gameObjectRecord:pt.Serializer.NUMBERS});Ke.__hiddenInMenu=true;P.defineProperties(Ke.prototype,{fullTarget:{get:function(){return this._fullTarget},set:function(t){if(this._fullTarget!==t){this._fullTarget=t;if(!t&&this.gameObject){this.gameObject.width=this.gameObjectRecord[2];this.gameObject.height=this.gameObjectRecord[3]}this._forceUpdate=true}}}});Ke.NONE=0;Ke.MANUAL_HEIGHT=1;Ke.MANUAL_WIDTH=2;Ke.EXPAND=3;Ke.SHRINK=4;Ke.FILL=5;Ke.prototype.awake=function(){if(this.game.fixedGameSize){var t=this.gameObject;t.width=this.game.world.width;t.height=this.game.world.height;t.scaleX=1;t.scaleY=1}};Ke.prototype.onEnable=function(){var t=this,e=t.gameObject,i=t.gameObjectRecord;i[0]=e.scaleX;i[1]=e.scaleY;i[2]=e.width;i[3]=e.height};Ke.prototype.onDisable=function(){var t=this,e=t.gameObject,i=t.gameObjectRecord;if(i.length<4||i[0]===null||isNaN(i[0])){return}e.scaleX=i[0];e.scaleY=i[1];e.width=i[2];e.height=i[3]};Ke.prototype.preUpdate=function(){var t=this;if(t.game.fixedGameSize)return;var e=t.gameObject;if(!e||!e.scaleX)return;var i=t.getTargetSize();var r=t.getReferenceResolution();if(i.x===0||i.y===0||r.x===0||r.y===0)return;var a=1;var n=1;switch(this.manualType){case pt.ScaleAdapter.MANUAL_HEIGHT:n=a=i.y/r.y;break;case pt.ScaleAdapter.MANUAL_WIDTH:n=a=i.x/r.x;break;case pt.ScaleAdapter.EXPAND:n=a=Math.min(i.x/r.x,i.y/r.y);break;case pt.ScaleAdapter.SHRINK:n=a=Math.max(i.x/r.x,i.y/r.y);break;case pt.ScaleAdapter.FILL:a=i.x/r.x;n=i.y/r.y;break}if(isNaN(a)||isNaN(n))return;if(this.fullTarget){this.gameObject.width=i.x/a;this.gameObject.height=i.y/n}if(this._forceUpdate||this.gameObject.scaleX!==a||this.gameObject.scaleY!==n){this._forceUpdate=false;this.gameObject.scaleX=a;this.gameObject.scaleY=n}};Ke.prototype.onDestroy=function(){this.target=null};Ke.prototype.getTargetSize=function(){var t=this.target||this.gameObject.game.world;if(!t||!t.width||!t.height)return new pt.Point(0,0);return new pt.Point(t.width,t.height)};Ke.prototype.getReferenceResolution=function(){return this.referenceResolution};var Je=pt.defineBehaviour("qc.ToggleGroup",pt.Behaviour,function(){this._toggles=[];this.runInEditor=true;this.onValueChange=new pt.Signal},{toggles:pt.Serializer.NODES,allowSwitchOff:pt.Serializer.BOOLEAN});Je.__menu="UI/ToggleGroup";P.defineProperties(Je.prototype,{toggle:{get:function(){for(var t=0;t<this._toggles.length;t++){var e=this._toggles[t];if(e&&e.on){return e}}return null},set:function(t){var e=this._toggles.indexOf(t);if(e===-1){this.game.log.error("target is not in this group");return}for(var i=0;i<this._toggles.length;i++){var r=this._toggles[i];if(r){r.on=r===t}}this.onValueChange.dispatch(this,t,true)}},toggles:{get:function(){return this._toggles},set:function(t){var e=this;e._toggles.forEach(function(t){if(t){t.onValueChange.remove(e._onValueChange,e);t.canValueChange.remove(e._canValueChange,e)}});e._toggles=t||[];e._toggles.forEach(function(t){if(t){t.onValueChange.add(e._onValueChange,e);t.canValueChange.add(e._canValueChange,e)}})}},allowSwitchOff:{get:function(){var t=this._allowSwitchOff;if(t===C)return true;else return t},set:function(t){t=!!t;var e=this.allowSwitchOff;if(e===t)return;this._allowSwitchOff=t;if(!t)this._assureSelection()}}});Je.prototype._assureSelection=function(){if(this.toggle!=null)return;var t=this.toggles;if(t&&t.length){var e=t[0];if(e)e.on=true}};Je.prototype.add=function(t){if(this._toggles.indexOf(t)!==-1)return;this._toggles.push(t);t.on=false;t.onValueChange.add(this._onValueChange,this);t.canValueChange.add(this._canValueChange,this);if(!this.allowSwitchOff)this._assureSelection()};Je.prototype.remove=function(t){var e=this._toggles.indexOf(t);if(e===-1)return;this._toggles.splice(e,1);t.onValueChange.remove(this._onValueChange,this);t.canValueChange.remove(this._canValueChange,this);if(!this.allowSwitchOff)this._assureSelection()};Je.prototype._canValueChange=function(t,e,i,r){if(this.allowSwitchOff)return;if(!i||e)return;var a=false;for(var n=0,s=this.toggles.length;n<s;n++){var o=this.toggles[n];if(o===t){a=true;continue}if(o&&o.on)return}if(a)r.ignore=true};Je.prototype._onValueChange=function(t){if(t.on){this.toggle=t}else{if(!this.toggle)this.onValueChange.dispatch(this,t,false)}};var Ze=pt.defineBehaviour("qc.TransitionBehaviour",pt.Behaviour,function(){if(this.gameObject.state===C){throw new Error("The target node does not have the interactive function, and can not be added to this component.");return}this.target=this.gameObject;this._transition=pt.Transition.TEXTURE_SWAP},{target:pt.Serializer.NODE,_transition:pt.Serializer.NUMBER,_normalTexture:{get:function(t,e){return this._saveTexture(t._normalTexture,e)},set:function(t,e){this._normalTexture=this._restoreTexture(e,t)}},_pressedTexture:{get:function(t,e){return this._saveTexture(t._pressedTexture,e)},set:function(t,e){this._pressedTexture=this._restoreTexture(e,t)}},_disabledTexture:{get:function(t,e){return this._saveTexture(t._disabledTexture,e)},set:function(t,e){this._disabledTexture=this._restoreTexture(e,t)}},_normalColor:pt.Serializer.COLOR,_pressedColor:pt.Serializer.COLOR,_disabledColor:pt.Serializer.COLOR});Ze.__menu="UI/TransitionBehaviour";P.defineProperties(Ze.prototype,{target:{get:function(){return this._target},set:function(t){this._target=t;this._reset()}},transition:{get:function(){return this._transition},set:function(t){if(this._transition===t)return;this._transition=t;if(!this.target)return;this._reset()}},normalTexture:{get:function(){return this._normalTexture},set:function(t){if(t===this._normalTexture)return;this._normalTexture=t;if(!this.target)return;if(this.gameObject.state===pt.UIState.NORMAL&&this.transition===pt.Transition.TEXTURE_SWAP)this.target.texture=this.normalTexture}},pressedTexture:{get:function(){return this._pressedTexture},set:function(t){if(t===this._pressedTexture)return;this._pressedTexture=t;if(!this.target)return;if(this.gameObject.state===pt.UIState.PRESSED&&this.transition===pt.Transition.TEXTURE_SWAP)this.target.texture=this.pressedTexture}},disabledTexture:{get:function(){return this._disabledTexture},set:function(t){if(t===this._disabledTexture)return;this._disabledTexture=t;if(!this.target)return;if(this.gameObject.state===pt.UIState.DISABLED&&this.transition===pt.Transition.TEXTURE_SWAP)this.target.texture=this.disabledTexture}},normalColor:{get:function(){return this._normalColor},set:function(t){if(this._normalColor===t)return;if(!this.target)return;t=t||yt.white;if(!(t instanceof yt)){this.game.log.error("Expected qc.Color, got:{0}",t);return}this._normalColor=t;if(this.gameObject.state===pt.UIState.NORMAL&&this.transition===pt.Transition.COLOR_TINT)this.target.colorTint=this.normalColor}},pressedColor:{get:function(){return this._pressedColor},set:function(t){if(this._pressedColor===t)return;if(!this.target)return;t=t||yt.grey;if(!(t instanceof yt)){this.game.log.error("Expected qc.Color, got:{0}",t);return}this._pressedColor=t;if(this.gameObject.state===pt.UIState.PRESSED&&this.transition===pt.Transition.COLOR_TINT)this.target.colorTint=this.pressedColor}},disabledColor:{get:function(){return this._disabledColor},set:function(t){if(this._disabledColor===t)return;if(!this.target)return;t=t||yt.grey;if(!(t instanceof yt)){this.game.log.error("Expected:qc.Color, got:{0}",t);return}this._disabledColor=t;if(this.gameObject.state===pt.UIState.DISABLED&&this.transition===pt.Transition.COLOR_TINT)this.target.colorTint=this.disabledColor}},pressedAnimation:{get:function(){return this._pressedAnimation},set:function(t){if(this._pressedAnimation===t)return;this._pressedAnimation=t}}});Ze.prototype._normalColor=yt.white;Ze.prototype._pressedColor=yt.grey;Ze.prototype._disabledColor=yt.grey;Ze.prototype.awake=function(){this.addListener(this.gameObject.onStateChange,this._reset,this);this._reset()};Ze.prototype._saveTexture=function(t,e){return this.gameObject.game.serializer._saveTextureItem(t,e)};Ze.prototype._restoreTexture=function(t,e){if(t&&t.length&&t[0]===pt.Serializer.STRING){var i=e.gameObject.texture;if(i&&i.atlas.frameNames.indexOf(t[1])>=0)return e.gameObject.texture.atlas.getTexture(t[1]);return null}else return this.gameObject.game.serializer._restoreTextureItem(t)};Ze.prototype._reset=function(){if(!this.target)return;if(!this.enable)return;switch(this.transition){case pt.Transition.NONE:break;case pt.Transition.TEXTURE_SWAP:switch(this.gameObject.state){case pt.UIState.NORMAL:if(this.normalTexture)this.target.texture=this.normalTexture;break;case pt.UIState.PRESSED:if(this.pressedTexture)this.target.texture=this.pressedTexture;break;case pt.UIState.DISABLED:if(this.disabledTexture)this.target.texture=this.disabledTexture;break}break;case pt.Transition.COLOR_TINT:switch(this.gameObject.state){case pt.UIState.NORMAL:this.target.colorTint=this.normalColor;break;case pt.UIState.PRESSED:this.target.colorTint=this.pressedColor;break;case pt.UIState.DISABLED:this.target.colorTint=this.disabledColor;break}break;case pt.Transition.ANIMATION:break}};var Qe=w("qc.Tween",pt.Behaviour,function(){this._curve=new pt.BezierCurve(new pt.Keyframe(0,0,1,1),new pt.Keyframe(1,1,1,1));this._started=false;this._startTime=0;this._amountPerDelta=1e3;this._factor=0;this.duration=1;this.runInEditor=true;this.flag="";this.playOnAwake=false;this.canRunInEditor=false;this.animationName=""},{_curve:pt.Serializer.GEOM,sampleMethod:pt.Serializer.NUMBER,style:pt.Serializer.NUMBER,delay:pt.Serializer.NUMBER,duration:pt.Serializer.NUMBER,tweenGroup:pt.Serializer.NUMBER,flag:pt.Serializer.STRING,playOnAwake:pt.Serializer.BOOLEAN,addType:pt.Serializer.NUMBER,animationId:pt.Serializer.STRING,animationName:pt.Serializer.STRING,builtinId:pt.Serializer.STRING,builtinGroup:pt.Serializer.STRING});Qe.__hiddenInMenu=true;P.defineProperties(Qe.prototype,{curve:{get:function(){return this._curve}},sampleMethod:{get:function(){return this._sampleMethod||Qe.SAMPLE_LINEAR},set:function(t){if(this._sampleMethod===t){return}this._sampleMethod=t}},style:{get:function(){return this._style||0},set:function(t){if(this._style===t)return;this._style=t}},delay:{get:function(){return isNaN(this._delay)||this._delay<0?0:this._delay},set:function(t){if(this._delay===t)return;this._delay=t}},duration:{get:function(){return isNaN(this._duration)||this._duration<0?0:this._duration},set:function(t){if(this._duration===t)return;this._duration=t;this._amountPerDelta=Math.abs(t>0?1/(t*1e3):1e3)*(this._amountPerDelta>=0?1:-1)}},tweenGroup:{get:function(){return this._tweenGroup||0},set:function(t){if(this._tweenGroup===t)return;this._tweenGroup=t}},onStart:{get:function(){if(!this._onStart){this._onStart=new dt.Signal}return this._onStart}},onFinished:{get:function(){if(!this._onFinished){this._onFinished=new dt.Signal}return this._onFinished}},onLoopFinished:{get:function(){if(!this._onLoopFinished){this._onLoopFinished=new dt.Signal}return this._onLoopFinished}},amountPerDelta:{get:function(){return this._amountPerDelta}},tweenFactor:{get:function(){return this._factor},set:function(t){this._factor=dt.Math.clamp(t,0,1)}},direction:{get:function(){return this.amountPerDelta<0?Qe.DIR_REVERSE:Qe.DIR_FORWARD}}});Qe.prototype.awake=function(){var e=this;this.scene=null;if(e._started)return;e.enable=false;ps.mainState.add("scenechange",function(t){e.getCurrentScene();if(e.scene.uuid===t){if(e.playOnAwake){e.resetToBeginning();e.playForward()}}},this)};Qe.prototype.getCurrentScene=function(){var t=this.gameObject;while(!t.getScript("ps.VPGamePlay")){t=t.parent}this.scene=t};Qe.prototype._lineSample=function(t){return t};Qe.prototype.start=function(){this.update()};Qe.prototype.update=function(){if(!this.enable){return}if(this.gameObject&&this.game.device.editor&&!this.canRunInEditor){return}var t=this.game.time.deltaTime;var e=this.game.time.scaledTime;if(!this._started){this._started=true;this._dispatchStart=false;this._startTime=e+this.delay*1e3}if(e<this._startTime){return}else if(e===this._startTime){t=0}else if(e-this._startTime<t)t=e-this._startTime;if(!this._dispatchStart){this._dispatchStart=true;if(this._onStart){this._onStart.dispatch(this)}}this._factor+=this.amountPerDelta*t;if(this.style===Qe.STYLE_LOOP){if(this._factor>1){this._factor-=Math.floor(this._factor);if(this._onLoopFinished){this._onLoopFinished.dispatch(this)}}}else if(this.style===Qe.STYLE_PINGPONG){if(this._factor>1){this._factor=1-(this._factor-Math.floor(this._factor));this._amountPerDelta=-this._amountPerDelta;if(this._onLoopFinished){this._onLoopFinished.dispatch(this)}}else if(this._factor<0){this._factor=-this._factor;this._factor-=Math.floor(this._factor);this._amountPerDelta=-this._amountPerDelta;if(this._onLoopFinished){this._onLoopFinished.dispatch(this)}}}if(this.style===Qe.STYLE_ONCE&&(this.duration===0||this._factor>1||this._factor<0)){this._factor=dt.Math.clamp(this._factor,0,1);this.sample(this._factor,true);if(this._onFinished){this._onFinished.dispatch(this)}if(this.duration===0||(this._factor===1&&this._amountPerDelta>0||this._factor===0&&this._amountPerDelta<0)){this.enable=false}}else{this.sample(this._factor,false)}};Qe.prototype.onDisable=function(){this._started=false;this.canRunInEditor=false};Qe.prototype.sample=function(t,e){var i=dt.Math.clamp(t,0,1);switch(this.sampleMethod){case Qe.SAMPLE_LINEAR:i=this._lineSample(i);break}this.onUpdate(this.curve.evaluate(i),e)};Qe.prototype._funcGroup=function(t){var e=this;if(e.tweenGroup===0){t(e);return}Qe._funcGroup(e.gameObject,e.tweenGroup,t)};Qe.prototype.reset=function(t){if(!this._started){t?this.setEndToCurrValue():this.setStartToCurrValue()}};Qe.prototype.resetGroup=function(e){var t=function(t){t.reset(e)};this._funcGroup(t)};Qe.prototype.playForward=function(t){var e=this;var i=e.gameObject.getScripts(pt.TweenPosition);var r=i.indexOf(e);if(r>=1){var a=new pt.Point(e.to.x-e.from.x,e.to.y-e.from.y);var n=i[r-1];e.from=n.to;e.to=new pt.Point(e.from.x+a.x,e.from.y+a.y)}if(t)e.resetToBeginning();e.play(false)};Qe.prototype.playGroupForward=function(e){var t=function(t){t.playForward(e)};this._funcGroup(t)};Qe.prototype.playReverse=function(t){if(t)this.resetToBeginning(true);this.play(true)};Qe.prototype.playGroupReverse=function(e){var t=function(t){t.playReverse(e)};this._funcGroup(t)};Qe.prototype.stop=function(){this.enable=false;this.canRunInEditor=false};Qe.prototype.stopGroup=function(){var t=function(t){t.stop()};this._funcGroup(t)};Qe.prototype.play=function(t){this._amountPerDelta=Math.abs(this.amountPerDelta)*(t?-1:1);this.enable=true;this.canRunInEditor=true;this.update()};Qe.prototype.playGroup=function(e){var t=function(t){t.play(e)};this._funcGroup(t)};Qe.prototype.resetToBeginning=function(t){this._started=false;this._amountPerDelta=Math.abs(this.amountPerDelta)*(t?-1:1);this._factor=this.amountPerDelta<0?1:0;this.sample(this._factor,false);t?this.setEndToCurrValue():this.setStartToCurrValue()};Qe.prototype.resetGroupToBeginning=function(e){var t=function(t){t.resetToBeginning(e)};this._funcGroup(t)};Qe.prototype.toggle=function(){if(this._factor>0){this._amountPerDelta=-this.amountPerDelta}else{this._amountPerDelta=Math.abs(this.amountPerDelta)}this.enable=true};Qe.prototype.onUpdate=function(t,e){};Qe.prototype.setStartToCurrValue=function(){};Qe.prototype.setEndToCurrValue=function(){};Qe.prototype.setCurrToStartValue=function(){};Qe.prototype.setCurrToEndValue=function(){};Qe.begin=function(t,e,i){var r=e.getScript(t,false);if(r&&r.tweenGroup!=0){r=null;var a=e.getScripts(t,false);for(var n=0;n<a.length;++n){if(a[n]&&a[n].tweenGroup===0){r=a[n];break}}}if(!r){r=e.addScript(t);if(!r){return}}if(!(r instanceof Qe)){return}r._started=false;r.duration=i;r._factor=0;r._amountPerDelta=Math.abs(r.amountPerDelta);r.style=Qe.STYLE_ONCE;r._curve=new pt.BezierCurve(new pt.Keyframe(0,0,1,1),new pt.Keyframe(1,1,1,1));r.enable=true;return r};Qe._funcGroup=function(t,e,i){var r=t.getScripts?t.getScripts("qc.Tween"):[];var a=r.length;while(a-- >0){if(r[a].tweenGroup===e){i(r[a])}}var n=t.children;if(!n)return;var s=n.length;while(s-- >0){var o=n[s];Qe._funcGroup(o,e,i)}};Qe.resetGroup=function(t,e,i){var r=function(t){t.reset(i)};Qe._funcGroup(t,e,r)};Qe.playGroupForward=function(t,e){var i=function(t){t.playForward()};Qe._funcGroup(t,e,i)};Qe.playGroupReverse=function(t,e){var i=function(t){t.playReverse()};Qe._funcGroup(t,e,i)};Qe.stopGroup=function(t,e){var i=function(t){t.stop()};Qe._funcGroup(t,e,i)};Qe.playGroup=function(t,e,i){var r=function(t){t.play(i)};Qe._funcGroup(t,e,r)};Qe.resetGroupToBeginning=function(t,e,i){var r=function(t){t.resetToBeginning(i)};Qe._funcGroup(t,e,r)};Qe.STYLE_ONCE=0;Qe.STYLE_LOOP=1;Qe.STYLE_PINGPONG=2;Qe.DIR_FORWARD=0;Qe.DIR_REVERSE=1;Qe.SAMPLE_LINEAR=0;var $e=w("qc.TweenAlpha",pt.Tween,function(){var t=this;t.from=0;t.to=1;t.enable=false},{from:pt.Serializer.NUMBER,to:pt.Serializer.NUMBER});$e.__menu="Tween/TweenAlpha";$e.prototype.onUpdate=function(t,e){var i=this;var r=i.from,a=i.to;i.gameObject.alpha=dt.Math.clamp(r+t*(a-r),0,1)};$e.prototype.setStartToCurrValue=function(){this.gameObject.alpha=this.from};$e.prototype.setEndToCurrValue=function(){this.gameObject.alpha=this.to};$e.prototype.setCurrToStartValue=function(){this.from=this.gameObject.alpha};$e.prototype.setCurrToEndValue=function(){this.to=this.gameObject.alpha};$e.begin=function(t,e,i){var r=pt.Tween.begin("qc.TweenAlpha",t,e);r.from=t.alpha;r.to=i;if(e<=0){r.sample(1,true);r.enable=false}return r};var ti=w("qc.TweenColor",pt.Tween,function(){var t=this;t.from=yt.black;t.to=yt.white;t.enable=false},{from:pt.Serializer.COLOR,to:pt.Serializer.COLOR});ti.__menu="Tween/TweenColor";ti.prototype.onUpdate=function(t,e){var i=this;var r=i.from.rgb,a=i.to.rgb;var n=[dt.Math.clamp(Math.round(r[0]+t*(a[0]-r[0])),0,255),dt.Math.clamp(Math.round(r[1]+t*(a[1]-r[1])),0,255),dt.Math.clamp(Math.round(r[2]+t*(a[2]-r[2])),0,255),dt.Math.clamp(i.from.alpha+t*(i.to.alpha-i.from.alpha),0,1)];var s=new yt(n);i.gameObject.colorTint=s};ti.prototype.setStartToCurrValue=function(){this.gameObject.colorTint=new yt(this.from.toString())};ti.prototype.setEndToCurrValue=function(){this.gameObject.colorTint=new yt(this.to.toString())};ti.prototype.setCurrToStartValue=function(){this.from=new yt(this.gameObject.colorTint.toString())};ti.prototype.setCurrToEndValue=function(){this.to=new yt(this.gameObject.colorTint.toString())};ti.begin=function(t,e,i){var r=pt.Tween.begin("qc.TweenColor",t,e);r.from=new yt(t.colorTint.toString());r.to=i;if(e<=0){r.sample(1,true);r.enable=false}return r};var ei=w("qc.TweenPosition",pt.Tween,function(){var t=this;t.from=new pt.Point(0,0);t.to=new pt.Point(0,0);t.moveAxis=ei.BOTH;t.isReSet=false;t.enable=false},{from:pt.Serializer.POINT,to:pt.Serializer.POINT,moveAxis:pt.Serializer.NUMBER});ei.__menu="Tween/TweenPosition";ei.prototype.onUpdate=function(t,e){var i=this;var r=i.from,a=i.to;(i.moveAxis&ei.ONLY_X)!==0&&(i.gameObject.x=r.x+t*(a.x-r.x));(i.moveAxis&ei.ONLY_Y)!==0&&(i.gameObject.y=r.y+t*(a.y-r.y))};ei.prototype.updateFromAndTo=function(){var t=new pt.Point(this.to.x-this.from.x,this.to.y-this.from.y);this.from=new pt.Point(this.gameObject.x,this.gameObject.y);this.to=new pt.Point(this.gameObject.x+t.x,this.gameObject.y+t.y)};ei.prototype.setStartToCurrValue=function(){(this.moveAxis&ei.ONLY_X)!==0&&(this.gameObject.x=this.from.x);(this.moveAxis&ei.ONLY_Y)!==0&&(this.gameObject.y=this.from.y)};ei.prototype.setEndToCurrValue=function(){(this.moveAxis&ei.ONLY_X)!==0&&(this.gameObject.x=this.to.x);(this.moveAxis&ei.ONLY_Y)!==0&&(this.gameObject.y=this.to.y)};ei.prototype.setCurrToStartValue=function(){this.from=new pt.Point(this.gameObject.x,this.gameObject.y)};ei.prototype.setCurrToEndValue=function(){this.to=new pt.Point(this.gameObject.x,this.gameObject.y)};ei.begin=function(t,e,i){var r=pt.Tween.begin("qc.TweenPosition",t,e);r.from=new pt.Point(t.x,t.y);r.to=i.clone();if(e<=0){r.sample(1,true);r.enable=false}return r};ei.BOTH=255;ei.ONLY_X=1;ei.ONLY_Y=2;var ii=w("qc.TweenProperty",pt.Tween,function(){var t=this;t.from=0;t.to=1;t.property="";t.enable=false},{from:pt.Serializer.NUMBER,to:pt.Serializer.NUMBER,property:pt.Serializer.STRING});ii.__menu="Tween/TweenProperty";P.defineProperties(ii.prototype,{property:{get:function(){return this._property},set:function(t){if(t===this._property)return;var e=t.split(".");var i=this.gameObject;for(var r=0;r<e.length-1;r++){i=i[e[r]];if(!i){this.game.log.important("The property({0}) non-exist.",t);return}}this._ob=i;this._attrib=e[e.length-1];this._property=t}}});ii.prototype.onUpdate=function(t,e){var i=this;var r=i.from,a=i.to;i._ob[i._attrib]=r+t*(a-r)};ii.prototype.setStartToCurrValue=function(){this._ob[this._attrib]=this.from};ii.prototype.setEndToCurrValue=function(){this._ob[this._attrib]=this.to};ii.prototype.setCurrToStartValue=function(){this.from=this._ob[this._attrib]};ii.prototype.setCurrToEndValue=function(){this.to=this._ob[this._attrib]};ii.begin=function(t,e,i){var r=pt.Tween.begin("qc.TweenProperty",t,e);r.from=this._ob[this._attrib];r.to=i;if(e<=0){r.sample(1,true);r.enable=false}return r};var ri=w("qc.TweenRotation",pt.Tween,function(){var t=this;t.from=0;t.to=1;t.enable=false},{from:pt.Serializer.NUMBER,to:pt.Serializer.NUMBER});ri.__menu="Tween/TweenRotation";ri.prototype.onUpdate=function(t,e){var i=this;var r=i.from,a=i.to;i.gameObject.rotation=r+t*(a-r)};ri.prototype.setStartToCurrValue=function(){this.gameObject.rotation=this.from};ri.prototype.setEndToCurrValue=function(){this.gameObject.rotation=this.to};ri.prototype.setCurrToStartValue=function(){this.from=this.gameObject.rotation};ri.prototype.setCurrToEndValue=function(){this.to=this.gameObject.rotation};ri.begin=function(t,e,i){var r=pt.Tween.begin("qc.TweenRotation",t,e);r.from=t.rotation;r.to=i;if(e<=0){r.sample(1,true);r.enable=false}return r};var ai=w("qc.TweenScale",pt.Tween,function(){var t=this;t.from=new pt.Point(0,0);t.to=new pt.Point(1,1);t.isReSet=false;t.enable=false},{from:pt.Serializer.POINT,to:pt.Serializer.POINT});ai.__menu="Tween/TweenScale";ai.prototype.onUpdate=function(t,e){var i=this;var r=i.from,a=i.to;var n=new pt.Point(r.x+t*(a.x-r.x),r.y+t*(a.y-r.y));i.gameObject.scaleX=n.x;i.gameObject.scaleY=n.y};ai.prototype.setStartToCurrValue=function(){this.gameObject.scaleX=this.from.x;this.gameObject.scaleY=this.from.y};ai.prototype.setEndToCurrValue=function(){this.gameObject.scaleX=this.to.x;this.gameObject.scaleY=this.to.y};ai.prototype.setCurrToStartValue=function(){this.from=new pt.Point(this.gameObject.scaleX,this.gameObject.scaleY)};ai.prototype.setCurrToEndValue=function(){this.to=new pt.Point(this.gameObject.scaleX,this.gameObject.scaleY)};ai.begin=function(t,e,i){var r=pt.Tween.begin("qc.TweenScale",t,e);r.from=new pt.Point(t.scaleX,t.scaleY);r.to=i.clone();if(e<=0){r.sample(1,true);r.enable=false}return r};var ni=w("qc.TweenTransform",pt.Tween,function(){var t=this;t.enable=false;t.localFrom=new pt.Point;t.localTo=new pt.Point},{from:pt.Serializer.NODE,to:pt.Serializer.NODE});ni.__menu="Tween/TweenTransform";P.defineProperties(ni.prototype,{from:{get:function(){return this._from},set:function(t){this._from=t;if(t){var e=this._from.getWorldPosition();this.localFrom=this.gameObject.parent.toLocal(e)}}},to:{get:function(){return this._to},set:function(t){this._to=t;if(t){var e=this._to.getWorldPosition();this.localTo=this.gameObject.parent.toLocal(e)}}}});ni.prototype.onUpdate=function(t,e){if(!this._from||!this._to)return;var i=this;i.gameObject.x=i.localFrom.x+t*(i.localTo.x-i.localFrom.x);i.gameObject.y=i.localFrom.y+t*(i.localTo.y-i.localFrom.y)};var si=w("qc.VerticalLayout",pt.TableLayout,function(){this.style=pt.TableLayout.STYLE_RESIZE_ELEMENT;this.constraint=pt.TableLayout.CONSTRAINT_FIX_COLUMN_COUNT;this.contentSizeProvider=pt.TableLayout.USE_RECTTRANSFORM;this.stride=1;this.startCorner=pt.TableLayout.CORNER_TOP_LEFT;this.startAxis=pt.TableLayout.AXIS_VERTICAL},{childForceExpandWidth:pt.Serializer.NUMBER,childForceExpandHeight:pt.Serializer.NUMBER});si.__menu="UI/Layout/VerticalLayout";P.defineProperties(si.prototype,{spacing:{get:function(){return this.spacingY},set:function(t){this.spacingY=t}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(t){if(this._childForceExpandWidth===t){return}this._childForceExpandWidth=t;this.rebuildTable()}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(t){if(this._childForceExpandHeight===t){return}this._childForceExpandHeight=t;this.rebuildTable()}}});si.prototype._getDefaultLayout=function(t){if(t==="y"){return{min:0,preferred:0,flexible:this.childForceExpandHeight?1:0,extra:0}}else{return{min:0,preferred:this.childForceExpandWidth?this.gameObject.rect.width:-1,flexible:0,extra:0}}};si.prototype.getCellLayout=function(t){var e=pt.LayoutElement.getLayoutElement(t);this.childForceExpandWidth&&(e.flexibleWidth=1);this.childForceExpandHeight&&(e.flexibleHeight=1);return e};var oi=pt.Prop=function(t,e,i){var r=this;r.action=t;r.path=e;r.propertyId=i;r.propMap={};r.propDefaultValue={};r.keyIndexMap={}};oi.prototype.constructor=oi;oi.prototype.destroy=function(){this.action=null;this.propMap={}};oi.prototype.getPropMap=function(){return this.propMap};oi.prototype.saveValue=function(t,e,i){var r;switch(t){case N.INT:case N.NUMBER:case N.STRING:case N.BOOLEAN:case N.MAPPING:r=e;break;case N.COLOR:if(!(e instanceof yt))r=null;else r=e.toNumber(true);break;case N.GEOM:case N.POINT:case N.RECTANGLE:case N.CIRCLE:case N.ELLIPSE:r=[e.class,e.toJson()];break;case N.TEXTURE:if(!e)r=null;else if(!(e[0]instanceof pt.Atlas))r=null;else{var a=e[0],n=e[1];i.dependences.push({key:a.key,uuid:a.uuid});r=[a.uuid,n]}break;case N.AUDIO:if(!(e instanceof pt.SoundAsset))r=null;else{i.dependences.push({key:e.key,uuid:e.uuid});r=e.uuid}break;default:throw new Error("unsupported asset type:"+t)}return r};oi.prototype.restoreValue=function(t,e){var i;switch(t){case N.INT:case N.NUMBER:case N.STRING:case N.BOOLEAN:case N.MAPPING:i=e;break;case N.COLOR:i=new yt(e);break;case N.GEOM:case N.POINT:case N.RECTANGLE:case N.CIRCLE:case N.ELLIPSE:if(!e)i=null;else{var r=pt.Util.findClass(e[0]);var a=new r;a.fromJson(e[1]);i=a}break;case N.TEXTURE:if(!e)i=[];else{var n=e[0],s=e[1];var o=this.action.game.assets.findByUUID(n);if(!o){console.error("贴图资源尚未载入，无法反序列化。",e);i=[null,s]}else if(!(o instanceof pt.Atlas))i=[null,s];else i=[o,s]}break;case N.AUDIO:if(!e)i=null;else{var o=this.action.game.assets.findByUUID(e);if(!o){console.error("音频资源尚未载入，无法反序列化。",e);i=null}else if(!(o instanceof pt.SoundAsset))i=null;else i=o}break;default:throw new Error("unsupported asset type:"+t)}return i};oi.prototype.setData=function(t,e){return};oi.prototype.fromJson=function(t,e){return 0};oi.prototype.toJson=function(t){return[]};oi.prototype.addKey=function(t,e,i){return 0};oi.prototype.deleteKey=function(t,e){return 0};oi.prototype.getDuration=function(){return{}};oi.prototype.getValue=function(t,e){return};oi.prototype.getValueByIndex=function(t,e){return};oi.prototype.setValue=function(t,e,i){return};oi.prototype.isKey=function(t,e){return false};oi.prototype.update=function(t,e,i,r,a){};oi.prototype.reset=function(){this.keyIndexMap={}};var hi=pt.KeyProp=function(t,e,i){var r=this;pt.Prop.call(r,t,e,i)};hi.prototype=P.create(pt.Prop.prototype);hi.prototype.constructor=hi;hi.prototype.fromJson=function(t,e){this.propertyInfo=t;this.forceUpdate=t.forceUpdate;var i=0;var r=t.properties;for(var a=0;a<r.length;a++){var n=r[a].attrib;var s;if(typeof n==="string"){var o=n.split(".");if(o.length>1)s=o}this.propDefaultValue[n]=r[a].default;if(!e){this.propMap[n]=[r[a].type,[],s];continue}var h=e[a];if(!h){if(!this.propMap[n])this.propMap[n]=[r[a].type,[],s];continue}var l=h[0],u=h[1];var f=[];for(var c=0;c<u.length;c++)f.push([u[c][0],this.restoreValue(l,u[c][1])]);this.propMap[n]=[l,f,s];if(f.length>0){var p=f[f.length-1][0];if(i<p)i=p}}return i};hi.prototype.toJson=function(t){var e=[];var i=this.propertyInfo.properties;for(var r=0;r<i.length;r++){var a=i[r].attrib;var n=this.propMap[a];var s=n[0],o=n[1];if(!s||!o)continue;var h=[];for(var l=0;l<o.length;l++)h.push([o[l][0],this.saveValue(s,o[l][1],t)]);e.push([s,h])}return e};hi.prototype.addKey=function(t,e,i){var r=this.propMap[t];if(!r){this.action.game.log.important("KeyProp not find attrib({0}) in addKey.",t);return}var a=function(t,e){return t[0]<e[0]};if((i===C||i===null)&&this.propDefaultValue[t]!=C)i=this.propDefaultValue[t];var n=pt.Util.insertSortedList(r[1],[e,i],a);return n};hi.prototype.deleteKey=function(t,e){var i=this.propMap[t];if(!i){this.action.game.log.important("KeyProp not find attrib({0}) in deleteKey.",t);return}return i[1]?i[1].splice(e,1):null};hi.prototype.getKeyTimeList=function(t){var e=[];var i=this.propMap[t];if(!i){this.action.game.log.important("KeyProp not find attrib({0}) in getKeyTimeList.",t);return[]}for(var r=0;r<i[1].length;r++)e.push(i[1][r][0]);return e};hi.prototype.getDuration=function(){var t=0;for(var e in this.propMap){var i=this.propMap[e];if(i[1].length===0)continue;if(i[1][i[1].length-1][0]>t)t=i[1][i[1].length-1][0]}return t};hi.prototype.isKey=function(t,e){var i=this.propMap[t];if(i[1].length===0)return false;for(var r=0;r<i[1].length;r++){if(this.action.game.math.fuzzyEqual(i[1][r][0],e))return r}};hi.prototype.setValue=function(t,e,i){var r=this.isKey(t,e);if(typeof r!="number"){this.addKey(t,e,i);if(e>this.action.duration)this.action.duration=e;return true}var a=this.propMap[t];a[1][r][1]=i;return};hi.prototype.getValue=function(t,e){var i=this.propMap[t];if(i[1].length===0)return null;for(var r=0;r<i[1].length;r++){if(i[1][r][0]<=e)continue;r=r>0?r-1:0;return i[1][r][1]}return i[1][i[1].length-1][1]};hi.prototype.getValueByIndex=function(t,e){var i=this.propMap[t];if(i[1].length===0)return null;return i[1][e]?i[1][e][1]:null};hi.prototype.updateAttrib=function(t,e,i,r){if(!r)t[e]=i;else{var a=r.length;if(a===2&&t[r[0]])t[r[0]][r[1]]=i;else if(a>2){var n=t;for(var s=0;s<a-1;s++){n=n[r[s]];if(!n)break}if(n)n[r[a-1]]=i}}};hi.prototype.update=function(t,e,i,r,a){if(i)this.keyIndexMap={};for(var n in this.propMap){var s=this.keyIndexMap[n]||0;var o=this.propMap[n];if(o[1].length===0)continue;if(s>o[1].length){this.keyIndexMap[n]=o[1].length;s=o[1].length}if(s<o[1].length&&o[1][s][0]<=e){for(var h=s;h<o[1].length;h++){if(o[1][h][0]<=e){this.updateAttrib(t,n,o[1][h][1],o[2]);this.keyIndexMap[n]=h+1;continue}break}}else{var l=false;for(var h=s-1;h>=0;h--){if(!o[1][h]){this.action.game.log.error("{0}:{1}~{2} update error: keyIndex({3}), propList({4})",this.path,this.propertyId,n,s,o[1]);continue}if(o[1][h][0]>e)continue;l=true;if(h!==s-1||r&&(a||this.forceUpdate)){this.updateAttrib(t,n,o[1][h][1],o[2]);this.keyIndexMap[n]=h+1}break}if(!l)this.keyIndexMap[n]=0}}};var li=pt.LinearProp=function(t,e,i){var r=this;pt.KeyProp.call(r,t,e,i)};li.prototype=P.create(pt.KeyProp.prototype);li.prototype.constructor=li;li.prototype.calcValue=function(t,e,i){return t+i*(e-t)};li.prototype.getValue=function(t,e){var i=this.propMap[t];if(i[1].length===0)return null;if(e<=i[1][0][0])return i[1][0][1];for(var r=0;r<i[1].length;r++){if(i[1][r][0]<e)continue;r=r>0?r-1:0;var a=(e-i[1][r][0])/(i[1][r+1][0]-i[1][r][0]);return this.calcValue(i[1][r][1],i[1][r+1][1],a)}return i[1][i[1].length-1][1]};li.prototype.updateAttrib=function(t,e,i,r){if(!r)t[e]=i;else{var a=r.length;if(a===2&&t[r[0]])t[r[0]][r[1]]=i;else if(a>2){var n=t;for(var s=0;s<a-1;s++){n=n[r[s]];if(!n)break}if(n)n[r[a-1]]=i}}};li.prototype.update=function(t,e,i,r,a){if(i)this.keyIndexMap={};for(var n in this.propMap){var s=this.keyIndexMap[n]||0;var o=this.propMap[n];if(o[1].length===0)continue;if(s>=o[1].length){this.keyIndexMap[n]=o[1].length-1;s=o[1].length-1}if(o[1][s][0]<=e){for(var h=s;h<o[1].length;h++){if(h===o[1].length-1){if(h!==s){this.updateAttrib(t,n,o[1][h][1],o[2]);this.keyIndexMap[n]=h}}else if(o[1][h][0]<=e&&o[1][h+1][0]>e){var l=(e-o[1][h][0])/(o[1][h+1][0]-o[1][h][0]);if(o[1][h][1]&&o[1][h+1][1]){var u=this.calcValue(o[1][h][1],o[1][h+1][1],l);this.updateAttrib(t,n,u,o[2])}this.keyIndexMap[n]=h;break}}}else{if(o[1][0][0]>e){this.keyIndexMap[n]=0;continue}for(var h=0;h<s;h++){if(o[1][h][0]<=e&&o[1][h+1][0]>e){var l=(e-o[1][h][0])/(o[1][h+1][0]-o[1][h][0]);if(o[1][h][1]&&o[1][h+1][1]){var u=this.calcValue(o[1][h][1],o[1][h+1][1],l);this.updateAttrib(t,n,u,o[2])}this.keyIndexMap[n]=h;break}}}}};var ui=pt.CurveProp=function(t,e,i){var r=this;pt.Prop.call(r,t,e,i)};ui.prototype=P.create(pt.Prop.prototype);ui.prototype.constructor=ui;ui.prototype.fromJson=function(t,e){this.propertyInfo=t;var i=0;var r=t.properties;for(var a=0;a<r.length;a++){var n=r[a].attrib;var s;if(typeof n==="string"){var o=n.split(".");if(o.length>1)s=o}this.propDefaultValue[n]=r[a].default;if(!e){this.propMap[n]={curveType:pt.CURVE_TYPE_ABSOLUTE,curve:new pt.BezierCurve,to:0,attribArray:s};continue}var h=e[a];if(!h)continue;var l=new pt.BezierCurve;this.propMap[n]={curveType:h[0],curve:l,to:0,attribArray:s};l.fromJson(h[1]);if(h[0]>=pt.CURVE_TYPE_TWEEN_RELATIVE){this.propMap[n]["from"]=h[2][0];this.propMap[n]["to"]=h[2][1]||0;this.propMap[n]["playTime"]=h[3]||-1;this.propMap[n["playAfterNumLoop"]]=h[4]||0}else{this.propMap[n]["playTime"]=h[2]||-1;this.propMap[n]["playAfterNumLoop"]=h[3]||0}if(l._keys.length>0){var u=l._keys[l._keys.length-1].time;if(i<u)i=u}}return i};ui.prototype.toJson=function(t){var e=[];var i=this.propertyInfo.properties;for(var r=0;r<i.length;r++){var a=i[r].attrib;var n=this.propMap[a];var s=[n.curveType,n.curve.toJson()];if(n.curveType>=pt.CURVE_TYPE_TWEEN_RELATIVE)s.push([n.from,n.to]);s.push(n.playTime);s.push(n.playAfterNumLoop);e.push(s)}return e};ui.prototype.setData=function(t,e){var i=this.propMap[t];if(!i){this.action.game.log.important("CurveProp not find attrib({0}) in setData.",t);return}if(typeof e.curveType==="number")i.curveType=e.curveType;if(typeof e.from==="number")i.from=e.from;if(typeof e.to==="number")i.to=e.to};ui.prototype.getMaxValue=function(t){var e=this.propMap[t];if(!e){this.action.game.log.important("CurveProp not find attrib({0}) in getMaxValue.",t);return}var i=false;for(var r=0;r<e.curve._keys.length;r++){if(i===false)i=e.curve._keys[r].value;else if(i<e.curve._keys[r].value)i=e.curve._keys[r].value}if(e.curveType===pt.CURVE_TYPE_ABSOLUTE)return i;else if(e.curveType===pt.CURVE_TYPE_RELATIVE)return e.from+i;else if(e.curveType===pt.CURVE_TYPE_TWEEN_ABSOLUTE)return e.from+i*(e.to-e.from);else if(e.curveType===pt.CURVE_TYPE_TWEEN_RELATIVE)return e.from+i*e.to};ui.prototype.getFromValue=function(t,e,i){var r=this.propMap[e];if(!r){this.action.game.log.important("CurveProp not find attrib({0}) in getFromValue.",e);return}if(typeof r.from==="number")return r.from;if(!t)return;var a;if(r.attribArray){var n=r.attribArray.length;if(n===2)a=t[r.attribArray[0]]?t[r.attribArray[0]][r.attribArray[1]]:null;else if(n>2){var s=t;for(var o=0;o<n-1;o++){s=s[r.attribArray[o]];if(!s)break}if(s)a=s[r.attribArray[n-1]]}}else a=t[e];var h=this.getValue(e,i,true)||0;var l=r.to;var u=h;if(r.curveType===pt.CURVE_TYPE_RELATIVE)u=a-h;else if(r.curveType===pt.CURVE_TYPE_TWEEN_RELATIVE)u=a-(l?l*h:0);r.from=u;return u};ui.prototype.addKey=function(t,e,i){var r=this.propMap[t];if(!r){this.action.game.log.important("CurveProp not find attrib({0}) in addKey.",t);return}if((i===C||i===null)&&this.propDefaultValue[t]!=C)i=this.propDefaultValue[t];i=i||0;var a=r.curve.addKey(e,i);r.curve.makeKeyframeLinear(a-1);r.curve.makeKeyframeLinear(a);r.curve.makeKeyframeLinear(a+1);return a};ui.prototype.deleteKey=function(t,e){var i=this.propMap[t];if(!i){this.action.game.log.important("CurveProp not find attrib({0}) in deleteKey.",t);return}i.curve.removeKey(e)};ui.prototype.getKeyTimeList=function(t){var e=[];var i=this.propMap[t];if(!i){this.action.game.log.important("CurveProp not find attrib({0}) in getKeyTimeList.",t);return[]}for(var r=0;r<i.curve._keys.length;r++)e.push(i.curve._keys[r].time);return e};ui.prototype.getDuration=function(){var t=0;for(var e in this.propMap){var i=this.propMap[e];var r=i.curve;if(r._keys.length<1)continue;var a=r._keys[r._keys.length-1].time;if(t<a)t=a}return t};ui.prototype.getValue=function(t,e,i){var r=this.propMap[t];var a=r.from;var n=r.to;var s=r.curveType;var o=r.curve;var h=o.evaluate(e);if(i)return h;if(s===pt.CURVE_TYPE_ABSOLUTE)return h;else if(s===pt.CURVE_TYPE_RELATIVE)return a+h;else if(s===pt.CURVE_TYPE_TWEEN_ABSOLUTE)return a+h*(n-a);else return a+h*n};ui.prototype.getValueByIndex=function(t,e){var i=this.propMap[t];var r=i.curve;return r._keys[e]?r._keys[e].value:null};ui.prototype.setValue=function(t,e,i){var r=this.isKey(t,e);if(typeof r!="number"){this.addKey(t,e,i);if(e>this.action.duration)this.action.duration=e;return true}var a=this.propMap[t];var n=a.curve;n._keys[r].value=i;a.curve.makeKeyframeLinear(r-1);a.curve.makeKeyframeLinear(r);a.curve.makeKeyframeLinear(r+1);return};ui.prototype.isKey=function(t,e){var i=this.propMap[t];var r=i.curve;if(r._keys.length===0)return false;for(var a=0;a<r._keys.length;a++){if(this.action.game.math.fuzzyEqual(r._keys[a].time,e))return a}};ui.prototype.update=function(t,e,i,r,a){if(i)this.keyIndexMap={};for(var n in this.propMap){if(this.propMap[n].playTime===0){continue}if(!r&&this.keyIndexMap[n])continue;var s=this.propMap[n];var o=s.curve;var h=s.curveType;var l;if(i){if(h===pt.CURVE_TYPE_RELATIVE||h===pt.CURVE_TYPE_TWEEN_RELATIVE){if(s.attribArray){var u=s.attribArray.length;if(u===2)l=t[s.attribArray[0]]?t[s.attribArray[0]][s.attribArray[1]]:null;else if(u>2){var f=t;for(var c=0;c<u-1;c++){f=f[s.attribArray[c]];if(!f)break}if(f)l=f[s.attribArray[u-1]]}}else l=t[n];s.from=l}}if(o._keys.length<=0)continue;if(o._keys[0].time>e)continue;var p=this.getFromValue(t,n,e);var d=s.to;var _=o.evaluate(e);if(!r&&o._keys[o._keys.length-1].time<=e){if(this.propMap[n].playTime!=-1){--this.propMap[n].playTime}if(this.propMap[n]["playAfterNumLoop"]>0){--this.propMap[n]["playAfterNumLoop"]}this.keyIndexMap[n]=1}if(this.propMap[n]["playAfterNumLoop"]>0){continue}if(h===pt.CURVE_TYPE_ABSOLUTE)l=_;else if(h===pt.CURVE_TYPE_RELATIVE)l=p+_;else if(h===pt.CURVE_TYPE_TWEEN_ABSOLUTE)l=p+_*(d-p);else l=p+_*d;if(s.attribArray){var u=s.attribArray.length;if(u===2&&t[s.attribArray[0]])t[s.attribArray[0]][s.attribArray[1]]=l;else if(u>2){var f=t;for(var c=0;c<u-1;c++){f=f[s.attribArray[c]];if(!f)break}if(f)f[s.attribArray[u-1]]=l}}else t[n]=l}};var fi=pt.ActionState=function(t){var e=this;e.game=t;e.name="";e.targetObject=null;e.targetLocked=false;e.eventList=[];e.samples=60;e.duration=0;e.speed=1;e.startTime=0;e.elapsedFrame=0;e.loop=false;e.playEventInEditor=true;e.isRunning=false;e.onFinished=new pt.Signal;e.onLoopFinished=new pt.Signal;e.unpackDone=false};fi.prototype.constructor=fi;fi.prototype.awake=function(){this.unpackDone=true;if(typeof this.targetObject==="string")this.targetObject=this.game.nodePool.find(this.targetObject)};fi.prototype.destroy=function(){var t=this;t.targetObject=null;t.isRunning=false;t.eventList=[];t.onFinished.removeAll();t.onLoopFinished.removeAll()};fi.prototype.getDuration=function(t){return this.duration};fi.prototype.reset=function(){this.elapsedFrame=0;this.startTime=0};fi.prototype.playAction=function(t,e){this.isRunning=true;if(!this.targetLocked&&t)this.targetObject=t;if(e)this.reset();return this.update(null,true)};fi.prototype.stop=function(){this.isRunning=false};fi.prototype.addEvent=function(t,e,i){var r=function(t,e){return t[0]<e[0]};var a=pt.Util.insertSortedList(this.eventList,[t,e,i],r,true);return a};fi.prototype.deleteEvent=function(t){return this.eventList?this.eventList.splice(t,1):null};fi.prototype.setEvent=function(t,e,i){var r=this.eventList[t];if(!r)return;r[e]=i};fi.prototype.getEventInfo=function(t){var e=this.eventList[t];if(!e)return;return{func:e[1],para:e[2]}};fi.prototype.triggerEvent=function(t){var e=this.eventList[0][0];var i=this.eventList[this.eventList.length-1][0];if(this.elapsedFrame<e||t>i)return;for(var r=0;r<this.eventList.length;r++){if(this.eventList[r][0]<=t)continue;else if(this.eventList[r][0]<=this.elapsedFrame){if(this.eventList[r][1]){for(var a=0;a<this.targetObject.scripts.length;a++){var n=this.targetObject.scripts[a];if(n[this.eventList[r][1]]){var s=this.eventList[r][2];if(!Array.isArray(s)){if(typeof s==="string")s=[s];else s=[]}n[this.eventList[r][1]].apply(n,s)}}}}else break}};fi.prototype.update=function(t,e,i,r){};fi.buildEmptyBundle=function(){return{}};fi.buildBundle=function(t){var e={dependences:[]};if(t.targetObject)e.targetObject=t.targetObject.uuid;e.targetLocked=t.targetLocked;e.loop=t.loop;e.samples=t.samples;e.speed=t.speed;e.playEventInEditor=t.playEventInEditor;if(t.name){e.name=t.name;e.uniqueName=t.uniqueName||e.name}if(t.currentScene){e.currentScene=t.currentScene}e.eventList=JSON.stringify(t.eventList);return e};fi.restoreBundle=function(t,e,i){var r=e.json;var a=t.game;t.uuid=e.uuid;t.key=e.key;if(r.name)t.name=r.name;else t.name=e.key.match(/\/([^\/]+?).bin/)[1];if(r.uniqueName)t.uniqueName=r.uniqueName;else t.uniqueName=t.name;if(r.currentScene){t.currentScene=r.currentScene}if(r.__json)t.__json=r.__json;if(r.eventList){try{t.eventList=JSON.parse(r.eventList)}catch(t){a.log.error(t)}}t.targetLocked=r.targetLocked;t.loop=r.loop;t.samples=r.samples||60;t.speed=r.speed||1;t.playEventInEditor=typeof r.playEventInEditor==="boolean"?r.playEventInEditor:true;if(i)t.targetObject=a.nodePool.find(r.targetObject);else t.targetObject=a.nodePool.find(r.targetObject)||r.targetObject;if(i)t.awake();return t};var ci=pt.Action=function(t){var e=this;e.propertyList={};e.actionList=[];pt.ActionState.call(e,t);e.class="qc.Action"};ci.prototype=P.create(pt.ActionState.prototype);ci.prototype.constructor=ci;P.defineProperties(ci.prototype,{targetObject:{get:function(){return this._targetObject},set:function(t){if(this.unpackDone&&t===this._targetObject&&this._targetObject)return;this._targetObject=t;if(!this.unpackDone)return;this.actionList=[];if(!t)return;this.refreshActionList()}}});ci.prototype.awake=function(){this.unpackDone=true;if(typeof this.targetObject==="string")this.targetObject=this.game.nodePool.find(this.targetObject);else if(typeof this.targetObject==="object"&&this.actionList.length===0)this.refreshActionList();if(!this.targetObject&&this.targetLocked){this.game.log.trace("Action({0}) can not find targetObject.",this.name);return}};ci.prototype.destroy=function(){var t=this;t.targetObject=null;t.isRunning=false;for(var e in t.propertyList)t.propertyList[e].destroy();t.propertyList={};t.actionList=[];t.eventList=[];t.onFinished.removeAll();t.onLoopFinished.removeAll()};ci.prototype.refreshActionList=function(){if(!this.targetObject){this.game.log.trace("Action({0}) can not find targetObject.",this.name);return}this.actionList=[];for(var t in this.propertyList){var e=t.match(/(.*):(.*)/);var i=e[1];var r=e[2];var a=this.targetObject.find(i);if(a){this.actionList.push({target:a,propOb:this.propertyList[t]})}else this.game.log.error("In action({0}), target({1}) not find child({2})",this.key,this.targetObject?this.targetObject.name:null,i)}};ci.prototype.addProperty=function(t,e,i,r){var a=t+":"+e;var n=this.propertyList[a];if(n){this.game.log.important("Action has duplicate key : {0} in addProperty",a);return}var s=pt.ActionProperties[e];if(!s){this.game.log.important("Can't find propertyId : {0} in addProperty",e);return}var o=pt.Util.findClass(s.class);n=new o(this,t,e);var h=n.fromJson(s,i);if(this.duration<h)this.duration=h;this.propertyList[a]=n;if(r)this.refreshActionList()};ci.prototype.removeProperty=function(t,e){var i=t+":"+e;var r=this.propertyList[i];if(!r){this.game.log.important("Action not find key : {0} in removeProperty",i);return}r.destroy();delete this.propertyList[i];this.refreshActionList();this.duration=this.getDuration(true,true)};ci.prototype.getPropertyInfo=function(t,e){var i=t+":"+e;var r=this.propertyList[i];if(!r){this.game.log.important("Action not find key : {0} in getPropertyInfo",i);return}return r.getPropMap()};ci.prototype.setData=function(t,e,i,r){var a=t+":"+e;var n=this.propertyList[a];if(!n){this.game.log.important("Action has't property : {0} in setData",a);return}n.setData(i,r)};ci.prototype.addKey=function(t,e,i,r,a){var n=t+":"+e;var s=this.propertyList[n];if(!s){this.game.log.important("Action has't property : {0} in addKey",n);return}var o=s.addKey(i,r,a);if(r>this.duration)this.duration=r};ci.prototype.deleteKey=function(t,e,i,r){var a=t+":"+e;var n=this.propertyList[a];if(!n){this.game.log.important("Action has't property : {0} in deleteKey",a);return}var s=n.getKeyTimeList(i);var o=s[r];n.deleteKey(i,r);if(this.duration==o)this.duration=this.getDuration(true,true)};ci.prototype.getDuration=function(t,e){if(t){var i=0;for(var r in this.propertyList){var a=this.propertyList[r];var n=a.getDuration();if(i<n)i=n}this.duration=i}if(this.loop&&!e)return pt.MAX_DURATION;return this.duration};ci.prototype.getValue=function(t,e,i,r,a){var n=t+":"+e;var s=this.propertyList[n];if(!s){this.game.log.important("Action has't property : {0} in getValue",n);return}return s.getValue(i,r,a)};ci.prototype.getValueByIndex=function(t,e,i,r){var a=t+":"+e;var n=this.propertyList[a];if(!n){this.game.log.important("Action has't property : {0} in getValueByIndex",a);return}return n.getValueByIndex(i,r)};ci.prototype.reset=function(){this.elapsedFrame=0;this.startTime=0;for(var t=0;t<this.actionList.length;t++){var e=this.actionList[t];e.propOb.reset()}};ci.prototype.update=function(t,e,i,r){if(!this.isRunning&&!i||!this.targetObject||this.duration===0)return;var a=this.game.time.scaledTime;if(this.elapsedFrame>=this.duration){if(!this.loop){for(var n=0;n<this.actionList.length;n++){var s=this.actionList[n];s.propOb.update(s.target,this.elapsedFrame,true,i,r)}this.isRunning=false;this.onFinished.dispatch(this);return pt.FinishTrigger}else{this.onLoopFinished.dispatch(this);this.isRunning=true;var o=this.elapsedFrame-this.duration;while(o>=this.duration)o=o-this.duration;t=o/(this.samples*this.speed)*1e3;this.reset();this.startTime=a-t}}t=typeof t==="number"?t:this.game.time.deltaTime;if(!this.startTime)this.startTime=a;if(a===this.startTime)t=0;var h=e?-1:this.elapsedFrame;this.elapsedFrame+=t/1e3*this.samples*this.speed;for(var n=0;n<this.actionList.length;n++){var s=this.actionList[n];s.propOb.update(s.target,this.elapsedFrame,e,i,r)}if(i&&!this.playEventInEditor)return;if(this.eventList.length>0)this.triggerEvent(h)};ci.buildEmptyBundle=function(){return{propertyList:{}}};ci.buildBundle=function(t){var e=pt.ActionState.buildBundle(t);var i={};for(var r in t.propertyList){var a=r.match(/(.*):(.*)/);var n=a[1];var s=a[2];i[n]=i[n]||{};i[n][s]=t.propertyList[r].toJson(e)}e.propertyList=i;return e};ci.restoreBundle=function(t,e,i){var r=t.json;var a=new pt.Action(e);for(var n in r.propertyList){for(var s in r.propertyList[n])a.addProperty(n,s,r.propertyList[n][s])}a=pt.ActionState.restoreBundle(a,t,i);return a};ci.prototype.stop=function(){this.isRunning=false;for(var t=0;t<this.actionList.length;t++){var e=this.actionList[t].target;if(Number(this.actionList[t].propOb.propertyId)===pt.PROP_SOUND){this.actionList[t].target.isPlaying=false}}};pt.MAX_DURATION=4294967295;pt.CURVE_TYPE_RELATIVE=1;pt.CURVE_TYPE_ABSOLUTE=2;pt.CURVE_TYPE_TWEEN_RELATIVE=3;pt.CURVE_TYPE_TWEEN_ABSOLUTE=4;pt.PROP_POSITION=1;pt.PROP_ROTATION=2;pt.PROP_ALPHA=3;pt.PROP_SCALE=4;pt.PROP_COLOR_TINT=5;pt.PROP_VISIBLE=6;pt.PROP_SIZE=7;pt.PROP_SKEW=8;pt.PROP_TEXTURE=9;pt.PROP_ANIMATION=10;pt.PROP_COLOR=11;pt.PROP_TEXT=12;pt.PROP_PIVOT=13;pt.PROP_ANCHORED_POSITION=14;pt.PROP_TOGGLE_ON=15;pt.PROP_SCROLLBAR_VALUE=16;pt.PROP_SCROLLVIEW_POSITION=17;pt.PROP_PROGRESSBAR_VALUE=18;pt.PROP_SLIDER_VALUE=19;pt.PROP_SOUND=20;pt.PROP_DOM_INNERHTML=21;pt.PROP_TILEMAP_POSITION=22;pt.PROP_SEQUENCE_FRAME=23;pt.PROP_VIDEO=24;pt.ActionProperties={};pt.ActionProperties[pt.PROP_POSITION]={name:"Position",class:"qc.CurveProp",curve:true,properties:[{attrib:"x",type:N.NUMBER,defaultValue:0},{attrib:"y",type:N.NUMBER,defaultValue:0}]};pt.ActionProperties[pt.PROP_ANCHORED_POSITION]={name:"AnchoredPosition",class:"qc.CurveProp",curve:true,properties:[{attrib:"anchoredX",type:N.NUMBER,defaultValue:0},{attrib:"anchoredY",type:N.NUMBER,defaultValue:0}]};pt.ActionProperties[pt.PROP_ROTATION]={name:"Rotation",class:"qc.CurveProp",curve:true,properties:[{attrib:"rotation",type:"angle",defaultValue:0}]};pt.ActionProperties[pt.PROP_ALPHA]={name:"Alpha",class:"qc.CurveProp",curve:true,properties:[{attrib:"alpha",type:N.NUMBER,min:0,max:1,precision:2,defaultValue:1}]};pt.ActionProperties[pt.PROP_SCALE]={name:"Scale",class:"qc.CurveProp",curve:true,properties:[{attrib:"scaleX",type:N.NUMBER,defaultValue:1},{attrib:"scaleY",type:N.NUMBER,defaultValue:1}]};pt.ActionProperties[pt.PROP_COLOR_TINT]={name:"ColorTint",class:"qc.ColorLinearProp",properties:[{attrib:"colorTint",type:N.COLOR,default:pt.Color.white}]};pt.ActionProperties[pt.PROP_VISIBLE]={name:"Visible",class:"qc.KeyProp",forceUpdate:true,properties:[{attrib:"visible",type:N.BOOLEAN,default:true}]};pt.ActionProperties[pt.PROP_SIZE]={name:"Size",class:"qc.CurveProp",curve:true,properties:[{attrib:"width",type:N.NUMBER},{attrib:"height",type:N.NUMBER}]};pt.ActionProperties[pt.PROP_PIVOT]={name:"Pivot",class:"qc.CurveProp",curve:true,properties:[{attrib:"pivotX",type:N.NUMBER},{attrib:"pivotY",type:N.NUMBER}]};pt.ActionProperties[pt.PROP_SKEW]={name:"Skew",class:"qc.CurveProp",curve:true,properties:[{attrib:"skewX",type:"angle"},{attrib:"skewY",type:"angle"}]};pt.ActionProperties[pt.PROP_TEXTURE]={name:"Texture",class:"qc.TextureKeyProp",forceUpdate:true,properties:[{attrib:"texture",type:N.TEXTURE}]};pt.ActionProperties[pt.PROP_ANIMATION]={name:"Animation",class:"qc.AnimationKeyProp",properties:[{attrib:"defaultAnimation",type:N.STRING}]};pt.ActionProperties[pt.PROP_COLOR]={name:"Color",class:"qc.ColorLinearProp",properties:[{attrib:"color",type:N.COLOR,default:pt.Color.white}]};pt.ActionProperties[pt.PROP_TEXT]={name:"Text",class:"qc.KeyProp",forceUpdate:true,properties:[{attrib:"text",type:N.STRING,default:""}]};pt.ActionProperties[pt.PROP_TOGGLE_ON]={name:"ToggleOn",class:"qc.KeyProp",forceUpdate:true,properties:[{attrib:"on",type:N.BOOLEAN,default:true}]};pt.ActionProperties[pt.PROP_SCROLLBAR_VALUE]={name:"ScrollBarValue",class:"qc.CurveProp",curve:true,properties:[{attrib:"value",type:N.NUMBER}]};pt.ActionProperties[pt.PROP_SCROLLVIEW_POSITION]={name:"ScrollViewPosition",class:"qc.CurveProp",curve:true,properties:[{attrib:"horizontalNormalizedPosition",type:N.NUMBER},{attrib:"verticalNormalizedPosition",type:N.NUMBER}]};pt.ActionProperties[pt.PROP_PROGRESSBAR_VALUE]={name:"ProgressBarValue",class:"qc.CurveProp",curve:true,properties:[{attrib:"value",type:N.NUMBER}]};pt.ActionProperties[pt.PROP_SLIDER_VALUE]={name:"SliderValue",class:"qc.CurveProp",curve:true,properties:[{attrib:"value",type:N.NUMBER}]};pt.ActionProperties[pt.PROP_SOUND]={name:"Sound",class:"qc.KeyProp",properties:[{attrib:"isPlaying",type:N.BOOLEAN,default:true}]};pt.ActionProperties[pt.PROP_DOM_INNERHTML]={name:"DomInnerHTML",class:"qc.KeyProp",forceUpdate:true,properties:[{attrib:"innerHTML",type:N.STRING,default:""}]};pt.ActionProperties[pt.PROP_TILEMAP_POSITION]={name:"TilemapPosition",class:"qc.CurveProp",curve:true,properties:[{attrib:"scrollX",type:N.NUMBER},{attrib:"scrollY",type:N.NUMBER}]};pt.ActionProperties[pt.PROP_SEQUENCE_FRAME]={name:"SequenceFrame",class:"qc.SequenceFrameKeyProp",properties:[{attrib:"sequenceFrame",type:N.STRING}]};pt.ActionProperties[pt.PROP_VIDEO]={name:"Video",class:"qc.KeyProp",properties:[{attrib:"isPlaying",type:N.BOOLEAN,default:true}]};pt.FinishTrigger=1;pt.EventTrigger=2;pt.propertyList={"qc.Node":[pt.PROP_POSITION,pt.PROP_ANCHORED_POSITION,pt.PROP_ROTATION,pt.PROP_ALPHA,pt.PROP_SCALE,pt.PROP_COLOR_TINT,pt.PROP_VISIBLE,pt.PROP_SIZE,pt.PROP_PIVOT],"qc.UIImage":[pt.PROP_SKEW,pt.PROP_TEXTURE],"qc.Sprite":[pt.PROP_TEXTURE,pt.PROP_ANIMATION],"qc.UIText":[pt.PROP_COLOR,pt.PROP_TEXT],"qc.Button":[pt.PROP_TEXTURE],"qc.Toggle":[pt.PROP_TOGGLE_ON],"qc.ScrollBar":[pt.PROP_TEXTURE,pt.PROP_SCROLLBAR_VALUE],"qc.ScrollView":[pt.PROP_TEXTURE,pt.PROP_SCROLLVIEW_POSITION],"qc.ProgressBar":[pt.PROP_TEXTURE,pt.PROP_PROGRESSBAR_VALUE],"qc.Slider":[pt.PROP_TEXTURE,pt.PROP_SLIDER_VALUE],"qc.InputField":[pt.PROP_TEXTURE,pt.PROP_TEXT],"qc.Sound":[pt.PROP_SOUND],"qc.Dom":[pt.PROP_DOM_INNERHTML],"qc.Graphics":[],"qc.UIRoot":[],"qc.Tilemap":[pt.PROP_TILEMAP_POSITION]};pt.extend=pt.extend||{};pt.extend.addProperty=function(t,e,i){if(i===pt.Serializer.NUMBER){pt.ActionProperties[e]={name:e,class:"qc.CurveProp",curve:true,isCustomProperty:true,properties:[{attrib:e,type:pt.Serializer.NUMBER}]}}else if(i===pt.Serializer.TEXTURE){pt.ActionProperties[e]={name:e,class:"qc.TextureKeyProp",forceUpdate:true,isCustomProperty:true,properties:[{attrib:e,type:pt.Serializer.TEXTURE}]}}else if(i===pt.Serializer.COLOR){pt.ActionProperties[e]={name:e,class:"qc.ColorLinearProp",isCustomProperty:true,properties:[{attrib:e,type:N.COLOR,default:pt.Color.white}]}}else{pt.ActionProperties[e]={name:e,class:"qc.KeyProp",forceUpdate:true,isCustomProperty:true,properties:[{attrib:e,type:i}]}}pt.propertyList[t]=pt.propertyList[t]||[];pt.propertyList[t].push(e)};var pi=pt.ActionManager=function(t){var e=this;e.actionList=[];pt.ActionState.call(e,t);e.class="qc.ActionManager";e._endLinePos=-1;e.runningActions={}};pi.prototype=P.create(pt.ActionState.prototype);pi.prototype.constructor=pi;pi.prototype.awake=function(){this.unpackDone=true;if(typeof this.targetObject==="string")this.targetObject=this.game.nodePool.find(this.targetObject);if(!this.targetObject&&this.targetLocked){this.game.log.trace("Action({0}) can not find targetObject.",this.name);return}for(var t=0;t<this.actionList.length;t++){if(this.actionList[t]&&this.actionList[t][1])this.actionList[t][1].awake()}};pi.prototype.destroy=function(){var t=this;t.isRunning=false;t._targetObject=null;for(var e=0;e<this.actionList.length;e++){if(this.actionList[e]&&this.actionList[e][1])this.actionList[e][1].destroy()}t.actionList=[]};P.defineProperties(pi.prototype,{targetObject:{get:function(){return this._targetObject},set:function(t){if(this.unpackDone&&t===this._targetObject&&this._targetObject)return;this._targetObject=t;for(var e=0;e<this.actionList.length;e++){if(!this.actionList[e])continue;var i=this.actionList[e][1];if(i&&!i.targetLocked)i.targetObject=t}}},isRunning:{get:function(){return this._isRunning},set:function(t){this._isRunning=t;for(var e=0;e<this.actionList.length;e++){if(!this.actionList[e])continue;var i=this.actionList[e][1];if(i)i.isRunning=t}}},endLinePos:{get:function(){return this._endLinePos},set:function(t){this._endLinePos=t;if(t>-1)this.duration=t;else{this.getDuration(true)}}}});pi.prototype.reset=function(){this.elapsedFrame=0;this.startTime=0;this.runningActions={};for(var t=0;t<this.actionList.length;t++){if(!this.actionList[t])continue;var e=this.actionList[t][1];if(e)e.reset()}};pi.prototype.update=function(t,e,i,r){if(!this.isRunning&&!i||!this.targetObject)return;var a=this.game.time.scaledTime;if(this.elapsedFrame>=this.duration){if(!this.loop){this.isRunning=false;this.onFinished.dispatch(this);return pt.FinishTrigger}else{this.onLoopFinished.dispatch(this);this.isRunning=true;var n=this.elapsedFrame-this.duration;while(n>=this.duration)n=n-this.duration;t=n/(this.samples*this.speed)*1e3;this.reset();var o=function(t,e,i){t.startTime=e;var r=i*t.samples*t.speed/1e3;if(t.duration<r)t.elapsedFrame=r;if(t instanceof pt.ActionManager){for(var a=0;a<t.actionList.length;a++){var n=t.actionList[a];if(!n)continue;var s=n[1];o(s,e,i)}}};o(this,a-t,t)}}t=typeof t==="number"?t:this.game.time.deltaTime;if(!this.startTime)this.startTime=a;if(a===this.startTime)t=0;var s=e?-1:this.elapsedFrame;this.elapsedFrame+=t/1e3*this.samples*this.speed;if(this.eventList.length>0&&!(i&&!this.playEventInEditor))this.triggerEvent(s);t=t*this.speed;for(var h=0;h<this.actionList.length;h++){var l=this.actionList[h];if(ps.ScrFix.isP&&/^heng_/.test(l[1].name)){continue}if(ps.ScrFix.isL&&/^shu_/.test(l[1].name)){continue}if(!l)continue;var a=l[0],u=l[1];if(this.elapsedFrame<a){for(var f in u.propertyList){if(u.propertyList[f].propertyInfo.name==="Visible"){var c=u.propertyList[f].path;var p=pt.gameOb.world.find("UIRoot/gamePlay/"+c);p.visible=false}}continue}var d=false;if(!this.runningActions[h])d=true;if(this.elapsedFrame>=this.duration){u.elapsedFrame=u.duration}u.update(t,d,i,r);this.runningActions[h]=true}};pi.prototype.addAction=function(t){var e=this;var i=e.actionList.push(t);var r=t[0],a=t[1];a.parent=e;if(e.endLinePos>-1)return i;var n=a.getDuration();if(n===pt.MAX_DURATION)e.duration=n;else{var s=e.samples;var o=a.samples;n=n*s/o;if(e.duration<r+n)e.duration=r+n}return i};pi.prototype.deleteAction=function(t){var e=this;if(!e.actionList[t])return;var i=e.actionList[t][1];var r=0;if(i){var a=i.getDuration();if(a===pt.MAX_DURATION)r=pt.MAX_DURATION;else{var n=e.samples;var s=i.samples;a=a*n/s;r=e.actionList[t][0]+a}i.destroy();i.parent=C}e.actionList.splice(t,1);if(this.duration===r)this.getDuration(true)};pi.prototype.updateActionTime=function(t,e){var i=this;var r=i.actionList[t];if(!r)return;r[0]=e;i.getDuration(true)};pi.prototype.getDuration=function(t,e){if(t&&this.endLinePos<=-1){var i=0;for(var r=0;r<this.actionList.length;r++){var a=this.actionList[r];if(!a)continue;var n=a[1].getDuration();var s=a[0];if(n===pt.MAX_DURATION)i=pt.MAX_DURATION;else{var o=this.samples;var h=a[1].samples;n=n*o/h/a[1].speed;if(i<s+n)i=s+n}}this.duration=i}if(this.loop&&!e)return pt.MAX_DURATION;if(this.endLinePos>-1)return this.endLinePos;return this.duration};pi.buildEmptyBundle=function(){return{actionList:[]}};pi.buildBundle=function(t){var e=pt.ActionState.buildBundle(t);e.endLinePos=t.endLinePos;var i=[];for(var r=0;r<t.actionList.length;r++){var a=t.actionList[r];if(!a)continue;var n=a[1];var s=a[0];var o=n.uuid;var h=n.loop;var l=n.targetObject?n.targetObject.uuid:C;e.dependences.push({key:n.key,uuid:o});i.push([s,o,h,l,n.targetLocked,n.speed])}e.actionList=i;return e};pi.restoreBundle=function(t,e,i,r){var a=t.json;var n=new pt.ActionManager(e);if(!r)r={};if(r[t.uuid]){e.log.error("Failed to add this action({0}) because of recursive reference.",t.key);return false}r[t.uuid]=true;n.endLinePos=a.endLinePos?a.endLinePos:-1;for(var s=0;s<a.actionList.length;s++){var o=a.actionList[s]||[];var h=o[0],l=o[1],u=o[2];var f=o[3],c=o[4];var p=o[5]||1;var d=e.assets.findByUUID(l);if(d){var _;if(d instanceof pt.ActionAsset)_=pt.Action.restoreBundle(d,e,!e.serializer.isRestoring);else if(d instanceof pt.ActionManagerAsset){_=pt.ActionManager.restoreBundle(d,e,!e.serializer.isRestoring,r);if(!_){delete r[t.uuid];return false}}_.loop=u;_.speed=p;if(!e.serializer.isRestoring)_.targetObject=e.nodePool.find(f);else _.targetObject=e.nodePool.find(f)||f;_.targetLocked=c;n.addAction([h,_])}}delete r[t.uuid];n=pt.ActionState.restoreBundle(n,t,i);return n};pi.prototype.stop=function(){this.isRunning=false;for(var t=0;t<this.actionList.length;t++){if(!this.actionList[t])continue;var e=this.actionList[t][1];if(e){e.stop()}}};var di=pt.AnimationKeyProp=function(t,e,i){var r=this;pt.KeyProp.call(r,t,e,i)};di.prototype=P.create(pt.KeyProp.prototype);di.prototype.constructor=di;di.prototype.updateAttrib=function(t,e,i,r){var a=t.getScript("ps.SKPlayer");if(i===a.animationName){return}a.animationName=i;a.play()};var _i=pt.SequenceFrameKeyProp=function(t,e,i){var r=this;pt.KeyProp.call(r,t,e,i)};_i.prototype=P.create(pt.KeyProp.prototype);_i.prototype.constructor=_i;_i.prototype.updateAttrib=function(t,e,i,r){var a=t.getScript("ps.MovieClip");if(i===a.currentFrameName){return}a.gotoAndPlay(i)};var gi=pt.ColorLinearProp=function(t,e,i){var r=this;pt.LinearProp.call(r,t,e,i)};gi.prototype=P.create(pt.LinearProp.prototype);gi.prototype.constructor=gi;gi.prototype.calcValue=function(t,e,i){if(!t||!e)return pt.Color.white;var r=t.rgb,a=e.rgb;var n=[dt.Math.clamp(Math.round(r[0]+i*(a[0]-r[0])),0,255),dt.Math.clamp(Math.round(r[1]+i*(a[1]-r[1])),0,255),dt.Math.clamp(Math.round(r[2]+i*(a[2]-r[2])),0,255),dt.Math.clamp(t.alpha+i*(e.alpha-t.alpha),0,1)];var s=new yt(n);return s};var mi=pt.TextureKeyProp=function(t,e,i){var r=this;pt.KeyProp.call(r,t,e,i)};mi.prototype=P.create(pt.KeyProp.prototype);mi.prototype.constructor=mi;mi.prototype.updateAttrib=function(t,e,i,r){if(!i){var a=this.action.game.assets.find("__builtin_resource__");var n=a?a.frameNames[0]:0;i=[a,n]}var a=i[0],n=i[1];var s=a?new pt.Texture(a,n):null;if(!r)t[e]=s;else{var o=r.length;if(o===2&&t[r[0]])t[r[0]][r[1]]=s;else if(o>2){var h=t;for(var l=0;l<o-1;l++){h=h[r[l]];if(!h)break}if(h)h[r[o-1]]=s}}};var yi=pt.Time=function(t){this.phaser=t.phaser.time;this.phaser._qc=this;this.onFrameRateChanged=new pt.Signal};yi.prototype.constructor=yi;P.defineProperties(yi.prototype,{game:{get:function(){return this.phaser.game._qc}},now:{get:function(){return Date.now()}},fixedTime:{get:function(){return this.phaser.totalElapsedSeconds()*1e3}},scaledTime:{get:function(){return this.phaser._totalEscapeTime||0}},timeScale:{get:function(){return this.phaser.slowMotion},set:function(t){if(t<=0)t=1e-6;this.phaser.slowMotion=t}},frameRate:{get:function(){return this.phaser.desiredFps},set:function(t){this.phaser.desiredFps=t;this.onFrameRateChanged.dispatch(t)}},deltaTime:{get:function(){return this.phaser.frameDeltaTime}}});yi.prototype.applyFrameRate=function(t){var e=this.game.device.desktop?t.desktop:t.mobile;this.frameRate=e};var vi=pt.LinkList=function(t){this.length=t;this.head=null;this.tail=null;while(t--){this.push({})}};vi.prototype={};vi.prototype.constructor=vi;vi.prototype.push=function(t){t.pre=null;t.next=null;if(!this.head){this.head=t;this.tail=this.head}else{this.tail.next=t;t.pre=this.tail;this.tail=this.tail.next}this.length++};vi.prototype.insertBefore=function(t,e){if(!t){this.push(e);return}var i=t.pre;t.pre=e;e.next=t;e.pre=i;if(i)i.next=e;if(!e.pre)this.head=e};vi.prototype.remove=function(t){var e=t.pre,i=t.next;if(e)e.next=i;if(i)i.pre=e;if(t===this.head)this.head=i;if(t===this.tail)this.tail=e;t.pre=null;t.next=null;this.length--};var Ti=pt.Timer=function(t){var e=this;e.game=t;e.paused=false;e.events=new pt.LinkList(0);e.loopEvents=new pt.LinkList(0);this._nextTimerBegin=0;this._nextLoopTimerBegin=0};Ti.prototype.constructor=Ti;Ti.prototype.create=function(t,e,i,r,a){t=Math.round(t);var n=new dt.TimerEvent(this,t,t,0,e,i,r,a);this._pushEvent(e?this.loopEvents:this.events,n);return n};Ti.prototype.add=function(t,e,i){var t=t>0?t:1;t+=this._nextTimerBegin;return this.create(t,false,e,i,Array.prototype.splice.call(arguments,3))};Ti.prototype.loop=function(t,e,i){var t=t>0?t:1;t+=this._nextLoopTimerBegin;return this.create(t,true,e,i,Array.prototype.splice.call(arguments,3))};Ti.prototype.remove=function(t){t.__delete=true};Ti.prototype.update=function(t){if(this.paused)return;this._now=this._now?this._now:t;var e=(t-this._now)/this.game.time.timeScale;this._now=t;var i=this.events.head;var r=e;var a=0;while(i){i.delta-=r;if(i.delta>0)break;a++;if(a>2e3){throw new Error("timer loop forever!");break}this._nextTimerBegin=r=-i.delta;this.events.remove(i);if(!i.__delete)i.callback.apply(i.callbackContext,i.args);i=this.events.head}this._nextTimerBegin=0;var n=[];i=this.loopEvents.head;r=e;while(i){i.delta-=r;if(i.delta>0)break;this._nextLoopTimerBegin=r=-i.delta;this.loopEvents.remove(i);if(!i.__delete){n.push(i);try{i.callback.apply(i.callbackContext,i.args)}catch(t){}}i=this.loopEvents.head}this._nextLoopTimerBegin=0;for(var s=0;s<n.length;s++){this._pushEvent(this.loopEvents,n[s])}};Ti.prototype._pushEvent=function(t,e){var i=t.head;if(!i){e.delta=e.delay;t.push(e);return}var r=e.delay;while(i){if(r>=i.delta){r-=i.delta;i=i.next;continue}i.delta-=r;e.delta=r;t.insertBefore(i,e);return e}e.delta=r;t.push(e);return e};pt.TimerEvent=dt.TimerEvent;var xi=pt.Filter=function(t){dt.Filter.call(this,t);this._textureCount=1;this.extraAttribute=[];this.customInspectors={}};xi.prototype=P.create(dt.Filter.prototype);xi.prototype.constructor=xi;P.defineProperties(xi.prototype,{textureCount:{get:function(){return this._textureCount}}});xi.prototype.registerCustomInspector=function(t,e){this.customInspectors[t]=e};xi.filters={};xi.F1="1f";xi.F1V="1fv";xi.I1="1i";xi.F2="2f";xi.F2V="2fv";xi.I2="2i";xi.I2V="2iv";xi.F3="3f";xi.F3V="3fv";xi.I3="3i";xi.I3V="3iv";xi.F4="4f";xi.F4V="4fv";xi.I4="4i";xi.I4V="4iv";xi.MAT2="mat2";xi.MAT3="mat3";xi.MAT4="mat4";xi.SAMPLER2D="sampler2D";xi.MAX_SAMPLE_COUNT=8;xi.mixinUniform=function(e,t){if(!t)return;for(var i in t){var r=t[i];var a=r===xi.SAMPLER2D;if(a&&e.textureCount>=xi.MAX_SAMPLE_COUNT){continue}var n=function(){var t=i;if(a){e._textureCount++;return function(){return e[t]&&e[t].filterTexture}}else{return function(){return e[t]}}};e.uniforms[i]=new Si(r,n());if(a){var s="a"+i.substring(0,1).toUpperCase()+i.substring(1)+"Coord";e.extraAttribute.push({name:s,texture:i})}}};xi.uniformToJson=function(t,e,i){switch(t){case xi.F1:case xi.I1:case xi.I2V:case xi.F2V:case xi.I3V:case xi.F3V:case xi.I4V:case xi.F4V:case xi.MAT2:case xi.MAT3:case xi.MAT4:return[t,e];case xi.I2:case xi.F2:return[t,[e.x,e.y]];case xi.I3:case xi.F3:return[t,[e.x,e.y,e.z]];case xi.I4:case xi.F4:return[t,[e.x,e.y,e.z,e.w]];case xi.SAMPLER2D:if(!(e instanceof Ai))return[t,[]];var r=e.texture;if(r){i.dependences.push({key:r.key,uuid:r.uuid});return[t,[r.key,r.url,r.uuid,e.frame]]}else{return[t,[]]}}return[t,[]]};xi.uniformFromJson=function(t,e,i,r,a){if(!a){return}switch(r){case xi.F1:case xi.I1:case xi.I2V:case xi.F2V:case xi.I3V:case xi.F3V:case xi.I4V:case xi.F4V:case xi.MAT2:case xi.MAT3:case xi.MAT4:e[i]=a;return;case xi.I2:case xi.F2:if(e[i]){e[i].x=a[0];e[i].y=a[1]}else{e[i]={x:a[0],y:a[1]}}return;case xi.I3:case xi.F3:if(e[i]){e[i].x=a[0];e[i].y=a[1];e[i].z=a[2]}else{e[i]={x:a[0],y:a[1],z:a[2]}}return;case xi.I4:case xi.F4:if(e[i]){e[i].x=a[0];e[i].y=a[1];e[i].z=a[2];e[i].w=a[3]}else{e[i]={x:a[0],y:a[1],z:a[2],w:a[3]}}return;case xi.SAMPLER2D:if(!a)return;var n=new Ai(t);if(a.length>0){var s=t.assets.find(a[0],a[1]);if(!s)s=t.assets.findByUUID(a[2]);if(!s){t.log.error("Texture({0}) not loaded, deserialize fail.",a[1]);return}if(!(s instanceof pt.Atlas))return;n.texture=s;n.frame=a[3]}e[i]=n;return}};N.prototype._saveFilter=function(t,e,i,r,a){if(a)e[r]=this._saveFilterItem(a,i)};N.prototype._restoreFilter=function(t,e,i,r){t[i]=this._restoreFilterItem(r)};N.prototype._saveFilterItem=function(t,e){var i=t.getExtraUniforms();var r={};for(var a in i){var n=i[a];r[a]=xi.uniformToJson(n,t[a],e)}return[N.FILTER,t.class,r]};N.prototype._restoreFilterItem=function(t){var e=pt.Util.findClass(t[1]);if(!e){console.warn("着色器脚本：{0}未找到，无法反序列化。",t[1]);return}var i=t[2];var r=new e(this.game);var a=r.getExtraUniforms();for(var n in a){var s=a[n];if(!i[n]||s!==i[n][0]){continue}xi.uniformFromJson(this.game,r,n,s,i[n][1])}return r};var bi=pt.defineFilter=function(i,r,a,e){var t=i.split(".");var n=D;for(var s=0;s<t.length-1;s++){if(!n[t[s]])n[t[s]]={};n=n[t[s]]}var o=t[t.length-1];r=r||pt.Filter;if(typeof e==="function")e=e.call(this);e=e||{};n[o]=function(t){r.call(this,t);this.class=i;this.super=r.prototype;var e=this.getExtraUniforms();xi.mixinUniform(this,e);if(typeof a==="function")a.call(this,t)};n[o].prototype=P.create(r.prototype);n[o].prototype.constructor=n[o];n[o].prototype.getExtraUniforms=function(){var t=r.prototype.getExtraUniforms?r.prototype.getExtraUniforms.call(this):{};return l(t,e)};n[o].prototype.clazz=i;xi.filters[i]=n[o];return n[o]};var Ai=pt.Filter.FilterTexture=function(t){this._image=new pt.UIImage(t,null,false);this._image.parent.removeChild(this._image)};Ai.prototype={};Ai.prototype.constructor=Ai;P.defineProperties(Ai.prototype,{texture:{get:function(){return this._image.texture},set:function(t){this._image.texture=t}},frame:{get:function(){return this._image.frame},set:function(t){this._image.frame=t}},filterTexture:{get:function(){return this._image.phaser.texture}}});var Si=pt.Filter.UniformHelp=function(t,e){this._type=t;this._value=e;this._valueIsFunc=typeof this._value==="function"};Si.prototype={};Si.prototype.constructor=Si;P.defineProperties(Si.prototype,{type:{get:function(){return this._type}},value:{get:function(){if(this._valueIsFunc){return this._value()}else{return this._value}}}});var wi=bi("qc.Filter.AlphaMask",pt.Filter,function(t){this.otherTexture=null;this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = add.a * original;","}"]},{otherTexture:pt.Filter.SAMPLER2D});var wi=bi("qc.Filter.BlendTexture",pt.Filter,function(t){this.mixing=.5;this.otherTexture=null;this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","uniform float mixing;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = mixing * add + (1.0 - mixing) * original;","}"]},{otherTexture:pt.Filter.SAMPLER2D,mixing:pt.Filter.F1});var Pi=bi("qc.Filter.BlurX",pt.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x - blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x + blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","gl_FragColor = sum;","}"];this.blur=1},{blur:pt.Filter.F1});P.defineProperty(Pi.prototype,"blur",{get:function(){return this._blur},set:function(t){this.dirty=true;this._blur=t;this.padding=Math.max(0,t)}});var Ei=bi("qc.Filter.BlurY",pt.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur*pixelSize.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur*pixelSize.y)) * 0.05;","gl_FragColor = sum;","}"];this.blur=1},{blur:pt.Filter.F1});P.defineProperty(Ei.prototype,"blur",{get:function(){return this._blur},set:function(t){this.dirty=true;this._blur=t;this.padding=Math.max(0,t)}});var Di=bi("qc.Filter.Glow",pt.Filter,function(t){this.distance=40;this.outerStrength=1.5;this.innerStrength=1;this.glowColor=[1,0,0];this.pixelWidth=1/t.phaser.renderer.width;this.pixelHeight=1/t.phaser.renderer.height;this._updateFragmentSrc();this.registerCustomInspector("glowColor",pt.Color)},{distance:pt.Filter.F1,outerStrength:pt.Filter.F1,innerStrength:pt.Filter.F1,glowColor:pt.Filter.F3V});P.defineProperty(Di.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance=t;this._updateFragmentSrc();this.shaders=[]}});Di.prototype._updateFragmentSrc=function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D texture;","uniform float distance;","uniform float outerStrength;","uniform float innerStrength;","uniform vec3 glowColor;","uniform float pixelWidth;","uniform float pixelHeight;","vec2 px = vec2("+this.pixelWidth+", "+this.pixelHeight+");","void main(void) {","    const float PI = 3.14159265358979323846264;","    vec4 ownColor = texture2D(texture, vTextureCoord);","    vec4 curColor;","    float totalAlpha = 0.;","    float maxTotalAlpha = 0.;","    float offset = 0.;","    for (float curDistance = 0.; curDistance <= "+this.distance.toFixed(7)+"; curDistance++) {","       offset = curDistance - distance / 2.;","       curColor = texture2D(texture, vec2(vTextureCoord.x + offset * px.x, vTextureCoord.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x, vTextureCoord.y + offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x + cos(PI * 0.25) * offset * px.x, vTextureCoord.y + sin(PI * 0.25) * offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x + cos(PI * 0.75) * offset * px.x, vTextureCoord.y + sin(PI * 0.75) * offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","    }","    maxTotalAlpha = max(maxTotalAlpha, 0.0001);","    ownColor.a = max(ownColor.a, 0.0001);","    ownColor.rgb = ownColor.rgb / ownColor.a;","    float outerGlowAlpha = (totalAlpha / maxTotalAlpha)  * outerStrength * (1. - ownColor.a);","    float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * innerStrength * ownColor.a;","    float resultAlpha = (ownColor.a + outerGlowAlpha);","    gl_FragColor = vec4(mix(mix(ownColor.rgb, glowColor, innerGlowAlpha / ownColor.a), glowColor.rgb, outerGlowAlpha / resultAlpha) * resultAlpha, resultAlpha);","}"]};var Ci=pt.Filter.GraphicsTexture=function(t,e,i,r,a){var n=this;n.game=t;n._texture=new pt.RenderTexture(e||100,i||100,r||n.game.phaser.render,null,a||n.game.resolution);n.offset=new pt.Point(0,0);n._graphics=n.game.phaser.add.graphics(0,0);if(n._graphics.parent){n._graphics.parent.remove(n._graphics)}};Ci.prototype={};Ci.prototype.constructor=Ci;P.defineProperties(Ci.prototype,{graphics:{get:function(){return this._graphics}},filterTexture:{get:function(){return this._texture}}});Ci.prototype.updateTexture=function(){var t=this,e=t._texture,i=t._graphics;if(i.dirty){e.directRenderWebGL(i,t.offset,true)}};Ci.prototype.resize=function(t,e){t=t<=1?1:t;e=e<=1?1:e;this._texture.resize(t,e,true)};var Oi=bi("qc.Filter.Gray",pt.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float gray = original.r * 0.3 + original.g * 0.59 + original.b * 0.11;","   gl_FragColor =  original;","   gl_FragColor.r = gray;","   gl_FragColor.g = gray;","   gl_FragColor.b = gray;","}"]},{});var Mi=bi("qc.Filter.Highlight",pt.Filter,function(t){this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float light;","uniform vec3 lightColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vLight = light * vec4(lightColor, 0.0);","}"];this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   gl_FragColor = original + original.a * vLight;","}"];this.light=.5;this.lightColor=[1,1,1];this.registerCustomInspector("lightColor",pt.Color)},{light:pt.Filter.F1,lightColor:pt.Filter.F3V});var Ii=bi("qc.Filter.KeepSource",pt.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec2 vMaskCoord;","varying vec4 vMaskLimit;","uniform sampler2D uSampler;","uniform sampler2D uSourceSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(uSourceSampler, vTextureCoord);","   gl_FragColor =  add.a * add + (1.0 - add.a) * original;","}"]},{})}).call(this,this,Object);var dragonBones;(function(o){var t=function(){function e(t){this._clock=new o.WorldClock;this._events=[];this._objects=[];this._eventManager=null;this._eventManager=t;console.info("DragonBones: "+e.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}e.prototype.advanceTime=function(t){if(this._objects.length>0){for(var e=0,i=this._objects;e<i.length;e++){var r=i[e];r.returnToPool()}this._objects.length=0}this._clock.advanceTime(t);if(this._events.length>0){for(var a=0;a<this._events.length;++a){var n=this._events[a];var s=n.armature;if(s._armatureData!==null){s.eventDispatcher.dispatchDBEvent(n.type,n);if(n.type===o.EventObject.SOUND_EVENT){this._eventManager.dispatchDBEvent(n.type,n)}}this.bufferObject(n)}this._events.length=0}};e.prototype.bufferEvent=function(t){if(this._events.indexOf(t)<0){this._events.push(t)}};e.prototype.bufferObject=function(t){if(this._objects.indexOf(t)<0){this._objects.push(t)}};Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:true,configurable:true});e.VERSION="5.7.000";e.yDown=true;e.debug=false;e.debugDraw=false;return e}();o.DragonBones=t})(dragonBones||(dragonBones={}));if(!console.warn){console.warn=function(){}}if(!console.assert){console.assert=function(){}}if(!Date.now){Date.now=function t(){return(new Date).getTime()}}var __extends=function(t,e){function i(){this.constructor=t}for(var r in e){if(e.hasOwnProperty(r)){t[r]=e[r]}}i.prototype=e.prototype,t.prototype=new i};if(typeof global==="undefined"&&typeof window!=="undefined"){var global=window}if(typeof exports==="object"&&typeof module==="object"){module.exports=dragonBones}else if(typeof define==="function"&&define["amd"]){define(["dragonBones"],function(){return dragonBones})}else if(typeof exports==="object"){exports=dragonBones}else if(typeof global!=="undefined"){global.dragonBones=dragonBones}var dragonBones;(function(t){var e=function(){function n(){this.hashCode=n._hashCode++;this._isInPool=false}n._returnObject=function(t){var e=String(t.constructor);var i=e in n._maxCountMap?n._maxCountMap[e]:n._defaultMaxCount;var r=n._poolsMap[e]=n._poolsMap[e]||[];if(r.length<i){if(!t._isInPool){t._isInPool=true;r.push(t)}else{console.warn("The object is already in the pool.")}}else{}};n.toString=function(){throw new Error};n.setMaxCount=function(t,e){if(e<0||e!==e){e=0}if(t!==null){var i=String(t);var r=i in n._poolsMap?n._poolsMap[i]:null;if(r!==null&&r.length>e){r.length=e}n._maxCountMap[i]=e}else{n._defaultMaxCount=e;for(var i in n._poolsMap){var r=n._poolsMap[i];if(r.length>e){r.length=e}if(i in n._maxCountMap){n._maxCountMap[i]=e}}}};n.clearPool=function(t){if(t===void 0){t=null}if(t!==null){var e=String(t);var i=e in n._poolsMap?n._poolsMap[e]:null;if(i!==null&&i.length>0){i.length=0}}else{for(var r in n._poolsMap){var i=n._poolsMap[r];i.length=0}}};n.borrowObject=function(t){var e=String(t);var i=e in n._poolsMap?n._poolsMap[e]:null;if(i!==null&&i.length>0){var r=i.pop();r._isInPool=false;return r}var a=new t;a._onClear();return a};n.prototype.returnToPool=function(){this._onClear();n._returnObject(this)};n._hashCode=0;n._defaultMaxCount=3e3;n._maxCountMap={};n._poolsMap={};return n}();t.BaseObject=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e,i,r,a,n){if(t===void 0){t=1}if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=1}if(a===void 0){a=0}if(n===void 0){n=0}this.a=t;this.b=e;this.c=i;this.d=r;this.tx=a;this.ty=n}t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty};t.prototype.copyFrom=function(t){this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d;this.tx=t.tx;this.ty=t.ty;return this};t.prototype.copyFromArray=function(t,e){if(e===void 0){e=0}this.a=t[e];this.b=t[e+1];this.c=t[e+2];this.d=t[e+3];this.tx=t[e+4];this.ty=t[e+5];return this};t.prototype.identity=function(){this.a=this.d=1;this.b=this.c=0;this.tx=this.ty=0;return this};t.prototype.concat=function(t){var e=this.a*t.a;var i=0;var r=0;var a=this.d*t.d;var n=this.tx*t.a+t.tx;var s=this.ty*t.d+t.ty;if(this.b!==0||this.c!==0){e+=this.b*t.c;i+=this.b*t.d;r+=this.c*t.a;a+=this.c*t.b}if(t.b!==0||t.c!==0){i+=this.a*t.b;r+=this.d*t.c;n+=this.ty*t.c;s+=this.tx*t.b}this.a=e;this.b=i;this.c=r;this.d=a;this.tx=n;this.ty=s;return this};t.prototype.invert=function(){var t=this.a;var e=this.b;var i=this.c;var r=this.d;var a=this.tx;var n=this.ty;if(e===0&&i===0){this.b=this.c=0;if(t===0||r===0){this.a=this.b=this.tx=this.ty=0}else{t=this.a=1/t;r=this.d=1/r;this.tx=-t*a;this.ty=-r*n}return this}var s=t*r-e*i;if(s===0){this.a=this.d=1;this.b=this.c=0;this.tx=this.ty=0;return this}s=1/s;var o=this.a=r*s;e=this.b=-e*s;i=this.c=-i*s;r=this.d=t*s;this.tx=-(o*a+i*n);this.ty=-(e*a+r*n);return this};t.prototype.transformPoint=function(t,e,i,r){if(r===void 0){r=false}i.x=this.a*t+this.c*e;i.y=this.b*t+this.d*e;if(!r){i.x+=this.tx;i.y+=this.ty}};t.prototype.transformRectangle=function(t,e){if(e===void 0){e=false}var i=this.a;var r=this.b;var a=this.c;var n=this.d;var s=e?0:this.tx;var o=e?0:this.ty;var h=t.x;var l=t.y;var u=h+t.width;var f=l+t.height;var c=i*h+a*l+s;var p=r*h+n*l+o;var d=i*u+a*l+s;var _=r*u+n*l+o;var g=i*u+a*f+s;var m=r*u+n*f+o;var y=i*h+a*f+s;var v=r*h+n*f+o;var T=0;if(c>d){T=c;c=d;d=T}if(g>y){T=g;g=y;y=T}t.x=Math.floor(c<g?c:g);t.width=Math.ceil((d>y?d:y)-t.x);if(p>_){T=p;p=_;_=T}if(m>v){T=m;m=v;v=T}t.y=Math.floor(p<m?p:m);t.height=Math.ceil((_>v?_:v)-t.y)};return t}();t.Matrix=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function n(t,e,i,r,a,n){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}if(a===void 0){a=1}if(n===void 0){n=1}this.x=t;this.y=e;this.skew=i;this.rotation=r;this.scaleX=a;this.scaleY=n}n.normalizeRadian=function(t){t=(t+Math.PI)%(Math.PI*2);t+=t>0?-Math.PI:Math.PI;return t};n.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+this.skew*180/Math.PI+" skewY:"+this.rotation*180/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY};n.prototype.copyFrom=function(t){this.x=t.x;this.y=t.y;this.skew=t.skew;this.rotation=t.rotation;this.scaleX=t.scaleX;this.scaleY=t.scaleY;return this};n.prototype.identity=function(){this.x=this.y=0;this.skew=this.rotation=0;this.scaleX=this.scaleY=1;return this};n.prototype.add=function(t){this.x+=t.x;this.y+=t.y;this.skew+=t.skew;this.rotation+=t.rotation;this.scaleX*=t.scaleX;this.scaleY*=t.scaleY;return this};n.prototype.minus=function(t){this.x-=t.x;this.y-=t.y;this.skew-=t.skew;this.rotation-=t.rotation;this.scaleX/=t.scaleX;this.scaleY/=t.scaleY;return this};n.prototype.fromMatrix=function(t){var e=this.scaleX,i=this.scaleY;var r=n.PI_Q;this.x=t.tx;this.y=t.ty;this.rotation=Math.atan(t.b/t.a);var a=Math.atan(-t.c/t.d);this.scaleX=this.rotation>-r&&this.rotation<r?t.a/Math.cos(this.rotation):t.b/Math.sin(this.rotation);this.scaleY=a>-r&&a<r?t.d/Math.cos(a):-t.c/Math.sin(a);if(e>=0&&this.scaleX<0){this.scaleX=-this.scaleX;this.rotation=this.rotation-Math.PI}if(i>=0&&this.scaleY<0){this.scaleY=-this.scaleY;a=a-Math.PI}this.skew=a-this.rotation;return this};n.prototype.toMatrix=function(t){if(this.rotation===0){t.a=1;t.b=0}else{t.a=Math.cos(this.rotation);t.b=Math.sin(this.rotation)}if(this.skew===0){t.c=-t.b;t.d=t.a}else{t.c=-Math.sin(this.skew+this.rotation);t.d=Math.cos(this.skew+this.rotation)}if(this.scaleX!==1){t.a*=this.scaleX;t.b*=this.scaleX}if(this.scaleY!==1){t.c*=this.scaleY;t.d*=this.scaleY}t.tx=this.x;t.ty=this.y;return this};n.PI=Math.PI;n.PI_D=Math.PI*2;n.PI_H=Math.PI/2;n.PI_Q=Math.PI/4;n.RAD_DEG=180/Math.PI;n.DEG_RAD=Math.PI/180;return n}();t.Transform=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e,i,r,a,n,s,o){if(t===void 0){t=1}if(e===void 0){e=1}if(i===void 0){i=1}if(r===void 0){r=1}if(a===void 0){a=0}if(n===void 0){n=0}if(s===void 0){s=0}if(o===void 0){o=0}this.alphaMultiplier=t;this.redMultiplier=e;this.greenMultiplier=i;this.blueMultiplier=r;this.alphaOffset=a;this.redOffset=n;this.greenOffset=s;this.blueOffset=o}t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier;this.redMultiplier=t.redMultiplier;this.greenMultiplier=t.greenMultiplier;this.blueMultiplier=t.blueMultiplier;this.alphaOffset=t.alphaOffset;this.redOffset=t.redOffset;this.greenOffset=t.greenOffset;this.blueOffset=t.blueOffset};t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1;this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0};return t}();t.ColorTransform=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e){if(t===void 0){t=0}if(e===void 0){e=0}this.x=t;this.y=e}t.prototype.copyFrom=function(t){this.x=t.x;this.y=t.y};t.prototype.clear=function(){this.x=this.y=0};return t}();t.Point=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t,e,i,r){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=0}if(r===void 0){r=0}this.x=t;this.y=e;this.width=i;this.height=r}t.prototype.copyFrom=function(t){this.x=t.x;this.y=t.y;this.width=t.width;this.height=t.height};t.prototype.clear=function(){this.x=this.y=0;this.width=this.height=0};return t}();t.Rectangle=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.ints=[];t.floats=[];t.strings=[];return t}t.toString=function(){return"[class dragonBones.UserData]"};t.prototype._onClear=function(){this.ints.length=0;this.floats.length=0;this.strings.length=0};t.prototype.addInt=function(t){this.ints.push(t)};t.prototype.addFloat=function(t){this.floats.push(t)};t.prototype.addString=function(t){this.strings.push(t)};t.prototype.getInt=function(t){if(t===void 0){t=0}return t>=0&&t<this.ints.length?this.ints[t]:0};t.prototype.getFloat=function(t){if(t===void 0){t=0}return t>=0&&t<this.floats.length?this.floats[t]:0};t.prototype.getString=function(t){if(t===void 0){t=0}return t>=0&&t<this.strings.length?this.strings[t]:""};return t}(t.BaseObject);t.UserData=e;var i=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.data=null;return t}t.toString=function(){return"[class dragonBones.ActionData]"};t.prototype._onClear=function(){if(this.data!==null){this.data.returnToPool()}this.type=0;this.name="";this.bone=null;this.slot=null;this.data=null};return t}(t.BaseObject);t.ActionData=i})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.frameIndices=[];t.cachedFrames=[];t.armatureNames=[];t.armatures={};t.userData=null;return t}t.toString=function(){return"[class dragonBones.DragonBonesData]"};t.prototype._onClear=function(){for(var t in this.armatures){this.armatures[t].returnToPool();delete this.armatures[t]}if(this.userData!==null){this.userData.returnToPool()}this.autoSearch=false;this.frameRate=0;this.version="";this.name="";this.stage=null;this.frameIndices.length=0;this.cachedFrames.length=0;this.armatureNames.length=0;this.binary=null;this.intArray=null;this.floatArray=null;this.frameIntArray=null;this.frameFloatArray=null;this.frameArray=null;this.timelineArray=null;this.colorArray=null;this.userData=null};t.prototype.addArmature=function(t){if(t.name in this.armatures){console.warn("Same armature: "+t.name);return}t.parent=this;this.armatures[t.name]=t;this.armatureNames.push(t.name)};t.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null};return t}(t.BaseObject);t.DragonBonesData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.aabb=new i.Rectangle;t.animationNameList=[];t.sortedBones=[];t.sortedSlots=[];t.defaultActions=[];t.actions=[];t.bones={};t.slots={};t.constraints={};t.skins={};t.animations={};t.canvas=null;t.userData=null;return t}t.toString=function(){return"[class dragonBones.ArmatureData]"};t.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++){var i=e[t];i.returnToPool()}for(var r=0,a=this.actions;r<a.length;r++){var i=a[r];i.returnToPool()}for(var n in this.bones){this.bones[n].returnToPool();delete this.bones[n]}for(var n in this.slots){this.slots[n].returnToPool();delete this.slots[n]}for(var n in this.constraints){this.constraints[n].returnToPool();delete this.constraints[n]}for(var n in this.skins){this.skins[n].returnToPool();delete this.skins[n]}for(var n in this.animations){this.animations[n].returnToPool();delete this.animations[n]}if(this.canvas!==null){this.canvas.returnToPool()}if(this.userData!==null){this.userData.returnToPool()}this.type=0;this.frameRate=0;this.cacheFrameRate=0;this.scale=1;this.name="";this.aabb.clear();this.animationNameList.length=0;this.sortedBones.length=0;this.sortedSlots.length=0;this.defaultActions.length=0;this.actions.length=0;this.defaultSkin=null;this.defaultAnimation=null;this.canvas=null;this.userData=null;this.parent=null};t.prototype.sortBones=function(){var t=this.sortedBones.length;if(t<=0){return}var e=this.sortedBones.concat();var i=0;var r=0;this.sortedBones.length=0;while(r<t){var a=e[i++];if(i>=t){i=0}if(this.sortedBones.indexOf(a)>=0){continue}var n=false;for(var s in this.constraints){var o=this.constraints[s];if(o.root===a&&this.sortedBones.indexOf(o.target)<0){n=true;break}}if(n){continue}if(a.parent!==null&&this.sortedBones.indexOf(a.parent)<0){continue}this.sortedBones.push(a);r++}};t.prototype.cacheFrames=function(t){if(this.cacheFrameRate>0){return}this.cacheFrameRate=t;for(var e in this.animations){this.animations[e].cacheFrames(this.cacheFrameRate)}};t.prototype.setCacheFrame=function(t,e){var i=this.parent.cachedFrames;var r=i.length;i.length+=10;i[r]=t.a;i[r+1]=t.b;i[r+2]=t.c;i[r+3]=t.d;i[r+4]=t.tx;i[r+5]=t.ty;i[r+6]=e.rotation;i[r+7]=e.skew;i[r+8]=e.scaleX;i[r+9]=e.scaleY;return r};t.prototype.getCacheFrame=function(t,e,i){var r=this.parent.cachedFrames;t.a=r[i];t.b=r[i+1];t.c=r[i+2];t.d=r[i+3];t.tx=r[i+4];t.ty=r[i+5];e.rotation=r[i+6];e.skew=r[i+7];e.scaleX=r[i+8];e.scaleY=r[i+9];e.x=t.tx;e.y=t.ty};t.prototype.addBone=function(t){if(t.name in this.bones){console.warn("Same bone: "+t.name);return}this.bones[t.name]=t;this.sortedBones.push(t)};t.prototype.addSlot=function(t){if(t.name in this.slots){console.warn("Same slot: "+t.name);return}this.slots[t.name]=t;this.sortedSlots.push(t)};t.prototype.addConstraint=function(t){if(t.name in this.constraints){console.warn("Same constraint: "+t.name);return}this.constraints[t.name]=t};t.prototype.addSkin=function(t){if(t.name in this.skins){console.warn("Same skin: "+t.name);return}t.parent=this;this.skins[t.name]=t;if(this.defaultSkin===null){this.defaultSkin=t}if(t.name==="default"){this.defaultSkin=t}};t.prototype.addAnimation=function(t){if(t.name in this.animations){console.warn("Same animation: "+t.name);return}t.parent=this;this.animations[t.name]=t;this.animationNameList.push(t.name);if(this.defaultAnimation===null){this.defaultAnimation=t}};t.prototype.addAction=function(t,e){if(e){this.defaultActions.push(t)}else{this.actions.push(t)}};t.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null};t.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null};t.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null};t.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null};t.prototype.getMesh=function(t,e,i){var r=this.getSkin(t);if(r===null){return null}return r.getDisplay(e,i)};t.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null};return t}(i.BaseObject);i.ArmatureData=t;var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.transform=new i.Transform;t.userData=null;return t}t.toString=function(){return"[class dragonBones.BoneData]"};t.prototype._onClear=function(){if(this.userData!==null){this.userData.returnToPool()}this.inheritTranslation=false;this.inheritRotation=false;this.inheritScale=false;this.inheritReflection=false;this.type=0;this.length=0;this.alpha=1;this.name="";this.transform.identity();this.userData=null;this.parent=null};return t}(i.BaseObject);i.BoneData=e;var r=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.geometry=new i.GeometryData;return t}t.toString=function(){return"[class dragonBones.SurfaceData]"};t.prototype._onClear=function(){e.prototype._onClear.call(this);this.type=1;this.segmentX=0;this.segmentY=0;this.geometry.clear()};return t}(e);i.SurfaceData=r;var a=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.color=null;t.userData=null;return t}t.createColor=function(){return new i.ColorTransform};t.toString=function(){return"[class dragonBones.SlotData]"};t.prototype._onClear=function(){if(this.userData!==null){this.userData.returnToPool()}this.blendMode=0;this.displayIndex=0;this.zOrder=0;this.zIndex=0;this.alpha=1;this.name="";this.color=null;this.userData=null;this.parent=null};t.DEFAULT_COLOR=new i.ColorTransform;return t}(i.BaseObject);i.SlotData=a})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.toString=function(){return"[class dragonBones.CanvasData]"};e.prototype._onClear=function(){this.hasBackground=false;this.color=0;this.x=0;this.y=0;this.width=0;this.height=0};return e}(t.BaseObject);t.CanvasData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.displays={};return t}t.toString=function(){return"[class dragonBones.SkinData]"};t.prototype._onClear=function(){for(var t in this.displays){var e=this.displays[t];for(var i=0,r=e;i<r.length;i++){var a=r[i];if(a!==null){a.returnToPool()}}delete this.displays[t]}this.name="";this.parent=null};t.prototype.addDisplay=function(t,e){if(!(t in this.displays)){this.displays[t]=[]}if(e!==null){e.parent=this}var i=this.displays[t];i.push(e)};t.prototype.getDisplay=function(t,e){var i=this.getDisplays(t);if(i!==null){for(var r=0,a=i;r<a.length;r++){var n=a[r];if(n!==null&&n.name===e){return n}}}return null};t.prototype.getDisplays=function(t){if(!(t in this.displays)){return null}return this.displays[t]};return t}(t.BaseObject);t.SkinData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype._onClear=function(){this.order=0;this.name="";this.type=0;this.target=null;this.root=null;this.bone=null};return e}(t.BaseObject);t.ConstraintData=e;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.toString=function(){return"[class dragonBones.IKConstraintData]"};e.prototype._onClear=function(){t.prototype._onClear.call(this);this.scaleEnabled=false;this.bendPositive=false;this.weight=1};return e}(e);t.IKConstraintData=i;var r=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.bones=[];return t}t.toString=function(){return"[class dragonBones.PathConstraintData]"};t.prototype._onClear=function(){e.prototype._onClear.call(this);this.pathSlot=null;this.pathDisplayData=null;this.bones.length=0;this.positionMode=0;this.spacingMode=1;this.rotateMode=1;this.position=0;this.spacing=0;this.rotateOffset=0;this.rotateMix=0;this.translateMix=0};t.prototype.AddBone=function(t){this.bones.push(t)};return t}(e);t.PathConstraintData=r})(dragonBones||(dragonBones={}));var dragonBones;(function(i){var r=function(){function t(){this.weight=null}t.prototype.clear=function(){if(!this.isShared&&this.weight!==null){this.weight.returnToPool()}this.isShared=false;this.inheritDeform=false;this.offset=0;this.data=null;this.weight=null};t.prototype.shareFrom=function(t){this.isShared=true;this.offset=t.offset;this.weight=t.weight};Object.defineProperty(t.prototype,"vertexCount",{get:function(){var t=this.data.intArray;return t[this.offset+0]},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"triangleCount",{get:function(){var t=this.data.intArray;return t[this.offset+1]},enumerable:true,configurable:true});return t}();i.GeometryData=r;var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.transform=new i.Transform;return t}t.prototype._onClear=function(){this.name="";this.path="";this.transform.identity();this.parent=null};return t}(i.BaseObject);i.DisplayData=t;var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.pivot=new i.Point;return t}t.toString=function(){return"[class dragonBones.ImageDisplayData]"};t.prototype._onClear=function(){e.prototype._onClear.call(this);this.type=0;this.pivot.clear();this.texture=null};return t}(t);i.ImageDisplayData=e;var a=function(r){__extends(t,r);function t(){var t=r!==null&&r.apply(this,arguments)||this;t.actions=[];return t}t.toString=function(){return"[class dragonBones.ArmatureDisplayData]"};t.prototype._onClear=function(){r.prototype._onClear.call(this);for(var t=0,e=this.actions;t<e.length;t++){var i=e[t];i.returnToPool()}this.type=1;this.inheritAnimation=false;this.actions.length=0;this.armature=null};t.prototype.addAction=function(t){this.actions.push(t)};return t}(t);i.ArmatureDisplayData=a;var n=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.geometry=new r;return t}t.toString=function(){return"[class dragonBones.MeshDisplayData]"};t.prototype._onClear=function(){e.prototype._onClear.call(this);this.type=2;this.geometry.clear();this.texture=null};return t}(t);i.MeshDisplayData=n;var s=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.boundingBox=null;return t}t.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"};t.prototype._onClear=function(){e.prototype._onClear.call(this);if(this.boundingBox!==null){this.boundingBox.returnToPool()}this.type=3;this.boundingBox=null};return t}(t);i.BoundingBoxDisplayData=s;var o=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.geometry=new r;t.curveLengths=[];return t}t.toString=function(){return"[class dragonBones.PathDisplayData]"};t.prototype._onClear=function(){e.prototype._onClear.call(this);this.type=4;this.closed=false;this.constantSpeed=false;this.geometry.clear();this.curveLengths.length=0};return t}(t);i.PathDisplayData=o;var h=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.bones=[];return t}t.toString=function(){return"[class dragonBones.WeightData]"};t.prototype._onClear=function(){this.count=0;this.offset=0;this.bones.length=0};t.prototype.addBone=function(t){this.bones.push(t)};return t}(i.BaseObject);i.WeightData=h})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype._onClear=function(){this.color=0;this.width=0;this.height=0};return e}(t.BaseObject);t.BoundingBoxData=e;var l=function(t){__extends(T,t);function T(){return t!==null&&t.apply(this,arguments)||this}T.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"};T._computeOutCode=function(t,e,i,r,a,n){var s=0;if(t<i){s|=1}else if(t>a){s|=2}if(e<r){s|=4}else if(e>n){s|=8}return s};T.rectangleIntersectsSegment=function(t,e,i,r,a,n,s,o,h,l,u){if(h===void 0){h=null}if(l===void 0){l=null}if(u===void 0){u=null}var f=t>a&&t<s&&e>n&&e<o;var c=i>a&&i<s&&r>n&&r<o;if(f&&c){return-1}var p=0;var d=T._computeOutCode(t,e,a,n,s,o);var _=T._computeOutCode(i,r,a,n,s,o);while(true){if((d|_)===0){p=2;break}else if((d&_)!==0){break}var g=0;var m=0;var y=0;var v=d!==0?d:_;if((v&4)!==0){g=t+(i-t)*(n-e)/(r-e);m=n;if(u!==null){y=-Math.PI*.5}}else if((v&8)!==0){g=t+(i-t)*(o-e)/(r-e);m=o;if(u!==null){y=Math.PI*.5}}else if((v&2)!==0){m=e+(r-e)*(s-t)/(i-t);g=s;if(u!==null){y=0}}else if((v&1)!==0){m=e+(r-e)*(a-t)/(i-t);g=a;if(u!==null){y=Math.PI}}if(v===d){t=g;e=m;d=T._computeOutCode(t,e,a,n,s,o);if(u!==null){u.x=y}}else{i=g;r=m;_=T._computeOutCode(i,r,a,n,s,o);if(u!==null){u.y=y}}}if(p){if(f){p=2;if(h!==null){h.x=i;h.y=r}if(l!==null){l.x=i;l.y=i}if(u!==null){u.x=u.y+Math.PI}}else if(c){p=1;if(h!==null){h.x=t;h.y=e}if(l!==null){l.x=t;l.y=e}if(u!==null){u.y=u.x+Math.PI}}else{p=3;if(h!==null){h.x=t;h.y=e}if(l!==null){l.x=i;l.y=r}}}return p};T.prototype._onClear=function(){t.prototype._onClear.call(this);this.type=0};T.prototype.containsPoint=function(t,e){var i=this.width*.5;if(t>=-i&&t<=i){var r=this.height*.5;if(e>=-r&&e<=r){return true}}return false};T.prototype.intersectsSegment=function(t,e,i,r,a,n,s){if(a===void 0){a=null}if(n===void 0){n=null}if(s===void 0){s=null}var o=this.width*.5;var h=this.height*.5;var l=T.rectangleIntersectsSegment(t,e,i,r,-o,-h,o,h,a,n,s);return l};return T}(e);t.RectangleBoundingBoxData=l;var i=function(t){__extends(h,t);function h(){return t!==null&&t.apply(this,arguments)||this}h.toString=function(){return"[class dragonBones.EllipseData]"};h.ellipseIntersectsSegment=function(t,e,i,r,a,n,s,o,h,l,u){if(h===void 0){h=null}if(l===void 0){l=null}if(u===void 0){u=null}var f=s/o;var c=f*f;e*=f;r*=f;var p=i-t;var d=r-e;var _=Math.sqrt(p*p+d*d);var g=p/_;var m=d/_;var y=(a-t)*g+(n-e)*m;var v=y*y;var T=t*t+e*e;var x=s*s;var b=x-T+v;var A=0;if(b>=0){var S=Math.sqrt(b);var w=y-S;var P=y+S;var E=w<0?-1:w<=_?0:1;var D=P<0?-1:P<=_?0:1;var C=E*D;if(C<0){return-1}else if(C===0){if(E===-1){A=2;i=t+P*g;r=(e+P*m)/f;if(h!==null){h.x=i;h.y=r}if(l!==null){l.x=i;l.y=r}if(u!==null){u.x=Math.atan2(r/x*c,i/x);u.y=u.x+Math.PI}}else if(D===1){A=1;t=t+w*g;e=(e+w*m)/f;if(h!==null){h.x=t;h.y=e}if(l!==null){l.x=t;l.y=e}if(u!==null){u.x=Math.atan2(e/x*c,t/x);u.y=u.x+Math.PI}}else{A=3;if(h!==null){h.x=t+w*g;h.y=(e+w*m)/f;if(u!==null){u.x=Math.atan2(h.y/x*c,h.x/x)}}if(l!==null){l.x=t+P*g;l.y=(e+P*m)/f;if(u!==null){u.y=Math.atan2(l.y/x*c,l.x/x)}}}}}return A};h.prototype._onClear=function(){t.prototype._onClear.call(this);this.type=1};h.prototype.containsPoint=function(t,e){var i=this.width*.5;if(t>=-i&&t<=i){var r=this.height*.5;if(e>=-r&&e<=r){e*=i/r;return Math.sqrt(t*t+e*e)<=i}}return false};h.prototype.intersectsSegment=function(t,e,i,r,a,n,s){if(a===void 0){a=null}if(n===void 0){n=null}if(s===void 0){s=null}var o=h.ellipseIntersectsSegment(t,e,i,r,0,0,this.width*.5,this.height*.5,a,n,s);return o};return h}(e);t.EllipseBoundingBoxData=i;var r=function(e){__extends(h,e);function h(){var t=e!==null&&e.apply(this,arguments)||this;t.vertices=[];return t}h.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"};h.polygonIntersectsSegment=function(t,e,i,r,a,n,s,o){if(n===void 0){n=null}if(s===void 0){s=null}if(o===void 0){o=null}if(t===i){t=i+1e-6}if(e===r){e=r+1e-6}var h=a.length;var l=t-i;var u=e-r;var f=t*r-e*i;var c=0;var p=a[h-2];var d=a[h-1];var _=0;var g=0;var m=0;var y=0;var v=0;var T=0;for(var x=0;x<h;x+=2){var b=a[x];var A=a[x+1];if(p===b){p=b+1e-4}if(d===A){d=A+1e-4}var S=p-b;var w=d-A;var P=p*A-d*b;var E=l*w-u*S;var D=(f*S-l*P)/E;if((D>=p&&D<=b||D>=b&&D<=p)&&(l===0||D>=t&&D<=i||D>=i&&D<=t)){var C=(f*w-u*P)/E;if((C>=d&&C<=A||C>=A&&C<=d)&&(u===0||C>=e&&C<=r||C>=r&&C<=e)){if(s!==null){var O=D-t;if(O<0){O=-O}if(c===0){_=O;g=O;m=D;y=C;v=D;T=C;if(o!==null){o.x=Math.atan2(A-d,b-p)-Math.PI*.5;o.y=o.x}}else{if(O<_){_=O;m=D;y=C;if(o!==null){o.x=Math.atan2(A-d,b-p)-Math.PI*.5}}if(O>g){g=O;v=D;T=C;if(o!==null){o.y=Math.atan2(A-d,b-p)-Math.PI*.5}}}c++}else{m=D;y=C;v=D;T=C;c++;if(o!==null){o.x=Math.atan2(A-d,b-p)-Math.PI*.5;o.y=o.x}break}}}p=b;d=A}if(c===1){if(n!==null){n.x=m;n.y=y}if(s!==null){s.x=m;s.y=y}if(o!==null){o.y=o.x+Math.PI}}else if(c>1){c++;if(n!==null){n.x=m;n.y=y}if(s!==null){s.x=v;s.y=T}}return c};h.prototype._onClear=function(){e.prototype._onClear.call(this);this.type=2;this.x=0;this.y=0;this.vertices.length=0};h.prototype.containsPoint=function(t,e){var i=false;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height){for(var r=0,a=this.vertices.length,n=a-2;r<a;r+=2){var s=this.vertices[n+1];var o=this.vertices[r+1];if(o<e&&s>=e||s<e&&o>=e){var h=this.vertices[n];var l=this.vertices[r];if((e-o)*(h-l)/(s-o)+l<t){i=!i}}n=r}}return i};h.prototype.intersectsSegment=function(t,e,i,r,a,n,s){if(a===void 0){a=null}if(n===void 0){n=null}if(s===void 0){s=null}var o=0;if(l.rectangleIntersectsSegment(t,e,i,r,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)!==0){o=h.polygonIntersectsSegment(t,e,i,r,this.vertices,a,n,s)}return o};return h}(e);t.PolygonBoundingBoxData=r})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.cachedFrames=[];t.boneTimelines={};t.slotTimelines={};t.constraintTimelines={};t.animationTimelines={};t.boneCachedFrameIndices={};t.slotCachedFrameIndices={};t.actionTimeline=null;t.zOrderTimeline=null;return t}t.toString=function(){return"[class dragonBones.AnimationData]"};t.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,i=this.boneTimelines[t];e<i.length;e++){var r=i[e];r.returnToPool()}delete this.boneTimelines[t]}for(var t in this.slotTimelines){for(var a=0,n=this.slotTimelines[t];a<n.length;a++){var r=n[a];r.returnToPool()}delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var s=0,o=this.constraintTimelines[t];s<o.length;s++){var r=o[s];r.returnToPool()}delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var h=0,l=this.animationTimelines[t];h<l.length;h++){var r=l[h];r.returnToPool()}delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices){delete this.boneCachedFrameIndices[t]}for(var t in this.slotCachedFrameIndices){delete this.slotCachedFrameIndices[t]}if(this.actionTimeline!==null){this.actionTimeline.returnToPool()}if(this.zOrderTimeline!==null){this.zOrderTimeline.returnToPool()}this.frameIntOffset=0;this.frameFloatOffset=0;this.frameOffset=0;this.blendType=0;this.frameCount=0;this.playTimes=0;this.duration=0;this.scale=1;this.fadeInTime=0;this.cacheFrameRate=0;this.name="";this.cachedFrames.length=0;this.actionTimeline=null;this.zOrderTimeline=null;this.parent=null};t.prototype.cacheFrames=function(t){if(this.cacheFrameRate>0){return}this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,r=this.cacheFrames.length;i<r;++i){this.cachedFrames[i]=false}for(var a=0,n=this.parent.sortedBones;a<n.length;a++){var s=n[a];var o=new Array(e);for(var i=0,r=o.length;i<r;++i){o[i]=-1}this.boneCachedFrameIndices[s.name]=o}for(var h=0,l=this.parent.sortedSlots;h<l.length;h++){var u=l[h];var o=new Array(e);for(var i=0,r=o.length;i<r;++i){o[i]=-1}this.slotCachedFrameIndices[u.name]=o}};t.prototype.addBoneTimeline=function(t,e){var i=t in this.boneTimelines?this.boneTimelines[t]:this.boneTimelines[t]=[];if(i.indexOf(e)<0){i.push(e)}};t.prototype.addSlotTimeline=function(t,e){var i=t in this.slotTimelines?this.slotTimelines[t]:this.slotTimelines[t]=[];if(i.indexOf(e)<0){i.push(e)}};t.prototype.addConstraintTimeline=function(t,e){var i=t in this.constraintTimelines?this.constraintTimelines[t]:this.constraintTimelines[t]=[];if(i.indexOf(e)<0){i.push(e)}};t.prototype.addAnimationTimeline=function(t,e){var i=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];if(i.indexOf(e)<0){i.push(e)}};t.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null};t.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null};t.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null};t.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null};t.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null};t.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null};return t}(t.BaseObject);t.AnimationData=e;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.toString=function(){return"[class dragonBones.TimelineData]"};e.prototype._onClear=function(){this.type=10;this.offset=0;this.frameIndicesOffset=-1};return e}(t.BaseObject);t.TimelineData=i;var r=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.toString=function(){return"[class dragonBones.AnimationTimelineData]"};e.prototype._onClear=function(){t.prototype._onClear.call(this);this.x=0;this.y=0};return e}(i);t.AnimationTimelineData=r})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.boneMask=[];return t}t.toString=function(){return"[class dragonBones.AnimationConfig]"};t.prototype._onClear=function(){this.pauseFadeOut=true;this.fadeOutMode=4;this.fadeOutTweenType=1;this.fadeOutTime=-1;this.actionEnabled=true;this.additive=false;this.displayControl=true;this.pauseFadeIn=true;this.resetToPose=true;this.fadeInTweenType=1;this.playTimes=-1;this.layer=0;this.position=0;this.duration=-1;this.timeScale=-100;this.weight=1;this.fadeInTime=-1;this.autoFadeOutTime=-1;this.name="";this.animation="";this.group="";this.boneMask.length=0};t.prototype.clear=function(){this._onClear()};t.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut;this.fadeOutMode=t.fadeOutMode;this.autoFadeOutTime=t.autoFadeOutTime;this.fadeOutTweenType=t.fadeOutTweenType;this.actionEnabled=t.actionEnabled;this.additive=t.additive;this.displayControl=t.displayControl;this.pauseFadeIn=t.pauseFadeIn;this.resetToPose=t.resetToPose;this.playTimes=t.playTimes;this.layer=t.layer;this.position=t.position;this.duration=t.duration;this.timeScale=t.timeScale;this.fadeInTime=t.fadeInTime;this.fadeOutTime=t.fadeOutTime;this.fadeInTweenType=t.fadeInTweenType;this.weight=t.weight;this.name=t.name;this.animation=t.animation;this.group=t.group;this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;e<i;++e){this.boneMask[e]=t.boneMask[e]}};return t}(t.BaseObject);t.AnimationConfig=e})(dragonBones||(dragonBones={}));var dragonBones;(function(r){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.textures={};return t}t.prototype._onClear=function(){for(var t in this.textures){this.textures[t].returnToPool();delete this.textures[t]}this.autoSearch=false;this.width=0;this.height=0;this.scale=1;this.name="";this.imagePath=""};t.prototype.copyFrom=function(t){this.autoSearch=t.autoSearch;this.scale=t.scale;this.width=t.width;this.height=t.height;this.name=t.name;this.imagePath=t.imagePath;for(var e in this.textures){this.textures[e].returnToPool();delete this.textures[e]}for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]);this.textures[e]=i}};t.prototype.addTexture=function(t){if(t.name in this.textures){console.warn("Same texture: "+t.name);return}t.parent=this;this.textures[t.name]=t};t.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null};return t}(r.BaseObject);r.TextureAtlasData=t;var e=function(e){__extends(i,e);function i(){var t=e!==null&&e.apply(this,arguments)||this;t.region=new r.Rectangle;t.frame=null;return t}i.createRectangle=function(){return new r.Rectangle};i.prototype._onClear=function(){this.rotated=false;this.name="";this.region.clear();this.parent=null;this.frame=null};i.prototype.copyFrom=function(t){this.rotated=t.rotated;this.name=t.name;this.region.copyFrom(t.region);this.parent=t.parent;if(this.frame===null&&t.frame!==null){this.frame=i.createRectangle()}else if(this.frame!==null&&t.frame===null){this.frame=null}if(this.frame!==null&&t.frame!==null){this.frame.copyFrom(t.frame)}};return i}(r.BaseObject);r.TextureData=e})(dragonBones||(dragonBones={}));var dragonBones;(function(a){var t=function(e){__extends(m,e);function m(){var t=e!==null&&e.apply(this,arguments)||this;t._bones=[];t._slots=[];t._constraints=[];t._actions=[];t._animation=null;t._proxy=null;t._replaceTextureAtlasData=null;t._clock=null;return t}m.toString=function(){return"[class dragonBones.Armature]"};m._onSortSlots=function(t,e){return t._zIndex*1e3+t._zOrder>e._zIndex*1e3+e._zOrder?1:-1};m.prototype._onClear=function(){if(this._clock!==null){this._clock.remove(this)}for(var t=0,e=this._bones;t<e.length;t++){var i=e[t];i.returnToPool()}for(var r=0,a=this._slots;r<a.length;r++){var n=a[r];n.returnToPool()}for(var s=0,o=this._constraints;s<o.length;s++){var h=o[s];h.returnToPool()}for(var l=0,u=this._actions;l<u.length;l++){var f=u[l];f.returnToPool()}if(this._animation!==null){this._animation.returnToPool()}if(this._proxy!==null){this._proxy.dbClear()}if(this._replaceTextureAtlasData!==null){this._replaceTextureAtlasData.returnToPool()}this.inheritAnimation=true;this.userData=null;this._lockUpdate=false;this._slotsDirty=true;this._zOrderDirty=false;this._zIndexDirty=false;this._alphaDirty=true;this._flipX=false;this._flipY=false;this._cacheFrameIndex=-1;this._alpha=1;this._globalAlpha=1;this._bones.length=0;this._slots.length=0;this._constraints.length=0;this._actions.length=0;this._armatureData=null;this._animation=null;this._proxy=null;this._display=null;this._replaceTextureAtlasData=null;this._replacedTexture=null;this._dragonBones=null;this._clock=null;this._parent=null};m.prototype._sortZOrder=function(t,e){var i=this._armatureData.sortedSlots;var r=t===null;if(this._zOrderDirty||!r){for(var a=0,n=i.length;a<n;++a){var s=r?a:t[e+a];if(s<0||s>=n){continue}var o=i[s];var h=this.getSlot(o.name);if(h!==null){h._setZOrder(a)}}this._slotsDirty=true;this._zOrderDirty=!r}};m.prototype._addBone=function(t){if(this._bones.indexOf(t)<0){this._bones.push(t)}};m.prototype._addSlot=function(t){if(this._slots.indexOf(t)<0){this._slots.push(t)}};m.prototype._addConstraint=function(t){if(this._constraints.indexOf(t)<0){this._constraints.push(t)}};m.prototype._bufferAction=function(t,e){if(this._actions.indexOf(t)<0){if(e){this._actions.push(t)}else{this._actions.unshift(t)}}};m.prototype.dispose=function(){if(this._armatureData!==null){this._lockUpdate=true;this._dragonBones.bufferObject(this)}};m.prototype.init=function(t,e,i,r){if(this._armatureData!==null){return}this._armatureData=t;this._animation=a.BaseObject.borrowObject(a.Animation);this._proxy=e;this._display=i;this._dragonBones=r;this._proxy.dbInit(this);this._animation.init(this);this._animation.animations=this._armatureData.animations};m.prototype.advanceTime=function(t){if(this._lockUpdate){return}this._lockUpdate=true;if(this._armatureData===null){console.warn("The armature has been disposed.");return}else if(this._armatureData.parent===null){console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");return}var e=this._cacheFrameIndex;this._animation.advanceTime(t);if(this._slotsDirty||this._zIndexDirty){this._slots.sort(m._onSortSlots);if(this._zIndexDirty){for(var i=0,r=this._slots.length;i<r;++i){this._slots[i]._setZOrder(i)}}this._slotsDirty=false;this._zIndexDirty=false}if(this._alphaDirty){this._alphaDirty=false;this._globalAlpha=this._alpha*(this._parent!==null?this._parent._globalAlpha:1);for(var a=0,n=this._bones;a<n.length;a++){var s=n[a];s._updateAlpha()}for(var o=0,h=this._slots;o<h.length;o++){var l=h[o];l._updateAlpha()}}if(this._cacheFrameIndex<0||this._cacheFrameIndex!==e){var i=0,r=0;for(i=0,r=this._bones.length;i<r;++i){this._bones[i].update(this._cacheFrameIndex)}for(i=0,r=this._slots.length;i<r;++i){this._slots[i].update(this._cacheFrameIndex)}}if(this._actions.length>0){for(var u=0,f=this._actions;u<f.length;u++){var c=f[u];var p=c.actionData;if(p!==null){if(p.type===0){if(c.slot!==null){var d=c.slot.childArmature;if(d!==null){d.animation.fadeIn(p.name)}}else if(c.bone!==null){for(var _=0,g=this.getSlots();_<g.length;_++){var l=g[_];if(l.parent===c.bone){var d=l.childArmature;if(d!==null){d.animation.fadeIn(p.name)}}}}else{this._animation.fadeIn(p.name)}}}c.returnToPool()}this._actions.length=0}this._lockUpdate=false;this._proxy.dbUpdate()};m.prototype.invalidUpdate=function(t,e){if(t===void 0){t=null}if(e===void 0){e=false}if(t!==null&&t.length>0){var i=this.getBone(t);if(i!==null){i.invalidUpdate();if(e){for(var r=0,a=this._slots;r<a.length;r++){var n=a[r];if(n.parent===i){n.invalidUpdate()}}}}}else{for(var s=0,o=this._bones;s<o.length;s++){var i=o[s];i.invalidUpdate()}if(e){for(var h=0,l=this._slots;h<l.length;h++){var n=l[h];n.invalidUpdate()}}}};m.prototype.containsPoint=function(t,e){for(var i=0,r=this._slots;i<r.length;i++){var a=r[i];if(a.containsPoint(t,e)){return a}}return null};m.prototype.intersectsSegment=function(t,e,i,r,a,n,s){if(a===void 0){a=null}if(n===void 0){n=null}if(s===void 0){s=null}var o=t===i;var h=0;var l=0;var u=0;var f=0;var c=0;var p=0;var d=0;var _=0;var g=null;var m=null;for(var y=0,v=this._slots;y<v.length;y++){var T=v[y];var x=T.intersectsSegment(t,e,i,r,a,n,s);if(x>0){if(a!==null||n!==null){if(a!==null){var b=o?a.y-e:a.x-t;if(b<0){b=-b}if(g===null||b<h){h=b;u=a.x;f=a.y;g=T;if(s){d=s.x}}}if(n!==null){var b=n.x-t;if(b<0){b=-b}if(m===null||b>l){l=b;c=n.x;p=n.y;m=T;if(s!==null){_=s.y}}}}else{g=T;break}}}if(g!==null&&a!==null){a.x=u;a.y=f;if(s!==null){s.x=d}}if(m!==null&&n!==null){n.x=c;n.y=p;if(s!==null){s.y=_}}return g};m.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var r=i[e];if(r.name===t){return r}}return null};m.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return e!==null?e.parent:null};m.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];if(r.name===t){return r}}return null};m.prototype.getSlotByDisplay=function(t){if(t!==null){for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];if(r.display===t){return r}}}return null};m.prototype.getBones=function(){return this._bones};m.prototype.getSlots=function(){return this._slots};Object.defineProperty(m.prototype,"flipX",{get:function(){return this._flipX},set:function(t){if(this._flipX===t){return}this._flipX=t;this.invalidUpdate()},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"flipY",{get:function(){return this._flipY},set:function(t){if(this._flipY===t){return}this._flipY=t;this.invalidUpdate()},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];var a=r.childArmature;if(a!==null){a.cacheFrameRate=t}}}},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"name",{get:function(){return this._armatureData.name},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"animation",{get:function(){return this._animation},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"proxy",{get:function(){return this._proxy},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"display",{get:function(){return this._display},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture===t){return}if(this._replaceTextureAtlasData!==null){this._replaceTextureAtlasData.returnToPool();this._replaceTextureAtlasData=null}this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];r.invalidUpdate();r.update(-1)}},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock===t){return}if(this._clock!==null){this._clock.remove(this)}this._clock=t;if(this._clock){this._clock.add(this)}for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];var a=r.childArmature;if(a!==null){a.clock=this._clock}}},enumerable:true,configurable:true});Object.defineProperty(m.prototype,"parent",{get:function(){return this._parent},enumerable:true,configurable:true});m.prototype.getDisplay=function(){return this._display};return m}(a.BaseObject);a.Armature=t})(dragonBones||(dragonBones={}));var dragonBones;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.globalTransformMatrix=new i.Matrix;t.global=new i.Transform;t.offset=new i.Transform;return t}t.prototype._onClear=function(){this.globalTransformMatrix.identity();this.global.identity();this.offset.identity();this.origin=null;this.userData=null;this._globalDirty=false;this._alpha=1;this._globalAlpha=1;this._armature=null};t.prototype.updateGlobalTransform=function(){if(this._globalDirty){this._globalDirty=false;this.global.fromMatrix(this.globalTransformMatrix)}};Object.defineProperty(t.prototype,"armature",{get:function(){return this._armature},enumerable:true,configurable:true});t._helpMatrix=new i.Matrix;t._helpTransform=new i.Transform;t._helpPoint=new i.Point;return t}(i.BaseObject);i.TransformObject=t})(dragonBones||(dragonBones={}));var dragonBones;(function(m){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.animationPose=new m.Transform;return t}t.toString=function(){return"[class dragonBones.Bone]"};t.prototype._onClear=function(){e.prototype._onClear.call(this);this.offsetMode=1;this.animationPose.identity();this._transformDirty=false;this._childrenTransformDirty=false;this._localDirty=true;this._hasConstraint=false;this._visible=true;this._cachedFrameIndex=-1;this._boneData=null;this._parent=null;this._cachedFrameIndices=null};t.prototype._updateGlobalTransformMatrix=function(t){var e=this._boneData;var i=this.global;var r=this.globalTransformMatrix;var a=this.origin;var n=this.offset;var s=this.animationPose;var o=this._parent;var h=this._armature.flipX;var l=this._armature.flipY===m.DragonBones.yDown;var u=o!==null;var f=0;if(this.offsetMode===1){if(a!==null){i.x=a.x+n.x+s.x;i.y=a.y+n.y+s.y;i.skew=a.skew+n.skew+s.skew;i.rotation=a.rotation+n.rotation+s.rotation;i.scaleX=a.scaleX*n.scaleX*s.scaleX;i.scaleY=a.scaleY*n.scaleY*s.scaleY}else{i.copyFrom(n).add(s)}}else if(this.offsetMode===0){if(a!==null){i.copyFrom(a).add(s)}else{i.copyFrom(s)}}else{u=false;i.copyFrom(n)}if(u){var c=o._boneData.type===1;var p=c?o._bone:null;var d=c?o._getGlobalTransformMatrix(i.x,i.y):o.globalTransformMatrix;if(e.inheritScale&&(!c||p!==null)){if(c){if(e.inheritRotation){i.rotation+=o.global.rotation}p.updateGlobalTransform();i.scaleX*=p.global.scaleX;i.scaleY*=p.global.scaleY;d.transformPoint(i.x,i.y,i);i.toMatrix(r);if(e.inheritTranslation){i.x=r.tx;i.y=r.ty}else{r.tx=i.x;r.ty=i.y}}else{if(!e.inheritRotation){o.updateGlobalTransform();if(h&&l){f=i.rotation-(o.global.rotation+Math.PI)}else if(h){f=i.rotation+o.global.rotation+Math.PI}else if(l){f=i.rotation+o.global.rotation}else{f=i.rotation-o.global.rotation}i.rotation=f}i.toMatrix(r);r.concat(d);if(e.inheritTranslation){i.x=r.tx;i.y=r.ty}else{r.tx=i.x;r.ty=i.y}if(t){i.fromMatrix(r)}else{this._globalDirty=true}}}else{if(e.inheritTranslation){var _=i.x;var g=i.y;i.x=d.a*_+d.c*g+d.tx;i.y=d.b*_+d.d*g+d.ty}else{if(h){i.x=-i.x}if(l){i.y=-i.y}}if(e.inheritRotation){o.updateGlobalTransform();if(o.global.scaleX<0){f=i.rotation+o.global.rotation+Math.PI}else{f=i.rotation+o.global.rotation}if(d.a*d.d-d.b*d.c<0){f-=i.rotation*2;if(h!==l||e.inheritReflection){i.skew+=Math.PI}}i.rotation=f}else if(h||l){if(h&&l){f=i.rotation+Math.PI}else{if(h){f=Math.PI-i.rotation}else{f=-i.rotation}i.skew+=Math.PI}i.rotation=f}i.toMatrix(r)}}else{if(h||l){if(h){i.x=-i.x}if(l){i.y=-i.y}if(h&&l){f=i.rotation+Math.PI}else{if(h){f=Math.PI-i.rotation}else{f=-i.rotation}i.skew+=Math.PI}i.rotation=f}i.toMatrix(r)}};t.prototype._updateAlpha=function(){if(this._parent!==null){this._globalAlpha=this._alpha*this._parent._globalAlpha}else{this._globalAlpha=this._alpha*this._armature._globalAlpha}};t.prototype.init=function(t,e){if(this._boneData!==null){return}this._boneData=t;this._armature=e;this._alpha=this._boneData.alpha;if(this._boneData.parent!==null){this._parent=this._armature.getBone(this._boneData.parent.name)}this._armature._addBone(this);this.origin=this._boneData.transform};t.prototype.update=function(t){if(t>=0&&this._cachedFrameIndices!==null){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e){this._transformDirty=false}else if(e>=0){this._transformDirty=true;this._cachedFrameIndex=e}else{if(this._hasConstraint){for(var i=0,r=this._armature._constraints;i<r.length;i++){var a=r[i];if(a._root===this){a.update()}}}if(this._transformDirty||this._parent!==null&&this._parent._childrenTransformDirty){this._transformDirty=true;this._cachedFrameIndex=-1}else if(this._cachedFrameIndex>=0){this._transformDirty=false;this._cachedFrameIndices[t]=this._cachedFrameIndex}else{this._transformDirty=true;this._cachedFrameIndex=-1}}}else{if(this._hasConstraint){for(var n=0,s=this._armature._constraints;n<s.length;n++){var a=s[n];if(a._root===this){a.update()}}}if(this._transformDirty||this._parent!==null&&this._parent._childrenTransformDirty){t=-1;this._transformDirty=true;this._cachedFrameIndex=-1}}if(this._transformDirty){this._transformDirty=false;this._childrenTransformDirty=true;if(this._cachedFrameIndex<0){var o=t>=0;if(this._localDirty){this._updateGlobalTransformMatrix(o)}if(o&&this._cachedFrameIndices!==null){this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global)}}else{this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex)}}else if(this._childrenTransformDirty){this._childrenTransformDirty=false}this._localDirty=true};t.prototype.updateByConstraint=function(){if(this._localDirty){this._localDirty=false;if(this._transformDirty||this._parent!==null&&this._parent._childrenTransformDirty){this._updateGlobalTransformMatrix(true)}this._transformDirty=true}};t.prototype.invalidUpdate=function(){this._transformDirty=true};t.prototype.contains=function(t){if(t===this){return false}var e=t;while(e!==this&&e!==null){e=e.parent}return e===this};Object.defineProperty(t.prototype,"boneData",{get:function(){return this._boneData},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible===t){return}this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var r=i[e];if(r.parent===this){r._updateVisible()}}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"name",{get:function(){return this._boneData.name},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:true,configurable:true});return t}(m.TransformObject);m.Bone=t})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(h){__extends(S,h);function S(){var t=h!==null&&h.apply(this,arguments)||this;t._vertices=[];t._deformVertices=[];t._hullCache=[];t._matrixCahce=[];return t}S.toString=function(){return"[class dragonBones.Surface]"};S.prototype._onClear=function(){h.prototype._onClear.call(this);this._dX=0;this._dY=0;this._k=0;this._kX=0;this._kY=0;this._vertices.length=0;this._deformVertices.length=0;this._matrixCahce.length=0;this._hullCache.length=0;this._bone=null};S.prototype._getAffineTransform=function(t,e,i,r,a,n,s,o,h,l,u,f,c){var p=s-a;var d=o-n;var _=h-a;var g=l-n;u.rotation=Math.atan2(d,p);u.skew=Math.atan2(g,_)-Math.PI*.5-u.rotation;if(c){u.rotation+=Math.PI}u.scaleX=Math.sqrt(p*p+d*d)/i;u.scaleY=Math.sqrt(_*_+g*g)/r;u.toMatrix(f);u.x=f.tx=a-(f.a*t+f.c*e);u.y=f.ty=n-(f.b*t+f.d*e)};S.prototype._updateVertices=function(){var t=this._armature.armatureData.parent;var e=this._boneData.geometry;var i=t.intArray;var r=t.floatArray;var a=i[e.offset+0];var n=i[e.offset+2];var s=this._vertices;var o=this._deformVertices;if(this._parent!==null){if(this._parent._boneData.type===1){for(var h=0,l=a;h<l;++h){var u=h*2;var f=r[n+u]+o[u];var c=r[n+u+1]+o[u+1];var p=this._parent._getGlobalTransformMatrix(f,c);s[u]=p.a*f+p.c*c+p.tx;s[u+1]=p.b*f+p.d*c+p.ty}}else{var d=this._parent.globalTransformMatrix;for(var h=0,l=a;h<l;++h){var u=h*2;var f=r[n+u]+o[u];var c=r[n+u+1]+o[u+1];s[u]=d.a*f+d.c*c+d.tx;s[u+1]=d.b*f+d.d*c+d.ty}}}else{for(var h=0,l=a;h<l;++h){var u=h*2;s[u]=r[n+u]+o[u];s[u+1]=r[n+u+1]+o[u+1]}}};S.prototype._updateGlobalTransformMatrix=function(t){t;var e=this._boneData.segmentX*2;var i=this._vertices.length-2;var r=200;var a=this._vertices[0];var n=this._vertices[1];var s=this._vertices[e];var o=this._vertices[e+1];var h=this._vertices[i];var l=this._vertices[i+1];var u=this._vertices[i-e];var f=this._vertices[i-e+1];var c=a+(h-a)*.5;var p=n+(l-n)*.5;var d=s+(u-s)*.5;var _=o+(f-o)*.5;var g=c+(d-c)*.5;var m=p+(_-p)*.5;var y=s+(h-s)*.5;var v=o+(l-o)*.5;var T=u+(h-u)*.5;var x=f+(l-f)*.5;this._getAffineTransform(0,0,r,r,g,m,y,v,T,x,this.global,this.globalTransformMatrix,false);this._globalDirty=false};S.prototype._getGlobalTransformMatrix=function(t,e){var i=200;var r=1e3;if(t<-r||r<t||e<-r||r<e){return this.globalTransformMatrix}var a=false;var n=this._boneData;var s=n.segmentX;var o=n.segmentY;var h=n.segmentX*2;var l=this._dX;var u=this._dY;var f=Math.floor((t+i)/l);var c=Math.floor((e+i)/u);var p=0;var d=f*l-i;var _=c*u-i;var g=this._matrixCahce;var m=S._helpMatrix;if(t<-i){if(e<-i||e>=i){return this.globalTransformMatrix}a=e>this._kX*(t+i)+_;p=((s*o+s+o+o+c)*2+(a?1:0))*7;if(g[p]>0){m.copyFromArray(g,p+1)}else{var y=c*(h+2);var v=this._hullCache[4];var T=this._hullCache[5];var x=this._hullCache[2]-(o-c)*v;var b=this._hullCache[3]-(o-c)*T;var A=this._vertices;if(a){this._getAffineTransform(-i,_+u,r-i,u,A[y+h+2],A[y+h+3],x+v,b+T,A[y],A[y+1],S._helpTransform,m,true)}else{this._getAffineTransform(-r,_,r-i,u,x,b,A[y],A[y+1],x+v,b+T,S._helpTransform,m,false)}g[p]=1;g[p+1]=m.a;g[p+2]=m.b;g[p+3]=m.c;g[p+4]=m.d;g[p+5]=m.tx;g[p+6]=m.ty}}else if(t>=i){if(e<-i||e>=i){return this.globalTransformMatrix}a=e>this._kX*(t-r)+_;p=((s*o+s+c)*2+(a?1:0))*7;if(g[p]>0){m.copyFromArray(g,p+1)}else{var y=(c+1)*(h+2)-2;var v=this._hullCache[4];var T=this._hullCache[5];var x=this._hullCache[0]+c*v;var b=this._hullCache[1]+c*T;var A=this._vertices;if(a){this._getAffineTransform(r,_+u,r-i,u,x+v,b+T,A[y+h+2],A[y+h+3],x,b,S._helpTransform,m,true)}else{this._getAffineTransform(i,_,r-i,u,A[y],A[y+1],x,b,A[y+h+2],A[y+h+3],S._helpTransform,m,false)}g[p]=1;g[p+1]=m.a;g[p+2]=m.b;g[p+3]=m.c;g[p+4]=m.d;g[p+5]=m.tx;g[p+6]=m.ty}}else if(e<-i){if(t<-i||t>=i){return this.globalTransformMatrix}a=e>this._kY*(t-d-l)-r;p=((s*o+f)*2+(a?1:0))*7;if(g[p]>0){m.copyFromArray(g,p+1)}else{var y=f*2;var v=this._hullCache[10];var T=this._hullCache[11];var x=this._hullCache[8]+f*v;var b=this._hullCache[9]+f*T;var A=this._vertices;if(a){this._getAffineTransform(d+l,-i,l,r-i,A[y+2],A[y+3],A[y],A[y+1],x+v,b+T,S._helpTransform,m,true)}else{this._getAffineTransform(d,-r,l,r-i,x,b,x+v,b+T,A[y],A[y+1],S._helpTransform,m,false)}g[p]=1;g[p+1]=m.a;g[p+2]=m.b;g[p+3]=m.c;g[p+4]=m.d;g[p+5]=m.tx;g[p+6]=m.ty}}else if(e>=i){if(t<-i||t>=i){return this.globalTransformMatrix}a=e>this._kY*(t-d-l)+i;p=((s*o+s+o+f)*2+(a?1:0))*7;if(g[p]>0){m.copyFromArray(g,p+1)}else{var y=o*(h+2)+f*2;var v=this._hullCache[10];var T=this._hullCache[11];var x=this._hullCache[6]-(s-f)*v;var b=this._hullCache[7]-(s-f)*T;var A=this._vertices;if(a){this._getAffineTransform(d+l,r,l,r-i,x+v,b+T,x,b,A[y+2],A[y+3],S._helpTransform,m,true)}else{this._getAffineTransform(d,i,l,r-i,A[y],A[y+1],A[y+2],A[y+3],x,b,S._helpTransform,m,false)}g[p]=1;g[p+1]=m.a;g[p+2]=m.b;g[p+3]=m.c;g[p+4]=m.d;g[p+5]=m.tx;g[p+6]=m.ty}}else{a=e>this._k*(t-d-l)+_;p=((s*c+f)*2+(a?1:0))*7;if(g[p]>0){m.copyFromArray(g,p+1)}else{var y=f*2+c*(h+2);var A=this._vertices;if(a){this._getAffineTransform(d+l,_+u,l,u,A[y+h+4],A[y+h+5],A[y+h+2],A[y+h+3],A[y+2],A[y+3],S._helpTransform,m,true)}else{this._getAffineTransform(d,_,l,u,A[y],A[y+1],A[y+2],A[y+3],A[y+h+2],A[y+h+3],S._helpTransform,m,false)}g[p]=1;g[p+1]=m.a;g[p+2]=m.b;g[p+3]=m.c;g[p+4]=m.d;g[p+5]=m.tx;g[p+6]=m.ty}}return m};S.prototype.init=function(t,e){if(this._boneData!==null){return}h.prototype.init.call(this,t,e);var i=t.segmentX;var r=t.segmentY;var a=this._armature.armatureData.parent.intArray[t.geometry.offset+0];var n=1e3;var s=200;this._dX=s*2/i;this._dY=s*2/r;this._k=-this._dY/this._dX;this._kX=-this._dY/(n-s);this._kY=-(n-s)/this._dX;this._vertices.length=a*2;this._deformVertices.length=a*2;this._matrixCahce.length=(i*r+i*2+r*2)*2*7;this._hullCache.length=10;for(var o=0;o<a*2;++o){this._deformVertices[o]=0}if(this._parent!==null){if(this._parent.boneData.type===0){this._bone=this._parent}else{this._bone=this._parent._bone}}};S.prototype.update=function(t){if(t>=0&&this._cachedFrameIndices!==null){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e){this._transformDirty=false}else if(e>=0){this._transformDirty=true;this._cachedFrameIndex=e}else{if(this._hasConstraint){for(var i=0,r=this._armature._constraints;i<r.length;i++){var a=r[i];if(a._root===this){a.update()}}}if(this._transformDirty||this._parent!==null&&this._parent._childrenTransformDirty){this._transformDirty=true;this._cachedFrameIndex=-1}else if(this._cachedFrameIndex>=0){this._transformDirty=false;this._cachedFrameIndices[t]=this._cachedFrameIndex}else{this._transformDirty=true;this._cachedFrameIndex=-1}}}else{if(this._hasConstraint){for(var n=0,s=this._armature._constraints;n<s.length;n++){var a=s[n];if(a._root===this){a.update()}}}if(this._transformDirty||this._parent!==null&&this._parent._childrenTransformDirty){t=-1;this._transformDirty=true;this._cachedFrameIndex=-1}}if(this._transformDirty){this._transformDirty=false;this._childrenTransformDirty=true;for(var o=0,h=this._matrixCahce.length;o<h;o+=7){this._matrixCahce[o]=-1}this._updateVertices();if(this._cachedFrameIndex<0){var l=t>=0;if(this._localDirty){this._updateGlobalTransformMatrix(l)}if(l&&this._cachedFrameIndices!==null){this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global)}}else{this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex)}var u=1e3;var f=200;var c=2*this.global.x;var p=2*this.global.y;var d=S._helpPoint;this.globalTransformMatrix.transformPoint(u,-f,d);this._hullCache[0]=d.x;this._hullCache[1]=d.y;this._hullCache[2]=c-d.x;this._hullCache[3]=p-d.y;this.globalTransformMatrix.transformPoint(0,this._dY,d,true);this._hullCache[4]=d.x;this._hullCache[5]=d.y;this.globalTransformMatrix.transformPoint(f,u,d);this._hullCache[6]=d.x;this._hullCache[7]=d.y;this._hullCache[8]=c-d.x;this._hullCache[9]=p-d.y;this.globalTransformMatrix.transformPoint(this._dX,0,d,true);this._hullCache[10]=d.x;this._hullCache[11]=d.y}else if(this._childrenTransformDirty){this._childrenTransformDirty=false}this._localDirty=true};return S}(t.Bone);t.Surface=e})(dragonBones||(dragonBones={}));var dragonBones;(function(_){var r=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.deformVertices=[];return t}t.toString=function(){return"[class dragonBones.DisplayFrame]"};t.prototype._onClear=function(){this.rawDisplayData=null;this.displayData=null;this.textureData=null;this.display=null;this.deformVertices.length=0};t.prototype.updateDeformVertices=function(){if(this.rawDisplayData===null||this.deformVertices.length!==0){return}var t;if(this.rawDisplayData.type===2){t=this.rawDisplayData.geometry}else if(this.rawDisplayData.type===4){t=this.rawDisplayData.geometry}else{return}var e=0;if(t.weight!==null){e=t.weight.count*2}else{e=t.data.intArray[t.offset+0]*2}this.deformVertices.length=e;for(var i=0,r=this.deformVertices.length;i<r;++i){this.deformVertices[i]=0}};t.prototype.getGeometryData=function(){if(this.displayData!==null){if(this.displayData.type===2){return this.displayData.geometry}if(this.displayData.type===4){return this.displayData.geometry}}if(this.rawDisplayData!==null){if(this.rawDisplayData.type===2){return this.rawDisplayData.geometry}if(this.rawDisplayData.type===4){return this.rawDisplayData.geometry}}return null};t.prototype.getBoundingBox=function(){if(this.displayData!==null&&this.displayData.type===3){return this.displayData.boundingBox}if(this.rawDisplayData!==null&&this.rawDisplayData.type===3){return this.rawDisplayData.boundingBox}return null};t.prototype.getTextureData=function(){if(this.displayData!==null){if(this.displayData.type===0){return this.displayData.texture}if(this.displayData.type===2){return this.displayData.texture}}if(this.textureData!==null){return this.textureData}if(this.rawDisplayData!==null){if(this.rawDisplayData.type===0){return this.rawDisplayData.texture}if(this.rawDisplayData.type===2){return this.rawDisplayData.texture}}return null};return t}(_.BaseObject);_.DisplayFrame=r;var t=function(h){__extends(d,h);function d(){var t=h!==null&&h.apply(this,arguments)||this;t._localMatrix=new _.Matrix;t._colorTransform=new _.ColorTransform;t._displayFrames=[];t._geometryBones=[];t._rawDisplay=null;t._meshDisplay=null;t._display=null;return t}d.prototype._onClear=function(){h.prototype._onClear.call(this);var t=[];for(var e=0,i=this._displayFrames;e<i.length;e++){var r=i[e];var a=r.display;if(a!==this._rawDisplay&&a!==this._meshDisplay&&t.indexOf(a)<0){t.push(a)}r.returnToPool()}for(var n=0,s=t;n<s.length;n++){var o=s[n];if(o instanceof _.Armature){o.dispose()}else{this._disposeDisplay(o,true)}}if(this._meshDisplay!==null&&this._meshDisplay!==this._rawDisplay){this._disposeDisplay(this._meshDisplay,false)}if(this._rawDisplay!==null){this._disposeDisplay(this._rawDisplay,false)}this.displayController=null;this._displayDataDirty=false;this._displayDirty=false;this._geometryDirty=false;this._textureDirty=false;this._visibleDirty=false;this._blendModeDirty=false;this._zOrderDirty=false;this._colorDirty=false;this._verticesDirty=false;this._transformDirty=false;this._visible=true;this._blendMode=0;this._displayIndex=-1;this._animationDisplayIndex=-1;this._zOrder=0;this._zIndex=0;this._cachedFrameIndex=-1;this._pivotX=0;this._pivotY=0;this._localMatrix.identity();this._colorTransform.identity();this._displayFrames.length=0;this._geometryBones.length=0;this._slotData=null;this._displayFrame=null;this._geometryData=null;this._boundingBoxData=null;this._textureData=null;this._rawDisplay=null;this._meshDisplay=null;this._display=null;this._childArmature=null;this._parent=null;this._cachedFrameIndices=null};d.prototype._hasDisplay=function(t){for(var e=0,i=this._displayFrames;e<i.length;e++){var r=i[e];if(r.display===t){return true}}return false};d.prototype._isBonesUpdate=function(){for(var t=0,e=this._geometryBones;t<e.length;t++){var i=e[t];if(i!==null&&i._childrenTransformDirty){return true}}return false};d.prototype._updateAlpha=function(){var t=this._alpha*this._parent._globalAlpha;if(this._globalAlpha!==t){this._globalAlpha=t;this._colorDirty=true}};d.prototype._updateDisplayData=function(){var t=this._displayFrame;var e=this._geometryData;var i=this._textureData;var r=null;var a=null;this._displayFrame=null;this._geometryData=null;this._boundingBoxData=null;this._textureData=null;if(this._displayIndex>=0&&this._displayIndex<this._displayFrames.length){this._displayFrame=this._displayFrames[this._displayIndex];r=this._displayFrame.rawDisplayData;a=this._displayFrame.displayData;this._geometryData=this._displayFrame.getGeometryData();this._boundingBoxData=this._displayFrame.getBoundingBox();this._textureData=this._displayFrame.getTextureData()}if(this._displayFrame!==t||this._geometryData!==e||this._textureData!==i){if(this._geometryData===null&&this._textureData!==null){var n=a!==null&&a.type===0?a:r;var s=this._textureData.parent.scale*this._armature._armatureData.scale;var o=this._textureData.frame;this._pivotX=n.pivot.x;this._pivotY=n.pivot.y;var h=o!==null?o:this._textureData.region;var l=h.width;var u=h.height;if(this._textureData.rotated&&o===null){l=h.height;u=h.width}this._pivotX*=l*s;this._pivotY*=u*s;if(o!==null){this._pivotX+=o.x*s;this._pivotY+=o.y*s}if(r!==null&&n!==r){r.transform.toMatrix(d._helpMatrix);d._helpMatrix.invert();d._helpMatrix.transformPoint(0,0,d._helpPoint);this._pivotX-=d._helpPoint.x;this._pivotY-=d._helpPoint.y;n.transform.toMatrix(d._helpMatrix);d._helpMatrix.invert();d._helpMatrix.transformPoint(0,0,d._helpPoint);this._pivotX+=d._helpPoint.x;this._pivotY+=d._helpPoint.y}if(!_.DragonBones.yDown){this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*s-this._pivotY}}else{this._pivotX=0;this._pivotY=0}if(r!==null){this.origin=r.transform}else if(a!==null){this.origin=a.transform}else{this.origin=null}if(this.origin!==null){this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix)}else{this.global.copyFrom(this.offset).toMatrix(this._localMatrix)}if(this._geometryData!==e){this._geometryDirty=true;this._verticesDirty=true;if(this._geometryData!==null){this._geometryBones.length=0;if(this._geometryData.weight!==null){for(var f=0,c=this._geometryData.weight.bones.length;f<c;++f){var p=this._armature.getBone(this._geometryData.weight.bones[f].name);this._geometryBones.push(p)}}}else{this._geometryBones.length=0;this._geometryData=null}}this._textureDirty=this._textureData!==i;this._transformDirty=true}};d.prototype._updateDisplay=function(){var t=this._display!==null?this._display:this._rawDisplay;var e=this._childArmature;if(this._displayFrame!==null){this._display=this._displayFrame.display;if(this._display!==null&&this._display instanceof _.Armature){this._childArmature=this._display;this._display=this._childArmature.display}else{this._childArmature=null}}else{this._display=null;this._childArmature=null}var i=this._display!==null?this._display:this._rawDisplay;if(i!==t){this._textureDirty=true;this._visibleDirty=true;this._blendModeDirty=true;this._colorDirty=true;this._transformDirty=true;this._onUpdateDisplay();this._replaceDisplay(t)}if(this._childArmature!==e){if(e!==null){e._parent=null;e.clock=null;if(e.inheritAnimation){e.animation.reset()}}if(this._childArmature!==null){this._childArmature._parent=this;this._childArmature.clock=this._armature.clock;if(this._childArmature.inheritAnimation){if(this._childArmature.cacheFrameRate===0){var r=this._armature.cacheFrameRate;if(r!==0){this._childArmature.cacheFrameRate=r}}if(this._displayFrame!==null){var a=null;var n=this._displayFrame.displayData!==null?this._displayFrame.displayData:this._displayFrame.rawDisplayData;if(n!==null&&n.type===1){a=n.actions}if(a!==null&&a.length>0){for(var s=0,o=a;s<o.length;s++){var h=o[s];var l=_.BaseObject.borrowObject(_.EventObject);_.EventObject.actionDataToInstance(h,l,this._armature);l.slot=this;this._armature._bufferAction(l,false)}}else{this._childArmature.animation.play()}}}}}};d.prototype._updateGlobalTransformMatrix=function(t){var e=this._parent._boneData.type===0?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix);this.globalTransformMatrix.concat(e);if(t){this.global.fromMatrix(this.globalTransformMatrix)}else{this._globalDirty=true}};d.prototype._setDisplayIndex=function(t,e){if(e===void 0){e=false}if(e){if(this._animationDisplayIndex===t){return}this._animationDisplayIndex=t}if(this._displayIndex===t){return}this._displayIndex=t<this._displayFrames.length?t:this._displayFrames.length-1;this._displayDataDirty=true;this._displayDirty=this._displayIndex<0||this._display!==this._displayFrames[this._displayIndex].display};d.prototype._setZOrder=function(t){if(this._zOrder===t){}this._zOrder=t;this._zOrderDirty=true;return this._zOrderDirty};d.prototype._setColor=function(t){this._colorTransform.copyFrom(t);return this._colorDirty=true};d.prototype.init=function(t,e,i,r){if(this._slotData!==null){return}this._slotData=t;this._colorDirty=true;this._blendModeDirty=true;this._blendMode=this._slotData.blendMode;this._zOrder=this._slotData.zOrder;this._zIndex=this._slotData.zIndex;this._alpha=this._slotData.alpha;this._colorTransform.copyFrom(this._slotData.color);this._rawDisplay=i;this._meshDisplay=r;this._armature=e;var a=this._armature.getBone(this._slotData.parent.name);if(a!==null){this._parent=a}else{}this._armature._addSlot(this);this._initDisplay(this._rawDisplay,false);if(this._rawDisplay!==this._meshDisplay){this._initDisplay(this._meshDisplay,false)}this._onUpdateDisplay();this._addDisplay()};d.prototype.update=function(t){if(this._displayDataDirty){this._updateDisplayData();this._displayDataDirty=false}if(this._displayDirty){this._updateDisplay();this._displayDirty=false}if(this._geometryDirty||this._textureDirty){if(this._display===null||this._display===this._rawDisplay||this._display===this._meshDisplay){this._updateFrame()}this._geometryDirty=false;this._textureDirty=false}if(this._display===null){return}if(this._visibleDirty){this._updateVisible();this._visibleDirty=false}if(this._blendModeDirty){this._updateBlendMode();this._blendModeDirty=false}if(this._colorDirty){this._updateColor();this._colorDirty=false}if(this._zOrderDirty){this._updateZOrder();this._zOrderDirty=false}if(this._geometryData!==null&&this._display===this._meshDisplay){var e=this._geometryData.weight!==null;var i=this._parent._boneData.type!==0;if(this._verticesDirty||e&&this._isBonesUpdate()||i&&this._parent._childrenTransformDirty){this._updateMesh();this._verticesDirty=false}if(e||i){return}}if(t>=0&&this._cachedFrameIndices!==null){var r=this._cachedFrameIndices[t];if(r>=0&&this._cachedFrameIndex===r){this._transformDirty=false}else if(r>=0){this._transformDirty=true;this._cachedFrameIndex=r}else if(this._transformDirty||this._parent._childrenTransformDirty){this._transformDirty=true;this._cachedFrameIndex=-1}else if(this._cachedFrameIndex>=0){this._transformDirty=false;this._cachedFrameIndices[t]=this._cachedFrameIndex}else{this._transformDirty=true;this._cachedFrameIndex=-1}}else if(this._transformDirty||this._parent._childrenTransformDirty){t=-1;this._transformDirty=true;this._cachedFrameIndex=-1}if(this._transformDirty){if(this._cachedFrameIndex<0){var a=t>=0;this._updateGlobalTransformMatrix(a);if(a&&this._cachedFrameIndices!==null){this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global)}}else{this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex)}this._updateTransform();this._transformDirty=false}};d.prototype.invalidUpdate=function(){this._displayDataDirty=true;this._displayDirty=true;this._transformDirty=true};d.prototype.updateTransformAndMatrix=function(){if(this._transformDirty){this._updateGlobalTransformMatrix(false);this._transformDirty=false}};d.prototype.replaceRawDisplayData=function(t,e){if(e===void 0){e=-1}if(e<0){e=this._displayIndex<0?0:this._displayIndex}else if(e>=this._displayFrames.length){return}var i=this._displayFrames[e];if(i.rawDisplayData!==t){i.deformVertices.length=0;i.rawDisplayData=t;if(i.rawDisplayData===null){var r=this._armature._armatureData.defaultSkin;if(r!==null){var a=r.getDisplays(this._slotData.name);if(a!==null&&e<a.length){i.rawDisplayData=a[e]}}}if(e===this._displayIndex){this._displayDataDirty=true}}};d.prototype.replaceDisplayData=function(t,e){if(e===void 0){e=-1}if(e<0){e=this._displayIndex<0?0:this._displayIndex}else if(e>=this._displayFrames.length){return}var i=this._displayFrames[e];if(i.displayData!==t&&i.rawDisplayData!==t){i.displayData=t;if(e===this._displayIndex){this._displayDataDirty=true}}};d.prototype.replaceTextureData=function(t,e){if(e===void 0){e=-1}if(e<0){e=this._displayIndex<0?0:this._displayIndex}else if(e>=this._displayFrames.length){return}var i=this._displayFrames[e];if(i.textureData!==t){i.textureData=t;if(e===this._displayIndex){this._displayDataDirty=true}}};d.prototype.replaceDisplay=function(t,e){if(e===void 0){e=-1}if(e<0){e=this._displayIndex<0?0:this._displayIndex}else if(e>=this._displayFrames.length){return}var i=this._displayFrames[e];if(i.display!==t){var r=i.display;i.display=t;if(r!==null&&r!==this._rawDisplay&&r!==this._meshDisplay&&!this._hasDisplay(r)){if(r instanceof _.Armature){}else{this._disposeDisplay(r,true)}}if(t!==null&&t!==this._rawDisplay&&t!==this._meshDisplay&&!this._hasDisplay(r)&&!(t instanceof _.Armature)){this._initDisplay(t,true)}if(e===this._displayIndex){this._displayDirty=true}}};d.prototype.containsPoint=function(t,e){if(this._boundingBoxData===null){return false}this.updateTransformAndMatrix();d._helpMatrix.copyFrom(this.globalTransformMatrix);d._helpMatrix.invert();d._helpMatrix.transformPoint(t,e,d._helpPoint);return this._boundingBoxData.containsPoint(d._helpPoint.x,d._helpPoint.y)};d.prototype.intersectsSegment=function(t,e,i,r,a,n,s){if(a===void 0){a=null}if(n===void 0){n=null}if(s===void 0){s=null}if(this._boundingBoxData===null){return 0}this.updateTransformAndMatrix();d._helpMatrix.copyFrom(this.globalTransformMatrix);d._helpMatrix.invert();d._helpMatrix.transformPoint(t,e,d._helpPoint);t=d._helpPoint.x;e=d._helpPoint.y;d._helpMatrix.transformPoint(i,r,d._helpPoint);i=d._helpPoint.x;r=d._helpPoint.y;var o=this._boundingBoxData.intersectsSegment(t,e,i,r,a,n,s);if(o>0){if(o===1||o===2){if(a!==null){this.globalTransformMatrix.transformPoint(a.x,a.y,a);if(n!==null){n.x=a.x;n.y=a.y}}else if(n!==null){this.globalTransformMatrix.transformPoint(n.x,n.y,n)}}else{if(a!==null){this.globalTransformMatrix.transformPoint(a.x,a.y,a)}if(n!==null){this.globalTransformMatrix.transformPoint(n.x,n.y,n)}}if(s!==null){this.globalTransformMatrix.transformPoint(Math.cos(s.x),Math.sin(s.x),d._helpPoint,true);s.x=Math.atan2(d._helpPoint.y,d._helpPoint.x);this.globalTransformMatrix.transformPoint(Math.cos(s.y),Math.sin(s.y),d._helpPoint,true);s.y=Math.atan2(d._helpPoint.y,d._helpPoint.x)}}return o};d.prototype.getDisplayFrameAt=function(t){return this._displayFrames[t]};Object.defineProperty(d.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible===t){return}this._visible=t;this._updateVisible()},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"displayFrameCount",{get:function(){return this._displayFrames.length},set:function(t){var e=this._displayFrames.length;if(e<t){this._displayFrames.length=t;for(var i=e;i<t;++i){this._displayFrames[i]=_.BaseObject.borrowObject(r)}}else if(e>t){for(var i=e-1;i<t;--i){this.replaceDisplay(null,i);this._displayFrames[i].returnToPool()}this._displayFrames.length=t}},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t);this.update(-1)},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"name",{get:function(){return this._slotData.name},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"displayList",{get:function(){var t=new Array;for(var e=0,i=this._displayFrames;e<i.length;e++){var r=i[e];t.push(r.display)}return t},set:function(t){this.displayFrameCount=t.length;var e=0;for(var i=0,r=t;i<r.length;i++){var a=r[i];this.replaceDisplay(a,e++)}},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"slotData",{get:function(){return this._slotData},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display===t){return}if(this._displayFrames.length===0){this.displayFrameCount=1;this._displayIndex=0}this.replaceDisplay(t,this._displayIndex)},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){if(this._childArmature===t){return}this.display=t},enumerable:true,configurable:true});Object.defineProperty(d.prototype,"parent",{get:function(){return this._parent},enumerable:true,configurable:true});d.prototype.getDisplay=function(){return this._display};d.prototype.setDisplay=function(t){this.display=t};return d}(_.TransformObject);_.Slot=t})(dragonBones||(dragonBones={}));var dragonBones;(function(V){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype._onClear=function(){this._armature=null;this._target=null;this._root=null;this._bone=null};Object.defineProperty(e.prototype,"name",{get:function(){return this._constraintData.name},enumerable:true,configurable:true});e._helpMatrix=new V.Matrix;e._helpTransform=new V.Transform;e._helpPoint=new V.Point;return e}(V.BaseObject);V.Constraint=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.toString=function(){return"[class dragonBones.IKConstraint]"};e.prototype._onClear=function(){t.prototype._onClear.call(this);this._scaleEnabled=false;this._bendPositive=false;this._weight=1;this._constraintData=null};e.prototype._computeA=function(){var t=this._target.global;var e=this._root.global;var i=this._root.globalTransformMatrix;var r=Math.atan2(t.y-e.y,t.x-e.x);if(e.scaleX<0){r+=Math.PI}e.rotation+=V.Transform.normalizeRadian(r-e.rotation)*this._weight;e.toMatrix(i)};e.prototype._computeB=function(){var t=this._bone._boneData.length;var e=this._root;var i=this._target.global;var r=e.global;var a=this._bone.global;var n=this._bone.globalTransformMatrix;var s=n.a*t;var o=n.b*t;var h=s*s+o*o;var l=Math.sqrt(h);var u=a.x-r.x;var f=a.y-r.y;var c=u*u+f*f;var p=Math.sqrt(c);var d=a.rotation;var _=r.rotation;var g=Math.atan2(f,u);u=i.x-r.x;f=i.y-r.y;var m=u*u+f*f;var y=Math.sqrt(m);var v=0;if(l+p<=y||y+l<=p||y+p<=l){v=Math.atan2(i.y-r.y,i.x-r.x);if(l+p<=y){}else if(p<l){v+=Math.PI}}else{var T=(c-h+m)/(2*m);var x=Math.sqrt(c-T*T*m)/y;var b=r.x+u*T;var A=r.y+f*T;var S=-f*x;var w=u*x;var P=false;var E=e.parent;if(E!==null){var D=E.globalTransformMatrix;P=D.a*D.d-D.b*D.c<0}if(P!==this._bendPositive){a.x=b-S;a.y=A-w}else{a.x=b+S;a.y=A+w}v=Math.atan2(a.y-r.y,a.x-r.x)}var C=V.Transform.normalizeRadian(v-g);r.rotation=_+C*this._weight;r.toMatrix(e.globalTransformMatrix);var O=g+C*this._weight;a.x=r.x+Math.cos(O)*p;a.y=r.y+Math.sin(O)*p;var M=Math.atan2(i.y-a.y,i.x-a.x);if(a.scaleX<0){M+=Math.PI}a.rotation=r.rotation+d-_+V.Transform.normalizeRadian(M-C-d)*this._weight;a.toMatrix(n)};e.prototype.init=function(t,e){if(this._constraintData!==null){return}this._constraintData=t;this._armature=e;this._target=this._armature.getBone(this._constraintData.target.name);this._root=this._armature.getBone(this._constraintData.root.name);this._bone=this._constraintData.bone!==null?this._armature.getBone(this._constraintData.bone.name):null;{var i=this._constraintData;this._scaleEnabled=i.scaleEnabled;this._bendPositive=i.bendPositive;this._weight=i.weight}this._root._hasConstraint=true};e.prototype.update=function(){this._root.updateByConstraint();if(this._bone!==null){this._bone.updateByConstraint();this._computeB()}else{this._computeA()}};e.prototype.invalidUpdate=function(){this._root.invalidUpdate();if(this._bone!==null){this._bone.invalidUpdate()}};return e}(t);V.IKConstraint=e;var i=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._bones=[];t._spaces=[];t._positions=[];t._curves=[];t._boneLengths=[];t._pathGlobalVertices=[];t._segments=[10];return t}t.toString=function(){return"[class dragonBones.PathConstraint]"};t.prototype._onClear=function(){e.prototype._onClear.call(this);this.dirty=false;this.pathOffset=0;this.position=0;this.spacing=0;this.rotateOffset=0;this.rotateMix=1;this.translateMix=1;this._pathSlot=null;this._bones.length=0;this._spaces.length=0;this._positions.length=0;this._curves.length=0;this._boneLengths.length=0;this._pathGlobalVertices.length=0};t.prototype._updatePathVertices=function(t){var e=this._armature;var i=e.armatureData.parent;var r=e.armatureData.scale;var a=i.intArray;var n=i.floatArray;var s=t.offset;var o=a[s+0];var h=a[s+2];this._pathGlobalVertices.length=o*2;var l=t.weight;if(l===null){var u=this._pathSlot.parent;u.updateByConstraint();var f=u.globalTransformMatrix;for(var c=0,p=h;c<o;c+=2){var d=n[p++]*r;var _=n[p++]*r;var g=f.a*d+f.c*_+f.tx;var m=f.b*d+f.d*_+f.ty;this._pathGlobalVertices[c]=g;this._pathGlobalVertices[c+1]=m}return}var y=this._pathSlot._geometryBones;var v=l.bones.length;var T=l.offset;var x=a[T+1];var b=x;var A=T+2+v;for(var c=0,S=0;c<o;c++){var w=a[A++];var P=0,E=0;for(var D=0,C=w;D<C;D++){var O=a[A++];var M=y[O];if(M===null){continue}M.updateByConstraint();var f=M.globalTransformMatrix;var I=n[b++];var d=n[b++]*r;var _=n[b++]*r;P+=(f.a*d+f.c*_+f.tx)*I;E+=(f.b*d+f.d*_+f.ty)*I}this._pathGlobalVertices[S++]=P;this._pathGlobalVertices[S++]=E}};t.prototype._computeVertices=function(t,e,i,r){for(var a=i,n=t;a<e;a+=2){r[a]=this._pathGlobalVertices[n++];r[a+1]=this._pathGlobalVertices[n++]}};t.prototype._computeBezierCurve=function(t,e,i,r,a){var n=this._armature;var s=n.armatureData.parent.intArray;var o=s[t.geometry.offset+0];var h=this._positions;var l=this._spaces;var u=t.closed;var f=Array();var c=o*2;var p=c/6;var d=-1;var _=this.position;h.length=e*3+2;var g=0;if(!t.constantSpeed){var m=t.curveLengths;p-=u?1:2;g=m[p];if(r){_*=g}if(a){for(var y=0;y<e;y++){l[y]*=g}}f.length=8;for(var y=0,v=0,T=0;y<e;y++,v+=3){var x=l[y];_+=x;if(u){_%=g;if(_<0){_+=g}T=0}else if(_<0){continue}else if(_>g){continue}var b=0;for(;;T++){var A=m[T];if(_>A){continue}if(T===0){b=_/A}else{var S=m[T-1];b=(_-S)/(A-S)}break}if(T!==d){d=T;if(u&&T===p){this._computeVertices(c-4,4,0,f);this._computeVertices(0,4,4,f)}else{this._computeVertices(T*6+2,8,0,f)}}this.addCurvePosition(b,f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],h,v,i)}return}if(u){c+=2;f.length=o;this._computeVertices(2,c-4,0,f);this._computeVertices(0,2,c-4,f);f[c-2]=f[0];f[c-1]=f[1]}else{p--;c-=4;f.length=c;this._computeVertices(2,c,0,f)}var w=new Array(p);g=0;var P=f[0],E=f[1],D=0,C=0,O=0,M=0,I=0,R=0;var N,B,L,F,k,U,j,W;for(var y=0,V=2;y<p;y++,V+=6){D=f[V];C=f[V+1];O=f[V+2];M=f[V+3];I=f[V+4];R=f[V+5];N=(P-D*2+O)*.1875;B=(E-C*2+M)*.1875;L=((D-O)*3-P+I)*.09375;F=((C-M)*3-E+R)*.09375;k=N*2+L;U=B*2+F;j=(D-P)*.75+N+L*.16666667;W=(C-E)*.75+B+F*.16666667;g+=Math.sqrt(j*j+W*W);j+=k;W+=U;k+=L;U+=F;g+=Math.sqrt(j*j+W*W);j+=k;W+=U;g+=Math.sqrt(j*j+W*W);j+=k+L;W+=U+F;g+=Math.sqrt(j*j+W*W);w[y]=g;P=I;E=R}if(r){_*=g}if(a){for(var y=0;y<e;y++){l[y]*=g}}var z=this._segments;var G=0;for(var y=0,v=0,T=0,Y=0;y<e;y++,v+=3){var x=l[y];_+=x;var H=_;if(u){H%=g;if(H<0)H+=g;T=0}else if(H<0){continue}else if(H>g){continue}for(;;T++){var X=w[T];if(H>X)continue;if(T===0)H/=X;else{var q=w[T-1];H=(H-q)/(X-q)}break}if(T!==d){d=T;var K=T*6;P=f[K];E=f[K+1];D=f[K+2];C=f[K+3];O=f[K+4];M=f[K+5];I=f[K+6];R=f[K+7];N=(P-D*2+O)*.03;B=(E-C*2+M)*.03;L=((D-O)*3-P+I)*.006;F=((C-M)*3-E+R)*.006;k=N*2+L;U=B*2+F;j=(D-P)*.3+N+L*.16666667;W=(C-E)*.3+B+F*.16666667;G=Math.sqrt(j*j+W*W);z[0]=G;for(K=1;K<8;K++){j+=k;W+=U;k+=L;U+=F;G+=Math.sqrt(j*j+W*W);z[K]=G}j+=k;W+=U;G+=Math.sqrt(j*j+W*W);z[8]=G;j+=k+L;W+=U+F;G+=Math.sqrt(j*j+W*W);z[9]=G;Y=0}H*=G;for(;;Y++){var J=z[Y];if(H>J)continue;if(Y===0)H/=J;else{var q=z[Y-1];H=Y+(H-q)/(J-q)}break}this.addCurvePosition(H*.1,P,E,D,C,O,M,I,R,h,v,i)}};t.prototype.addCurvePosition=function(t,e,i,r,a,n,s,o,h,l,u,f){if(t===0){l[u]=e;l[u+1]=i;l[u+2]=0;return}if(t===1){l[u]=o;l[u+1]=h;l[u+2]=0;return}var c=1-t;var p=c*c;var d=t*t;var _=p*c;var g=p*t*3;var m=c*d*3;var y=t*d;var v=_*e+g*r+m*n+y*o;var T=_*i+g*a+m*s+y*h;l[u]=v;l[u+1]=T;if(f){l[u+2]=Math.atan2(T-(_*i+g*a+m*s),v-(_*e+g*r+m*n))}else{l[u+2]=0}};t.prototype.init=function(t,e){this._constraintData=t;this._armature=e;var i=t;this.pathOffset=i.pathDisplayData.geometry.offset;this.position=i.position;this.spacing=i.spacing;this.rotateOffset=i.rotateOffset;this.rotateMix=i.rotateMix;this.translateMix=i.translateMix;this._root=this._armature.getBone(i.root.name);this._target=this._armature.getBone(i.target.name);this._pathSlot=this._armature.getSlot(i.pathSlot.name);for(var r=0,a=i.bones.length;r<a;r++){var n=this._armature.getBone(i.bones[r].name);if(n!==null){this._bones.push(n)}}if(i.rotateMode===2){this._boneLengths.length=this._bones.length}this._root._hasConstraint=true};t.prototype.update=function(){var t=this._pathSlot;if(t._geometryData===null||t._geometryData.offset!==this.pathOffset){return}var e=this._constraintData;var i=false;if(this._root._childrenTransformDirty){this._updatePathVertices(t._geometryData);i=true}else if(t._verticesDirty||t._isBonesUpdate()){this._updatePathVertices(t._geometryData);t._verticesDirty=false;i=true}if(!i&&!this.dirty){return}var r=e.positionMode;var a=e.spacingMode;var n=e.rotateMode;var s=this._bones;var o=a===0;var h=n===2;var l=n===0;var u=s.length;var f=l?u:u+1;var c=this.spacing;var p=this._spaces;p.length=f;if(h||o){p[0]=0;for(var d=0,_=f-1;d<_;d++){var g=s[d];g.updateByConstraint();var m=g._boneData.length;var y=g.globalTransformMatrix;var v=m*y.a;var T=m*y.b;var x=Math.sqrt(v*v+T*T);if(h){this._boneLengths[d]=x}p[d+1]=(m+c)*x/m}}else{for(var d=0;d<f;d++){p[d]=c}}this._computeBezierCurve(t._displayFrame.rawDisplayData,f,l,r===1,a===2);var b=this._positions;var A=this.rotateOffset;var S=b[0],w=b[1];var P;if(A===0){P=n===1}else{P=false;var g=t.parent;if(g!==null){var y=g.globalTransformMatrix;A*=y.a*y.d-y.b*y.c>0?V.Transform.DEG_RAD:-V.Transform.DEG_RAD}}var E=this.rotateMix;var D=this.translateMix;for(var d=0,C=3;d<u;d++,C+=3){var g=s[d];g.updateByConstraint();var y=g.globalTransformMatrix;y.tx+=(S-y.tx)*D;y.ty+=(w-y.ty)*D;var v=b[C],T=b[C+1];var O=v-S,M=T-w;if(h){var I=this._boneLengths[d];var R=(Math.sqrt(O*O+M*M)/I-1)*E+1;y.a*=R;y.b*=R}S=v;w=T;if(E>0){var N=y.a,B=y.b,L=y.c,F=y.d,k=void 0,U=void 0,j=void 0;if(l){k=b[C-1]}else{k=Math.atan2(M,O)}k-=Math.atan2(B,N);if(P){U=Math.cos(k);j=Math.sin(k);var W=g._boneData.length;S+=(W*(U*N-j*B)-O)*E;w+=(W*(j*N+U*B)-M)*E}else{k+=A}if(k>V.Transform.PI){k-=V.Transform.PI_D}else if(k<-V.Transform.PI){k+=V.Transform.PI_D}k*=E;U=Math.cos(k);j=Math.sin(k);y.a=U*N-j*B;y.b=j*N+U*B;y.c=U*L-j*F;y.d=j*L+U*F}g.global.fromMatrix(y)}this.dirty=false};t.prototype.invalidUpdate=function(){};return t}(t);V.PathConstraint=i})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(t){if(t===void 0){t=0}this.time=0;this.timeScale=1;this._systemTime=0;this._animatebles=[];this._clock=null;this.time=t;this._systemTime=(new Date).getTime()*.001}t.prototype.advanceTime=function(t){if(t!==t){t=0}var e=Date.now()*.001;if(t<0){t=e-this._systemTime}this._systemTime=e;if(this.timeScale!==1){t*=this.timeScale}if(t===0){return}if(t<0){this.time-=t}else{this.time+=t}var i=0,r=0,a=this._animatebles.length;for(;i<a;++i){var n=this._animatebles[i];if(n!==null){if(r>0){this._animatebles[i-r]=n;this._animatebles[i]=null}n.advanceTime(t)}else{r++}}if(r>0){a=this._animatebles.length;for(;i<a;++i){var s=this._animatebles[i];if(s!==null){this._animatebles[i-r]=s}else{r++}}this._animatebles.length-=r}};t.prototype.contains=function(t){if(t===this){return false}var e=t;while(e!==this&&e!==null){e=e.clock}return e===this};t.prototype.add=function(t){if(this._animatebles.indexOf(t)<0){this._animatebles.push(t);t.clock=this}};t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);if(e>=0){this._animatebles[e]=null;t.clock=null}};t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];if(i!==null){i.clock=null}}};Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock===t){return}if(this._clock!==null){this._clock.remove(this)}this._clock=t;if(this._clock!==null){this._clock.add(this)}},enumerable:true,configurable:true});return t}();t.WorldClock=e})(dragonBones||(dragonBones={}));var dragonBones;(function(v){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._animationNameList=[];t._animationStates=[];t._animations={};t._blendStates={};t._animationConfig=null;return t}t.toString=function(){return"[class dragonBones.Animation]"};t.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];i.returnToPool()}for(var r in this._animations){delete this._animations[r]}for(var r in this._blendStates){var a=this._blendStates[r];for(var n in a){a[n].returnToPool()}delete this._blendStates[r]}if(this._animationConfig!==null){this._animationConfig.returnToPool()}this.timeScale=1;this._animationDirty=false;this._inheritTimeScale=1;this._animationNameList.length=0;this._animationStates.length=0;this._armature=null;this._animationConfig=null;this._lastAnimationState=null};t.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,i=this._animationStates;e<i.length;e++){var r=i[e];if(r._parent!==null){continue}if(r.layer===t.layer){r.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}break;case 2:for(var a=0,n=this._animationStates;a<n.length;a++){var r=n[a];if(r._parent!==null){continue}if(r.group===t.group){r.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}break;case 3:for(var s=0,o=this._animationStates;s<o.length;s++){var r=o[s];if(r._parent!==null){continue}if(r.layer===t.layer&&r.group===t.group){r.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}break;case 4:for(var h=0,l=this._animationStates;h<l.length;h++){var r=l[h];if(r._parent!==null){continue}r.fadeOut(t.fadeOutTime,t.pauseFadeOut)}break;case 5:default:break}};t.prototype.init=function(t){if(this._armature!==null){return}this._armature=t;this._animationConfig=v.BaseObject.borrowObject(v.AnimationConfig)};t.prototype.advanceTime=function(t){if(t<0){t=-t}if(this._armature.inheritAnimation&&this._armature._parent!==null){this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale}else{this._inheritTimeScale=this.timeScale}if(this._inheritTimeScale!==1){t*=this._inheritTimeScale}for(var e in this._blendStates){var i=this._blendStates[e];for(var r in i){i[r].reset()}}var a=this._animationStates.length;if(a===1){var n=this._animationStates[0];if(n._fadeState>0&&n._subFadeState>0){this._armature._dragonBones.bufferObject(n);this._animationStates.length=0;this._lastAnimationState=null}else{var s=n.animationData;var o=s.cacheFrameRate;if(this._animationDirty&&o>0){this._animationDirty=false;for(var h=0,l=this._armature.getBones();h<l.length;h++){var u=l[h];u._cachedFrameIndices=s.getBoneCachedFrameIndices(u.name)}for(var f=0,c=this._armature.getSlots();f<c.length;f++){var p=c[f];if(p.displayFrameCount>0){var d=p.getDisplayFrameAt(0).rawDisplayData;if(d!==null&&d.parent===this._armature.armatureData.defaultSkin){p._cachedFrameIndices=s.getSlotCachedFrameIndices(p.name);continue}}p._cachedFrameIndices=null}}n.advanceTime(t,o)}}else if(a>1){for(var _=0,g=0;_<a;++_){var n=this._animationStates[_];if(n._fadeState>0&&n._subFadeState>0){g++;this._armature._dragonBones.bufferObject(n);this._animationDirty=true;if(this._lastAnimationState===n){this._lastAnimationState=null}}else{if(g>0){this._animationStates[_-g]=n}n.advanceTime(t,0)}if(_===a-1&&g>0){this._animationStates.length-=g;if(this._lastAnimationState===null&&this._animationStates.length>0){this._lastAnimationState=this._animationStates[this._animationStates.length-1]}}}this._armature._cacheFrameIndex=-1}else{this._armature._cacheFrameIndex=-1}};t.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];i.returnToPool()}this._animationDirty=false;this._animationConfig.clear();this._animationStates.length=0;this._lastAnimationState=null};t.prototype.stop=function(t){if(t===void 0){t=null}if(t!==null){var e=this.getState(t);if(e!==null){e.stop()}}else{for(var i=0,r=this._animationStates;i<r.length;i++){var e=r[i];e.stop()}}};t.prototype.playConfig=function(t){var e=t.animation;if(!(e in this._animations)){console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+e);return null}var i=this._animations[e];if(t.fadeOutMode===5){for(var r=0,a=this._animationStates;r<a.length;r++){var n=a[r];if(n._fadeState<1&&n.layer===t.layer&&n.animationData===i){return n}}}if(this._animationStates.length===0){t.fadeInTime=0}else if(t.fadeInTime<0){t.fadeInTime=i.fadeInTime}if(t.fadeOutTime<0){t.fadeOutTime=t.fadeInTime}if(t.timeScale<=-100){t.timeScale=1/i.scale}if(i.frameCount>0){if(t.position<0){t.position%=i.duration;t.position=i.duration-t.position}else if(t.position===i.duration){t.position-=1e-6}else if(t.position>i.duration){t.position%=i.duration}if(t.duration>0&&t.position+t.duration>i.duration){t.duration=i.duration-t.position}if(t.playTimes<0){t.playTimes=i.playTimes}}else{t.playTimes=1;t.position=0;if(t.duration>0){t.duration=0}}if(t.duration===0){t.duration=-1}this._fadeOut(t);var s=v.BaseObject.borrowObject(v.AnimationState);s.init(this._armature,i,t);this._animationDirty=true;this._armature._cacheFrameIndex=-1;if(this._animationStates.length>0){var o=false;for(var h=0,l=this._animationStates.length;h<l;++h){if(s.layer>this._animationStates[h].layer){o=true;this._animationStates.splice(h,0,s);break}else if(h!==l-1&&s.layer>this._animationStates[h+1].layer){o=true;this._animationStates.splice(h+1,0,s);break}}if(!o){this._animationStates.push(s)}}else{this._animationStates.push(s)}for(var u=0,f=this._armature.getSlots();u<f.length;u++){var c=f[u];var p=c.childArmature;if(p!==null&&p.inheritAnimation&&p.animation.hasAnimation(e)&&p.animation.getState(e)===null){p.animation.fadeIn(e)}}for(var d in i.animationTimelines){var _=this.fadeIn(d,0,1,s.layer,"",5);if(_===null){continue}var g=i.animationTimelines[d];_.actionEnabled=false;_.resetToPose=false;_.stop();s.addState(_,g);var m=this._animationStates.indexOf(s);var y=this._animationStates.indexOf(_);if(y<m){this._animationStates.splice(m,1);this._animationStates.splice(y,0,s)}}this._lastAnimationState=s;return s};t.prototype.play=function(t,e){if(t===void 0){t=null}if(e===void 0){e=-1}this._animationConfig.clear();this._animationConfig.resetToPose=true;this._animationConfig.playTimes=e;this._animationConfig.fadeInTime=0;this._animationConfig.animation=t!==null?t:"";if(t!==null&&t.length>0){this.playConfig(this._animationConfig)}else if(this._lastAnimationState===null){var i=this._armature.armatureData.defaultAnimation;if(i!==null){this._animationConfig.animation=i.name;this.playConfig(this._animationConfig)}}else if(!this._lastAnimationState.isPlaying&&!this._lastAnimationState.isCompleted){this._lastAnimationState.play()}else{this._animationConfig.animation=this._lastAnimationState.name;this.playConfig(this._animationConfig)}return this._lastAnimationState};t.prototype.fadeIn=function(t,e,i,r,a,n){if(e===void 0){e=-1}if(i===void 0){i=-1}if(r===void 0){r=0}if(a===void 0){a=null}if(n===void 0){n=3}this._animationConfig.clear();this._animationConfig.fadeOutMode=n;this._animationConfig.playTimes=i;this._animationConfig.layer=r;this._animationConfig.fadeInTime=e;this._animationConfig.animation=t;this._animationConfig.group=a!==null?a:"";return this.playConfig(this._animationConfig)};t.prototype.gotoAndPlayByTime=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=-1}this._animationConfig.clear();this._animationConfig.resetToPose=true;this._animationConfig.playTimes=i;this._animationConfig.position=e;this._animationConfig.fadeInTime=0;this._animationConfig.animation=t;return this.playConfig(this._animationConfig)};t.prototype.gotoAndPlay=function(t,e,i,r){playTimes=r?1e3:1;if(t===void 0){t=null}if(playTimes===void 0){playTimes=-1}this._animationConfig.clear();this._animationConfig.resetToPose=true;this._animationConfig.playTimes=playTimes;this._animationConfig.fadeInTime=0;this._animationConfig.animation=t!==null?t:"";if(t!==null&&t.length>0){this.playConfig(this._animationConfig)}else if(this._lastAnimationState===null){var a=this._armature.armatureData.defaultAnimation;if(a!==null){this._animationConfig.animation=a.name;this.playConfig(this._animationConfig)}}else if(!this._lastAnimationState.isPlaying&&!this._lastAnimationState.isCompleted){this._lastAnimationState.play()}else{this._animationConfig.animation=this._lastAnimationState.name;this.playConfig(this._animationConfig)}return this._lastAnimationState};t.prototype.getLastAnimationName=function(){return this._lastAnimationState?this._lastAnimationState.name:null};t.prototype.getIsComplete=function(){if(this._lastAnimationState){if(!this._lastAnimationState.isComplete){return false}var t=this._animationLayer.length;while(t--){var e=this._animationLayer[t];var i=e.length;while(i--){if(!e[i].isComplete){return false}}}return true}return false};t.prototype.getIsPlaying=function(){return this.isPlaying};t.prototype.gotoAndPlayByFrame=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=-1}this._animationConfig.clear();this._animationConfig.resetToPose=true;this._animationConfig.playTimes=i;this._animationConfig.fadeInTime=0;this._animationConfig.animation=t;var r=t in this._animations?this._animations[t]:null;if(r!==null){this._animationConfig.position=r.frameCount>0?r.duration*e/r.frameCount:0}return this.playConfig(this._animationConfig)};t.prototype.gotoAndPlayByProgress=function(t,e,i){if(e===void 0){e=0}if(i===void 0){i=-1}this._animationConfig.clear();this._animationConfig.resetToPose=true;this._animationConfig.playTimes=i;this._animationConfig.fadeInTime=0;this._animationConfig.animation=t;var r=t in this._animations?this._animations[t]:null;if(r!==null){this._animationConfig.position=r.duration*(e>0?e:0)}return this.playConfig(this._animationConfig)};t.prototype.gotoAndStopByTime=function(t,e){if(e===void 0){e=0}var i=this.gotoAndPlayByTime(t,e,1);if(i!==null){i.stop()}return i};t.prototype.gotoAndStopByFrame=function(t,e){if(e===void 0){e=0}var i=this.gotoAndPlayByFrame(t,e,1);if(i!==null){i.stop()}return i};t.prototype.gotoAndStopByProgress=function(t,e){if(e===void 0){e=0}var i=this.gotoAndPlayByProgress(t,e,1);if(i!==null){i.stop()}return i};t.prototype.getBlendState=function(t,e,i){if(!(t in this._blendStates)){this._blendStates[t]={}}var r=this._blendStates[t];if(!(e in r)){var a=r[e]=v.BaseObject.borrowObject(v.BlendState);a.target=i}return r[e]};t.prototype.getState=function(t,e){if(e===void 0){e=-1}var i=this._animationStates.length;while(i--){var r=this._animationStates[i];if(r.name===t&&(e<0||r.layer===e)){return r}}return null};t.prototype.hasAnimation=function(t){return t in this._animations};t.prototype.getStates=function(){return this._animationStates};Object.defineProperty(t.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];if(i.isPlaying){return true}}return false},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];if(!i.isCompleted){return false}}return this._animationStates.length>0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"lastAnimationName",{get:function(){return this._lastAnimationState!==null?this._lastAnimationState.name:""},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationNameList",{get:function(){return this._animationNameList},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations===t){return}this._animationNameList.length=0;for(var e in this._animations){delete this._animations[e]}for(var e in t){this._animationNameList.push(e);this._animations[e]=t[e]}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationConfig",{get:function(){this._animationConfig.clear();return this._animationConfig},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:true,configurable:true});return t}(v.BaseObject);v.Animation=t})(dragonBones||(dragonBones={}));var dragonBones;(function(U){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._boneMask=[];t._boneTimelines=[];t._boneBlendTimelines=[];t._slotTimelines=[];t._slotBlendTimelines=[];t._constraintTimelines=[];t._animationTimelines=[];t._poseTimelines=[];t._actionTimeline=null;t._zOrderTimeline=null;return t}t.toString=function(){return"[class dragonBones.AnimationState]"};t.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++){var i=e[t];i.returnToPool()}for(var r=0,a=this._boneBlendTimelines;r<a.length;r++){var i=a[r];i.returnToPool()}for(var n=0,s=this._slotTimelines;n<s.length;n++){var i=s[n];i.returnToPool()}for(var o=0,h=this._slotBlendTimelines;o<h.length;o++){var i=h[o];i.returnToPool()}for(var l=0,u=this._constraintTimelines;l<u.length;l++){var i=u[l];i.returnToPool()}for(var f=0,c=this._animationTimelines;f<c.length;f++){var i=c[f];var p=i.target;if(p._parent===this){p._fadeState=1;p._subFadeState=1;p._parent=null}i.returnToPool()}if(this._actionTimeline!==null){this._actionTimeline.returnToPool()}if(this._zOrderTimeline!==null){this._zOrderTimeline.returnToPool()}this.actionEnabled=false;this.additive=false;this.displayControl=false;this.resetToPose=false;this.blendType=0;this.playTimes=1;this.layer=0;this.timeScale=1;this._weight=1;this.parameterX=0;this.parameterY=0;this.positionX=0;this.positionY=0;this.autoFadeOutTime=0;this.fadeTotalTime=0;this.name="";this.group="";this._timelineDirty=2;this._playheadState=0;this._fadeState=-1;this._subFadeState=-1;this._position=0;this._duration=0;this._fadeTime=0;this._time=0;this._fadeProgress=0;this._weightResult=0;this._boneMask.length=0;this._boneTimelines.length=0;this._boneBlendTimelines.length=0;this._slotTimelines.length=0;this._slotBlendTimelines.length=0;this._constraintTimelines.length=0;this._animationTimelines.length=0;this._poseTimelines.length=0;this._animationData=null;this._armature=null;this._actionTimeline=null;this._zOrderTimeline=null;this._activeChildA=null;this._activeChildB=null;this._parent=null};t.prototype._updateTimelines=function(){{for(var t=0,e=this._armature._constraints;t<e.length;t++){var i=e[t];var r=this._animationData.getConstraintTimelines(i.name);if(r!==null){for(var a=0,n=r;a<n.length;a++){var s=n[a];switch(s.type){case 30:{var o=U.BaseObject.borrowObject(U.IKConstraintTimelineState);o.target=i;o.init(this._armature,this,s);this._constraintTimelines.push(o);break}default:break}}}else if(this.resetToPose){var o=U.BaseObject.borrowObject(U.IKConstraintTimelineState);o.target=i;o.init(this._armature,this,null);this._constraintTimelines.push(o);this._poseTimelines.push(o)}}}};t.prototype._updateBoneAndSlotTimelines=function(){{var t={};for(var e=0,i=this._boneTimelines;e<i.length;e++){var r=i[e];var a=r.target.target.name;if(!(a in t)){t[a]=[]}t[a].push(r)}for(var n=0,s=this._boneBlendTimelines;n<s.length;n++){var r=s[n];var a=r.target.target.name;if(!(a in t)){t[a]=[]}t[a].push(r)}for(var o=0,h=this._armature.getBones();o<h.length;o++){var l=h[o];var a=l.name;if(!this.containsBoneMask(a)){continue}if(a in t){delete t[a]}else{var u=this._animationData.getBoneTimelines(a);var f=this._armature.animation.getBlendState(j.BONE_TRANSFORM,l.name,l);if(u!==null){for(var c=0,p=u;c<p.length;c++){var d=p[c];switch(d.type){case 10:{var r=U.BaseObject.borrowObject(U.BoneAllTimelineState);r.target=f;r.init(this._armature,this,d);this._boneTimelines.push(r);break}case 11:{var r=U.BaseObject.borrowObject(U.BoneTranslateTimelineState);r.target=f;r.init(this._armature,this,d);this._boneTimelines.push(r);break}case 12:{var r=U.BaseObject.borrowObject(U.BoneRotateTimelineState);r.target=f;r.init(this._armature,this,d);this._boneTimelines.push(r);break}case 13:{var r=U.BaseObject.borrowObject(U.BoneScaleTimelineState);r.target=f;r.init(this._armature,this,d);this._boneTimelines.push(r);break}case 60:{var r=U.BaseObject.borrowObject(U.AlphaTimelineState);r.target=this._armature.animation.getBlendState(j.BONE_ALPHA,l.name,l);r.init(this._armature,this,d);this._boneBlendTimelines.push(r);break}case 50:{var r=U.BaseObject.borrowObject(U.SurfaceTimelineState);r.target=this._armature.animation.getBlendState(j.SURFACE,l.name,l);r.init(this._armature,this,d);this._boneBlendTimelines.push(r);break}default:break}}}else if(this.resetToPose){if(l._boneData.type===0){var r=U.BaseObject.borrowObject(U.BoneAllTimelineState);r.target=f;r.init(this._armature,this,null);this._boneTimelines.push(r);this._poseTimelines.push(r)}else{var r=U.BaseObject.borrowObject(U.SurfaceTimelineState);r.target=this._armature.animation.getBlendState(j.SURFACE,l.name,l);r.init(this._armature,this,null);this._boneBlendTimelines.push(r);this._poseTimelines.push(r)}}}}for(var _ in t){for(var g=0,m=t[_];g<m.length;g++){var r=m[g];var y=this._boneTimelines.indexOf(r);if(y>=0){this._boneTimelines.splice(y,1);r.returnToPool()}y=this._boneBlendTimelines.indexOf(r);if(y>=0){this._boneBlendTimelines.splice(y,1);r.returnToPool()}}}}{var v={};var T=[];for(var x=0,b=this._slotTimelines;x<b.length;x++){var r=b[x];var a=r.target.name;if(!(a in v)){v[a]=[]}v[a].push(r)}for(var A=0,S=this._slotBlendTimelines;A<S.length;A++){var r=S[A];var a=r.target.target.name;if(!(a in v)){v[a]=[]}v[a].push(r)}for(var w=0,P=this._armature.getSlots();w<P.length;w++){var E=P[w];var D=E.parent.name;if(!this.containsBoneMask(D)){continue}var a=E.name;if(a in v){delete v[a]}else{var C=false;var O=false;T.length=0;var u=this._animationData.getSlotTimelines(a);if(u!==null){for(var M=0,I=u;M<I.length;M++){var d=I[M];switch(d.type){case 20:{var r=U.BaseObject.borrowObject(U.SlotDislayTimelineState);r.target=E;r.init(this._armature,this,d);this._slotTimelines.push(r);C=true;break}case 23:{var r=U.BaseObject.borrowObject(U.SlotZIndexTimelineState);r.target=this._armature.animation.getBlendState(j.SLOT_Z_INDEX,E.name,E);r.init(this._armature,this,d);this._slotBlendTimelines.push(r);break}case 21:{var r=U.BaseObject.borrowObject(U.SlotColorTimelineState);r.target=E;r.init(this._armature,this,d);this._slotTimelines.push(r);O=true;break}case 22:{var r=U.BaseObject.borrowObject(U.DeformTimelineState);r.target=this._armature.animation.getBlendState(j.SLOT_DEFORM,E.name,E);r.init(this._armature,this,d);if(r.target!==null){this._slotBlendTimelines.push(r);T.push(r.geometryOffset)}else{r.returnToPool()}break}case 24:{var r=U.BaseObject.borrowObject(U.AlphaTimelineState);r.target=this._armature.animation.getBlendState(j.SLOT_ALPHA,E.name,E);r.init(this._armature,this,d);this._slotBlendTimelines.push(r);break}default:break}}}if(this.resetToPose){if(!C){var r=U.BaseObject.borrowObject(U.SlotDislayTimelineState);r.target=E;r.init(this._armature,this,null);this._slotTimelines.push(r);this._poseTimelines.push(r)}if(!O){var r=U.BaseObject.borrowObject(U.SlotColorTimelineState);r.target=E;r.init(this._armature,this,null);this._slotTimelines.push(r);this._poseTimelines.push(r)}for(var R=0,N=E.displayFrameCount;R<N;++R){var B=E.getDisplayFrameAt(R);if(B.deformVertices.length===0){continue}var L=B.getGeometryData();if(L!==null&&T.indexOf(L.offset)<0){var r=U.BaseObject.borrowObject(U.DeformTimelineState);r.geometryOffset=L.offset;r.displayFrame=B;r.target=this._armature.animation.getBlendState(j.SLOT_DEFORM,E.name,E);r.init(this._armature,this,null);this._slotBlendTimelines.push(r);this._poseTimelines.push(r)}}}}}for(var _ in v){for(var F=0,k=v[_];F<k.length;F++){var r=k[F];var y=this._slotTimelines.indexOf(r);if(y>=0){this._slotTimelines.splice(y,1);r.returnToPool()}y=this._slotBlendTimelines.indexOf(r);if(y>=0){this._slotBlendTimelines.splice(y,1);r.returnToPool()}}}}};t.prototype._advanceFadeTime=function(t){var e=this._fadeState>0;if(this._subFadeState<0){this._subFadeState=0;var i=this._parent===null&&this.actionEnabled;if(i){var r=e?U.EventObject.FADE_OUT:U.EventObject.FADE_IN;if(this._armature.eventDispatcher.hasDBEventListener(r)){var a=U.BaseObject.borrowObject(U.EventObject);a.type=r;a.armature=this._armature;a.animationState=this;this._armature._dragonBones.bufferEvent(a)}}}if(t<0){t=-t}this._fadeTime+=t;if(this._fadeTime>=this.fadeTotalTime){this._subFadeState=1;this._fadeProgress=e?0:1}else if(this._fadeTime>0){this._fadeProgress=e?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime}else{this._fadeProgress=e?1:0}if(this._subFadeState>0){if(!e){this._playheadState|=1;this._fadeState=0}var i=this._parent===null&&this.actionEnabled;if(i){var r=e?U.EventObject.FADE_OUT_COMPLETE:U.EventObject.FADE_IN_COMPLETE;if(this._armature.eventDispatcher.hasDBEventListener(r)){var a=U.BaseObject.borrowObject(U.EventObject);a.type=r;a.armature=this._armature;a.animationState=this;this._armature._dragonBones.bufferEvent(a)}}}};t.prototype.init=function(t,e,i){if(this._armature!==null){return}this._armature=t;this._animationData=e;this.resetToPose=i.resetToPose;this.additive=i.additive;this.displayControl=i.displayControl;this.actionEnabled=i.actionEnabled;this.blendType=e.blendType;this.layer=i.layer;this.playTimes=i.playTimes;this.timeScale=i.timeScale;this.fadeTotalTime=i.fadeInTime;this.autoFadeOutTime=i.autoFadeOutTime;this.name=i.name.length>0?i.name:i.animation;this.group=i.group;this._weight=i.weight;if(i.pauseFadeIn){this._playheadState=2}else{this._playheadState=3}if(i.duration<0){this._position=0;this._duration=this._animationData.duration;if(i.position!==0){if(this.timeScale>=0){this._time=i.position}else{this._time=i.position-this._duration}}else{this._time=0}}else{this._position=i.position;this._duration=i.duration;this._time=0}if(this.timeScale<0&&this._time===0){this._time=-1e-6}if(this.fadeTotalTime<=0){this._fadeProgress=.999999}if(i.boneMask.length>0){this._boneMask.length=i.boneMask.length;for(var r=0,a=this._boneMask.length;r<a;++r){this._boneMask[r]=i.boneMask[r]}}this._actionTimeline=U.BaseObject.borrowObject(U.ActionTimelineState);this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline);this._actionTimeline.currentTime=this._time;if(this._actionTimeline.currentTime<0){this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime}if(this._animationData.zOrderTimeline!==null){this._zOrderTimeline=U.BaseObject.borrowObject(U.ZOrderTimelineState);this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline)}};t.prototype.advanceTime=function(t,e){if(this._fadeState!==0||this._subFadeState!==0){this._advanceFadeTime(t)}if(this._playheadState===3){if(this.timeScale!==1){t*=this.timeScale}this._time+=t}if(this._timelineDirty!==0){if(this._timelineDirty===2){this._updateTimelines()}this._timelineDirty=0;this._updateBoneAndSlotTimelines()}var i=this._fadeState!==0||this._subFadeState===0;var r=this._fadeState===0&&e>0;var a=true;var n=true;var s=this._time;this._weightResult=this._weight*this._fadeProgress;if(this._parent!==null){this._weightResult*=this._parent._weightResult}if(this._actionTimeline.playState<=0){this._actionTimeline.update(s)}if(this._weight===0){return}if(r){var o=e*2;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*o)/o}if(this._zOrderTimeline!==null&&this._zOrderTimeline.playState<=0){this._zOrderTimeline.update(s)}if(r){var h=Math.floor(this._actionTimeline.currentTime*e);if(this._armature._cacheFrameIndex===h){a=false;n=false}else{this._armature._cacheFrameIndex=h;if(this._animationData.cachedFrames[h]){n=false}else{this._animationData.cachedFrames[h]=true}}}if(a){var l=false;var u=null;if(n){for(var f=0,c=this._boneTimelines.length;f<c;++f){var p=this._boneTimelines[f];if(p.playState<=0){p.update(s)}if(p.target!==u){var d=p.target;l=d.update(this);u=d;if(d.dirty===1){var _=d.target.animationPose;_.x=0;_.y=0;_.rotation=0;_.skew=0;_.scaleX=1;_.scaleY=1}}if(l){p.blend(i)}}}for(var f=0,c=this._boneBlendTimelines.length;f<c;++f){var p=this._boneBlendTimelines[f];if(p.playState<=0){p.update(s)}if(p.target.update(this)){p.blend(i)}}if(this.displayControl){for(var f=0,c=this._slotTimelines.length;f<c;++f){var p=this._slotTimelines[f];if(p.playState<=0){var g=p.target;var m=g.displayController;if(m===null||m===this.name||m===this.group){p.update(s)}}}}for(var f=0,c=this._slotBlendTimelines.length;f<c;++f){var p=this._slotBlendTimelines[f];if(p.playState<=0){var d=p.target;p.update(s);if(d.update(this)){p.blend(i)}}}for(var f=0,c=this._constraintTimelines.length;f<c;++f){var p=this._constraintTimelines[f];if(p.playState<=0){p.update(s)}}if(this._animationTimelines.length>0){var y=100;var v=100;var T=null;var x=null;for(var f=0,c=this._animationTimelines.length;f<c;++f){var p=this._animationTimelines[f];if(p.playState<=0){p.update(s)}if(this.blendType===1){var b=p.target;var A=this.parameterX-b.positionX;if(A>=0){if(A<y){y=A;T=b}}else{if(-A<v){v=-A;x=b}}}}if(T!==null){if(this._activeChildA!==T){if(this._activeChildA!==null){this._activeChildA.weight=0}this._activeChildA=T;this._activeChildA.activeTimeline()}if(this._activeChildB!==x){if(this._activeChildB!==null){this._activeChildB.weight=0}this._activeChildB=x}T.weight=v/(y+v);if(x){x.weight=1-T.weight}}}}if(this._fadeState===0){if(this._subFadeState>0){this._subFadeState=0;if(this._poseTimelines.length>0){for(var S=0,w=this._poseTimelines;S<w.length;S++){var p=w[S];var P=this._boneTimelines.indexOf(p);if(P>=0){this._boneTimelines.splice(P,1);p.returnToPool();continue}P=this._boneBlendTimelines.indexOf(p);if(P>=0){this._boneBlendTimelines.splice(P,1);p.returnToPool();continue}P=this._slotTimelines.indexOf(p);if(P>=0){this._slotTimelines.splice(P,1);p.returnToPool();continue}P=this._slotBlendTimelines.indexOf(p);if(P>=0){this._slotBlendTimelines.splice(P,1);p.returnToPool();continue}P=this._constraintTimelines.indexOf(p);if(P>=0){this._constraintTimelines.splice(P,1);p.returnToPool();continue}}this._poseTimelines.length=0}}if(this._actionTimeline.playState>0){if(this.autoFadeOutTime>=0){this.fadeOut(this.autoFadeOutTime)}}}};t.prototype.play=function(){this._playheadState=3};t.prototype.stop=function(){this._playheadState&=1};t.prototype.fadeOut=function(t,e){if(e===void 0){e=true}if(t<0){t=0}if(e){this._playheadState&=2}if(this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime){return}}else{this._fadeState=1;this._subFadeState=-1;if(t<=0||this._fadeProgress<=0){this._fadeProgress=1e-6}for(var i=0,r=this._boneTimelines;i<r.length;i++){var a=r[i];a.fadeOut()}for(var n=0,s=this._boneBlendTimelines;n<s.length;n++){var a=s[n];a.fadeOut()}for(var o=0,h=this._slotTimelines;o<h.length;o++){var a=h[o];a.fadeOut()}for(var l=0,u=this._slotBlendTimelines;l<u.length;l++){var a=u[l];a.fadeOut()}for(var f=0,c=this._constraintTimelines;f<c.length;f++){var a=c[f];a.fadeOut()}for(var p=0,d=this._animationTimelines;p<d.length;p++){var a=d[p];a.fadeOut();var _=a.target;_.fadeOut(999999,true)}}this.displayControl=false;this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0;this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)};t.prototype.containsBoneMask=function(t){return this._boneMask.length===0||this._boneMask.indexOf(t)>=0};t.prototype.addBoneMask=function(t,e){if(e===void 0){e=true}var i=this._armature.getBone(t);if(i===null){return}if(this._boneMask.indexOf(t)<0){this._boneMask.push(t)}if(e){for(var r=0,a=this._armature.getBones();r<a.length;r++){var n=a[r];if(this._boneMask.indexOf(n.name)<0&&i.contains(n)){this._boneMask.push(n.name)}}}this._timelineDirty=1};t.prototype.removeBoneMask=function(t,e){if(e===void 0){e=true}var i=this._boneMask.indexOf(t);if(i>=0){this._boneMask.splice(i,1)}if(e){var r=this._armature.getBone(t);if(r!==null){var a=this._armature.getBones();if(this._boneMask.length>0){for(var n=0,s=a;n<s.length;n++){var o=s[n];var h=this._boneMask.indexOf(o.name);if(h>=0&&r.contains(o)){this._boneMask.splice(h,1)}}}else{for(var l=0,u=a;l<u.length;l++){var o=u[l];if(o===r){continue}if(!r.contains(o)){this._boneMask.push(o.name)}}}}}this._timelineDirty=1};t.prototype.removeAllBoneMask=function(){this._boneMask.length=0;this._timelineDirty=1};t.prototype.addState=function(t,e){if(e===void 0){e=null}if(e!==null){for(var i=0,r=e;i<r.length;i++){var a=r[i];switch(a.type){case 40:{var n=U.BaseObject.borrowObject(U.AnimationProgressTimelineState);n.target=t;n.init(this._armature,this,a);this._animationTimelines.push(n);if(this.blendType!==0){var s=a;t.positionX=s.x;t.positionY=s.y;t.weight=0}t._parent=this;this.resetToPose=false;break}case 41:{var n=U.BaseObject.borrowObject(U.AnimationWeightTimelineState);n.target=t;n.init(this._armature,this,a);this._animationTimelines.push(n);break}case 42:{var n=U.BaseObject.borrowObject(U.AnimationParametersTimelineState);n.target=t;n.init(this._armature,this,a);this._animationTimelines.push(n);break}default:break}}}if(t._parent===null){t._parent=this}};t.prototype.activeTimeline=function(){for(var t=0,e=this._slotTimelines;t<e.length;t++){var i=e[t];i.dirty=true;i.currentTime=-1}};Object.defineProperty(t.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isFadeComplete",{get:function(){return this._fadeState===0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isPlaying",{get:function(){return(this._playheadState&2)!==0&&this._actionTimeline.playState<=0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"totalTime",{get:function(){return this._duration},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if(t<0||this._duration<t){t=t%this._duration+e*this._duration;if(t<0){t+=this._duration}}if(this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&this._parent===null){t=this._duration-1e-6}if(this._time===t){return}this._time=t;this._actionTimeline.setCurrentTime(this._time);if(this._zOrderTimeline!==null){this._zOrderTimeline.playState=-1}for(var i=0,r=this._boneTimelines;i<r.length;i++){var a=r[i];a.playState=-1}for(var n=0,s=this._slotTimelines;n<s.length;n++){var a=s[n];a.playState=-1}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"weight",{get:function(){return this._weight},set:function(t){if(this._weight===t){return}this._weight=t;for(var e=0,i=this._boneTimelines;e<i.length;e++){var r=i[e];r.dirty=true}for(var a=0,n=this._boneBlendTimelines;a<n.length;a++){var r=n[a];r.dirty=true}for(var s=0,o=this._slotBlendTimelines;s<o.length;s++){var r=o[s];r.dirty=true}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationData",{get:function(){return this._animationData},enumerable:true,configurable:true});return t}(U.BaseObject);U.AnimationState=t;var j=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.toString=function(){return"[class dragonBones.BlendState]"};e.prototype._onClear=function(){this.reset();this.target=null};e.prototype.update=function(t){var e=t.layer;var i=t._weightResult;if(this.dirty>0){if(this.leftWeight>0){if(this.layer!==e){if(this.layerWeight>=this.leftWeight){this.dirty++;this.layer=e;this.leftWeight=0;this.blendWeight=0;return false}this.layer=e;this.leftWeight-=this.layerWeight;this.layerWeight=0}i*=this.leftWeight;this.dirty++;this.blendWeight=i;this.layerWeight+=this.blendWeight;return true}return false}this.dirty++;this.layer=e;this.leftWeight=1;this.blendWeight=i;this.layerWeight=i;return true};e.prototype.reset=function(){this.dirty=0;this.layer=0;this.leftWeight=0;this.layerWeight=0;this.blendWeight=0};e.BONE_TRANSFORM="boneTransform";e.BONE_ALPHA="boneAlpha";e.SURFACE="surface";e.SLOT_DEFORM="slotDeform";e.SLOT_ALPHA="slotAlpha";e.SLOT_Z_INDEX="slotZIndex";return e}(U.BaseObject);U.BlendState=j})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype._onClear=function(){this.dirty=false;this.playState=-1;this.currentPlayTimes=-1;this.currentTime=-1;this.target=null;this._isTween=false;this._valueOffset=0;this._frameValueOffset=0;this._frameOffset=0;this._frameRate=0;this._frameCount=0;this._frameIndex=-1;this._frameRateR=0;this._position=0;this._duration=0;this._timeScale=1;this._timeOffset=0;this._animationData=null;this._timelineData=null;this._armature=null;this._animationState=null;this._actionTimeline=null;this._frameArray=null;this._valueArray=null;this._timelineArray=null;this._frameIndices=null};e.prototype._setCurrentTime=function(t){var e=this.playState;var i=this.currentPlayTimes;var r=this.currentTime;if(this._actionTimeline!==null&&this._frameCount<=1){this.playState=this._actionTimeline.playState>=0?1:-1;this.currentPlayTimes=1;this.currentTime=this._actionTimeline.currentTime}else if(this._actionTimeline===null||this._timeScale!==1||this._timeOffset!==0){var a=this._animationState.playTimes;var n=a*this._duration;t*=this._timeScale;if(this._timeOffset!==0){t+=this._timeOffset*this._animationData.duration}if(a>0&&(t>=n||t<=-n)){if(this.playState<=0&&this._animationState._playheadState===3){this.playState=1}this.currentPlayTimes=a;if(t<0){this.currentTime=0}else{this.currentTime=this._duration+1e-6}}else{if(this.playState!==0&&this._animationState._playheadState===3){this.playState=0}if(t<0){t=-t;this.currentPlayTimes=Math.floor(t/this._duration);this.currentTime=this._duration-t%this._duration}else{this.currentPlayTimes=Math.floor(t/this._duration);this.currentTime=t%this._duration}}this.currentTime+=this._position}else{this.playState=this._actionTimeline.playState;this.currentPlayTimes=this._actionTimeline.currentPlayTimes;this.currentTime=this._actionTimeline.currentTime}if(this.currentPlayTimes===i&&this.currentTime===r){return false}if(e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==i){this._frameIndex=-1}return true};e.prototype.init=function(t,e,i){this._armature=t;this._animationState=e;this._timelineData=i;this._actionTimeline=this._animationState._actionTimeline;if(this===this._actionTimeline){this._actionTimeline=null}this._animationData=this._animationState.animationData;this._frameRate=this._animationData.parent.frameRate;this._frameRateR=1/this._frameRate;this._position=this._animationState._position;this._duration=this._animationState._duration;if(this._timelineData!==null){var r=this._animationData.parent.parent;this._frameArray=r.frameArray;this._timelineArray=r.timelineArray;this._frameIndices=r.frameIndices;this._frameCount=this._timelineArray[this._timelineData.offset+2];this._frameValueOffset=this._timelineArray[this._timelineData.offset+4];this._timeScale=100/this._timelineArray[this._timelineData.offset+0];this._timeOffset=this._timelineArray[this._timelineData.offset+1]*.01}};e.prototype.fadeOut=function(){this.dirty=false};e.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate);var i=this._frameIndices[this._timelineData.frameIndicesOffset+e];if(this._frameIndex!==i){this._frameIndex=i;this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex];this._onArriveAtFrame()}}else if(this._frameIndex<0){this._frameIndex=0;if(this._timelineData!==null){this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]}this._onArriveAtFrame()}if(this._isTween||this.dirty){this._onUpdateFrame()}}};e.prototype.blend=function(t){};return e}(t.BaseObject);t.TimelineState=e;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e._getEasingValue=function(t,e,i){var r=e;switch(t){case 3:r=Math.pow(e,2);break;case 4:r=1-Math.pow(1-e,2);break;case 5:r=.5*(1-Math.cos(e*Math.PI));break}return(r-e)*i+e};e._getEasingCurveValue=function(t,e,i,r){if(t<=0){return 0}else if(t>=1){return 1}var a=i>0;var n=i+1;var s=Math.floor(t*n);var o=0;var h=0;if(a){o=s===0?0:e[r+s-1];h=s===n-1?1e4:e[r+s]}else{o=e[r+s-1];h=e[r+s]}return(o+(h-o)*(t*n-s))*1e-4};e.prototype._onClear=function(){t.prototype._onClear.call(this);this._tweenType=0;this._curveCount=0;this._framePosition=0;this._frameDurationR=0;this._tweenEasing=0;this._tweenProgress=0;this._valueScale=1};e.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||this._animationState.playTimes===0||this._animationState.currentPlayTimes<this._animationState.playTimes-1)){this._tweenType=this._frameArray[this._frameOffset+1];this._isTween=this._tweenType!==0;if(this._isTween){if(this._tweenType===2){this._curveCount=this._frameArray[this._frameOffset+2]}else if(this._tweenType!==0&&this._tweenType!==1){this._tweenEasing=this._frameArray[this._frameOffset+2]*.01}}else{this.dirty=true}this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR;if(this._frameIndex===this._frameCount-1){this._frameDurationR=1/(this._animationData.duration-this._framePosition)}else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1];var e=this._frameArray[t]*this._frameRateR-this._framePosition;if(e>0){this._frameDurationR=1/e}else{this._frameDurationR=0}}}else{this.dirty=true;this._isTween=false}};e.prototype._onUpdateFrame=function(){if(this._isTween){this.dirty=true;this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR;if(this._tweenType===2){this._tweenProgress=e._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3)}else if(this._tweenType!==1){this._tweenProgress=e._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing)}}};return e}(e);t.TweenTimelineState=i;var r=function(a){__extends(t,a);function t(){return a!==null&&a.apply(this,arguments)||this}t.prototype._onClear=function(){a.prototype._onClear.call(this);this._current=0;this._difference=0;this._result=0};t.prototype._onArriveAtFrame=function(){a.prototype._onArriveAtFrame.call(this);if(this._timelineData!==null){var t=this._valueScale;var e=this._valueArray;var i=this._valueOffset+this._frameValueOffset+this._frameIndex;if(this._isTween){var r=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:i+1;if(t===1){this._current=e[i];this._difference=e[r]-this._current}else{this._current=e[i]*t;this._difference=e[r]*t-this._current}}else{this._result=e[i]*t}}else{this._result=0}};t.prototype._onUpdateFrame=function(){a.prototype._onUpdateFrame.call(this);if(this._isTween){this._result=this._current+this._difference*this._tweenProgress}};return t}(i);t.SingleValueTimelineState=r;var a=function(a){__extends(t,a);function t(){return a!==null&&a.apply(this,arguments)||this}t.prototype._onClear=function(){a.prototype._onClear.call(this);this._currentA=0;this._currentB=0;this._differenceA=0;this._differenceB=0;this._resultA=0;this._resultB=0};t.prototype._onArriveAtFrame=function(){a.prototype._onArriveAtFrame.call(this);if(this._timelineData!==null){var t=this._valueScale;var e=this._valueArray;var i=this._valueOffset+this._frameValueOffset+this._frameIndex*2;if(this._isTween){var r=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:i+2;if(t===1){this._currentA=e[i];this._currentB=e[i+1];this._differenceA=e[r]-this._currentA;this._differenceB=e[r+1]-this._currentB}else{this._currentA=e[i]*t;this._currentB=e[i+1]*t;this._differenceA=e[r]*t-this._currentA;this._differenceB=e[r+1]*t-this._currentB}}else{this._resultA=e[i]*t;this._resultB=e[i+1]*t}}else{this._resultA=0;this._resultB=0}};t.prototype._onUpdateFrame=function(){a.prototype._onUpdateFrame.call(this);if(this._isTween){this._resultA=this._currentA+this._differenceA*this._tweenProgress;this._resultB=this._currentB+this._differenceB*this._tweenProgress}};return t}(i);t.DoubleValueTimelineState=a;var n=function(o){__extends(t,o);function t(){var t=o!==null&&o.apply(this,arguments)||this;t._rd=[];return t}t.prototype._onClear=function(){o.prototype._onClear.call(this);this._valueCount=0;this._rd.length=0};t.prototype._onArriveAtFrame=function(){o.prototype._onArriveAtFrame.call(this);var t=this._valueCount;var e=this._rd;if(this._timelineData!==null){var i=this._valueScale;var r=this._valueArray;var a=this._valueOffset+this._frameValueOffset+this._frameIndex*t;if(this._isTween){var n=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:a+t;if(i===1){for(var s=0;s<t;++s){e[t+s]=r[n+s]-r[a+s]}}else{for(var s=0;s<t;++s){e[t+s]=(r[n+s]-r[a+s])*i}}}else if(i===1){for(var s=0;s<t;++s){e[s]=r[a+s]}}else{for(var s=0;s<t;++s){e[s]=r[a+s]*i}}}else{for(var s=0;s<t;++s){e[s]=0}}};t.prototype._onUpdateFrame=function(){o.prototype._onUpdateFrame.call(this);if(this._isTween){var t=this._valueCount;var e=this._valueScale;var i=this._tweenProgress;var r=this._valueArray;var a=this._rd;var n=this._valueOffset+this._frameValueOffset+this._frameIndex*t;if(e===1){for(var s=0;s<t;++s){a[s]=r[n+s]+a[t+s]*i}}else{for(var s=0;s<t;++s){a[s]=r[n+s]*e+a[t+s]*i}}}};return t}(i);t.MutilpleValueTimelineState=n})(dragonBones||(dragonBones={}));var dragonBones;(function(m){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.toString=function(){return"[class dragonBones.ActionTimelineState]"};e.prototype._onCrossFrame=function(t){var e=this._armature.eventDispatcher;if(this._animationState.actionEnabled){var i=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+t];var r=this._frameArray[i+1];var a=this._animationData.parent.actions;for(var n=0;n<r;++n){var s=this._frameArray[i+2+n];var o=a[s];if(o.type===0){var h=m.BaseObject.borrowObject(m.EventObject);h.time=this._frameArray[i]/this._frameRate;h.animationState=this._animationState;m.EventObject.actionDataToInstance(o,h,this._armature);this._armature._bufferAction(h,true)}else{var l=o.type===10?m.EventObject.FRAME_EVENT:m.EventObject.SOUND_EVENT;if(o.type===11||e.hasDBEventListener(l)){var h=m.BaseObject.borrowObject(m.EventObject);h.time=this._frameArray[i]/this._frameRate;h.animationState=this._animationState;m.EventObject.actionDataToInstance(o,h,this._armature);this._armature._dragonBones.bufferEvent(h)}}}}};e.prototype._onArriveAtFrame=function(){};e.prototype._onUpdateFrame=function(){};e.prototype.update=function(t){var e=this.playState;var i=this.currentPlayTimes;var r=this.currentTime;if(this._setCurrentTime(t)){var a=this._animationState._parent===null&&this._animationState.actionEnabled;var n=this._armature.eventDispatcher;if(e<0){if(this.playState!==e){if(this._animationState.displayControl&&this._animationState.resetToPose){this._armature._sortZOrder(null,0)}i=this.currentPlayTimes;if(a&&n.hasDBEventListener(m.EventObject.START)){var s=m.BaseObject.borrowObject(m.EventObject);s.type=m.EventObject.START;s.armature=this._armature;s.animationState=this._animationState;this._armature._dragonBones.bufferEvent(s)}}else{return}}var o=this._animationState.timeScale<0;var h=null;var l=null;if(a&&this.currentPlayTimes!==i){if(n.hasDBEventListener(m.EventObject.LOOP_COMPLETE)){h=m.BaseObject.borrowObject(m.EventObject);h.type=m.EventObject.LOOP_COMPLETE;h.armature=this._armature;h.animationState=this._animationState}if(this.playState>0){if(n.hasDBEventListener(m.EventObject.COMPLETE)){l=m.BaseObject.borrowObject(m.EventObject);l.type=m.EventObject.COMPLETE;l.armature=this._armature;l.animationState=this._animationState}}}if(this._frameCount>1){var u=this._timelineData;var f=Math.floor(this.currentTime*this._frameRate);var c=this._frameIndices[u.frameIndicesOffset+f];if(this._frameIndex!==c){var p=this._frameIndex;this._frameIndex=c;if(this._timelineArray!==null){this._frameOffset=this._animationData.frameOffset+this._timelineArray[u.offset+5+this._frameIndex];if(o){if(p<0){var d=Math.floor(r*this._frameRate);p=this._frameIndices[u.frameIndicesOffset+d];if(this.currentPlayTimes===i){if(p===c){p=-1}}}while(p>=0){var _=this._animationData.frameOffset+this._timelineArray[u.offset+5+p];var g=this._frameArray[_]/this._frameRate;if(this._position<=g&&g<=this._position+this._duration){this._onCrossFrame(p)}if(h!==null&&p===0){this._armature._dragonBones.bufferEvent(h);h=null}if(p>0){p--}else{p=this._frameCount-1}if(p===c){break}}}else{if(p<0){var d=Math.floor(r*this._frameRate);p=this._frameIndices[u.frameIndicesOffset+d];var _=this._animationData.frameOffset+this._timelineArray[u.offset+5+p];var g=this._frameArray[_]/this._frameRate;if(this.currentPlayTimes===i){if(r<=g){if(p>0){p--}else{p=this._frameCount-1}}else if(p===c){p=-1}}}while(p>=0){if(p<this._frameCount-1){p++}else{p=0}var _=this._animationData.frameOffset+this._timelineArray[u.offset+5+p];var g=this._frameArray[_]/this._frameRate;if(this._position<=g&&g<=this._position+this._duration){this._onCrossFrame(p)}if(h!==null&&p===0){this._armature._dragonBones.bufferEvent(h);h=null}if(p===c){break}}}}}}else if(this._frameIndex<0){this._frameIndex=0;if(this._timelineData!==null){this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5];var g=this._frameArray[this._frameOffset]/this._frameRate;if(this.currentPlayTimes===i){if(r<=g){this._onCrossFrame(this._frameIndex)}}else if(this._position<=g){if(!o&&h!==null){this._armature._dragonBones.bufferEvent(h);h=null}this._onCrossFrame(this._frameIndex)}}}if(h!==null){this._armature.eventDispatcher.dispatchDBEvent(h.type,h)}if(l!==null){this._armature.eventDispatcher.dispatchDBEvent(l.type,l)}}};e.prototype.setCurrentTime=function(t){this._setCurrentTime(t);this._frameIndex=-1};return e}(m.TimelineState);m.ActionTimelineState=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"};e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=this._frameArray[this._frameOffset+1];if(t>0){this._armature._sortZOrder(this._frameArray,this._frameOffset+2)}else{this._armature._sortZOrder(null,0)}}};e.prototype._onUpdateFrame=function(){};return e}(m.TimelineState);m.ZOrderTimelineState=e;var i=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.BoneAllTimelineState]"};t.prototype._onArriveAtFrame=function(){r.prototype._onArriveAtFrame.call(this);if(this._isTween&&this._frameIndex===this._frameCount-1){this._rd[2]=m.Transform.normalizeRadian(this._rd[2]);this._rd[3]=m.Transform.normalizeRadian(this._rd[3])}if(this._timelineData===null){this._rd[4]=1;this._rd[5]=1}};t.prototype.init=function(t,e,i){r.prototype.init.call(this,t,e,i);this._valueOffset=this._animationData.frameFloatOffset;this._valueCount=6;this._valueArray=this._animationData.parent.parent.frameFloatArray};t.prototype.fadeOut=function(){this.dirty=false;this._rd[2]=m.Transform.normalizeRadian(this._rd[2]);this._rd[3]=m.Transform.normalizeRadian(this._rd[3])};t.prototype.blend=function(t){var e=this._armature.armatureData.scale;var i=this._rd;var r=this.target;var a=r.target;var n=r.blendWeight;var s=a.animationPose;if(r.dirty>1){s.x+=i[0]*n*e;s.y+=i[1]*n*e;s.rotation+=i[2]*n;s.skew+=i[3]*n;s.scaleX+=(i[4]-1)*n;s.scaleY+=(i[5]-1)*n}else{s.x=i[0]*n*e;s.y=i[1]*n*e;s.rotation=i[2]*n;s.skew=i[3]*n;s.scaleX=(i[4]-1)*n+1;s.scaleY=(i[5]-1)*n+1}if(t||this.dirty){this.dirty=false;a._transformDirty=true}};return t}(m.MutilpleValueTimelineState);m.BoneAllTimelineState=i;var r=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"};t.prototype.init=function(t,e,i){r.prototype.init.call(this,t,e,i);this._valueOffset=this._animationData.frameFloatOffset;this._valueScale=this._armature.armatureData.scale;this._valueArray=this._animationData.parent.parent.frameFloatArray};t.prototype.blend=function(t){var e=this.target;var i=e.target;var r=e.blendWeight;var a=i.animationPose;if(e.dirty>1){a.x+=this._resultA*r;a.y+=this._resultB*r}else if(r!==1){a.x=this._resultA*r;a.y=this._resultB*r}else{a.x=this._resultA;a.y=this._resultB}if(t||this.dirty){this.dirty=false;i._transformDirty=true}};return t}(m.DoubleValueTimelineState);m.BoneTranslateTimelineState=r;var a=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"};t.prototype._onArriveAtFrame=function(){r.prototype._onArriveAtFrame.call(this);if(this._isTween&&this._frameIndex===this._frameCount-1){this._differenceA=m.Transform.normalizeRadian(this._differenceA);this._differenceB=m.Transform.normalizeRadian(this._differenceB)}};t.prototype.init=function(t,e,i){r.prototype.init.call(this,t,e,i);this._valueOffset=this._animationData.frameFloatOffset;this._valueArray=this._animationData.parent.parent.frameFloatArray};t.prototype.fadeOut=function(){this.dirty=false;this._resultA=m.Transform.normalizeRadian(this._resultA);this._resultB=m.Transform.normalizeRadian(this._resultB)};t.prototype.blend=function(t){var e=this.target;var i=e.target;var r=e.blendWeight;var a=i.animationPose;if(e.dirty>1){a.rotation+=this._resultA*r;a.skew+=this._resultB*r}else if(r!==1){a.rotation=this._resultA*r;a.skew=this._resultB*r}else{a.rotation=this._resultA;a.skew=this._resultB}if(t||this.dirty){this.dirty=false;i._transformDirty=true}};return t}(m.DoubleValueTimelineState);m.BoneRotateTimelineState=a;var n=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"};t.prototype._onArriveAtFrame=function(){r.prototype._onArriveAtFrame.call(this);if(this._timelineData===null){this._resultA=1;this._resultB=1}};t.prototype.init=function(t,e,i){r.prototype.init.call(this,t,e,i);this._valueOffset=this._animationData.frameFloatOffset;this._valueArray=this._animationData.parent.parent.frameFloatArray};t.prototype.blend=function(t){var e=this.target;var i=e.target;var r=e.blendWeight;var a=i.animationPose;if(e.dirty>1){a.scaleX+=(this._resultA-1)*r;a.scaleY+=(this._resultB-1)*r}else if(r!==1){a.scaleX=(this._resultA-1)*r+1;a.scaleY=(this._resultB-1)*r+1}else{a.scaleX=this._resultA;a.scaleY=this._resultB}if(t||this.dirty){this.dirty=false;i._transformDirty=true}};return t}(m.DoubleValueTimelineState);m.BoneScaleTimelineState=n;var s=function(s){__extends(t,s);function t(){return s!==null&&s.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.SurfaceTimelineState]"};t.prototype._onClear=function(){s.prototype._onClear.call(this);this._deformCount=0;this._deformOffset=0;this._sameValueOffset=0};t.prototype.init=function(t,e,i){s.prototype.init.call(this,t,e,i);if(this._timelineData!==null){var r=this._animationData.parent.parent;var a=r.frameIntArray;var n=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._valueOffset=this._animationData.frameFloatOffset;this._valueCount=a[n+2];this._deformCount=a[n+1];this._deformOffset=a[n+3];this._sameValueOffset=a[n+4]+this._animationData.frameFloatOffset;this._valueScale=this._armature.armatureData.scale;this._valueArray=r.frameFloatArray;this._rd.length=this._valueCount*2}else{this._deformCount=this.target.target._deformVertices.length}};t.prototype.blend=function(t){var e=this.target;var i=e.target;var r=e.blendWeight;var a=i._deformVertices;var n=this._valueArray;if(n!==null){var s=this._valueCount;var o=this._deformOffset;var h=this._sameValueOffset;var l=this._rd;for(var u=0;u<this._deformCount;++u){var f=0;if(u<o){f=n[h+u]}else if(u<o+s){f=l[u-o]}else{f=n[h+u-s]}if(e.dirty>1){a[u]+=f*r}else{a[u]=f*r}}}else if(e.dirty===1){for(var u=0;u<this._deformCount;++u){a[u]=0}}if(t||this.dirty){this.dirty=false;i._transformDirty=true}};return t}(m.MutilpleValueTimelineState);m.SurfaceTimelineState=s;var o=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.AlphaTimelineState]"};t.prototype._onArriveAtFrame=function(){r.prototype._onArriveAtFrame.call(this);if(this._timelineData===null){this._result=1}};t.prototype.init=function(t,e,i){r.prototype.init.call(this,t,e,i);this._valueOffset=this._animationData.frameIntOffset;this._valueScale=.01;this._valueArray=this._animationData.parent.parent.frameIntArray};t.prototype.blend=function(t){var e=this.target;var i=e.target;var r=e.blendWeight;if(e.dirty>1){i._alpha+=this._result*r;if(i._alpha>1){i._alpha=1}}else{i._alpha=this._result*r}if(t||this.dirty){this.dirty=false;this._armature._alphaDirty=true}};return t}(m.SingleValueTimelineState);m.AlphaTimelineState=o;var h=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"};e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=this.target;var e=this._timelineData!==null?this._frameArray[this._frameOffset+1]:t._slotData.displayIndex;if(t.displayIndex!==e){t._setDisplayIndex(e,true)}}};e.prototype._onUpdateFrame=function(){};return e}(m.TimelineState);m.SlotDislayTimelineState=h;var l=function(o){__extends(t,o);function t(){var t=o!==null&&o.apply(this,arguments)||this;t._current=[0,0,0,0,0,0,0,0];t._difference=[0,0,0,0,0,0,0,0];t._result=[0,0,0,0,0,0,0,0];return t}t.toString=function(){return"[class dragonBones.SlotColorTimelineState]"};t.prototype._onArriveAtFrame=function(){o.prototype._onArriveAtFrame.call(this);if(this._timelineData!==null){var t=this._animationData.parent.parent;var e=t.colorArray;var i=t.frameIntArray;var r=this._animationData.frameIntOffset+this._frameValueOffset+this._frameIndex;var a=i[r];if(a<0){a+=65536}if(this._isTween){this._current[0]=e[a++];this._current[1]=e[a++];this._current[2]=e[a++];this._current[3]=e[a++];this._current[4]=e[a++];this._current[5]=e[a++];this._current[6]=e[a++];this._current[7]=e[a++];if(this._frameIndex===this._frameCount-1){a=i[this._animationData.frameIntOffset+this._frameValueOffset]}else{a=i[r+1]}if(a<0){a+=65536}this._difference[0]=e[a++]-this._current[0];this._difference[1]=e[a++]-this._current[1];this._difference[2]=e[a++]-this._current[2];this._difference[3]=e[a++]-this._current[3];this._difference[4]=e[a++]-this._current[4];this._difference[5]=e[a++]-this._current[5];this._difference[6]=e[a++]-this._current[6];this._difference[7]=e[a++]-this._current[7]}else{this._result[0]=e[a++]*.01;this._result[1]=e[a++]*.01;this._result[2]=e[a++]*.01;this._result[3]=e[a++]*.01;this._result[4]=e[a++];this._result[5]=e[a++];this._result[6]=e[a++];this._result[7]=e[a++]}}else{var n=this.target;var s=n.slotData.color;this._result[0]=s.alphaMultiplier;this._result[1]=s.redMultiplier;this._result[2]=s.greenMultiplier;this._result[3]=s.blueMultiplier;this._result[4]=s.alphaOffset;this._result[5]=s.redOffset;this._result[6]=s.greenOffset;this._result[7]=s.blueOffset}};t.prototype._onUpdateFrame=function(){o.prototype._onUpdateFrame.call(this);if(this._isTween){this._result[0]=(this._current[0]+this._difference[0]*this._tweenProgress)*.01;this._result[1]=(this._current[1]+this._difference[1]*this._tweenProgress)*.01;this._result[2]=(this._current[2]+this._difference[2]*this._tweenProgress)*.01;this._result[3]=(this._current[3]+this._difference[3]*this._tweenProgress)*.01;this._result[4]=this._current[4]+this._difference[4]*this._tweenProgress;this._result[5]=this._current[5]+this._difference[5]*this._tweenProgress;this._result[6]=this._current[6]+this._difference[6]*this._tweenProgress;this._result[7]=this._current[7]+this._difference[7]*this._tweenProgress}};t.prototype.fadeOut=function(){this._isTween=false};t.prototype.update=function(t){o.prototype.update.call(this,t);if(this._isTween||this.dirty){var e=this.target;var i=e._colorTransform;if(this._animationState._fadeState!==0||this._animationState._subFadeState!==0){if(i.alphaMultiplier!==this._result[0]||i.redMultiplier!==this._result[1]||i.greenMultiplier!==this._result[2]||i.blueMultiplier!==this._result[3]||i.alphaOffset!==this._result[4]||i.redOffset!==this._result[5]||i.greenOffset!==this._result[6]||i.blueOffset!==this._result[7]){var r=Math.pow(this._animationState._fadeProgress,4);i.alphaMultiplier+=(this._result[0]-i.alphaMultiplier)*r;i.redMultiplier+=(this._result[1]-i.redMultiplier)*r;i.greenMultiplier+=(this._result[2]-i.greenMultiplier)*r;i.blueMultiplier+=(this._result[3]-i.blueMultiplier)*r;i.alphaOffset+=(this._result[4]-i.alphaOffset)*r;i.redOffset+=(this._result[5]-i.redOffset)*r;i.greenOffset+=(this._result[6]-i.greenOffset)*r;i.blueOffset+=(this._result[7]-i.blueOffset)*r;e._colorDirty=true}}else if(this.dirty){this.dirty=false;if(i.alphaMultiplier!==this._result[0]||i.redMultiplier!==this._result[1]||i.greenMultiplier!==this._result[2]||i.blueMultiplier!==this._result[3]||i.alphaOffset!==this._result[4]||i.redOffset!==this._result[5]||i.greenOffset!==this._result[6]||i.blueOffset!==this._result[7]){i.alphaMultiplier=this._result[0];i.redMultiplier=this._result[1];i.greenMultiplier=this._result[2];i.blueMultiplier=this._result[3];i.alphaOffset=this._result[4];i.redOffset=this._result[5];i.greenOffset=this._result[6];i.blueOffset=this._result[7];e._colorDirty=true}}}};return t}(m.TweenTimelineState);m.SlotColorTimelineState=l;var u=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.SlotZIndexTimelineState]"};t.prototype._onArriveAtFrame=function(){r.prototype._onArriveAtFrame.call(this);if(this._timelineData===null){var t=this.target;var e=t.target;this._result=e.slotData.zIndex}};t.prototype.init=function(t,e,i){r.prototype.init.call(this,t,e,i);this._valueOffset=this._animationData.frameIntOffset;this._valueArray=this._animationData.parent.parent.frameIntArray};t.prototype.blend=function(t){var e=this.target;var i=e.target;var r=e.blendWeight;if(e.dirty>1){i._zIndex+=this._result*r}else{i._zIndex=this._result*r}if(t||this.dirty){this.dirty=false;this._armature._zIndexDirty=true}};return t}(m.SingleValueTimelineState);m.SlotZIndexTimelineState=u;var f=function(f){__extends(t,f);function t(){return f!==null&&f.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.DeformTimelineState]"};t.prototype._onClear=function(){f.prototype._onClear.call(this);this.geometryOffset=0;this.displayFrame=null;this._deformCount=0;this._deformOffset=0;this._sameValueOffset=0};t.prototype.init=function(t,e,i){f.prototype.init.call(this,t,e,i);if(this._timelineData!==null){var r=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];var a=this._animationData.parent.parent;var n=a.frameIntArray;var s=this.target.target;this.geometryOffset=n[r+0];if(this.geometryOffset<0){this.geometryOffset+=65536}for(var o=0,h=s.displayFrameCount;o<h;++o){var l=s.getDisplayFrameAt(o);var u=l.getGeometryData();if(u===null){continue}if(u.offset===this.geometryOffset){this.displayFrame=l;this.displayFrame.updateDeformVertices();break}}if(this.displayFrame===null){this.returnToPool();return}this._valueOffset=this._animationData.frameFloatOffset;this._valueCount=n[r+2];this._deformCount=n[r+1];this._deformOffset=n[r+3];this._sameValueOffset=n[r+4]+this._animationData.frameFloatOffset;this._valueScale=this._armature.armatureData.scale;this._valueArray=a.frameFloatArray;this._rd.length=this._valueCount*2}else{this._deformCount=this.displayFrame.deformVertices.length}};t.prototype.blend=function(t){var e=this.target;var i=e.target;var r=e.blendWeight;var a=this.displayFrame.deformVertices;var n=this._valueArray;if(n!==null){var s=this._valueCount;var o=this._deformOffset;var h=this._sameValueOffset;var l=this._rd;for(var u=0;u<this._deformCount;++u){var f=0;if(u<o){f=n[h+u]}else if(u<o+s){f=l[u-o]}else{f=n[h+u-s]}if(e.dirty>1){a[u]+=f*r}else{a[u]=f*r}}}else if(e.dirty===1){for(var u=0;u<this._deformCount;++u){a[u]=0}}if(t||this.dirty){this.dirty=false;if(i._geometryData===this.displayFrame.getGeometryData()){i._verticesDirty=true}}};return t}(m.MutilpleValueTimelineState);m.DeformTimelineState=f;var c=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"};t.prototype._onUpdateFrame=function(){r.prototype._onUpdateFrame.call(this);var t=this.target;if(this._timelineData!==null){t._bendPositive=this._currentA>0;t._weight=this._currentB}else{var e=t._constraintData;t._bendPositive=e.bendPositive;t._weight=e.weight}t.invalidUpdate();this.dirty=false};t.prototype.init=function(t,e,i){r.prototype.init.call(this,t,e,i);this._valueOffset=this._animationData.frameIntOffset;this._valueScale=.01;this._valueArray=this._animationData.parent.parent.frameIntArray};return t}(m.DoubleValueTimelineState);m.IKConstraintTimelineState=c;var p=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.AnimationProgressTimelineState]"};t.prototype._onUpdateFrame=function(){r.prototype._onUpdateFrame.call(this);var t=this.target;if(t._parent!==null){t.currentTime=this._result*t.totalTime}this.dirty=false};t.prototype.init=function(t,e,i){r.prototype.init.call(this,t,e,i);this._valueOffset=this._animationData.frameIntOffset;this._valueScale=1e-4;this._valueArray=this._animationData.parent.parent.frameIntArray};return t}(m.SingleValueTimelineState);m.AnimationProgressTimelineState=p;var d=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.AnimationWeightTimelineState]"};t.prototype._onUpdateFrame=function(){r.prototype._onUpdateFrame.call(this);var t=this.target;if(t._parent!==null){t.weight=this._result}this.dirty=false};t.prototype.init=function(t,e,i){r.prototype.init.call(this,t,e,i);this._valueOffset=this._animationData.frameIntOffset;this._valueScale=1e-4;this._valueArray=this._animationData.parent.parent.frameIntArray};return t}(m.SingleValueTimelineState);m.AnimationWeightTimelineState=d;var _=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.toString=function(){return"[class dragonBones.AnimationParametersTimelineState]"};t.prototype._onUpdateFrame=function(){r.prototype._onUpdateFrame.call(this);var t=this.target;if(t._parent!==null){t.parameterX=this._resultA;t.parameterY=this._resultB}this.dirty=false};t.prototype.init=function(t,e,i){r.prototype.init.call(this,t,e,i);this._valueOffset=this._animationData.frameIntOffset;this._valueScale=1e-4;this._valueArray=this._animationData.parent.parent.frameIntArray};return t}(m.DoubleValueTimelineState);m.AnimationParametersTimelineState=_})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.actionDataToInstance=function(t,e,i){if(t.type===0){e.type=r.FRAME_EVENT}else{e.type=t.type===10?r.FRAME_EVENT:r.SOUND_EVENT}e.name=t.name;e.armature=i;e.actionData=t;e.data=t.data;if(t.bone!==null){e.bone=i.getBone(t.bone.name)}if(t.slot!==null){e.slot=i.getSlot(t.slot.name)}};r.toString=function(){return"[class dragonBones.EventObject]"};r.prototype._onClear=function(){this.time=0;this.type="";this.name="";this.armature=null;this.bone=null;this.slot=null;this.animationState=null;this.actionData=null;this.data=null};r.START="start";r.LOOP_COMPLETE="loopComplete";r.COMPLETE="complete";r.FADE_IN="fadeIn";r.FADE_IN_COMPLETE="fadeInComplete";r.FADE_OUT="fadeOut";r.FADE_OUT_COMPLETE="fadeOutComplete";r.FRAME_EVENT="frameEvent";r.SOUND_EVENT="soundEvent";return r}(t.BaseObject);t.EventObject=e})(dragonBones||(dragonBones={}));var dragonBones;(function(t){var e=function(){function t(){}t._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}};t._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}};t._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}};t._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}};t._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0}};t._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}};t._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}};t._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}};t._getAnimationBlendType=function(t){switch(t.toLowerCase()){case"none":return 0;case"1d":return 1;default:return 0}};t._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}};t.DATA_VERSION_2_3="2.3";t.DATA_VERSION_3_0="3.0";t.DATA_VERSION_4_0="4.0";t.DATA_VERSION_4_5="4.5";t.DATA_VERSION_5_0="5.0";t.DATA_VERSION_5_5="5.5";t.DATA_VERSION_5_6="5.6";t.DATA_VERSION=t.DATA_VERSION_5_6;t.DATA_VERSIONS=[t.DATA_VERSION_4_0,t.DATA_VERSION_4_5,t.DATA_VERSION_5_0,t.DATA_VERSION_5_5,t.DATA_VERSION_5_6];t.TEXTURE_ATLAS="textureAtlas";t.SUB_TEXTURE="SubTexture";t.FORMAT="format";t.IMAGE_PATH="imagePath";t.WIDTH="width";t.HEIGHT="height";t.ROTATED="rotated";t.FRAME_X="frameX";t.FRAME_Y="frameY";t.FRAME_WIDTH="frameWidth";t.FRAME_HEIGHT="frameHeight";t.DRADON_BONES="dragonBones";t.USER_DATA="userData";t.ARMATURE="armature";t.CANVAS="canvas";t.BONE="bone";t.SURFACE="surface";t.SLOT="slot";t.CONSTRAINT="constraint";t.SKIN="skin";t.DISPLAY="display";t.FRAME="frame";t.IK="ik";t.PATH_CONSTRAINT="path";t.ANIMATION="animation";t.TIMELINE="timeline";t.FFD="ffd";t.TRANSLATE_FRAME="translateFrame";t.ROTATE_FRAME="rotateFrame";t.SCALE_FRAME="scaleFrame";t.DISPLAY_FRAME="displayFrame";t.COLOR_FRAME="colorFrame";t.DEFAULT_ACTIONS="defaultActions";t.ACTIONS="actions";t.EVENTS="events";t.INTS="ints";t.FLOATS="floats";t.STRINGS="strings";t.TRANSFORM="transform";t.PIVOT="pivot";t.AABB="aabb";t.COLOR="color";t.VERSION="version";t.COMPATIBLE_VERSION="compatibleVersion";t.FRAME_RATE="frameRate";t.TYPE="type";t.SUB_TYPE="subType";t.NAME="name";t.PARENT="parent";t.TARGET="target";t.STAGE="stage";t.SHARE="share";t.PATH="path";t.LENGTH="length";t.DISPLAY_INDEX="displayIndex";t.Z_ORDER="zOrder";t.Z_INDEX="zIndex";t.BLEND_MODE="blendMode";t.INHERIT_TRANSLATION="inheritTranslation";t.INHERIT_ROTATION="inheritRotation";t.INHERIT_SCALE="inheritScale";t.INHERIT_REFLECTION="inheritReflection";t.INHERIT_ANIMATION="inheritAnimation";t.INHERIT_DEFORM="inheritDeform";t.SEGMENT_X="segmentX";t.SEGMENT_Y="segmentY";t.BEND_POSITIVE="bendPositive";t.CHAIN="chain";t.WEIGHT="weight";t.BLEND_TYPE="blendType";t.FADE_IN_TIME="fadeInTime";t.PLAY_TIMES="playTimes";t.SCALE="scale";t.OFFSET="offset";t.POSITION="position";t.DURATION="duration";t.TWEEN_EASING="tweenEasing";t.TWEEN_ROTATE="tweenRotate";t.TWEEN_SCALE="tweenScale";t.CLOCK_WISE="clockwise";t.CURVE="curve";t.SOUND="sound";t.EVENT="event";t.ACTION="action";t.X="x";t.Y="y";t.SKEW_X="skX";t.SKEW_Y="skY";t.SCALE_X="scX";t.SCALE_Y="scY";t.VALUE="value";t.ROTATE="rotate";t.SKEW="skew";t.ALPHA="alpha";t.ALPHA_OFFSET="aO";t.RED_OFFSET="rO";t.GREEN_OFFSET="gO";t.BLUE_OFFSET="bO";t.ALPHA_MULTIPLIER="aM";t.RED_MULTIPLIER="rM";t.GREEN_MULTIPLIER="gM";t.BLUE_MULTIPLIER="bM";t.UVS="uvs";t.VERTICES="vertices";t.TRIANGLES="triangles";t.WEIGHTS="weights";t.SLOT_POSE="slotPose";t.BONE_POSE="bonePose";t.BONES="bones";t.POSITION_MODE="positionMode";t.SPACING_MODE="spacingMode";t.ROTATE_MODE="rotateMode";t.SPACING="spacing";t.ROTATE_OFFSET="rotateOffset";t.ROTATE_MIX="rotateMix";t.TRANSLATE_MIX="translateMix";t.TARGET_DISPLAY="targetDisplay";t.CLOSED="closed";t.CONSTANT_SPEED="constantSpeed";t.VERTEX_COUNT="vertexCount";t.LENGTHS="lengths";t.GOTO_AND_PLAY="gotoAndPlay";t.DEFAULT_NAME="default";return t}();t.DataParser=e})(dragonBones||(dragonBones={}));var dragonBones;(function(tt){var t=function(e){__extends($,e);function $(){var t=e!==null&&e.apply(this,arguments)||this;t._rawTextureAtlasIndex=0;t._rawBones=[];t._data=null;t._armature=null;t._bone=null;t._geometry=null;t._slot=null;t._skin=null;t._mesh=null;t._animation=null;t._timeline=null;t._rawTextureAtlases=null;t._frameValueType=0;t._defaultColorOffset=-1;t._prevClockwise=0;t._prevRotation=0;t._frameDefaultValue=0;t._frameValueScale=1;t._helpMatrixA=new tt.Matrix;t._helpMatrixB=new tt.Matrix;t._helpTransform=new tt.Transform;t._helpColorTransform=new tt.ColorTransform;t._helpPoint=new tt.Point;t._helpArray=[];t._intArray=[];t._floatArray=[];t._frameIntArray=[];t._frameFloatArray=[];t._frameArray=[];t._timelineArray=[];t._colorArray=[];t._cacheRawMeshes=[];t._cacheMeshes=[];t._actionFrames=[];t._weightSlotPose={};t._weightBonePoses={};t._cacheBones={};t._slotChildActions={};return t}$._getBoolean=function(t,e,i){if(e in t){var r=t[e];var a=typeof r;if(a==="boolean"){return r}else if(a==="string"){switch(r){case"0":case"NaN":case"":case"false":case"null":case"undefined":return false;default:return true}}else{return!!r}}return i};$._getNumber=function(t,e,i){if(e in t){var r=t[e];if(r===null||r==="NaN"){return i}return+r||0}return i};$._getString=function(t,e,i){if(e in t){var r=t[e];var a=typeof r;if(a==="string"){return r}return String(r)}return i};$.prototype._getCurvePoint=function(t,e,i,r,a,n,s,o,h,l){var u=1-h;var f=u*u;var c=h*h;var p=u*f;var d=3*h*f;var _=3*u*c;var g=h*c;l.x=p*t+d*i+_*a+g*s;l.y=p*e+d*r+_*n+g*o};$.prototype._samplingEasingCurve=function(t,e){var i=t.length;if(i%3===1){var r=-2;for(var a=0,n=e.length;a<n;++a){var s=(a+1)/(n+1);while((r+6<i?t[r+6]:1)<s){r+=6}var o=r>=0&&r+6<i;var h=o?t[r]:0;var l=o?t[r+1]:0;var u=t[r+2];var f=t[r+3];var c=t[r+4];var p=t[r+5];var d=o?t[r+6]:1;var _=o?t[r+7]:1;var g=0;var m=1;while(m-g>1e-4){var y=(m+g)*.5;this._getCurvePoint(h,l,u,f,c,p,d,_,y,this._helpPoint);if(s-this._helpPoint.x>0){g=y}else{m=y}}e[a]=this._helpPoint.y}return true}else{var r=0;for(var a=0,n=e.length;a<n;++a){var s=(a+1)/(n+1);while(t[r+6]<s){r+=6}var h=t[r];var l=t[r+1];var u=t[r+2];var f=t[r+3];var c=t[r+4];var p=t[r+5];var d=t[r+6];var _=t[r+7];var g=0;var m=1;while(m-g>1e-4){var y=(m+g)*.5;this._getCurvePoint(h,l,u,f,c,p,d,_,y,this._helpPoint);if(s-this._helpPoint.x>0){g=y}else{m=y}}e[a]=this._helpPoint.y}return false}};$.prototype._parseActionDataInFrame=function(t,e,i,r){if(tt.DataParser.EVENT in t){this._mergeActionFrame(t[tt.DataParser.EVENT],e,10,i,r)}if(tt.DataParser.SOUND in t){this._mergeActionFrame(t[tt.DataParser.SOUND],e,11,i,r)}if(tt.DataParser.ACTION in t){this._mergeActionFrame(t[tt.DataParser.ACTION],e,0,i,r)}if(tt.DataParser.EVENTS in t){this._mergeActionFrame(t[tt.DataParser.EVENTS],e,10,i,r)}if(tt.DataParser.ACTIONS in t){this._mergeActionFrame(t[tt.DataParser.ACTIONS],e,0,i,r)}};$.prototype._mergeActionFrame=function(t,e,i,r,a){var n=this._armature.actions.length;var s=this._parseActionData(t,i,r,a);var o=0;var h=null;for(var l=0,u=s;l<u.length;l++){var f=u[l];this._armature.addAction(f,false)}if(this._actionFrames.length===0){h=new T;h.frameStart=0;this._actionFrames.push(h);h=null}for(var c=0,p=this._actionFrames;c<p.length;c++){var d=p[c];if(d.frameStart===e){h=d;break}else if(d.frameStart>e){break}o++}if(h===null){h=new T;h.frameStart=e;this._actionFrames.splice(o,0,h)}for(var _=0;_<s.length;++_){h.actions.push(n+_)}};$.prototype._parseArmature=function(t,e){var i=tt.BaseObject.borrowObject(tt.ArmatureData);i.name=$._getString(t,tt.DataParser.NAME,"");i.frameRate=$._getNumber(t,tt.DataParser.FRAME_RATE,this._data.frameRate);i.scale=e;if(tt.DataParser.TYPE in t&&typeof t[tt.DataParser.TYPE]==="string"){i.type=tt.DataParser._getArmatureType(t[tt.DataParser.TYPE])}else{i.type=$._getNumber(t,tt.DataParser.TYPE,0)}if(i.frameRate===0){i.frameRate=24}this._armature=i;if(tt.DataParser.CANVAS in t){var r=t[tt.DataParser.CANVAS];var a=tt.BaseObject.borrowObject(tt.CanvasData);if(tt.DataParser.COLOR in r){a.hasBackground=true}else{a.hasBackground=false}a.color=$._getNumber(r,tt.DataParser.COLOR,0);a.x=$._getNumber(r,tt.DataParser.X,0)*i.scale;a.y=$._getNumber(r,tt.DataParser.Y,0)*i.scale;a.width=$._getNumber(r,tt.DataParser.WIDTH,0)*i.scale;a.height=$._getNumber(r,tt.DataParser.HEIGHT,0)*i.scale;i.canvas=a}if(tt.DataParser.AABB in t){var n=t[tt.DataParser.AABB];i.aabb.x=$._getNumber(n,tt.DataParser.X,0)*i.scale;i.aabb.y=$._getNumber(n,tt.DataParser.Y,0)*i.scale;i.aabb.width=$._getNumber(n,tt.DataParser.WIDTH,0)*i.scale;i.aabb.height=$._getNumber(n,tt.DataParser.HEIGHT,0)*i.scale}if(tt.DataParser.BONE in t){var s=t[tt.DataParser.BONE];for(var o=0,h=s;o<h.length;o++){var l=h[o];var u=$._getString(l,tt.DataParser.PARENT,"");var f=this._parseBone(l);if(u.length>0){var c=i.getBone(u);if(c!==null){f.parent=c}else{if(!(u in this._cacheBones)){this._cacheBones[u]=[]}this._cacheBones[u].push(f)}}if(f.name in this._cacheBones){for(var p=0,d=this._cacheBones[f.name];p<d.length;p++){var _=d[p];_.parent=f}delete this._cacheBones[f.name]}i.addBone(f);this._rawBones.push(f)}}if(tt.DataParser.IK in t){var g=t[tt.DataParser.IK];for(var m=0,y=g;m<y.length;m++){var v=y[m];var T=this._parseIKConstraint(v);if(T){i.addConstraint(T)}}}i.sortBones();if(tt.DataParser.SLOT in t){var x=0;var b=t[tt.DataParser.SLOT];for(var A=0,S=b;A<S.length;A++){var w=S[A];i.addSlot(this._parseSlot(w,x++))}}if(tt.DataParser.SKIN in t){var P=t[tt.DataParser.SKIN];for(var E=0,D=P;E<D.length;E++){var C=D[E];i.addSkin(this._parseSkin(C))}}if(tt.DataParser.PATH_CONSTRAINT in t){var O=t[tt.DataParser.PATH_CONSTRAINT];for(var M=0,I=O;M<I.length;M++){var R=I[M];var T=this._parsePathConstraint(R);if(T){i.addConstraint(T)}}}for(var N=0,B=this._cacheRawMeshes.length;N<B;++N){var L=this._cacheRawMeshes[N];var F=$._getString(L,tt.DataParser.SHARE,"");if(F.length===0){continue}var k=$._getString(L,tt.DataParser.SKIN,tt.DataParser.DEFAULT_NAME);if(k.length===0){k=tt.DataParser.DEFAULT_NAME}var U=i.getMesh(k,"",F);if(U===null){continue}var j=this._cacheMeshes[N];j.geometry.shareFrom(U.geometry)}if(tt.DataParser.ANIMATION in t){var W=t[tt.DataParser.ANIMATION];for(var V=0,z=W;V<z.length;V++){var G=z[V];var Y=this._parseAnimation(G);i.addAnimation(Y)}}if(tt.DataParser.DEFAULT_ACTIONS in t){var H=this._parseActionData(t[tt.DataParser.DEFAULT_ACTIONS],0,null,null);for(var X=0,q=H;X<q.length;X++){var K=q[X];i.addAction(K,true);if(K.type===0){var Y=i.getAnimation(K.name);if(Y!==null){i.defaultAnimation=Y}}}}if(tt.DataParser.ACTIONS in t){var H=this._parseActionData(t[tt.DataParser.ACTIONS],0,null,null);for(var J=0,Z=H;J<Z.length;J++){var K=Z[J];i.addAction(K,false)}}this._rawBones.length=0;this._cacheRawMeshes.length=0;this._cacheMeshes.length=0;this._armature=null;for(var Q in this._weightSlotPose){delete this._weightSlotPose[Q]}for(var Q in this._weightBonePoses){delete this._weightBonePoses[Q]}for(var Q in this._cacheBones){delete this._cacheBones[Q]}for(var Q in this._slotChildActions){delete this._slotChildActions[Q]}return i};$.prototype._parseBone=function(t){var e=0;if(tt.DataParser.TYPE in t&&typeof t[tt.DataParser.TYPE]==="string"){e=tt.DataParser._getBoneType(t[tt.DataParser.TYPE])}else{e=$._getNumber(t,tt.DataParser.TYPE,0)}if(e===0){var i=this._armature.scale;var r=tt.BaseObject.borrowObject(tt.BoneData);r.inheritTranslation=$._getBoolean(t,tt.DataParser.INHERIT_TRANSLATION,true);r.inheritRotation=$._getBoolean(t,tt.DataParser.INHERIT_ROTATION,true);r.inheritScale=$._getBoolean(t,tt.DataParser.INHERIT_SCALE,true);r.inheritReflection=$._getBoolean(t,tt.DataParser.INHERIT_REFLECTION,true);r.length=$._getNumber(t,tt.DataParser.LENGTH,0)*i;r.alpha=$._getNumber(t,tt.DataParser.ALPHA,1);r.name=$._getString(t,tt.DataParser.NAME,"");if(tt.DataParser.TRANSFORM in t){this._parseTransform(t[tt.DataParser.TRANSFORM],r.transform,i)}return r}var a=tt.BaseObject.borrowObject(tt.SurfaceData);a.alpha=$._getNumber(t,tt.DataParser.ALPHA,1);a.name=$._getString(t,tt.DataParser.NAME,"");a.segmentX=$._getNumber(t,tt.DataParser.SEGMENT_X,0);a.segmentY=$._getNumber(t,tt.DataParser.SEGMENT_Y,0);this._parseGeometry(t,a.geometry);return a};$.prototype._parseIKConstraint=function(t){var e=this._armature.getBone($._getString(t,tt.DataParser.BONE,""));if(e===null){return null}var i=this._armature.getBone($._getString(t,tt.DataParser.TARGET,""));if(i===null){return null}var r=$._getNumber(t,tt.DataParser.CHAIN,0);var a=tt.BaseObject.borrowObject(tt.IKConstraintData);a.scaleEnabled=$._getBoolean(t,tt.DataParser.SCALE,false);a.bendPositive=$._getBoolean(t,tt.DataParser.BEND_POSITIVE,true);a.weight=$._getNumber(t,tt.DataParser.WEIGHT,1);a.name=$._getString(t,tt.DataParser.NAME,"");a.type=0;a.target=i;if(r>0&&e.parent!==null){a.root=e.parent;a.bone=e}else{a.root=e;a.bone=null}return a};$.prototype._parsePathConstraint=function(t){var e=this._armature.getSlot($._getString(t,tt.DataParser.TARGET,""));if(e===null){return null}var i=this._armature.defaultSkin;if(i===null){return null}var r=i.getDisplay(e.name,$._getString(t,tt.DataParser.TARGET_DISPLAY,e.name));if(r===null||!(r instanceof tt.PathDisplayData)){return null}var a=t[tt.DataParser.BONES];if(a===null||a.length===0){return null}var n=tt.BaseObject.borrowObject(tt.PathConstraintData);n.name=$._getString(t,tt.DataParser.NAME,"");n.type=1;n.pathSlot=e;n.pathDisplayData=r;n.target=e.parent;n.positionMode=tt.DataParser._getPositionMode($._getString(t,tt.DataParser.POSITION_MODE,""));n.spacingMode=tt.DataParser._getSpacingMode($._getString(t,tt.DataParser.SPACING_MODE,""));n.rotateMode=tt.DataParser._getRotateMode($._getString(t,tt.DataParser.ROTATE_MODE,""));n.position=$._getNumber(t,tt.DataParser.POSITION,0);n.spacing=$._getNumber(t,tt.DataParser.SPACING,0);n.rotateOffset=$._getNumber(t,tt.DataParser.ROTATE_OFFSET,0);n.rotateMix=$._getNumber(t,tt.DataParser.ROTATE_MIX,1);n.translateMix=$._getNumber(t,tt.DataParser.TRANSLATE_MIX,1);for(var s=0,o=a;s<o.length;s++){var h=o[s];var l=this._armature.getBone(h);if(l!==null){n.AddBone(l);if(n.root===null){n.root=l}}}return n};$.prototype._parseSlot=function(t,e){var i=tt.BaseObject.borrowObject(tt.SlotData);i.displayIndex=$._getNumber(t,tt.DataParser.DISPLAY_INDEX,0);i.zOrder=e;i.zIndex=$._getNumber(t,tt.DataParser.Z_INDEX,0);i.alpha=$._getNumber(t,tt.DataParser.ALPHA,1);i.name=$._getString(t,tt.DataParser.NAME,"");i.parent=this._armature.getBone($._getString(t,tt.DataParser.PARENT,""));if(tt.DataParser.BLEND_MODE in t&&typeof t[tt.DataParser.BLEND_MODE]==="string"){i.blendMode=tt.DataParser._getBlendMode(t[tt.DataParser.BLEND_MODE])}else{i.blendMode=$._getNumber(t,tt.DataParser.BLEND_MODE,0)}if(tt.DataParser.COLOR in t){i.color=tt.SlotData.createColor();this._parseColorTransform(t[tt.DataParser.COLOR],i.color)}else{i.color=tt.SlotData.DEFAULT_COLOR}if(tt.DataParser.ACTIONS in t){this._slotChildActions[i.name]=this._parseActionData(t[tt.DataParser.ACTIONS],0,null,null)}return i};$.prototype._parseSkin=function(t){var e=tt.BaseObject.borrowObject(tt.SkinData);e.name=$._getString(t,tt.DataParser.NAME,tt.DataParser.DEFAULT_NAME);if(e.name.length===0){e.name=tt.DataParser.DEFAULT_NAME}if(tt.DataParser.SLOT in t){var i=t[tt.DataParser.SLOT];this._skin=e;for(var r=0,a=i;r<a.length;r++){var n=a[r];var s=$._getString(n,tt.DataParser.NAME,"");var o=this._armature.getSlot(s);if(o!==null){this._slot=o;if(tt.DataParser.DISPLAY in n){var h=n[tt.DataParser.DISPLAY];for(var l=0,u=h;l<u.length;l++){var f=u[l];if(f){e.addDisplay(s,this._parseDisplay(f))}else{e.addDisplay(s,null)}}}this._slot=null}}this._skin=null}return e};$.prototype._parseDisplay=function(t){var e=$._getString(t,tt.DataParser.NAME,"");var i=$._getString(t,tt.DataParser.PATH,"");var r=0;var a=null;if(tt.DataParser.TYPE in t&&typeof t[tt.DataParser.TYPE]==="string"){r=tt.DataParser._getDisplayType(t[tt.DataParser.TYPE])}else{r=$._getNumber(t,tt.DataParser.TYPE,r)}switch(r){case 0:{var n=a=tt.BaseObject.borrowObject(tt.ImageDisplayData);n.name=e;n.path=i.length>0?i:e;this._parsePivot(t,n);break}case 1:{var s=a=tt.BaseObject.borrowObject(tt.ArmatureDisplayData);s.name=e;s.path=i.length>0?i:e;s.inheritAnimation=true;if(tt.DataParser.ACTIONS in t){var o=this._parseActionData(t[tt.DataParser.ACTIONS],0,null,null);for(var h=0,l=o;h<l.length;h++){var u=l[h];s.addAction(u)}}else if(this._slot.name in this._slotChildActions){var f=this._skin.getDisplays(this._slot.name);if(f===null?this._slot.displayIndex===0:this._slot.displayIndex===f.length){for(var c=0,p=this._slotChildActions[this._slot.name];c<p.length;c++){var u=p[c];s.addAction(u)}delete this._slotChildActions[this._slot.name]}}break}case 2:{var d=a=tt.BaseObject.borrowObject(tt.MeshDisplayData);d.geometry.inheritDeform=$._getBoolean(t,tt.DataParser.INHERIT_DEFORM,true);d.name=e;d.path=i.length>0?i:e;if(tt.DataParser.SHARE in t){d.geometry.data=this._data;this._cacheRawMeshes.push(t);this._cacheMeshes.push(d)}else{this._parseMesh(t,d)}break}case 3:{var _=this._parseBoundingBox(t);if(_!==null){var g=a=tt.BaseObject.borrowObject(tt.BoundingBoxDisplayData);g.name=e;g.path=i.length>0?i:e;g.boundingBox=_}break}case 4:{var m=t[tt.DataParser.LENGTHS];var y=a=tt.BaseObject.borrowObject(tt.PathDisplayData);y.closed=$._getBoolean(t,tt.DataParser.CLOSED,false);y.constantSpeed=$._getBoolean(t,tt.DataParser.CONSTANT_SPEED,false);y.name=e;y.path=i.length>0?i:e;y.curveLengths.length=m.length;for(var v=0,T=m.length;v<T;++v){y.curveLengths[v]=m[v]}this._parsePath(t,y);break}}if(a!==null&&tt.DataParser.TRANSFORM in t){this._parseTransform(t[tt.DataParser.TRANSFORM],a.transform,this._armature.scale)}return a};$.prototype._parsePath=function(t,e){this._parseGeometry(t,e.geometry)};$.prototype._parsePivot=function(t,e){if(tt.DataParser.PIVOT in t){var i=t[tt.DataParser.PIVOT];e.pivot.x=$._getNumber(i,tt.DataParser.X,0);e.pivot.y=$._getNumber(i,tt.DataParser.Y,0)}else{e.pivot.x=.5;e.pivot.y=.5}};$.prototype._parseMesh=function(t,e){this._parseGeometry(t,e.geometry);if(tt.DataParser.WEIGHTS in t){var i=t[tt.DataParser.SLOT_POSE];var r=t[tt.DataParser.BONE_POSE];var a=this._skin.name+"_"+this._slot.name+"_"+e.name;this._weightSlotPose[a]=i;this._weightBonePoses[a]=r}};$.prototype._parseBoundingBox=function(t){var e=null;var i=0;if(tt.DataParser.SUB_TYPE in t&&typeof t[tt.DataParser.SUB_TYPE]==="string"){i=tt.DataParser._getBoundingBoxType(t[tt.DataParser.SUB_TYPE])}else{i=$._getNumber(t,tt.DataParser.SUB_TYPE,i)}switch(i){case 0:e=tt.BaseObject.borrowObject(tt.RectangleBoundingBoxData);break;case 1:e=tt.BaseObject.borrowObject(tt.EllipseBoundingBoxData);break;case 2:e=this._parsePolygonBoundingBox(t);break}if(e!==null){e.color=$._getNumber(t,tt.DataParser.COLOR,0);if(e.type===0||e.type===1){e.width=$._getNumber(t,tt.DataParser.WIDTH,0);e.height=$._getNumber(t,tt.DataParser.HEIGHT,0)}}return e};$.prototype._parsePolygonBoundingBox=function(t){var e=tt.BaseObject.borrowObject(tt.PolygonBoundingBoxData);if(tt.DataParser.VERTICES in t){var i=this._armature.scale;var r=t[tt.DataParser.VERTICES];var a=e.vertices;a.length=r.length;for(var n=0,s=r.length;n<s;n+=2){var o=r[n]*i;var h=r[n+1]*i;a[n]=o;a[n+1]=h;if(n===0){e.x=o;e.y=h;e.width=o;e.height=h}else{if(o<e.x){e.x=o}else if(o>e.width){e.width=o}if(h<e.y){e.y=h}else if(h>e.height){e.height=h}}}e.width-=e.x;e.height-=e.y}else{console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.")}return e};$.prototype._parseAnimation=function(t){var e=tt.BaseObject.borrowObject(tt.AnimationData);e.blendType=tt.DataParser._getAnimationBlendType($._getString(t,tt.DataParser.BLEND_TYPE,""));e.frameCount=$._getNumber(t,tt.DataParser.DURATION,0);e.playTimes=$._getNumber(t,tt.DataParser.PLAY_TIMES,1);e.duration=e.frameCount/this._armature.frameRate;e.fadeInTime=$._getNumber(t,tt.DataParser.FADE_IN_TIME,0);e.scale=$._getNumber(t,tt.DataParser.SCALE,1);e.name=$._getString(t,tt.DataParser.NAME,tt.DataParser.DEFAULT_NAME);if(e.name.length===0){e.name=tt.DataParser.DEFAULT_NAME}e.frameIntOffset=this._frameIntArray.length;e.frameFloatOffset=this._frameFloatArray.length;e.frameOffset=this._frameArray.length;this._animation=e;if(tt.DataParser.FRAME in t){var i=t[tt.DataParser.FRAME];var r=i.length;if(r>0){for(var a=0,n=0;a<r;++a){var s=i[a];this._parseActionDataInFrame(s,n,null,null);n+=$._getNumber(s,tt.DataParser.DURATION,1)}}}if(tt.DataParser.Z_ORDER in t){this._animation.zOrderTimeline=this._parseTimeline(t[tt.DataParser.Z_ORDER],null,tt.DataParser.FRAME,1,0,0,this._parseZOrderFrame)}if(tt.DataParser.BONE in t){var o=t[tt.DataParser.BONE];for(var h=0,l=o;h<l.length;h++){var u=l[h];this._parseBoneTimeline(u)}}if(tt.DataParser.SLOT in t){var o=t[tt.DataParser.SLOT];for(var f=0,c=o;f<c.length;f++){var u=c[f];this._parseSlotTimeline(u)}}if(tt.DataParser.FFD in t){var o=t[tt.DataParser.FFD];for(var p=0,d=o;p<d.length;p++){var u=d[p];var _=$._getString(u,tt.DataParser.SKIN,tt.DataParser.DEFAULT_NAME);var g=$._getString(u,tt.DataParser.SLOT,"");var m=$._getString(u,tt.DataParser.NAME,"");if(_.length===0){_=tt.DataParser.DEFAULT_NAME}this._slot=this._armature.getSlot(g);this._mesh=this._armature.getMesh(_,g,m);if(this._slot===null||this._mesh===null){continue}var y=this._parseTimeline(u,null,tt.DataParser.FRAME,22,2,0,this._parseSlotDeformFrame);if(y!==null){this._animation.addSlotTimeline(g,y)}this._slot=null;this._mesh=null}}if(tt.DataParser.IK in t){var o=t[tt.DataParser.IK];for(var v=0,T=o;v<T.length;v++){var u=T[v];var x=$._getString(u,tt.DataParser.NAME,"");var b=this._armature.getConstraint(x);if(b===null){continue}var y=this._parseTimeline(u,null,tt.DataParser.FRAME,30,1,2,this._parseIKConstraintFrame);if(y!==null){this._animation.addConstraintTimeline(x,y)}}}if(this._actionFrames.length>0){this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,0,0,this._parseActionFrame);this._actionFrames.length=0}if(tt.DataParser.TIMELINE in t){var o=t[tt.DataParser.TIMELINE];for(var A=0,S=o;A<S.length;A++){var u=S[A];var w=$._getNumber(u,tt.DataParser.TYPE,0);var P=$._getString(u,tt.DataParser.NAME,"");var y=null;switch(w){case 0:break;case 20:case 23:case 60:case 24:case 40:case 41:if(w===20){this._frameValueType=0;this._frameValueScale=1}else{this._frameValueType=1;if(w===23){this._frameValueScale=1}else if(w===40||w===41){this._frameValueScale=1e4}else{this._frameValueScale=100}}if(w===60||w===24||w===41){this._frameDefaultValue=1}else{this._frameDefaultValue=0}if(w===40&&e.blendType!==0){y=tt.BaseObject.borrowObject(tt.AnimationTimelineData);var E=y;E.x=$._getNumber(u,tt.DataParser.X,0);E.y=$._getNumber(u,tt.DataParser.Y,0)}y=this._parseTimeline(u,null,tt.DataParser.FRAME,w,this._frameValueType,1,this._parseSingleValueFrame,y);break;case 11:case 12:case 13:case 30:case 42:if(w===30||w===42){this._frameValueType=1;if(w===42){this._frameValueScale=1e4}else{this._frameValueScale=100}}else{if(w===12){this._frameValueScale=tt.Transform.DEG_RAD}else{this._frameValueScale=1}this._frameValueType=2}if(w===13||w===30){this._frameDefaultValue=1}else{this._frameDefaultValue=0}y=this._parseTimeline(u,null,tt.DataParser.FRAME,w,this._frameValueType,2,this._parseDoubleValueFrame);break;case 1:break;case 50:{var D=this._armature.getBone(P);if(D===null){continue}this._geometry=D.geometry;y=this._parseTimeline(u,null,tt.DataParser.FRAME,w,2,0,this._parseDeformFrame);this._geometry=null;break}case 22:{this._geometry=null;for(var _ in this._armature.skins){var C=this._armature.skins[_];for(var O in C.displays){var M=C.displays[O];for(var I=0,R=M;I<R.length;I++){var N=R[I];if(N!==null&&N.name===P){this._geometry=N.geometry;break}}}}if(this._geometry===null){continue}y=this._parseTimeline(u,null,tt.DataParser.FRAME,w,2,0,this._parseDeformFrame);this._geometry=null;break}case 21:y=this._parseTimeline(u,null,tt.DataParser.FRAME,w,1,1,this._parseSlotColorFrame);break}if(y!==null){switch(w){case 0:break;case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(P,y);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(P,y);break;case 30:this._animation.addConstraintTimeline(P,y);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(P,y);break}}}}this._animation=null;return e};$.prototype._parseTimeline=function(t,e,i,r,a,n,s,o){if(o===void 0){o=null}if(t!==null&&i.length>0&&i in t){e=t[i]}if(e===null){return null}var h=e.length;if(h===0){return null}var l=this._frameIntArray.length;var u=this._frameFloatArray.length;var f=this._timelineArray.length;if(o===null){o=tt.BaseObject.borrowObject(tt.TimelineData)}o.type=r;o.offset=f;this._frameValueType=a;this._timeline=o;this._timelineArray.length+=1+1+1+1+1+h;if(t!==null){this._timelineArray[f+0]=Math.round($._getNumber(t,tt.DataParser.SCALE,1)*100);this._timelineArray[f+1]=Math.round($._getNumber(t,tt.DataParser.OFFSET,0)*100)}else{this._timelineArray[f+0]=100;this._timelineArray[f+1]=0}this._timelineArray[f+2]=h;this._timelineArray[f+3]=n;switch(this._frameValueType){case 0:this._timelineArray[f+4]=0;break;case 1:this._timelineArray[f+4]=l-this._animation.frameIntOffset;break;case 2:this._timelineArray[f+4]=u-this._animation.frameFloatOffset;break}if(h===1){o.frameIndicesOffset=-1;this._timelineArray[f+5+0]=s.call(this,e[0],0,0)-this._animation.frameOffset}else{var c=this._animation.frameCount+1;var p=this._data.frameIndices;var d=p.length;p.length+=c;o.frameIndicesOffset=d;for(var _=0,g=0,m=0,y=0;_<c;++_){if(m+y<=_&&g<h){var v=e[g];m=_;if(g===h-1){y=this._animation.frameCount-m}else{if(v instanceof T){y=this._actionFrames[g+1].frameStart-m}else{y=$._getNumber(v,tt.DataParser.DURATION,1)}}this._timelineArray[f+5+g]=s.call(this,v,m,y)-this._animation.frameOffset;g++}p[d+_]=g-1}}this._timeline=null;return o};$.prototype._parseBoneTimeline=function(t){var e=this._armature.getBone($._getString(t,tt.DataParser.NAME,""));if(e===null){return}this._bone=e;this._slot=this._armature.getSlot(this._bone.name);if(tt.DataParser.TRANSLATE_FRAME in t){this._frameDefaultValue=0;this._frameValueScale=1;var i=this._parseTimeline(t,null,tt.DataParser.TRANSLATE_FRAME,11,2,2,this._parseDoubleValueFrame);if(i!==null){this._animation.addBoneTimeline(e.name,i)}}if(tt.DataParser.ROTATE_FRAME in t){this._frameDefaultValue=0;this._frameValueScale=1;var i=this._parseTimeline(t,null,tt.DataParser.ROTATE_FRAME,12,2,2,this._parseBoneRotateFrame);if(i!==null){this._animation.addBoneTimeline(e.name,i)}}if(tt.DataParser.SCALE_FRAME in t){this._frameDefaultValue=1;this._frameValueScale=1;var i=this._parseTimeline(t,null,tt.DataParser.SCALE_FRAME,13,2,2,this._parseBoneScaleFrame);if(i!==null){this._animation.addBoneTimeline(e.name,i)}}if(tt.DataParser.FRAME in t){var i=this._parseTimeline(t,null,tt.DataParser.FRAME,10,2,6,this._parseBoneAllFrame);if(i!==null){this._animation.addBoneTimeline(e.name,i)}}this._bone=null;this._slot=null};$.prototype._parseSlotTimeline=function(t){var e=this._armature.getSlot($._getString(t,tt.DataParser.NAME,""));if(e===null){return}var i=null;var r=null;this._slot=e;if(tt.DataParser.DISPLAY_FRAME in t){i=this._parseTimeline(t,null,tt.DataParser.DISPLAY_FRAME,20,0,0,this._parseSlotDisplayFrame)}else{i=this._parseTimeline(t,null,tt.DataParser.FRAME,20,0,0,this._parseSlotDisplayFrame)}if(tt.DataParser.COLOR_FRAME in t){r=this._parseTimeline(t,null,tt.DataParser.COLOR_FRAME,21,1,1,this._parseSlotColorFrame)}else{r=this._parseTimeline(t,null,tt.DataParser.FRAME,21,1,1,this._parseSlotColorFrame)}if(i!==null){this._animation.addSlotTimeline(e.name,i)}if(r!==null){this._animation.addSlotTimeline(e.name,r)}this._slot=null};$.prototype._parseFrame=function(t,e,i){t;i;var r=this._frameArray.length;this._frameArray.length+=1;this._frameArray[r+0]=e;return r};$.prototype._parseTweenFrame=function(t,e,i){var r=this._parseFrame(t,e,i);if(i>0){if(tt.DataParser.CURVE in t){var a=i+1;this._helpArray.length=a;var n=this._samplingEasingCurve(t[tt.DataParser.CURVE],this._helpArray);this._frameArray.length+=1+1+this._helpArray.length;this._frameArray[r+1]=2;this._frameArray[r+2]=n?a:-a;for(var s=0;s<a;++s){this._frameArray[r+3+s]=Math.round(this._helpArray[s]*1e4)}}else{var o=-2;var h=o;if(tt.DataParser.TWEEN_EASING in t){h=$._getNumber(t,tt.DataParser.TWEEN_EASING,o)}if(h===o){this._frameArray.length+=1;this._frameArray[r+1]=0}else if(h===0){this._frameArray.length+=1;this._frameArray[r+1]=1}else if(h<0){this._frameArray.length+=1+1;this._frameArray[r+1]=3;this._frameArray[r+2]=Math.round(-h*100)}else if(h<=1){this._frameArray.length+=1+1;this._frameArray[r+1]=4;this._frameArray[r+2]=Math.round(h*100)}else{this._frameArray.length+=1+1;this._frameArray[r+1]=5;this._frameArray[r+2]=Math.round(h*100-100)}}}else{this._frameArray.length+=1;this._frameArray[r+1]=0}return r};$.prototype._parseSingleValueFrame=function(t,e,i){var r=0;switch(this._frameValueType){case 0:{r=this._parseFrame(t,e,i);this._frameArray.length+=1;this._frameArray[r+1]=$._getNumber(t,tt.DataParser.VALUE,this._frameDefaultValue);break}case 1:{r=this._parseTweenFrame(t,e,i);var a=this._frameIntArray.length;this._frameIntArray.length+=1;this._frameIntArray[a]=Math.round($._getNumber(t,tt.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale);break}case 2:{r=this._parseTweenFrame(t,e,i);var a=this._frameFloatArray.length;this._frameFloatArray.length+=1;this._frameFloatArray[a]=$._getNumber(t,tt.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale;break}}return r};$.prototype._parseDoubleValueFrame=function(t,e,i){var r=0;switch(this._frameValueType){case 0:{r=this._parseFrame(t,e,i);this._frameArray.length+=2;this._frameArray[r+1]=$._getNumber(t,tt.DataParser.X,this._frameDefaultValue);this._frameArray[r+2]=$._getNumber(t,tt.DataParser.Y,this._frameDefaultValue);break}case 1:{r=this._parseTweenFrame(t,e,i);var a=this._frameIntArray.length;this._frameIntArray.length+=2;this._frameIntArray[a]=Math.round($._getNumber(t,tt.DataParser.X,this._frameDefaultValue)*this._frameValueScale);this._frameIntArray[a+1]=Math.round($._getNumber(t,tt.DataParser.Y,this._frameDefaultValue)*this._frameValueScale);break}case 2:{r=this._parseTweenFrame(t,e,i);var a=this._frameFloatArray.length;this._frameFloatArray.length+=2;this._frameFloatArray[a]=$._getNumber(t,tt.DataParser.X,this._frameDefaultValue)*this._frameValueScale;this._frameFloatArray[a+1]=$._getNumber(t,tt.DataParser.Y,this._frameDefaultValue)*this._frameValueScale;break}}return r};$.prototype._parseActionFrame=function(t,e,i){i;var r=this._frameArray.length;var a=t.actions.length;this._frameArray.length+=1+1+a;this._frameArray[r+0]=e;this._frameArray[r+0+1]=a;for(var n=0;n<a;++n){this._frameArray[r+0+2+n]=t.actions[n]}return r};$.prototype._parseZOrderFrame=function(t,e,i){var r=this._parseFrame(t,e,i);if(tt.DataParser.Z_ORDER in t){var a=t[tt.DataParser.Z_ORDER];if(a.length>0){var n=this._armature.sortedSlots.length;var s=new Array(n-a.length/2);var o=new Array(n);for(var h=0;h<s.length;++h){s[h]=0}for(var l=0;l<n;++l){o[l]=-1}var u=0;var f=0;for(var c=0,p=a.length;c<p;c+=2){var d=a[c];var _=a[c+1];while(u!==d){s[f++]=u++}var g=u+_;o[g]=u++}while(u<n){s[f++]=u++}this._frameArray.length+=1+n;this._frameArray[r+1]=n;var m=n;while(m--){if(o[m]===-1){this._frameArray[r+2+m]=s[--f]||0}else{this._frameArray[r+2+m]=o[m]||0}}return r}}this._frameArray.length+=1;this._frameArray[r+1]=0;return r};$.prototype._parseBoneAllFrame=function(t,e,i){this._helpTransform.identity();if(tt.DataParser.TRANSFORM in t){this._parseTransform(t[tt.DataParser.TRANSFORM],this._helpTransform,1)}var r=this._helpTransform.rotation;if(e!==0){if(this._prevClockwise===0){r=this._prevRotation+tt.Transform.normalizeRadian(r-this._prevRotation)}else{if(this._prevClockwise>0?r>=this._prevRotation:r<=this._prevRotation){this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1}r=this._prevRotation+r-this._prevRotation+tt.Transform.PI_D*this._prevClockwise}}this._prevClockwise=$._getNumber(t,tt.DataParser.TWEEN_ROTATE,0);this._prevRotation=r;var a=this._parseTweenFrame(t,e,i);var n=this._frameFloatArray.length;this._frameFloatArray.length+=6;this._frameFloatArray[n++]=this._helpTransform.x;this._frameFloatArray[n++]=this._helpTransform.y;this._frameFloatArray[n++]=r;this._frameFloatArray[n++]=this._helpTransform.skew;this._frameFloatArray[n++]=this._helpTransform.scaleX;this._frameFloatArray[n++]=this._helpTransform.scaleY;this._parseActionDataInFrame(t,e,this._bone,this._slot);return a};$.prototype._parseBoneTranslateFrame=function(t,e,i){var r=this._parseTweenFrame(t,e,i);var a=this._frameFloatArray.length;this._frameFloatArray.length+=2;this._frameFloatArray[a++]=$._getNumber(t,tt.DataParser.X,0);this._frameFloatArray[a++]=$._getNumber(t,tt.DataParser.Y,0);return r};$.prototype._parseBoneRotateFrame=function(t,e,i){var r=$._getNumber(t,tt.DataParser.ROTATE,0)*tt.Transform.DEG_RAD;if(e!==0){if(this._prevClockwise===0){r=this._prevRotation+tt.Transform.normalizeRadian(r-this._prevRotation)}else{if(this._prevClockwise>0?r>=this._prevRotation:r<=this._prevRotation){this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1}r=this._prevRotation+r-this._prevRotation+tt.Transform.PI_D*this._prevClockwise}}this._prevClockwise=$._getNumber(t,tt.DataParser.CLOCK_WISE,0);this._prevRotation=r;var a=this._parseTweenFrame(t,e,i);var n=this._frameFloatArray.length;this._frameFloatArray.length+=2;this._frameFloatArray[n++]=r;this._frameFloatArray[n++]=$._getNumber(t,tt.DataParser.SKEW,0)*tt.Transform.DEG_RAD;return a};$.prototype._parseBoneScaleFrame=function(t,e,i){var r=this._parseTweenFrame(t,e,i);var a=this._frameFloatArray.length;this._frameFloatArray.length+=2;this._frameFloatArray[a++]=$._getNumber(t,tt.DataParser.X,1);this._frameFloatArray[a++]=$._getNumber(t,tt.DataParser.Y,1);return r};$.prototype._parseSlotDisplayFrame=function(t,e,i){var r=this._parseFrame(t,e,i);this._frameArray.length+=1;if(tt.DataParser.VALUE in t){this._frameArray[r+1]=$._getNumber(t,tt.DataParser.VALUE,0)}else{this._frameArray[r+1]=$._getNumber(t,tt.DataParser.DISPLAY_INDEX,0)}this._parseActionDataInFrame(t,e,this._slot.parent,this._slot);return r};$.prototype._parseSlotColorFrame=function(t,e,i){var r=this._parseTweenFrame(t,e,i);var a=-1;if(tt.DataParser.VALUE in t||tt.DataParser.COLOR in t){var n=tt.DataParser.VALUE in t?t[tt.DataParser.VALUE]:t[tt.DataParser.COLOR];for(var s in n){s;this._parseColorTransform(n,this._helpColorTransform);a=this._colorArray.length;this._colorArray.length+=8;this._colorArray[a++]=Math.round(this._helpColorTransform.alphaMultiplier*100);this._colorArray[a++]=Math.round(this._helpColorTransform.redMultiplier*100);this._colorArray[a++]=Math.round(this._helpColorTransform.greenMultiplier*100);this._colorArray[a++]=Math.round(this._helpColorTransform.blueMultiplier*100);this._colorArray[a++]=Math.round(this._helpColorTransform.alphaOffset);this._colorArray[a++]=Math.round(this._helpColorTransform.redOffset);this._colorArray[a++]=Math.round(this._helpColorTransform.greenOffset);this._colorArray[a++]=Math.round(this._helpColorTransform.blueOffset);a-=8;break}}if(a<0){if(this._defaultColorOffset<0){this._defaultColorOffset=a=this._colorArray.length;this._colorArray.length+=8;this._colorArray[a++]=100;this._colorArray[a++]=100;this._colorArray[a++]=100;this._colorArray[a++]=100;this._colorArray[a++]=0;this._colorArray[a++]=0;this._colorArray[a++]=0;this._colorArray[a++]=0}a=this._defaultColorOffset}var o=this._frameIntArray.length;this._frameIntArray.length+=1;this._frameIntArray[o]=a;return r};$.prototype._parseSlotDeformFrame=function(t,e,i){var r=this._frameFloatArray.length;var a=this._parseTweenFrame(t,e,i);var n=tt.DataParser.VERTICES in t?t[tt.DataParser.VERTICES]:null;var s=$._getNumber(t,tt.DataParser.OFFSET,0);var o=this._intArray[this._mesh.geometry.offset+0];var h=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name;var l=this._mesh.geometry.weight;var u=0;var f=0;var c=0;var p=0;if(l!==null){var d=this._weightSlotPose[h];this._helpMatrixA.copyFromArray(d,0);this._frameFloatArray.length+=l.count*2;c=l.offset+2+l.bones.length}else{this._frameFloatArray.length+=o*2}for(var _=0;_<o*2;_+=2){if(n===null){u=0;f=0}else{if(_<s||_-s>=n.length){u=0}else{u=n[_-s]}if(_+1<s||_+1-s>=n.length){f=0}else{f=n[_+1-s]}}if(l!==null){var g=this._weightBonePoses[h];var m=this._intArray[c++];this._helpMatrixA.transformPoint(u,f,this._helpPoint,true);u=this._helpPoint.x;f=this._helpPoint.y;for(var y=0;y<m;++y){var v=this._intArray[c++];this._helpMatrixB.copyFromArray(g,v*7+1);this._helpMatrixB.invert();this._helpMatrixB.transformPoint(u,f,this._helpPoint,true);this._frameFloatArray[r+p++]=this._helpPoint.x;this._frameFloatArray[r+p++]=this._helpPoint.y}}else{this._frameFloatArray[r+_]=u;this._frameFloatArray[r+_+1]=f}}if(e===0){var T=this._frameIntArray.length;this._frameIntArray.length+=1+1+1+1+1;this._frameIntArray[T+0]=this._mesh.geometry.offset;this._frameIntArray[T+1]=this._frameFloatArray.length-r;this._frameIntArray[T+2]=this._frameFloatArray.length-r;this._frameIntArray[T+3]=0;this._frameIntArray[T+4]=r-this._animation.frameFloatOffset;this._timelineArray[this._timeline.offset+3]=T-this._animation.frameIntOffset}return a};$.prototype._parseIKConstraintFrame=function(t,e,i){var r=this._parseTweenFrame(t,e,i);var a=this._frameIntArray.length;this._frameIntArray.length+=2;this._frameIntArray[a++]=$._getBoolean(t,tt.DataParser.BEND_POSITIVE,true)?1:0;this._frameIntArray[a++]=Math.round($._getNumber(t,tt.DataParser.WEIGHT,1)*100);return r};$.prototype._parseActionData=function(t,e,i,r){var a=new Array;if(typeof t==="string"){var n=tt.BaseObject.borrowObject(tt.ActionData);n.type=e;n.name=t;n.bone=i;n.slot=r;a.push(n)}else if(t instanceof Array){for(var s=0,o=t;s<o.length;s++){var h=o[s];var n=tt.BaseObject.borrowObject(tt.ActionData);if(tt.DataParser.GOTO_AND_PLAY in h){n.type=0;n.name=$._getString(h,tt.DataParser.GOTO_AND_PLAY,"")}else{if(tt.DataParser.TYPE in h&&typeof h[tt.DataParser.TYPE]==="string"){n.type=tt.DataParser._getActionType(h[tt.DataParser.TYPE])}else{n.type=$._getNumber(h,tt.DataParser.TYPE,e)}n.name=$._getString(h,tt.DataParser.NAME,"")}if(tt.DataParser.BONE in h){var l=$._getString(h,tt.DataParser.BONE,"");n.bone=this._armature.getBone(l)}else{n.bone=i}if(tt.DataParser.SLOT in h){var u=$._getString(h,tt.DataParser.SLOT,"");n.slot=this._armature.getSlot(u)}else{n.slot=r}var f=null;if(tt.DataParser.INTS in h){if(f===null){f=tt.BaseObject.borrowObject(tt.UserData)}var c=h[tt.DataParser.INTS];for(var p=0,d=c;p<d.length;p++){var _=d[p];f.addInt(_)}}if(tt.DataParser.FLOATS in h){if(f===null){f=tt.BaseObject.borrowObject(tt.UserData)}var g=h[tt.DataParser.FLOATS];for(var m=0,y=g;m<y.length;m++){var _=y[m];f.addFloat(_)}}if(tt.DataParser.STRINGS in h){if(f===null){f=tt.BaseObject.borrowObject(tt.UserData)}var v=h[tt.DataParser.STRINGS];for(var T=0,x=v;T<x.length;T++){var _=x[T];f.addString(_)}}n.data=f;a.push(n)}}return a};$.prototype._parseDeformFrame=function(t,e,i){var r=this._frameFloatArray.length;var a=this._parseTweenFrame(t,e,i);var n=tt.DataParser.VERTICES in t?t[tt.DataParser.VERTICES]:tt.DataParser.VALUE in t?t[tt.DataParser.VALUE]:null;var s=$._getNumber(t,tt.DataParser.OFFSET,0);var o=this._intArray[this._geometry.offset+0];var h=this._geometry.weight;var l=0;var u=0;if(h!==null){}else{this._frameFloatArray.length+=o*2;for(var f=0;f<o*2;f+=2){if(n!==null){if(f<s||f-s>=n.length){l=0}else{l=n[f-s]}if(f+1<s||f+1-s>=n.length){u=0}else{u=n[f+1-s]}}else{l=0;u=0}this._frameFloatArray[r+f]=l;this._frameFloatArray[r+f+1]=u}}if(e===0){var c=this._frameIntArray.length;this._frameIntArray.length+=1+1+1+1+1;this._frameIntArray[c+0]=this._geometry.offset;this._frameIntArray[c+1]=this._frameFloatArray.length-r;this._frameIntArray[c+2]=this._frameFloatArray.length-r;this._frameIntArray[c+3]=0;this._frameIntArray[c+4]=r-this._animation.frameFloatOffset;this._timelineArray[this._timeline.offset+3]=c-this._animation.frameIntOffset}return a};$.prototype._parseTransform=function(t,e,i){e.x=$._getNumber(t,tt.DataParser.X,0)*i;e.y=$._getNumber(t,tt.DataParser.Y,0)*i;if(tt.DataParser.ROTATE in t||tt.DataParser.SKEW in t){e.rotation=tt.Transform.normalizeRadian($._getNumber(t,tt.DataParser.ROTATE,0)*tt.Transform.DEG_RAD);e.skew=tt.Transform.normalizeRadian($._getNumber(t,tt.DataParser.SKEW,0)*tt.Transform.DEG_RAD)}else if(tt.DataParser.SKEW_X in t||tt.DataParser.SKEW_Y in t){e.rotation=tt.Transform.normalizeRadian($._getNumber(t,tt.DataParser.SKEW_Y,0)*tt.Transform.DEG_RAD);e.skew=tt.Transform.normalizeRadian($._getNumber(t,tt.DataParser.SKEW_X,0)*tt.Transform.DEG_RAD)-e.rotation}e.scaleX=$._getNumber(t,tt.DataParser.SCALE_X,1);e.scaleY=$._getNumber(t,tt.DataParser.SCALE_Y,1)};$.prototype._parseColorTransform=function(t,e){e.alphaMultiplier=$._getNumber(t,tt.DataParser.ALPHA_MULTIPLIER,100)*.01;e.redMultiplier=$._getNumber(t,tt.DataParser.RED_MULTIPLIER,100)*.01;e.greenMultiplier=$._getNumber(t,tt.DataParser.GREEN_MULTIPLIER,100)*.01;e.blueMultiplier=$._getNumber(t,tt.DataParser.BLUE_MULTIPLIER,100)*.01;e.alphaOffset=$._getNumber(t,tt.DataParser.ALPHA_OFFSET,0);e.redOffset=$._getNumber(t,tt.DataParser.RED_OFFSET,0);e.greenOffset=$._getNumber(t,tt.DataParser.GREEN_OFFSET,0);e.blueOffset=$._getNumber(t,tt.DataParser.BLUE_OFFSET,0)};$.prototype._parseGeometry=function(t,e){var i=t[tt.DataParser.VERTICES];var r=Math.floor(i.length/2);var a=0;var n=this._intArray.length;var s=this._floatArray.length;e.offset=n;e.data=this._data;this._intArray.length+=1+1+1+1;this._intArray[n+0]=r;this._intArray[n+2]=s;this._intArray[n+3]=-1;this._floatArray.length+=r*2;for(var o=0,h=r*2;o<h;++o){this._floatArray[s+o]=i[o]}if(tt.DataParser.TRIANGLES in t){var l=t[tt.DataParser.TRIANGLES];a=Math.floor(l.length/3);this._intArray.length+=a*3;for(var o=0,h=a*3;o<h;++o){this._intArray[n+4+o]=l[o]}}this._intArray[n+1]=a;if(tt.DataParser.UVS in t){var u=t[tt.DataParser.UVS];var f=s+r*2;this._floatArray.length+=r*2;for(var o=0,h=r*2;o<h;++o){this._floatArray[f+o]=u[o]}}if(tt.DataParser.WEIGHTS in t){var c=t[tt.DataParser.WEIGHTS];var p=Math.floor(c.length-r)/2;var d=this._intArray.length;var _=this._floatArray.length;var g=0;var m=this._armature.sortedBones;var y=tt.BaseObject.borrowObject(tt.WeightData);y.count=p;y.offset=d;this._intArray.length+=1+1+g+r+p;this._intArray[d+1]=_;if(tt.DataParser.BONE_POSE in t){var v=t[tt.DataParser.SLOT_POSE];var T=t[tt.DataParser.BONE_POSE];var x=new Array;g=Math.floor(T.length/7);x.length=g;for(var o=0;o<g;++o){var b=T[o*7];var A=this._rawBones[b];y.addBone(A);x[o]=b;this._intArray[d+2+o]=m.indexOf(A)}this._floatArray.length+=p*3;this._helpMatrixA.copyFromArray(v,0);for(var o=0,S=0,w=d+2+g,P=_;o<r;++o){var E=o*2;var D=this._intArray[w++]=c[S++];var C=this._floatArray[s+E];var O=this._floatArray[s+E+1];this._helpMatrixA.transformPoint(C,O,this._helpPoint);C=this._helpPoint.x;O=this._helpPoint.y;for(var M=0;M<D;++M){var b=c[S++];var I=x.indexOf(b);this._helpMatrixB.copyFromArray(T,I*7+1);this._helpMatrixB.invert();this._helpMatrixB.transformPoint(C,O,this._helpPoint);this._intArray[w++]=I;this._floatArray[P++]=c[S++];this._floatArray[P++]=this._helpPoint.x;this._floatArray[P++]=this._helpPoint.y}}}else{var R=t[tt.DataParser.BONES];g=R.length;for(var o=0;o<g;o++){var b=R[o];var A=this._rawBones[b];y.addBone(A);this._intArray[d+2+o]=m.indexOf(A)}this._floatArray.length+=p*3;for(var o=0,S=0,P=0,w=d+2+g,N=_;o<p;o++){var D=c[S++];this._intArray[w++]=D;for(var M=0;M<D;M++){var I=c[S++];var B=c[S++];var C=i[P++];var O=i[P++];this._intArray[w++]=R.indexOf(I);this._floatArray[N++]=B;this._floatArray[N++]=C;this._floatArray[N++]=O}}}e.weight=y}};$.prototype._parseArray=function(t){t;this._intArray.length=0;this._floatArray.length=0;this._frameIntArray.length=0;this._frameFloatArray.length=0;this._frameArray.length=0;this._timelineArray.length=0;this._colorArray.length=0};$.prototype._modifyArray=function(){if(this._intArray.length%Int16Array.BYTES_PER_ELEMENT!==0){this._intArray.push(0)}if(this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!==0){this._frameIntArray.push(0)}if(this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!==0){this._frameArray.push(0)}if(this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!==0){this._timelineArray.push(0)}if(this._timelineArray.length%Int16Array.BYTES_PER_ELEMENT!==0){this._colorArray.push(0)}var t=this._intArray.length*Int16Array.BYTES_PER_ELEMENT;var e=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT;var i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT;var r=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT;var a=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT;var n=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT;var s=this._colorArray.length*Int16Array.BYTES_PER_ELEMENT;var o=t+e+i+r+a+n+s;var h=new ArrayBuffer(o);var l=new Int16Array(h,0,this._intArray.length);var u=new Float32Array(h,t,this._floatArray.length);var f=new Int16Array(h,t+e,this._frameIntArray.length);var c=new Float32Array(h,t+e+i,this._frameFloatArray.length);var p=new Int16Array(h,t+e+i+r,this._frameArray.length);var d=new Uint16Array(h,t+e+i+r+a,this._timelineArray.length);var _=new Int16Array(h,t+e+i+r+a+n,this._colorArray.length);for(var g=0,m=this._intArray.length;g<m;++g){l[g]=this._intArray[g]}for(var g=0,m=this._floatArray.length;g<m;++g){u[g]=this._floatArray[g]}for(var g=0,m=this._frameIntArray.length;g<m;++g){f[g]=this._frameIntArray[g]}for(var g=0,m=this._frameFloatArray.length;g<m;++g){c[g]=this._frameFloatArray[g]}for(var g=0,m=this._frameArray.length;g<m;++g){p[g]=this._frameArray[g]}for(var g=0,m=this._timelineArray.length;g<m;++g){d[g]=this._timelineArray[g]}for(var g=0,m=this._colorArray.length;g<m;++g){_[g]=this._colorArray[g]}this._data.binary=h;this._data.intArray=l;this._data.floatArray=u;this._data.frameIntArray=f;this._data.frameFloatArray=c;this._data.frameArray=p;this._data.timelineArray=d;this._data.colorArray=_;this._defaultColorOffset=-1};$.prototype.parseDragonBonesData=function(t,e){if(e===void 0){e=1}console.assert(t!==null&&t!==undefined,"Data error.");var i=$._getString(t,tt.DataParser.VERSION,"");var r=$._getString(t,tt.DataParser.COMPATIBLE_VERSION,"");if(tt.DataParser.DATA_VERSIONS.indexOf(i)>=0||tt.DataParser.DATA_VERSIONS.indexOf(r)>=0){var a=tt.BaseObject.borrowObject(tt.DragonBonesData);a.version=i;a.name=$._getString(t,tt.DataParser.NAME,"");a.frameRate=$._getNumber(t,tt.DataParser.FRAME_RATE,24);if(a.frameRate===0){a.frameRate=24}if(tt.DataParser.ARMATURE in t){this._data=a;this._parseArray(t);var n=t[tt.DataParser.ARMATURE];for(var s=0,o=n;s<o.length;s++){var h=o[s];a.addArmature(this._parseArmature(h,e))}if(!this._data.binary){this._modifyArray()}if(tt.DataParser.STAGE in t){a.stage=a.getArmature($._getString(t,tt.DataParser.STAGE,""))}else if(a.armatureNames.length>0){a.stage=a.getArmature(a.armatureNames[0])}this._data=null}if(tt.DataParser.TEXTURE_ATLAS in t){this._rawTextureAtlases=t[tt.DataParser.TEXTURE_ATLAS]}return a}else{console.assert(false,"Nonsupport data version: "+i+"\n"+"Please convert DragonBones data to support version.\n"+"Read more: https://github.com/DragonBones/Tools/")}return null};$.prototype.parseTextureAtlasData=function(t,e,i){if(i===void 0){i=1}console.assert(t!==undefined);if(t===null){if(this._rawTextureAtlases===null||this._rawTextureAtlases.length===0){return false}var r=this._rawTextureAtlases[this._rawTextureAtlasIndex++];this.parseTextureAtlasData(r,e,i);if(this._rawTextureAtlasIndex>=this._rawTextureAtlases.length){this._rawTextureAtlasIndex=0;this._rawTextureAtlases=null}return true}e.width=$._getNumber(t,tt.DataParser.WIDTH,0);e.height=$._getNumber(t,tt.DataParser.HEIGHT,0);e.scale=i===1?1/$._getNumber(t,tt.DataParser.SCALE,1):i;e.name=$._getString(t,tt.DataParser.NAME,"");e.imagePath=$._getString(t,tt.DataParser.IMAGE_PATH,"");if(tt.DataParser.SUB_TEXTURE in t){var a=t[tt.DataParser.SUB_TEXTURE];for(var n=0,s=a.length;n<s;++n){var o=a[n];var h=$._getNumber(o,tt.DataParser.FRAME_WIDTH,-1);var l=$._getNumber(o,tt.DataParser.FRAME_HEIGHT,-1);var u=e.createTexture();u.rotated=$._getBoolean(o,tt.DataParser.ROTATED,false);u.name=$._getString(o,tt.DataParser.NAME,"");u.region.x=$._getNumber(o,tt.DataParser.X,0);u.region.y=$._getNumber(o,tt.DataParser.Y,0);u.region.width=$._getNumber(o,tt.DataParser.WIDTH,0);u.region.height=$._getNumber(o,tt.DataParser.HEIGHT,0);if(h>0&&l>0){u.frame=tt.TextureData.createRectangle();u.frame.x=$._getNumber(o,tt.DataParser.FRAME_X,0);u.frame.y=$._getNumber(o,tt.DataParser.FRAME_Y,0);u.frame.width=h;u.frame.height=l}e.addTexture(u)}}return true};$.getInstance=function(){if($._objectDataParserInstance===null){$._objectDataParserInstance=new $}return $._objectDataParserInstance};$._objectDataParserInstance=null;return $}(tt.DataParser);tt.ObjectDataParser=t;var T=function(){function t(){this.frameStart=0;this.actions=[]}return t}();tt.ActionFrame=T})(dragonBones||(dragonBones={}));var dragonBones;(function(v){var t=function(o){__extends(t,o);function t(){return o!==null&&o.apply(this,arguments)||this}t.prototype._inRange=function(t,e,i){return e<=t&&t<=i};t.prototype._decodeUTF8=function(t){var e=-1;var i=-1;var r=65533;var a=0;var n="";var s;var o=0;var h=0;var l=0;var u=0;while(t.length>a){var f=t[a++];if(f===e){if(h!==0){s=r}else{s=i}}else{if(h===0){if(this._inRange(f,0,127)){s=f}else{if(this._inRange(f,194,223)){h=1;u=128;o=f-192}else if(this._inRange(f,224,239)){h=2;u=2048;o=f-224}else if(this._inRange(f,240,244)){h=3;u=65536;o=f-240}else{}o=o*Math.pow(64,h);s=null}}else if(!this._inRange(f,128,191)){o=0;h=0;l=0;u=0;a--;s=f}else{l+=1;o=o+(f-128)*Math.pow(64,h-l);if(l!==h){s=null}else{var c=o;var p=u;o=0;h=0;l=0;u=0;if(this._inRange(c,p,1114111)&&!this._inRange(c,55296,57343)){s=c}else{s=f}}}}if(s!==null&&s!==i){if(s<=65535){if(s>0)n+=String.fromCharCode(s)}else{s-=65536;n+=String.fromCharCode(55296+(s>>10&1023));n+=String.fromCharCode(56320+(s&1023))}}}return n};t.prototype._parseBinaryTimeline=function(t,e,i){if(i===void 0){i=null}var r=i!==null?i:v.BaseObject.borrowObject(v.TimelineData);r.type=t;r.offset=e;this._timeline=r;var a=this._timelineArrayBuffer[r.offset+2];if(a===1){r.frameIndicesOffset=-1}else{var n=0;var s=this._animation.frameCount+1;var o=this._data.frameIndices;n=o.length;o.length+=s;r.frameIndicesOffset=n;for(var h=0,l=0,u=0,f=0;h<s;++h){if(u+f<=h&&l<a){u=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+l]];if(l===a-1){f=this._animation.frameCount-u}else{f=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+l+1]]-u}l++}o[n+h]=l-1}}this._timeline=null;return r};t.prototype._parseAnimation=function(t){var e=v.BaseObject.borrowObject(v.AnimationData);e.blendType=v.DataParser._getAnimationBlendType(v.ObjectDataParser._getString(t,v.DataParser.BLEND_TYPE,""));e.frameCount=v.ObjectDataParser._getNumber(t,v.DataParser.DURATION,0);e.playTimes=v.ObjectDataParser._getNumber(t,v.DataParser.PLAY_TIMES,1);e.duration=e.frameCount/this._armature.frameRate;e.fadeInTime=v.ObjectDataParser._getNumber(t,v.DataParser.FADE_IN_TIME,0);e.scale=v.ObjectDataParser._getNumber(t,v.DataParser.SCALE,1);e.name=v.ObjectDataParser._getString(t,v.DataParser.NAME,v.DataParser.DEFAULT_NAME);if(e.name.length===0){e.name=v.DataParser.DEFAULT_NAME}var i=t[v.DataParser.OFFSET];e.frameIntOffset=i[0];e.frameFloatOffset=i[1];e.frameOffset=i[2];this._animation=e;if(v.DataParser.ACTION in t){e.actionTimeline=this._parseBinaryTimeline(0,t[v.DataParser.ACTION])}if(v.DataParser.Z_ORDER in t){e.zOrderTimeline=this._parseBinaryTimeline(1,t[v.DataParser.Z_ORDER])}if(v.DataParser.BONE in t){var r=t[v.DataParser.BONE];for(var a in r){var n=r[a];var s=this._armature.getBone(a);if(s===null){continue}for(var o=0,h=n.length;o<h;o+=2){var l=n[o];var u=n[o+1];var f=this._parseBinaryTimeline(l,u);this._animation.addBoneTimeline(s.name,f)}}}if(v.DataParser.SLOT in t){var r=t[v.DataParser.SLOT];for(var a in r){var n=r[a];var c=this._armature.getSlot(a);if(c===null){continue}for(var o=0,h=n.length;o<h;o+=2){var l=n[o];var u=n[o+1];var f=this._parseBinaryTimeline(l,u);this._animation.addSlotTimeline(c.name,f)}}}if(v.DataParser.CONSTRAINT in t){var r=t[v.DataParser.CONSTRAINT];for(var a in r){var n=r[a];var p=this._armature.getConstraint(a);if(p===null){continue}for(var o=0,h=n.length;o<h;o+=2){var l=n[o];var u=n[o+1];var f=this._parseBinaryTimeline(l,u);this._animation.addConstraintTimeline(p.name,f)}}}if(v.DataParser.TIMELINE in t){var n=t[v.DataParser.TIMELINE];for(var d=0,_=n;d<_.length;d++){var g=_[d];var u=v.ObjectDataParser._getNumber(g,v.DataParser.OFFSET,0);if(u>=0){var l=v.ObjectDataParser._getNumber(g,v.DataParser.TYPE,0);var m=v.ObjectDataParser._getString(g,v.DataParser.NAME,"");var f=null;if(l===40&&e.blendType!==0){f=v.BaseObject.borrowObject(v.AnimationTimelineData);var y=f;y.x=v.ObjectDataParser._getNumber(g,v.DataParser.X,0);y.y=v.ObjectDataParser._getNumber(g,v.DataParser.Y,0)}f=this._parseBinaryTimeline(l,u,f);switch(l){case 0:break;case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(m,f);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(m,f);break;case 30:this._animation.addConstraintTimeline(m,f);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(m,f);break}}}}this._animation=null;return e};t.prototype._parseGeometry=function(t,e){e.offset=t[v.DataParser.OFFSET];e.data=this._data;var i=this._intArrayBuffer[e.offset+3];if(i>=0){var r=v.BaseObject.borrowObject(v.WeightData);var a=this._intArrayBuffer[e.offset+0];var n=this._intArrayBuffer[i+0];r.offset=i;for(var s=0;s<n;++s){var o=this._intArrayBuffer[i+2+s];r.addBone(this._rawBones[o])}var h=i+2+n;var l=0;for(var s=0,u=a;s<u;++s){var f=this._intArrayBuffer[h++];l+=f;h+=f}r.count=l;e.weight=r}};t.prototype._parseArray=function(t){var e=t[v.DataParser.OFFSET];var i=e[1];var r=e[3];var a=e[5];var n=e[7];var s=e[9];var o=e[11];var h=e.length>12?e[13]:0;var l=new Int16Array(this._binary,this._binaryOffset+e[0],i/Int16Array.BYTES_PER_ELEMENT);var u=new Float32Array(this._binary,this._binaryOffset+e[2],r/Float32Array.BYTES_PER_ELEMENT);var f=new Int16Array(this._binary,this._binaryOffset+e[4],a/Int16Array.BYTES_PER_ELEMENT);var c=new Float32Array(this._binary,this._binaryOffset+e[6],n/Float32Array.BYTES_PER_ELEMENT);var p=new Int16Array(this._binary,this._binaryOffset+e[8],s/Int16Array.BYTES_PER_ELEMENT);var d=new Uint16Array(this._binary,this._binaryOffset+e[10],o/Uint16Array.BYTES_PER_ELEMENT);var _=h>0?new Int16Array(this._binary,this._binaryOffset+e[12],h/Int16Array.BYTES_PER_ELEMENT):l;this._data.binary=this._binary;this._data.intArray=this._intArrayBuffer=l;this._data.floatArray=u;this._data.frameIntArray=f;this._data.frameFloatArray=c;this._data.frameArray=this._frameArrayBuffer=p;this._data.timelineArray=this._timelineArrayBuffer=d;this._data.colorArray=_};t.prototype.parseDragonBonesData=function(t,e){if(e===void 0){e=1}console.assert(t!==null&&t!==undefined&&t instanceof ArrayBuffer,"Data error.");var i=new Uint8Array(t,0,8);if(i[0]!=="D".charCodeAt(0)||i[1]!=="B".charCodeAt(0)||i[2]!=="D".charCodeAt(0)||i[3]!=="T".charCodeAt(0)){console.assert(false,"Nonsupport data.");return null}var r=new Uint32Array(t,8,1)[0];var a=new Uint8Array(t,8+4,r);var n=this._decodeUTF8(a);var s=JSON.parse(n);this._binaryOffset=8+4+r;this._binary=t;return o.prototype.parseDragonBonesData.call(this,s,e)};t.getInstance=function(){if(t._binaryDataParserInstance===null){t._binaryDataParserInstance=new t}return t._binaryDataParserInstance};t._binaryDataParserInstance=null;return t}(v.ObjectDataParser);v.BinaryDataParser=t})(dragonBones||(dragonBones={}));var dragonBones;(function(m){var t=function(){function s(t){if(t===void 0){t=null}this.autoSearch=false;this._dragonBonesDataMap={};this._textureAtlasDataMap={};this._dragonBones=null;this._dataParser=null;if(s._objectParser===null){s._objectParser=new m.ObjectDataParser}if(s._binaryParser===null){s._binaryParser=new m.BinaryDataParser}this._dataParser=t!==null?t:s._objectParser}s.prototype._isSupportMesh=function(){return true};s.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap){for(var i=0,r=this._textureAtlasDataMap[t];i<r.length;i++){var a=r[i];var n=a.getTexture(e);if(n!==null){return n}}}if(this.autoSearch){for(var s in this._textureAtlasDataMap){for(var o=0,h=this._textureAtlasDataMap[s];o<h.length;o++){var a=h[o];if(a.autoSearch){var n=a.getTexture(e);if(n!==null){return n}}}}}return null};s.prototype._fillBuildArmaturePackage=function(t,e,i,r,a){var n=null;var s=null;if(e.length>0){if(e in this._dragonBonesDataMap){n=this._dragonBonesDataMap[e];s=n.getArmature(i)}}if(s===null&&(e.length===0||this.autoSearch)){for(var o in this._dragonBonesDataMap){n=this._dragonBonesDataMap[o];if(e.length===0||n.autoSearch){s=n.getArmature(i);if(s!==null){e=o;break}}}}if(s!==null){t.dataName=e;t.textureAtlasName=a;t.data=n;t.armature=s;t.skin=null;if(r.length>0){t.skin=s.getSkin(r);if(t.skin===null&&this.autoSearch){for(var o in this._dragonBonesDataMap){var h=this._dragonBonesDataMap[o];var l=h.getArmature(r);if(l!==null){t.skin=l.defaultSkin;break}}}}if(t.skin===null){t.skin=s.defaultSkin}return true}return false};s.prototype._buildBones=function(t,e){for(var i=0,r=t.armature.sortedBones;i<r.length;i++){var a=r[i];var n=m.BaseObject.borrowObject(a.type===0?m.Bone:m.Surface);n.init(a,e)}};s.prototype._buildSlots=function(t,e){var i=t.skin;var r=t.armature.defaultSkin;if(i===null||r===null){return}var a={};for(var n in r.displays){var s=r.getDisplays(n);a[n]=s}if(i!==r){for(var n in i.displays){var s=i.getDisplays(n);a[n]=s}}for(var o=0,h=t.armature.sortedSlots;o<h.length;o++){var l=h[o];var u=l.name in a?a[l.name]:null;var f=this._buildSlot(t,l,e);if(u!==null){f.displayFrameCount=u.length;for(var c=0,p=f.displayFrameCount;c<p;++c){var d=u[c];f.replaceRawDisplayData(d,c);if(d!==null){if(t.textureAtlasName.length>0){var _=this._getTextureData(t.textureAtlasName,d.path);f.replaceTextureData(_,c)}var g=this._getSlotDisplay(t,d,f);f.replaceDisplay(g,c)}else{f.replaceDisplay(null)}}}f._setDisplayIndex(l.displayIndex,true)}};s.prototype._buildConstraints=function(t,e){var i=t.armature.constraints;for(var r in i){var a=i[r];switch(a.type){case 0:var n=m.BaseObject.borrowObject(m.IKConstraint);n.init(a,e);e._addConstraint(n);break;case 1:var s=m.BaseObject.borrowObject(m.PathConstraint);s.init(a,e);e._addConstraint(s);break;default:var o=m.BaseObject.borrowObject(m.IKConstraint);o.init(a,e);e._addConstraint(o);break}}};s.prototype._buildChildArmature=function(t,e,i){return this.buildArmature(i.path,t!==null?t.dataName:"","",t!==null?t.textureAtlasName:"")};s.prototype._getSlotDisplay=function(t,e,i){var r=t!==null?t.dataName:e.parent.parent.parent.name;var a=null;switch(e.type){case 0:{var n=e;if(n.texture===null){n.texture=this._getTextureData(r,e.path)}a=i.rawDisplay;break}case 2:{var s=e;if(s.texture===null){s.texture=this._getTextureData(r,s.path)}if(this._isSupportMesh()){a=i.meshDisplay}else{a=i.rawDisplay}break}case 1:{var o=e;var h=this._buildChildArmature(t,i,o);if(h!==null){h.inheritAnimation=o.inheritAnimation;if(!h.inheritAnimation){var l=o.actions.length>0?o.actions:h.armatureData.defaultActions;if(l.length>0){for(var u=0,f=l;u<f.length;u++){var c=f[u];var p=m.BaseObject.borrowObject(m.EventObject);m.EventObject.actionDataToInstance(c,p,i.armature);p.slot=i;i.armature._bufferAction(p,false)}}else{h.animation.play()}}o.armature=h.armatureData}a=h;break}case 3:break;default:break}return a};s.prototype.parseDragonBonesData=function(t,e,i){if(e===void 0){e=null}if(i===void 0){i=1}var r=t instanceof ArrayBuffer?s._binaryParser:this._dataParser;var a=r.parseDragonBonesData(t,i);while(true){var n=this._buildTextureAtlasData(null,null);if(r.parseTextureAtlasData(null,n,i)){this.addTextureAtlasData(n,e)}else{n.returnToPool();break}}if(a!==null){this.addDragonBonesData(a,e)}return a};s.prototype.parseTextureAtlasData=function(t,e,i,r){if(i===void 0){i=null}if(r===void 0){r=1}var a=this._buildTextureAtlasData(null,null);this._dataParser.parseTextureAtlasData(t,a,r);this._buildTextureAtlasData(a,e||null);this.addTextureAtlasData(a,i);return a};s.prototype.updateTextureAtlases=function(t,e){var i=this.getTextureAtlasData(e);if(i!==null){for(var r=0,a=i.length;r<a;++r){if(r<t.length){this._buildTextureAtlasData(i[r],t[r])}}}};s.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null};s.prototype.addDragonBonesData=function(t,e){if(e===void 0){e=null}e=e!==null?e:t.name;if(e in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t){return}console.warn("Can not add same name data: "+e);return}this._dragonBonesDataMap[e]=t};s.prototype.removeDragonBonesData=function(t,e){if(e===void 0){e=true}if(t in this._dragonBonesDataMap){if(e){this._dragonBones.bufferObject(this._dragonBonesDataMap[t])}delete this._dragonBonesDataMap[t]}};s.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null};s.prototype.addTextureAtlasData=function(t,e){if(e===void 0){e=null}e=e!==null?e:t.name;var i=e in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];if(i.indexOf(t)<0){i.push(t)}};s.prototype.removeTextureAtlasData=function(t,e){if(e===void 0){e=true}if(t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e){for(var r=0,a=i;r<a.length;r++){var n=a[r];this._dragonBones.bufferObject(n)}}delete this._textureAtlasDataMap[t]}};s.prototype.getArmatureData=function(t,e){if(e===void 0){e=""}var i=new o;if(!this._fillBuildArmaturePackage(i,e,t,"","")){return null}return i.armature};s.prototype.clear=function(t){if(t===void 0){t=true}for(var e in this._dragonBonesDataMap){if(t){this._dragonBones.bufferObject(this._dragonBonesDataMap[e])}delete this._dragonBonesDataMap[e]}for(var e in this._textureAtlasDataMap){if(t){var i=this._textureAtlasDataMap[e];for(var r=0,a=i;r<a.length;r++){var n=a[r];this._dragonBones.bufferObject(n)}}delete this._textureAtlasDataMap[e]}};s.prototype.buildArmature=function(t,e,i,r){if(e===void 0){e=""}if(i===void 0){i=""}if(r===void 0){r=""}var a=new o;if(!this._fillBuildArmaturePackage(a,e||"",t,i||"",r||"")){console.warn("No armature data: "+t+", "+(e!==null?e:""));return null}var n=this._buildArmature(a);this._buildBones(a,n);this._buildSlots(a,n);this._buildConstraints(a,n);n.invalidUpdate(null,true);n.advanceTime(0);return n};s.prototype.replaceDisplay=function(t,e,i){if(i===void 0){i=-1}if(i<0){i=t.displayIndex}if(i<0){i=0}t.replaceDisplayData(e,i);if(e!==null){var r=this._getSlotDisplay(null,e,t);if(e.type===0){var a=t.getDisplayFrameAt(i).rawDisplayData;if(a!==null&&a.type===2){r=t.meshDisplay}}t.replaceDisplay(r,i)}else{t.replaceDisplay(null,i)}};s.prototype.replaceSlotDisplay=function(t,e,i,r,a,n){if(n===void 0){n=-1}var s=this.getArmatureData(e,t||"");if(s===null||s.defaultSkin===null){return false}var o=s.defaultSkin.getDisplay(i,r);this.replaceDisplay(a,o,n);return true};s.prototype.replaceSlotDisplayList=function(t,e,i,r){var a=this.getArmatureData(e,t||"");if(!a||!a.defaultSkin){return false}var n=a.defaultSkin.getDisplays(i);if(!n){return false}r.displayFrameCount=n.length;for(var s=0,o=r.displayFrameCount;s<o;++s){var h=n[s];this.replaceDisplay(r,h,s)}return true};s.prototype.replaceSkin=function(t,e,i,r){if(i===void 0){i=false}if(r===void 0){r=null}var a=false;var n=e.parent.defaultSkin;for(var s=0,o=t.getSlots();s<o.length;s++){var h=o[s];if(r!==null&&r.indexOf(h.name)>=0){continue}var l=e.getDisplays(h.name);if(l===null){if(n!==null&&e!==n){l=n.getDisplays(h.name)}if(l===null){if(i){h.displayFrameCount=0}continue}}h.displayFrameCount=l.length;for(var u=0,f=h.displayFrameCount;u<f;++u){var c=l[u];h.replaceRawDisplayData(c,u);if(c!==null){h.replaceDisplay(this._getSlotDisplay(null,c,h),u)}else{h.replaceDisplay(null,u)}}a=true}return a};s.prototype.replaceAnimation=function(t,e,i){if(i===void 0){i=true}var r=e.defaultSkin;if(r===null){return false}if(i){t.animation.animations=e.animations}else{var a=t.animation.animations;var n={};for(var s in a){n[s]=a[s]}for(var s in e.animations){n[s]=e.animations[s]}t.animation.animations=n}for(var o=0,h=t.getSlots();o<h.length;o++){var l=h[o];var u=0;for(var f=0,c=l.displayList;f<c.length;f++){var p=c[f];if(p instanceof m.Armature){var d=r.getDisplays(l.name);if(d!==null&&u<d.length){var _=d[u];if(_!==null&&_.type===1){var g=this.getArmatureData(_.path,_.parent.parent.parent.name);if(g){this.replaceAnimation(p,g,i)}}}}u++}}return true};s.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap};s.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap};Object.defineProperty(s.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:true,configurable:true});s._objectParser=null;s._binaryParser=null;return s}();m.BaseFactory=t;var o=function(){function t(){this.dataName="";this.textureAtlasName="";this.skin=null}return t}();m.BuildArmaturePackage=o})(dragonBones||(dragonBones={}));var dragonBones;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._renderTexture=null;return t}t.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"};t.prototype._onClear=function(){e.prototype._onClear.call(this);if(this._renderTexture!==null){}this._renderTexture=null};t.prototype.createTexture=function(){return i.BaseObject.borrowObject(r)};Object.defineProperty(t.prototype,"renderTexture",{get:function(){return this._renderTexture},set:function(t){if(this._renderTexture===t){return}this._renderTexture=t;if(this._renderTexture!==null){for(var e in this.textures){var i=this.textures[e];i.renderTexture=new PIXI.Texture(this._renderTexture,i.region,i.region,new PIXI.Rectangle(0,0,i.region.width,i.region.height))}}else{for(var e in this.textures){var i=this.textures[e];i.renderTexture=null}}},enumerable:true,configurable:true});return t}(i.TextureAtlasData);i.PhaserTextureAtlasData=t;var r=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.renderTexture=null;return t}t.toString=function(){return"[class dragonBones.PhaserTextureData]"};t.prototype._onClear=function(){e.prototype._onClear.call(this);if(this.renderTexture!==null){this.renderTexture.destroy(false)}this.renderTexture=null};return t}(i.TextureData);i.PhaserTextureData=r})(dragonBones||(dragonBones={}));var dragonBones;(function(b){var t=function(i){__extends(t,i);function t(){var t=i.call(this,window.qc_game)||this;t.debugDraw=false;t._debugDraw=false;t._armature=null;t._signals={};t._debugDrawer=null;t.positionHasSet=false;return t}t.prototype.updateTransform=function(t){if(!t&&!this.parent&&!this.game){return this}var e=this.parent;if(t){e=t}else if(!this.parent){e=this.game.world}var i=e.worldTransform;var r=this.worldTransform;var a,n,s,o,h,l;if(this.rotation%Phaser.Math.PI2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}var u=this.skew%b.Transform.PI_D;if(u>.01||u<-.01){a=this._cr*this.scaleX;n=this._sr*this.scaleX;s=-Math.sin(u+this.rotation)*this.scaleY;o=Math.cos(u+this.rotation)*this.scaleY;h=this.x;l=this.y}else{a=this._cr*this.scaleX;n=this._sr*this.scaleX;s=-this._sr*this.scaleY;o=this._cr*this.scaleY;h=this.x;l=this.y}if(this.pivotX||this.pivotY){h-=this.pivotX*a+this.pivotY*s;l-=this.pivotX*n+this.pivotY*o}r.a=a*i.a+n*i.c;r.b=a*i.b+n*i.d;r.c=s*i.a+o*i.c;r.d=s*i.b+o*i.d;r.tx=h*i.a+l*i.c+i.tx;r.ty=h*i.b+l*i.d+i.ty}else{a=this.scaleX;n=0;s=0;o=this.scaleY;h=this.x-this.pivotX*a;l=this.y-this.pivotY*o;r.a=a*i.a;r.b=a*i.b;r.c=o*i.c;r.d=o*i.d;r.tx=h*i.a+l*i.c+i.tx;r.ty=h*i.b+l*i.d+i.ty}a=r.a;n=r.b;s=r.c;o=r.d;var f=a*o-n*s;if(a||n){var c=Math.sqrt(a*a+n*n);this.worldRotationTmp=n>0?Math.acos(a/c):-Math.acos(a/c)}else if(s||o){var p=Math.sqrt(s*s+o*o);this.worldRotationTmp=Phaser.Math.HALF_PI-(o>0?Math.acos(-s/p):-Math.acos(s/p))}else{}this.worldAlpha=this.alpha*e.worldAlpha;this._currentBounds=null;if(this.transformCallback){this.transformCallback.call(this.transformCallbackContext,r,i)}return this};t.prototype._getChildByName=function(t,e){for(var i=0,r=t.children;i<r.length;i++){var a=r[i];if(a.name===e){return a}}return null};t.prototype.dbInit=function(t){this._armature=t};t.prototype.dbClear=function(){for(var t in this._signals){var e=this._signals[t];e.removeAll();e.dispose();delete this._signals[t]}if(this._debugDrawer!==null){}i.prototype.destroy.call(this,false)};t.prototype.dbUpdate=function(){var t=b.DragonBones.debugDraw||this.debugDraw;if(t||this._debugDraw){this._debugDraw=t;if(this._debugDraw){if(this._debugDrawer===null){this._debugDrawer=new Phaser.Sprite(this.game,0,0);var e=new Phaser.Graphics(this.game);this._debugDrawer.addChild(e)}this.addChild(this._debugDrawer);var i=this._debugDrawer.getChildAt(0);i.clear();var r=this._armature.getBones();for(var a=0,n=r.length;a<n;++a){var s=r[a];var o=s.boneData.length;var h=s.globalTransformMatrix.tx;var l=s.globalTransformMatrix.ty;var u=h+s.globalTransformMatrix.a*o;var f=l+s.globalTransformMatrix.b*o;i.lineStyle(2,65535,.7);i.moveTo(h,l);i.lineTo(u,f);i.lineStyle(0,0,0);i.beginFill(65535,.7);i.drawCircle(h,l,3);i.endFill()}var c=this._armature.getSlots();for(var a=0,n=c.length;a<n;++a){var p=c[a];var d=p.boundingBoxData;if(d){var _=this._getChildByName(this._debugDrawer,p.name);if(!_){_=new Phaser.Graphics(this.game);_.name=p.name;this._debugDrawer.addChild(_)}_.clear();_.lineStyle(2,16711935,.7);switch(d.type){case 0:_.drawRect(-d.width*.5,-d.height*.5,d.width,d.height);break;case 1:_.drawEllipse(-d.width*.5,-d.height*.5,d.width,d.height);break;case 2:var g=d.vertices;for(var m=0,y=g.length;m<y;m+=2){var v=g[m];var T=g[m+1];if(m===0){_.moveTo(v,T)}else{_.lineTo(v,T)}}_.lineTo(g[0],g[1]);break;default:break}_.endFill();p.updateTransformAndMatrix();p.updateGlobalTransform();var x=p.global;_.x=x.x;_.y=x.y;_.rotation=x.rotation;_.scale.x=x.scaleX;_.scale.y=x.scaleY;_.pivot.x=p._pivotX;_.pivot.y=p._pivotY}else{var _=this._getChildByName(this._debugDrawer,p.name);if(_){this._debugDrawer.removeChild(_)}}}}else if(this._debugDrawer!==null&&this._debugDrawer.parent===this){this.removeChild(this._debugDrawer)}}};t.prototype.dispose=function(t){if(t===void 0){t=true}t;if(this._armature!==null){this._armature.dispose();this._armature=null}};t.prototype.destroy=function(){this.dispose()};t.prototype.dispatchDBEvent=function(t,e){if(!(t in this._signals)){this._signals[t]=new Phaser.Signal}var i=this._signals[t];i.dispatch(e)};t.prototype.hasDBEventListener=function(t){return t in this._signals&&this._signals[t].getNumListeners()>0};t.prototype.addDBEventListener=function(t,e,i){if(!(t in this._signals)){this._signals[t]=new Phaser.Signal}var r=this._signals[t];r.add(e,i)};t.prototype.removeDBEventListener=function(t,e,i){if(t in this._signals){var r=this._signals[t];r.remove(e,i)}};Object.defineProperty(t.prototype,"armature",{get:function(){return this._armature},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animation",{get:function(){return this._armature.animation},enumerable:true,configurable:true});t.prototype.hasEvent=function(t){return this.hasDBEventListener(t)};t.prototype.addEvent=function(t,e,i){this.addDBEventListener(t,e,i)};t.prototype.removeEvent=function(t,e,i){this.removeDBEventListener(t,e,i)};return t}(qc.Sprite);b.PhaserArmatureDisplay=t})(dragonBones||(dragonBones={}));var dragonBones;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.toString=function(){return"[class dragonBones.PhaserSlot]"};e.prototype._onClear=function(){t.prototype._onClear.call(this);this._textureScale=1;this._renderDisplay=null};e.prototype._initDisplay=function(t,e){t;e};e.prototype._disposeDisplay=function(t,e){t;if(!e){t.destroy(true)}};e.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display?this._display:this._rawDisplay};e.prototype._addDisplay=function(){var t=this._armature.display;t.addChild(this._renderDisplay)};e.prototype._replaceDisplay=function(t){var e=this._armature.display;var i=t;e.addChild(this._renderDisplay);e.swapChildren(this._renderDisplay,i);e.removeChild(i);this._textureScale=1};e.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)};e.prototype._updateZOrder=function(){var t=this._armature.display;var e=t.getChildIndex(this._renderDisplay);if(e===this._zOrder){return}t.addChildAt(this._renderDisplay,this._zOrder)};e.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible&&this._visible};e.prototype._updateBlendMode=function(){if(this._renderDisplay instanceof PIXI.Sprite){switch(this._blendMode){case 0:this._renderDisplay.blendMode=PIXI.blendModes.NORMAL;break;case 1:this._renderDisplay.blendMode=PIXI.blendModes.ADD;break;case 3:this._renderDisplay.blendMode=PIXI.blendModes.DARKEN;break;case 4:this._renderDisplay.blendMode=PIXI.blendModes.DIFFERENCE;break;case 6:this._renderDisplay.blendMode=PIXI.blendModes.HARD_LIGHT;break;case 9:this._renderDisplay.blendMode=PIXI.blendModes.LIGHTEN;break;case 10:this._renderDisplay.blendMode=PIXI.blendModes.MULTIPLY;break;case 11:this._renderDisplay.blendMode=PIXI.blendModes.OVERLAY;break;case 12:this._renderDisplay.blendMode=PIXI.blendModes.SCREEN;break;default:break}}};e.prototype._updateColor=function(){var t=this._colorTransform.alphaMultiplier*this._globalAlpha;this._renderDisplay.alpha=t;if(this._renderDisplay instanceof PIXI.Sprite){var e=(Math.round(this._colorTransform.redMultiplier*255)<<16)+(Math.round(this._colorTransform.greenMultiplier*255)<<8)+Math.round(this._colorTransform.blueMultiplier*255);this._renderDisplay.tint=e}};e.prototype._updateFrame=function(){var t=this._textureData;if(this._displayIndex>=0&&this._display!==null&&t!==null){var e=t.parent;if(this._armature.replacedTexture!==null){if(this._armature._replaceTextureAtlasData===null){e=n.BaseObject.borrowObject(n.PhaserTextureAtlasData);e.copyFrom(t.parent);e.renderTexture=this._armature.replacedTexture;this._armature._replaceTextureAtlasData=e}else{e=this._armature._replaceTextureAtlasData}t=e.getTexture(t.name)}var i=t.renderTexture;if(i!==null){if(this._geometryData!==null){}else{this._textureScale=t.parent.scale*this._armature._armatureData.scale;var r=this._renderDisplay;if(r.change_texture){r.texture=r.change_texture;r.resetNativeSize()}else{r.phaser.texture=i}var a=t.name.split("/");r.name=a[a.length-1];r._bone=true;r.resetNativeSize()}this._visibleDirty=true;return}}if(this._geometryData!==null){}else{var r=this._renderDisplay;r.x=0;r.y=0;r.visible=false}};e.prototype._updateMesh=function(){};e.prototype._updateTransform=function(){this.updateGlobalTransform();var t=this.global;var e=this._renderDisplay.getScript(ps.Layout);if(!e){if(this._renderDisplay===this._rawDisplay||this._renderDisplay===this._meshDisplay){var i=t.x-(this.globalTransformMatrix.a*this._pivotX+this.globalTransformMatrix.c*this._pivotY);var r=t.y-(this.globalTransformMatrix.b*this._pivotX+this.globalTransformMatrix.d*this._pivotY);this._renderDisplay.x=i;this._renderDisplay.y=r}else{this._renderDisplay.x=t.x;this._renderDisplay.y=t.y;if(this._renderDisplay instanceof n.PhaserArmatureDisplay){this._renderDisplay.positionHasSet=true}}}this._renderDisplay.rotation=t.rotation;this._renderDisplay.skew=t.skew;this._renderDisplay.scaleX=t.scaleX*this._textureScale;this._renderDisplay.scaleY=t.scaleY*this._textureScale;if(this._renderDisplay instanceof n.PhaserArmatureDisplay){var a=.001*qc_game.time.deltaTime;this._renderDisplay.armature.advanceTime(a)}else{this._renderDisplay.updateTransform()}};e.prototype._identityTransform=function(){this._renderDisplay.x=0;this._renderDisplay.y=0;this._renderDisplay.rotation=0;this._renderDisplay.skew=0;this._renderDisplay.scale.x=1;this._renderDisplay.scale.y=1};return e}(n.Slot);n.PhaserSlot=t})(dragonBones||(dragonBones={}));var dragonBones;(function(d){var t=function(i){__extends(t,i);function t(t){var e=i!==null&&i.call(this,window.qc_game)||this;e.change_texture=null;return e}t.prototype.updateTransform=function(t){if(!t&&!this.parent&&!this.game){return this}var e=this.parent;if(t){e=t}else if(!this.parent){e=this.game.world}var i=e.worldTransform;var r=this.worldTransform;var a,n,s,o,h,l;if(this.rotation%Phaser.Math.PI2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}var u=this.skew%d.Transform.PI_D;if(u>.01||u<-.01){a=this._cr*this.scaleX;n=this._sr*this.scaleX;s=-Math.sin(u+this.rotation)*this.scaleY;o=Math.cos(u+this.rotation)*this.scaleY;h=this.x;l=this.y}else{a=this._cr*this.scaleX;n=this._sr*this.scaleX;s=-this._sr*this.scaleY;o=this._cr*this.scaleY;h=this.x;l=this.y}if(this.pivotX||this.pivotY){h-=this.pivotX*a+this.pivotY*s;l-=this.pivotX*n+this.pivotY*o}r.a=a*i.a+n*i.c;r.b=a*i.b+n*i.d;r.c=s*i.a+o*i.c;r.d=s*i.b+o*i.d;r.tx=h*i.a+l*i.c+i.tx;r.ty=h*i.b+l*i.d+i.ty}else{a=this.scaleX;n=0;s=0;o=this.scaleY;h=this.x-this.pivotX*a;l=this.y-this.pivotY*o;r.a=a*i.a;r.b=a*i.b;r.c=o*i.c;r.d=o*i.d;r.tx=h*i.a+l*i.c+i.tx;r.ty=h*i.b+l*i.d+i.ty}a=r.a;n=r.b;s=r.c;o=r.d;var f=a*o-n*s;if(a||n){var c=Math.sqrt(a*a+n*n);this.worldRotationTmp=n>0?Math.acos(a/c):-Math.acos(a/c)}else if(s||o){var p=Math.sqrt(s*s+o*o);this.worldRotationTmp=Phaser.Math.HALF_PI-(o>0?Math.acos(-s/p):-Math.acos(s/p))}else{}this.worldAlpha=this.alpha*e.worldAlpha;this._currentBounds=null;if(this.transformCallback){this.transformCallback.call(this.transformCallbackContext,r,i)}return this};return t}(qc.UIImage);d.PhaserSlotDisplay=t})(dragonBones||(dragonBones={}));var dragonBones;(function(n){var t=function(i){__extends(r,i);function r(t){if(t===void 0){t=null}var e=i.call(this,t)||this;e._dragonBones=r._dragonBonesInstance;return e}r.init=function(t){if(r._game!==null){return}r._game=t;var e=new n.PhaserArmatureDisplay;if(e.parent){e.parent.removeChild(e)}r._dragonBonesInstance=new n.DragonBones(e)};Object.defineProperty(r,"factory",{get:function(){if(r._factory===null){r._factory=new r}return r._factory},enumerable:true,configurable:true});r.prototype._isSupportMesh=function(){console.warn("Phaser-ce can not support mesh.");return false};r.prototype._buildTextureAtlasData=function(t,e){if(t){t.renderTexture=e}else{t=n.BaseObject.borrowObject(n.PhaserTextureAtlasData)}return t};r.prototype._buildArmature=function(t){var e=n.BaseObject.borrowObject(n.Armature);var i=new n.PhaserArmatureDisplay;if(i.parent){i.parent.removeChild(i)}i.name=t.armature.name;e.init(t.armature,i,i,this._dragonBones);return e};r.prototype._buildSlot=function(t,e,i){t;i;var r=n.BaseObject.borrowObject(n.PhaserSlot);var a=new n.PhaserSlotDisplay;if(a.parent){a.parent.removeChild(a)}r.init(e,i,a,a);return r};r.prototype.buildArmatureDisplay=function(t,e,i,r){if(e===void 0){e=""}if(i===void 0){i=""}if(r===void 0){r=""}var a=this.buildArmature(t,e||"",i||"",r||"");if(a!==null){this._dragonBones.clock.add(a);return a}return null};r.prototype.getTextureDisplay=function(t,e){if(e===void 0){e=null}var i=this._getTextureData(e!==null?e:"",t);if(i!==null&&i.renderTexture!==null){return new Phaser.Sprite(r._game,0,0)}return null};Object.defineProperty(r.prototype,"soundEventManager",{get:function(){return this._dragonBones.eventManager},enumerable:true,configurable:true});r._game=null;r._dragonBonesInstance=null;r._factory=null;return r}(n.BaseFactory);n.PhaserFactory=t})(dragonBones||(dragonBones={}));dragonBones.CoverAtlas=function(t){var e;var i={meta:{image:t.imagePath},frames:e={}};var r=t.SubTexture;var a=r.length;var n;for(var s=0;s<a;s++){n=r[s];e[n.name]={filename:n.name,frame:{x:n.x,y:n.y,w:n.width,h:n.height},rotated:false,trimmed:false,spriteSourceSize:{x:0,y:0,w:n.width,h:n.height},sourceSize:{w:n.width,h:n.height}}}return i};dragonBones.findArmature=function(t){return t.armature[0].name};dragonBones.makeQcArmature=function(t,e,i,r){var a=dragonBones.PhaserFactory.factory;a.addDragonBonesData(a.parseDragonBonesData(t),"aaa");var n=new qc.UIImage(dragonBones.game._qc);n.texture=dragonBones.game._qc.assets.find(r);a.addTextureAtlasData(a.parseTextureAtlasData(e,n.phaser.texture),"bbb");if(n.parent){n.parent.removeChild(n)}var s=a.buildArmature(dragonBones.findArmature(t));if(s){s._clock=new dragonBones.WorldClock}a.clear(false);return s};qc.dragonBones=dragonBones;Phaser.Text=function(t,e,i,r,a){e=e||0;i=i||0;if(r===undefined||r===null){r=""}else{r=r.toString()}a=Phaser.Utils.extend({},a);this.type=Phaser.TEXT;this.realWidth=0;this.realHeight=0;this.physicsType=Phaser.SPRITE;this.padding=new Phaser.Point;this.textBounds=null;this.canvas=Phaser.Canvas.create();this.context=this.canvas.getContext("2d");this.colors=[];this.strokeColors=[];this.fontStyles=[];this.fontWeights=[];this.autoRound=false;this.useAdvancedWrap=false;this._res=1;this._text=r;this._fontComponents=null;this._lineSpacing=0;this._lineHeight=1;this._letterSpacing=0;this._enableUnderline=false;this._underlineColor=[];this._underlineWidth=1;this._underlineSpacing=0;this._enableDeleteline=false;this._deletelineColor=[];this._deletelineWidth=1;this._deletelineSpacing=0;this._gradientByLine=true;this._charCount=0;this._width=0;this._height=0;this._canvasPadding={left:0,right:0,top:0,bottom:0};Phaser.Sprite.call(this,t,e,i,PIXI.Texture.fromCanvas(this.canvas));this.setStyle(a);if(r!==""){this.updateText()}};Phaser.Text.prototype=Object.create(Phaser.Sprite.prototype);Phaser.Text.prototype.constructor=Phaser.Text;Phaser.Text.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};Phaser.Text.prototype.update=function(){};Phaser.Text.prototype.destroy=function(t){this.texture.destroy(true);Phaser.Component.Destroy.prototype.destroy.call(this,t)};Phaser.Text.prototype.setShadow=function(t,e,i,r,a,n){if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i="rgba(0, 0, 0, 1)"}if(r===undefined){r=0}if(a===undefined){a=true}if(n===undefined){n=true}this.style.shadowOffsetX=t;this.style.shadowOffsetY=e;this.style.shadowColor=i;this.style.shadowBlur=r;this.style.shadowStroke=a;this.style.shadowFill=n;this.dirty=true;return this};Phaser.Text.prototype.setStyle=function(t,e){if(e===undefined){e=false}t=t||{};t.font=t.font||"bold 20pt Arial";t.backgroundColor=t.backgroundColor||null;t.fill=t.fill||"black";t.align=t.align||"left";t.boundsAlignH=t.boundsAlignH||"left";t.boundsAlignV=t.boundsAlignV||"top";t.stroke=t.stroke||"black";t.strokeThickness=t.strokeThickness||0;t.wordWrap=t.wordWrap||false;t.wordWrapWidth=t.wordWrapWidth||100;t.wordWrapHeight=t.wordWrapHeight||100;t.maxLines=t.maxLines||0;t.shadowOffsetX=t.shadowOffsetX||0;t.shadowOffsetY=t.shadowOffsetY||0;t.shadowColor=t.shadowColor||"rgba(0,0,0,0)";t.shadowBlur=t.shadowBlur||0;t.tabs=t.tabs||0;t.shadowFill=t.shadowFill||true;var i=this.fontToComponents(t.font);if(t.fontStyle){i.fontStyle=t.fontStyle}if(t.fontVariant){i.fontVariant=t.fontVariant}if(t.fontWeight){i.fontWeight=t.fontWeight}if(t.fontSize){if(typeof t.fontSize==="number"){t.fontSize=t.fontSize+"px"}i.fontSize=t.fontSize}this._fontComponents=i;t.font=this.componentsToFont(this._fontComponents);this.style=t;this.dirty=true;if(e){this.updateText()}return this};Phaser.Text.prototype.updatePaddingRect=function(){var t=0;var e=0;var i=0;var r=0;var a=0;if(this.enableUnderline){e=this.underlineSpacing+this.underlineWidth;i=this.underlineWidth/2;r=this.underlineWidth/2}if(this.style.strokeThickness){a=this.style.strokeThickness;i=Math.max(i,a/2);r=Math.max(r,a/2);t=Math.max(t,a/2);e=Math.max(e,a/2)}if(this.style.shadowFill){var n=this.style.shadowBlur+a;var s=this.style.shadowOffsetX;var o=this.style.shadowOffsetY;i=Math.max(i,-s+n);r=Math.max(r,s+n);t=Math.max(t,-o+n);e=Math.max(e,o+n)}if(this.fontStyle==="italic"){var h=this.fontSize*Math.tan(12*.0174532925);r+=h}this._canvasPadding.left=i;this._canvasPadding.right=r;this._canvasPadding.top=t;this._canvasPadding.bottom=e};Phaser.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var t=this.text;this.updatePaddingRect();var e;if(this.style.wordWrap){t=t.replace(/(?:\r\n|\r|\n)/g,"\n");e=this.runWordWrap(t,this.wordWrapWidth)}else{e=t.split(/(?:\r\n|\r|\n)/)}var i=this.style.tabs;var r=[];var a=0;var n=this.determineFontProperties(this.style.font);var s=e.length;if(this.style.maxLines>0&&this.style.maxLines<e.length){s=this.style.maxLines}this._charCount=0;for(var o=0;o<s;o++){lineWidth=this.measureLine(e[o],true);r[o]=Math.ceil(lineWidth);a=Math.max(a,r[o],this.wordWrapWidth)}this.canvas.width=a*this._res+this._canvasPadding.left+this._canvasPadding.right;var h=n.fontSize;var l=h*s;var u=this.lineSpacing;if(u<0&&Math.abs(u)>h){u=-h}if(u!==0){l+=u>0?u*e.length:u*(e.length-1)}var f=Math.max(this.style.wordWrapHeight,l);this.canvas.height=f;this.realWidth=this.canvas.width;this.realHeight=this.canvas.height;this.context.scale(this._res,this._res);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}if(this.style.backgroundColor){this.context.fillStyle=this.style.backgroundColor;this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline="alphabetic";this.context.lineWidth=Number(this.style.strokeThickness);this.context.lineCap="square";this.context.lineJoin="round";var c;var p;this._charCount=0;var d=h*(s-1);var _=this._canvasPadding.top+n.ascent-n.descent;if(this.style.boundsAlignV==="bottom"){_=this.canvas.height-d-this._canvasPadding.bottom}else if(this.style.boundsAlignV==="middle"){_+=(this.canvas.height-d-this._canvasPadding.bottom-_)/2}for(o=0;o<s;o++){c=this._canvasPadding.left;p=_;p+=(h+u)*o;this.context.textAlign="left";if(this.style.boundsAlignH==="right"){c+=a-r[o]}else if(this.style.boundsAlignH==="center"){c+=(a-r[o])/2}if(this.autoRound){c=Math.round(c);p=Math.round(p)}if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){this.updateLine(e[o],c,p)}else{var g=["ar","my"];var m=languagesMgr.getLang()?languagesMgr.getLang().toLocaleLowerCase():"";if(g.every(function(t){return m!==t})){this.updateLine(e[o],c,p)}else{if(this.style.stroke&&this.style.strokeThickness){if(i===0){this.context.strokeText(e[o],c,p)}else{this.renderTabLine(e[o],c,p,false)}}if(this.style.fill){this.updateShadow(this.style.shadowFill);if(i===0){this.context.fillText(e[o],c,p)}else{this.renderTabLine(e[o],c,p,true)}}}}}this.updateTexture();this.dirty=false};Phaser.Text.prototype.renderTabLine=function(t,e,i,r){var a=t.split(/(?:\t)/);var n=this.style.tabs;var s=0;if(Array.isArray(n)){var o=0;for(var h=0;h<a.length;h++){if(h>0){o+=n[h-1]}s=e+o;if(r){this.context.fillText(a[h],s,i)}else{this.context.strokeText(a[h],s,i)}}}else{for(var h=0;h<a.length;h++){var l=Math.ceil(this.context.measureText(a[h]).width);s=this.game.math.snapToCeil(e,n);if(r){this.context.fillText(a[h],s,i)}else{this.context.strokeText(a[h],s,i)}e=s+l}}};Phaser.Text.prototype.updateShadow=function(t){if(t){this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur}else{this.context.shadowOffsetX=0;this.context.shadowOffsetY=0;this.context.shadowColor=0;this.context.shadowBlur=0}};Phaser.Text.prototype.measureLine=function(t,e){if(e==undefined){e=false}var i=0;var r=this.splitter||new GraphemeSplitter;if(!this.splitter)this.splitter=r;var a=r.splitGraphemes(t);for(var n=0;n<a.length;n++){var s=a[n];var o=this.context.measureText(s).width;if(e){if(this.letterSpacing&&n!=t.length-1){o+=this.letterSpacing}}i+=o;this._charCount++}return Math.ceil(i)};Phaser.Text.prototype.updateLine=function(t,e,i){var r=this.measureLine(t,false);var a=this.letterSpacing||0;var n=this.splitter||new GraphemeSplitter;if(!this.splitter)this.splitter=n;var s=n.splitGraphemes(t);if(this.boundsAlignH==="justify"){a=(this.realWidth-r-this._canvasPadding.left-this._canvasPadding.right)/(s.length-1)}var o=this.determineFontProperties(this.style.font);var h=e;var l=[];var u=this;for(var f=0;f<s.length;f++){var c=s[f];if(this.fontWeights.length>0||this.fontStyles.length>0){var p=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){p.fontStyle=this.fontStyles[this._charCount]}if(this.fontWeights[this._charCount]){p.fontWeight=this.fontWeights[this._charCount]}this.context.font=this.componentsToFont(p)}var d=this.context.measureText(c).width;this.context.save();if(this.gradient&&this.gradientByLine){var _=this.context.createLinearGradient(e,i-o.fontSize,e,i);_.addColorStop(0,this.startColor);_.addColorStop(1,this.endColor)}if(this.style.fill){if(this.gradient&&this.gradientByLine){this.context.fillStyle=_}else{this.context.fillStyle=this.style.fill}this.updateShadow(this.style.shadowFill);this.context.fillText(c,e,i)}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount]}this.updateShadow(false);this.context.strokeText(c,e,i)}l.push([c,e,i]);l.forEach(function(t){if(u.gradient&&u.gradientByLine){u.context.fillStyle=_}else{u.context.fillStyle=u.style.fill}u.updateShadow(false);u.context.fillText(t[0],t[1],t[2])});if(f!==s.length-1){d+=a}e+=d;this._charCount++}if(this.enableUnderline){this.context.beginPath();this.context.strokeStyle=this.underlineColor;this.context.lineWidth=this.underlineWidth;if(this.gradient){if(this.gradientByLine){this.context.strokeStyle=_}else{this.context.strokeStyle=this.fill}}var g=this.underlineSpacing;g+=this.style.strokeThickness/2;this.context.moveTo(h,i+this.context.lineWidth/2+g);this.context.lineTo(e,i+this.context.lineWidth/2+g);this.updateShadow(this.style.shadowFill);this.context.stroke()}if(this.enableDeleteline){this.context.beginPath();this.context.strokeStyle=this.deletelineColor;this.context.lineWidth=this.deletelineWidth;if(this.gradient){if(this.gradientByLine){this.context.strokeStyle=_}else{this.context.strokeStyle=this.fill}}var g=this.deletelineSpacing;this.context.moveTo(h,i-this.fontSize/3+g);this.context.lineTo(e,i-this.fontSize/3+g);this.updateShadow(this.style.shadowFill);this.context.stroke()}this.context.restore()};Phaser.Text.prototype.clearColors=function(){this.colors=[];this.strokeColors=[];this.dirty=true;return this};Phaser.Text.prototype.clearFontValues=function(){this.fontStyles=[];this.fontWeights=[];this.dirty=true;return this};Phaser.Text.prototype.addColor=function(t,e){this.colors[e]=t;this.dirty=true;return this};Phaser.Text.prototype.addStrokeColor=function(t,e){this.strokeColors[e]=t;this.dirty=true;return this};Phaser.Text.prototype.addFontStyle=function(t,e){this.fontStyles[e]=t;this.dirty=true;return this};Phaser.Text.prototype.addFontWeight=function(t,e){this.fontWeights[e]=t;this.dirty=true;return this};Phaser.Text.prototype.precalculateWordWrap=function(t){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var e=this.runWordWrap(t);return e.split(/(?:\r\n|\r|\n)/)};Phaser.Text.prototype._getWorldWidth=function(t){if(t.length>0&&t[t.length-1]==="\n"){var e=t.substr(0,t.length-1);return this.context.measureText(e).width}return this.context.measureText(t).width};Phaser.Text.prototype._isLetter=function(t){if((t<"a"||t>"z")&&(t<"A"||t>"Z")){return false}return true};Phaser.Text.prototype.runWordWrap=function(t,e){var i=e;var r=[];var a=0;var n=false;for(var s=0;s<t.length;){if(t[s]==="\n"){var o=t.substr(a,s-a+1);if(o.length===1&&r.length>0&&!n){r[r.length-1]+="\n"}else{r.push(o.split("\n")[0])}s++;a=s;n=true}else{n=false;var h=-1;while(s<t.length){var l=t.charAt(s);if(this._isLetter(l)){if(h===-1)h=s;s++}else{if(h>=0)s--;break}}if(s===t.length)s--;var u=this._getWorldWidth(t.substr(a,s-a+1));if(u>i){if(h>=0&&h===a){var o=t.substr(a,s-a+1);r.push(o);s++;a=s}else if(h>=0){var f=h-a;var o=t.substr(a,f);r.push(o);s=a+f;a=s}else{if(s-a===0){var o=t.substr(a,s-a+1);r.push(o);s++;a=s}else{var o=t.substr(a,s-a);r.push(o);a=s}}}else{s++;if(s===t.length){var o=t.substr(a,s-a+1);r.push(o)}}}}return r};Phaser.Text.prototype.advancedWordWrap=function(t){var e=this.context;var i=this.style.wordWrapWidth;var r="";var a=t.replace(/ +/gi," ").split(/\r?\n/gi);var n=a.length;for(var s=0;s<n;s++){var o=a[s];var h="";o=o.replace(/^ *|\s*$/gi,"");var l=e.measureText(o).width;if(l<i){r+=o+"\n";continue}var u=i;var f=o.split(" ");for(var c=0;c<f.length;c++){var p=f[c];var d=p+" ";var _=e.measureText(d).width;if(_>u){if(c===0){var g=d;while(g.length){g=g.slice(0,-1);_=e.measureText(g).width;if(_<=u){break}}if(!g.length){throw new Error("This text's wordWrapWidth setting is less than a single character!")}var m=p.substr(g.length);f[c]=m;h+=g}var y=f[c].length?c:c+1;var v=f.slice(y).join(" ").replace(/[ \n]*$/gi,"");a[s+1]=v+" "+(a[s+1]||"");n=a.length;break}else{h+=d;u-=_}}r+=h.replace(/[ \n]*$/gi,"")+"\n"}r=r.replace(/[\s|\n]*$/gi,"");return r};Phaser.Text.prototype.basicWordWrap=function(t){var e="";var i=t.split("\n");for(var r=0;r<i.length;r++){var a=this.style.wordWrapWidth;var n=i[r].split(" ");for(var s=0;s<n.length;s++){var o=this.context.measureText(n[s]).width;var h=o+this.context.measureText(" ").width;if(h>a){if(s>0){e+="\n"}e+=n[s]+" ";a=this.style.wordWrapWidth-o}else{a-=h;e+=n[s]+" "}}if(r<i.length-1){e+="\n"}}return e};Phaser.Text.prototype.updateFont=function(t){var e=this.componentsToFont(t);if(this.style.font!==e){this.style.font=e;this.dirty=true;if(this.parent){this.updateTransform()}}};Phaser.Text.prototype.fontToComponents=function(t){var e=t.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(e){var i=e[5].trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(i)&&!/['",]/.exec(i)){i="'"+i+"'"}return{font:t,fontStyle:e[1]||"normal",fontVariant:e[2]||"normal",fontWeight:e[3]||"normal",fontSize:e[4]||"medium",fontFamily:i}}else{console.warn("Phaser.Text - unparsable CSS font: "+t);return{font:t}}};Phaser.Text.prototype.componentsToFont=function(t){var e=[];var i;i=t.fontStyle;if(i&&i!=="normal"){e.push(i)}i=t.fontVariant;if(i&&i!=="normal"){e.push(i)}i=t.fontWeight;if(i&&i!=="normal"){e.push(i)}i=t.fontSize;if(i&&i!=="medium"){e.push(i)}i=t.fontFamily;if(i){e.push(i)}if(!e.length){e.push(t.font)}return e.join(" ")};Phaser.Text.prototype.setText=function(t,e){if(e===undefined){e=false}this.text=t.toString()||"";if(e){this.updateText()}else{this.dirty=true}return this};Phaser.Text.prototype.parseList=function(t){if(!Array.isArray(t)){return this}else{var e="";for(var i=0;i<t.length;i++){if(Array.isArray(t[i])){e+=t[i].join("\t");if(i<t.length-1){e+="\n"}}else{e+=t[i];if(i<t.length-1){e+="\t"}}}}this.text=e;this.dirty=true;return this};Phaser.Text.prototype.setTextBounds=function(t,e,i,r){if(t===undefined){this.textBounds=null}else{if(!this.textBounds){this.textBounds=new Phaser.Rectangle(t,e,i,r)}else{this.textBounds.setTo(t,e,i,r)}if(this.style.wordWrapWidth>i){this.style.wordWrapWidth=i}}this.updateTexture();return this};Phaser.Text.prototype.updateTexture=function(){var t=this.texture.baseTexture;var e=this.texture.crop;var i=this.texture.frame;var r=this.canvas.width;var a=this.canvas.height;t.width=r;t.height=a;e.width=r;e.height=a;i.width=r;i.height=a;this.texture.width=r;this.texture.height=a;this._width=r;this._height=a;if(this.textBounds){var n=this.textBounds.x;var s=this.textBounds.y;if(this.style.boundsAlignH==="right"){n+=this.textBounds.width-this.canvas.width/this.resolution}else if(this.style.boundsAlignH==="center"){n+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2}if(this.style.boundsAlignV==="bottom"){s+=this.textBounds.height-this.canvas.height/this.resolution}else if(this.style.boundsAlignV==="middle"){s+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2}this.pivot.x=-n;this.pivot.y=-s}this.renderable=r!==0&&a!==0;this.texture.requiresReTint=true;this.texture.baseTexture.dirty()};Phaser.Text.prototype._renderWebGL=function(t){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderWebGL.call(this,t)};Phaser.Text.prototype._renderCanvas=function(t){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderCanvas.call(this,t)};Phaser.Text.prototype.determineFontProperties=function(t){var e=Phaser.Text.fontPropertiesCache[t];if(!e){e={};var i=Phaser.Text.fontPropertiesCanvas;var r=Phaser.Text.fontPropertiesContext;r.font=t;var a=Math.ceil(r.measureText("|MÉq").width);var n=Math.ceil(r.measureText("|MÉq").width);var s=2*n;n=n*1.4|0;i.width=a;i.height=s;r.fillStyle="#f00";r.fillRect(0,0,a,s);r.font=t;r.textBaseline="alphabetic";r.fillStyle="#000";r.fillText("|MÉq",0,n);if(!r.getImageData(0,0,a,s)){e.ascent=n;e.descent=n+6;e.fontSize=e.ascent+e.descent;Phaser.Text.fontPropertiesCache[t]=e;return e}var o=r.getImageData(0,0,a,s).data;var h=o.length;var l=a*4;var u,f;var c=0;var p=false;for(u=0;u<n;u++){for(f=0;f<l;f+=4){if(o[c+f]!==255){p=true;break}}if(!p){c+=l}else{break}}e.ascent=n-u;c=h-l;p=false;for(u=s;u>n;u--){for(f=0;f<l;f+=4){if(o[c+f]!==255){p=true;break}}if(!p){c-=l}else{break}}e.descent=u-n;e.descent+=6;e.fontSize=e.ascent+e.descent;Phaser.Text.fontPropertiesCache[t]=e}return e};Phaser.Text.prototype.getBounds=function(t){if(this.dirty){this.updateText();this.dirty=false}return PIXI.Sprite.prototype.getBounds.call(this,t)};Object.defineProperty(Phaser.Text.prototype,"text",{get:function(){return this._text},set:function(t){if(t!==this._text){this._text=t.toString()||"";this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(Phaser.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(t){t=t||"bold 20pt Arial";this._fontComponents=this.fontToComponents(t);this.updateFont(this._fontComponents)}});Object.defineProperty(Phaser.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(t){t=t||"Arial";t=t.trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)&&!/['",]/.exec(t)){t="'"+t+"'"}this._fontComponents.fontFamily=t;this.updateFont(this._fontComponents)}});Object.defineProperty(Phaser.Text.prototype,"fontSize",{get:function(){var t=this._fontComponents.fontSize;if(t&&/(?:^0$|px$)/.exec(t)){return parseInt(t,10)}else{return t}},set:function(t){t=t||"0";if(typeof t==="number"){t=t+"px"}this._fontComponents.fontSize=t;this.updateFont(this._fontComponents)}});Object.defineProperty(Phaser.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontWeight=t;this.updateFont(this._fontComponents)}});Object.defineProperty(Phaser.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontStyle=t;this.updateFont(this._fontComponents)}});Object.defineProperty(Phaser.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontVariant=t;this.updateFont(this._fontComponents)}});Object.defineProperty(Phaser.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){if(t!==this.style.fill){this.style.fill=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){if(t!==this.style.align){this.style.align=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"resolution",{get:function(){return this._res},set:function(t){if(t!==this._res){this._res=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(t){if(t!==this.style.tabs){this.style.tabs=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(t){if(t!==this.style.boundsAlignH){this.style.boundsAlignH=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(t){if(t!==this.style.boundsAlignV){this.style.boundsAlignV=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){if(t!==this.style.stroke){this.style.stroke=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){if(t!==this.style.strokeThickness){this.style.strokeThickness=Number(t);this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){if(t!==this.style.wordWrap){this.style.wordWrap=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){if(t!==this.style.wordWrapWidth){this.style.wordWrapWidth=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"wordWrapHeight",{get:function(){return this.style.wordWrapHeight},set:function(t){if(t!==this.style.wordWrapHeight){this.style.wordWrapHeight=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing||0},set:function(t){if(t!==this._lineSpacing){this._lineSpacing=parseFloat(t);var e=this.determineFontProperties(this.style.font).fontSize;this._lineHeight=(this.lineSpacing+e)/e;this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(Phaser.Text.prototype,"lineHeight",{get:function(){return this._lineHeight!=void 0?this._lineHeight:1},set:function(t){if(t!==this._lineHeight){this._lineHeight=t;var e=this.determineFontProperties(this.style.font).fontSize;this._lineSpacing=this.lineHeight*e-e;this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(Phaser.Text.prototype,"letterSpacing",{get:function(){return this._letterSpacing||0},set:function(t){if(t!==this._letterSpacing){this._letterSpacing=t;this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(Phaser.Text.prototype,"enableUnderline",{get:function(){return this._enableUnderline||false},set:function(t){if(t!==this._enableUnderline){this._enableUnderline=t;this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(Phaser.Text.prototype,"underlineColor",{get:function(){return this._underlineColor||qc.Color.black},set:function(t){if(t!==this._underlineColor){this._underlineColor=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"underlineWidth",{get:function(){return this._underlineWidth!=void 0?this._underlineWidth:1},set:function(t){if(t!==this._underlineWidth){this._underlineWidth=t;this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(Phaser.Text.prototype,"underlineSpacing",{get:function(){return this._underlineSpacing||0},set:function(t){if(t!==this._underlineSpacing){this._underlineSpacing=t;this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(Phaser.Text.prototype,"enableDeleteline",{get:function(){return this._enableDeleteline||false},set:function(t){if(t!==this._enableDeleteline){this._enableDeleteline=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"deletelineColor",{get:function(){return this._deletelineColor||qc.Color.black},set:function(t){if(t!==this._deletelineColor){this._deletelineColor=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"deletelineWidth",{get:function(){return this._deletelineWidth!=void 0?this._deletelineWidth:1},set:function(t){if(t!==this._deletelineWidth){this._deletelineWidth=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"deletelineSpacing",{get:function(){return this._deletelineSpacing!=void 0?this._deletelineSpacing:10},set:function(t){if(t!==this._deletelineSpacing){this._deletelineSpacing=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"gradientByLine",{get:function(){return this._gradientByLine},set:function(t){if(t!==this._gradientByLine){this._gradientByLine=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){if(t!==this.style.shadowOffsetX){this.style.shadowOffsetX=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){if(t!==this.style.shadowOffsetY){this.style.shadowOffsetY=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){if(t!==this.style.shadowColor){this.style.shadowColor=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){if(t!==this.style.shadowBlur){this.style.shadowBlur=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(t){if(t!==this.style.shadowStroke){this.style.shadowStroke=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(t){if(t!==this.style.shadowFill){this.style.shadowFill=t;this.dirty=true}}});Object.defineProperty(Phaser.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width;this._width=t}});Object.defineProperty(Phaser.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height;this._height=t}});Phaser.Text.fontPropertiesCache={};Phaser.Text.fontPropertiesCanvas=document.createElement("canvas");Phaser.Text.fontPropertiesContext=Phaser.Text.fontPropertiesCanvas.getContext("2d");function GraphemeSplitter(){var l=0,u=1,f=2,c=3,p=4,d=5,_=6,g=7,m=8,y=9,v=10,e=11,T=12,x=13,b=14,A=15,S=16,w=17;var P=0,E=1,D=2,C=3,O=4;function s(t,e){return 55296<=t.charCodeAt(e)&&t.charCodeAt(e)<=56319&&56320<=t.charCodeAt(e+1)&&t.charCodeAt(e+1)<=57343}function o(t,e){if(e===undefined){e=0}var i=t.charCodeAt(e);if(55296<=i&&i<=56319&&e<t.length-1){var r=i;var a=t.charCodeAt(e+1);if(56320<=a&&a<=57343){return(r-55296)*1024+(a-56320)+65536}return r}if(56320<=i&&i<=57343&&e>=1){var r=t.charCodeAt(e-1);var a=i;if(55296<=r&&r<=56319){return(r-55296)*1024+(a-56320)+65536}return a}return i}function h(t,e,i){var r=[t].concat(e).concat([i]);var a=r[r.length-2];var n=i;var s=r.lastIndexOf(b);if(s>1&&r.slice(1,s).every(function(t){return t==c})&&[c,x,w].indexOf(t)==-1){return D}var o=r.lastIndexOf(p);if(o>0&&r.slice(1,o).every(function(t){return t==p})&&[T,p].indexOf(a)==-1){if(r.filter(function(t){return t==p}).length%2==1){return C}else{return O}}if(a==l&&n==u){return P}else if(a==f||a==l||a==u){if(n==b&&e.every(function(t){return t==c})){return D}else{return E}}else if(n==f||n==l||n==u){return E}else if(a==_&&(n==_||n==g||n==y||n==v)){return P}else if((a==y||a==g)&&(n==g||n==m)){return P}else if((a==v||a==m)&&n==m){return P}else if(n==c||n==A){return P}else if(n==d){return P}else if(a==T){return P}var h=r.indexOf(c)!=-1?r.lastIndexOf(c)-1:r.length-2;if([x,w].indexOf(r[h])!=-1&&r.slice(h+1,-1).every(function(t){return t==c})&&n==b){return P}if(a==A&&[S,w].indexOf(n)!=-1){return P}if(e.indexOf(p)!=-1){return D}if(a==p&&n==p){return P}return E}this.nextBreak=function(t,e){if(e===undefined){e=0}if(e<0){return 0}if(e>=t.length-1){return t.length}var i=M(o(t,e));var r=[];for(var a=e+1;a<t.length;a++){if(s(t,a-1)){continue}var n=M(o(t,a));if(h(i,r,n)){return a}r.push(n)}return t.length};this.splitGraphemes=function(t){var e=[];var i=0;var r;while((r=this.nextBreak(t,i))<t.length){e.push(t.slice(i,r));i=r}if(i<t.length){e.push(t.slice(i))}return e};this.iterateGraphemes=function(i){var r=0;var t={next:function(){var t;var e;if((e=this.nextBreak(i,r))<i.length){t=i.slice(r,e);r=e;return{value:t,done:false}}if(r<i.length){t=i.slice(r);r=i.length;return{value:t,done:false}}return{value:undefined,done:true}}.bind(this)};if(typeof Symbol!=="undefined"&&Symbol.iterator){t[Symbol.iterator]=function(){return t}}return t};this.countGraphemes=function(t){var e=0;var i=0;var r;while((r=this.nextBreak(t,i))<t.length){i=r;e++}if(i<t.length){e++}return e};function M(t){if(1536<=t&&t<=1541||1757==t||1807==t||2274==t||3406==t||69821==t||70082<=t&&t<=70083||72250==t||72326<=t&&t<=72329||73030==t){return T}if(13==t){return l}if(10==t){return u}if(0<=t&&t<=9||11<=t&&t<=12||14<=t&&t<=31||127<=t&&t<=159||173==t||1564==t||6158==t||8203==t||8206<=t&&t<=8207||8232==t||8233==t||8234<=t&&t<=8238||8288<=t&&t<=8292||8293==t||8294<=t&&t<=8303||55296<=t&&t<=57343||65279==t||65520<=t&&t<=65528||65529<=t&&t<=65531||113824<=t&&t<=113827||119155<=t&&t<=119162||917504==t||917505==t||917506<=t&&t<=917535||917632<=t&&t<=917759||918e3<=t&&t<=921599){return f}if(768<=t&&t<=879||1155<=t&&t<=1159||1160<=t&&t<=1161||1425<=t&&t<=1469||1471==t||1473<=t&&t<=1474||1476<=t&&t<=1477||1479==t||1552<=t&&t<=1562||1611<=t&&t<=1631||1648==t||1750<=t&&t<=1756||1759<=t&&t<=1764||1767<=t&&t<=1768||1770<=t&&t<=1773||1809==t||1840<=t&&t<=1866||1958<=t&&t<=1968||2027<=t&&t<=2035||2070<=t&&t<=2073||2075<=t&&t<=2083||2085<=t&&t<=2087||2089<=t&&t<=2093||2137<=t&&t<=2139||2260<=t&&t<=2273||2275<=t&&t<=2306||2362==t||2364==t||2369<=t&&t<=2376||2381==t||2385<=t&&t<=2391||2402<=t&&t<=2403||2433==t||2492==t||2494==t||2497<=t&&t<=2500||2509==t||2519==t||2530<=t&&t<=2531||2561<=t&&t<=2562||2620==t||2625<=t&&t<=2626||2631<=t&&t<=2632||2635<=t&&t<=2637||2641==t||2672<=t&&t<=2673||2677==t||2689<=t&&t<=2690||2748==t||2753<=t&&t<=2757||2759<=t&&t<=2760||2765==t||2786<=t&&t<=2787||2810<=t&&t<=2815||2817==t||2876==t||2878==t||2879==t||2881<=t&&t<=2884||2893==t||2902==t||2903==t||2914<=t&&t<=2915||2946==t||3006==t||3008==t||3021==t||3031==t||3072==t||3134<=t&&t<=3136||3142<=t&&t<=3144||3146<=t&&t<=3149||3157<=t&&t<=3158||3170<=t&&t<=3171||3201==t||3260==t||3263==t||3266==t||3270==t||3276<=t&&t<=3277||3285<=t&&t<=3286||3298<=t&&t<=3299||3328<=t&&t<=3329||3387<=t&&t<=3388||3390==t||3393<=t&&t<=3396||3405==t||3415==t||3426<=t&&t<=3427||3530==t||3535==t||3538<=t&&t<=3540||3542==t||3551==t||3633==t||3636<=t&&t<=3642||3655<=t&&t<=3662||3761==t||3764<=t&&t<=3769||3771<=t&&t<=3772||3784<=t&&t<=3789||3864<=t&&t<=3865||3893==t||3895==t||3897==t||3953<=t&&t<=3966||3968<=t&&t<=3972||3974<=t&&t<=3975||3981<=t&&t<=3991||3993<=t&&t<=4028||4038==t||4141<=t&&t<=4144||4146<=t&&t<=4151||4153<=t&&t<=4154||4157<=t&&t<=4158||4184<=t&&t<=4185||4190<=t&&t<=4192||4209<=t&&t<=4212||4226==t||4229<=t&&t<=4230||4237==t||4253==t||4957<=t&&t<=4959||5906<=t&&t<=5908||5938<=t&&t<=5940||5970<=t&&t<=5971||6002<=t&&t<=6003||6068<=t&&t<=6069||6071<=t&&t<=6077||6086==t||6089<=t&&t<=6099||6109==t||6155<=t&&t<=6157||6277<=t&&t<=6278||6313==t||6432<=t&&t<=6434||6439<=t&&t<=6440||6450==t||6457<=t&&t<=6459||6679<=t&&t<=6680||6683==t||6742==t||6744<=t&&t<=6750||6752==t||6754==t||6757<=t&&t<=6764||6771<=t&&t<=6780||6783==t||6832<=t&&t<=6845||6846==t||6912<=t&&t<=6915||6964==t||6966<=t&&t<=6970||6972==t||6978==t||7019<=t&&t<=7027||7040<=t&&t<=7041||7074<=t&&t<=7077||7080<=t&&t<=7081||7083<=t&&t<=7085||7142==t||7144<=t&&t<=7145||7149==t||7151<=t&&t<=7153||7212<=t&&t<=7219||7222<=t&&t<=7223||7376<=t&&t<=7378||7380<=t&&t<=7392||7394<=t&&t<=7400||7405==t||7412==t||7416<=t&&t<=7417||7616<=t&&t<=7673||7675<=t&&t<=7679||8204==t||8400<=t&&t<=8412||8413<=t&&t<=8416||8417==t||8418<=t&&t<=8420||8421<=t&&t<=8432||11503<=t&&t<=11505||11647==t||11744<=t&&t<=11775||12330<=t&&t<=12333||12334<=t&&t<=12335||12441<=t&&t<=12442||42607==t||42608<=t&&t<=42610||42612<=t&&t<=42621||42654<=t&&t<=42655||42736<=t&&t<=42737||43010==t||43014==t||43019==t||43045<=t&&t<=43046||43204<=t&&t<=43205||43232<=t&&t<=43249||43302<=t&&t<=43309||43335<=t&&t<=43345||43392<=t&&t<=43394||43443==t||43446<=t&&t<=43449||43452==t||43493==t||43561<=t&&t<=43566||43569<=t&&t<=43570||43573<=t&&t<=43574||43587==t||43596==t||43644==t||43696==t||43698<=t&&t<=43700||43703<=t&&t<=43704||43710<=t&&t<=43711||43713==t||43756<=t&&t<=43757||43766==t||44005==t||44008==t||44013==t||64286==t||65024<=t&&t<=65039||65056<=t&&t<=65071||65438<=t&&t<=65439||66045==t||66272==t||66422<=t&&t<=66426||68097<=t&&t<=68099||68101<=t&&t<=68102||68108<=t&&t<=68111||68152<=t&&t<=68154||68159==t||68325<=t&&t<=68326||69633==t||69688<=t&&t<=69702||69759<=t&&t<=69761||69811<=t&&t<=69814||69817<=t&&t<=69818||69888<=t&&t<=69890||69927<=t&&t<=69931||69933<=t&&t<=69940||70003==t||70016<=t&&t<=70017||70070<=t&&t<=70078||70090<=t&&t<=70092||70191<=t&&t<=70193||70196==t||70198<=t&&t<=70199||70206==t||70367==t||70371<=t&&t<=70378||70400<=t&&t<=70401||70460==t||70462==t||70464==t||70487==t||70502<=t&&t<=70508||70512<=t&&t<=70516||70712<=t&&t<=70719||70722<=t&&t<=70724||70726==t||70832==t||70835<=t&&t<=70840||70842==t||70845==t||70847<=t&&t<=70848||70850<=t&&t<=70851||71087==t||71090<=t&&t<=71093||71100<=t&&t<=71101||71103<=t&&t<=71104||71132<=t&&t<=71133||71219<=t&&t<=71226||71229==t||71231<=t&&t<=71232||71339==t||71341==t||71344<=t&&t<=71349||71351==t||71453<=t&&t<=71455||71458<=t&&t<=71461||71463<=t&&t<=71467||72193<=t&&t<=72198||72201<=t&&t<=72202||72243<=t&&t<=72248||72251<=t&&t<=72254||72263==t||72273<=t&&t<=72278||72281<=t&&t<=72283||72330<=t&&t<=72342||72344<=t&&t<=72345||72752<=t&&t<=72758||72760<=t&&t<=72765||72767==t||72850<=t&&t<=72871||72874<=t&&t<=72880||72882<=t&&t<=72883||72885<=t&&t<=72886||73009<=t&&t<=73014||73018==t||73020<=t&&t<=73021||73023<=t&&t<=73029||73031==t||92912<=t&&t<=92916||92976<=t&&t<=92982||94095<=t&&t<=94098||113821<=t&&t<=113822||119141==t||119143<=t&&t<=119145||119150<=t&&t<=119154||119163<=t&&t<=119170||119173<=t&&t<=119179||119210<=t&&t<=119213||119362<=t&&t<=119364||121344<=t&&t<=121398||121403<=t&&t<=121452||121461==t||121476==t||121499<=t&&t<=121503||121505<=t&&t<=121519||122880<=t&&t<=122886||122888<=t&&t<=122904||122907<=t&&t<=122913||122915<=t&&t<=122916||122918<=t&&t<=122922||125136<=t&&t<=125142||125252<=t&&t<=125258||917536<=t&&t<=917631||917760<=t&&t<=917999){return c}if(127462<=t&&t<=127487){return p}if(2307==t||2363==t||2366<=t&&t<=2368||2377<=t&&t<=2380||2382<=t&&t<=2383||2434<=t&&t<=2435||2495<=t&&t<=2496||2503<=t&&t<=2504||2507<=t&&t<=2508||2563==t||2622<=t&&t<=2624||2691==t||2750<=t&&t<=2752||2761==t||2763<=t&&t<=2764||2818<=t&&t<=2819||2880==t||2887<=t&&t<=2888||2891<=t&&t<=2892||3007==t||3009<=t&&t<=3010||3014<=t&&t<=3016||3018<=t&&t<=3020||3073<=t&&t<=3075||3137<=t&&t<=3140||3202<=t&&t<=3203||3262==t||3264<=t&&t<=3265||3267<=t&&t<=3268||3271<=t&&t<=3272||3274<=t&&t<=3275||3330<=t&&t<=3331||3391<=t&&t<=3392||3398<=t&&t<=3400||3402<=t&&t<=3404||3458<=t&&t<=3459||3536<=t&&t<=3537||3544<=t&&t<=3550||3570<=t&&t<=3571||3635==t||3763==t||3902<=t&&t<=3903||3967==t||4145==t||4155<=t&&t<=4156||4182<=t&&t<=4183||4228==t||6070==t||6078<=t&&t<=6085||6087<=t&&t<=6088||6435<=t&&t<=6438||6441<=t&&t<=6443||6448<=t&&t<=6449||6451<=t&&t<=6456||6681<=t&&t<=6682||6741==t||6743==t||6765<=t&&t<=6770||6916==t||6965==t||6971==t||6973<=t&&t<=6977||6979<=t&&t<=6980||7042==t||7073==t||7078<=t&&t<=7079||7082==t||7143==t||7146<=t&&t<=7148||7150==t||7154<=t&&t<=7155||7204<=t&&t<=7211||7220<=t&&t<=7221||7393==t||7410<=t&&t<=7411||7415==t||43043<=t&&t<=43044||43047==t||43136<=t&&t<=43137||43188<=t&&t<=43203||43346<=t&&t<=43347||43395==t||43444<=t&&t<=43445||43450<=t&&t<=43451||43453<=t&&t<=43456||43567<=t&&t<=43568||43571<=t&&t<=43572||43597==t||43755==t||43758<=t&&t<=43759||43765==t||44003<=t&&t<=44004||44006<=t&&t<=44007||44009<=t&&t<=44010||44012==t||69632==t||69634==t||69762==t||69808<=t&&t<=69810||69815<=t&&t<=69816||69932==t||70018==t||70067<=t&&t<=70069||70079<=t&&t<=70080||70188<=t&&t<=70190||70194<=t&&t<=70195||70197==t||70368<=t&&t<=70370||70402<=t&&t<=70403||70463==t||70465<=t&&t<=70468||70471<=t&&t<=70472||70475<=t&&t<=70477||70498<=t&&t<=70499||70709<=t&&t<=70711||70720<=t&&t<=70721||70725==t||70833<=t&&t<=70834||70841==t||70843<=t&&t<=70844||70846==t||70849==t||71088<=t&&t<=71089||71096<=t&&t<=71099||71102==t||71216<=t&&t<=71218||71227<=t&&t<=71228||71230==t||71340==t||71342<=t&&t<=71343||71350==t||71456<=t&&t<=71457||71462==t||72199<=t&&t<=72200||72249==t||72279<=t&&t<=72280||72343==t||72751==t||72766==t||72873==t||72881==t||72884==t||94033<=t&&t<=94078||119142==t||119149==t){return d}if(4352<=t&&t<=4447||43360<=t&&t<=43388){return _}if(4448<=t&&t<=4519||55216<=t&&t<=55238){return g}if(4520<=t&&t<=4607||55243<=t&&t<=55291){return m}if(44032==t||44060==t||44088==t||44116==t||44144==t||44172==t||44200==t||44228==t||44256==t||44284==t||44312==t||44340==t||44368==t||44396==t||44424==t||44452==t||44480==t||44508==t||44536==t||44564==t||44592==t||44620==t||44648==t||44676==t||44704==t||44732==t||44760==t||44788==t||44816==t||44844==t||44872==t||44900==t||44928==t||44956==t||44984==t||45012==t||45040==t||45068==t||45096==t||45124==t||45152==t||45180==t||45208==t||45236==t||45264==t||45292==t||45320==t||45348==t||45376==t||45404==t||45432==t||45460==t||45488==t||45516==t||45544==t||45572==t||45600==t||45628==t||45656==t||45684==t||45712==t||45740==t||45768==t||45796==t||45824==t||45852==t||45880==t||45908==t||45936==t||45964==t||45992==t||46020==t||46048==t||46076==t||46104==t||46132==t||46160==t||46188==t||46216==t||46244==t||46272==t||46300==t||46328==t||46356==t||46384==t||46412==t||46440==t||46468==t||46496==t||46524==t||46552==t||46580==t||46608==t||46636==t||46664==t||46692==t||46720==t||46748==t||46776==t||46804==t||46832==t||46860==t||46888==t||46916==t||46944==t||46972==t||47e3==t||47028==t||47056==t||47084==t||47112==t||47140==t||47168==t||47196==t||47224==t||47252==t||47280==t||47308==t||47336==t||47364==t||47392==t||47420==t||47448==t||47476==t||47504==t||47532==t||47560==t||47588==t||47616==t||47644==t||47672==t||47700==t||47728==t||47756==t||47784==t||47812==t||47840==t||47868==t||47896==t||47924==t||47952==t||47980==t||48008==t||48036==t||48064==t||48092==t||48120==t||48148==t||48176==t||48204==t||48232==t||48260==t||48288==t||48316==t||48344==t||48372==t||48400==t||48428==t||48456==t||48484==t||48512==t||48540==t||48568==t||48596==t||48624==t||48652==t||48680==t||48708==t||48736==t||48764==t||48792==t||48820==t||48848==t||48876==t||48904==t||48932==t||48960==t||48988==t||49016==t||49044==t||49072==t||49100==t||49128==t||49156==t||49184==t||49212==t||49240==t||49268==t||49296==t||49324==t||49352==t||49380==t||49408==t||49436==t||49464==t||49492==t||49520==t||49548==t||49576==t||49604==t||49632==t||49660==t||49688==t||49716==t||49744==t||49772==t||49800==t||49828==t||49856==t||49884==t||49912==t||49940==t||49968==t||49996==t||50024==t||50052==t||50080==t||50108==t||50136==t||50164==t||50192==t||50220==t||50248==t||50276==t||50304==t||50332==t||50360==t||50388==t||50416==t||50444==t||50472==t||50500==t||50528==t||50556==t||50584==t||50612==t||50640==t||50668==t||50696==t||50724==t||50752==t||50780==t||50808==t||50836==t||50864==t||50892==t||50920==t||50948==t||50976==t||51004==t||51032==t||51060==t||51088==t||51116==t||51144==t||51172==t||51200==t||51228==t||51256==t||51284==t||51312==t||51340==t||51368==t||51396==t||51424==t||51452==t||51480==t||51508==t||51536==t||51564==t||51592==t||51620==t||51648==t||51676==t||51704==t||51732==t||51760==t||51788==t||51816==t||51844==t||51872==t||51900==t||51928==t||51956==t||51984==t||52012==t||52040==t||52068==t||52096==t||52124==t||52152==t||52180==t||52208==t||52236==t||52264==t||52292==t||52320==t||52348==t||52376==t||52404==t||52432==t||52460==t||52488==t||52516==t||52544==t||52572==t||52600==t||52628==t||52656==t||52684==t||52712==t||52740==t||52768==t||52796==t||52824==t||52852==t||52880==t||52908==t||52936==t||52964==t||52992==t||53020==t||53048==t||53076==t||53104==t||53132==t||53160==t||53188==t||53216==t||53244==t||53272==t||53300==t||53328==t||53356==t||53384==t||53412==t||53440==t||53468==t||53496==t||53524==t||53552==t||53580==t||53608==t||53636==t||53664==t||53692==t||53720==t||53748==t||53776==t||53804==t||53832==t||53860==t||53888==t||53916==t||53944==t||53972==t||54e3==t||54028==t||54056==t||54084==t||54112==t||54140==t||54168==t||54196==t||54224==t||54252==t||54280==t||54308==t||54336==t||54364==t||54392==t||54420==t||54448==t||54476==t||54504==t||54532==t||54560==t||54588==t||54616==t||54644==t||54672==t||54700==t||54728==t||54756==t||54784==t||54812==t||54840==t||54868==t||54896==t||54924==t||54952==t||54980==t||55008==t||55036==t||55064==t||55092==t||55120==t||55148==t||55176==t){return y}if(44033<=t&&t<=44059||44061<=t&&t<=44087||44089<=t&&t<=44115||44117<=t&&t<=44143||44145<=t&&t<=44171||44173<=t&&t<=44199||44201<=t&&t<=44227||44229<=t&&t<=44255||44257<=t&&t<=44283||44285<=t&&t<=44311||44313<=t&&t<=44339||44341<=t&&t<=44367||44369<=t&&t<=44395||44397<=t&&t<=44423||44425<=t&&t<=44451||44453<=t&&t<=44479||44481<=t&&t<=44507||44509<=t&&t<=44535||44537<=t&&t<=44563||44565<=t&&t<=44591||44593<=t&&t<=44619||44621<=t&&t<=44647||44649<=t&&t<=44675||44677<=t&&t<=44703||44705<=t&&t<=44731||44733<=t&&t<=44759||44761<=t&&t<=44787||44789<=t&&t<=44815||44817<=t&&t<=44843||44845<=t&&t<=44871||44873<=t&&t<=44899||44901<=t&&t<=44927||44929<=t&&t<=44955||44957<=t&&t<=44983||44985<=t&&t<=45011||45013<=t&&t<=45039||45041<=t&&t<=45067||45069<=t&&t<=45095||45097<=t&&t<=45123||45125<=t&&t<=45151||45153<=t&&t<=45179||45181<=t&&t<=45207||45209<=t&&t<=45235||45237<=t&&t<=45263||45265<=t&&t<=45291||45293<=t&&t<=45319||45321<=t&&t<=45347||45349<=t&&t<=45375||45377<=t&&t<=45403||45405<=t&&t<=45431||45433<=t&&t<=45459||45461<=t&&t<=45487||45489<=t&&t<=45515||45517<=t&&t<=45543||45545<=t&&t<=45571||45573<=t&&t<=45599||45601<=t&&t<=45627||45629<=t&&t<=45655||45657<=t&&t<=45683||45685<=t&&t<=45711||45713<=t&&t<=45739||45741<=t&&t<=45767||45769<=t&&t<=45795||45797<=t&&t<=45823||45825<=t&&t<=45851||45853<=t&&t<=45879||45881<=t&&t<=45907||45909<=t&&t<=45935||45937<=t&&t<=45963||45965<=t&&t<=45991||45993<=t&&t<=46019||46021<=t&&t<=46047||46049<=t&&t<=46075||46077<=t&&t<=46103||46105<=t&&t<=46131||46133<=t&&t<=46159||46161<=t&&t<=46187||46189<=t&&t<=46215||46217<=t&&t<=46243||46245<=t&&t<=46271||46273<=t&&t<=46299||46301<=t&&t<=46327||46329<=t&&t<=46355||46357<=t&&t<=46383||46385<=t&&t<=46411||46413<=t&&t<=46439||46441<=t&&t<=46467||46469<=t&&t<=46495||46497<=t&&t<=46523||46525<=t&&t<=46551||46553<=t&&t<=46579||46581<=t&&t<=46607||46609<=t&&t<=46635||46637<=t&&t<=46663||46665<=t&&t<=46691||46693<=t&&t<=46719||46721<=t&&t<=46747||46749<=t&&t<=46775||46777<=t&&t<=46803||46805<=t&&t<=46831||46833<=t&&t<=46859||46861<=t&&t<=46887||46889<=t&&t<=46915||46917<=t&&t<=46943||46945<=t&&t<=46971||46973<=t&&t<=46999||47001<=t&&t<=47027||47029<=t&&t<=47055||47057<=t&&t<=47083||47085<=t&&t<=47111||47113<=t&&t<=47139||47141<=t&&t<=47167||47169<=t&&t<=47195||47197<=t&&t<=47223||47225<=t&&t<=47251||47253<=t&&t<=47279||47281<=t&&t<=47307||47309<=t&&t<=47335||47337<=t&&t<=47363||47365<=t&&t<=47391||47393<=t&&t<=47419||47421<=t&&t<=47447||47449<=t&&t<=47475||47477<=t&&t<=47503||47505<=t&&t<=47531||47533<=t&&t<=47559||47561<=t&&t<=47587||47589<=t&&t<=47615||47617<=t&&t<=47643||47645<=t&&t<=47671||47673<=t&&t<=47699||47701<=t&&t<=47727||47729<=t&&t<=47755||47757<=t&&t<=47783||47785<=t&&t<=47811||47813<=t&&t<=47839||47841<=t&&t<=47867||47869<=t&&t<=47895||47897<=t&&t<=47923||47925<=t&&t<=47951||47953<=t&&t<=47979||47981<=t&&t<=48007||48009<=t&&t<=48035||48037<=t&&t<=48063||48065<=t&&t<=48091||48093<=t&&t<=48119||48121<=t&&t<=48147||48149<=t&&t<=48175||48177<=t&&t<=48203||48205<=t&&t<=48231||48233<=t&&t<=48259||48261<=t&&t<=48287||48289<=t&&t<=48315||48317<=t&&t<=48343||48345<=t&&t<=48371||48373<=t&&t<=48399||48401<=t&&t<=48427||48429<=t&&t<=48455||48457<=t&&t<=48483||48485<=t&&t<=48511||48513<=t&&t<=48539||48541<=t&&t<=48567||48569<=t&&t<=48595||48597<=t&&t<=48623||48625<=t&&t<=48651||48653<=t&&t<=48679||48681<=t&&t<=48707||48709<=t&&t<=48735||48737<=t&&t<=48763||48765<=t&&t<=48791||48793<=t&&t<=48819||48821<=t&&t<=48847||48849<=t&&t<=48875||48877<=t&&t<=48903||48905<=t&&t<=48931||48933<=t&&t<=48959||48961<=t&&t<=48987||48989<=t&&t<=49015||49017<=t&&t<=49043||49045<=t&&t<=49071||49073<=t&&t<=49099||49101<=t&&t<=49127||49129<=t&&t<=49155||49157<=t&&t<=49183||49185<=t&&t<=49211||49213<=t&&t<=49239||49241<=t&&t<=49267||49269<=t&&t<=49295||49297<=t&&t<=49323||49325<=t&&t<=49351||49353<=t&&t<=49379||49381<=t&&t<=49407||49409<=t&&t<=49435||49437<=t&&t<=49463||49465<=t&&t<=49491||49493<=t&&t<=49519||49521<=t&&t<=49547||49549<=t&&t<=49575||49577<=t&&t<=49603||49605<=t&&t<=49631||49633<=t&&t<=49659||49661<=t&&t<=49687||49689<=t&&t<=49715||49717<=t&&t<=49743||49745<=t&&t<=49771||49773<=t&&t<=49799||49801<=t&&t<=49827||49829<=t&&t<=49855||49857<=t&&t<=49883||49885<=t&&t<=49911||49913<=t&&t<=49939||49941<=t&&t<=49967||49969<=t&&t<=49995||49997<=t&&t<=50023||50025<=t&&t<=50051||50053<=t&&t<=50079||50081<=t&&t<=50107||50109<=t&&t<=50135||50137<=t&&t<=50163||50165<=t&&t<=50191||50193<=t&&t<=50219||50221<=t&&t<=50247||50249<=t&&t<=50275||50277<=t&&t<=50303||50305<=t&&t<=50331||50333<=t&&t<=50359||50361<=t&&t<=50387||50389<=t&&t<=50415||50417<=t&&t<=50443||50445<=t&&t<=50471||50473<=t&&t<=50499||50501<=t&&t<=50527||50529<=t&&t<=50555||50557<=t&&t<=50583||50585<=t&&t<=50611||50613<=t&&t<=50639||50641<=t&&t<=50667||50669<=t&&t<=50695||50697<=t&&t<=50723||50725<=t&&t<=50751||50753<=t&&t<=50779||50781<=t&&t<=50807||50809<=t&&t<=50835||50837<=t&&t<=50863||50865<=t&&t<=50891||50893<=t&&t<=50919||50921<=t&&t<=50947||50949<=t&&t<=50975||50977<=t&&t<=51003||51005<=t&&t<=51031||51033<=t&&t<=51059||51061<=t&&t<=51087||51089<=t&&t<=51115||51117<=t&&t<=51143||51145<=t&&t<=51171||51173<=t&&t<=51199||51201<=t&&t<=51227||51229<=t&&t<=51255||51257<=t&&t<=51283||51285<=t&&t<=51311||51313<=t&&t<=51339||51341<=t&&t<=51367||51369<=t&&t<=51395||51397<=t&&t<=51423||51425<=t&&t<=51451||51453<=t&&t<=51479||51481<=t&&t<=51507||51509<=t&&t<=51535||51537<=t&&t<=51563||51565<=t&&t<=51591||51593<=t&&t<=51619||51621<=t&&t<=51647||51649<=t&&t<=51675||51677<=t&&t<=51703||51705<=t&&t<=51731||51733<=t&&t<=51759||51761<=t&&t<=51787||51789<=t&&t<=51815||51817<=t&&t<=51843||51845<=t&&t<=51871||51873<=t&&t<=51899||51901<=t&&t<=51927||51929<=t&&t<=51955||51957<=t&&t<=51983||51985<=t&&t<=52011||52013<=t&&t<=52039||52041<=t&&t<=52067||52069<=t&&t<=52095||52097<=t&&t<=52123||52125<=t&&t<=52151||52153<=t&&t<=52179||52181<=t&&t<=52207||52209<=t&&t<=52235||52237<=t&&t<=52263||52265<=t&&t<=52291||52293<=t&&t<=52319||52321<=t&&t<=52347||52349<=t&&t<=52375||52377<=t&&t<=52403||52405<=t&&t<=52431||52433<=t&&t<=52459||52461<=t&&t<=52487||52489<=t&&t<=52515||52517<=t&&t<=52543||52545<=t&&t<=52571||52573<=t&&t<=52599||52601<=t&&t<=52627||52629<=t&&t<=52655||52657<=t&&t<=52683||52685<=t&&t<=52711||52713<=t&&t<=52739||52741<=t&&t<=52767||52769<=t&&t<=52795||52797<=t&&t<=52823||52825<=t&&t<=52851||52853<=t&&t<=52879||52881<=t&&t<=52907||52909<=t&&t<=52935||52937<=t&&t<=52963||52965<=t&&t<=52991||52993<=t&&t<=53019||53021<=t&&t<=53047||53049<=t&&t<=53075||53077<=t&&t<=53103||53105<=t&&t<=53131||53133<=t&&t<=53159||53161<=t&&t<=53187||53189<=t&&t<=53215||53217<=t&&t<=53243||53245<=t&&t<=53271||53273<=t&&t<=53299||53301<=t&&t<=53327||53329<=t&&t<=53355||53357<=t&&t<=53383||53385<=t&&t<=53411||53413<=t&&t<=53439||53441<=t&&t<=53467||53469<=t&&t<=53495||53497<=t&&t<=53523||53525<=t&&t<=53551||53553<=t&&t<=53579||53581<=t&&t<=53607||53609<=t&&t<=53635||53637<=t&&t<=53663||53665<=t&&t<=53691||53693<=t&&t<=53719||53721<=t&&t<=53747||53749<=t&&t<=53775||53777<=t&&t<=53803||53805<=t&&t<=53831||53833<=t&&t<=53859||53861<=t&&t<=53887||53889<=t&&t<=53915||53917<=t&&t<=53943||53945<=t&&t<=53971||53973<=t&&t<=53999||54001<=t&&t<=54027||54029<=t&&t<=54055||54057<=t&&t<=54083||54085<=t&&t<=54111||54113<=t&&t<=54139||54141<=t&&t<=54167||54169<=t&&t<=54195||54197<=t&&t<=54223||54225<=t&&t<=54251||54253<=t&&t<=54279||54281<=t&&t<=54307||54309<=t&&t<=54335||54337<=t&&t<=54363||54365<=t&&t<=54391||54393<=t&&t<=54419||54421<=t&&t<=54447||54449<=t&&t<=54475||54477<=t&&t<=54503||54505<=t&&t<=54531||54533<=t&&t<=54559||54561<=t&&t<=54587||54589<=t&&t<=54615||54617<=t&&t<=54643||54645<=t&&t<=54671||54673<=t&&t<=54699||54701<=t&&t<=54727||54729<=t&&t<=54755||54757<=t&&t<=54783||54785<=t&&t<=54811||54813<=t&&t<=54839||54841<=t&&t<=54867||54869<=t&&t<=54895||54897<=t&&t<=54923||54925<=t&&t<=54951||54953<=t&&t<=54979||54981<=t&&t<=55007||55009<=t&&t<=55035||55037<=t&&t<=55063||55065<=t&&t<=55091||55093<=t&&t<=55119||55121<=t&&t<=55147||55149<=t&&t<=55175||55177<=t&&t<=55203){return v}if(9757==t||9977==t||9994<=t&&t<=9997||127877==t||127938<=t&&t<=127940||127943==t||127946<=t&&t<=127948||128066<=t&&t<=128067||128070<=t&&t<=128080||128110==t||128112<=t&&t<=128120||128124==t||128129<=t&&t<=128131||128133<=t&&t<=128135||128170==t||128372<=t&&t<=128373||128378==t||128400==t||128405<=t&&t<=128406||128581<=t&&t<=128583||128587<=t&&t<=128591||128675==t||128692<=t&&t<=128694||128704==t||128716==t||129304<=t&&t<=129308||129310<=t&&t<=129311||129318==t||129328<=t&&t<=129337||129341<=t&&t<=129342||129489<=t&&t<=129501){return x}if(127995<=t&&t<=127999){return b}if(8205==t){return A}if(9792==t||9794==t||9877<=t&&t<=9878||9992==t||10084==t||127752==t||127806==t||127859==t||127891==t||127908==t||127912==t||127979==t||127981==t||128139==t||128187<=t&&t<=128188||128295==t||128300==t||128488==t||128640==t||128658==t){return S}if(128102<=t&&t<=128105){return w}return e}return this}if(typeof module!="undefined"&&module.exports){module.exports=GraphemeSplitter}