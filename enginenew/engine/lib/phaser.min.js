(function(){var t=this;var W=W||{};window.PIXI=W;W.WEBGL_RENDERER=0;W.CANVAS_RENDERER=1;W.VERSION="v2.2.8";W._UID=0;if(typeof Float32Array!="undefined"){W.Float32Array=Float32Array;W.Uint16Array=Uint16Array;W.Uint32Array=Uint32Array;W.ArrayBuffer=ArrayBuffer}else{W.Float32Array=Array;W.Uint16Array=Array}W.PI_2=Math.PI*2;W.RAD_TO_DEG=180/Math.PI;W.DEG_TO_RAD=Math.PI/180;W.RETINA_PREFIX="@2x";W.defaultRenderOptions={view:null,transparent:false,antialias:false,preserveDrawingBuffer:false,resolution:1,clearBeforeRender:true,autoResize:false};W.sharedCanvas=document.createElement("canvas");W.DisplayObject=function(){this.position=new W.Point(0,0);this.scale=new W.Point(1,1);this.transformCallback=null;this.transformCallbackContext=null;this.pivot=new W.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.renderable=false;this.parent=null;this.stage=null;this.worldAlpha=1;this.worldTransform=new W.Matrix;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new W.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=false;this._cacheIsDirty=false};W.DisplayObject.prototype.constructor=W.DisplayObject;W.DisplayObject.prototype.destroy=function(){if(this.children){var t=this.children.length;while(t--){this.children[t].destroy()}this.children=[]}this.transformCallback=null;this.transformCallbackContext=null;this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this.renderable=false;this._destroyCachedSprite()};Object.defineProperty(W.DisplayObject.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return false;t=t.parent}while(t);return true}});Object.defineProperty(W.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){if(this._mask)this._mask.isMask=false;this._mask=t;if(this._mask)this._mask.isMask=true}});Object.defineProperty(W.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(t){if(t){var e=[];for(var i=0;i<t.length;i++){var s=t[i].passes;for(var n=0;n<s.length;n++){e.push(s[n])}}this._filterBlock={target:this,filterPasses:e}}this._filters=t}});Object.defineProperty(W.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){if(this._cacheAsBitmap===t)return;if(t){this._generateCachedSprite()}else{this._destroyCachedSprite()}this._cacheAsBitmap=t}});W.DisplayObject.prototype.updateTransform=function(){if(!this.parent){return}var t=this.parent.worldTransform;var e=this.worldTransform;var i,s,n,r,a,o;if(this.rotation%W.PI_2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}i=this._cr*this.scale.x;s=this._sr*this.scale.x;n=-this._sr*this.scale.y;r=this._cr*this.scale.y;a=this.position.x;o=this.position.y;if(this.pivot.x||this.pivot.y){a-=this.pivot.x*i+this.pivot.y*n;o-=this.pivot.x*s+this.pivot.y*r}e.a=i*t.a+s*t.c;e.b=i*t.b+s*t.d;e.c=n*t.a+r*t.c;e.d=n*t.b+r*t.d;e.tx=a*t.a+o*t.c+t.tx;e.ty=a*t.b+o*t.d+t.ty}else{i=this.scale.x;r=this.scale.y;a=this.position.x-this.pivot.x*i;o=this.position.y-this.pivot.y*r;e.a=i*t.a;e.b=i*t.b;e.c=r*t.c;e.d=r*t.d;e.tx=a*t.a+o*t.c+t.tx;e.ty=a*t.b+o*t.d+t.ty}this.worldAlpha=this.alpha*this.parent.worldAlpha;if(this.transformCallback){this.transformCallback.call(this.transformCallbackContext,e,t)}};W.DisplayObject.prototype.displayObjectUpdateTransform=W.DisplayObject.prototype.updateTransform;W.DisplayObject.prototype.getBounds=function(t){t=t;return W.EmptyRectangle};W.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(W.identityMatrix)};W.DisplayObject.prototype.setStageReference=function(t){this.stage=t};W.DisplayObject.prototype.preUpdate=function(){};W.DisplayObject.prototype.generateTexture=function(t,e,i){var s=this.getLocalBounds();var n=new W.RenderTexture(s.width|0,s.height|0,i,e,t);W.DisplayObject._tempMatrix.tx=-s.x;W.DisplayObject._tempMatrix.ty=-s.y;n.render(this,W.DisplayObject._tempMatrix);return n};W.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};W.DisplayObject.prototype.toGlobal=function(t){this.displayObjectUpdateTransform();return this.worldTransform.apply(t)};W.DisplayObject.prototype.toLocal=function(t,e){if(e){t=e.toGlobal(t)}this.displayObjectUpdateTransform();return this.worldTransform.applyInverse(t)};W.DisplayObject.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha;if(t.gl){W.Sprite.prototype._renderWebGL.call(this._cachedSprite,t)}else{W.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)}};W.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=false;var t=this.getLocalBounds();if(!this._cachedSprite){var e=new W.RenderTexture(t.width|0,t.height|0);this._cachedSprite=new W.Sprite(e);this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.texture.resize(t.width|0,t.height|0)}var i=this._filters;this._filters=null;this._cachedSprite.filters=i;W.DisplayObject._tempMatrix.tx=-t.x;W.DisplayObject._tempMatrix.ty=-t.y;this._cachedSprite.texture.render(this,W.DisplayObject._tempMatrix,true);this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._filters=i;this._cacheAsBitmap=true};W.DisplayObject.prototype._destroyCachedSprite=function(){if(!this._cachedSprite)return;this._cachedSprite.texture.destroy(true);this._cachedSprite=null};W.DisplayObject.prototype._renderWebGL=function(t){t=t};W.DisplayObject.prototype._renderCanvas=function(t){t=t};Object.defineProperty(W.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}});Object.defineProperty(W.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}});W.DisplayObjectContainer=function(){W.DisplayObject.call(this);this.children=[]};W.DisplayObjectContainer.prototype=Object.create(W.DisplayObject.prototype);W.DisplayObjectContainer.prototype.constructor=W.DisplayObjectContainer;Object.defineProperty(W.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;if(e!==0){this.scale.x=t/e}else{this.scale.x=1}this._width=t}});Object.defineProperty(W.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;if(e!==0){this.scale.y=t/e}else{this.scale.y=1}this._height=t}});W.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)};W.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length){if(t.parent){t.parent.removeChild(t)}t.parent=this;this.children.splice(e,0,t);if(this.stage)t.setStageReference(this.stage);return t}else{throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)}};W.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t===e){return}var i=this.getChildIndex(t);var s=this.getChildIndex(e);if(i<0||s<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.")}this.children[i]=e;this.children[s]=t};W.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(e===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return e};W.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length){throw new Error("The supplied index is out of bounds")}var i=this.getChildIndex(t);this.children.splice(i,1);this.children.splice(e,0,t)};W.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length){throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller")}return this.children[t]};W.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(e===-1)return;return this.removeChildAt(e)};W.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);if(this.stage)e.removeStageReference();e.parent=undefined;this.children.splice(t,1);return e};W.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0;var s=typeof e==="number"?e:this.children.length;var n=s-i;if(n>0&&n<=s){var r=this.children.splice(i,n);for(var a=0;a<r.length;a++){var o=r[a];if(this.stage)o.removeStageReference();o.parent=undefined}return r}else if(n===0&&this.children.length===0){return[]}else{throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")}};W.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible)return;this.displayObjectUpdateTransform();if(this._cacheAsBitmap)return;for(var t=0,e=this.children.length;t<e;t++){this.children[t].updateTransform()}};W.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=W.DisplayObjectContainer.prototype.updateTransform;W.DisplayObjectContainer.prototype.getBounds=function(){if(this.children.length===0)return W.EmptyRectangle;var t=Infinity;var e=Infinity;var i=-Infinity;var s=-Infinity;var n;var r;var a;var o=false;for(var h=0,l=this.children.length;h<l;h++){var u=this.children[h];if(!u.visible)continue;o=true;n=this.children[h].getBounds();t=t<n.x?t:n.x;e=e<n.y?e:n.y;r=n.width+n.x;a=n.height+n.y;i=i>r?i:r;s=s>a?s:a}if(!o)return W.EmptyRectangle;var f=this._bounds;f.x=t;f.y=e;f.width=i-t;f.height=s-e;return f};W.DisplayObjectContainer.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=W.identityMatrix;for(var e=0,i=this.children.length;e<i;e++){this.children[e].updateTransform()}var s=this.getBounds();this.worldTransform=t;return s};W.DisplayObjectContainer.prototype.setStageReference=function(t){this.stage=t;for(var e=0;e<this.children.length;e++){this.children[e].setStageReference(t)}};W.DisplayObjectContainer.prototype.removeStageReference=function(){for(var t=0;t<this.children.length;t++){this.children[t].removeStageReference()}this.stage=null};W.DisplayObjectContainer.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0)return;if(this._cacheAsBitmap){this._renderCachedSprite(t);return}var e;if(this._mask||this._filters){if(this._filters){t.spriteBatch.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){t.spriteBatch.stop();t.maskManager.pushMask(this.mask,t);t.spriteBatch.start()}for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}t.spriteBatch.stop();if(this._mask)t.maskManager.popMask(this._mask,t);if(this._filters)t.filterManager.popFilter();t.spriteBatch.start()}else{for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}}};W.DisplayObjectContainer.prototype._renderCanvas=function(t){if(this.visible===false||this.alpha===0)return;if(this._cacheAsBitmap){this._renderCachedSprite(t);return}if(this._mask){t.maskManager.pushMask(this._mask,t)}for(var e=0;e<this.children.length;e++){this.children[e]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}};W.Sprite=function(t){W.DisplayObjectContainer.call(this);this.anchor=new W.Point;this.texture=t||W.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.blendMode=W.blendModes.NORMAL;this.shader=null;if(this.texture.baseTexture.hasLoaded){this.onTextureUpdate()}this.renderable=true};W.Sprite.prototype=Object.create(W.DisplayObjectContainer.prototype);W.Sprite.prototype.constructor=W.Sprite;Object.defineProperty(W.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width;this._width=t}});Object.defineProperty(W.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height;this._height=t}});W.Sprite.prototype.setTexture=function(t){this.texture=t;this.cachedTint=16777215};W.Sprite.prototype.onTextureUpdate=function(){if(this._width)this.scale.x=this._width/this.texture.frame.width;if(this._height)this.scale.y=this._height/this.texture.frame.height};W.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width;var i=this.texture.frame.height;var s=e*(1-this.anchor.x);var n=e*-this.anchor.x;var r=i*(1-this.anchor.y);var a=i*-this.anchor.y;var o=t||this.worldTransform;var h=o.a;var l=o.b;var u=o.c;var f=o.d;var c=o.tx;var d=o.ty;var p=-Infinity;var g=-Infinity;var m=Infinity;var y=Infinity;if(l===0&&u===0){if(h<0)h*=-1;if(f<0)f*=-1;m=h*n+c;p=h*s+c;y=f*a+d;g=f*r+d}else{var v=h*n+u*a+c;var x=f*a+l*n+d;var b=h*s+u*a+c;var _=f*a+l*s+d;var w=h*s+u*r+c;var T=f*r+l*s+d;var C=h*n+u*r+c;var S=f*r+l*n+d;m=v<m?v:m;m=b<m?b:m;m=w<m?w:m;m=C<m?C:m;y=x<y?x:y;y=_<y?_:y;y=T<y?T:y;y=S<y?S:y;p=v>p?v:p;p=b>p?b:p;p=w>p?w:p;p=C>p?C:p;g=x>g?x:g;g=_>g?_:g;g=T>g?T:g;g=S>g?S:g}var P=this._bounds;P.x=m;P.width=p-m;P.y=y;P.height=g-y;this._currentBounds=P;return P};W.Sprite.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0||!this.renderable)return;var e,i;if(this._mask||this._filters){var s=t.spriteBatch;if(this._filters){s.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){s.stop();t.maskManager.pushMask(this.mask,t);s.start()}s.render(this);for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}s.stop();if(this._mask)t.maskManager.popMask(this._mask,t);if(this._filters)t.filterManager.popFilter();s.start()}else{t.spriteBatch.render(this);for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}}};W.Sprite.prototype._renderCanvas=function(t){if(this.visible===false||this.alpha===0||this.renderable===false||this.texture.crop.width<=0||this.texture.crop.height<=0)return;if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;t.context.globalCompositeOperation=W.blendModesCanvas[t.currentBlendMode]}if(this._mask){t.maskManager.pushMask(this._mask,t)}if(this.texture.valid){var e=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha;if(t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode){t.scaleMode=this.texture.baseTexture.scaleMode;t.context[t.smoothProperty]=t.scaleMode===W.scaleModes.LINEAR}var i=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var s=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;if(t.roundPixels){t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0);i=i|0;s=s|0}else{t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution)}if(this.tint!==16777215){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;this.tintedTexture=W.CanvasTinter.getTintedTexture(this,this.tint)}t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,i/e,s/e,this.texture.crop.width/e,this.texture.crop.height/e)}else{t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,i/e,s/e,this.texture.crop.width/e,this.texture.crop.height/e)}}for(var n=0;n<this.children.length;n++){this.children[n]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}};W.Sprite.fromFrame=function(t){var e=W.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new W.Sprite(e)};W.Sprite.fromImage=function(t,e,i){var s=W.Texture.fromImage(t,e,i);return new W.Sprite(s)};W.SpriteBatch=function(t){W.DisplayObjectContainer.call(this);this.textureThing=t;this.ready=false};W.SpriteBatch.prototype=Object.create(W.DisplayObjectContainer.prototype);W.SpriteBatch.prototype.constructor=W.SpriteBatch;W.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new W.WebGLFastSpriteBatch(t);this.ready=true};W.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};W.SpriteBatch.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0||!this.children.length)return;if(!this.ready){this.initWebGL(t.gl)}if(this.fastSpriteBatch.gl!==t.gl){this.fastSpriteBatch.setContext(t.gl)}t.spriteBatch.stop();t.shaderManager.setShader(t.shaderManager.fastShader);this.fastSpriteBatch.begin(this,t);this.fastSpriteBatch.render(this);t.spriteBatch.start()};W.SpriteBatch.prototype._renderCanvas=function(t){if(!this.visible||this.alpha<=0||!this.children.length)return;var e=t.context;e.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();var i=this.worldTransform;var s=true;for(var n=0;n<this.children.length;n++){var r=this.children[n];if(!r.visible)continue;var a=r.texture;var o=a.frame;e.globalAlpha=this.worldAlpha*r.alpha;if(r.rotation%(Math.PI*2)===0){if(s){e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty);s=false}e.drawImage(a.baseTexture.source,o.x,o.y,o.width,o.height,r.anchor.x*(-o.width*r.scale.x)+r.position.x+.5|0,r.anchor.y*(-o.height*r.scale.y)+r.position.y+.5|0,o.width*r.scale.x,o.height*r.scale.y)}else{if(!s)s=true;r.displayObjectUpdateTransform();var h=r.worldTransform;if(t.roundPixels){e.setTransform(h.a,h.b,h.c,h.d,h.tx|0,h.ty|0)}else{e.setTransform(h.a,h.b,h.c,h.d,h.tx,h.ty)}e.drawImage(a.baseTexture.source,o.x,o.y,o.width,o.height,r.anchor.x*-o.width+.5|0,r.anchor.y*-o.height+.5|0,o.width,o.height)}}};W.Text=function(t,e,i){this.resolution=1;var s;if(t.renderType===Phaser.WEBGL){if(!W.Text.drawCanvas){W.Text.drawCanvas=document.createElement("canvas");W.Text.drawContext=W.Text.drawCanvas.getContext("2d");W.Text.drawSprite=W.Texture.fromCanvas(W.Text.drawCanvas)}this.canvas=W.Text.drawCanvas;this.context=W.Text.drawContext;s=this._frameTexture=new qc.RenderTexture(0,0);this._canvasMode=false}else{this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");s=W.Texture.fromCanvas(this.canvas);this._canvasMode=true}W.Sprite.call(this,s);this.setText(e);this.setStyle(i)};W.Text.prototype=Object.create(W.Sprite.prototype);W.Text.prototype.constructor=W.Text;Object.defineProperty(W.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width;this._width=t}});Object.defineProperty(W.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height;this._height=t}});W.Text.prototype.setStyle=function(t){t=t||{};t.font=t.font||"bold 20pt Arial";t.fill=t.fill||"black";t.align=t.align||"left";t.stroke=t.stroke||"black";t.strokeThickness=t.strokeThickness||0;t.wordWrap=t.wordWrap||false;t.wordWrapWidth=t.wordWrapWidth||100;t.dropShadow=t.dropShadow||false;t.dropShadowAngle=t.dropShadowAngle||Math.PI/6;t.dropShadowDistance=t.dropShadowDistance||4;t.dropShadowColor=t.dropShadowColor||"black";this.style=t;this.dirty=true};W.Text.prototype.setText=function(t){this.text=t.toString()||" ";this.dirty=true};W.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var t=this.text;if(this.style.wordWrap)t=this.wordWrap(this.text);var e=t.split(/(?:\r\n|\r|\n)/);var i=[];var s=0;var n=this.determineFontProperties(this.style.font);for(var r=0;r<e.length;r++){var a=this.context.measureText(e[r]).width;i[r]=a;s=Math.max(s,a)}var o=s+this.style.strokeThickness;if(this.style.dropShadow)o+=this.style.dropShadowDistance;this.canvas.width=(o+this.context.lineWidth)*this.resolution;var h=n.fontSize+this.style.strokeThickness;var l=h*e.length;if(this.style.dropShadow)l+=this.style.dropShadowDistance;this.canvas.height=l*this.resolution;this.context.scale(this.resolution,this.resolution);if(navigator.isCocoonJS)this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline="alphabetic";var u;var f;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var c=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance;var d=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(r=0;r<e.length;r++){u=this.style.strokeThickness/2;f=this.style.strokeThickness/2+r*h+n.ascent;if(this.style.align==="right"){u+=s-i[r]}else if(this.style.align==="center"){u+=(s-i[r])/2}if(this.style.fill){this.context.fillText(e[r],u+c,f+d)}}}this.context.fillStyle=this.style.fill;for(r=0;r<e.length;r++){u=this.style.strokeThickness/2;f=this.style.strokeThickness/2+r*h+n.ascent;if(this.style.align==="right"){u+=s-i[r]}else if(this.style.align==="center"){u+=(s-i[r])/2}if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(e[r],u,f)}if(this.style.fill){this.context.fillText(e[r],u,f)}}this.updateTexture()};W.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.texture.baseTexture.dirty()};W.Text.prototype._renderWebGL=function(t){if(this.dirty){this.resolution=t.resolution;this.updateText();this.dirty=false}W.Sprite.prototype._renderWebGL.call(this,t)};W.Text.prototype._renderCanvas=function(t){if(this.dirty){this.resolution=t.resolution;this.updateText();this.dirty=false}W.Sprite.prototype._renderCanvas.call(this,t)};W.Text.prototype.determineFontProperties=function(t){var e=W.Text.fontPropertiesCache[t];if(!e){e={};if(!W.Text.fontPropertiesCanvas){W.Text.fontPropertiesCanvas=document.createElement("canvas");W.Text.fontPropertiesContext=W.Text.fontPropertiesCanvas.getContext("2d")}var i=W.Text.fontPropertiesCanvas;var s=W.Text.fontPropertiesContext;s.font=t;var n=Math.ceil(s.measureText("|MÉq").width);var r=Math.ceil(s.measureText("|MÉq").width);var a=2*r;r=r*1.4|0;i.width=n;i.height=a;s.fillStyle="#f00";s.fillRect(0,0,n,a);s.font=t;s.textBaseline="alphabetic";s.fillStyle="#000";s.fillText("|MÉq",0,r);var o=s.getImageData(0,0,n,a).data;var h=o.length;var l=n*4;var u,f;var c=0;var d=false;for(u=0;u<r;u++){for(f=0;f<l;f+=4){if(o[c+f]!==255){d=true;break}}if(!d){c+=l}else{break}}e.ascent=r-u;c=h-l;d=false;for(u=a;u>r;u--){for(f=0;f<l;f+=4){if(o[c+f]!==255){d=true;break}}if(!d){c-=l}else{break}}e.descent=u-r;e.descent+=6;e.fontSize=e.ascent+e.descent;W.Text.fontPropertiesCache[t]=e}return e};W.Text.prototype.wordWrap=function(t){var e="";var i=t.split("\n");for(var s=0;s<i.length;s++){var n=this.style.wordWrapWidth;var r=i[s].split(" ");for(var a=0;a<r.length;a++){var o=this.context.measureText(r[a]).width;var h=o+this.context.measureText(" ").width;if(a===0||h>n){if(a>0){e+="\n"}e+=r[a];n=this.style.wordWrapWidth-o}else{n-=h;e+=" "+r[a]}}if(s<i.length-1){e+="\n"}}return e};W.Text.prototype.getBounds=function(t){if(this.dirty){this.updateText();this.dirty=false}return W.Sprite.prototype.getBounds.call(this,t)};W.Text.prototype.destroy=function(t){this.context=null;this.canvas=null;this.texture.destroy(t===undefined?true:t)};W.Text.fontPropertiesCache={};W.Text.fontPropertiesCanvas=null;W.Text.fontPropertiesContext=null;W.BitmapText=function(t,e){W.DisplayObjectContainer.call(this);this.textWidth=0;this.textHeight=0;this.maxWidth=0;this.anchor=new Phaser.Point(0,0);this._prevAnchor=new Phaser.Point(0,0);this._pool=[];this.setText(t);this.setStyle(e);this.updateText();this.dirty=false};W.BitmapText.prototype=Object.create(W.DisplayObjectContainer.prototype);W.BitmapText.prototype.constructor=W.BitmapText;W.BitmapText.prototype.setText=function(t){this.text=t||" ";this.dirty=true};W.BitmapText.prototype.setStyle=function(t){t=t||{};t.align=t.align||"left";this.style=t;var e=t.font.split(" ");this.fontName=e[e.length-1];this.fontSize=e.length>=2?parseInt(e[e.length-2],10):W.BitmapText.fonts[this.fontName].size;this.dirty=true;this.tint=t.tint};W.BitmapText.prototype.updateText=function(){var t=W.BitmapText.fonts[this.fontName];var e=new W.Point;var i=null;var s=[];var n=0;var r=[];var a=0;var o=this.fontSize/t.size;var h=0;for(var l=0;l<this.text.length;l++){var u=this.text.charCodeAt(l);h=/(\s)/.test(this.text.charAt(l))?l:h;if(/(?:\r\n|\r|\n)/.test(this.text.charAt(l))){r.push(e.x);n=Math.max(n,e.x);a++;e.x=0;e.y+=t.lineHeight;i=null;continue}if(h!==-1&&this.maxWidth>0&&e.x*o>this.maxWidth){s.splice(h,l-h);l=h;h=-1;r.push(lastLineWidth);n=Math.max(n,lastLineWidth);a++;e.x=0;e.y+=t.lineHeight;i=null;continue}var f=t.chars[u];if(!f)continue;if(i&&f.kerning[i]){e.x+=f.kerning[i]}s.push({texture:f.texture,line:a,charCode:u,position:new W.Point(e.x+f.xOffset,e.y+f.yOffset)});e.x+=f.xAdvance;i=u}r.push(e.x);n=Math.max(n,e.x);var c=[];for(l=0;l<=a;l++){var d=0;if(this.style.align==="right"){d=n-r[l]}else if(this.style.align==="center"){d=(n-r[l])/2}c.push(d)}var p=this.children.length;var g=s.length;var m=this.tint||16777215;this.textWidth=n*o;this.textHeight=(e.y+t.lineHeight)*o;var y=this.textWidth*this.anchor.x;var v=this.textHeight*this.anchor.y;for(l=0;l<g;l++){var x=l<p?this.children[l]:this._pool.pop();if(x)x.setTexture(s[l].texture);else x=new W.Sprite(s[l].texture);x.position.x=(s[l].position.x+c[s[l].line])*o-y;x.position.y=s[l].position.y*o-v;x.scale.x=x.scale.y=o;x.tint=m;if(!x.parent)this.addChild(x)}while(this.children.length>g){var b=this.getChildAt(this.children.length-1);this._pool.push(b);this.removeChild(b)}};W.BitmapText.prototype.updateTransform=function(){if(this.dirty||!this.anchor.equals(this._prevAnchor)){this.updateText();this.dirty=false;this._prevAnchor.copyFrom(this.anchor)}W.DisplayObjectContainer.prototype.updateTransform.call(this)};W.BitmapText.fonts={};W.Stage=function(t){W.DisplayObjectContainer.call(this);this.worldTransform=new W.Matrix;this.stage=this;this.setBackgroundColor(t)};W.Stage.prototype=Object.create(W.DisplayObjectContainer.prototype);W.Stage.prototype.constructor=W.Stage;W.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0;t<this.children.length;t++){this.children[t].updateTransform()}};W.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0;this.backgroundColorSplit=W.hex2rgb(this.backgroundColor);var e=this.backgroundColor.toString(16);e="000000".substr(0,6-e.length)+e;this.backgroundColorString="#"+e};W.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]};W.rgb2hex=function(t){return(t[0]*255<<16)+(t[1]*255<<8)+t[2]*255};W.canUseNewCanvasBlendModes=function(){if(typeof document==="undefined")return false;var t=W.sharedCanvas;t.width=1;t.height=1;var e=t.getContext("2d");e.globalCompositeOperation="multiply";e.fillStyle="rgb(255,0,255)";e.fillRect(0,0,1,1);e.fillStyle="rgb(255,255,0)";e.fillRect(0,0,1,1);var i=e.getImageData(0,0,1,1).data;return e.globalCompositeOperation==="multiply"&&i[0]===255&&i[1]===0&&i[2]===0};W.getNextPowerOfTwo=function(t){if(t>0&&(t&t-1)===0)return t;else{var e=1;while(e<t)e<<=1;return e}};W.isPowerOfTwo=function(t,e){return t>0&&(t&t-1)===0&&e>0&&(e&e-1)===0};W.PolyK={};W.PolyK.Triangulate=function(t){var e=true;var i=t.length>>1;if(i<3)return[];var s=[];var n=[];for(var r=0;r<i;r++)n.push(r);r=0;var a=i;while(a>3){var o=n[(r+0)%a];var h=n[(r+1)%a];var l=n[(r+2)%a];var u=t[2*o],f=t[2*o+1];var c=t[2*h],d=t[2*h+1];var p=t[2*l],g=t[2*l+1];var m=false;if(W.PolyK._convex(u,f,c,d,p,g,e)){m=true;for(var y=0;y<a;y++){var v=n[y];if(v===o||v===h||v===l)continue;if(W.PolyK._PointInTriangle(t[2*v],t[2*v+1],u,f,c,d,p,g)){m=false;break}}}if(m){s.push(o,h,l);n.splice((r+1)%a,1);a--;r=0}else if(r++>3*a){if(e){s=[];n=[];for(r=0;r<i;r++)n.push(r);r=0;a=i;e=false}else{return null}}}s.push(n[0],n[1],n[2]);return s};W.PolyK._PointInTriangle=function(t,e,i,s,n,r,a,o){var h=a-i;var l=o-s;var u=n-i;var f=r-s;var c=t-i;var d=e-s;var p=h*h+l*l;var g=h*u+l*f;var m=h*c+l*d;var y=u*u+f*f;var v=u*c+f*d;var x=1/(p*y-g*g);var b=(y*m-g*v)*x;var _=(p*v-g*m)*x;return b>=0&&_>=0&&b+_<1};W.PolyK._convex=function(t,e,i,s,n,r,a){return(e-s)*(n-i)+(i-t)*(r-s)>=0===a};W.initDefaultShaders=function(){};W.CompileVertexShader=function(t,e){return W._CompileShader(t,e,t.VERTEX_SHADER)};W.CompileFragmentShader=function(t,e){return W._CompileShader(t,e,t.FRAGMENT_SHADER)};W._CompileShader=function(t,e,i){var s=e.join("\n");var n=t.createShader(i);t.shaderSource(n,s);t.compileShader(n);if(!t.getShaderParameter(n,t.COMPILE_STATUS)){window.console.log(t.getShaderInfoLog(n));return null}return n};W.compileProgram=function(t,e,i){var s=W.CompileFragmentShader(t,i);var n=W.CompileVertexShader(t,e);var r=t.createProgram();t.attachShader(r,n);t.attachShader(r,s);t.linkProgram(r);if(!t.getProgramParameter(r,t.LINK_STATUS)){window.console.log("Could not initialise shaders")}return r};W.PixiShader=function(t){this._UID=W._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.firstRun=true;this.dirty=true;this.attributes=[];this.init()};W.PixiShader.prototype.constructor=W.PixiShader;W.PixiShader.prototype.init=function(){var t=this.gl;var e=W.compileProgram(t,this.vertexSrc||W.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(e);this.uSampler=t.getUniformLocation(e,"uSampler");this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.dimensions=t.getUniformLocation(e,"dimensions");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");this.colorAttribute=t.getAttribLocation(e,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var i in this.uniforms){this.uniforms[i].uniformLocation=t.getUniformLocation(e,i)}this.initUniforms();this.program=e};W.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t=this.gl;var e;for(var i in this.uniforms){e=this.uniforms[i];var s=e.type;if(s==="sampler2D"){e._init=false;if(e.value!==null){this.initSampler2D(e)}}else if(s==="mat2"||s==="mat3"||s==="mat4"){e.glMatrix=true;e.glValueLength=1;if(s==="mat2"){e.glFunc=t.uniformMatrix2fv}else if(s==="mat3"){e.glFunc=t.uniformMatrix3fv}else if(s==="mat4"){e.glFunc=t.uniformMatrix4fv}}else{e.glFunc=t["uniform"+s];if(s==="2f"||s==="2i"){e.glValueLength=2}else if(s==="3f"||s==="3i"){e.glValueLength=3}else if(s==="4f"||s==="4i"){e.glValueLength=4}else{e.glValueLength=1}}}};W.PixiShader.prototype.initSampler2D=function(t){if(!t.value||!t.value.baseTexture||!t.value.baseTexture.hasLoaded){return}var e=this.gl;e.activeTexture(e["TEXTURE"+this.textureCount]);e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]);if(t.textureData){var i=t.textureData;var s=i.magFilter?i.magFilter:e.LINEAR;var n=i.minFilter?i.minFilter:e.LINEAR;var r=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE;var a=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE;var o=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat){r=e.REPEAT;a=e.REPEAT}e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY);if(i.width){var h=i.width?i.width:512;var l=i.height?i.height:2;var u=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,o,h,l,u,o,e.UNSIGNED_BYTE,null)}else{e.texImage2D(e.TEXTURE_2D,0,o,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source)}e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,s);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,r);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a)}e.uniform1i(t.uniformLocation,this.textureCount);t._init=true;this.textureCount++};W.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t;var e=this.gl;for(var i in this.uniforms){t=this.uniforms[i];if(t.glValueLength===1){if(t.glMatrix===true){t.glFunc.call(e,t.uniformLocation,t.transpose,t.value)}else{t.glFunc.call(e,t.uniformLocation,t.value)}}else if(t.glValueLength===2){t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y)}else if(t.glValueLength===3){t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z)}else if(t.glValueLength===4){t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w)}else if(t.type==="sampler2D"){if(t._init){e.activeTexture(e["TEXTURE"+this.textureCount]);if(t.value.baseTexture._dirty[e.id]){W.instances[e.id].updateTexture(t.value.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id])}e.uniform1i(t.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(t)}}}};W.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};W.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];W.PixiFastShader=function(t){this._UID=W._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};W.PixiFastShader.prototype.constructor=W.PixiFastShader;W.PixiFastShader.prototype.init=function(){var t=this.gl;var e=W.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.uSampler=t.getUniformLocation(e,"uSampler");this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.dimensions=t.getUniformLocation(e,"dimensions");this.uMatrix=t.getUniformLocation(e,"uMatrix");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.aPositionCoord=t.getAttribLocation(e,"aPositionCoord");this.aScale=t.getAttribLocation(e,"aScale");this.aRotation=t.getAttribLocation(e,"aRotation");this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");this.colorAttribute=t.getAttribLocation(e,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=e};W.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};W.StripShader=function(t){this._UID=W._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};W.StripShader.prototype.constructor=W.StripShader;W.StripShader.prototype.init=function(){var t=this.gl;var e=W.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.uSampler=t.getUniformLocation(e,"uSampler");this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.colorAttribute=t.getAttribLocation(e,"aColor");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=t.getUniformLocation(e,"translationMatrix");this.alpha=t.getUniformLocation(e,"alpha");this.program=e};W.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};W.PrimitiveShader=function(t){this._UID=W._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};W.PrimitiveShader.prototype.constructor=W.PrimitiveShader;W.PrimitiveShader.prototype.init=function(){var t=this.gl;var e=W.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.tintColor=t.getUniformLocation(e,"tint");this.flipY=t.getUniformLocation(e,"flipY");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.colorAttribute=t.getAttribLocation(e,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(e,"translationMatrix");this.alpha=t.getUniformLocation(e,"alpha");this.program=e};W.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};W.ComplexPrimitiveShader=function(t){this._UID=W._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};W.ComplexPrimitiveShader.prototype.constructor=W.ComplexPrimitiveShader;W.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl;var e=W.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.tintColor=t.getUniformLocation(e,"tint");this.color=t.getUniformLocation(e,"color");this.flipY=t.getUniformLocation(e,"flipY");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(e,"translationMatrix");this.alpha=t.getUniformLocation(e,"alpha");this.program=e};W.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};W.WebGLGraphics=function(){};W.WebGLGraphics.renderGraphics=function(t,e){var i=e.gl;var s=e.projection,n=e.offset,r=e.shaderManager.primitiveShader,a;if(t.dirty){W.WebGLGraphics.updateGraphics(t,i)}var o=t._webGL[i.id];for(var h=0;h<o.data.length;h++){if(o.data[h].mode===1){a=o.data[h];e.stencilManager.pushStencil(t,a,e);i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,(a.indices.length-4)*2);e.stencilManager.popStencil(t,a,e)}else{a=o.data[h];e.shaderManager.setShader(r);r=e.shaderManager.primitiveShader;i.uniformMatrix3fv(r.translationMatrix,false,t.worldTransform.toArray(true));i.uniform1f(r.flipY,1);i.uniform2f(r.projectionVector,s.x,-s.y);i.uniform2f(r.offsetVector,-n.x,-n.y);i.uniform3fv(r.tintColor,W.hex2rgb(t.tint));i.uniform1f(r.alpha,t.worldAlpha);i.bindBuffer(i.ARRAY_BUFFER,a.buffer);i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,false,4*6,0);i.vertexAttribPointer(r.colorAttribute,4,i.FLOAT,false,4*6,2*4);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a.indexBuffer);i.drawElements(i.TRIANGLE_STRIP,a.indices.length,i.UNSIGNED_SHORT,0)}}};W.WebGLGraphics.updateGraphics=function(t,e){var i=t._webGL[e.id];if(!i)i=t._webGL[e.id]={lastIndex:0,data:[],gl:e};t.dirty=false;var s;if(t.clearDirty){t.clearDirty=false;for(s=0;s<i.data.length;s++){var n=i.data[s];n.reset();W.WebGLGraphics.graphicsDataPool.push(n)}i.data=[];i.lastIndex=0}var r;for(s=i.lastIndex;s<t.graphicsData.length;s++){var a=t.graphicsData[s];if(a.type===W.Graphics.POLY){a.points=a.shape.points.slice();if(a.shape.closed){if(a.points[0]!==a.points[a.points.length-2]||a.points[1]!==a.points[a.points.length-1]){a.points.push(a.points[0],a.points[1])}}if(a.fill){if(a.points.length>=6){if(a.points.length<6*2){r=W.WebGLGraphics.switchMode(i,0);var o=W.WebGLGraphics.buildPoly(a,r);if(!o){r=W.WebGLGraphics.switchMode(i,1);W.WebGLGraphics.buildComplexPoly(a,r)}}else{r=W.WebGLGraphics.switchMode(i,1);W.WebGLGraphics.buildComplexPoly(a,r)}}}if(a.lineWidth>0){r=W.WebGLGraphics.switchMode(i,0);W.WebGLGraphics.buildLine(a,r)}}else{r=W.WebGLGraphics.switchMode(i,0);if(a.type===W.Graphics.RECT){W.WebGLGraphics.buildRectangle(a,r)}else if(a.type===W.Graphics.CIRC||a.type===W.Graphics.ELIP){W.WebGLGraphics.buildCircle(a,r)}else if(a.type===W.Graphics.RREC){W.WebGLGraphics.buildRoundedRectangle(a,r)}}i.lastIndex++}for(s=0;s<i.data.length;s++){r=i.data[s];if(r.dirty)r.upload()}};W.WebGLGraphics.switchMode=function(t,e){var i;if(!t.data.length){i=W.WebGLGraphics.graphicsDataPool.pop()||new W.WebGLGraphicsData(t.gl);i.mode=e;t.data.push(i)}else{i=t.data[t.data.length-1];if(i.mode!==e||e===1){i=W.WebGLGraphics.graphicsDataPool.pop()||new W.WebGLGraphicsData(t.gl);i.mode=e;t.data.push(i)}}i.dirty=true;return i};W.WebGLGraphics.buildRectangle=function(t,e){var i=t.shape;var s=i.x;var n=i.y;var r=i.width;var a=i.height;if(t.fill){var o=W.hex2rgb(t.fillColor);var h=t.fillAlpha;var l=o[0]*h;var u=o[1]*h;var f=o[2]*h;var c=e.points;var d=e.indices;var p=c.length/6;c.push(s,n);c.push(l,u,f,h);c.push(s+r,n);c.push(l,u,f,h);c.push(s,n+a);c.push(l,u,f,h);c.push(s+r,n+a);c.push(l,u,f,h);d.push(p,p,p+1,p+2,p+3,p+3)}if(t.lineWidth){var g=t.points;t.points=[s,n,s+r,n,s+r,n+a,s,n+a,s,n];W.WebGLGraphics.buildLine(t,e);t.points=g}};W.WebGLGraphics.buildRoundedRectangle=function(t,e){var i=t.shape;var s=i.x;var n=i.y;var r=i.width;var a=i.height;var o=i.radius;var h=[];h.push(s,n+o);h=h.concat(W.WebGLGraphics.quadraticBezierCurve(s,n+a-o,s,n+a,s+o,n+a));h=h.concat(W.WebGLGraphics.quadraticBezierCurve(s+r-o,n+a,s+r,n+a,s+r,n+a-o));h=h.concat(W.WebGLGraphics.quadraticBezierCurve(s+r,n+o,s+r,n,s+r-o,n));h=h.concat(W.WebGLGraphics.quadraticBezierCurve(s+o,n,s,n,s,n+o));if(t.fill){var l=W.hex2rgb(t.fillColor);var u=t.fillAlpha;var f=l[0]*u;var c=l[1]*u;var d=l[2]*u;var p=e.points;var g=e.indices;var m=p.length/6;var y=W.PolyK.Triangulate(h);var v=0;for(v=0;v<y.length;v+=3){g.push(y[v]+m);g.push(y[v]+m);g.push(y[v+1]+m);g.push(y[v+2]+m);g.push(y[v+2]+m)}for(v=0;v<h.length;v++){p.push(h[v],h[++v],f,c,d,u)}}if(t.lineWidth){var x=t.points;t.points=h;W.WebGLGraphics.buildLine(t,e);t.points=x}};W.WebGLGraphics.quadraticBezierCurve=function(t,e,i,s,n,r){var a,o,h,l,u,f,c=20,d=[];function p(t,e,i){var s=e-t;return t+s*i}var g=0;for(var m=0;m<=c;m++){g=m/c;a=p(t,i,g);o=p(e,s,g);h=p(i,n,g);l=p(s,r,g);u=p(a,h,g);f=p(o,l,g);d.push(u,f)}return d};W.WebGLGraphics.buildCircle=function(t,e){var i=t.shape;var s=i.x;var n=i.y;var r;var a;if(t.type===W.Graphics.CIRC){r=i.radius;a=i.radius}else{r=i.width;a=i.height}var o=40;var h=Math.PI*2/o;var l=0;if(t.fill){var u=W.hex2rgb(t.fillColor);var f=t.fillAlpha;var c=u[0]*f;var d=u[1]*f;var p=u[2]*f;var g=e.points;var m=e.indices;var y=g.length/6;m.push(y);for(l=0;l<o+1;l++){g.push(s,n,c,d,p,f);g.push(s+Math.sin(h*l)*r,n+Math.cos(h*l)*a,c,d,p,f);m.push(y++,y++)}m.push(y-1)}if(t.lineWidth){var v=t.points;t.points=[];for(l=0;l<o+1;l++){t.points.push(s+Math.sin(h*l)*r,n+Math.cos(h*l)*a)}W.WebGLGraphics.buildLine(t,e);t.points=v}};W.WebGLGraphics.buildLine=function(t,F){var e=0;var i=t.points;if(i.length===0)return;if(t.lineWidth%2){for(e=0;e<i.length;e++){i[e]+=.5}}var s=new W.Point(i[0],i[1]);var n=new W.Point(i[i.length-2],i[i.length-1]);if(s.x===n.x&&s.y===n.y){i=i.slice();i.pop();i.pop();n=new W.Point(i[i.length-2],i[i.length-1]);var B=n.x+(s.x-n.x)*.5;var U=n.y+(s.y-n.y)*.5;i.unshift(B,U);i.push(B,U)}var r=F.points;var a=F.indices;var o=i.length/2;var G=i.length;var h=r.length/6;var l=t.lineWidth/2;var u=W.hex2rgb(t.lineColor);var f=t.lineAlpha;var c=u[0]*f;var d=u[1]*f;var p=u[2]*f;var g,m,y,v,x,b,_,w;var T,C,S,P,A,M;var R,E,O,I,L,N;var D,j,k;y=i[0];v=i[1];x=i[2];b=i[3];T=-(v-b);C=y-x;k=Math.sqrt(T*T+C*C);T/=k;C/=k;T*=l;C*=l;r.push(y-T,v-C,c,d,p,f);r.push(y+T,v+C,c,d,p,f);for(e=1;e<o-1;e++){y=i[(e-1)*2];v=i[(e-1)*2+1];x=i[e*2];b=i[e*2+1];_=i[(e+1)*2];w=i[(e+1)*2+1];T=-(v-b);C=y-x;k=Math.sqrt(T*T+C*C);T/=k;C/=k;T*=l;C*=l;S=-(b-w);P=x-_;k=Math.sqrt(S*S+P*P);S/=k;P/=k;S*=l;P*=l;R=-C+v-(-C+b);E=-T+x-(-T+y);O=(-T+y)*(-C+b)-(-T+x)*(-C+v);I=-P+w-(-P+b);L=-S+x-(-S+_);N=(-S+_)*(-P+b)-(-S+x)*(-P+w);D=R*L-I*E;if(Math.abs(D)<.1){D+=10.1;r.push(x-T,b-C,c,d,p,f);r.push(x+T,b+C,c,d,p,f);continue}g=(E*N-L*O)/D;m=(I*O-R*N)/D;j=(g-x)*(g-x)+(m-b)+(m-b);if(j>140*140){A=T-S;M=C-P;k=Math.sqrt(A*A+M*M);A/=k;M/=k;A*=l;M*=l;r.push(x-A,b-M);r.push(c,d,p,f);r.push(x+A,b+M);r.push(c,d,p,f);r.push(x-A,b-M);r.push(c,d,p,f);G++}else{r.push(g,m);r.push(c,d,p,f);r.push(x-(g-x),b-(m-b));r.push(c,d,p,f)}}y=i[(o-2)*2];v=i[(o-2)*2+1];x=i[(o-1)*2];b=i[(o-1)*2+1];T=-(v-b);C=y-x;k=Math.sqrt(T*T+C*C);T/=k;C/=k;T*=l;C*=l;r.push(x-T,b-C);r.push(c,d,p,f);r.push(x+T,b+C);r.push(c,d,p,f);a.push(h);for(e=0;e<G;e++){a.push(h++)}a.push(h-1)};W.WebGLGraphics.buildComplexPoly=function(t,e){var i=t.points.slice();if(i.length<6)return;var s=e.indices;e.points=i;e.alpha=t.fillAlpha;e.color=W.hex2rgb(t.fillColor);var n=Infinity;var r=-Infinity;var a=Infinity;var o=-Infinity;var h,l;for(var u=0;u<i.length;u+=2){h=i[u];l=i[u+1];n=h<n?h:n;r=h>r?h:r;a=l<a?l:a;o=l>o?l:o}i.push(n,a,r,a,r,o,n,o);var f=i.length/2;for(u=0;u<f;u++){s.push(u)}};W.WebGLGraphics.buildPoly=function(t,e){var i=t.points;if(i.length<6)return;var s=e.points;var n=e.indices;var r=i.length/2;var a=W.hex2rgb(t.fillColor);var o=t.fillAlpha;var h=a[0]*o;var l=a[1]*o;var u=a[2]*o;var f=W.PolyK.Triangulate(i);if(!f)return false;var c=s.length/6;var d=0;for(d=0;d<f.length;d+=3){n.push(f[d]+c);n.push(f[d]+c);n.push(f[d+1]+c);n.push(f[d+2]+c);n.push(f[d+2]+c)}for(d=0;d<r;d++){s.push(i[d*2],i[d*2+1],h,l,u,o)}return true};W.WebGLGraphics.graphicsDataPool=[];W.WebGLGraphicsData=function(t){this.gl=t;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.mode=1;this.alpha=1;this.dirty=true};W.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};W.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new W.Float32Array(this.points);t.bindBuffer(t.ARRAY_BUFFER,this.buffer);t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW);this.glIndicies=new W.Uint16Array(this.indices);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW);this.dirty=false};W.glContexts=[];W.instances=[];W.WebGLRenderer=function(t,e,i){if(i){for(var s in W.defaultRenderOptions){if(typeof i[s]==="undefined")i[s]=W.defaultRenderOptions[s]}}else{i=W.defaultRenderOptions}if(!W.defaultRenderer){W.defaultRenderer=this}this.type=W.WEBGL_RENDERER;this.resolution=i.resolution;this.transparent=i.transparent;this.autoResize=i.autoResize||false;this.preserveDrawingBuffer=i.preserveDrawingBuffer;this.clearBeforeRender=i.clearBeforeRender;this.width=t||800;this.height=e||600;this.view=i.view||document.createElement("canvas");this.contextLostBound=this.handleContextLost.bind(this);this.contextRestoredBound=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLostBound,false);this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,false);this._contextOptions={alpha:this.transparent,antialias:i.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:i.preserveDrawingBuffer};this.projection=new W.Point;this.offset=new W.Point(0,0);this.shaderManager=new W.WebGLShaderManager;this.spriteBatch=new W.WebGLSpriteBatch;this.maskManager=new W.WebGLMaskManager;this.filterManager=new W.WebGLFilterManager;this.stencilManager=new W.WebGLStencilManager;this.blendModeManager=new W.WebGLBlendModeManager;this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};W.WebGLRenderer.prototype.constructor=W.WebGLRenderer;W.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=t;if(!t){throw new Error("This browser does not support webGL. Try using the canvas renderer")}this.glContextId=t.id=W.WebGLRenderer.glContextId++;W.glContexts[this.glContextId]=t;W.instances[this.glContextId]=this;t.disable(t.DEPTH_TEST);t.disable(t.CULL_FACE);t.enable(t.BLEND);this.shaderManager.setContext(t);this.spriteBatch.setContext(t);this.maskManager.setContext(t);this.filterManager.setContext(t);this.blendModeManager.setContext(t);this.stencilManager.setContext(t);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};W.WebGLRenderer.prototype.render=function(t){if(this.contextLost)return;if(this.__stage!==t){this.__stage=t}t.updateTransform();var e=this.gl;e.viewport(0,0,this.width,this.height);e.bindFramebuffer(e.FRAMEBUFFER,null);if(this.clearBeforeRender){if(this.transparent){e.clearColor(0,0,0,0)}else{e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1)}e.clear(e.COLOR_BUFFER_BIT)}this.renderDisplayObject(t,this.projection)};W.WebGLRenderer.prototype.renderDisplayObject=function(t,e,i){this.renderSession.blendModeManager.setBlendMode(W.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=i?-1:1;this.renderSession.projection=e;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,i);t._renderWebGL(this.renderSession);this.spriteBatch.end()};W.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};W.WebGLRenderer.prototype.updateTexture=function(t){if(!t.hasLoaded)return;var e=this.gl;if(!t._glTextures[e.id])t._glTextures[e.id]=e.createTexture();e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===W.scaleModes.LINEAR?e.LINEAR:e.NEAREST);if(t.mipmap&&W.isPowerOfTwo(t.width,t.height)){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===W.scaleModes.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST);e.generateMipmap(e.TEXTURE_2D)}else{e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===W.scaleModes.LINEAR?e.LINEAR:e.NEAREST)}if(!t._powerOf2){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}else{e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)}t._dirty[e.id]=false;return t._glTextures[e.id]};W.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault();this.contextLost=true};W.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var t in W.TextureCache){var e=W.TextureCache[t].baseTexture;e._glTextures=[]}this.contextLost=false};W.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound);this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound);W.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null;W.instances[this.glContextId]=null;W.WebGLRenderer.glContextId--};W.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;if(!W.blendModesWebGL){W.blendModesWebGL=[];W.blendModesWebGL[W.blendModes.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.ADD]=[t.SRC_ALPHA,t.DST_ALPHA];W.blendModesWebGL[W.blendModes.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.SCREEN]=[t.SRC_ALPHA,t.ONE];W.blendModesWebGL[W.blendModes.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];W.blendModesWebGL[W.blendModes.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA]}};W.WebGLRenderer.glContextId=0;W.WebGLBlendModeManager=function(){this.currentBlendMode=99999};W.WebGLBlendModeManager.prototype.constructor=W.WebGLBlendModeManager;W.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t};W.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return false;this.currentBlendMode=t;var e=W.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(e[0],e[1]);return true};W.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};W.WebGLMaskManager=function(){};W.WebGLMaskManager.prototype.constructor=W.WebGLMaskManager;W.WebGLMaskManager.prototype.setContext=function(t){this.gl=t};W.WebGLMaskManager.prototype.pushMask=function(t,e){var i=e.gl;if(t.dirty){W.WebGLGraphics.updateGraphics(t,i)}if(!t._webGL[i.id].data.length)return;e.stencilManager.pushStencil(t,t._webGL[i.id].data[0],e)};W.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)};W.WebGLMaskManager.prototype.destroy=function(){this.gl=null};W.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=true;this.count=0};W.WebGLStencilManager.prototype.setContext=function(t){this.gl=t};W.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var s=this.gl;this.bindGraphics(t,e,i);if(this.stencilStack.length===0){s.enable(s.STENCIL_TEST);s.clear(s.STENCIL_BUFFER_BIT);this.reverse=true;this.count=0}this.stencilStack.push(e);var n=this.count;s.colorMask(false,false,false,false);s.stencilFunc(s.ALWAYS,0,255);s.stencilOp(s.KEEP,s.KEEP,s.INVERT);if(e.mode===1){s.drawElements(s.TRIANGLE_FAN,e.indices.length-4,s.UNSIGNED_SHORT,0);if(this.reverse){s.stencilFunc(s.EQUAL,255-n,255);s.stencilOp(s.KEEP,s.KEEP,s.DECR)}else{s.stencilFunc(s.EQUAL,n,255);s.stencilOp(s.KEEP,s.KEEP,s.INCR)}s.drawElements(s.TRIANGLE_FAN,4,s.UNSIGNED_SHORT,(e.indices.length-4)*2);if(this.reverse){s.stencilFunc(s.EQUAL,255-(n+1),255)}else{s.stencilFunc(s.EQUAL,n+1,255)}this.reverse=!this.reverse}else{if(!this.reverse){s.stencilFunc(s.EQUAL,255-n,255);s.stencilOp(s.KEEP,s.KEEP,s.DECR)}else{s.stencilFunc(s.EQUAL,n,255);s.stencilOp(s.KEEP,s.KEEP,s.INCR)}s.drawElements(s.TRIANGLE_STRIP,e.indices.length,s.UNSIGNED_SHORT,0);if(!this.reverse){s.stencilFunc(s.EQUAL,255-(n+1),255)}else{s.stencilFunc(s.EQUAL,n+1,255)}}s.colorMask(true,true,true,true);s.stencilOp(s.KEEP,s.KEEP,s.KEEP);this.count++};W.WebGLStencilManager.prototype.bindGraphics=function(t,e,i){this._currentGraphics=t;var s=this.gl;var n=i.projection,r=i.offset,a;if(e.mode===1){a=i.shaderManager.complexPrimitiveShader;i.shaderManager.setShader(a);s.uniform1f(a.flipY,i.flipY);s.uniformMatrix3fv(a.translationMatrix,false,t.worldTransform.toArray(true));s.uniform2f(a.projectionVector,n.x,-n.y);s.uniform2f(a.offsetVector,-r.x,-r.y);s.uniform3fv(a.tintColor,W.hex2rgb(t.tint));s.uniform3fv(a.color,e.color);s.uniform1f(a.alpha,t.worldAlpha*e.alpha);s.bindBuffer(s.ARRAY_BUFFER,e.buffer);s.vertexAttribPointer(a.aVertexPosition,2,s.FLOAT,false,4*2,0);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.indexBuffer)}else{a=i.shaderManager.primitiveShader;i.shaderManager.setShader(a);s.uniformMatrix3fv(a.translationMatrix,false,t.worldTransform.toArray(true));s.uniform1f(a.flipY,i.flipY);s.uniform2f(a.projectionVector,n.x,-n.y);s.uniform2f(a.offsetVector,-r.x,-r.y);s.uniform3fv(a.tintColor,W.hex2rgb(t.tint));s.uniform1f(a.alpha,t.worldAlpha);s.bindBuffer(s.ARRAY_BUFFER,e.buffer);s.vertexAttribPointer(a.aVertexPosition,2,s.FLOAT,false,4*6,0);s.vertexAttribPointer(a.colorAttribute,4,s.FLOAT,false,4*6,2*4);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.indexBuffer)}};W.WebGLStencilManager.prototype.popStencil=function(t,e,i){var s=this.gl;this.stencilStack.pop();this.count--;if(this.stencilStack.length===0){s.disable(s.STENCIL_TEST)}else{var n=this.count;this.bindGraphics(t,e,i);s.colorMask(false,false,false,false);if(e.mode===1){this.reverse=!this.reverse;if(this.reverse){s.stencilFunc(s.EQUAL,255-(n+1),255);s.stencilOp(s.KEEP,s.KEEP,s.INCR)}else{s.stencilFunc(s.EQUAL,n+1,255);s.stencilOp(s.KEEP,s.KEEP,s.DECR)}s.drawElements(s.TRIANGLE_FAN,4,s.UNSIGNED_SHORT,(e.indices.length-4)*2);s.stencilFunc(s.ALWAYS,0,255);s.stencilOp(s.KEEP,s.KEEP,s.INVERT);s.drawElements(s.TRIANGLE_FAN,e.indices.length-4,s.UNSIGNED_SHORT,0);if(!this.reverse){s.stencilFunc(s.EQUAL,255-n,255)}else{s.stencilFunc(s.EQUAL,n,255)}}else{if(!this.reverse){s.stencilFunc(s.EQUAL,255-(n+1),255);s.stencilOp(s.KEEP,s.KEEP,s.INCR)}else{s.stencilFunc(s.EQUAL,n+1,255);s.stencilOp(s.KEEP,s.KEEP,s.DECR)}s.drawElements(s.TRIANGLE_STRIP,e.indices.length,s.UNSIGNED_SHORT,0);if(!this.reverse){s.stencilFunc(s.EQUAL,255-n,255)}else{s.stencilFunc(s.EQUAL,n,255)}}s.colorMask(true,true,true,true);s.stencilOp(s.KEEP,s.KEEP,s.KEEP)}};W.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};W.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++){this.attribState[t]=false}this.stack=[]};W.WebGLShaderManager.prototype.constructor=W.WebGLShaderManager;W.WebGLShaderManager.prototype.setContext=function(t){this.gl=t;this.primitiveShader=new W.PrimitiveShader(t);this.complexPrimitiveShader=new W.ComplexPrimitiveShader(t);this.defaultShader=new W.PixiShader(t);this.fastShader=new W.PixiFastShader(t);this.stripShader=new W.StripShader(t);this.setShader(this.defaultShader)};W.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++){this.tempAttribState[e]=false}for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=true}var s=this.gl;for(e=0;e<this.attribState.length;e++){if(this.attribState[e]!==this.tempAttribState[e]){this.attribState[e]=this.tempAttribState[e];if(this.tempAttribState[e]){s.enableVertexAttribArray(e)}else{s.disableVertexAttribArray(e)}}}};W.WebGLShaderManager.prototype.setShader=function(t){if(this._currentId===t._UID)return false;this._currentId=t._UID;this.currentShader=t;this.gl.useProgram(t.program);this.setAttribs(t.attributes);return true};W.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};W.WebGLSpriteBatch=function(){this.vertSize=5;this.size=2e3;var t=this.size*4*4*this.vertSize;var e=this.size*6;this.vertices=new W.ArrayBuffer(t);this.positions=new W.Float32Array(this.vertices);this.colors=new W.Uint32Array(this.vertices);this.indices=new W.Uint16Array(e);this.lastIndexCount=0;for(var i=0,s=0;i<e;i+=6,s+=4){this.indices[i+0]=s+0;this.indices[i+1]=s+1;this.indices[i+2]=s+2;this.indices[i+3]=s+0;this.indices[i+4]=s+2;this.indices[i+5]=s+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=true;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new W.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};W.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t;this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW);this.currentBlendMode=99999;var e=new W.PixiShader(t);e.fragmentSrc=this.defaultShader.fragmentSrc;e.uniforms={};e.init();this.defaultShader.shaders[t.id]=e};W.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};W.WebGLSpriteBatch.prototype.end=function(){this.flush()};W.WebGLSpriteBatch.prototype.render=function(t){var e=t.texture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=e.baseTexture}var i=e._uvs;if(!i)return;var s=t.anchor.x;var n=t.anchor.y;var r,a,o,h;if(e.trim){var l=e.trim;a=l.x-s*l.width;r=a+e.crop.width;h=l.y-n*l.height;o=h+e.crop.height}else{r=e.frame.width*(1-s);a=e.frame.width*-s;o=e.frame.height*(1-n);h=e.frame.height*-n}var u=this.currentBatchSize*4*this.vertSize;var f=e.baseTexture.resolution;var c=t.worldTransform;var d=c.a/f;var p=c.b/f;var g=c.c/f;var m=c.d/f;var y=c.tx;var v=c.ty;var x=this.colors;var b=this.positions;if(this.renderSession.roundPixels){b[u]=d*a+g*h+y|0;b[u+1]=m*h+p*a+v|0;b[u+5]=d*r+g*h+y|0;b[u+6]=m*h+p*r+v|0;b[u+10]=d*r+g*o+y|0;b[u+11]=m*o+p*r+v|0;b[u+15]=d*a+g*o+y|0;b[u+16]=m*o+p*a+v|0}else{b[u]=d*a+g*h+y;b[u+1]=m*h+p*a+v;b[u+5]=d*r+g*h+y;b[u+6]=m*h+p*r+v;b[u+10]=d*r+g*o+y;b[u+11]=m*o+p*r+v;b[u+15]=d*a+g*o+y;b[u+16]=m*o+p*a+v}b[u+2]=i.x0;b[u+3]=i.y0;b[u+7]=i.x1;b[u+8]=i.y1;b[u+12]=i.x2;b[u+13]=i.y2;b[u+17]=i.x3;b[u+18]=i.y3;var _=t.tint;x[u+4]=x[u+9]=x[u+14]=x[u+19]=(_>>16)+(_&65280)+((_&255)<<16)+(t.worldAlpha*255<<24);this.sprites[this.currentBatchSize++]=t};W.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var e=t.tilingTexture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=e.baseTexture}if(!t._uvs)t._uvs=new W.TextureUvs;var i=t._uvs;t.tilePosition.x%=e.baseTexture.width*t.tileScaleOffset.x;t.tilePosition.y%=e.baseTexture.height*t.tileScaleOffset.y;var s=t.tilePosition.x/(e.baseTexture.width*t.tileScaleOffset.x);var n=t.tilePosition.y/(e.baseTexture.height*t.tileScaleOffset.y);var r=t.width/e.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x);var a=t.height/e.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);i.x0=0-s;i.y0=0-n;i.x1=1*r-s;i.y1=0-n;i.x2=1*r-s;i.y2=1*a-n;i.x3=0-s;i.y3=1*a-n;var o=t.tint;var h=(o>>16)+(o&65280)+((o&255)<<16)+(t.alpha*255<<24);var l=this.positions;var u=this.colors;var f=t.width;var c=t.height;var d=t.anchor.x;var p=t.anchor.y;var g=f*(1-d);var m=f*-d;var y=c*(1-p);var v=c*-p;var x=this.currentBatchSize*4*this.vertSize;var b=e.baseTexture.resolution;var _=t.worldTransform;var w=_.a/b;var T=_.b/b;var C=_.c/b;var S=_.d/b;var P=_.tx;var A=_.ty;l[x++]=w*m+C*v+P;l[x++]=S*v+T*m+A;l[x++]=i.x0;l[x++]=i.y0;u[x++]=h;l[x++]=w*g+C*v+P;l[x++]=S*v+T*g+A;l[x++]=i.x1;l[x++]=i.y1;u[x++]=h;l[x++]=w*g+C*y+P;l[x++]=S*y+T*g+A;l[x++]=i.x2;l[x++]=i.y2;u[x++]=h;l[x++]=w*m+C*y+P;l[x++]=S*y+T*m+A;l[x++]=i.x3;l[x++]=i.y3;u[x++]=h;this.sprites[this.currentBatchSize++]=t};W.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0)return;var t=this.gl;var e;if(this.dirty){this.dirty=false;t.activeTexture(t.TEXTURE0);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);e=this.defaultShader.shaders[t.id];var i=this.vertSize*4;t.vertexAttribPointer(e.aVertexPosition,2,t.FLOAT,false,i,0);t.vertexAttribPointer(e.aTextureCoord,2,t.FLOAT,false,i,2*4);t.vertexAttribPointer(e.colorAttribute,4,t.UNSIGNED_BYTE,true,i,4*4)}if(this.currentBatchSize>this.size*.5){t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices)}else{var s=this.positions.subarray(0,this.currentBatchSize*4*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,s)}var n,r,a;var o=0;var h=0;var l=null;var u=this.renderSession.blendModeManager.currentBlendMode;var f=null;var c=false;var d=false;var p;for(var g=0,m=this.currentBatchSize;g<m;g++){p=this.sprites[g];n=p.texture.baseTexture;r=p.blendMode;a=p.shader||this.defaultShader;c=u!==r;d=f!==a;if(l!==n||c||d){this.renderBatch(l,o,h);h=g;o=0;l=n;if(c){u=r;this.renderSession.blendModeManager.setBlendMode(u)}if(d){f=a;e=f.shaders[t.id];if(!e){e=new W.PixiShader(t);e.fragmentSrc=f.fragmentSrc;e.uniforms=f.uniforms;e.init();f.shaders[t.id]=e}this.renderSession.shaderManager.setShader(e);if(e.dirty)e.syncUniforms();var y=this.renderSession.projection;t.uniform2f(e.projectionVector,y.x,y.y);var v=this.renderSession.offset;t.uniform2f(e.offsetVector,v.x,v.y)}}o++}this.renderBatch(l,o,h);this.currentBatchSize=0};W.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(e===0)return;var s=this.gl;if(t._dirty[s.id]){this.renderSession.renderer.updateTexture(t)}else{s.bindTexture(s.TEXTURE_2D,t._glTextures[s.id])}s.drawElements(s.TRIANGLES,e*6,s.UNSIGNED_SHORT,i*6*2);this.renderSession.drawCount++};W.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=true};W.WebGLSpriteBatch.prototype.start=function(){this.dirty=true};W.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};W.WebGLFastSpriteBatch=function(t){this.vertSize=10;this.maxSize=6e3;this.size=this.maxSize;var e=this.size*4*this.vertSize;var i=this.maxSize*6;this.vertices=new W.Float32Array(e);this.indices=new W.Uint16Array(i);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var s=0,n=0;s<i;s+=6,n+=4){this.indices[s+0]=n+0;this.indices[s+1]=n+1;this.indices[s+2]=n+2;this.indices[s+3]=n+0;this.indices[s+4]=n+2;this.indices[s+5]=n+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(t)};W.WebGLFastSpriteBatch.prototype.constructor=W.WebGLFastSpriteBatch;W.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t;this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)};W.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=t.worldTransform.toArray(true);this.start()};W.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};W.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children;var i=e[0];if(!i.texture._uvs)return;this.currentBaseTexture=i.texture.baseTexture;if(i.blendMode!==this.renderSession.blendModeManager.currentBlendMode){this.flush();this.renderSession.blendModeManager.setBlendMode(i.blendMode)}for(var s=0,n=e.length;s<n;s++){this.renderSprite(e[s])}this.flush()};W.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(!t.visible)return;if(t.texture.baseTexture!==this.currentBaseTexture){this.flush();this.currentBaseTexture=t.texture.baseTexture;if(!t.texture._uvs)return}var e,i=this.vertices,s,n,r,a,o,h,l;e=t.texture._uvs;s=t.texture.frame.width;n=t.texture.frame.height;if(t.texture.trim){var u=t.texture.trim;a=u.x-t.anchor.x*u.width;r=a+t.texture.crop.width;h=u.y-t.anchor.y*u.height;o=h+t.texture.crop.height}else{r=t.texture.frame.width*(1-t.anchor.x);a=t.texture.frame.width*-t.anchor.x;o=t.texture.frame.height*(1-t.anchor.y);h=t.texture.frame.height*-t.anchor.y}l=this.currentBatchSize*4*this.vertSize;i[l++]=a;i[l++]=h;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x0;i[l++]=e.y1;i[l++]=t.alpha;i[l++]=r;i[l++]=h;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x1;i[l++]=e.y1;i[l++]=t.alpha;i[l++]=r;i[l++]=o;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x2;i[l++]=e.y2;i[l++]=t.alpha;i[l++]=a;i[l++]=o;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x3;i[l++]=e.y3;i[l++]=t.alpha;this.currentBatchSize++;if(this.currentBatchSize>=this.size){this.flush()}};W.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0)return;var t=this.gl;if(!this.currentBaseTexture._glTextures[t.id])this.renderSession.renderer.updateTexture(this.currentBaseTexture,t);t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]);if(this.currentBatchSize>this.size*.5){t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices)}else{var e=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,this.currentBatchSize*6,t.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};W.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};W.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y);t.uniformMatrix3fv(this.shader.uMatrix,false,this.matrix);var i=this.vertSize*4;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,false,i,0);t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,false,i,2*4);t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,false,i,4*4);t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,false,i,6*4);t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,false,i,7*4);t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,false,i,9*4)};W.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};W.WebGLFilterManager.prototype.constructor=W.WebGLFilterManager;W.WebGLFilterManager.prototype.setContext=function(t){this.gl=t;this.texturePool=[];this.initShaderBuffers()};W.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t;this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=i.x*2;this.height=-i.y*2;this.buffer=e};W.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl;var i=this.renderSession.projection;var s=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds();this.filterStack.push(t);var n=t.filterPasses[0];this.offsetX+=t._filterArea.x;this.offsetY+=t._filterArea.y;var r=this.texturePool.pop();if(!r){r=new W.FilterTexture(this.gl,this.width,this.height)}else{r.resize(this.width,this.height)}e.bindTexture(e.TEXTURE_2D,r.texture);var a=t._filterArea;var o=n.padding;a.x-=o;a.y-=o;a.width+=o*2;a.height+=o*2;if(a.x<0)a.x=0;if(a.width>this.width)a.width=this.width;if(a.y<0)a.y=0;if(a.height>this.height)a.height=this.height;e.bindFramebuffer(e.FRAMEBUFFER,r.frameBuffer);e.viewport(0,0,a.width,a.height);i.x=a.width/2;i.y=-a.height/2;s.x=-a.x;s.y=-a.y;e.colorMask(true,true,true,true);e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT);t._glFilterTexture=r};W.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl;var e=this.filterStack.pop();var i=e._filterArea;var s=e._glFilterTexture;var n=this.renderSession.projection;var r=this.renderSession.offset;if(e.filterPasses.length>1){t.viewport(0,0,i.width,i.height);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=i.height;this.vertexArray[2]=i.width;this.vertexArray[3]=i.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=i.width;this.vertexArray[7]=0;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var a=s;var o=this.texturePool.pop();if(!o)o=new W.FilterTexture(this.gl,this.width,this.height);o.resize(this.width,this.height);t.bindFramebuffer(t.FRAMEBUFFER,o.frameBuffer);t.clear(t.COLOR_BUFFER_BIT);t.disable(t.BLEND);for(var h=0;h<e.filterPasses.length-1;h++){var l=e.filterPasses[h];t.bindFramebuffer(t.FRAMEBUFFER,o.frameBuffer);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,a.texture);this.applyFilterPass(l,i,i.width,i.height);var u=a;a=o;o=u}t.enable(t.BLEND);s=a;this.texturePool.push(o)}var f=e.filterPasses[e.filterPasses.length-1];this.offsetX-=i.x;this.offsetY-=i.y;var c=this.width;var d=this.height;var p=0;var g=0;var m=this.buffer;if(this.filterStack.length===0){t.colorMask(true,true,true,true)}else{var y=this.filterStack[this.filterStack.length-1];i=y._filterArea;c=i.width;d=i.height;p=i.x;g=i.y;m=y._glFilterTexture.frameBuffer}n.x=c/2;n.y=-d/2;r.x=p;r.y=g;i=e._filterArea;var v=i.x-p;var x=i.y-g;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=v;this.vertexArray[1]=x+i.height;this.vertexArray[2]=v+i.width;this.vertexArray[3]=x+i.height;this.vertexArray[4]=v;this.vertexArray[5]=x;this.vertexArray[6]=v+i.width;this.vertexArray[7]=x;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);t.viewport(0,0,c*this.renderSession.resolution,d*this.renderSession.resolution);t.bindFramebuffer(t.FRAMEBUFFER,m);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,s.texture);this.applyFilterPass(f,i,c,d);this.texturePool.push(s);e._glFilterTexture=null};W.WebGLFilterManager.prototype.applyFilterPass=function(t,e,i,s){var n=this.gl;var r=t.shaders[n.id];if(!r){r=new W.PixiShader(n);r.fragmentSrc=t.fragmentSrc;r.uniforms=t.uniforms;r.init();t.shaders[n.id]=r}this.renderSession.shaderManager.setShader(r);n.uniform2f(r.projectionVector,i/2,-s/2);n.uniform2f(r.offsetVector,0,0);if(t.uniforms.dimensions){t.uniforms.dimensions.value[0]=this.width;t.uniforms.dimensions.value[1]=this.height;t.uniforms.dimensions.value[2]=this.vertexArray[0];t.uniforms.dimensions.value[3]=this.vertexArray[5]}r.syncUniforms();n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.vertexAttribPointer(r.aVertexPosition,2,n.FLOAT,false,0,0);n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer);n.vertexAttribPointer(r.aTextureCoord,2,n.FLOAT,false,0,0);n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer);n.vertexAttribPointer(r.colorAttribute,2,n.FLOAT,false,0,0);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);this.renderSession.drawCount++};W.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer();this.uvBuffer=t.createBuffer();this.colorBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.vertexArray=new W.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW);this.uvArray=new W.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW);this.colorArray=new W.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)};W.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var e=0;e<this.texturePool.length;e++){this.texturePool[e].destroy()}this.texturePool=null;t.deleteBuffer(this.vertexBuffer);t.deleteBuffer(this.uvBuffer);t.deleteBuffer(this.colorBuffer);t.deleteBuffer(this.indexBuffer)};W.FilterTexture=function(t,e,i,s){this.gl=t;this.frameBuffer=t.createFramebuffer();this.texture=t.createTexture();s=s||W.scaleModes.DEFAULT;t.bindTexture(t.TEXTURE_2D,this.texture);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,s===W.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,s===W.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);this.renderBuffer=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer);this.resize(e,i)};W.FilterTexture.prototype.constructor=W.FilterTexture;W.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0);t.clear(t.COLOR_BUFFER_BIT)};W.FilterTexture.prototype.resize=function(t,e){if(this.width===t&&this.height===e)return;this.width=t;this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null);i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer);i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)};W.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer);t.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};W.CanvasBuffer=function(t,e){this.width=t;this.height=e;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=t;this.canvas.height=e};W.CanvasBuffer.prototype.constructor=W.CanvasBuffer;W.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};W.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t;this.height=this.canvas.height=e};W.CanvasMaskManager=function(){};W.CanvasMaskManager.prototype.constructor=W.CanvasMaskManager;W.CanvasMaskManager.prototype.pushMask=function(t,e){var i=e.context;i.save();var s=t.alpha;var n=t.worldTransform;var r=e.resolution;i.setTransform(n.a*r,n.b*r,n.c*r,n.d*r,n.tx*r,n.ty*r);W.CanvasGraphics.renderGraphicsMask(t,i);i.clip();t.worldAlpha=s};W.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()};W.CanvasTinter=function(){};W.CanvasTinter.getTintedTexture=function(t,e){var i=t.texture;var s=W.CanvasTinter.canvas||document.createElement("canvas");W.CanvasTinter.tintMethod(i,e,s);if(W.CanvasTinter.convertTintToImage){var n=new Image;n.src=s.toDataURL()}else{W.CanvasTinter.canvas=null}return s};W.CanvasTinter.tintWithMultiply=function(t,e,i){var s=i.getContext("2d");var n=t.crop;i.width=n.width;i.height=n.height;s.fillStyle="#"+("00000"+(e|0).toString(16)).substr(-6);s.fillRect(0,0,n.width,n.height);s.globalCompositeOperation="multiply";s.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height);s.globalCompositeOperation="destination-atop";s.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height)};W.CanvasTinter.tintWithOverlay=function(t,e,i){var s=i.getContext("2d");var n=t.crop;i.width=n.width;i.height=n.height;s.globalCompositeOperation="copy";s.fillStyle="#"+("00000"+(e|0).toString(16)).substr(-6);s.fillRect(0,0,n.width,n.height);s.globalCompositeOperation="destination-atop";s.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height)};W.CanvasTinter.tintWithPerPixel=function(t,e,i){var s=i.getContext("2d");var n=t.crop;i.width=n.width;i.height=n.height;s.globalCompositeOperation="copy";s.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var r=W.hex2rgb(e);var a=r[0],o=r[1],h=r[2];var l=s.getImageData(0,0,n.width,n.height);var u=l.data;for(var f=0;f<u.length;f+=4){u[f+0]*=a;u[f+1]*=o;u[f+2]*=h;if(!W.CanvasTinter.canHandleAlpha){var c=u[f+3];u[f+0]/=255/c;u[f+1]/=255/c;u[f+2]/=255/c}}s.putImageData(l,0,0)};W.CanvasTinter.roundColor=function(t){var e=W.CanvasTinter.cacheStepsPerColorChannel;var i=W.hex2rgb(t);i[0]=Math.min(255,i[0]/e*e);i[1]=Math.min(255,i[1]/e*e);i[2]=Math.min(255,i[2]/e*e);return W.rgb2hex(i)};W.CanvasTinter.checkInverseAlpha=function(){if(window.__wx&&window.isSubDomain)return false;var t=W.sharedCanvas;var e=t.getContext("2d");e.fillStyle="rgba(10, 20, 30, 0.5)";e.fillRect(0,0,1,1);var i=e.getImageData(0,0,1,1);e.putImageData(i,1,0);var s=e.getImageData(1,0,1,1);return s.data[0]===i.data[0]&&s.data[1]===i.data[1]&&s.data[2]===i.data[2]&&s.data[3]===i.data[3]};W.CanvasTinter.cacheStepsPerColorChannel=8;W.CanvasTinter.convertTintToImage=false;W.CanvasTinter.canHandleAlpha=W.CanvasTinter.checkInverseAlpha();W.CanvasTinter.canUseMultiply=W.canUseNewCanvasBlendModes();W.CanvasTinter.tintMethod=W.CanvasTinter.canUseMultiply?W.CanvasTinter.tintWithMultiply:W.CanvasTinter.tintWithPerPixel;W.CanvasRenderer=function(t,e,i){if(i){for(var s in W.defaultRenderOptions){if(typeof i[s]==="undefined")i[s]=W.defaultRenderOptions[s]}}else{i=W.defaultRenderOptions}if(!W.defaultRenderer){W.defaultRenderer=this}this.type=W.CANVAS_RENDERER;this.resolution=i.resolution;this.clearBeforeRender=i.clearBeforeRender;this.transparent=i.transparent;this.autoResize=i.autoResize||false;this.width=t||800;this.height=e||600;this.width*=this.resolution;this.height*=this.resolution;this.view=i.view||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=true;this.view.width=this.width*this.resolution;this.view.height=this.height*this.resolution;this.count=0;this.maskManager=new W.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:false};this.mapBlendModes();this.resize(t,e);if("imageSmoothingEnabled"in this.context)this.renderSession.smoothProperty="imageSmoothingEnabled";else if("webkitImageSmoothingEnabled"in this.context)this.renderSession.smoothProperty="webkitImageSmoothingEnabled";else if("mozImageSmoothingEnabled"in this.context)this.renderSession.smoothProperty="mozImageSmoothingEnabled";else if("oImageSmoothingEnabled"in this.context)this.renderSession.smoothProperty="oImageSmoothingEnabled";else if("msImageSmoothingEnabled"in this.context)this.renderSession.smoothProperty="msImageSmoothingEnabled"};W.CanvasRenderer.prototype.constructor=W.CanvasRenderer;W.CanvasRenderer.prototype.render=function(t){t.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=W.blendModes.NORMAL;this.context.globalCompositeOperation=W.blendModesCanvas[W.blendModes.NORMAL];if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(this.clearBeforeRender){if(this.transparent){this.context.clearRect(0,0,this.width,this.height)}else{this.context.fillStyle=t.backgroundColorString;this.context.fillRect(0,0,this.width,this.height)}}this.renderDisplayObject(t)};W.CanvasRenderer.prototype.destroy=function(t){if(typeof t==="undefined"){t=true}if(t&&this.view.parent){this.view.parent.removeChild(this.view)}this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};W.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}};W.CanvasRenderer.prototype.renderDisplayObject=function(t,e){this.renderSession.context=e||this.context;this.renderSession.resolution=this.resolution;t._renderCanvas(this.renderSession)};W.CanvasRenderer.prototype.mapBlendModes=function(){if(!W.blendModesCanvas){W.blendModesCanvas=[];if(W.canUseNewCanvasBlendModes()){W.blendModesCanvas[W.blendModes.NORMAL]="source-over";W.blendModesCanvas[W.blendModes.ADD]="lighter";W.blendModesCanvas[W.blendModes.MULTIPLY]="multiply";W.blendModesCanvas[W.blendModes.SCREEN]="screen";W.blendModesCanvas[W.blendModes.OVERLAY]="overlay";W.blendModesCanvas[W.blendModes.DARKEN]="darken";W.blendModesCanvas[W.blendModes.LIGHTEN]="lighten";W.blendModesCanvas[W.blendModes.COLOR_DODGE]="color-dodge";W.blendModesCanvas[W.blendModes.COLOR_BURN]="color-burn";W.blendModesCanvas[W.blendModes.HARD_LIGHT]="hard-light";W.blendModesCanvas[W.blendModes.SOFT_LIGHT]="soft-light";W.blendModesCanvas[W.blendModes.DIFFERENCE]="difference";W.blendModesCanvas[W.blendModes.EXCLUSION]="exclusion";W.blendModesCanvas[W.blendModes.HUE]="hue";W.blendModesCanvas[W.blendModes.SATURATION]="saturation";W.blendModesCanvas[W.blendModes.COLOR]="color";W.blendModesCanvas[W.blendModes.LUMINOSITY]="luminosity"}else{W.blendModesCanvas[W.blendModes.NORMAL]="source-over";W.blendModesCanvas[W.blendModes.ADD]="lighter";W.blendModesCanvas[W.blendModes.MULTIPLY]="source-over";W.blendModesCanvas[W.blendModes.SCREEN]="source-over";W.blendModesCanvas[W.blendModes.OVERLAY]="source-over";W.blendModesCanvas[W.blendModes.DARKEN]="source-over";W.blendModesCanvas[W.blendModes.LIGHTEN]="source-over";W.blendModesCanvas[W.blendModes.COLOR_DODGE]="source-over";W.blendModesCanvas[W.blendModes.COLOR_BURN]="source-over";W.blendModesCanvas[W.blendModes.HARD_LIGHT]="source-over";W.blendModesCanvas[W.blendModes.SOFT_LIGHT]="source-over";W.blendModesCanvas[W.blendModes.DIFFERENCE]="source-over";W.blendModesCanvas[W.blendModes.EXCLUSION]="source-over";W.blendModesCanvas[W.blendModes.HUE]="source-over";W.blendModesCanvas[W.blendModes.SATURATION]="source-over";W.blendModesCanvas[W.blendModes.COLOR]="source-over";W.blendModesCanvas[W.blendModes.LUMINOSITY]="source-over"}}};W.CanvasGraphics=function(){};W.CanvasGraphics.renderGraphics=function(t,e){var i=t.worldAlpha;if(t.dirty){this.updateGraphicsTint(t);t.dirty=false}for(var s=0;s<t.graphicsData.length;s++){var n=t.graphicsData[s];var r=n.shape;var a=n._fillTint;var o=n._lineTint;e.lineWidth=n.lineWidth;if(n.type===W.Graphics.POLY){e.beginPath();var h=r.points;e.moveTo(h[0],h[1]);for(var l=1;l<h.length/2;l++){e.lineTo(h[l*2],h[l*2+1])}if(r.closed){e.lineTo(h[0],h[1])}if(h[0]===h[h.length-2]&&h[1]===h[h.length-1]){e.closePath()}if(n.fill){e.globalAlpha=n.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(n.lineWidth){e.globalAlpha=n.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}else if(n.type===W.Graphics.RECT){if(n.fillColor||n.fillColor===0){e.globalAlpha=n.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fillRect(r.x,r.y,r.width,r.height)}if(n.lineWidth){e.globalAlpha=n.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.strokeRect(r.x,r.y,r.width,r.height)}}else if(n.type===W.Graphics.CIRC){e.beginPath();e.arc(r.x,r.y,r.radius,0,2*Math.PI);e.closePath();if(n.fill){e.globalAlpha=n.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(n.lineWidth){e.globalAlpha=n.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}else if(n.type===W.Graphics.ELIP){var u=r.width*2;var f=r.height*2;var c=r.x-u/2;var d=r.y-f/2;e.beginPath();var p=.5522848,g=u/2*p,m=f/2*p,y=c+u,v=d+f,x=c+u/2,b=d+f/2;e.moveTo(c,b);e.bezierCurveTo(c,b-m,x-g,d,x,d);e.bezierCurveTo(x+g,d,y,b-m,y,b);e.bezierCurveTo(y,b+m,x+g,v,x,v);e.bezierCurveTo(x-g,v,c,b+m,c,b);e.closePath();if(n.fill){e.globalAlpha=n.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(n.lineWidth){e.globalAlpha=n.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}else if(n.type===W.Graphics.RREC){var _=r.x;var w=r.y;var T=r.width;var C=r.height;var S=r.radius;var P=Math.min(T,C)/2|0;S=S>P?P:S;e.beginPath();e.moveTo(_,w+S);e.lineTo(_,w+C-S);e.quadraticCurveTo(_,w+C,_+S,w+C);e.lineTo(_+T-S,w+C);e.quadraticCurveTo(_+T,w+C,_+T,w+C-S);e.lineTo(_+T,w+S);e.quadraticCurveTo(_+T,w,_+T-S,w);e.lineTo(_+S,w);e.quadraticCurveTo(_,w,_,w+S);e.closePath();if(n.fillColor||n.fillColor===0){e.globalAlpha=n.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(n.lineWidth){e.globalAlpha=n.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}}};W.CanvasGraphics.renderGraphicsMask=function(t,e){var i=t.graphicsData.length;if(i===0){return}e.beginPath();for(var s=0;s<i;s++){var n=t.graphicsData[s];var r=n.shape;if(n.type===W.Graphics.POLY){var a=r.points;e.moveTo(a[0],a[1]);for(var o=1;o<a.length/2;o++){e.lineTo(a[o*2],a[o*2+1])}if(a[0]===a[a.length-2]&&a[1]===a[a.length-1]){e.closePath()}}else if(n.type===W.Graphics.RECT){e.rect(r.x,r.y,r.width,r.height);e.closePath()}else if(n.type===W.Graphics.CIRC){e.arc(r.x,r.y,r.radius,0,2*Math.PI);e.closePath()}else if(n.type===W.Graphics.ELIP){var h=r.width*2;var l=r.height*2;var u=r.x-h/2;var f=r.y-l/2;var c=.5522848,d=h/2*c,p=l/2*c,g=u+h,m=f+l,y=u+h/2,v=f+l/2;e.moveTo(u,v);e.bezierCurveTo(u,v-p,y-d,f,y,f);e.bezierCurveTo(y+d,f,g,v-p,g,v);e.bezierCurveTo(g,v+p,y+d,m,y,m);e.bezierCurveTo(y-d,m,u,v+p,u,v);e.closePath()}else if(n.type===W.Graphics.RREC){var x=r.x;var b=r.y;var _=r.width;var w=r.height;var T=r.radius;var C=Math.min(_,w)/2|0;T=T>C?C:T;e.moveTo(x,b+T);e.lineTo(x,b+w-T);e.quadraticCurveTo(x,b+w,x+T,b+w);e.lineTo(x+_-T,b+w);e.quadraticCurveTo(x+_,b+w,x+_,b+w-T);e.lineTo(x+_,b+T);e.quadraticCurveTo(x+_,b,x+_-T,b);e.lineTo(x+T,b);e.quadraticCurveTo(x,b,x,b+T);e.closePath()}}};W.CanvasGraphics.updateGraphicsTint=function(t){if(t.tint===16777215){return}var e=(t.tint>>16&255)/255;var i=(t.tint>>8&255)/255;var s=(t.tint&255)/255;for(var n=0;n<t.graphicsData.length;n++){var r=t.graphicsData[n];var a=r.fillColor|0;var o=r.lineColor|0;r._fillTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(a&255)/255*s*255;r._lineTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*i*255<<8)+(o&255)/255*s*255}};W.Graphics=function(){W.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=W.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=false;this.boundsPadding=0;this._localBounds=new W.Rectangle(0,0,1,1);this.dirty=true;this.webGLDirty=false;this.cachedSpriteDirty=false};W.Graphics.prototype=Object.create(W.DisplayObjectContainer.prototype);W.Graphics.prototype.constructor=W.Graphics;W.Graphics.prototype.lineStyle=function(t,e,i){this.lineWidth=t||0;this.lineColor=e||0;this.lineAlpha=i===undefined?1:i;if(this.currentPath){if(this.currentPath.shape.points.length){this.drawShape(new W.Polygon(this.currentPath.shape.points.slice(-2)))}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}}return this};W.Graphics.prototype.moveTo=function(t,e){this.drawShape(new W.Polygon([t,e]));return this};W.Graphics.prototype.lineTo=function(t,e){if(!this.currentPath){this.moveTo(0,0)}this.currentPath.shape.points.push(t,e);this.dirty=true;return this};W.Graphics.prototype.quadraticCurveTo=function(t,e,i,s){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var n,r,a=20,o=this.currentPath.shape.points;if(o.length===0){this.moveTo(0,0)}var h=o[o.length-2];var l=o[o.length-1];var u=0;for(var f=1;f<=a;++f){u=f/a;n=h+(t-h)*u;r=l+(e-l)*u;o.push(n+(t+(i-t)*u-n)*u,r+(e+(s-e)*u-r)*u)}this.dirty=true;return this};W.Graphics.prototype.bezierCurveTo=function(t,e,i,s,n,r){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var a=20,o,h,l,u,f,c=this.currentPath.shape.points;var d=c[c.length-2];var p=c[c.length-1];var g=0;for(var m=1;m<=a;++m){g=m/a;o=1-g;h=o*o;l=h*o;u=g*g;f=u*g;c.push(l*d+3*h*g*t+3*o*u*i+f*n,l*p+3*h*g*e+3*o*u*s+f*r)}this.dirty=true;return this};W.Graphics.prototype.arcTo=function(t,e,i,s,n){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(t,e)}}else{this.moveTo(t,e)}var r=this.currentPath.shape.points,a=r[r.length-2],o=r[r.length-1],h=o-e,l=a-t,u=s-e,f=i-t,c=Math.abs(h*f-l*u);if(c<1e-8||n===0){if(r[r.length-2]!==t||r[r.length-1]!==e){r.push(t,e)}}else{var d=h*h+l*l,p=u*u+f*f,g=h*u+l*f,m=n*Math.sqrt(d)/c,y=n*Math.sqrt(p)/c,v=m*g/d,x=y*g/p,b=m*f+y*l,_=m*u+y*h,w=l*(y+v),T=h*(y+v),C=f*(m+x),S=u*(m+x),P=Math.atan2(T-_,w-b),A=Math.atan2(S-_,C-b);this.arc(b+t,_+e,n,P,A,l*u>f*h)}this.dirty=true;return this};W.Graphics.prototype.arc=function(t,e,i,s,n,r){if(s===n){return this}if(typeof r==="undefined"){r=false}if(!r&&n<=s){n+=Math.PI*2}else if(r&&s<=n){s+=Math.PI*2}var a=r?(s-n)*-1:n-s;var o=Math.ceil(Math.abs(a)/(Math.PI*2))*40;if(a===0){return this}var h=t+Math.cos(s)*i;var l=e+Math.sin(s)*i;if(r&&this.filling){this.moveTo(t,e)}else{this.moveTo(h,l)}var u=this.currentPath.shape.points;var f=a/(o*2);var c=f*2;var d=Math.cos(f);var p=Math.sin(f);var g=o-1;var m=g%1/g;for(var y=0;y<=g;y++){var v=y+m*y;var x=f+s+c*v;var b=Math.cos(x);var _=-Math.sin(x);u.push((d*b+p*_)*i+t,(d*-_+p*b)*i+e)}this.dirty=true;return this};W.Graphics.prototype.beginFill=function(t,e){this.filling=true;this.fillColor=t||0;this.fillAlpha=e===undefined?1:e;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}}return this};W.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};W.Graphics.prototype.drawRect=function(t,e,i,s){this.drawShape(new W.Rectangle(t,e,i,s));return this};W.Graphics.prototype.drawRoundedRect=function(t,e,i,s,n){this.drawShape(new W.RoundedRectangle(t,e,i,s,n));return this};W.Graphics.prototype.drawCircle=function(t,e,i){this.drawShape(new W.Circle(t,e,i));return this};W.Graphics.prototype.drawEllipse=function(t,e,i,s){this.drawShape(new W.Ellipse(t,e,i,s));return this};W.Graphics.prototype.drawPolygon=function(t){var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i){e[i]=arguments[i]}}this.drawShape(new Phaser.Polygon(e));return this};W.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this.clearDirty=true;this.graphicsData=[];return this};W.Graphics.prototype.generateTexture=function(t,e){t=t||1;var i=this.getBounds();var s=new W.CanvasBuffer(i.width*t,i.height*t);var n=W.Texture.fromCanvas(s.canvas,e);n.baseTexture.resolution=t;s.context.scale(t,t);s.context.translate(-i.x,-i.y);W.CanvasGraphics.renderGraphics(this,s.context);return n};W.Graphics.prototype._renderWebGL=function(t){if(this.visible===false||this.alpha===0||this.isMask===true)return;if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.worldAlpha=this.worldAlpha;W.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);return}else{t.spriteBatch.stop();t.blendModeManager.setBlendMode(this.blendMode);if(this._mask)t.maskManager.pushMask(this._mask,t);if(this._filters)t.filterManager.pushFilter(this._filterBlock);if(this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var e=W.blendModesWebGL[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(e[0],e[1])}if(this.webGLDirty){this.dirty=true;this.webGLDirty=false}W.WebGLGraphics.renderGraphics(this,t);if(this.children.length){t.spriteBatch.start();for(var i=0;i<this.children.length;i++){this.children[i]._renderWebGL(t)}t.spriteBatch.stop()}if(this._filters)t.filterManager.popFilter();if(this._mask)t.maskManager.popMask(this.mask,t);t.drawCount++;t.spriteBatch.start()}};W.Graphics.prototype._renderCanvas=function(t){if(this.isMask===true){return}if(this._prevTint!==this.tint){this.dirty=true;this._prevTint=this.tint}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.alpha=this.alpha;W.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);return}else{var e=t.context;var i=this.worldTransform;if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;e.globalCompositeOperation=W.blendModesCanvas[t.currentBlendMode]}if(this._mask){t.maskManager.pushMask(this._mask,t)}var s=t.resolution;e.setTransform(i.a*s,i.b*s,i.c*s,i.d*s,i.tx*s,i.ty*s);W.CanvasGraphics.renderGraphics(this,e);for(var n=0;n<this.children.length;n++){this.children[n]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}}};W.Graphics.prototype.getBounds=function(t){if(!this._currentBounds){if(!this.renderable){return W.EmptyRectangle}if(this.dirty){this.updateLocalBounds();this.webGLDirty=true;this.cachedSpriteDirty=true;this.dirty=false}var e=this._localBounds;var i=e.x;var s=e.width+e.x;var n=e.y;var r=e.height+e.y;var a=t||this.worldTransform;var o=a.a;var h=a.b;var l=a.c;var u=a.d;var f=a.tx;var c=a.ty;var d=o*s+l*r+f;var p=u*r+h*s+c;var g=o*i+l*r+f;var m=u*r+h*i+c;var y=o*i+l*n+f;var v=u*n+h*i+c;var x=o*s+l*n+f;var b=u*n+h*s+c;var _=d;var w=p;var T=d;var C=p;T=g<T?g:T;T=y<T?y:T;T=x<T?x:T;C=m<C?m:C;C=v<C?v:C;C=b<C?b:C;_=g>_?g:_;_=y>_?y:_;_=x>_?x:_;w=m>w?m:w;w=v>w?v:w;w=b>w?b:w;this._bounds.x=T;this._bounds.width=_-T;this._bounds.y=C;this._bounds.height=w-C;this._currentBounds=this._bounds}return this._currentBounds};W.Graphics.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint);var e=this.graphicsData;for(var i=0;i<e.length;i++){var s=e[i];if(!s.fill){continue}if(s.shape){if(s.shape.contains(tempPoint.x,tempPoint.y)){return true}}}return false};W.Graphics.prototype.updateLocalBounds=function(){var t=Infinity;var e=-Infinity;var i=Infinity;var s=-Infinity;if(this.graphicsData.length){var n,r,a,o,h,l;for(var u=0;u<this.graphicsData.length;u++){var f=this.graphicsData[u];var c=f.type;var d=f.lineWidth;n=f.shape;if(c===W.Graphics.RECT||c===W.Graphics.RREC){a=n.x-d/2;o=n.y-d/2;h=n.width+d;l=n.height+d;t=a<t?a:t;e=a+h>e?a+h:e;i=o<i?o:i;s=o+l>s?o+l:s}else if(c===W.Graphics.CIRC){a=n.x;o=n.y;h=n.radius+d/2;l=n.radius+d/2;t=a-h<t?a-h:t;e=a+h>e?a+h:e;i=o-l<i?o-l:i;s=o+l>s?o+l:s}else if(c===W.Graphics.ELIP){a=n.x;o=n.y;h=n.width+d/2;l=n.height+d/2;t=a-h<t?a-h:t;e=a+h>e?a+h:e;i=o-l<i?o-l:i;s=o+l>s?o+l:s}else{r=n.points;for(var p=0;p<r.length;p++){if(r[p]instanceof Phaser.Point){a=r[p].x;o=r[p].y}else{a=r[p];o=r[p+1];if(p<r.length-1){p++}}t=a-d<t?a-d:t;e=a+d>e?a+d:e;i=o-d<i?o-d:i;s=o+d>s?o+d:s}}}}else{t=0;e=0;i=0;s=0}var g=this.boundsPadding;this._localBounds.x=t-g;this._localBounds.width=e-t+g*2;this._localBounds.y=i-g;this._localBounds.height=s-i+g*2};W.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds();if(!this._cachedSprite){var e=new W.CanvasBuffer(t.width,t.height);var i=W.Texture.fromCanvas(e.canvas);this._cachedSprite=new W.Sprite(i);this._cachedSprite.buffer=e;this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.buffer.resize(t.width,t.height)}this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._cachedSprite.buffer.context.translate(-t.x,-t.y);this.worldAlpha=1;W.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};W.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite;var e=t.texture;var i=t.buffer.canvas;e.baseTexture.width=i.width;e.baseTexture.height=i.height;e.crop.width=e.frame.width=i.width;e.crop.height=e.frame.height=i.height;t._width=i.width;t._height=i.height;e.baseTexture.dirty()};W.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(true);this._cachedSprite=null};W.Graphics.prototype.drawShape=function(t){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop()}}this.currentPath=null;if(t instanceof W.Polygon){t.flatten()}var e=new W.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);this.graphicsData.push(e);if(e.type===W.Graphics.POLY){e.shape.closed=this.filling;this.currentPath=e}this.dirty=true;return e};Object.defineProperty(W.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t;if(this._cacheAsBitmap){this._generateCachedSprite()}else{this.destroyCachedSprite();this.dirty=true}}});W.GraphicsData=function(t,e,i,s,n,r,a){this.lineWidth=t;this.lineColor=e;this.lineAlpha=i;this._lineTint=e;this.fillColor=s;this.fillAlpha=n;this._fillTint=s;this.fill=r;this.shape=a;this.type=a.type};W.GraphicsData.prototype.constructor=W.GraphicsData;W.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};W.Strip=function(t){W.DisplayObjectContainer.call(this);this.texture=t;this.uvs=new W.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new W.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new W.Float32Array([1,1,1,1]);this.indices=new W.Uint16Array([0,1,2,3]);this.dirty=true;this.blendMode=W.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=W.Strip.DrawModes.TRIANGLE_STRIP};W.Strip.prototype=Object.create(W.DisplayObjectContainer.prototype);W.Strip.prototype.constructor=W.Strip;W.Strip.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0)return;t.spriteBatch.stop();if(!this._vertexBuffer)this._initWebGL(t);t.shaderManager.setShader(t.shaderManager.stripShader);this._renderStrip(t);t.spriteBatch.start()};W.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer();this._indexBuffer=e.createBuffer();this._uvBuffer=e.createBuffer();this._colorBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer);e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer);e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)};W.Strip.prototype._renderStrip=function(t){var e=t.gl;var i=t.projection,s=t.offset,n=t.shaderManager.stripShader;var r=this.drawMode===W.Strip.DrawModes.TRIANGLE_STRIP?e.TRIANGLE_STRIP:e.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode);e.uniformMatrix3fv(n.translationMatrix,false,this.worldTransform.toArray(true));e.uniform2f(n.projectionVector,i.x,-i.y);e.uniform2f(n.offsetVector,-s.x,-s.y);e.uniform1f(n.alpha,this.worldAlpha);if(!this.dirty){e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);e.vertexAttribPointer(n.aVertexPosition,2,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer);e.vertexAttribPointer(n.aTextureCoord,2,e.FLOAT,false,0,0);e.activeTexture(e.TEXTURE0);if(this.texture.baseTexture._dirty[e.id]){t.renderer.updateTexture(this.texture.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id])}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer)}else{this.dirty=false;e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);e.bufferData(e.ARRAY_BUFFER,this.vertices,e.STATIC_DRAW);e.vertexAttribPointer(n.aVertexPosition,2,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer);e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW);e.vertexAttribPointer(n.aTextureCoord,2,e.FLOAT,false,0,0);e.activeTexture(e.TEXTURE0);if(this.texture.baseTexture._dirty[e.id]){t.renderer.updateTexture(this.texture.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id])}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)}e.drawElements(r,this.indices.length,e.UNSIGNED_SHORT,0)};W.Strip.prototype._renderCanvas=function(t){var e=t.context;var i=this.worldTransform;if(t.roundPixels){e.setTransform(i.a,i.b,i.c,i.d,i.tx|0,i.ty|0)}else{e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty)}if(this.drawMode===W.Strip.DrawModes.TRIANGLE_STRIP){this._renderCanvasTriangleStrip(e)}else{this._renderCanvasTriangles(e)}};W.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices;var i=this.uvs;var s=e.length/2;this.count++;for(var n=0;n<s-2;n++){var r=n*2;this._renderCanvasDrawTriangle(t,e,i,r,r+2,r+4)}};W.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices;var i=this.uvs;var s=this.indices;var n=s.length;this.count++;for(var r=0;r<n;r+=3){var a=s[r]*2,o=s[r+1]*2,h=s[r+2]*2;this._renderCanvasDrawTriangle(t,e,i,a,o,h)}};W.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,s,n,r){var a=this.texture.baseTexture.source;var o=this.texture.width;var h=this.texture.height;var l=e[s],u=e[n],f=e[r];var c=e[s+1],d=e[n+1],p=e[r+1];var g=i[s]*o,m=i[n]*o,y=i[r]*o;var v=i[s+1]*h,x=i[n+1]*h,b=i[r+1]*h;if(this.canvasPadding>0){var _=this.canvasPadding/this.worldTransform.a;var w=this.canvasPadding/this.worldTransform.d;var T=(l+u+f)/3;var C=(c+d+p)/3;var S=l-T;var P=c-C;var A=Math.sqrt(S*S+P*P);l=T+S/A*(A+_);c=C+P/A*(A+w);S=u-T;P=d-C;A=Math.sqrt(S*S+P*P);u=T+S/A*(A+_);d=C+P/A*(A+w);S=f-T;P=p-C;A=Math.sqrt(S*S+P*P);f=T+S/A*(A+_);p=C+P/A*(A+w)}t.save();t.beginPath();t.moveTo(l,c);t.lineTo(u,d);t.lineTo(f,p);t.closePath();t.clip();var M=g*x+v*y+m*b-x*y-v*m-g*b;var R=l*x+v*f+u*b-x*f-v*u-l*b;var E=g*u+l*y+m*f-u*y-l*m-g*f;var O=g*x*f+v*u*y+l*m*b-l*x*y-v*m*f-g*u*b;var I=c*x+v*p+d*b-x*p-v*d-c*b;var L=g*d+c*y+m*p-d*y-c*m-g*p;var D=g*x*p+v*d*y+c*m*b-c*x*y-v*m*p-g*d*b;t.transform(R/M,I/M,E/M,L/M,O/M,D/M);t.drawImage(a,0,0);t.restore()};W.Strip.prototype.renderStripFlat=function(t){var e=this.context;var i=t.vertices;var s=i.length/2;this.count++;e.beginPath();for(var n=1;n<s-2;n++){var r=n*2;var a=i[r],o=i[r+2],h=i[r+4];var l=i[r+1],u=i[r+3],f=i[r+5];e.moveTo(a,l);e.lineTo(o,u);e.lineTo(h,f)}e.fillStyle="#FF0000";e.fill();e.closePath()};W.Strip.prototype.onTextureUpdate=function(){this.updateFrame=true};W.Strip.prototype.getBounds=function(t){var e=t||this.worldTransform;var i=e.a;var s=e.b;var n=e.c;var r=e.d;var a=e.tx;var o=e.ty;var h=-Infinity;var l=-Infinity;var u=Infinity;var f=Infinity;var c=this.vertices;for(var d=0,p=c.length;d<p;d+=2){var g=c[d],m=c[d+1];var y=i*g+n*m+a;var v=r*m+s*g+o;u=y<u?y:u;f=v<f?v:f;h=y>h?y:h;l=v>l?v:l}if(u===-Infinity||l===Infinity){return W.EmptyRectangle}var x=this._bounds;x.x=u;x.width=h-u;x.y=f;x.height=l-f;this._currentBounds=x;return x};W.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1};W.Rope=function(t,e){W.Strip.call(this,t);this.points=e;this.vertices=new W.Float32Array(e.length*4);this.uvs=new W.Float32Array(e.length*4);this.colors=new W.Float32Array(e.length*2);this.indices=new W.Uint16Array(e.length*2);this.refresh()};W.Rope.prototype=Object.create(W.Strip.prototype);W.Rope.prototype.constructor=W.Rope;W.Rope.prototype.refresh=function(){var t=this.points;if(t.length<1)return;var e=this.uvs;var i=t[0];var s=this.indices;var n=this.colors;this.count-=.2;e[0]=0;e[1]=0;e[2]=0;e[3]=1;n[0]=1;n[1]=1;s[0]=0;s[1]=1;var r=t.length,a,o,h;for(var l=1;l<r;l++){a=t[l];o=l*4;h=l/(r-1);if(l%2){e[o]=h;e[o+1]=0;e[o+2]=h;e[o+3]=1}else{e[o]=h;e[o+1]=0;e[o+2]=h;e[o+3]=1}o=l*2;n[o]=1;n[o+1]=1;o=l*2;s[o]=o;s[o+1]=o+1;i=a}};W.Rope.prototype.updateTransform=function(){var t=this.points;if(t.length<1)return;var e=t[0];var i;var s={x:0,y:0};this.count-=.2;var n=this.vertices;var r=t.length,a,o,h,l,u;for(var f=0;f<r;f++){a=t[f];o=f*4;if(f<t.length-1){i=t[f+1]}else{i=a}s.y=-(i.x-e.x);s.x=i.y-e.y;h=(1-f/(r-1))*10;if(h>1)h=1;l=Math.sqrt(s.x*s.x+s.y*s.y);u=this.texture.height/2;s.x/=l;s.y/=l;s.x*=u;s.y*=u;n[o]=a.x+s.x;n[o+1]=a.y+s.y;n[o+2]=a.x-s.x;n[o+3]=a.y-s.y;e=a}W.DisplayObjectContainer.prototype.updateTransform.call(this)};W.Rope.prototype.setTexture=function(t){this.texture=t};W.TilingSprite=function(t,e,i){W.Sprite.call(this,t);this._width=e||100;this._height=i||100;this.tileScale=new W.Point(1,1);this.tileScaleOffset=new W.Point(1,1);this.tilePosition=new W.Point(0,0);this.renderable=true;this.tint=16777215;this.blendMode=W.blendModes.NORMAL};W.TilingSprite.prototype=Object.create(W.Sprite.prototype);W.TilingSprite.prototype.constructor=W.TilingSprite;Object.defineProperty(W.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}});Object.defineProperty(W.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}});W.TilingSprite.prototype.setTexture=function(t){if(this.texture===t)return;this.texture=t;this.refreshTexture=true;this.cachedTint=16777215};W.TilingSprite.prototype._renderWebGL=function(t){if(this.visible===false||this.alpha===0)return;var e,i;if(this._mask){t.spriteBatch.stop();t.maskManager.pushMask(this.mask,t);t.spriteBatch.start()}if(this._filters){t.spriteBatch.flush();t.filterManager.pushFilter(this._filterBlock)}if(!this.tilingTexture||this.refreshTexture){this.generateTilingTexture(true);if(this.tilingTexture&&this.tilingTexture.needsUpdate){t.renderer.updateTexture(this.tilingTexture.baseTexture);this.tilingTexture.needsUpdate=false}}else{t.spriteBatch.renderTilingSprite(this)}for(e=0,i=this.children.length;e<i;e++){this.children[e]._renderWebGL(t)}t.spriteBatch.stop();if(this._filters)t.filterManager.popFilter();if(this._mask)t.maskManager.popMask(this._mask,t);t.spriteBatch.start()};W.TilingSprite.prototype._renderCanvas=function(t){if(this.visible===false||this.alpha===0)return;var e=t.context;if(this._mask){t.maskManager.pushMask(this._mask,t)}e.globalAlpha=this.worldAlpha;var i=this.worldTransform;var s,n;var r=t.resolution;e.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,i.tx*r,i.ty*r);if(!this.__tilePattern||this.refreshTexture){this.generateTilingTexture(false);if(this.tilingTexture){this.__tilePattern=e.createPattern(this.tilingTexture.baseTexture.source,"repeat")}else{return}}if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;e.globalCompositeOperation=W.blendModesCanvas[t.currentBlendMode]}var a=this.tilePosition;var o=this.tileScale;a.x%=this.tilingTexture.baseTexture.width;a.y%=this.tilingTexture.baseTexture.height;e.scale(o.x,o.y);e.translate(a.x+this.anchor.x*-this._width,a.y+this.anchor.y*-this._height);e.fillStyle=this.__tilePattern;e.fillRect(-a.x,-a.y,this._width/o.x,this._height/o.y);e.scale(1/o.x,1/o.y);e.translate(-a.x+this.anchor.x*this._width,-a.y+this.anchor.y*this._height);if(this._mask){t.maskManager.popMask(t)}for(s=0,n=this.children.length;s<n;s++){this.children[s]._renderCanvas(t)}};W.TilingSprite.prototype.getBounds=function(){var t=this._width;var e=this._height;var i=t*(1-this.anchor.x);var s=t*-this.anchor.x;var n=e*(1-this.anchor.y);var r=e*-this.anchor.y;var a=this.worldTransform;var o=a.a;var h=a.b;var l=a.c;var u=a.d;var f=a.tx;var c=a.ty;var d=o*s+l*r+f;var p=u*r+h*s+c;var g=o*i+l*r+f;var m=u*r+h*i+c;var y=o*i+l*n+f;var v=u*n+h*i+c;var x=o*s+l*n+f;var b=u*n+h*s+c;var _=-Infinity;var w=-Infinity;var T=Infinity;var C=Infinity;T=d<T?d:T;T=g<T?g:T;T=y<T?y:T;T=x<T?x:T;C=p<C?p:C;C=m<C?m:C;C=v<C?v:C;C=b<C?b:C;_=d>_?d:_;_=g>_?g:_;_=y>_?y:_;_=x>_?x:_;w=p>w?p:w;w=m>w?m:w;w=v>w?v:w;w=b>w?b:w;var S=this._bounds;S.x=T;S.width=_-T;S.y=C;S.height=w-C;this._currentBounds=S;return S};W.TilingSprite.prototype.onTextureUpdate=function(){};W.TilingSprite.prototype.generateTilingTexture=function(t){if(!this.texture.baseTexture.hasLoaded)return;var e=this.originalTexture||this.texture;var i=e.frame;var s,n;var r=i.width!==e.baseTexture.width||i.height!==e.baseTexture.height;var a=false;if(!t){if(r){if(e.crop){s=e.crop.width;n=e.crop.height}else{s=i.width;n=i.height}a=true}}else{if(e.crop){s=W.getNextPowerOfTwo(e.crop.width);n=W.getNextPowerOfTwo(e.crop.height)}else{s=W.getNextPowerOfTwo(i.width);n=W.getNextPowerOfTwo(i.height)}a=true}if(a){var o;if(this.tilingTexture&&this.tilingTexture.isTiling){o=this.tilingTexture.canvasBuffer;o.resize(s,n);this.tilingTexture.baseTexture.width=s;this.tilingTexture.baseTexture.height=n;this.tilingTexture.needsUpdate=true}else{o=new W.CanvasBuffer(s,n);this.tilingTexture=W.Texture.fromCanvas(o.canvas);this.tilingTexture.canvasBuffer=o;this.tilingTexture.isTiling=true}o.context.drawImage(e.baseTexture.source,e.crop.x,e.crop.y,e.crop.width,e.crop.height,0,0,s,n);this.tileScaleOffset.x=i.width/s;this.tileScaleOffset.y=i.height/n}else{if(this.tilingTexture&&this.tilingTexture.isTiling){this.tilingTexture.destroy(true)}this.tileScaleOffset.x=1;this.tileScaleOffset.y=1;this.tilingTexture=e}this.refreshTexture=false;this.originalTexture=this.texture;this.texture=this.tilingTexture;this.tilingTexture.baseTexture._powerOf2=true};W.TilingSprite.prototype.destroy=function(){W.Sprite.prototype.destroy.call(this);this.tileScale=null;this.tileScaleOffset=null;this.tilePosition=null;if(this.tilingTexture){this.tilingTexture.destroy(true);this.tilingTexture=null}};W.BaseTextureCache={};W.BaseTextureCacheIdGenerator=0;W.BaseTexture=function(t,e){this.resolution=1;this.width=100;this.height=100;this.scaleMode=e||W.scaleModes.DEFAULT;this.hasLoaded=false;this.source=t;this._UID=W._UID++;this.premultipliedAlpha=true;this._glTextures=[];this.mipmap=false;this._dirty=[true,true,true,true];if(!t)return;if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=true;this.width=this.source.naturalWidth||this.source.width;this.height=this.source.naturalHeight||this.source.height;this.dirty()}else{}this.imageUrl=null;this._powerOf2=false};W.BaseTexture.prototype.constructor=W.BaseTexture;W.BaseTexture.prototype.destroy=function(){if(this.imageUrl){delete W.BaseTextureCache[this.imageUrl];delete W.TextureCache[this.imageUrl];this.imageUrl=null;if(!navigator.isCocoonJS)this.source.src=""}else if(this.source&&this.source._pixiId){delete W.BaseTextureCache[this.source._pixiId]}this.source=null;this.unloadFromGPU()};W.BaseTexture.prototype.updateSourceImage=function(t){this.hasLoaded=false;this.source.src=null;this.source.src=t};W.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++){this._dirty[t]=true}};W.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var e=this._glTextures[t];var i=W.glContexts[t];if(i&&e){i.deleteTexture(e)}}this._glTextures.length=0;this.dirty()};W.BaseTexture.fromImage=function(t,e,i){var s=W.BaseTextureCache[t];if(e===undefined&&t.indexOf("data:")===-1)e=true;if(!s){var n=new Image;if(e){n.crossOrigin=""}n.src=t;s=new W.BaseTexture(n,i);s.imageUrl=t;W.BaseTextureCache[t]=s;if(t.indexOf(W.RETINA_PREFIX+".")!==-1){s.resolution=2}}return s};W.BaseTexture.fromCanvas=function(t,e){if(!t._pixiId){t._pixiId="canvas_"+W.TextureCacheIdGenerator++}var i=W.BaseTextureCache[t._pixiId];if(!i){i=new W.BaseTexture(t,e);W.BaseTextureCache[t._pixiId]=i}return i};W.TextureCache={};W.FrameCache={};W.TextureSilentFail=false;W.TextureCacheIdGenerator=0;W.Texture=function(t,e,i,s){this.noFrame=false;if(!e){this.noFrame=true;e=new W.Rectangle(0,0,1,1)}if(t instanceof W.Texture){t=t.baseTexture}this.baseTexture=t;this.frame=e;this.trim=s;this.valid=false;this.requiresUpdate=false;this._uvs=null;this.width=0;this.height=0;this.crop=i||new W.Rectangle(0,0,1,1);if(t.hasLoaded){if(this.noFrame)e=new W.Rectangle(0,0,t.width,t.height);this.setFrame(e)}};W.Texture.prototype.constructor=W.Texture;W.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;if(this.noFrame)this.frame=new W.Rectangle(0,0,t.width,t.height);this.setFrame(this.frame)};W.Texture.prototype.destroy=function(t){if(t)this.baseTexture.destroy();this.valid=false};W.Texture.prototype.setFrame=function(t){this.noFrame=false;this.frame=t;this.width=t.width;this.height=t.height;this.crop.x=t.x;this.crop.y=t.y;this.crop.width=t.width;this.crop.height=t.height;if(!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)){if(!W.TextureSilentFail){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.valid=false;return}this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this.frame.width=this.trim.width;this.frame.height=this.trim.height}if(this.valid)this._updateUvs()};W.Texture.prototype._updateUvs=function(){if(!this._uvs)this._uvs=new W.TextureUvs;var t=this.crop;var e=this.baseTexture.width;var i=this.baseTexture.height;this._uvs.x0=t.x/e;this._uvs.y0=t.y/i;this._uvs.x1=(t.x+t.width)/e;this._uvs.y1=t.y/i;this._uvs.x2=(t.x+t.width)/e;this._uvs.y2=(t.y+t.height)/i;this._uvs.x3=t.x/e;this._uvs.y3=(t.y+t.height)/i};W.Texture.fromImage=function(t,e,i){var s=W.TextureCache[t];if(!s){s=new W.Texture(W.BaseTexture.fromImage(t,e,i));W.TextureCache[t]=s}return s};W.Texture.fromFrame=function(t){var e=W.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache ');return e};W.Texture.fromCanvas=function(t,e){var i=W.BaseTexture.fromCanvas(t,e);return new W.Texture(i)};W.Texture.addTextureToCache=function(t,e){W.TextureCache[e]=t};W.Texture.removeTextureFromCache=function(t){var e=W.TextureCache[t];delete W.TextureCache[t];delete W.BaseTextureCache[t];return e};W.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};W.RenderTexture=function(t,e,i,s,n){this.width=t||100;this.height=e||100;this.resolution=n||1;this.frame=new W.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.crop=new W.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.baseTexture=new W.BaseTexture;this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;this.baseTexture._glTextures=[];this.baseTexture.resolution=this.resolution;this.baseTexture.scaleMode=s||W.scaleModes.DEFAULT;this.baseTexture.hasLoaded=true;W.Texture.call(this,this.baseTexture,new W.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution));this.renderer=i||W.defaultRenderer;if(this.renderer.type===W.WEBGL_RENDERER){var r=this.renderer.gl;this.baseTexture._dirty[r.id]=false;this.textureBuffer=new W.FilterTexture(r,this.width,this.height,this.baseTexture.scaleMode);this.baseTexture._glTextures[r.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new W.Point(this.width*.5,-this.height*.5)}else{this.render=this.renderCanvas;this.textureBuffer=new W.CanvasBuffer(this.width*this.resolution,this.height*this.resolution);this.baseTexture.source=this.textureBuffer.canvas}this.valid=true;this._updateUvs()};W.RenderTexture.prototype=Object.create(W.Texture.prototype);W.RenderTexture.prototype.constructor=W.RenderTexture;W.RenderTexture.prototype.resize=function(t,e,i){if(t===this.width&&e===this.height)return;this.valid=t>0&&e>0;this.width=t;this.height=e;this.frame.width=this.crop.width=t*this.resolution;this.frame.height=this.crop.height=e*this.resolution;if(i){this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution}if(this.renderer.type===W.WEBGL_RENDERER){this.projection.x=this.width/2;this.projection.y=-this.height/2}if(!this.valid)return;this.textureBuffer.resize(this.width,this.height)};W.RenderTexture.prototype.clear=function(){if(!this.valid)return;if(this.renderer.type===W.WEBGL_RENDERER){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer)}this.textureBuffer.clear()};W.RenderTexture.prototype.renderWebGL=function(t,e,i){if(!this.valid)return;var s=t.worldTransform;s.identity();s.translate(0,this.projection.y*2);if(e)s.append(e);s.scale(1,-1);t.worldAlpha=1;var n=t.children;for(var r=0,a=n.length;r<a;r++){n[r].updateTransform()}var o=this.renderer.gl;o.viewport(0,0,this.width*this.resolution,this.height*this.resolution);o.bindFramebuffer(o.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(i)this.textureBuffer.clear();this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer);this.renderer.spriteBatch.dirty=true};W.RenderTexture.prototype.renderCanvas=function(t,e,i){if(!this.valid)return;var s=t.worldTransform;s.identity();if(e)s.append(e);t.worldAlpha=1;var n=t.children;for(var r=0,a=n.length;r<a;r++){n[r].updateTransform()}if(i)this.textureBuffer.clear();var o=this.textureBuffer.context;var h=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(t,o);this.renderer.resolution=h};W.RenderTexture.prototype.getImage=function(){var t=new Image;t.src=this.getBase64();return t};W.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};W.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===W.WEBGL_RENDERER){var t=this.renderer.gl;var e=this.textureBuffer.width;var i=this.textureBuffer.height;var s=new Uint8Array(4*e*i);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer);t.readPixels(0,0,e,i,t.RGBA,t.UNSIGNED_BYTE,s);t.bindFramebuffer(t.FRAMEBUFFER,null);var n=new W.CanvasBuffer(e,i);var r=n.context.getImageData(0,0,e,i);r.data.set(s);n.context.putImageData(r,0,0);return n.canvas}else{return this.textureBuffer.canvas}};W.AbstractFilter=function(t,e){this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.uniforms=e||{};this.fragmentSrc=t||[]};W.AbstractFilter.prototype.constructor=W.AbstractFilter;W.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++){this.shaders[t].dirty=true}};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=W}exports.PIXI=W}else if(typeof define!=="undefined"&&define.amd){define("PIXI",function(){return t.PIXI=W}())}else{t.PIXI=W}}).call(this);(function(){var t=this;var L=L||{VERSION:"2.3.0",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};window.Phaser=L;if(!Math.trunc){Math.trunc=function t(e){return e<0?Math.ceil(e):Math.floor(e)}}if(!Function.prototype.bind){Function.prototype.bind=function(){var r=Array.prototype.slice;return function(e){var i=this,s=r.call(arguments,1);if(typeof i!=="function"){throw new TypeError}function n(){var t=s.concat(r.call(arguments));i.apply(this instanceof n?this:e,t)}n.prototype=function t(e){if(e){t.prototype=e}if(!(this instanceof t)){return new t}}(i.prototype);return n}}()}if(!Array.isArray){Array.isArray=function(t){return Object.prototype.toString.call(t)=="[object Array]"}}if(!Array.prototype.forEach){Array.prototype.forEach=function(t){"use strict";if(this===void 0||this===null){throw new TypeError}var e=Object(this);var i=e.length>>>0;if(typeof t!=="function"){throw new TypeError}var s=arguments.length>=2?arguments[1]:void 0;for(var n=0;n<i;n++){if(n in e){t.call(s,e[n],n,e)}}}}if(typeof window.Uint32Array!=="function"&&typeof window.Uint32Array!=="object"){var e=function(t){var e=new Array;window[t]=function(t){if(typeof t==="number"){Array.call(this,t);this.length=t;for(var e=0;e<this.length;e++){this[e]=0}}else{Array.call(this,t.length);this.length=t.length;for(var e=0;e<this.length;e++){this[e]=t[e]}}};window[t].prototype=e;window[t].constructor=window[t]};e("Uint32Array");e("Int16Array")}if(!window.console){window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){}}L.Utils={getProperty:function(t,e){var i=e.split("."),s=i.pop(),n=i.length,r=1,a=i[0];while(r<n&&(t=t[a])){a=i[r];r++}if(t){return t[s]}else{return null}},setProperty:function(t,e,i){var s=e.split("."),n=s.pop(),r=s.length,a=1,o=s[0];while(a<r&&(t=t[o])){o=s[a];a++}if(t){t[n]=i}return t},chanceRoll:function(t){if(typeof t==="undefined"){t=50}return t>0&&Math.random()*100<=t},randomChoice:function(t,e){return Math.random()<.5?t:e},transposeArray:function(t){return L.ArrayUtils.transposeMatrix(t)},rotateArray:function(t,e){return L.ArrayUtils.rotateMatrix(t,e)},shuffle:function(t){return L.ArrayUtils.shuffle(t)},parseDimension:function(t,e){var i=0;var s=0;if(typeof t==="string"){if(t.substr(-1)==="%"){i=parseInt(t,10)/100;if(e===0){s=window.innerWidth*i}else{s=window.innerHeight*i}}else{s=parseInt(t,10)}}else{s=t}return s},pad:function(t,e,i,s){if(typeof e==="undefined"){var e=0}if(typeof i==="undefined"){var i=" "}if(typeof s==="undefined"){var s=3}var n=0;if(e+1>=t.length){switch(s){case 1:t=new Array(e+1-t.length).join(i)+t;break;case 3:var r=Math.ceil((n=e-t.length)/2);var a=n-r;t=new Array(a+1).join(i)+t+new Array(r+1).join(i);break;default:t=t+new Array(e+1-t.length).join(i);break}}return t},isPlainObject:function(t){if(typeof t!=="object"||t.nodeType||t===t.window){return false}try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf")){return false}}catch(t){return false}return true},extend:function(){var t,e,i,s,n,r,a=arguments[0]||{},o=1,h=arguments.length,l=false;if(typeof a==="boolean"){l=a;a=arguments[1]||{};o=2}if(h===o){a=this;--o}for(;o<h;o++){if((t=arguments[o])!=null){for(e in t){i=a[e];s=t[e];if(a===s){continue}if(l&&s&&(L.Utils.isPlainObject(s)||(n=Array.isArray(s)))){if(n){n=false;r=i&&Array.isArray(i)?i:[]}else{r=i&&L.Utils.isPlainObject(i)?i:{}}a[e]=L.Utils.extend(l,r,s)}else if(s!==undefined){a[e]=s}}}}return a},mixinPrototype:function(t,e,i){if(typeof i==="undefined"){i=false}var s=Object.keys(e);for(var n=0;n<s.length;n++){var r=s[n];var a=e[r];if(!i&&r in t){continue}else{if(a&&(typeof a.get==="function"||typeof a.set==="function")){if(typeof a.clone==="function"){t[r]=a.clone()}else{Object.defineProperty(t,r,a)}}else{t[r]=a}}}},mixin:function(t,e){if(!t||typeof t!=="object"){return e}for(var i in t){var s=t[i];if(s.childNodes||s.cloneNode){continue}var n=typeof t[i];if(!t[i]||n!=="object"){e[i]=t[i]}else{if(typeof e[i]===n){e[i]=L.Utils.mixin(t[i],e[i])}else{e[i]=L.Utils.mixin(t[i],new s.constructor)}}}return e}};L.Circle=function(t,e,i){t=t||0;e=e||0;i=i||0;this.x=t;this.y=e;this._diameter=i;this._radius=0;if(i>0){this._radius=i*.5}this.type=L.CIRCLE};L.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},getBounds:function(){return new L.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(t,e,i){this.x=t;this.y=e;this._diameter=i;this._radius=i*.5;return this},copyFrom:function(t){return this.setTo(t.x,t.y,t.diameter)},copyTo:function(t){t.x=this.x;t.y=this.y;t.diameter=this._diameter;return t},distance:function(t,e){var i=L.Math.distance(this.x,this.y,t.x,t.y);return e?Math.round(i):i},clone:function(t){if(typeof t==="undefined"||t===null){t=new L.Circle(this.x,this.y,this.diameter)}else{t.setTo(this.x,this.y,this.diameter)}return t},contains:function(t,e){return L.Circle.contains(this,t,e)},circumferencePoint:function(t,e,i){return L.Circle.circumferencePoint(this,t,e,i)},offset:function(t,e){this.x+=t;this.y+=e;return this},offsetPoint:function(t){return this.offset(t.x,t.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};L.Circle.prototype.constructor=L.Circle;Object.defineProperty(L.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(t){if(t>0){this._diameter=t;this._radius=t*.5}}});Object.defineProperty(L.Circle.prototype,"radius",{get:function(){return this._radius},set:function(t){if(t>0){this._radius=t;this._diameter=t*2}}});Object.defineProperty(L.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(t){if(t>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-t}}});Object.defineProperty(L.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(t){if(t<this.x){this._radius=0;this._diameter=0}else{this.radius=t-this.x}}});Object.defineProperty(L.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(t){if(t>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-t}}});Object.defineProperty(L.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(t){if(t<this.y){this._radius=0;this._diameter=0}else{this.radius=t-this.y}}});Object.defineProperty(L.Circle.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(L.Circle.prototype,"empty",{get:function(){return this._diameter===0},set:function(t){if(t===true){this.setTo(0,0,0)}}});L.Circle.contains=function(t,e,i){if(t.radius>0&&e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom){var s=(t.x-e)*(t.x-e);var n=(t.y-i)*(t.y-i);return s+n<=t.radius*t.radius}else{return false}};L.Circle.equals=function(t,e){return t.x==e.x&&t.y==e.y&&t.diameter==e.diameter};L.Circle.intersects=function(t,e){return L.Math.distance(t.x,t.y,e.x,e.y)<=t.radius+e.radius};L.Circle.circumferencePoint=function(t,e,i,s){if(typeof i==="undefined"){i=false}if(typeof s==="undefined"){s=new L.Point}if(i===true){e=L.Math.degToRad(e)}s.x=t.x+t.radius*Math.cos(e);s.y=t.y+t.radius*Math.sin(e);return s};L.Circle.intersectsRectangle=function(t,e){var i=Math.abs(t.x-e.x-e.halfWidth);var s=e.halfWidth+t.radius;if(i>s){return false}var n=Math.abs(t.y-e.y-e.halfHeight);var r=e.halfHeight+t.radius;if(n>r){return false}if(i<=e.halfWidth||n<=e.halfHeight){return true}var a=i-e.halfWidth;var o=n-e.halfHeight;var h=a*a;var l=o*o;var u=t.radius*t.radius;return h+l<=u};PIXI.Circle=L.Circle;L.Ellipse=function(t,e,i,s){t=t||0;e=e||0;i=i||0;s=s||0;this.x=t;this.y=e;this.width=i;this.height=s;this.type=L.ELLIPSE};L.Ellipse.prototype={setTo:function(t,e,i,s){this.x=t;this.y=e;this.width=i;this.height=s;return this},getBounds:function(){return new L.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){t.x=this.x;t.y=this.y;t.width=this.width;t.height=this.height;return t},clone:function(t){if(typeof t==="undefined"||t===null){t=new L.Ellipse(this.x,this.y,this.width,this.height)}else{t.setTo(this.x,this.y,this.width,this.height)}return t},contains:function(t,e){return L.Ellipse.contains(this,t,e)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};L.Ellipse.prototype.constructor=L.Ellipse;Object.defineProperty(L.Ellipse.prototype,"left",{get:function(){return this.x},set:function(t){this.x=t}});Object.defineProperty(L.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(t){if(t<this.x){this.width=0}else{this.width=t-this.x}}});Object.defineProperty(L.Ellipse.prototype,"top",{get:function(){return this.y},set:function(t){this.y=t}});Object.defineProperty(L.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){if(t<this.y){this.height=0}else{this.height=t-this.y}}});Object.defineProperty(L.Ellipse.prototype,"empty",{get:function(){return this.width===0||this.height===0},set:function(t){if(t===true){this.setTo(0,0,0,0)}}});L.Ellipse.contains=function(t,e,i){if(t.width<=0||t.height<=0){return false}var s=(e-t.x)/t.width-.5;var n=(i-t.y)/t.height-.5;s*=s;n*=n;return s+n<.25};PIXI.Ellipse=L.Ellipse;L.Line=function(t,e,i,s){t=t||0;e=e||0;i=i||0;s=s||0;this.start=new L.Point(t,e);this.end=new L.Point(i,s);this.type=L.LINE};L.Line.prototype={setTo:function(t,e,i,s){this.start.setTo(t,e);this.end.setTo(i,s);return this},fromSprite:function(t,e,i){if(typeof i==="undefined"){i=false}if(i){return this.setTo(t.center.x,t.center.y,e.center.x,e.center.y)}return this.setTo(t.x,t.y,e.x,e.y)},fromAngle:function(t,e,i,s){this.start.setTo(t,e);this.end.setTo(t+Math.cos(i)*s,e+Math.sin(i)*s);return this},intersects:function(t,e,i){return L.Line.intersectsPoints(this.start,this.end,t.start,t.end,e,i)},reflect:function(t){return L.Line.reflect(this,t)},pointOnLine:function(t,e){return(t-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(e-this.start.y)},pointOnSegment:function(t,e){var i=Math.min(this.start.x,this.end.x);var s=Math.max(this.start.x,this.end.x);var n=Math.min(this.start.y,this.end.y);var r=Math.max(this.start.y,this.end.y);return this.pointOnLine(t,e)&&(t>=i&&t<=s)&&(e>=n&&e<=r)},coordinatesOnLine:function(t,e){if(typeof t==="undefined"){t=1}if(typeof e==="undefined"){e=[]}var i=Math.round(this.start.x);var s=Math.round(this.start.y);var n=Math.round(this.end.x);var r=Math.round(this.end.y);var a=Math.abs(n-i);var o=Math.abs(r-s);var h=i<n?1:-1;var l=s<r?1:-1;var u=a-o;e.push([i,s]);var f=1;while(!(i==n&&s==r)){var c=u<<1;if(c>-o){u-=o;i+=h}if(c<a){u+=a;s+=l}if(f%t===0){e.push([i,s])}f++}return e},clone:function(t){if(typeof t==="undefined"||t===null){t=new L.Line(this.start.x,this.start.y,this.end.x,this.end.y)}else{t.setTo(this.start.x,this.start.y,this.end.x,this.end.y)}return t}};Object.defineProperty(L.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(L.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(L.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(L.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(L.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(L.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(L.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(L.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(L.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(L.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(L.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(L.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(L.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(L.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(L.Line.prototype,"normalAngle",{get:function(){return L.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});L.Line.intersectsPoints=function(t,e,i,s,n,r){if(typeof n==="undefined"){n=true}if(typeof r==="undefined"){r=new L.Point}var a=e.y-t.y;var o=s.y-i.y;var h=t.x-e.x;var l=i.x-s.x;var u=e.x*t.y-t.x*e.y;var f=s.x*i.y-i.x*s.y;var c=a*l-o*h;if(c===0){return null}r.x=(h*f-l*u)/c;r.y=(o*u-a*f)/c;if(n){var d=(s.y-i.y)*(e.x-t.x)-(s.x-i.x)*(e.y-t.y);var p=((s.x-i.x)*(t.y-i.y)-(s.y-i.y)*(t.x-i.x))/d;var g=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/d;if(p>=0&&p<=1&&g>=0&&g<=1){return r}else{return null}}return r};L.Line.intersects=function(t,e,i,s){return L.Line.intersectsPoints(t.start,t.end,e.start,e.end,i,s)};L.Line.reflect=function(t,e){return 2*e.normalAngle-3.141592653589793-t.angle};L.Matrix=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;this.type=L.MATRIX};L.Matrix.prototype.fromArray=function(t){this.a=t[0];this.b=t[1];this.c=t[3];this.d=t[4];this.tx=t[2];this.ty=t[5]};L.Matrix.prototype.toArray=function(t){if(!this.array){this.array=new PIXI.Float32Array(9)}var e=this.array;if(t){e[0]=this.a;e[1]=this.b;e[2]=0;e[3]=this.c;e[4]=this.d;e[5]=0;e[6]=this.tx;e[7]=this.ty;e[8]=1}else{e[0]=this.a;e[1]=this.c;e[2]=this.tx;e[3]=this.b;e[4]=this.d;e[5]=this.ty;e[6]=0;e[7]=0;e[8]=1}return e};L.Matrix.prototype.apply=function(t,e){e=e||new L.Point;var i=t.x;var s=t.y;e.x=this.a*i+this.c*s+this.tx;e.y=this.b*i+this.d*s+this.ty;return e};L.Matrix.prototype.applyInverse=function(t,e){e=e||new L.Point;var i=1/(this.a*this.d+this.c*-this.b);var s=t.x;var n=t.y;e.x=this.d*i*s+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i;e.y=this.a*i*n+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i;return e};L.Matrix.prototype.translate=function(t,e){this.tx+=t;this.ty+=e;return this};L.Matrix.prototype.scale=function(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;return this};L.Matrix.prototype.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var s=this.a;var n=this.c;var r=this.tx;this.a=s*e-this.b*i;this.b=s*i+this.b*e;this.c=n*e-this.d*i;this.d=n*i+this.d*e;this.tx=r*e-this.ty*i;this.ty=r*i+this.ty*e;return this};L.Matrix.prototype.append=function(t){var e=this.a;var i=this.b;var s=this.c;var n=this.d;this.a=t.a*e+t.b*s;this.b=t.a*i+t.b*n;this.c=t.c*e+t.d*s;this.d=t.c*i+t.d*n;this.tx=t.tx*e+t.ty*s+this.tx;this.ty=t.tx*i+t.ty*n+this.ty;return this};L.Matrix.prototype.identity=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this};L.identityMatrix=new L.Matrix;PIXI.Matrix=L.Matrix;PIXI.identityMatrix=L.identityMatrix;L.Point=function(t,e){t=t||0;e=e||0;this.x=t;this.y=e;this.type=L.POINT};L.Point.prototype={copyFrom:function(t){return this.setTo(t.x,t.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(t,e){this.x=t||0;this.y=e||(e!==0?this.x:0);return this},set:function(t,e){this.x=t||0;this.y=e||(e!==0?this.x:0);return this},add:function(t,e){this.x+=t;this.y+=e;return this},subtract:function(t,e){this.x-=t;this.y-=e;return this},multiply:function(t,e){this.x*=t;this.y*=e;return this},divide:function(t,e){this.x/=t;this.y/=e;return this},clampX:function(t,e){this.x=L.Math.clamp(this.x,t,e);return this},clampY:function(t,e){this.y=L.Math.clamp(this.y,t,e);return this},clamp:function(t,e){this.x=L.Math.clamp(this.x,t,e);this.y=L.Math.clamp(this.y,t,e);return this},clone:function(t){if(typeof t==="undefined"||t===null){t=new L.Point(this.x,this.y)}else{t.setTo(this.x,this.y)}return t},copyTo:function(t){t.x=this.x;t.y=this.y;return t},distance:function(t,e){return L.Point.distance(this,t,e)},equals:function(t){return t.x===this.x&&t.y===this.y},angle:function(t,e){if(typeof e==="undefined"){e=false}if(e){return L.Math.radToDeg(Math.atan2(t.y-this.y,t.x-this.x))}else{return Math.atan2(t.y-this.y,t.x-this.x)}},rotate:function(t,e,i,s,n){return L.Point.rotate(this,t,e,i,s,n)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(t){return this.normalize().multiply(t,t)},normalize:function(){if(!this.isZero()){var t=this.getMagnitude();this.x/=t;this.y/=t}return this},isZero:function(){return this.x===0&&this.y===0},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};L.Point.prototype.constructor=L.Point;L.Point.add=function(t,e,i){if(typeof i==="undefined"){i=new L.Point}i.x=t.x+e.x;i.y=t.y+e.y;return i};L.Point.subtract=function(t,e,i){if(typeof i==="undefined"){i=new L.Point}i.x=t.x-e.x;i.y=t.y-e.y;return i};L.Point.multiply=function(t,e,i){if(typeof i==="undefined"){i=new L.Point}i.x=t.x*e.x;i.y=t.y*e.y;return i};L.Point.divide=function(t,e,i){if(typeof i==="undefined"){i=new L.Point}i.x=t.x/e.x;i.y=t.y/e.y;return i};L.Point.equals=function(t,e){return t.x===e.x&&t.y===e.y};L.Point.angle=function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)};L.Point.negative=function(t,e){if(typeof e==="undefined"){e=new L.Point}return e.setTo(-t.x,-t.y)};L.Point.multiplyAdd=function(t,e,i,s){if(typeof s==="undefined"){s=new L.Point}return s.setTo(t.x+e.x*i,t.y+e.y*i)};L.Point.interpolate=function(t,e,i,s){if(typeof s==="undefined"){s=new L.Point}return s.setTo(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)};L.Point.perp=function(t,e){if(typeof e==="undefined"){e=new L.Point}return e.setTo(-t.y,t.x)};L.Point.rperp=function(t,e){if(typeof e==="undefined"){e=new L.Point}return e.setTo(t.y,-t.x)};L.Point.distance=function(t,e,i){var s=L.Math.distance(t.x,t.y,e.x,e.y);return i?Math.round(s):s};L.Point.project=function(t,e,i){if(typeof i==="undefined"){i=new L.Point}var s=t.dot(e)/e.getMagnitudeSq();if(s!==0){i.setTo(s*e.x,s*e.y)}return i};L.Point.projectUnit=function(t,e,i){if(typeof i==="undefined"){i=new L.Point}var s=t.dot(e);if(s!==0){i.setTo(s*e.x,s*e.y)}return i};L.Point.normalRightHand=function(t,e){if(typeof e==="undefined"){e=new L.Point}return e.setTo(t.y*-1,t.x)};L.Point.normalize=function(t,e){if(typeof e==="undefined"){e=new L.Point}var i=t.getMagnitude();if(i!==0){e.setTo(t.x/i,t.y/i)}return e};L.Point.rotate=function(t,e,i,s,n,r){n=n||false;r=r||null;if(n){s=L.Math.degToRad(s)}if(r===null){r=Math.sqrt((e-t.x)*(e-t.x)+(i-t.y)*(i-t.y))}var a=s+Math.atan2(t.y-i,t.x-e);return t.setTo(e+r*Math.cos(a),i+r*Math.sin(a))};L.Point.centroid=function(t,e){if(typeof e==="undefined"){e=new L.Point}if(Object.prototype.toString.call(t)!=="[object Array]"){throw new Error("Phaser.Point. Parameter 'points' must be an array")}var i=t.length;if(i<1){throw new Error("Phaser.Point. Parameter 'points' array must not be empty")}if(i===1){e.copyFrom(t[0]);return e}for(var s=0;s<i;s++){L.Point.add(e,t[s],e)}e.divide(i,i);return e};L.Point.parse=function(t,e,i){e=e||"x";i=i||"y";var s=new L.Point;if(t[e]){s.x=parseInt(t[e],10)}if(t[i]){s.y=parseInt(t[i],10)}return s};PIXI.Point=L.Point;L.Polygon=function(){this.area=0;this._points=[];if(arguments.length>0){this.setTo.apply(this,arguments)}this.closed=true;this.type=L.POLYGON};L.Polygon.prototype={toNumberArray:function(t){if(typeof t==="undefined"){t=[]}for(var e=0;e<this._points.length;e++){if(typeof this._points[e]==="number"){t.push(this._points[e]);t.push(this._points[e+1]);e++}else{t.push(this._points[e].x);t.push(this._points[e].y)}}return t},flatten:function(){this._points=this.toNumberArray();return this},clone:function(t){var e=this._points.slice();if(typeof t==="undefined"||t===null){t=new L.Polygon(e)}else{t.setTo(e)}return t},contains:function(t,e){var i=this._points.length;var s=false;for(var n=-1,r=i-1;++n<i;r=n){var a=this._points[n].x;var o=this._points[n].y;var h=this._points[r].x;var l=this._points[r].y;if((o<=e&&e<l||l<=e&&e<o)&&t<(h-a)*(e-o)/(l-o)+a){s=!s}}return s},setTo:function(t){this.area=0;this._points=[];if(arguments.length>0){if(!Array.isArray(t)){t=Array.prototype.slice.call(arguments)}var e=Number.MAX_VALUE;for(var i=0,s=t.length;i<s;i++){if(typeof t[i]==="number"){var n=new PIXI.Point(t[i],t[i+1]);i++}else{var n=new PIXI.Point(t[i].x,t[i].y)}this._points.push(n);if(n.y<e){e=n.y}}this.calculateArea(e)}return this},calculateArea:function(t){var e;var i;var s;var n;for(var r=0,a=this._points.length;r<a;r++){e=this._points[r];if(r===a-1){i=this._points[0]}else{i=this._points[r+1]}s=(e.y-t+(i.y-t))/2;n=e.x-i.x;this.area+=s*n}return this.area}};L.Polygon.prototype.constructor=L.Polygon;Object.defineProperty(L.Polygon.prototype,"points",{get:function(){return this._points},set:function(t){if(t!=null){this.setTo(t)}else{this.setTo()}}});PIXI.Polygon=L.Polygon;L.Rectangle=function(t,e,i,s){t=t||0;e=e||0;i=i||0;s=s||0;this.x=t;this.y=e;this.width=i;this.height=s;this.type=L.RECTANGLE};L.Rectangle.prototype={offset:function(t,e){this.x+=t;this.y+=e;return this},offsetPoint:function(t){return this.offset(t.x,t.y)},setTo:function(t,e,i,s){this.x=t;this.y=e;this.width=i;this.height=s;return this},scale:function(t,e){if(typeof e==="undefined"){e=t}this.width*=t;this.height*=e;return this},centerOn:function(t,e){this.centerX=t;this.centerY=e;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){t.x=this.x;t.y=this.y;t.width=this.width;t.height=this.height;return t},inflate:function(t,e){return L.Rectangle.inflate(this,t,e)},size:function(t){return L.Rectangle.size(this,t)},clone:function(t){return L.Rectangle.clone(this,t)},contains:function(t,e){return L.Rectangle.contains(this,t,e)},containsRect:function(t){return L.Rectangle.containsRect(t,this)},equals:function(t){return L.Rectangle.equals(this,t)},intersection:function(t,e){return L.Rectangle.intersection(this,t,e)},intersects:function(t){return L.Rectangle.intersects(this,t)},intersectsRaw:function(t,e,i,s,n){return L.Rectangle.intersectsRaw(this,t,e,i,s,n)},union:function(t,e){return L.Rectangle.union(this,t,e)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(L.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(L.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(L.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){if(t<=this.y){this.height=0}else{this.height=t-this.y}}});Object.defineProperty(L.Rectangle.prototype,"bottomRight",{get:function(){return new L.Point(this.right,this.bottom)},set:function(t){this.right=t.x;this.bottom=t.y}});Object.defineProperty(L.Rectangle.prototype,"left",{get:function(){return this.x},set:function(t){if(t>=this.right){this.width=0}else{this.width=this.right-t}this.x=t}});Object.defineProperty(L.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(t){if(t<=this.x){this.width=0}else{this.width=t-this.x}}});Object.defineProperty(L.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(L.Rectangle.prototype,"perimeter",{get:function(){return this.width*2+this.height*2}});Object.defineProperty(L.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(t){this.x=t-this.halfWidth}});Object.defineProperty(L.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(t){this.y=t-this.halfHeight}});Object.defineProperty(L.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}});Object.defineProperty(L.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}});Object.defineProperty(L.Rectangle.prototype,"top",{get:function(){return this.y},set:function(t){if(t>=this.bottom){this.height=0;this.y=t}else{this.height=this.bottom-t}}});Object.defineProperty(L.Rectangle.prototype,"topLeft",{get:function(){return new L.Point(this.x,this.y)},set:function(t){this.x=t.x;this.y=t.y}});Object.defineProperty(L.Rectangle.prototype,"topRight",{get:function(){return new L.Point(this.x+this.width,this.y)},set:function(t){this.right=t.x;this.y=t.y}});Object.defineProperty(L.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(t){if(t===true){this.setTo(0,0,0,0)}}});L.Rectangle.prototype.constructor=L.Rectangle;L.Rectangle.inflate=function(t,e,i){t.x-=e;t.width+=2*e;t.y-=i;t.height+=2*i;return t};L.Rectangle.inflatePoint=function(t,e){return L.Rectangle.inflate(t,e.x,e.y)};L.Rectangle.size=function(t,e){if(typeof e==="undefined"||e===null){e=new L.Point(t.width,t.height)}else{e.setTo(t.width,t.height)}return e};L.Rectangle.clone=function(t,e){if(typeof e==="undefined"||e===null){e=new L.Rectangle(t.x,t.y,t.width,t.height)}else{e.setTo(t.x,t.y,t.width,t.height)}return e};L.Rectangle.contains=function(t,e,i){if(t.width<=0||t.height<=0){return false}return e>=t.x&&e<t.right&&i>=t.y&&i<t.bottom};L.Rectangle.containsRaw=function(t,e,i,s,n,r){return n>=t&&n<t+i&&r>=e&&r<e+s};L.Rectangle.containsPoint=function(t,e){return L.Rectangle.contains(t,e.x,e.y)};L.Rectangle.containsRect=function(t,e){if(t.volume>e.volume){return false}return t.x>=e.x&&t.y>=e.y&&t.right<e.right&&t.bottom<e.bottom};L.Rectangle.equals=function(t,e){return t.x==e.x&&t.y==e.y&&t.width==e.width&&t.height==e.height};L.Rectangle.sameDimensions=function(t,e){return t.width===e.width&&t.height===e.height};L.Rectangle.intersection=function(t,e,i){if(typeof i==="undefined"){i=new L.Rectangle}if(L.Rectangle.intersects(t,e)){i.x=Math.max(t.x,e.x);i.y=Math.max(t.y,e.y);i.width=Math.min(t.right,e.right)-i.x;i.height=Math.min(t.bottom,e.bottom)-i.y}return i};L.Rectangle.intersects=function(t,e){if(t.width<=0||t.height<=0||e.width<=0||e.height<=0){return false}return!(t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom)};L.Rectangle.intersectsRaw=function(t,e,i,s,n,r){if(typeof r==="undefined"){r=0}return!(e>t.right+r||i<t.left-r||s>t.bottom+r||n<t.top-r)};L.Rectangle.union=function(t,e,i){if(typeof i==="undefined"){i=new L.Rectangle}return i.setTo(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.right,e.right)-Math.min(t.left,e.left),Math.max(t.bottom,e.bottom)-Math.min(t.top,e.top))};L.Rectangle.aabb=function(t,e){if(typeof e==="undefined"){e=new L.Rectangle}var i=Number.MIN_VALUE,s=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MAX_VALUE;t.forEach(function(t){if(t.x>i){i=t.x}if(t.x<s){s=t.x}if(t.y>n){n=t.y}if(t.y<r){r=t.y}});e.setTo(s,r,i-s,n-r);return e};PIXI.Rectangle=L.Rectangle;PIXI.EmptyRectangle=new L.Rectangle(0,0,0,0);L.RoundedRectangle=function(t,e,i,s,n){this.x=t||0;this.y=e||0;this.width=i||0;this.height=s||0;this.radius=n||20;this.type=L.ROUNDEDRECTANGLE};L.RoundedRectangle.prototype.clone=function(){return new L.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};L.RoundedRectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0){return false}var i=this.x;if(t>=i&&t<=i+this.width){var s=this.y;if(e>=s&&e<=s+this.height){return true}}return false};L.RoundedRectangle.prototype.constructor=L.RoundedRectangle;PIXI.RoundedRectangle=L.RoundedRectangle;L.Camera=function(t,e,i,s,n,r){this.game=t;this.world=t.world;this.id=0;this.view=new L.Rectangle(i,s,n,r);this.screenView=new L.Rectangle(i,s,n,r);this.bounds=new L.Rectangle(i,s,n,r);this.deadzone=null;this.visible=true;this.roundPx=true;this.atLimit={x:false,y:false};this.target=null;this.displayObject=null;this.scale=null;this.totalInView=0;this._targetPosition=new L.Point;this._edge=0;this._position=new L.Point};L.Camera.FOLLOW_LOCKON=0;L.Camera.FOLLOW_PLATFORMER=1;L.Camera.FOLLOW_TOPDOWN=2;L.Camera.FOLLOW_TOPDOWN_TIGHT=3;L.Camera.prototype={preUpdate:function(){this.totalInView=0},follow:function(t,e){if(typeof e==="undefined"){e=L.Camera.FOLLOW_LOCKON}this.target=t;var i;switch(e){case L.Camera.FOLLOW_PLATFORMER:var s=this.width/8;var n=this.height/3;this.deadzone=new L.Rectangle((this.width-s)/2,(this.height-n)/2-n*.25,s,n);break;case L.Camera.FOLLOW_TOPDOWN:i=Math.max(this.width,this.height)/4;this.deadzone=new L.Rectangle((this.width-i)/2,(this.height-i)/2,i,i);break;case L.Camera.FOLLOW_TOPDOWN_TIGHT:i=Math.max(this.width,this.height)/8;this.deadzone=new L.Rectangle((this.width-i)/2,(this.height-i)/2,i,i);break;case L.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},unfollow:function(){this.target=null},focusOn:function(t){this.setPosition(Math.round(t.x-this.view.halfWidth),Math.round(t.y-this.view.halfHeight))},focusOnXY:function(t,e){this.setPosition(Math.round(t-this.view.halfWidth),Math.round(e-this.view.halfHeight))},update:function(){if(this.target){this.updateTarget()}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){this._targetPosition.copyFrom(this.target);if(this.target.parent){this._targetPosition.multiply(this.target.parent.worldTransform.a,this.target.parent.worldTransform.d)}if(this.deadzone){this._edge=this._targetPosition.x-this.view.x;if(this._edge<this.deadzone.left){this.view.x=this._targetPosition.x-this.deadzone.left}else if(this._edge>this.deadzone.right){this.view.x=this._targetPosition.x-this.deadzone.right}this._edge=this._targetPosition.y-this.view.y;if(this._edge<this.deadzone.top){this.view.y=this._targetPosition.y-this.deadzone.top}else if(this._edge>this.deadzone.bottom){this.view.y=this._targetPosition.y-this.deadzone.bottom}}else{this.view.x=this._targetPosition.x-this.view.halfWidth;this.view.y=this._targetPosition.y-this.view.halfHeight}},setBoundsToWorld:function(){if(this.bounds){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)}},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;if(this.view.x<=this.bounds.x){this.atLimit.x=true;this.view.x=this.bounds.x}if(this.view.right>=this.bounds.right){this.atLimit.x=true;this.view.x=this.bounds.right-this.width}if(this.view.y<=this.bounds.top){this.atLimit.y=true;this.view.y=this.bounds.top}if(this.view.bottom>=this.bounds.bottom){this.atLimit.y=true;this.view.y=this.bounds.bottom-this.height}},setPosition:function(t,e){this.view.x=t;this.view.y=e;if(this.bounds){this.checkBounds()}},setSize:function(t,e){this.view.width=t;this.view.height=e},reset:function(){this.target=null;this.view.x=0;this.view.y=0}};L.Camera.prototype.constructor=L.Camera;Object.defineProperty(L.Camera.prototype,"x",{get:function(){return this.view.x},set:function(t){this.view.x=t;if(this.bounds){this.checkBounds()}}});Object.defineProperty(L.Camera.prototype,"y",{get:function(){return this.view.y},set:function(t){this.view.y=t;if(this.bounds){this.checkBounds()}}});Object.defineProperty(L.Camera.prototype,"position",{get:function(){this._position.set(this.view.centerX,this.view.centerY);return this._position},set:function(t){if(typeof t.x!=="undefined"){this.view.x=t.x}if(typeof t.y!=="undefined"){this.view.y=t.y}if(this.bounds){this.checkBounds()}}});Object.defineProperty(L.Camera.prototype,"width",{get:function(){return this.view.width},set:function(t){this.view.width=t}});Object.defineProperty(L.Camera.prototype,"height",{get:function(){return this.view.height},set:function(t){this.view.height=t}});L.State=function(){this.game=null;this.key="";this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.rnd=null};L.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},resize:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}};L.State.prototype.constructor=L.State;L.StateManager=function(t,e){this.game=t;this.states={};this._pendingState=null;if(typeof e!=="undefined"&&e!==null){this._pendingState=e}this._clearWorld=false;this._clearCache=false;this._created=false;this._args=[];this.current="";this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};L.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);if(this._pendingState!==null&&typeof this._pendingState!=="string"){this.add("default",this._pendingState,true)}},add:function(t,e,i){if(typeof i==="undefined"){i=false}var s;if(e instanceof L.State){s=e}else if(typeof e==="object"){s=e;s.game=this.game}else if(typeof e==="function"){s=new e(this.game)}this.states[t]=s;if(i){if(this.game.isBooted){this.start(t)}else{this._pendingState=t}}return s},remove:function(t){if(this.current===t){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onPreRenderCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null}delete this.states[t]},start:function(t,e,i){if(typeof e==="undefined"){e=true}if(typeof i==="undefined"){i=false}if(this.checkState(t)){this._pendingState=t;this._clearWorld=e;this._clearCache=i;if(arguments.length>3){this._args=Array.prototype.splice.call(arguments,3)}}},restart:function(t,e){if(typeof t==="undefined"){t=true}if(typeof e==="undefined"){e=false}this._pendingState=this.current;this._clearWorld=t;this._clearCache=e;if(arguments.length>2){this._args=Array.prototype.splice.call(arguments,2)}},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){this.clearCurrentState();this.setCurrentState(this._pendingState);if(this.current!==this._pendingState){return}else{this._pendingState=null}if(this.onPreloadCallback){this.game.load.reset(true);this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0){this.loadComplete()}else{this.game.load.start()}}else{this.loadComplete()}}},clearCurrentState:function(){if(this.current){if(this.onShutDownCallback){this.onShutDownCallback.call(this.callbackContext,this.game)}this.game.tweens.removeAll();this.game.camera.reset();this.game.input.reset(true);this.game.physics.clear();this.game.time.removeAll();this.game.scale.reset(this._clearWorld);if(this.game.debug){this.game.debug.reset()}if(this._clearWorld){this.game.world.shutdown();if(this._clearCache===true){this.game.cache.destroy()}}}},checkState:function(t){if(this.states[t]){var e=false;if(this.states[t]["preload"]||this.states[t]["create"]||this.states[t]["update"]||this.states[t]["render"]){e=true}if(e===false){console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render");return false}return true}else{console.warn("Phaser.StateManager - No state found with the key: "+t);return false}},link:function(t){this.states[t].game=this.game;this.states[t].add=this.game.add;this.states[t].make=this.game.make;this.states[t].camera=this.game.camera;this.states[t].cache=this.game.cache;this.states[t].input=this.game.input;this.states[t].load=this.game.load;this.states[t].math=this.game.math;this.states[t].sound=this.game.sound;this.states[t].scale=this.game.scale;this.states[t].state=this;this.states[t].stage=this.game.stage;this.states[t].time=this.game.time;this.states[t].tweens=this.game.tweens;this.states[t].world=this.game.world;this.states[t].rnd=this.game.rnd;this.states[t].physics=this.game.physics;this.states[t].key=t},unlink:function(t){if(this.states[t]){this.states[t].game=null;this.states[t].add=null;this.states[t].make=null;this.states[t].camera=null;this.states[t].cache=null;this.states[t].input=null;this.states[t].load=null;this.states[t].math=null;this.states[t].sound=null;this.states[t].scale=null;this.states[t].state=null;this.states[t].stage=null;this.states[t].time=null;this.states[t].tweens=null;this.states[t].world=null;this.states[t].rnd=null;this.states[t].physics=null}},setCurrentState:function(t){this.callbackContext=this.states[t];this.link(t);this.onInitCallback=this.states[t]["init"]||this.dummy;this.onPreloadCallback=this.states[t]["preload"]||null;this.onLoadRenderCallback=this.states[t]["loadRender"]||null;this.onLoadUpdateCallback=this.states[t]["loadUpdate"]||null;this.onCreateCallback=this.states[t]["create"]||null;this.onUpdateCallback=this.states[t]["update"]||null;this.onPreRenderCallback=this.states[t]["preRender"]||null;this.onRenderCallback=this.states[t]["render"]||null;this.onResizeCallback=this.states[t]["resize"]||null;this.onPausedCallback=this.states[t]["paused"]||null;this.onResumedCallback=this.states[t]["resumed"]||null;this.onPauseUpdateCallback=this.states[t]["pauseUpdate"]||null;this.onShutDownCallback=this.states[t]["shutdown"]||this.dummy;if(this.current!==""){this.game.physics.reset()}this.current=t;this._created=false;this.onInitCallback.apply(this.callbackContext,this._args);if(t===this._pendingState){this._args=[]}this.game._kickstart=true},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game)}},resume:function(){if(this._created&&this.onResumedCallback){this.onResumedCallback.call(this.callbackContext,this.game)}},update:function(){if(this._created&&this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},pauseUpdate:function(){if(this._created&&this.onPauseUpdateCallback){this.onPauseUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},preRender:function(t){if(this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game,t)}},resize:function(t,e){if(this.onResizeCallback){this.onResizeCallback.call(this.callbackContext,t,e)}},render:function(){if(this._created&&this.onRenderCallback){if(this.game.renderType===L.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0);this.onRenderCallback.call(this.callbackContext,this.game);this.game.context.restore()}else{this.onRenderCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}}},destroy:function(){this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null;this.current=""}};L.StateManager.prototype.constructor=L.StateManager;L.Signal=function(){};L.Signal.prototype={_bindings:null,_prevParams:null,memorize:false,_shouldPropagate:true,active:true,_boundDispatch:true,validateListener:function(t,e){if(typeof t!=="function"){throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}},_registerListener:function(t,e,i,s,n){var r=this._indexOfListener(t,i);var a;if(r!==-1){a=this._bindings[r];if(a.isOnce()!==e){throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(!e?"":"Once")+"() the same listener without removing the relationship first.")}}else{a=new L.SignalBinding(this,t,e,i,s,n);this._addBinding(a)}if(this.memorize&&this._prevParams){a.execute(this._prevParams)}return a},_addBinding:function(t){if(!this._bindings){this._bindings=[]}var e=this._bindings.length;do{e--}while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){if(!this._bindings){return-1}if(typeof e==="undefined"){e=null}var i=this._bindings.length;var s;while(i--){s=this._bindings[i];if(s._listener===t&&s.context===e){return i}}return-1},has:function(t,e){return this._indexOfListener(t,e)!==-1},add:function(t,e,i){this.validateListener(t,"add");var s=[];if(arguments.length>3){for(var n=3;n<arguments.length;n++){s.push(arguments[n])}}return this._registerListener(t,false,e,i,s)},addOnce:function(t,e,i){this.validateListener(t,"addOnce");var s=[];if(arguments.length>3){for(var n=3;n<arguments.length;n++){s.push(arguments[n])}}return this._registerListener(t,true,e,i,s)},remove:function(t,e){this.validateListener(t,"remove");var i=this._indexOfListener(t,e);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1)}return t},removeAll:function(t){if(typeof t==="undefined"){t=null}if(!this._bindings){return}var e=this._bindings.length;while(e--){if(t){if(this._bindings[e].context===t){this._bindings[e]._destroy();this._bindings.splice(e,1)}}else{this._bindings[e]._destroy()}}if(!t){this._bindings.length=0}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=false},dispatch:function(){if(!this.active||!this._bindings){return}var t=Array.prototype.slice.call(arguments);var e=this._bindings.length;var i;if(this.memorize){this._prevParams=t}if(!e){return}i=this._bindings.slice();this._shouldPropagate=true;do{e--}while(i[e]&&this._shouldPropagate&&i[e].execute(t)!==false)},forget:function(){if(this._prevParams){this._prevParams=null}},dispose:function(){this.removeAll();this._bindings=null;if(this._prevParams){this._prevParams=null}},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(L.Signal.prototype,"boundDispatch",{get:function(){var t=this;return this._boundDispatch||(this._boundDispatch=function(){return t.dispatch.apply(t,arguments)})}});L.Signal.prototype.constructor=L.Signal;L.SignalBinding=function(t,e,i,s,n,r){this._listener=e;if(i){this._isOnce=true}if(s!=null){this.context=s}this._signal=t;if(n){this._priority=n}if(r&&r.length){this._args=r}};L.SignalBinding.prototype={context:null,_isOnce:false,_priority:0,_args:null,callCount:0,active:true,params:null,execute:function(t){var e,i;if(this.active&&!!this._listener){i=this.params?this.params.concat(t):t;if(this._args){i=i.concat(this._args)}e=this._listener.apply(this.context,i);this.callCount++;if(this._isOnce){this.detach()}}return e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};L.SignalBinding.prototype.constructor=L.SignalBinding;L.Filter=function(t,e,i){this.game=t;this.type=L.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.prevPoint=new L.Point;var s=new Date;this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[s.getFullYear(),s.getMonth(),s.getDate(),s.getHours()*60*60+s.getMinutes()*60+s.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:true}}};if(e){for(var n in e){this.uniforms[n]=e[n]}}this.fragmentSrc=i||[]};L.Filter.prototype={init:function(){},setResolution:function(t,e){this.uniforms.resolution.value.x=t;this.uniforms.resolution.value.y=e},update:function(t){if(typeof t!=="undefined"){var e=t.x/this.game.width;var i=1-t.y/this.game.height;if(e!==this.prevPoint.x||i!==this.prevPoint.y){this.uniforms.mouse.value.x=e.toFixed(2);this.uniforms.mouse.value.y=i.toFixed(2);this.prevPoint.set(e,i)}}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}};L.Filter.prototype.constructor=L.Filter;Object.defineProperty(L.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(t){this.uniforms.resolution.value.x=t}});Object.defineProperty(L.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(t){this.uniforms.resolution.value.y=t}});L.Plugin=function(t,e){if(typeof e==="undefined"){e=null}this.game=t;this.parent=e;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false};L.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false}};L.Plugin.prototype.constructor=L.Plugin;L.PluginManager=function(t){this.game=t;this.plugins=[];this._len=0;this._i=0};L.PluginManager.prototype={add:function(t){var e=Array.prototype.splice.call(arguments,1);var i=false;if(typeof t==="function"){t=new t(this.game,this)}else{t.game=this.game;t.parent=this}if(typeof t["preUpdate"]==="function"){t.hasPreUpdate=true;i=true}if(typeof t["update"]==="function"){t.hasUpdate=true;i=true}if(typeof t["postUpdate"]==="function"){t.hasPostUpdate=true;i=true}if(typeof t["render"]==="function"){t.hasRender=true;i=true}if(typeof t["postRender"]==="function"){t.hasPostRender=true;i=true}if(i){if(t.hasPreUpdate||t.hasUpdate||t.hasPostUpdate){t.active=true}if(t.hasRender||t.hasPostRender){t.visible=true}this._len=this.plugins.push(t);if(typeof t["init"]==="function"){t.init.apply(t,e)}return t}else{return null}},remove:function(t){this._i=this._len;while(this._i--){if(this.plugins[this._i]===t){t.destroy();this.plugins.splice(this._i,1);this._len--;return}}},removeAll:function(){this._i=this._len;while(this._i--){this.plugins[this._i].destroy()}this.plugins.length=0;this._len=0},preUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate){this.plugins[this._i].preUpdate()}}},update:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasUpdate){this.plugins[this._i].update()}}},postUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate){this.plugins[this._i].postUpdate()}}},render:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasRender){this.plugins[this._i].render()}}},postRender:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender){this.plugins[this._i].postRender()}}},destroy:function(){this.removeAll();this.game=null}};L.PluginManager.prototype.constructor=L.PluginManager;L.Stage=function(t){this.game=t;PIXI.Stage.call(this,0);this.name="_stage_root";this.disableVisibilityChange=false;this.exists=true;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._backgroundColor=0;if(t.config){this.parseConfig(t.config)}};L.Stage.prototype=Object.create(PIXI.Stage.prototype);L.Stage.prototype.constructor=L.Stage;L.Stage.prototype.parseConfig=function(t){if(t["disableVisibilityChange"]){this.disableVisibilityChange=t["disableVisibilityChange"]}if(t["backgroundColor"]){this.backgroundColor=t["backgroundColor"]}};L.Stage.prototype.boot=function(){L.DOM.getOffset(this.game.canvas,this.offset);L.Canvas.setUserSelect(this.game.canvas,"none");L.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};L.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var t=0;t<this.children.length;t++){this.children[t].preUpdate()}};L.Stage.prototype.update=function(){var t=this.children.length;while(t--){this.children[t].update()}};L.Stage.prototype.postUpdate=function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate();this.game.world.camera.update();var t=this.children.length;while(t--){if(this.children[t]!==this.game.world.camera.target){this.children[t].postUpdate()}}}else{this.game.world.camera.update();var t=this.children.length;while(t--){this.children[t].postUpdate()}}};L.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0;t<this.children.length;t++){this.children[t].updateTransform()}};L.Stage.prototype.checkVisibility=function(){if(document.webkitHidden!==undefined){this._hiddenVar="webkitvisibilitychange"}else if(document.mozHidden!==undefined){this._hiddenVar="mozvisibilitychange"}else if(document.msHidden!==undefined){this._hiddenVar="msvisibilitychange"}else if(document.hidden!==undefined){this._hiddenVar="visibilitychange"}else{this._hiddenVar=null}var e=this;this._onChange=function(t){return e.visibilityChange(t)};if(this._hiddenVar){document.addEventListener(this._hiddenVar,this._onChange,false)}window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;if(this.game.device.cocoonJSApp){CocoonJS.App.onSuspended.addEventListener(function(){L.Stage.prototype.visibilityChange.call(e,{type:"pause"})});CocoonJS.App.onActivated.addEventListener(function(){L.Stage.prototype.visibilityChange.call(e,{type:"resume"})})}if(window.__wx&&typeof wx.onHide=="function"){wx.onHide(function(){L.Stage.prototype.visibilityChange.call(e,{type:"pause"})});wx.onShow(function(){L.Stage.prototype.visibilityChange.call(e,{type:"resume"})})}};L.Stage.prototype.visibilityChange=function(t){if(t.type==="pagehide"||t.type==="blur"||t.type==="pageshow"||t.type==="focus"){if(t.type==="pagehide"||t.type==="blur"){this.game.focusLoss(t)}else if(t.type==="pageshow"||t.type==="focus"){this.game.focusGain(t)}return}if(this.disableVisibilityChange){return}if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||t.type==="pause"){this.game.gamePaused(t)}else{this.game.gameResumed(t)}};L.Stage.prototype.setBackgroundColor=function(t){var e=L.Color.valueToColor(t);this._backgroundColor=L.Color.getColor(e.r,e.g,e.b);this.backgroundColorSplit=[e.r/255,e.g/255,e.b/255];this.backgroundColorString=L.Color.RGBtoString(e.r,e.g,e.b,255,"#")};L.Stage.prototype.destroy=function(){if(this._hiddenVar){document.removeEventListener(this._hiddenVar,this._onChange,false)}window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(L.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){if(!this.game.transparent){this.setBackgroundColor(t)}}});Object.defineProperty(L.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(t){if(t){PIXI.scaleModes.DEFAULT=PIXI.scaleModes.LINEAR}else{PIXI.scaleModes.DEFAULT=PIXI.scaleModes.NEAREST}}});L.Group=function(t,e,i,s,n,r){if(typeof s==="undefined"){s=false}if(typeof n==="undefined"){n=false}if(typeof r==="undefined"){r=L.Physics.ARCADE}this.game=t;if(typeof e==="undefined"){e=t.world}this.name=i||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);if(s){this.game.stage.addChild(this);this.z=this.game.stage.children.length}else{if(e){e.addChild(this);this.z=e.children.length}}this.type=L.GROUP;this.physicsType=L.GROUP;this.alive=true;this.exists=true;this.ignoreDestroy=false;this.classType=L.Sprite;this.scale=new L.Point(1,1);this.cursor=null;this.enableBody=n;this.enableBodyDebug=false;this.physicsBodyType=r;this.onDestroy=new L.Signal;this.cursorIndex=0;this.fixedToCamera=false;this.cameraOffset=new L.Point;this._hash=[];this._sortProperty="z"};L.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);L.Group.prototype.constructor=L.Group;L.Group.RETURN_NONE=0;L.Group.RETURN_TOTAL=1;L.Group.RETURN_CHILD=2;L.Group.SORT_ASCENDING=-1;L.Group.SORT_DESCENDING=1;L.Group.prototype.add=function(t,e){if(typeof e==="undefined"){e=false}if(t.parent!==this){if(this.enableBody){this.game.physics.enable(t,this.physicsBodyType)}this.addChild(t);this._hash.push(t);t.z=this.children.length;if(!e&&t.events){t.events.onAddedToGroup$dispatch(t,this)}if(this.cursor===null){this.cursor=t}}return t};L.Group.prototype.addMultiple=function(t,e){if(Array.isArray(t)){for(var i=0;i<t.length;i++){this.add(t[i],e)}}return t};L.Group.prototype.addAt=function(t,e,i){if(typeof i==="undefined"){i=false}if(t.parent!==this){if(this.enableBody){this.game.physics.enable(t,this.physicsBodyType)}this.addChildAt(t,e);this._hash.push(t);this.updateZ();if(!i&&t.events){t.events.onAddedToGroup$dispatch(t,this)}if(this.cursor===null){this.cursor=t}}return t};L.Group.prototype.getAt=function(t){if(t<0||t>=this.children.length){return-1}else{return this.getChildAt(t)}};L.Group.prototype.create=function(t,e,i,s,n){if(typeof n==="undefined"){n=true}var r=new this.classType(this.game,t,e,i,s);if(this.enableBody){this.game.physics.enable(r,this.physicsBodyType,this.enableBodyDebug)}r.exists=n;r.visible=n;r.alive=n;this.addChild(r);this._hash.push(r);r.z=this.children.length;if(r.events){r.events.onAddedToGroup$dispatch(r,this)}if(this.cursor===null){this.cursor=r}return r};L.Group.prototype.createMultiple=function(t,e,i,s){if(typeof s==="undefined"){s=false}for(var n=0;n<t;n++){this.create(0,0,e,i,s)}};L.Group.prototype.updateZ=function(){var t=this.children.length;while(t--){this.children[t].z=t}};L.Group.prototype.resetCursor=function(t){if(typeof t==="undefined"){t=0}if(t>this.children.length-1){t=0}if(this.cursor){this.cursorIndex=t;this.cursor=this.children[this.cursorIndex];return this.cursor}};L.Group.prototype.next=function(){if(this.cursor){if(this.cursorIndex>=this.children.length-1){this.cursorIndex=0}else{this.cursorIndex++}this.cursor=this.children[this.cursorIndex];return this.cursor}};L.Group.prototype.previous=function(){if(this.cursor){if(this.cursorIndex===0){this.cursorIndex=this.children.length-1}else{this.cursorIndex--}this.cursor=this.children[this.cursorIndex];return this.cursor}};L.Group.prototype.swap=function(t,e){this.swapChildren(t,e);this.updateZ()};L.Group.prototype.bringToTop=function(t){if(t.parent===this&&this.getIndex(t)<this.children.length){this.remove(t,false,true);this.add(t,true)}return t};L.Group.prototype.sendToBack=function(t){if(t.parent===this&&this.getIndex(t)>0){this.remove(t,false,true);this.addAt(t,0,true)}return t};L.Group.prototype.moveUp=function(t){if(t.parent===this&&this.getIndex(t)<this.children.length-1){var e=this.getIndex(t);var i=this.getAt(e+1);if(i){this.swap(t,i)}}return t};L.Group.prototype.moveDown=function(t){if(t.parent===this&&this.getIndex(t)>0){var e=this.getIndex(t);var i=this.getAt(e-1);if(i){this.swap(t,i)}}return t};L.Group.prototype.xy=function(t,e,i){if(t<0||t>this.children.length){return-1}else{this.getChildAt(t).x=e;this.getChildAt(t).y=i}};L.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};L.Group.prototype.getIndex=function(t){return this.children.indexOf(t)};L.Group.prototype.replace=function(t,e){var i=this.getIndex(t);if(i!==-1){if(e.parent){if(e.parent instanceof L.Group){e.parent.remove(e)}else{e.parent.removeChild(e)}}this.remove(t);this.addAt(e,i);return t}};L.Group.prototype.hasProperty=function(t,e){var i=e.length;if(i===1&&e[0]in t){return true}else if(i===2&&e[0]in t&&e[1]in t[e[0]]){return true}else if(i===3&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]){return true}else if(i===4&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]&&e[3]in t[e[0]][e[1]][e[2]]){return true}return false};L.Group.prototype.setProperty=function(t,e,i,s,n){if(typeof n==="undefined"){n=false}s=s||0;if(!this.hasProperty(t,e)&&(!n||s>0)){return false}var r=e.length;if(r===1){if(s===0){t[e[0]]=i}else if(s==1){t[e[0]]+=i}else if(s==2){t[e[0]]-=i}else if(s==3){t[e[0]]*=i}else if(s==4){t[e[0]]/=i}}else if(r===2){if(s===0){t[e[0]][e[1]]=i}else if(s==1){t[e[0]][e[1]]+=i}else if(s==2){t[e[0]][e[1]]-=i}else if(s==3){t[e[0]][e[1]]*=i}else if(s==4){t[e[0]][e[1]]/=i}}else if(r===3){if(s===0){t[e[0]][e[1]][e[2]]=i}else if(s==1){t[e[0]][e[1]][e[2]]+=i}else if(s==2){t[e[0]][e[1]][e[2]]-=i}else if(s==3){t[e[0]][e[1]][e[2]]*=i}else if(s==4){t[e[0]][e[1]][e[2]]/=i}}else if(r===4){if(s===0){t[e[0]][e[1]][e[2]][e[3]]=i}else if(s==1){t[e[0]][e[1]][e[2]][e[3]]+=i}else if(s==2){t[e[0]][e[1]][e[2]][e[3]]-=i}else if(s==3){t[e[0]][e[1]][e[2]][e[3]]*=i}else if(s==4){t[e[0]][e[1]][e[2]][e[3]]/=i}}return true};L.Group.prototype.checkProperty=function(t,e,i,s){if(typeof s==="undefined"){s=false}if(!L.Utils.getProperty(t,e)&&s){return false}if(L.Utils.getProperty(t,e)!==i){return false}return true};L.Group.prototype.set=function(t,e,i,s,n,r,a){if(typeof a==="undefined"){a=false}e=e.split(".");if(typeof s==="undefined"){s=false}if(typeof n==="undefined"){n=false}if((s===false||s&&t.alive)&&(n===false||n&&t.visible)){return this.setProperty(t,e,i,r,a)}};L.Group.prototype.setAll=function(t,e,i,s,n,r){if(typeof i==="undefined"){i=false}if(typeof s==="undefined"){s=false}if(typeof r==="undefined"){r=false}t=t.split(".");n=n||0;for(var a=0;a<this.children.length;a++){if((!i||i&&this.children[a].alive)&&(!s||s&&this.children[a].visible)){this.setProperty(this.children[a],t,e,n,r)}}};L.Group.prototype.setAllChildren=function(t,e,i,s,n,r){if(typeof i==="undefined"){i=false}if(typeof s==="undefined"){s=false}if(typeof r==="undefined"){r=false}n=n||0;for(var a=0;a<this.children.length;a++){if((!i||i&&this.children[a].alive)&&(!s||s&&this.children[a].visible)){if(this.children[a]instanceof L.Group){this.children[a].setAllChildren(t,e,i,s,n,r)}else{this.setProperty(this.children[a],t.split("."),e,n,r)}}}};L.Group.prototype.checkAll=function(t,e,i,s,n){if(typeof i==="undefined"){i=false}if(typeof s==="undefined"){s=false}if(typeof n==="undefined"){n=false}for(var r=0;r<this.children.length;r++){if((!i||i&&this.children[r].alive)&&(!s||s&&this.children[r].visible)){if(!this.checkProperty(this.children[r],t,e,n)){return false}}}return true};L.Group.prototype.addAll=function(t,e,i,s){this.setAll(t,e,i,s,1)};L.Group.prototype.subAll=function(t,e,i,s){this.setAll(t,e,i,s,2)};L.Group.prototype.multiplyAll=function(t,e,i,s){this.setAll(t,e,i,s,3)};L.Group.prototype.divideAll=function(t,e,i,s){this.setAll(t,e,i,s,4)};L.Group.prototype.callAllExists=function(t,e){var i;if(arguments.length>2){i=[];for(var s=2;s<arguments.length;s++){i.push(arguments[s])}}for(var s=0;s<this.children.length;s++){if(this.children[s].exists===e&&this.children[s][t]){this.children[s][t].apply(this.children[s],i)}}};L.Group.prototype.callbackFromArray=function(t,e,i){if(i==1){if(t[e[0]]){return t[e[0]]}}else if(i==2){if(t[e[0]][e[1]]){return t[e[0]][e[1]]}}else if(i==3){if(t[e[0]][e[1]][e[2]]){return t[e[0]][e[1]][e[2]]}}else if(i==4){if(t[e[0]][e[1]][e[2]][e[3]]){return t[e[0]][e[1]][e[2]][e[3]]}}else{if(t[e]){return t[e]}}return false};L.Group.prototype.callAll=function(t,e){if(typeof t==="undefined"){return}t=t.split(".");var i=t.length;if(typeof e==="undefined"||e===null||e===""){e=null}else{if(typeof e==="string"){e=e.split(".");var s=e.length}}var n;if(arguments.length>2){n=[];for(var r=2;r<arguments.length;r++){n.push(arguments[r])}}var a=null;var o=null;for(var r=0;r<this.children.length;r++){a=this.callbackFromArray(this.children[r],t,i);if(e&&a){o=this.callbackFromArray(this.children[r],e,s);if(a){a.apply(o,n)}}else if(a){a.apply(this.children[r],n)}}};L.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}var t=this.children.length;while(t--){this.children[t].preUpdate()}return true};L.Group.prototype.update=function(){var t=this.children.length;while(t--){this.children[t].update()}};L.Group.prototype.postUpdate=function(){if(this.fixedToCamera){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}var t=this.children.length;while(t--){this.children[t].postUpdate()}};L.Group.prototype.filter=function(t,e){var i=-1;var s=this.children.length;var n=[];while(++i<s){var r=this.children[i];if(!e||e&&r.exists){if(t(r,i,this.children)){n.push(r)}}}return new L.ArraySet(n)};L.Group.prototype.forEach=function(t,e,i){if(typeof i==="undefined"){i=false}if(arguments.length<=3){for(var s=0;s<this.children.length;s++){if(!i||i&&this.children[s].exists){t.call(e,this.children[s])}}}else{var n=[null];for(var s=3;s<arguments.length;s++){n.push(arguments[s])}for(var s=0;s<this.children.length;s++){if(!i||i&&this.children[s].exists){n[0]=this.children[s];t.apply(e,n)}}}};L.Group.prototype.forEachExists=function(t,e){var i;if(arguments.length>2){i=[null];for(var s=2;s<arguments.length;s++){i.push(arguments[s])}}this.iterate("exists",true,L.Group.RETURN_TOTAL,t,e,i)};L.Group.prototype.forEachAlive=function(t,e){var i;if(arguments.length>2){i=[null];for(var s=2;s<arguments.length;s++){i.push(arguments[s])}}this.iterate("alive",true,L.Group.RETURN_TOTAL,t,e,i)};L.Group.prototype.forEachDead=function(t,e){var i;if(arguments.length>2){i=[null];for(var s=2;s<arguments.length;s++){i.push(arguments[s])}}this.iterate("alive",false,L.Group.RETURN_TOTAL,t,e,i)};L.Group.prototype.sort=function(t,e){if(this.children.length<2){return}if(typeof t==="undefined"){t="z"}if(typeof e==="undefined"){e=L.Group.SORT_ASCENDING}this._sortProperty=t;if(e===L.Group.SORT_ASCENDING){this.children.sort(this.ascendingSortHandler.bind(this))}else{this.children.sort(this.descendingSortHandler.bind(this))}this.updateZ()};L.Group.prototype.customSort=function(t,e){if(this.children.length<2){return}this.children.sort(t.bind(e));this.updateZ()};L.Group.prototype.ascendingSortHandler=function(t,e){if(t[this._sortProperty]<e[this._sortProperty]){return-1}else if(t[this._sortProperty]>e[this._sortProperty]){return 1}else{if(t.z<e.z){return-1}else{return 1}}};L.Group.prototype.descendingSortHandler=function(t,e){if(t[this._sortProperty]<e[this._sortProperty]){return 1}else if(t[this._sortProperty]>e[this._sortProperty]){return-1}else{return 0}};L.Group.prototype.iterate=function(t,e,i,s,n,r){if(i===L.Group.RETURN_TOTAL&&this.children.length===0){return 0}var a=0;for(var o=0;o<this.children.length;o++){if(this.children[o][t]===e){a++;if(s){if(r){r[0]=this.children[o];s.apply(n,r)}else{s.call(n,this.children[o])}}if(i===L.Group.RETURN_CHILD){return this.children[o]}}}if(i===L.Group.RETURN_TOTAL){return a}return null};L.Group.prototype.getFirstExists=function(t){if(typeof t!=="boolean"){t=true}return this.iterate("exists",t,L.Group.RETURN_CHILD)};L.Group.prototype.getFirstAlive=function(){return this.iterate("alive",true,L.Group.RETURN_CHILD)};L.Group.prototype.getFirstDead=function(){return this.iterate("alive",false,L.Group.RETURN_CHILD)};L.Group.prototype.getTop=function(){if(this.children.length>0){return this.children[this.children.length-1]}};L.Group.prototype.getBottom=function(){if(this.children.length>0){return this.children[0]}};L.Group.prototype.countLiving=function(){return this.iterate("alive",true,L.Group.RETURN_TOTAL)};L.Group.prototype.countDead=function(){return this.iterate("alive",false,L.Group.RETURN_TOTAL)};L.Group.prototype.getRandom=function(t,e){if(this.children.length===0){return null}t=t||0;e=e||this.children.length;return L.ArrayUtils.getRandomItem(this.children,t,e)};L.Group.prototype.remove=function(t,e,i){if(typeof e==="undefined"){e=false}if(typeof i==="undefined"){i=false}if(this.children.length===0||this.children.indexOf(t)===-1){return false}if(!i&&t.events&&!t.destroyPhase){t.events.onRemovedFromGroup$dispatch(t,this)}var s=this.removeChild(t);var n=this._hash.indexOf(s);if(n!==-1){this._hash.splice(n,1)}this.updateZ();if(this.cursor===t){this.next()}if(e&&s){s.destroy(true)}return true};L.Group.prototype.removeAll=function(t,e){if(typeof t==="undefined"){t=false}if(typeof e==="undefined"){e=false}if(this.children.length===0){return}do{if(!e&&this.children[0].events){this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this)}var i=this.removeChild(this.children[0]);var s=this._hash.indexOf(i);if(s!==-1){this._hash.splice(s,1)}if(t&&i){i.destroy(true)}}while(this.children.length>0);this._hash=[];this.cursor=null};L.Group.prototype.removeBetween=function(t,e,i,s){if(typeof e==="undefined"){e=this.children.length-1}if(typeof i==="undefined"){i=false}if(typeof s==="undefined"){s=false}if(this.children.length===0){return}if(t>e||t<0||e>this.children.length){return false}var n=e;while(n>=t){if(!s&&this.children[n].events){this.children[n].events.onRemovedFromGroup$dispatch(this.children[n],this)}var r=this.removeChild(this.children[n]);var a=this._hash.indexOf(r);if(a!==-1){this._hash.splice(a,1)}if(i&&r){r.destroy(true)}if(this.cursor===this.children[n]){this.cursor=null}n--}this.updateZ()};L.Group.prototype.destroy=function(t,e){if(this.game===null||this.ignoreDestroy){return}if(typeof t==="undefined"){t=true}if(typeof e==="undefined"){e=false}this.onDestroy.dispatch(this,t,e);this.removeAll(t);this.cursor=null;this.filters=null;if(!e){if(this.parent){this.parent.removeChild(this)}this.game=null;this.exists=false}};Object.defineProperty(L.Group.prototype,"total",{get:function(){return this.iterate("exists",true,L.Group.RETURN_TOTAL)}});Object.defineProperty(L.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(L.Group.prototype,"angle",{get:function(){return L.Math.radToDeg(this.rotation)},set:function(t){this.rotation=L.Math.degToRad(t)}});L.World=function(t){L.Group.call(this,t,null,"__world",false);this.bounds=new L.Rectangle(0,0,t.width,t.height);this.camera=null;this._definedSize=false;this._width=t.width;this._height=t.height};L.World.prototype=Object.create(L.Group.prototype);L.World.prototype.constructor=L.World;L.World.prototype.boot=function(){this.camera=new L.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this;this.camera.scale=this.scale;this.game.camera=this.camera;this.game.stage.addChild(this)};L.World.prototype.setBounds=function(t,e,i,s){this._definedSize=true;this._width=i;this._height=s;this.bounds.setTo(t,e,i,s);this.x=t;this.y=e;if(this.camera.bounds){this.camera.bounds.setTo(t,e,Math.max(i,this.game.width),Math.max(s,this.game.height))}this.game.physics.setBoundsToWorld()};L.World.prototype.resize=function(t,e){if(this._definedSize){if(t<this._width){t=this._width}if(e<this._height){e=this._height}}this.bounds.width=t;this.bounds.height=e;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};L.World.prototype.shutdown=function(){this.destroy(true,true)};L.World.prototype.wrap=function(t,e,i,s,n){if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i=false}if(typeof s==="undefined"){s=true}if(typeof n==="undefined"){n=true}if(!i){if(s&&t.x+e<this.bounds.x){t.x=this.bounds.right+e}else if(s&&t.x-e>this.bounds.right){t.x=this.bounds.left-e}if(n&&t.y+e<this.bounds.top){t.y=this.bounds.bottom+e}else if(n&&t.y-e>this.bounds.bottom){t.y=this.bounds.top-e}}else{t.getBounds();if(s){if(t.x+t._currentBounds.width<this.bounds.x){t.x=this.bounds.right}else if(t.x>this.bounds.right){t.x=this.bounds.left}}if(n){if(t.y+t._currentBounds.height<this.bounds.top){t.y=this.bounds.bottom}else if(t.y>this.bounds.bottom){t.y=this.bounds.top}}}};Object.defineProperty(L.World.prototype,"width",{get:function(){return this.bounds.width},set:function(t){if(t<this.game.width){t=this.game.width}this.bounds.width=t;this._width=t;this._definedSize=true}});Object.defineProperty(L.World.prototype,"height",{get:function(){return this.bounds.height},set:function(t){if(t<this.game.height){t=this.game.height}this.bounds.height=t;this._height=t;this._definedSize=true}});Object.defineProperty(L.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}});Object.defineProperty(L.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}});Object.defineProperty(L.World.prototype,"randomX",{get:function(){if(this.bounds.x<0){return this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x))}else{return this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}});Object.defineProperty(L.World.prototype,"randomY",{get:function(){if(this.bounds.y<0){return this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y))}else{return this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}});L.FlexGrid=function(t,e,i){this.game=t.game;this.manager=t;this.width=e;this.height=i;this.boundsCustom=new L.Rectangle(0,0,e,i);this.boundsFluid=new L.Rectangle(0,0,e,i);this.boundsFull=new L.Rectangle(0,0,e,i);this.boundsNone=new L.Rectangle(0,0,e,i);this.positionCustom=new L.Point(0,0);this.positionFluid=new L.Point(0,0);this.positionFull=new L.Point(0,0);this.positionNone=new L.Point(0,0);this.scaleCustom=new L.Point(1,1);this.scaleFluid=new L.Point(1,1);this.scaleFluidInversed=new L.Point(1,1);this.scaleFull=new L.Point(1,1);this.scaleNone=new L.Point(1,1);this.customWidth=0;this.customHeight=0;this.customOffsetX=0;this.customOffsetY=0;this.ratioH=e/i;this.ratioV=i/e;this.multiplier=0;this.layers=[]};L.FlexGrid.prototype={setSize:function(t,e){this.width=t;this.height=e;this.ratioH=t/e;this.ratioV=e/t;this.scaleNone=new L.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(t,e,i,s){if(typeof s==="undefined"){s=true}this.customWidth=t;this.customHeight=e;this.boundsCustom.width=t;this.boundsCustom.height=e;var n=new L.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);if(s){this.game.world.add(n)}this.layers.push(n);if(typeof i!=="undefined"&&typeof i!==null){n.addMultiple(i)}return n},createFluidLayer:function(t,e){if(typeof e==="undefined"){e=true}var i=new L.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);if(e){this.game.world.add(i)}this.layers.push(i);if(typeof t!=="undefined"&&typeof t!==null){i.addMultiple(t)}return i},createFullLayer:function(t){var e=new L.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);this.game.world.add(e);this.layers.push(e);if(typeof t!=="undefined"){e.addMultiple(t)}return e},createFixedLayer:function(t){var e=new L.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);this.game.world.add(e);this.layers.push(e);if(typeof t!=="undefined"){e.addMultiple(t)}return e},reset:function(){var t=this.layers.length;while(t--){if(!this.layers[t].persist){this.layers[t].position=null;this.layers[t].scale=null;this.layers.slice(t,1)}}},onResize:function(t,e){this.ratioH=t/e;this.ratioV=e/t;this.refresh(t,e)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width);this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(t){this.manager.scaleSprite(t);t.x=this.manager.bounds.centerX;t.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",false)}};L.FlexGrid.prototype.constructor=L.FlexGrid;L.FlexLayer=function(t,e,i,s){L.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),false);this.manager=t.manager;this.grid=t;this.persist=false;this.position=e;this.bounds=i;this.scale=s;this.topLeft=i.topLeft;this.topMiddle=new L.Point(i.halfWidth,0);this.topRight=i.topRight;this.bottomLeft=i.bottomLeft;this.bottomMiddle=new L.Point(i.halfWidth,i.bottom);this.bottomRight=i.bottomRight};L.FlexLayer.prototype=Object.create(L.Group.prototype);L.FlexLayer.prototype.constructor=L.FlexLayer;L.FlexLayer.prototype.resize=function(){};L.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",false);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};L.ScaleManager=function(t,e,i){this.game=t;this.dom=L.DOM;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new L.Point;this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this._pageAlignHorizontally=false;this._pageAlignVertically=false;this.maxIterations=5;this.onOrientationChange=new L.Signal;this.enterLandscape=new L.Signal;this.enterPortrait=new L.Signal;this.enterIncorrectOrientation=new L.Signal;this.leaveIncorrectOrientation=new L.Signal;this.fullScreenTarget=null;this._createdFullScreenTarget=null;this.onFullScreenInit=new L.Signal;this.onFullScreenChange=new L.Signal;this.onFullScreenError=new L.Signal;this.enterFullScreen=new L.Signal;this.leaveFullScreen=new L.Signal;this.fullScreenFailed=this.onFullScreenError;this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new L.Point(1,1);this.scaleFactorInversed=new L.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new L.Rectangle;this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:false,orientationFallback:null,noMargins:false,scrollTo:null,forceMinimumDocumentHeight:false,canExpandParent:true,clickTrampoline:""};this._scaleMode=L.ScaleManager.NO_SCALE;this._fullScreenScaleMode=L.ScaleManager.NO_SCALE;this.parentIsWindow=false;this.parentNode=null;this.parentScaleFactor=new L.Point(1,1);this.trackParentInterval=2e3;this.onSizeChange=new L.Signal;this.onResize=null;this.onResizeContext=null;this._fullScreenRestore=null;this._gameSize=new L.Rectangle;this._userScaleFactor=new L.Point(1,1);this._userScaleTrim=new L.Point(0,0);this._lastUpdate=0;this._updateThrottle=0;this._updateThrottleReset=100;this._parentBounds=new L.Rectangle;this._tempBounds=new L.Rectangle;this._lastReportedCanvasSize=new L.Rectangle;this._lastReportedGameSize=new L.Rectangle;if(t.config){this.parseConfig(t.config)}this.setupScale(e,i)};L.ScaleManager.EXACT_FIT=0;L.ScaleManager.NO_SCALE=1;L.ScaleManager.SHOW_ALL=2;L.ScaleManager.RESIZE=3;L.ScaleManager.USER_SCALE=4;L.ScaleManager.prototype={boot:function(){var t=this.compatibility;t.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){t.scrollTo=new L.Point(0,1)}else{t.scrollTo=new L.Point(0,0)}}if(this.game.device.desktop){t.orientationFallback="screen";t.clickTrampoline="when-not-mouse"}else{t.orientationFallback="";t.clickTrampoline=""}var e=this;this._orientationChange=function(t){return e.orientationChange(t)};this._windowResize=function(t){return e.windowResize(t)};window.addEventListener("orientationchange",this._orientationChange,false);window.addEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){this._fullScreenChange=function(t){return e.fullScreenChange(t)};this._fullScreenError=function(t){return e.fullScreenError(t)};document.addEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.addEventListener("mozfullscreenchange",this._fullScreenChange,false);document.addEventListener("MSFullscreenChange",this._fullScreenChange,false);document.addEventListener("fullscreenchange",this._fullScreenChange,false);document.addEventListener("webkitfullscreenerror",this._fullScreenError,false);document.addEventListener("mozfullscreenerror",this._fullScreenError,false);document.addEventListener("MSFullscreenError",this._fullScreenError,false);document.addEventListener("fullscreenerror",this._fullScreenError,false)}this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.grid=new L.FlexGrid(this,this.width,this.height)},parseConfig:function(t){if(t["scaleMode"]){this.scaleMode=t["scaleMode"]}if(t["fullScreenScaleMode"]){this.fullScreenScaleMode=t["fullScreenScaleMode"]}if(t["fullScreenTarget"]){this.fullScreenTarget=t["fullScreenTarget"]}},setupScale:function(t,e){var i;var s=new L.Rectangle;if(this.game.parent!==""){if(typeof this.game.parent==="string"){i=document.getElementById(this.game.parent)}else if(this.game.parent&&this.game.parent.nodeType===1){i=this.game.parent}}if(!i){this.parentNode=null;this.parentIsWindow=true;s.width=this.dom.visualBounds.width;s.height=this.dom.visualBounds.height;this.offset.set(0,0)}else{this.parentNode=i;this.parentIsWindow=false;this.getParentBounds(this._parentBounds);s.width=this._parentBounds.width;s.height=this._parentBounds.height;this.offset.set(this._parentBounds.x,this._parentBounds.y)}var n=0;var r=0;if(typeof t==="number"){n=t}else{this.parentScaleFactor.x=parseInt(t,10)/100;n=s.width*this.parentScaleFactor.x}if(typeof e==="number"){r=e}else{this.parentScaleFactor.y=parseInt(e,10)/100;r=s.height*this.parentScaleFactor.y}this._gameSize.setTo(0,0,n,r);this.updateDimensions(n,r,false)},_gameResumed:function(){this.queueUpdate(true)},setGameSize:function(t,e){this._gameSize.setTo(0,0,t,e);if(this.currentScaleMode!==L.ScaleManager.RESIZE){this.updateDimensions(t,e,true)}this.queueUpdate(true)},setUserScale:function(t,e,i,s){this._userScaleFactor.setTo(t,e);this._userScaleTrim.setTo(i|0,s|0);this.queueUpdate(true)},setResizeCallback:function(t,e){this.onResize=t;this.onResizeContext=e},signalSizeChange:function(){if(!L.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!L.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var t=this.width;var e=this.height;this._lastReportedCanvasSize.setTo(0,0,t,e);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);this.grid.onResize(t,e);this.onSizeChange.dispatch(this,t,e);if(this.currentScaleMode===L.ScaleManager.RESIZE){this.game.state.resize(t,e);this.game.load.resize(t,e)}}},setMinMax:function(t,e,i,s){this.minWidth=t;this.minHeight=e;if(typeof i!=="undefined"){this.maxWidth=i}if(typeof s!=="undefined"){this.maxHeight=s}},preUpdate:function(){if(this.game.time.time<this._lastUpdate+this._updateThrottle){return}var t=this._updateThrottle;this._updateThrottleReset=t>=400?0:100;this.dom.getOffset(this.game.canvas,this.offset);var e=this._parentBounds.width;var i=this._parentBounds.height;var s=this.getParentBounds(this._parentBounds);var n=s.width!==e||s.height!==i;var r=this.updateOrientationState();if(n||r){if(this.onResize){this.onResize.call(this.onResizeContext,this,s)}this.updateLayout();this.signalSizeChange()}var a=this._updateThrottle*2;if(this._updateThrottle<t){a=Math.min(t,this._updateThrottleReset)}this._updateThrottle=L.Math.clamp(a,25,this.trackParentInterval);this._lastUpdate=this.game.time.time},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(t,e,i){this.width=t*this.parentScaleFactor.x;this.height=e*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();if(i){this.game.renderer.resize(this.width,this.height);this.game.camera.setSize(this.width,this.height);this.game.world.resize(this.width,this.height)}},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;if(this.game.canvas){this.dom.getOffset(this.game.canvas,this.offset)}this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);if(this.game.input&&this.game.input.scale){this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)}},forceOrientation:function(t,e){if(typeof e==="undefined"){e=false}this.forceLandscape=t;this.forcePortrait=e;this.queueUpdate(true)},classifyOrientation:function(t){if(t==="portrait-primary"||t==="portrait-secondary"){return"portrait"}else if(t==="landscape-primary"||t==="landscape-secondary"){return"landscape"}else{return null}},updateOrientationState:function(){var t=this.screenOrientation;var e=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var i=t!==this.screenOrientation;var s=e!==this.incorrectOrientation;if(i){if(this.isLandscape){this.enterLandscape.dispatch(this.orientation,true,false)}else{this.enterPortrait.dispatch(this.orientation,false,true)}}if(s){if(this.incorrectOrientation){this.enterIncorrectOrientation.dispatch()}else{this.leaveIncorrectOrientation.dispatch()}}if(i||s){this.onOrientationChange.dispatch(this,t,e)}return i||s},orientationChange:function(t){this.event=t;this.queueUpdate(true)},windowResize:function(t){this.event=t;this.queueUpdate(true)},scrollTop:function(){var t=this.compatibility.scrollTo;if(t){window.scrollTo(t.x,t.y)}},refresh:function(){this.scrollTop();this.queueUpdate(true)},updateLayout:function(){var t=this.currentScaleMode;if(t===L.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop();if(this.compatibility.forceMinimumDocumentHeight){document.documentElement.style.minHeight=window.innerHeight+"px"}if(this.incorrectOrientation){this.setMaximum()}else{if(t===L.ScaleManager.EXACT_FIT){this.setExactFit()}else if(t===L.ScaleManager.SHOW_ALL){if(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent){this.setShowAll(true);this.resetCanvas();this.setShowAll()}else{this.setShowAll()}}else if(t===L.ScaleManager.NO_SCALE){this.width=this.game.width;this.height=this.game.height}else if(t===L.ScaleManager.USER_SCALE){this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x;this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y}}if(!this.compatibility.canExpandParent&&(t===L.ScaleManager.SHOW_ALL||t===L.ScaleManager.USER_SCALE)){var e=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,e.width);this.height=Math.min(this.height,e.height)}this.width=this.width|0;this.height=this.height|0;this.reflowCanvas()},getParentBounds:function(t){var e=t||new L.Rectangle;var i=this.boundingParent;var s=this.dom.visualBounds;var n=this.dom.layoutBounds;if(!i){e.setTo(0,0,s.width,s.height)}else{var r=i.getBoundingClientRect();e.setTo(r.left,r.top,r.width,r.height);var a=this.windowConstraints;if(a.right){var o=a.right==="layout"?n:s;e.right=Math.min(e.right,o.width)}if(a.bottom){var o=a.bottom==="layout"?n:s;e.bottom=Math.min(e.bottom,o.height)}}e.setTo(Math.round(e.x),Math.round(e.y),Math.round(e.width),Math.round(e.height));return e},alignCanvas:function(t,e){var i=this.getParentBounds(this._tempBounds);var s=this.game.canvas;var n=this.margin;if(t){n.left=n.right=0;var r=s.getBoundingClientRect();if(this.width<i.width&&!this.incorrectOrientation){var a=r.left-i.x;var o=i.width/2-this.width/2;o=Math.max(o,0);var h=o-a;n.left=Math.round(h)}s.style.marginLeft=n.left+"px";if(n.left!==0){n.right=-(i.width-r.width-n.left);s.style.marginRight=n.right+"px"}}if(e){n.top=n.bottom=0;var r=s.getBoundingClientRect();if(this.height<i.height&&!this.incorrectOrientation){var a=r.top-i.y;var o=i.height/2-this.height/2;o=Math.max(o,0);var h=o-a;n.top=Math.round(h)}s.style.marginTop=n.top+"px";if(n.top!==0){n.bottom=-(i.height-r.height-n.top);s.style.marginBottom=n.bottom+"px"}}n.x=n.left;n.y=n.top},reflowGame:function(){this.resetCanvas("","");var t=this.getParentBounds(this._tempBounds);this.updateDimensions(t.width,t.height,true)},reflowCanvas:function(){if(!this.incorrectOrientation){this.width=L.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width);this.height=L.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)}this.resetCanvas();if(!this.compatibility.noMargins){if(this.isFullScreen&&this._createdFullScreenTarget){this.alignCanvas(true,true)}else{this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)}}this.updateScalingAndBounds()},resetCanvas:function(t,e){if(typeof t==="undefined"){t=this.width+"px"}if(typeof e==="undefined"){e=this.height+"px"}var i=this.game.canvas;if(!this.compatibility.noMargins){i.style.marginLeft="";i.style.marginTop="";i.style.marginRight="";i.style.marginBottom=""}i.style.width=t;i.style.height=e},queueUpdate:function(t){if(t){this._parentBounds.width=0;this._parentBounds.height=0}this._updateThrottle=this._updateThrottleReset},reset:function(t){if(t){this.grid.reset()}},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(t){var e=this.getParentBounds(this._tempBounds);var i=e.width;var s=e.height;var n;if(t){n=Math.max(s/this.game.height,i/this.game.width)}else{n=Math.min(s/this.game.height,i/this.game.width)}this.width=Math.round(this.game.width*n);this.height=Math.round(this.game.height*n)},setExactFit:function(){var t=this.getParentBounds(this._tempBounds);this.width=t.width;this.height=t.height;if(this.isFullScreen){return}if(this.maxWidth){this.width=Math.min(this.width,this.maxWidth)}if(this.maxHeight){this.height=Math.min(this.height,this.maxHeight)}},createFullScreenTarget:function(){var t=document.createElement("div");t.style.margin="0";t.style.padding="0";t.style.background="#000";return t},startFullScreen:function(t,e){if(this.isFullScreen){return false}if(!this.compatibility.supportsFullScreen){var i=this;setTimeout(function(){i.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==="when-not-mouse"){var s=this.game.input;if(s.activePointer&&s.activePointer!==s.mousePointer&&(e||e!==false)){s.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[t,false]);return}}if(typeof t!=="undefined"&&this.game.renderType===L.CANVAS){this.game.stage.smoothed=t}var n=this.fullScreenTarget;if(!n){this.cleanupCreatedTarget();this._createdFullScreenTarget=this.createFullScreenTarget();n=this._createdFullScreenTarget}var r={targetElement:n};this.onFullScreenInit.dispatch(this,r);if(this._createdFullScreenTarget){var a=this.game.canvas;var o=a.parentNode;o.insertBefore(n,a);n.appendChild(a)}if(this.game.device.fullscreenKeyboard){n[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT)}else{n[this.game.device.requestFullscreen]()}return true},stopFullScreen:function(){if(!this.isFullScreen||!this.compatibility.supportsFullScreen){return false}document[this.game.device.cancelFullscreen]();return true},cleanupCreatedTarget:function(){var t=this._createdFullScreenTarget;if(t&&t.parentNode){var e=t.parentNode;e.insertBefore(this.game.canvas,t);e.removeChild(t)}this._createdFullScreenTarget=null},prepScreenMode:function(t){var e=!!this._createdFullScreenTarget;var i=this._createdFullScreenTarget||this.fullScreenTarget;if(t){if(e||this.fullScreenScaleMode===L.ScaleManager.EXACT_FIT){if(i!==this.game.canvas){this._fullScreenRestore={targetWidth:i.style.width,targetHeight:i.style.height};i.style.width="100%";i.style.height="100%"}}}else{if(this._fullScreenRestore){i.style.width=this._fullScreenRestore.targetWidth;i.style.height=this._fullScreenRestore.targetHeight;this._fullScreenRestore=null}this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.resetCanvas()}},fullScreenChange:function(t){this.event=t;if(this.isFullScreen){this.prepScreenMode(true);this.updateLayout();this.queueUpdate(true);this.enterFullScreen.dispatch(this.width,this.height)}else{this.prepScreenMode(false);this.cleanupCreatedTarget();this.updateLayout();this.queueUpdate(true);this.leaveFullScreen.dispatch(this.width,this.height)}this.onFullScreenChange.dispatch(this)},fullScreenError:function(t){this.event=t;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(t,e,i,s){if(typeof e==="undefined"){e=this.width}if(typeof i==="undefined"){i=this.height}if(typeof s==="undefined"){s=false}t.scale.set(1);if(t.width<=0||t.height<=0||e<=0||i<=0){return t}var n=e;var r=t.height*e/t.width;var a=t.width*i/t.height;var o=i;var h=a>e;if(h){h=s}else{h=!s}if(h){t.width=Math.floor(n);t.height=Math.floor(r)}else{t.width=Math.floor(a);t.height=Math.floor(o)}return t},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,false);window.removeEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.removeEventListener("mozfullscreenchange",this._fullScreenChange,false);document.removeEventListener("MSFullscreenChange",this._fullScreenChange,false);document.removeEventListener("fullscreenchange",this._fullScreenChange,false);document.removeEventListener("webkitfullscreenerror",this._fullScreenError,false);document.removeEventListener("mozfullscreenerror",this._fullScreenError,false);document.removeEventListener("MSFullscreenError",this._fullScreenError,false);document.removeEventListener("fullscreenerror",this._fullScreenError,false)}}};L.ScaleManager.prototype.constructor=L.ScaleManager;L.ScaleManager.prototype.checkResize=L.ScaleManager.prototype.windowResize;L.ScaleManager.prototype.checkOrientation=L.ScaleManager.prototype.orientationChange;L.ScaleManager.prototype.setScreenSize=L.ScaleManager.prototype.updateLayout;L.ScaleManager.prototype.setSize=L.ScaleManager.prototype.reflowCanvas;L.ScaleManager.prototype.checkOrientationState=function(){var t=this.updateOrientationState();if(t){this.refresh()}return t};Object.defineProperty(L.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||this.isFullScreen&&!this._createdFullScreenTarget){return null}var t=this.game.canvas&&this.game.canvas.parentNode;return t||null}});Object.defineProperty(L.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){if(t!==this._scaleMode){if(!this.isFullScreen){this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.queueUpdate(true)}this._scaleMode=t}return this._scaleMode}});Object.defineProperty(L.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(t){if(t!==this._fullScreenScaleMode){if(this.isFullScreen){this.prepScreenMode(false);this._fullScreenScaleMode=t;this.prepScreenMode(true);this.queueUpdate(true)}else{this._fullScreenScaleMode=t}}return this._fullScreenScaleMode}});Object.defineProperty(L.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(L.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(t){if(t!==this._pageAlignHorizontally){this._pageAlignHorizontally=t;this.queueUpdate(true)}}});Object.defineProperty(L.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(t){if(t!==this._pageAlignVertically){this._pageAlignVertically=t;this.queueUpdate(true)}}});Object.defineProperty(L.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document["fullscreenElement"]||document["webkitFullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"])}});Object.defineProperty(L.ScaleManager.prototype,"isPortrait",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"}});Object.defineProperty(L.ScaleManager.prototype,"isLandscape",{get:function(){return this.classifyOrientation(this.screenOrientation)==="landscape"}});Object.defineProperty(L.ScaleManager.prototype,"orientation",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"?0:90}});Object.defineProperty(L.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}});Object.defineProperty(L.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}});L.Game=function(t,e,i,s,n,r,a,o){this.id=L.GAMES.push(this)-1;this.config=null;this.physicsConfig=o;this.parent="";this.width=800;this.height=600;this.resolution=1;this._width=800;this._height=600;this.transparent=false;this.antialias=true;this.preserveDrawingBuffer=true;this.renderer=null;this.renderType=L.AUTO;this.state=null;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.plugins=null;this.rnd=null;this.device=L.Device;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.lockRender=false;this.stepping=false;this.pendingStep=false;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this._paused=false;this._codePaused=false;this.currentUpdateID=0;this.updatesThisFrame=1;this._deltaTime=0;this._lastCount=0;this._spiraling=0;this._kickstart=true;this.fpsProblemNotifier=new L.Signal;this.forceSingleUpdate=false;this._nextFpsNotification=0;if(arguments.length===1&&typeof arguments[0]==="object"){this.parseConfig(arguments[0])}else{this.config={enableDebug:false};if(typeof t!=="undefined"){this._width=t}if(typeof e!=="undefined"){this._height=e}if(typeof i!=="undefined"){this.renderType=i}if(typeof s!=="undefined"){this.parent=s}if(typeof r!=="undefined"){this.transparent=r}if(typeof a!=="undefined"){this.antialias=a}this.rnd=new L.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.state=new L.StateManager(this,n)}if(!window.__wx){if(this.config["canvasID"]){this.canvas=L.Canvas.create(this.width,this.height,this.config["canvasID"])}else{this.canvas=L.Canvas.create(this.width,this.height)}}this.device.whenReady(this.boot,this);return this};L.Game.prototype={parseConfig:function(t){this.config=t;if(typeof t["enableDebug"]==="undefined"){this.config.enableDebug=false}if(t["width"]){this._width=t["width"]}if(t["height"]){this._height=t["height"]}if(t["canvas"]){this.canvas=t["canvas"]}if(t["renderer"]){this.renderType=t["renderer"]}if(t["parent"]){this.parent=t["parent"]}if(t["transparent"]){this.transparent=t["transparent"]}if(t["antialias"]){this.antialias=t["antialias"]}if(t["resolution"]){this.resolution=t["resolution"]}if(t["preserveDrawingBuffer"]){this.preserveDrawingBuffer=t["preserveDrawingBuffer"]}if(t["physicsConfig"]){this.physicsConfig=t["physicsConfig"]}var e=[(Date.now()*Math.random()).toString()];if(t["seed"]){e=t["seed"]}this.rnd=new L.RandomDataGenerator(e);var i=null;if(t["state"]){i=t["state"]}this.state=new L.StateManager(this,i)},boot:function(){if(this.isBooted){return}this.onPause=new L.Signal;this.onResume=new L.Signal;this.onBlur=new L.Signal;this.onFocus=new L.Signal;this.isBooted=true;this.math=L.Math;this.scale=new L.ScaleManager(this,this._width,this._height);this.stage=new L.Stage(this);this.setUpRenderer();this.world=new L.World(this);this.add=new L.GameObjectFactory(this);this.make=new L.GameObjectCreator(this);this.cache=new L.Cache(this);this.load=new L.Loader(this);this.time=new L.Time(this);this.tweens=new L.TweenManager(this);this.input=new L.Input(this);this.sound=new L.SoundManager(this);this.physics=new L.Physics(this,this.physicsConfig);this.plugins=new L.PluginManager(this);this.net=new L.Net(this);this.time.boot();this.stage.boot();this.world.boot();this.scale.boot();this.input.boot();this.sound.boot();this.state.boot();if(this.config["enableDebug"]){this.debug=new L.Utils.Debug(this);this.debug.boot()}else{this.debug={preUpdate:function(){},update:function(){},reset:function(){}}}this.showDebugHeader();this.isRunning=true;if(this.config&&this.config["forceSetTimeOut"]){this.raf=new L.RequestAnimationFrame(this,this.config["forceSetTimeOut"])}else{this.raf=new L.RequestAnimationFrame(this,false)}this._kickstart=true;if(window["focus"]){if(!window["PhaserGlobal"]||window["PhaserGlobal"]&&!window["PhaserGlobal"].stopFocus){window.focus()}}this.raf.start()},showDebugHeader:function(){if(window["PhaserGlobal"]&&window["PhaserGlobal"].hideBanner){return}var t=L.VERSION;var e="Canvas";var i="HTML Audio";var s=1;if(this.renderType===L.WEBGL){e="WebGL";s++}else if(this.renderType==L.HEADLESS){e="Headless"}if(this.device.webAudio){i="WebAudio";s++}if(this.device.chrome){var n=["%c %c %c Phaser v"+t+" | Pixi.js "+PIXI.VERSION+" | "+e+" | "+i+"  %c %c "+"%c http://phaser.io %c♥%c♥%c♥","background: #9854d8","background: #6c2ca7","color: #ffffff; background: #450f78;","background: #6c2ca7","background: #9854d8","background: #ffffff"];for(var r=0;r<3;r++){if(r<s){n.push("color: #ff2424; background: #fff")}else{n.push("color: #959595; background: #fff")}}console.log.apply(console,n)}else if(window["console"]){console.log("Phaser v"+t+" | Pixi.js "+PIXI.VERSION+" | "+e+" | "+i+" | http://phaser.io")}},setUpRenderer:function(){if(window.__wx){this.device.canvas=this.canvas}if(this.config["canvasStyle"]){this.canvas.style=this.config["canvasStyle"]}else{this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%"}if(this.device.cocoonJS){if(this.renderType===L.CANVAS){this.canvas.screencanvas=true}else{this.canvas.screencanvas=false}}if(this.renderType===L.HEADLESS||this.renderType===L.CANVAS||this.renderType===L.AUTO&&this.device.webGL===false){if(this.device.canvas){if(this.renderType===L.AUTO){this.renderType=L.CANVAS}this.renderer=new PIXI.CanvasRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,clearBeforeRender:true});this.context=this.renderer.context}else{throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.")}}else{this.renderType=L.WEBGL;this.renderer=new PIXI.WebGLRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,antialias:this.antialias,preserveDrawingBuffer:this.preserveDrawingBuffer});this.context=null}if(this.renderType!==L.HEADLESS){this.stage.smoothed=this.antialias;L.Canvas.addToDOM(this.canvas,this.parent,false);L.Canvas.setTouchAction(this.canvas)}},update:function(t){this.time.update(t);if(this._kickstart){this.updateLogic(1/this.time.desiredFps);this.stage.updateTransform();this.updateRender(this.time.slowMotion*this.time.desiredFps);this._kickstart=false;return}if(this._spiraling>1&&!this.forceSingleUpdate){if(this.time.time>this._nextFpsNotification){this._nextFpsNotification=this.time.time+1e3*10;this.fpsProblemNotifier.dispatch()}this._deltaTime=0;this._spiraling=0;this.updateRender(this.time.slowMotion*this.time.desiredFps)}else{var e=this.time.slowMotion*1e3/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(e*3,this.time.elapsed),0);var i=0;this.updatesThisFrame=Math.floor(this._deltaTime/e);if(this.forceSingleUpdate){this.updatesThisFrame=Math.min(1,this.updatesThisFrame)}while(this._deltaTime>=e){this._deltaTime-=e;this.currentUpdateID=i;this.updateLogic(1/this.time.desiredFps);this.stage.updateTransform();i++;if(this.forceSingleUpdate&&i===1){break}}if(i>this._lastCount){this._spiraling++}else if(i<this._lastCount){this._spiraling=0}this._lastCount=i;this.updateRender(this._deltaTime/e)}},updateLogic:function(t){if(!this._paused&&!this.pendingStep){if(this.stepping){this.pendingStep=true}this.scale.preUpdate();this.debug.preUpdate();this.world.camera.preUpdate();this.physics.preUpdate();this.state.preUpdate(t);this.plugins.preUpdate(t);this.stage.preUpdate();this.state.update();this.stage.update();this.tweens.update(t);this.sound.update();this.input.update();this.physics.update();this.plugins.update();this.stage.postUpdate();this.plugins.postUpdate()}else{this.scale.pauseUpdate();this.state.pauseUpdate();this.debug.preUpdate()}},updateRender:function(t){if(this.lockRender){return}this.state.preRender(t);this.renderer.render(this.stage);this.plugins.render(t);this.state.render(t);this.plugins.postRender(t)},enableStep:function(){this.stepping=true;this.pendingStep=false;this.stepCount=0},disableStep:function(){this.stepping=false;this.pendingStep=false},step:function(){this.pendingStep=false;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.state=null;this.cache=null;this.input=null;this.load=null;this.sound=null;this.stage=null;this.time=null;this.world=null;this.isBooted=false;this.renderer.destroy(false);L.Canvas.removeFromDOM(this.canvas);L.GAMES[this.id]=null},gamePaused:function(t){if(!this._paused){this._paused=true;this.time.gamePaused();this.sound.setMute();this.onPause.dispatch(t)}},gameResumed:function(t){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();this.sound.unsetMute();this.onResume.dispatch(t)}},focusLoss:function(t){this.onBlur.dispatch(t);if(!this.stage.disableVisibilityChange){this.gamePaused(t)}},focusGain:function(t){this.onFocus.dispatch(t);if(!this.stage.disableVisibilityChange){this.gameResumed(t)}}};L.Game.prototype.constructor=L.Game;Object.defineProperty(L.Game.prototype,"paused",{get:function(){return this._paused},set:function(t){if(t===true){if(this._paused===false){this._paused=true;this.sound.setMute();this.time.gamePaused();this.onPause.dispatch(this)}this._codePaused=true}else{if(this._paused){this._paused=false;this.input.reset();this.sound.unsetMute();this.time.gameResumed();this.onResume.dispatch(this)}this._codePaused=false}}});L.Input=function(t){this.game=t;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.moveCallback=null;this.moveCallbackContext=this;this.pollRate=0;this.enabled=true;this.multiInputOverride=L.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=-1;this.currentPointers=0;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2e3;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=false;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.pointers=[];this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=false;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new L.ArraySet;this._localPoint=new L.Point;this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};L.Input.MOUSE_OVERRIDES_TOUCH=0;L.Input.TOUCH_OVERRIDES_MOUSE=1;L.Input.MOUSE_TOUCH_COMBINE=2;L.Input.MAX_POINTERS=10;L.Input.prototype={boot:function(){this.mousePointer=new L.Pointer(this.game,0);this.addPointer();this.addPointer();this.mouse=new L.Mouse(this.game);this.touch=new L.Touch(this.game);this.mspointer=new L.MSPointer(this.game);if(L.Keyboard){this.keyboard=new L.Keyboard(this.game)}if(L.Gamepad){this.gamepad=new L.Gamepad(this.game)}this.onDown=new L.Signal;this.onUp=new L.Signal;this.onTap=new L.Signal;this.onHold=new L.Signal;this.scale=new L.Point(1,1);this.speed=new L.Point;this.position=new L.Point;this._oldPosition=new L.Point;this.circle=new L.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.mouse.start();this.touch.start();this.mspointer.start();this.mousePointer.active=true;if(this.keyboard){this.keyboard.start()}var e=this;this._onClickTrampoline=function(t){e.onClickTrampoline(t)};this.game.canvas.addEventListener("click",this._onClickTrampoline,false)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();if(this.keyboard){this.keyboard.stop()}if(this.gamepad){this.gamepad.stop()}this.moveCallbacks=[];this.game.canvas.removeEventListener("click",this._onClickTrampoline)},addMoveCallback:function(t,e){return this.moveCallbacks.push({callback:t,context:e})-1},deleteMoveCallback:function(t){if(this.moveCallbacks[t]){this.moveCallbacks.splice(t,1)}},addPointer:function(){if(this.pointers.length>=L.Input.MAX_POINTERS){console.warn("Phaser.Input.addPointer: only "+L.Input.MAX_POINTERS+" pointer allowed");return null}var t=this.pointers.length+1;var e=new L.Pointer(this.game,t);this.pointers.push(e);this["pointer"+t]=e;return e},update:function(){if(this.keyboard){this.keyboard.update()}if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();if(this.gamepad&&this.gamepad.active){this.gamepad.update()}for(var t=0;t<this.pointers.length;t++){this.pointers[t].update()}this._pollCounter=0},reset:function(t){if(!this.game.isBooted||this.resetLocked){return}if(typeof t==="undefined"){t=false}this.mousePointer.reset();if(this.keyboard){this.keyboard.reset(t)}if(this.gamepad){this.gamepad.reset()}for(var e=0;e<this.pointers.length;e++){this.pointers[e].reset()}this.currentPointers=0;if(this.game.canvas.style.cursor!=="none"){this.game.canvas.style.cursor="inherit"}if(t){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new L.Signal;this.onUp=new L.Signal;this.onTap=new L.Signal;this.onHold=new L.Signal;this.moveCallbacks=[]}this._pollCounter=0},resetSpeed:function(t,e){this._oldPosition.setTo(t,e);this.speed.setTo(0,0)},startPointer:function(t){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers){return null}if(!this.pointer1.active){return this.pointer1.start(t)}if(!this.pointer2.active){return this.pointer2.start(t)}for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(!i.active){return i.start(t)}}return null},updatePointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier){return this.pointer1.move(t)}if(this.pointer2.active&&this.pointer2.identifier===t.identifier){return this.pointer2.move(t)}for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier){return i.move(t)}}return null},stopPointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier){return this.pointer1.stop(t)}if(this.pointer2.active&&this.pointer2.identifier===t.identifier){return this.pointer2.stop(t)}for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier){return i.stop(t)}}return null},countActivePointers:function(t){if(typeof t==="undefined"){t=this.pointers.length}var e=t;for(var i=0;i<this.pointers.length&&e>0;i++){var s=this.pointers[i];if(s.active){e--}}this.currentPointers=t-e;return t-e},getPointer:function(t){if(typeof t==="undefined"){t=false}for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active===t){return i}}return null},getPointerFromIdentifier:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.identifier===t){return i}}return null},getPointerFromId:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.pointerId===t){return i}}return null},getLocalPosition:function(t,e,i){if(typeof i==="undefined"){i=new L.Point}var s=t.worldTransform;var n=1/(s.a*s.d+s.c*-s.b);return i.setTo(s.d*n*e.x+-s.c*n*e.y+(s.ty*s.c-s.tx*s.d)*n,s.a*n*e.y+-s.b*n*e.x+(-s.ty*s.a+s.tx*s.b)*n)},hitTest:function(t,e,i){if(!t.worldVisible){return false}this.getLocalPosition(t,e,this._localPoint);i.copyFrom(this._localPoint);if(t.hitArea&&t.hitArea.contains){return t.hitArea.contains(this._localPoint.x,this._localPoint.y)}else if(t instanceof L.TileSprite){var s=t.width;var n=t.height;var r=-s*t.anchor.x;if(this._localPoint.x>=r&&this._localPoint.x<r+s){var a=-n*t.anchor.y;if(this._localPoint.y>=a&&this._localPoint.y<a+n){return true}}}else if(t instanceof PIXI.Sprite){var s=t.texture.frame.width;var n=t.texture.frame.height;var r=-s*t.anchor.x;if(this._localPoint.x>=r&&this._localPoint.x<r+s){var a=-n*t.anchor.y;if(this._localPoint.y>=a&&this._localPoint.y<a+n){return true}}}else if(t instanceof L.Graphics){for(var o=0;o<t.graphicsData.length;o++){var h=t.graphicsData[o];if(!h.fill){continue}if(h.shape&&h.shape.contains(this._localPoint.x,this._localPoint.y)){return true}}}for(var o=0,l=t.children.length;o<l;o++){if(this.hitTest(t.children[o],e,i)){return true}}return false},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};L.Input.prototype.constructor=L.Input;Object.defineProperty(L.Input.prototype,"x",{get:function(){return this._x},set:function(t){this._x=Math.floor(t)}});Object.defineProperty(L.Input.prototype,"y",{get:function(){return this._y},set:function(t){this._y=Math.floor(t)}});Object.defineProperty(L.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}});Object.defineProperty(L.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}});Object.defineProperty(L.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(L.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(L.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});Object.defineProperty(L.Input.prototype,"disabled",{get:function(){return!this.enabled},set:function(t){this.enabled=!t}});L.Mouse=function(t){this.game=t;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseMoveCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.mouseWheelCallback=null;this.capture=false;this.button=-1;this.wheelDelta=0;this.enabled=true;this.locked=false;this.stopOnGameOut=false;this.pointerLock=new L.Signal;this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;this._onMouseWheel=null;this._wheelEvent=null};L.Mouse.NO_BUTTON=-1;L.Mouse.LEFT_BUTTON=0;L.Mouse.MIDDLE_BUTTON=1;L.Mouse.RIGHT_BUTTON=2;L.Mouse.WHEEL_UP=1;L.Mouse.WHEEL_DOWN=-1;L.Mouse.prototype={start:function(){if(this.game.device.android&&this.game.device.chrome===false){return}if(this._onMouseDown!==null){return}var e=this;this._onMouseDown=function(t){return e.onMouseDown(t)};this._onMouseMove=function(t){return e.onMouseMove(t)};this._onMouseUp=function(t){return e.onMouseUp(t)};this._onMouseUpGlobal=function(t){return e.onMouseUpGlobal(t)};this._onMouseOut=function(t){return e.onMouseOut(t)};this._onMouseOver=function(t){return e.onMouseOver(t)};this._onMouseWheel=function(t){return e.onMouseWheel(t)};this.game.canvas.addEventListener("mousedown",this._onMouseDown,true);this.game.canvas.addEventListener("mousemove",this._onMouseMove,true);this.game.canvas.addEventListener("mouseup",this._onMouseUp,true);if(!this.game.device.cocoonJS){window.addEventListener("mouseup",this._onMouseUpGlobal,true);this.game.canvas.addEventListener("mouseover",this._onMouseOver,true);this.game.canvas.addEventListener("mouseout",this._onMouseOut,true)}var t=this.game.device.wheelEvent;if(t){this.game.canvas.addEventListener(t,this._onMouseWheel,true);if(t==="mousewheel"){this._wheelEvent=new s(-1/40,1)}else if(t==="DOMMouseScroll"){this._wheelEvent=new s(1,1)}}},onMouseDown:function(t){this.event=t;if(this.capture){t.preventDefault()}this.button=t.button;if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}t["identifier"]=0;this.game.input.mousePointer.start(t)},onMouseMove:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}t["identifier"]=0;this.game.input.mousePointer.move(t)},onMouseUp:function(t){this.event=t;if(this.capture){t.preventDefault()}this.button=L.Mouse.NO_BUTTON;if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}t["identifier"]=0;this.game.input.mousePointer.stop(t)},onMouseUpGlobal:function(t){if(!this.game.input.mousePointer.withinGame){this.button=L.Mouse.NO_BUTTON;if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,t)}t["identifier"]=0;this.game.input.mousePointer.stop(t)}},onMouseOut:function(t){this.event=t;if(this.capture){t.preventDefault()}this.game.input.mousePointer.withinGame=false;if(this.mouseOutCallback){this.mouseOutCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}if(this.stopOnGameOut){t["identifier"]=0;this.game.input.mousePointer.stop(t)}},onMouseWheel:function(t){if(this._wheelEvent){t=this._wheelEvent.bindEvent(t)}this.event=t;if(this.capture){t.preventDefault()}this.wheelDelta=L.Math.clamp(-t.deltaY,-1,1);if(this.mouseWheelCallback){this.mouseWheelCallback.call(this.callbackContext,t)}},onMouseOver:function(t){this.event=t;if(this.capture){t.preventDefault()}this.game.input.mousePointer.withinGame=true;if(this.mouseOverCallback){this.mouseOverCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}},requestPointerLock:function(){if(this.game.device.pointerLock){var t=this.game.canvas;t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock;t.requestPointerLock();var e=this;this._pointerLockChange=function(t){return e.pointerLockChange(t)};document.addEventListener("pointerlockchange",this._pointerLockChange,true);document.addEventListener("mozpointerlockchange",this._pointerLockChange,true);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,true)}},pointerLockChange:function(t){var e=this.game.canvas;if(document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e){this.locked=true;this.pointerLock.dispatch(true,t)}else{this.locked=false;this.pointerLock.dispatch(false,t)}},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,true);this.game.canvas.removeEventListener("mousemove",this._onMouseMove,true);this.game.canvas.removeEventListener("mouseup",this._onMouseUp,true);this.game.canvas.removeEventListener("mouseover",this._onMouseOver,true);this.game.canvas.removeEventListener("mouseout",this._onMouseOut,true);var t=this.game.device.wheelEvent;if(t){this.game.canvas.removeEventListener(t,this._onMouseWheel,true)}window.removeEventListener("mouseup",this._onMouseUpGlobal,true);document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)}};L.Mouse.prototype.constructor=L.Mouse;Object.defineProperty(L.Mouse.prototype,"disabled",{get:function(){return!this.enabled},set:function(t){this.enabled=!t}});function s(t,e){this._scaleFactor=t;this._deltaMode=e;this.originalEvent=null}s.prototype={};s.prototype.constructor=s;s.prototype.bindEvent=function(t){if(!s._stubsGenerated&&t){var e=function(e){return function(){var t=this.originalEvent[e];return typeof t!=="function"?t:t.bind(this.originalEvent)}};for(var i in t){if(!(i in s.prototype)){Object.defineProperty(s.prototype,i,{get:e(i)})}}s._stubsGenerated=true}this.originalEvent=t;return this};Object.defineProperties(s.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});L.MSPointer=function(t){this.game=t;this.callbackContext=this.game;this.pointerDownCallback=null;this.pointerMoveCallback=null;this.pointerUpCallback=null;this.capture=true;this.button=-1;this.event=null;this.enabled=true;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null};L.MSPointer.prototype={start:function(){if(this._onMSPointerDown!==null){return}var e=this;if(this.game.device.mspointer){this._onMSPointerDown=function(t){return e.onPointerDown(t)};this._onMSPointerMove=function(t){return e.onPointerMove(t)};this._onMSPointerUp=function(t){return e.onPointerUp(t)};this.game.canvas.addEventListener("MSPointerDown",this._onMSPointerDown,false);this.game.canvas.addEventListener("MSPointerMove",this._onMSPointerMove,false);this.game.canvas.addEventListener("MSPointerUp",this._onMSPointerUp,false);this.game.canvas.addEventListener("pointerDown",this._onMSPointerDown,false);this.game.canvas.addEventListener("pointerMove",this._onMSPointerMove,false);this.game.canvas.addEventListener("pointerUp",this._onMSPointerUp,false);this.game.canvas.style["-ms-content-zooming"]="none";this.game.canvas.style["-ms-touch-action"]="none"}},onPointerDown:function(t){this.event=t;if(this.capture){t.preventDefault()}this.button=t.button;if(this.pointerDownCallback){this.pointerDownCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}t.identifier=t.pointerId;this.game.input.startPointer(t)},onPointerMove:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.pointerMoveCallback){this.pointerMoveCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}t.identifier=t.pointerId;this.game.input.updatePointer(t)},onPointerUp:function(t){this.event=t;if(this.capture){t.preventDefault()}this.button=L.Mouse.NO_BUTTON;if(this.pointerUpCallback){this.pointerUpCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}t.identifier=t.pointerId;this.game.input.stopPointer(t)},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}};L.MSPointer.prototype.constructor=L.MSPointer;Object.defineProperty(L.MSPointer.prototype,"disabled",{get:function(){return!this.enabled},set:function(t){this.enabled=!t}});L.Pointer=function(t,e){this.game=t;this.id=e;this.type=L.POINTER;this.exists=true;this.identifier=0;this.pointerId=null;this.target=null;this.button=null;this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=false;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.active=false;this.dirty=false;this.position=new L.Point;this.positionDown=new L.Point;this.positionUp=new L.Point;this.circle=new L.Circle(0,0,44);if(e===0){this.isMouse=true}this._clickTrampolines=null;this._trampolineTargetObject=null};L.Pointer.prototype={start:function(t){if(t["pointerId"]){this.pointerId=t.pointerId}this.identifier=t.identifier;this.target=t.target;if(typeof t.button!=="undefined"){this.button=t.button}this._history=[];this.active=true;this.withinGame=true;this.isDown=true;this.isUp=false;this.dirty=false;this._clickTrampolines=null;this._trampolineTargetObject=null;this.msSinceLastClick=this.game.time.time-this.timeDown;this.timeDown=this.game.time.time;this._holdSent=false;this.move(t,true);this.positionDown.setTo(this.x,this.y);if(this.game.input.multiInputOverride===L.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===L.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===L.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0){this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.x,this.y);this.game.input.onDown.dispatch(this,t);this.game.input.resetSpeed(this.x,this.y)}this._stateReset=false;this.totalTouches++;if(!this.isMouse){this.game.input.currentPointers++}if(this.targetObject!==null){this.targetObject._touchedHandler(this)}return this},update:function(){if(this.active){if(this.dirty){if(this.game.input.interactiveItems.total>0){this.processInteractiveObjects(false)}this.dirty=false}if(this._holdSent===false&&this.duration>=this.game.input.holdRate){if(this.game.input.multiInputOverride==L.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==L.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==L.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0){this.game.input.onHold.dispatch(this)}this._holdSent=true}if(this.game.input.recordPointerHistory&&this.game.time.time>=this._nextDrop){this._nextDrop=this.game.time.time+this.game.input.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>this.game.input.recordLimit){this._history.shift()}}}},move:function(t,e){if(this.game.input.pollLocked){return}if(typeof e==="undefined"){e=false}if(typeof t.button!=="undefined"){this.button=t.button}this.clientX=t.clientX;this.clientY=t.clientY;this.pageX=t.pageX;this.pageY=t.pageY;this.screenX=t.screenX;this.screenY=t.screenY;if(this.isMouse&&this.game.input.mouse.locked&&!e){this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0;this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0;this.movementX+=this.rawMovementX;this.movementY+=this.rawMovementY}this.x=(this.pageX-this.game.scale.offset.x)*this.game.input.scale.x;this.y=(this.pageY-this.game.scale.offset.y)*this.game.input.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(this.game.input.multiInputOverride===L.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===L.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===L.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0){this.game.input.activePointer=this;this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.game.input.x,this.game.input.y);this.game.input.circle.x=this.game.input.x;this.game.input.circle.y=this.game.input.y}this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);if(this.game.paused){return this}var i=this.game.input.moveCallbacks.length;while(i--){this.game.input.moveCallbacks[i].callback.call(this.game.input.moveCallbacks[i].context,this,this.x,this.y,e)}if(this.targetObject!==null&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null}}else if(this.game.input.interactiveItems.total>0){this.processInteractiveObjects(e)}return this},processInteractiveObjects:function(t){var e=Number.MAX_VALUE;var i=-1;var s=null;var n=this.game.input.interactiveItems.first;while(n){n.checked=false;if(n.validForInput(i,e,false)){n.checked=true;if(t&&n.checkPointerDown(this,true)||!t&&n.checkPointerOver(this,true)){e=n.sprite.renderOrderID;i=n.priorityID;s=n}}n=this.game.input.interactiveItems.next}var n=this.game.input.interactiveItems.first;while(n){if(!n.checked&&n.validForInput(i,e,true)){if(t&&n.checkPointerDown(this,false)||!t&&n.checkPointerOver(this,false)){e=n.sprite.renderOrderID;i=n.priorityID;s=n}}n=this.game.input.interactiveItems.next}if(s===null){if(this.targetObject){this.targetObject._pointerOutHandler(this);this.targetObject=null}}else{if(this.targetObject===null){this.targetObject=s;s._pointerOverHandler(this)}else{if(this.targetObject===s){if(s.update(this)===false){this.targetObject=null}}else{this.targetObject._pointerOutHandler(this);this.targetObject=s;this.targetObject._pointerOverHandler(this)}}}return this.targetObject!==null},leave:function(t){this.withinGame=false;this.move(t,false)},stop:function(t){if(this._stateReset&&this.withinGame){t.preventDefault();return}this.timeUp=this.game.time.time;if(this.game.input.multiInputOverride===L.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===L.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===L.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0){this.game.input.onUp.dispatch(this,t);if(this.duration>=0&&this.duration<=this.game.input.tapRate){if(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate){this.game.input.onTap.dispatch(this,true)}else{this.game.input.onTap.dispatch(this,false)}this.previousTapTime=this.timeUp}}if(this.id>0){this.active=false}this.withinGame=false;this.isDown=false;this.isUp=true;this.pointerId=null;this.identifier=null;this.positionUp.setTo(this.x,this.y);if(this.isMouse===false){this.game.input.currentPointers--}this.game.input.interactiveItems.callAll("_releasedHandler",this);if(this._clickTrampolines){this._trampolineTargetObject=this.targetObject}this.targetObject=null;return this},justPressed:function(t){t=t||this.game.input.justPressedRate;return this.isDown===true&&this.timeDown+t>this.game.time.time},justReleased:function(t){t=t||this.game.input.justReleasedRate;return this.isUp===true&&this.timeUp+t>this.game.time.time},addClickTrampoline:function(t,e,i,s){if(!this.isDown){return}var n=this._clickTrampolines=this._clickTrampolines||[];for(var r=0;r<n.length;r++){if(n[r].name===t){n.splice(r,1);break}}n.push({name:t,targetObject:this.targetObject,callback:e,callbackContext:i,callbackArgs:s})},processClickTrampolines:function(){var t=this._clickTrampolines;if(!t){return}for(var e=0;e<t.length;e++){var i=t[e];if(i.targetObject===this._trampolineTargetObject){i.callback.apply(i.callbackContext,i.callbackArgs)}}this._clickTrampolines=null;this._trampolineTargetObject=null},reset:function(){if(this.isMouse===false){this.active=false}this.pointerId=null;this.identifier=null;this.dirty=false;this.isDown=false;this.isUp=true;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};L.Pointer.prototype.constructor=L.Pointer;Object.defineProperty(L.Pointer.prototype,"duration",{get:function(){if(this.isUp){return-1}return this.game.time.time-this.timeDown}});Object.defineProperty(L.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(L.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});L.Touch=function(t){this.game=t;this.enabled=true;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};L.Touch.prototype={start:function(){if(this._onTouchStart!==null){return}var e=this;if(this.game.device.touch){this._onTouchStart=function(t){return e.onTouchStart(t)};this._onTouchMove=function(t){return e.onTouchMove(t)};this._onTouchEnd=function(t){return e.onTouchEnd(t)};this._onTouchEnter=function(t){return e.onTouchEnter(t)};this._onTouchLeave=function(t){return e.onTouchLeave(t)};this._onTouchCancel=function(t){return e.onTouchCancel(t)};this.game.canvas.addEventListener("touchstart",this._onTouchStart,false);this.game.canvas.addEventListener("touchmove",this._onTouchMove,false);this.game.canvas.addEventListener("touchend",this._onTouchEnd,false);this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,false);if(!this.game.device.cocoonJS){this.game.canvas.addEventListener("touchenter",this._onTouchEnter,false);this.game.canvas.addEventListener("touchleave",this._onTouchLeave,false)}}},consumeDocumentTouches:function(){this._documentTouchMove=function(t){t.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,false)},onTouchStart:function(t){this.event=t;if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.startPointer(t.changedTouches[e])}},onTouchCancel:function(t){this.event=t;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.stopPointer(t.changedTouches[e])}},onTouchEnter:function(t){this.event=t;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){t.preventDefault()}},onTouchLeave:function(t){this.event=t;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}},onTouchMove:function(t){this.event=t;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.updatePointer(t.changedTouches[e])}},onTouchEnd:function(t){this.event=t;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.stopPointer(t.changedTouches[e])}},stop:function(){if(this.game.device.touch){this.game.canvas.removeEventListener("touchstart",this._onTouchStart);this.game.canvas.removeEventListener("touchmove",this._onTouchMove);this.game.canvas.removeEventListener("touchend",this._onTouchEnd);this.game.canvas.removeEventListener("touchenter",this._onTouchEnter);this.game.canvas.removeEventListener("touchleave",this._onTouchLeave);this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel)}}};L.Touch.prototype.constructor=L.Touch;Object.defineProperty(L.Touch.prototype,"disabled",{get:function(){return!this.enabled},set:function(t){this.enabled=!t}});L.InputHandler=function(t){this.sprite=t;this.game=t.game;this.enabled=false;this.checked=false;this.priorityID=0;this.useHandCursor=false;this._setHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=false;this.pixelPerfectClick=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.consumePointerEvent=false;this.scaleLayer=false;this.dragOffset=new L.Point;this.dragFromCenter=false;this.dragStartPoint=new L.Point;this._dragPoint=new L.Point;this._dragPhase=false;this._wasEnabled=false;this._tempPoint=new L.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false})};L.InputHandler.prototype={start:function(t,e){t=t||0;if(typeof e==="undefined"){e=false}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=e;this.priorityID=t;for(var i=0;i<10;i++){this._pointerData[i]={id:i,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}this.snapOffset=new L.Point;this.enabled=true;this._wasEnabled=true}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);this.flagged=false;return this.sprite},addedToGroup:function(){if(this._dragPhase){return}if(this._wasEnabled&&!this.enabled){this.start()}},removedFromGroup:function(){if(this._dragPhase){return}if(this.enabled){this._wasEnabled=true;this.stop()}else{this._wasEnabled=false}},reset:function(){this.enabled=false;this.flagged=false;for(var t=0;t<10;t++){this._pointerData[t]={id:t,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}},stop:function(){if(this.enabled===false){return}else{this.enabled=false;this.game.input.interactiveItems.remove(this)}},destroy:function(){if(this.sprite){if(this._setHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}this.enabled=false;this.game.input.interactiveItems.remove(this);this._pointerData.length=0;this.boundsRect=null;this.boundsSprite=null;this.sprite=null}},validForInput:function(t,e,i){if(typeof i==="undefined"){i=true}if(this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID){return false}if(!i&&(this.pixelPerfectClick||this.pixelPerfectOver)){return false}if(this.priorityID>t||this.priorityID===t&&this.sprite.renderOrderID<e){return true}return false},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(t){t=t||0;return this._pointerData[t].x},pointerY:function(t){t=t||0;return this._pointerData[t].y},pointerDown:function(t){t=t||0;return this._pointerData[t].isDown},pointerUp:function(t){t=t||0;return this._pointerData[t].isUp},pointerTimeDown:function(t){t=t||0;return this._pointerData[t].timeDown},pointerTimeUp:function(t){t=t||0;return this._pointerData[t].timeUp},pointerOver:function(t){if(this.enabled){if(typeof t==="undefined"){for(var e=0;e<10;e++){if(this._pointerData[e].isOver){return true}}}else{return this._pointerData[t].isOver}}return false},pointerOut:function(t){if(this.enabled){if(typeof t==="undefined"){for(var e=0;e<10;e++){if(this._pointerData[e].isOut){return true}}}else{return this._pointerData[t].isOut}}return false},pointerTimeOver:function(t){t=t||0;return this._pointerData[t].timeOver},pointerTimeOut:function(t){t=t||0;return this._pointerData[t].timeOut},pointerDragged:function(t){t=t||0;return this._pointerData[t].isDragged},checkPointerDown:function(t,e){if(!t.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible){return false}if(this.game.input.hitTest(this.sprite,t,this._tempPoint)){if(typeof e==="undefined"){e=false}if(!e&&this.pixelPerfectClick){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPointerOver:function(t,e){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible){return false}if(this.game.input.hitTest(this.sprite,t,this._tempPoint)){if(typeof e==="undefined"){e=false}if(!e&&this.pixelPerfectOver){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPixel:function(t,e,i){if(this.sprite.texture.baseTexture.source){if(t===null&&e===null){this.game.input.getLocalPosition(this.sprite,i,this._tempPoint);var t=this._tempPoint.x;var e=this._tempPoint.y}if(this.sprite.anchor.x!==0){t-=-this.sprite.texture.frame.width*this.sprite.anchor.x}if(this.sprite.anchor.y!==0){e-=-this.sprite.texture.frame.height*this.sprite.anchor.y}t+=this.sprite.texture.frame.x;e+=this.sprite.texture.frame.y;if(this.sprite.texture.trim){t-=this.sprite.texture.trim.x;e-=this.sprite.texture.trim.y;if(t<this.sprite.texture.crop.x||t>this.sprite.texture.crop.right||e<this.sprite.texture.crop.y||e>this.sprite.texture.crop.bottom){this._dx=t;this._dy=e;return false}}this._dx=t;this._dy=e;var s=this.game.input;if(!s.hitContext){s.hitCanvas=document.createElement("canvas");s.hitCanvas.width=1;s.hitCanvas.height=1;s.hitContext=this.hitCanvas.getContext("2d")}s.hitContext.clearRect(0,0,1,1);s.hitContext.drawImage(this.sprite.texture.baseTexture.source,t,e,1,1,0,0,1,1);var n=s.hitContext.getImageData(0,0,1,1);if(n.data[3]>=this.pixelPerfectAlpha){return true}}return false},update:function(t){if(this.sprite===null||this.sprite.parent===undefined){return}if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible){this._pointerOutHandler(t);return false}if(this.draggable&&this._draggedPointerID===t.id){return this.updateDrag(t)}else if(this._pointerData[t.id].isOver){if(this.checkPointerOver(t)){this._pointerData[t.id].x=t.x-this.sprite.x;this._pointerData[t.id].y=t.y-this.sprite.y;return true}else{this._pointerOutHandler(t);return false}}},_pointerOverHandler:function(t){if(this.sprite===null){return}if(this._pointerData[t.id].isOver===false||t.dirty){this._pointerData[t.id].isOver=true;this._pointerData[t.id].isOut=false;this._pointerData[t.id].timeOver=this.game.time.time;this._pointerData[t.id].x=t.x-this.sprite.x;this._pointerData[t.id].y=t.y-this.sprite.y;if(this.useHandCursor&&this._pointerData[t.id].isDragged===false){this.game.canvas.style.cursor="pointer";this._setHandCursor=true}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOver$dispatch(this.sprite,t)}}},_pointerOutHandler:function(t){if(this.sprite===null){return}this._pointerData[t.id].isOver=false;this._pointerData[t.id].isOut=true;this._pointerData[t.id].timeOut=this.game.time.time;if(this.useHandCursor&&this._pointerData[t.id].isDragged===false){this.game.canvas.style.cursor="default";this._setHandCursor=false}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOut$dispatch(this.sprite,t)}},_touchedHandler:function(t){if(this.sprite===null){return}if(this._pointerData[t.id].isDown===false&&this._pointerData[t.id].isOver===true){if(this.pixelPerfectClick&&!this.checkPixel(null,null,t)){return}this._pointerData[t.id].isDown=true;this._pointerData[t.id].isUp=false;this._pointerData[t.id].timeDown=this.game.time.time;if(this.sprite&&this.sprite.events){this.sprite.events.onInputDown$dispatch(this.sprite,t)}t.dirty=true;if(this.draggable&&this.isDragged===false){this.startDrag(t)}if(this.bringToTop){this.sprite.bringToTop()}}return this.consumePointerEvent},_releasedHandler:function(t){if(this.sprite===null){return}if(this._pointerData[t.id].isDown&&t.isUp){this._pointerData[t.id].isDown=false;this._pointerData[t.id].isUp=true;this._pointerData[t.id].timeUp=this.game.time.time;this._pointerData[t.id].downDuration=this._pointerData[t.id].timeUp-this._pointerData[t.id].timeDown;if(this.checkPointerOver(t)){if(this.sprite&&this.sprite.events){this.sprite.events.onInputUp$dispatch(this.sprite,t,true)}}else{if(this.sprite&&this.sprite.events){this.sprite.events.onInputUp$dispatch(this.sprite,t,false)}if(this.useHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}}t.dirty=true;if(this.draggable&&this.isDragged&&this._draggedPointerID===t.id){this.stopDrag(t)}}},updateDrag:function(t){if(t.isUp){this.stopDrag(t);return false}var e=this.globalToLocalX(t.x)+this._dragPoint.x+this.dragOffset.x;var i=this.globalToLocalY(t.y)+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera){if(this.allowHorizontalDrag){this.sprite.cameraOffset.x=e}if(this.allowVerticalDrag){this.sprite.cameraOffset.y=i}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY}}else{if(this.allowHorizontalDrag){this.sprite.x=e}if(this.allowVerticalDrag){this.sprite.y=i}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY}}return true},justOver:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isOver&&this.overDuration(t)<e},justOut:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isOut&&this.game.time.time-this._pointerData[t].timeOut<e},justPressed:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isDown&&this.downDuration(t)<e},justReleased:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isUp&&this.game.time.time-this._pointerData[t].timeUp<e},overDuration:function(t){t=t||0;if(this._pointerData[t].isOver){return this.game.time.time-this._pointerData[t].timeOver}return-1},downDuration:function(t){t=t||0;if(this._pointerData[t].isDown){return this.game.time.time-this._pointerData[t].timeDown}return-1},enableDrag:function(t,e,i,s,n,r){if(typeof t==="undefined"){t=false}if(typeof e==="undefined"){e=false}if(typeof i==="undefined"){i=false}if(typeof s==="undefined"){s=255}if(typeof n==="undefined"){n=null}if(typeof r==="undefined"){r=null}this._dragPoint=new L.Point;this.draggable=true;this.bringToTop=e;this.dragOffset=new L.Point;this.dragFromCenter=t;this.pixelPerfectClick=i;this.pixelPerfectAlpha=s;if(n){this.boundsRect=n}if(r){this.boundsSprite=r}},disableDrag:function(){if(this._pointerData){for(var t=0;t<10;t++){this._pointerData[t].isDragged=false}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1},startDrag:function(t){var e=this.sprite.x;var i=this.sprite.y;this.isDragged=true;this._draggedPointerID=t.id;this._pointerData[t.id].isDragged=true;if(this.sprite.fixedToCamera){if(this.dragFromCenter){this.sprite.centerOn(t.x,t.y);this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y)}else{this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y)}}else{if(this.dragFromCenter){var s=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(t.x)+(this.sprite.x-s.centerX);this.sprite.y=this.globalToLocalY(t.y)+(this.sprite.y-s.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(t.x),this.sprite.y-this.globalToLocalY(t.y))}this.updateDrag(t);if(this.bringToTop){this._dragPhase=true;this.sprite.bringToTop()}this.dragStartPoint.set(e,i);this.sprite.events.onDragStart$dispatch(this.sprite,t,e,i)},globalToLocalX:function(t){if(this.scaleLayer){t-=this.game.scale.grid.boundsFluid.x;t*=this.game.scale.grid.scaleFluidInversed.x}return t},globalToLocalY:function(t){if(this.scaleLayer){t-=this.game.scale.grid.boundsFluid.y;t*=this.game.scale.grid.scaleFluidInversed.y}return t},stopDrag:function(t){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[t.id].isDragged=false;this._dragPhase=false;if(this.snapOnRelease){if(this.sprite.fixedToCamera){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY}else{this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY}}this.sprite.events.onDragStop$dispatch(this.sprite,t);if(this.checkPointerOver(t)===false){this._pointerOutHandler(t)}},setDragLock:function(t,e){if(typeof t==="undefined"){t=true}if(typeof e==="undefined"){e=true}this.allowHorizontalDrag=t;this.allowVerticalDrag=e},enableSnap:function(t,e,i,s,n,r){if(typeof i==="undefined"){i=true}if(typeof s==="undefined"){s=false}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}this.snapX=t;this.snapY=e;this.snapOffsetX=n;this.snapOffsetY=r;this.snapOnDrag=i;this.snapOnRelease=s},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false},checkBoundsRect:function(){if(this.sprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsRect.left){this.sprite.cameraOffset.x=this.boundsRect.left}else if(this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right){this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width}if(this.sprite.cameraOffset.y<this.boundsRect.top){this.sprite.cameraOffset.y=this.boundsRect.top}else if(this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom){this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height}}else{if(this.sprite.left<this.boundsRect.left){this.sprite.x=this.boundsRect.x+this.sprite.offsetX}else if(this.sprite.right>this.boundsRect.right){this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)}if(this.sprite.top<this.boundsRect.top){this.sprite.y=this.boundsRect.top+this.sprite.offsetY}else if(this.sprite.bottom>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)}}},checkBoundsSprite:function(){if(this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x}else if(this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width}if(this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y}else if(this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height}}else{if(this.sprite.left<this.boundsSprite.left){this.sprite.x=this.boundsSprite.left+this.sprite.offsetX}else if(this.sprite.right>this.boundsSprite.right){this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)}if(this.sprite.top<this.boundsSprite.top){this.sprite.y=this.boundsSprite.top+this.sprite.offsetY}else if(this.sprite.bottom>this.boundsSprite.bottom){this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)}}}};L.InputHandler.prototype.constructor=L.InputHandler;L.Gamepad=function(t){this.game=t;this._gamepadIndexMap={};this._rawPads=[];this._active=false;this.enabled=true;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||navigator.userAgent.indexOf("Firefox/")!=-1||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new L.SinglePad(t,this),new L.SinglePad(t,this),new L.SinglePad(t,this),new L.SinglePad(t,this)]};L.Gamepad.prototype={addCallbacks:function(t,e){if(typeof e!=="undefined"){this.onConnectCallback=typeof e.onConnect==="function"?e.onConnect:this.onConnectCallback;this.onDisconnectCallback=typeof e.onDisconnect==="function"?e.onDisconnect:this.onDisconnectCallback;this.onDownCallback=typeof e.onDown==="function"?e.onDown:this.onDownCallback;this.onUpCallback=typeof e.onUp==="function"?e.onUp:this.onUpCallback;this.onAxisCallback=typeof e.onAxis==="function"?e.onAxis:this.onAxisCallback;this.onFloatCallback=typeof e.onFloat==="function"?e.onFloat:this.onFloatCallback;this.callbackContext=t}},start:function(){if(this._active){return}this._active=true;var e=this;this._onGamepadConnected=function(t){return e.onGamepadConnected(t)};this._onGamepadDisconnected=function(t){return e.onGamepadDisconnected(t)};window.addEventListener("gamepadconnected",this._onGamepadConnected,false);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,false)},onGamepadConnected:function(t){var e=t.gamepad;this._rawPads.push(e);this._gamepads[e.index].connect(e)},onGamepadDisconnected:function(t){var e=t.gamepad;for(var i in this._rawPads){if(this._rawPads[i].index===e.index){this._rawPads.splice(i,1)}}this._gamepads[e.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(navigator["getGamepads"]){var t=navigator.getGamepads()}else if(navigator["webkitGetGamepads"]){var t=navigator.webkitGetGamepads()}else if(navigator["webkitGamepads"]){var t=navigator.webkitGamepads()}if(t){this._rawPads=[];var e=false;for(var i=0;i<t.length;i++){if(typeof t[i]!==this._prevRawGamepadTypes[i]){e=true;this._prevRawGamepadTypes[i]=typeof t[i]}if(t[i]){this._rawPads.push(t[i])}if(i===3){break}}if(e){var s={rawIndices:{},padIndices:{}};var n;for(var r=0;r<this._gamepads.length;r++){n=this._gamepads[r];if(n.connected){for(var a=0;a<this._rawPads.length;a++){if(this._rawPads[a].index===n.index){s.rawIndices[n.index]=true;s.padIndices[r]=true}}}}for(var o=0;o<this._gamepads.length;o++){n=this._gamepads[o];if(s.padIndices[o]){continue}if(this._rawPads.length<1){n.disconnect()}for(var h=0;h<this._rawPads.length;h++){if(s.padIndices[o]){break}var l=this._rawPads[h];if(l){if(s.rawIndices[l.index]){n.disconnect();continue}else{n.connect(l);s.rawIndices[l.index]=true;s.padIndices[o]=true}}else{n.disconnect()}}}}}},setDeadZones:function(t){for(var e=0;e<this._gamepads.length;e++){this._gamepads[e].deadZone=t}},stop:function(){this._active=false;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var t=0;t<this._gamepads.length;t++){this._gamepads[t].reset()}},justPressed:function(t,e){for(var i=0;i<this._gamepads.length;i++){if(this._gamepads[i].justPressed(t,e)===true){return true}}return false},justReleased:function(t,e){for(var i=0;i<this._gamepads.length;i++){if(this._gamepads[i].justReleased(t,e)===true){return true}}return false},isDown:function(t){for(var e=0;e<this._gamepads.length;e++){if(this._gamepads[e].isDown(t)===true){return true}}return false},destroy:function(){this.stop();for(var t=0;t<this._gamepads.length;t++){this._gamepads[t].destroy()}}};L.Gamepad.prototype.constructor=L.Gamepad;Object.defineProperty(L.Gamepad.prototype,"disabled",{get:function(){return!this.enabled},set:function(t){this.enabled=!t}});Object.defineProperty(L.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(L.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(L.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(L.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(L.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(L.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(L.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});L.Gamepad.BUTTON_0=0;L.Gamepad.BUTTON_1=1;L.Gamepad.BUTTON_2=2;L.Gamepad.BUTTON_3=3;L.Gamepad.BUTTON_4=4;L.Gamepad.BUTTON_5=5;L.Gamepad.BUTTON_6=6;L.Gamepad.BUTTON_7=7;L.Gamepad.BUTTON_8=8;L.Gamepad.BUTTON_9=9;L.Gamepad.BUTTON_10=10;L.Gamepad.BUTTON_11=11;L.Gamepad.BUTTON_12=12;L.Gamepad.BUTTON_13=13;L.Gamepad.BUTTON_14=14;L.Gamepad.BUTTON_15=15;L.Gamepad.AXIS_0=0;L.Gamepad.AXIS_1=1;L.Gamepad.AXIS_2=2;L.Gamepad.AXIS_3=3;L.Gamepad.AXIS_4=4;L.Gamepad.AXIS_5=5;L.Gamepad.AXIS_6=6;L.Gamepad.AXIS_7=7;L.Gamepad.AXIS_8=8;L.Gamepad.AXIS_9=9;L.Gamepad.XBOX360_A=0;L.Gamepad.XBOX360_B=1;L.Gamepad.XBOX360_X=2;L.Gamepad.XBOX360_Y=3;L.Gamepad.XBOX360_LEFT_BUMPER=4;L.Gamepad.XBOX360_RIGHT_BUMPER=5;L.Gamepad.XBOX360_LEFT_TRIGGER=6;L.Gamepad.XBOX360_RIGHT_TRIGGER=7;L.Gamepad.XBOX360_BACK=8;L.Gamepad.XBOX360_START=9;L.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;L.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;L.Gamepad.XBOX360_DPAD_LEFT=14;L.Gamepad.XBOX360_DPAD_RIGHT=15;L.Gamepad.XBOX360_DPAD_UP=12;L.Gamepad.XBOX360_DPAD_DOWN=13;L.Gamepad.XBOX360_STICK_LEFT_X=0;L.Gamepad.XBOX360_STICK_LEFT_Y=1;L.Gamepad.XBOX360_STICK_RIGHT_X=2;L.Gamepad.XBOX360_STICK_RIGHT_Y=3;L.Gamepad.PS3XC_X=0;L.Gamepad.PS3XC_CIRCLE=1;L.Gamepad.PS3XC_SQUARE=2;L.Gamepad.PS3XC_TRIANGLE=3;L.Gamepad.PS3XC_L1=4;L.Gamepad.PS3XC_R1=5;L.Gamepad.PS3XC_L2=6;L.Gamepad.PS3XC_R2=7;L.Gamepad.PS3XC_SELECT=8;L.Gamepad.PS3XC_START=9;L.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;L.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;L.Gamepad.PS3XC_DPAD_UP=12;L.Gamepad.PS3XC_DPAD_DOWN=13;L.Gamepad.PS3XC_DPAD_LEFT=14;L.Gamepad.PS3XC_DPAD_RIGHT=15;L.Gamepad.PS3XC_STICK_LEFT_X=0;L.Gamepad.PS3XC_STICK_LEFT_Y=1;L.Gamepad.PS3XC_STICK_RIGHT_X=2;L.Gamepad.PS3XC_STICK_RIGHT_Y=3;L.SinglePad=function(t,e){this.game=t;this.index=null;this.connected=false;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=.26;this._padParent=e;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};L.SinglePad.prototype={addCallbacks:function(t,e){if(typeof e!=="undefined"){this.onConnectCallback=typeof e.onConnect==="function"?e.onConnect:this.onConnectCallback;this.onDisconnectCallback=typeof e.onDisconnect==="function"?e.onDisconnect:this.onDisconnectCallback;this.onDownCallback=typeof e.onDown==="function"?e.onDown:this.onDownCallback;this.onUpCallback=typeof e.onUp==="function"?e.onUp:this.onUpCallback;this.onAxisCallback=typeof e.onAxis==="function"?e.onAxis:this.onAxisCallback;this.onFloatCallback=typeof e.onFloat==="function"?e.onFloat:this.onFloatCallback}},getButton:function(t){if(this._buttons[t]){return this._buttons[t]}else{return null}},pollStatus:function(){if(!this.connected||!this.game.input.enabled||!this.game.input.gamepad.enabled||this._rawPad.timestamp&&this._rawPad.timestamp===this._prevTimestamp){return}for(var t=0;t<this._buttonsLen;t++){var e=isNaN(this._rawPad.buttons[t])?this._rawPad.buttons[t].value:this._rawPad.buttons[t];if(e!==this._buttons[t].value){if(e===1){this.processButtonDown(t,e)}else if(e===0){this.processButtonUp(t,e)}else{this.processButtonFloat(t,e)}}}for(var i=0;i<this._axesLen;i++){var s=this._rawPad.axes[i];if(s>0&&s>this.deadZone||s<0&&s<-this.deadZone){this.processAxisChange(i,s)}else{this.processAxisChange(i,0)}}this._prevTimestamp=this._rawPad.timestamp},connect:function(t){var e=!this.connected;this.connected=true;this.index=t.index;this._rawPad=t;this._buttons=[];this._buttonsLen=t.buttons.length;this._axes=[];this._axesLen=t.axes.length;for(var i=0;i<this._axesLen;i++){this._axes[i]=t.axes[i]}for(var s in t.buttons){s=parseInt(s,10);this._buttons[s]=new L.GamepadButton(this,s)}if(e&&this._padParent.onConnectCallback){this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index)}if(e&&this.onConnectCallback){this.onConnectCallback.call(this.callbackContext)}},disconnect:function(){var t=this.connected;var e=this.index;this.connected=false;this.index=null;this._rawPad=undefined;for(var i=0;i<this._buttonsLen;i++){this._buttons[i].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;if(t&&this._padParent.onDisconnectCallback){this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,e)}if(t&&this.onDisconnectCallback){this.onDisconnectCallback.call(this.callbackContext)}},destroy:function(){this._rawPad=undefined;for(var t=0;t<this._buttonsLen;t++){this._buttons[t].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null},processAxisChange:function(t,e){if(this._axes[t]===e){return}this._axes[t]=e;if(this._padParent.onAxisCallback){this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,t,e)}if(this.onAxisCallback){this.onAxisCallback.call(this.callbackContext,this,t,e)}},processButtonDown:function(t,e){if(this._padParent.onDownCallback){this._padParent.onDownCallback.call(this._padParent.callbackContext,t,e,this.index)}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,t,e)}if(this._buttons[t]){this._buttons[t].processButtonDown(e)}},processButtonUp:function(t,e){if(this._padParent.onUpCallback){this._padParent.onUpCallback.call(this._padParent.callbackContext,t,e,this.index)}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,t,e)}if(this._buttons[t]){this._buttons[t].processButtonUp(e)}},processButtonFloat:function(t,e){if(this._padParent.onFloatCallback){this._padParent.onFloatCallback.call(this._padParent.callbackContext,t,e,this.index)}if(this.onFloatCallback){this.onFloatCallback.call(this.callbackContext,t,e)}if(this._buttons[t]){this._buttons[t].processButtonFloat(e)}},axis:function(t){if(this._axes[t]){return this._axes[t]}return false},isDown:function(t){if(this._buttons[t]){return this._buttons[t].isDown}return false},isUp:function(t){if(this._buttons[t]){return this._buttons[t].isUp}return false},justReleased:function(t,e){if(this._buttons[t]){return this._buttons[t].justReleased(e)}},justPressed:function(t,e){if(this._buttons[t]){return this._buttons[t].justPressed(e)}},buttonValue:function(t){if(this._buttons[t]){return this._buttons[t].value}return null},reset:function(){for(var t=0;t<this._axes.length;t++){this._axes[t]=0}}};L.SinglePad.prototype.constructor=L.SinglePad;L.GamepadButton=function(t,e){this.pad=t;this.game=t.game;this.isDown=false;this.isUp=true;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this.value=0;this.buttonCode=e;this.onDown=new L.Signal;this.onUp=new L.Signal;this.onFloat=new L.Signal};L.GamepadButton.prototype={processButtonDown:function(t){this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0;this.value=t;this.onDown.dispatch(this,t)},processButtonUp:function(t){this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.value=t;this.onUp.dispatch(this,t)},processButtonFloat:function(t){this.value=t;this.onFloat.dispatch(this,t)},justPressed:function(t){t=t||250;return this.isDown===true&&this.timeDown+t>this.game.time.time},justReleased:function(t){t=t||250;return this.isUp===true&&this.timeUp+t>this.game.time.time},reset:function(){this.isDown=false;this.isUp=true;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.pad=null;this.game=null}};L.GamepadButton.prototype.constructor=L.GamepadButton;L.Key=function(t,e){this.game=t;this._enabled=true;this.event=null;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.repeats=0;this.keyCode=e;this.onDown=new L.Signal;this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new L.Signal;this._justDown=false;this._justUp=false};L.Key.prototype={update:function(){if(!this._enabled){return}if(this.isDown){this.duration=this.game.time.time-this.timeDown;this.repeats++;if(this.onHoldCallback){this.onHoldCallback.call(this.onHoldContext,this)}}},processKeyDown:function(t){if(!this._enabled){return}this.event=t;if(this.isDown){return}this.altKey=t.altKey;this.ctrlKey=t.ctrlKey;this.shiftKey=t.shiftKey;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0;this._justDown=true;this.onDown.dispatch(this)},processKeyUp:function(t){if(!this._enabled){return}this.event=t;if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=this.game.time.time-this.timeDown;this._justUp=true;this.onUp.dispatch(this)},reset:function(t){if(typeof t==="undefined"){t=true}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=0;this._enabled=true;this._justDown=false;this._justUp=false;if(t){this.onDown.removeAll();this.onUp.removeAll();this.onHoldCallback=null;this.onHoldContext=null}},downDuration:function(t){if(typeof t==="undefined"){t=50}return this.isDown&&this.duration<t},upDuration:function(t){if(typeof t==="undefined"){t=50}return!this.isDown&&this.game.time.time-this.timeUp<t}};Object.defineProperty(L.Key.prototype,"justDown",{get:function(){var t=this._justDown;this._justDown=false;return t}});Object.defineProperty(L.Key.prototype,"justUp",{get:function(){var t=this._justUp;this._justUp=false;return t}});Object.defineProperty(L.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(t){t=!!t;if(t!==this._enabled){if(!t){this.reset(false)}this._enabled=t}}});L.Key.prototype.constructor=L.Key;L.Keyboard=function(t){this.game=t;this.enabled=true;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};L.Keyboard.prototype={addCallbacks:function(t,e,i,s){this.callbackContext=t;if(typeof e!=="undefined"){this.onDownCallback=e}if(typeof i!=="undefined"){this.onUpCallback=i}if(typeof s!=="undefined"){this.onPressCallback=s}},addKey:function(t){if(!this._keys[t]){this._keys[t]=new L.Key(this.game,t);this.addKeyCapture(t)}return this._keys[t]},removeKey:function(t){if(this._keys[t]){this._keys[t]=null;this.removeKeyCapture(t)}},createCursorKeys:function(){return{up:this.addKey(L.Keyboard.UP),down:this.addKey(L.Keyboard.DOWN),left:this.addKey(L.Keyboard.LEFT),right:this.addKey(L.Keyboard.RIGHT)}},start:function(){if(this.game.device.cocoonJS){return}if(this._onKeyDown!==null){return}var e=this;this._onKeyDown=function(t){return e.processKeyDown(t)};this._onKeyUp=function(t){return e.processKeyUp(t)};this._onKeyPress=function(t){return e.processKeyPress(t)};window.addEventListener("keydown",this._onKeyDown,false);window.addEventListener("keyup",this._onKeyUp,false);window.addEventListener("keypress",this._onKeyPress,false)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(t){if(typeof t==="object"){for(var e in t){this._capture[t[e]]=true}}else{this._capture[t]=true}},removeKeyCapture:function(t){delete this._capture[t]},clearCaptures:function(){this._capture={}},update:function(){this._i=this._keys.length;while(this._i--){if(this._keys[this._i]){this._keys[this._i].update()}}},processKeyDown:function(t){this.event=t;if(!this.game.input.enabled||!this.enabled){return}if(this._capture[t.keyCode]){t.preventDefault()}if(!this._keys[t.keyCode]){this._keys[t.keyCode]=new L.Key(this.game,t.keyCode)}this._keys[t.keyCode].processKeyDown(t);this._k=t.keyCode;if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,t)}},processKeyPress:function(t){this.pressEvent=t;if(!this.game.input.enabled||!this.enabled){return}if(this.onPressCallback){this.onPressCallback.call(this.callbackContext,String.fromCharCode(t.charCode),t)}},processKeyUp:function(t){this.event=t;if(!this.game.input.enabled||!this.enabled){return}if(this._capture[t.keyCode]){t.preventDefault()}if(!this._keys[t.keyCode]){this._keys[t.keyCode]=new L.Key(this.game,t.keyCode)}this._keys[t.keyCode].processKeyUp(t);if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,t)}},reset:function(t){if(typeof t==="undefined"){t=true}this.event=null;var e=this._keys.length;while(e--){if(this._keys[e]){this._keys[e].reset(t)}}},downDuration:function(t,e){if(this._keys[t]){return this._keys[t].downDuration(e)}else{return null}},upDuration:function(t,e){if(this._keys[t]){return this._keys[t].upDuration(e)}else{return null}},isDown:function(t){if(this._keys[t]){return this._keys[t].isDown}else{return null}}};Object.defineProperty(L.Keyboard.prototype,"disabled",{get:function(){return!this.enabled},set:function(t){this.enabled=!t}});Object.defineProperty(L.Keyboard.prototype,"lastChar",{get:function(){if(this.event.charCode===32){return""}else{return String.fromCharCode(this.pressEvent.charCode)}}});Object.defineProperty(L.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});L.Keyboard.prototype.constructor=L.Keyboard;L.Keyboard.A="A".charCodeAt(0);L.Keyboard.B="B".charCodeAt(0);L.Keyboard.C="C".charCodeAt(0);L.Keyboard.D="D".charCodeAt(0);L.Keyboard.E="E".charCodeAt(0);L.Keyboard.F="F".charCodeAt(0);L.Keyboard.G="G".charCodeAt(0);L.Keyboard.H="H".charCodeAt(0);L.Keyboard.I="I".charCodeAt(0);L.Keyboard.J="J".charCodeAt(0);L.Keyboard.K="K".charCodeAt(0);L.Keyboard.L="L".charCodeAt(0);L.Keyboard.M="M".charCodeAt(0);L.Keyboard.N="N".charCodeAt(0);L.Keyboard.O="O".charCodeAt(0);L.Keyboard.P="P".charCodeAt(0);L.Keyboard.Q="Q".charCodeAt(0);L.Keyboard.R="R".charCodeAt(0);L.Keyboard.S="S".charCodeAt(0);L.Keyboard.T="T".charCodeAt(0);L.Keyboard.U="U".charCodeAt(0);L.Keyboard.V="V".charCodeAt(0);L.Keyboard.W="W".charCodeAt(0);L.Keyboard.X="X".charCodeAt(0);L.Keyboard.Y="Y".charCodeAt(0);L.Keyboard.Z="Z".charCodeAt(0);L.Keyboard.ZERO="0".charCodeAt(0);L.Keyboard.ONE="1".charCodeAt(0);L.Keyboard.TWO="2".charCodeAt(0);L.Keyboard.THREE="3".charCodeAt(0);L.Keyboard.FOUR="4".charCodeAt(0);L.Keyboard.FIVE="5".charCodeAt(0);L.Keyboard.SIX="6".charCodeAt(0);L.Keyboard.SEVEN="7".charCodeAt(0);L.Keyboard.EIGHT="8".charCodeAt(0);L.Keyboard.NINE="9".charCodeAt(0);L.Keyboard.NUMPAD_0=96;L.Keyboard.NUMPAD_1=97;L.Keyboard.NUMPAD_2=98;L.Keyboard.NUMPAD_3=99;L.Keyboard.NUMPAD_4=100;L.Keyboard.NUMPAD_5=101;L.Keyboard.NUMPAD_6=102;L.Keyboard.NUMPAD_7=103;L.Keyboard.NUMPAD_8=104;L.Keyboard.NUMPAD_9=105;L.Keyboard.NUMPAD_MULTIPLY=106;L.Keyboard.NUMPAD_ADD=107;L.Keyboard.NUMPAD_ENTER=108;L.Keyboard.NUMPAD_SUBTRACT=109;L.Keyboard.NUMPAD_DECIMAL=110;L.Keyboard.NUMPAD_DIVIDE=111;L.Keyboard.F1=112;L.Keyboard.F2=113;L.Keyboard.F3=114;L.Keyboard.F4=115;L.Keyboard.F5=116;L.Keyboard.F6=117;L.Keyboard.F7=118;L.Keyboard.F8=119;L.Keyboard.F9=120;L.Keyboard.F10=121;L.Keyboard.F11=122;L.Keyboard.F12=123;L.Keyboard.F13=124;L.Keyboard.F14=125;L.Keyboard.F15=126;L.Keyboard.COLON=186;L.Keyboard.EQUALS=187;L.Keyboard.UNDERSCORE=189;L.Keyboard.QUESTION_MARK=191;L.Keyboard.TILDE=192;L.Keyboard.OPEN_BRACKET=219;L.Keyboard.BACKWARD_SLASH=220;L.Keyboard.CLOSED_BRACKET=221;L.Keyboard.QUOTES=222;L.Keyboard.BACKSPACE=8;L.Keyboard.TAB=9;L.Keyboard.CLEAR=12;L.Keyboard.ENTER=13;L.Keyboard.SHIFT=16;L.Keyboard.CONTROL=17;L.Keyboard.ALT=18;L.Keyboard.CAPS_LOCK=20;L.Keyboard.ESC=27;L.Keyboard.SPACEBAR=32;L.Keyboard.PAGE_UP=33;L.Keyboard.PAGE_DOWN=34;L.Keyboard.END=35;L.Keyboard.HOME=36;L.Keyboard.LEFT=37;L.Keyboard.UP=38;L.Keyboard.RIGHT=39;L.Keyboard.DOWN=40;L.Keyboard.INSERT=45;L.Keyboard.DELETE=46;L.Keyboard.HELP=47;L.Keyboard.NUM_LOCK=144;L.Keyboard.PLUS=43;L.Keyboard.MINUS=45;L.Component=function(){};L.Component.Angle=function(){};L.Component.Angle.prototype={angle:{get:function(){return L.Math.wrapAngle(L.Math.radToDeg(this.rotation))},set:function(t){this.rotation=L.Math.degToRad(L.Math.wrapAngle(t))}}};L.Component.Animation=function(){};L.Component.Animation.prototype={play:function(t,e,i,s){if(this.animations){return this.animations.play(t,e,i,s)}}};L.Component.AutoCull=function(){};L.Component.AutoCull.prototype={autoCull:false,inCamera:{get:function(){if(!this.autoCull&&!this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y}return this.game.world.camera.view.intersects(this._bounds)}}};L.Component.Bounds=function(){};L.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},left:{get:function(){return this.x-this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX}},top:{get:function(){return this.y-this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY}}};L.Component.BringToTop=function(){};L.Component.BringToTop.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};L.Component.BringToTop.prototype.sendToBack=function(){if(this.parent){this.parent.sendToBack(this)}return this};L.Component.BringToTop.prototype.moveUp=function(){if(this.parent){this.parent.moveUp(this)}return this};L.Component.BringToTop.prototype.moveDown=function(){if(this.parent){this.parent.moveDown(this)}return this};L.Component.Core=function(){};L.Component.Core.install=function(t){L.Utils.mixinPrototype(this,L.Component.Core.prototype);this.components={};for(var e=0;e<t.length;e++){var i=t[e];var s=false;if(i==="Destroy"){s=true}L.Utils.mixinPrototype(this,L.Component[i].prototype,s);this.components[i]=true}};L.Component.Core.init=function(t,e,i,s,n){this.game=t;this.key=s;this.position.set(e,i);this.world=new L.Point(e,i);this.previousPosition=new L.Point(e,i);this.events=new L.Events(this);this._bounds=new L.Rectangle;if(this.components.PhysicsBody){this.body=this.body}if(this.components.Animation){this.animations=new L.AnimationManager(this)}if(this.components.LoadTexture&&s!==null){this.loadTexture(s,n)}if(this.components.FixedToCamera){this.cameraOffset=new L.Point(e,i)}};L.Component.Core.preUpdate=function(){this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this.renderOrderID=this.game.stage.currentRenderOrderID++}if(this.animations){this.animations.update()}if(this.body){this.body.preUpdate()}for(var t=0;t<this.children.length;t++){this.children[t].preUpdate()}return true};L.Component.Core.prototype={game:null,name:"",components:{},z:0,events:undefined,animations:undefined,key:"",world:null,debug:false,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:true,_bounds:null,_exists:true,exists:{get:function(){return this._exists},set:function(t){if(t){this._exists=true;if(this.body&&this.body.type===L.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._exists=false;if(this.body&&this.body.type===L.Physics.P2JS){this.body.removeFromWorld()}this.visible=false}}},update:function(){},postUpdate:function(){if(this.key instanceof L.BitmapData){this.key.render()}if(this.components.PhysicsBody){L.Component.PhysicsBody.postUpdate.call(this)}if(this.components.FixedToCamera){L.Component.FixedToCamera.postUpdate.call(this)}for(var t=0;t<this.children.length;t++){this.children[t].postUpdate()}}};L.Component.Crop=function(){};L.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(t,e){if(typeof e==="undefined"){e=false}if(t){if(e&&this.cropRect!==null){this.cropRect.setTo(t.x,t.y,t.width,t.height)}else if(e&&this.cropRect===null){this.cropRect=new L.Rectangle(t.x,t.y,t.width,t.height)}else{this.cropRect=t}this.updateCrop()}else{this._crop=null;this.cropRect=null;this.resetFrame()}},updateCrop:function(){if(!this.cropRect){return}this._crop=L.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var t=Math.max(this._frame.x,this._crop.x);var e=Math.max(this._frame.y,this._crop.y);var i=Math.min(this._frame.right,this._crop.right)-t;var s=Math.min(this._frame.bottom,this._crop.bottom)-e;this.texture.crop.x=t;this.texture.crop.y=e;this.texture.crop.width=i;this.texture.crop.height=s;this.texture.frame.width=Math.min(i,this.cropRect.width);this.texture.frame.height=Math.min(s,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs()}};L.Component.Delta=function(){};L.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}};L.Component.Destroy=function(){};L.Component.Destroy.prototype={destroyPhase:false,destroy:function(t){if(this.game===null||this.destroyPhase){return}if(typeof t==="undefined"){t=true}this.destroyPhase=true;if(this.events){this.events.onDestroy$dispatch(this)}if(this.parent){if(this.parent instanceof L.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.input){this.input.destroy()}if(this.animations){this.animations.destroy()}if(this.body){this.body.destroy()}if(this.events){this.events.destroy()}var e=this.children.length;if(t){while(e--){this.children[e].destroy(t)}}else{while(e--){this.removeChild(this.children[e])}}if(this._crop){this._crop=null}if(this._frame){this._frame=null}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this.renderable=false;this.transformCallback=null;this.transformCallbackContext=null;this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();this.destroyPhase=false}};L.Events=function(t){this.parent=t};L.Events.prototype={destroy:function(){this._parent=null;if(this._onDestroy){this._onDestroy.dispose()}if(this._onAddedToGroup){this._onAddedToGroup.dispose()}if(this._onRemovedFromGroup){this._onRemovedFromGroup.dispose()}if(this._onRemovedFromWorld){this._onRemovedFromWorld.dispose()}if(this._onKilled){this._onKilled.dispose()}if(this._onRevived){this._onRevived.dispose()}if(this._onEnterBounds){this._onEnterBounds.dispose()}if(this._onOutOfBounds){this._onOutOfBounds.dispose()}if(this._onInputOver){this._onInputOver.dispose()}if(this._onInputOut){this._onInputOut.dispose()}if(this._onInputDown){this._onInputDown.dispose()}if(this._onInputUp){this._onInputUp.dispose()}if(this._onDragStart){this._onDragStart.dispose()}if(this._onDragStop){this._onDragStop.dispose()}if(this._onAnimationStart){this._onAnimationStart.dispose()}if(this._onAnimationComplete){this._onAnimationComplete.dispose()}if(this._onAnimationLoop){this._onAnimationLoop.dispose()}},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};L.Events.prototype.constructor=L.Events;for(var i in L.Events.prototype){if(!L.Events.prototype.hasOwnProperty(i)||i.indexOf("on")!==0||L.Events.prototype[i]!==null){continue}(function(t,e){"use strict";Object.defineProperty(L.Events.prototype,t,{get:function(){return this[e]||(this[e]=new L.Signal)}});L.Events.prototype[t+"$dispatch"]=function(){return this[e]?this[e].dispatch.apply(this[e],arguments):null}})(i,"_"+i)}L.Component.FixedToCamera=function(){};L.Component.FixedToCamera.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};L.Component.FixedToCamera.prototype={_fixedToCamera:false,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(t){if(t){this._fixedToCamera=true;this.cameraOffset.set(this.x,this.y)}else{this._fixedToCamera=false}}},cameraOffset:new L.Point};L.Component.Health=function(){};L.Component.Health.prototype={health:1,damage:function(t){if(this.alive){this.health-=t;if(this.health<=0){this.kill()}}return this}};L.Component.InCamera=function(){};L.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};L.Component.InputEnabled=function(){};L.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(t){if(t){if(this.input===null){this.input=new L.InputHandler(this);this.input.start()}else if(this.input&&!this.input.enabled){this.input.start()}}else{if(this.input&&this.input.enabled){this.input.stop()}}}}};L.Component.InWorld=function(){};L.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y;if(this.autoCull){if(this.game.world.camera.view.intersects(this._bounds)){this.renderable=true;this.game.world.camera.totalInView++}else{this.renderable=false}}if(this.checkWorldBounds){if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=false;this.events.onEnterBounds$dispatch(this)}else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=true;this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill){this.kill();return false}}}}return true};L.Component.InWorld.prototype={checkWorldBounds:false,outOfBoundsKill:false,_outOfBoundsFired:false,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};L.Component.LifeSpan=function(){};L.Component.LifeSpan.preUpdate=function(){if(this.lifespan>0){this.lifespan-=this.game.time.physicsElapsedMS;if(this.lifespan<=0){this.kill();return false}}return true};L.Component.LifeSpan.prototype={alive:true,lifespan:0,revive:function(t){if(typeof t==="undefined"){t=1}this.alive=true;this.exists=true;this.visible=true;if(typeof this.health==="number"){this.health=t}if(this.events){this.events.onRevived$dispatch(this)}return this},kill:function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled$dispatch(this)}return this}};L.Component.LoadTexture=function(){};L.Component.LoadTexture.prototype={_frame:null,loadTexture:function(t,e,i){e=e||0;if((i||typeof i==="undefined")&&this.animations){this.animations.stop()}this.key=t;var s=true;var n=!this.texture.baseTexture.scaleMode;if(L.RenderTexture&&t instanceof L.RenderTexture){this.key=t.key;this.setTexture(t)}else if(L.BitmapData&&t instanceof L.BitmapData){this.setTexture(t.texture);if(this.game.cache.getFrameData(t.key,L.Cache.BITMAPDATA)){s=!this.animations.loadFrameData(this.game.cache.getFrameData(t.key,L.Cache.BITMAPDATA),e)}}else if(t instanceof PIXI.Texture){this.setTexture(t)}else{if(t===null||typeof t==="undefined"){this.key="__default";this.setTexture(PIXI.TextureCache[this.key])}else if(typeof t==="string"&&!this.game.cache.checkImageKey(t)){console.warn("Texture with key '"+t+"' not found.");this.key="__missing";this.setTexture(PIXI.TextureCache[this.key])}else{this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[t]));s=!this.animations.loadFrameData(this.game.cache.getFrameData(t),e)}}if(s){this._frame=L.Rectangle.clone(this.texture.frame)}if(!n){this.texture.baseTexture.scaleMode=1}},setFrame:function(t){this._frame=t;this.texture.frame.x=t.x;this.texture.frame.y=t.y;this.texture.frame.width=t.width;this.texture.frame.height=t.height;this.texture.crop.x=t.x;this.texture.crop.y=t.y;this.texture.crop.width=t.width;this.texture.crop.height=t.height;if(t.trimmed){if(this.texture.trim){this.texture.trim.x=t.spriteSourceSizeX;this.texture.trim.y=t.spriteSourceSizeY;this.texture.trim.width=t.sourceSizeW;this.texture.trim.height=t.sourceSizeH}else{this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH}}this.texture.width=t.sourceSizeW;this.texture.height=t.sourceSizeH;this.texture.frame.width=t.sourceSizeW;this.texture.frame.height=t.sourceSizeH}else if(!t.trimmed&&this.texture.trim){this.texture.trim=null}if(this.cropRect){this.updateCrop()}if(this.tint!==16777215){this.cachedTint=-1}this.texture._updateUvs()},resetFrame:function(){if(this._frame){this.setFrame(this._frame)}},frame:{get:function(){return this.animations.frame},set:function(t){this.animations.frame=t}},frameName:{get:function(){return this.animations.frameName},set:function(t){this.animations.frameName=t}}};L.Component.Overlap=function(){};L.Component.Overlap.prototype={overlap:function(t){return L.Rectangle.intersects(this.getBounds(),t.getBounds())}};L.Component.PhysicsBody=function(){};L.Component.PhysicsBody.preUpdate=function(){if(this.fresh&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(this.body){this.body.preUpdate()}this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this._exists||!this.parent.exists){this.renderOrderID=-1;return false}return true};L.Component.PhysicsBody.postUpdate=function(){if(this.exists&&this.body){this.body.postUpdate()}};L.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(t){this.position.x=t;if(this.body&&!this.body.dirty){this.body._reset=true}}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t;if(this.body&&!this.body.dirty){this.body._reset=true}}}};L.Component.Reset=function(){};L.Component.Reset.prototype.reset=function(t,e,i){if(typeof i==="undefined"){i=1}this.world.set(t,e);this.position.set(t,e);this.fresh=true;this.exists=true;this.visible=true;this.renderable=true;if(this.components.InWorld){this._outOfBoundsFired=false}if(this.components.LifeSpan){this.alive=true;this.health=i}if(this.components.PhysicsBody){if(this.body){this.body.reset(t,e,false,false)}}return this};L.Component.ScaleMinMax=function(){};L.Component.ScaleMinMax.prototype={transformCallback:this.checkTransform,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(t){if(this.scaleMin){if(t.a<this.scaleMin.x){t.a=this.scaleMin.x}if(t.d<this.scaleMin.y){t.d=this.scaleMin.y}}if(this.scaleMax){if(t.a>this.scaleMax.x){t.a=this.scaleMax.x}if(t.d>this.scaleMax.y){t.d=this.scaleMax.y}}},setScaleMinMax:function(t,e,i,s){if(typeof e==="undefined"){e=i=s=t}else if(typeof i==="undefined"){i=s=e;e=t}if(t===null){this.scaleMin=null}else{if(this.scaleMin){this.scaleMin.set(t,e)}else{this.scaleMin=new L.Point(t,e)}}if(i===null){this.scaleMax=null}else{if(this.scaleMax){this.scaleMax.set(i,s)}else{this.scaleMax=new L.Point(i,s)}}}};L.Component.Smoothed=function(){};L.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(t){if(t){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}}};L.GameObjectFactory=function(t){this.game=t;this.world=this.game.world};L.GameObjectFactory.prototype={existing:function(t){return this.world.add(t)},image:function(t,e,i,s,n){if(typeof n==="undefined"){n=this.world}return n.add(new L.Image(this.game,t,e,i,s))},sprite:function(t,e,i,s,n){if(typeof n==="undefined"){n=this.world}return n.create(t,e,i,s)},tween:function(t){return this.game.tweens.create(t)},group:function(t,e,i,s,n){return new L.Group(this.game,t,e,i,s,n)},physicsGroup:function(t,e,i,s){return new L.Group(this.game,e,i,s,true,t)},spriteBatch:function(t,e,i){if(typeof t==="undefined"){t=null}if(typeof e==="undefined"){e="group"}if(typeof i==="undefined"){i=false}return new L.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},sound:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},audioSprite:function(t){return this.game.sound.addSprite(t)},tileSprite:function(t,e,i,s,n,r,a){if(typeof a==="undefined"){a=this.world}return a.add(new L.TileSprite(this.game,t,e,i,s,n,r))},rope:function(t,e,i,s,n,r){if(typeof r==="undefined"){r=this.world}return r.add(new L.Rope(this.game,t,e,i,s,n))},text:function(t,e,i,s,n){if(typeof n==="undefined"){n=this.world}return n.add(new L.Text(this.game,t,e,i,s))},button:function(t,e,i,s,n,r,a,o,h,l){if(typeof l==="undefined"){l=this.world}return l.add(new L.Button(this.game,t,e,i,s,n,r,a,o,h))},graphics:function(t,e,i){if(typeof i==="undefined"){i=this.world}return i.add(new L.Graphics(this.game,t,e))},retroFont:function(t,e,i,s,n,r,a,o,h){return new L.RetroFont(this.game,t,e,i,s,n,r,a,o,h)},bitmapText:function(t,e,i,s,n,r){if(typeof r==="undefined"){r=this.world}return r.add(new L.BitmapText(this.game,t,e,i,s,n))},tilemap:function(t,e,i,s,n){return new L.Tilemap(this.game,t,e,i,s,n)},renderTexture:function(t,e,i,s){if(typeof i==="undefined"||i===""){i=this.game.rnd.uuid()}if(typeof s==="undefined"){s=false}var n=new L.RenderTexture(this.game,t,e,i);if(s){this.game.cache.addRenderTexture(i,n)}return n},bitmapData:function(t,e,i,s){if(typeof s==="undefined"){s=false}if(typeof i==="undefined"||i===""){i=this.game.rnd.uuid()}var n=new L.BitmapData(this.game,i,t,e);if(s){this.game.cache.addBitmapData(i,n)}return n},filter:function(t){var e=Array.prototype.splice.call(arguments,1);var t=new L.Filter[t](this.game);t.init.apply(t,e);return t},plugin:function(t){return this.game.plugins.add(t)}};L.GameObjectFactory.prototype.constructor=L.GameObjectFactory;L.GameObjectCreator=function(t){this.game=t;this.world=this.game.world};L.GameObjectCreator.prototype={image:function(t,e,i,s){return new L.Image(this.game,t,e,i,s)},sprite:function(t,e,i,s){return new L.Sprite(this.game,t,e,i,s)},tween:function(t){return new L.Tween(t,this.game,this.game.tweens)},group:function(t,e,i,s,n){return new L.Group(this.game,null,e,i,s,n)},spriteBatch:function(t,e,i){if(typeof e==="undefined"){e="group"}if(typeof i==="undefined"){i=false}return new L.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},audioSprite:function(t){return this.game.sound.addSprite(t)},sound:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},tileSprite:function(t,e,i,s,n,r){return new L.TileSprite(this.game,t,e,i,s,n,r)},rope:function(t,e,i,s,n){return new L.Rope(this.game,t,e,i,s,n)},text:function(t,e,i,s){return new L.Text(this.game,t,e,i,s)},button:function(t,e,i,s,n,r,a,o,h){return new L.Button(this.game,t,e,i,s,n,r,a,o,h)},graphics:function(t,e){return new L.Graphics(this.game,t,e)},retroFont:function(t,e,i,s,n,r,a,o,h){return new L.RetroFont(this.game,t,e,i,s,n,r,a,o,h)},bitmapText:function(t,e,i,s,n){return new L.BitmapText(this.game,t,e,i,s,n)},tilemap:function(t,e,i,s,n){return new L.Tilemap(this.game,t,e,i,s,n)},renderTexture:function(t,e,i,s){if(typeof i==="undefined"||i===""){i=this.game.rnd.uuid()}if(typeof s==="undefined"){s=false}var n=new L.RenderTexture(this.game,t,e,i);if(s){this.game.cache.addRenderTexture(i,n)}return n},bitmapData:function(t,e,i,s){if(typeof s==="undefined"){s=false}if(typeof i==="undefined"||i===""){i=this.game.rnd.uuid()}var n=new L.BitmapData(this.game,i,t,e);if(s){this.game.cache.addBitmapData(i,n)}return n},filter:function(t){var e=Array.prototype.splice.call(arguments,1);var t=new L.Filter[t](this.game);t.init.apply(t,e);return t}};L.GameObjectCreator.prototype.constructor=L.GameObjectCreator;L.Sprite=function(t,e,i,s,n){e=e||0;i=i||0;s=s||null;n=n||null;this.type=L.SPRITE;this.physicsType=L.SPRITE;PIXI.Sprite.call(this,PIXI.TextureCache["__default"]);L.Component.Core.init.call(this,t,e,i,s,n)};L.Sprite.prototype=Object.create(PIXI.Sprite.prototype);L.Sprite.prototype.constructor=L.Sprite;L.Component.Core.install.call(L.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);L.Sprite.prototype.preUpdatePhysics=L.Component.PhysicsBody.preUpdate;L.Sprite.prototype.preUpdateLifeSpan=L.Component.LifeSpan.preUpdate;L.Sprite.prototype.preUpdateInWorld=L.Component.InWorld.preUpdate;L.Sprite.prototype.preUpdateCore=L.Component.Core.preUpdate;L.Sprite.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};L.Image=function(t,e,i,s,n){e=e||0;i=i||0;s=s||null;n=n||null;this.type=L.IMAGE;PIXI.Sprite.call(this,PIXI.TextureCache["__default"]);L.Component.Core.init.call(this,t,e,i,s,n)};L.Image.prototype=Object.create(PIXI.Sprite.prototype);L.Image.prototype.constructor=L.Image;L.Component.Core.install.call(L.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","Smoothed"]);L.Image.prototype.preUpdateInWorld=L.Component.InWorld.preUpdate;L.Image.prototype.preUpdateCore=L.Component.Core.preUpdate;L.Image.prototype.preUpdate=function(){if(!this.preUpdateInWorld()){return false}return this.preUpdateCore()};L.TileSprite=function(t,e,i,s,n,r,a){e=e||0;i=i||0;s=s||256;n=n||256;r=r||null;a=a||null;this.type=L.TILESPRITE;this._scroll=new L.Point;PIXI.TilingSprite.call(this,PIXI.TextureCache["__default"],s,n);L.Component.Core.init.call(this,t,e,i,r,a)};L.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);L.TileSprite.prototype.constructor=L.TileSprite;L.Component.Core.install.call(L.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]);L.TileSprite.prototype.preUpdatePhysics=L.Component.PhysicsBody.preUpdate;L.TileSprite.prototype.preUpdateLifeSpan=L.Component.LifeSpan.preUpdate;L.TileSprite.prototype.preUpdateInWorld=L.Component.InWorld.preUpdate;L.TileSprite.prototype.preUpdateCore=L.Component.Core.preUpdate;L.TileSprite.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};L.TileSprite.prototype.autoScroll=function(t,e){this._scroll.set(t,e)};L.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};L.TileSprite.prototype.destroy=function(t){L.Component.Destroy.prototype.destroy.call(this,t);PIXI.TilingSprite.prototype.destroy.call(this)};L.TileSprite.prototype.reset=function(t,e){L.Component.Reset.prototype.reset.call(this,t,e);this.tilePosition.x=0;this.tilePosition.y=0;return this};L.Rope=function(t,e,i,s,n,r){this.points=[];this.points=r;this._hasUpdateAnimation=false;this._updateAnimationCallback=null;e=e||0;i=i||0;s=s||null;n=n||null;this.type=L.ROPE;this._scroll=new L.Point;PIXI.Rope.call(this,s,this.points);L.Component.Core.init.call(this,t,e,i,s,n)};L.Rope.prototype=Object.create(PIXI.Rope.prototype);L.Rope.prototype.constructor=L.Rope;L.Component.Core.install.call(L.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);L.Rope.prototype.preUpdatePhysics=L.Component.PhysicsBody.preUpdate;L.Rope.prototype.preUpdateLifeSpan=L.Component.LifeSpan.preUpdate;L.Rope.prototype.preUpdateInWorld=L.Component.InWorld.preUpdate;L.Rope.prototype.preUpdateCore=L.Component.Core.preUpdate;L.Rope.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};L.Rope.prototype.update=function(){if(this._hasUpdateAnimation){this.updateAnimation.call(this)}};L.Rope.prototype.reset=function(t,e){L.Component.Reset.prototype.reset.call(this,t,e);this.tilePosition.x=0;this.tilePosition.y=0;return this};Object.defineProperty(L.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(t){if(t&&typeof t==="function"){this._hasUpdateAnimation=true;this._updateAnimation=t}else{this._hasUpdateAnimation=false;this._updateAnimation=null}}});Object.defineProperty(L.Rope.prototype,"segments",{get:function(){var t=[];var e,i,s,n,r,a,o,h;for(var l=0;l<this.points.length;l++){e=l*4;i=this.verticies[e];s=this.verticies[e+1];n=this.verticies[e+4];r=this.verticies[e+3];a=L.Math.difference(i,n);o=L.Math.difference(s,r);i+=this.world.x;s+=this.world.y;h=new L.Rectangle(i,s,a,o);t.push(h)}return t}});L.Button=function(t,e,i,s,n,r,a,o,h,l){e=e||0;i=i||0;s=s||null;n=n||null;r=r||this;L.Image.call(this,t,e,i,s,o);this.type=L.BUTTON;this.physicsType=L.SPRITE;this._onOverFrame=null;this._onOutFrame=null;this._onDownFrame=null;this._onUpFrame=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new L.Signal;this.onInputOut=new L.Signal;this.onInputDown=new L.Signal;this.onInputUp=new L.Signal;this.onOverMouseOnly=false;this.freezeFrames=false;this.forceOut=false;this.inputEnabled=true;this.input.start(0,true);this.setFrames(a,o,h,l);if(n!==null){this.onInputUp.add(n,r)}this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};L.Button.prototype=Object.create(L.Image.prototype);L.Button.prototype.constructor=L.Button;var h="Over";var l="Out";var u="Down";var f="Up";L.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};L.Button.prototype.removedFromWorld=function(){this.inputEnabled=false};L.Button.prototype.setStateFrame=function(t,e,i){var s="_on"+t+"Frame";if(e!=null){this[s]=e;if(i){this.changeStateFrame(t)}}else{this[s]=null}};L.Button.prototype.changeStateFrame=function(t){if(this.freezeFrames){return false}var e="_on"+t+"Frame";var i=this[e];if(typeof i==="string"){this.frameName=i;return true}else if(typeof i==="number"){this.frame=i;return true}else{return false}};L.Button.prototype.setFrames=function(t,e,i,s){this.setStateFrame(h,t,this.input.pointerOver());this.setStateFrame(l,e,!this.input.pointerOver());this.setStateFrame(u,i,this.input.pointerDown());this.setStateFrame(f,s,this.input.pointerUp())};L.Button.prototype.setStateSound=function(t,e,i){var s="on"+t+"Sound";var n="on"+t+"SoundMarker";if(e instanceof L.Sound||e instanceof L.AudioSprite){this[s]=e;this[n]=typeof i==="string"?i:""}else{this[s]=null;this[n]=""}};L.Button.prototype.playStateSound=function(t){var e="on"+t+"Sound";var i=this[e];if(i){var s="on"+t+"SoundMarker";var n=this[s];i.play(n);return true}else{return false}};L.Button.prototype.setSounds=function(t,e,i,s,n,r,a,o){this.setStateSound(h,t,e);this.setStateSound(l,n,r);this.setStateSound(u,i,s);this.setStateSound(f,a,o)};L.Button.prototype.setOverSound=function(t,e){this.setStateSound(h,t,e)};L.Button.prototype.setOutSound=function(t,e){this.setStateSound(l,t,e)};L.Button.prototype.setDownSound=function(t,e){this.setStateSound(u,t,e)};L.Button.prototype.setUpSound=function(t,e){this.setStateSound(f,t,e)};L.Button.prototype.onInputOverHandler=function(t,e){if(e.justReleased()){return}this.changeStateFrame(h);if(this.onOverMouseOnly&&!e.isMouse){return}this.playStateSound(h);if(this.onInputOver){this.onInputOver.dispatch(this,e)}};L.Button.prototype.onInputOutHandler=function(t,e){this.changeStateFrame(l);this.playStateSound(l);if(this.onInputOut){this.onInputOut.dispatch(this,e)}};L.Button.prototype.onInputDownHandler=function(t,e){this.changeStateFrame(u);this.playStateSound(u);if(this.onInputDown){this.onInputDown.dispatch(this,e)}};L.Button.prototype.onInputUpHandler=function(t,e,i){this.playStateSound(f);if(this.onInputUp){this.onInputUp.dispatch(this,e,i)}if(this.freezeFrames){return}if(this.forceOut){this.changeStateFrame(l)}else{var s=this.changeStateFrame(f);if(!s){if(i){this.changeStateFrame(h)}else{this.changeStateFrame(l)}}}};L.SpriteBatch=function(t,e,i,s){if(typeof e==="undefined"||e===null){e=t.world}PIXI.SpriteBatch.call(this);L.Group.call(this,t,e,i,s);this.type=L.SPRITEBATCH};L.SpriteBatch.prototype=L.Utils.extend(true,L.SpriteBatch.prototype,L.Group.prototype,PIXI.SpriteBatch.prototype);L.SpriteBatch.prototype.constructor=L.SpriteBatch;L.BitmapData=function(t,e,i,s){if(typeof i==="undefined"){i=256}if(typeof s==="undefined"){s=256}this.game=t;this.key=e;this.width=i;this.height=s;this.canvas=L.Canvas.create(i,s,"",true);this.context=this.canvas.getContext("2d",{alpha:true});this.ctx=this.context;this.imageData=this.context.getImageData(0,0,i,s);this.data=this.imageData.data;this.pixels=null;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window["ArrayBuffer"]){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new L.Frame(0,0,0,i,s,"bitmapData",t.rnd.uuid());this.texture.frame=this.textureFrame;this.type=L.BITMAPDATA;this.disableTextureUpload=false;this.dirty=false;this.cls=this.clear;this._image=null;this._pos=new L.Point;this._size=new L.Point;this._scale=new L.Point;this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new L.Point;this._tempR=0;this._tempG=0;this._tempB=0;this._circle=new L.Circle};L.BitmapData.prototype={add:function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){if(t[e]["loadTexture"]){t[e].loadTexture(this)}}}else{t.loadTexture(this)}return this},load:function(t){if(typeof t==="string"){t=this.game.cache.getImage(t)}if(t){this.resize(t.width,t.height);this.cls()}else{return}this.draw(t);this.update();return this},clear:function(){this.context.clearRect(0,0,this.width,this.height);this.dirty=true;return this},fill:function(t,e,i,s){if(typeof s==="undefined"){s=1}this.context.fillStyle="rgba("+t+","+e+","+i+","+s+")";this.context.fillRect(0,0,this.width,this.height);this.dirty=true;return this},resize:function(t,e){if(t!==this.width||e!==this.height){this.width=t;this.height=e;this.canvas.width=t;this.canvas.height=e;this.baseTexture.width=t;this.baseTexture.height=e;this.textureFrame.width=t;this.textureFrame.height=e;this.texture.width=t;this.texture.height=e;this.texture.crop.width=t;this.texture.crop.height=e;this.update();this.dirty=true}return this},update:function(t,e,i,s){if(typeof t==="undefined"){t=0}if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i=this.width}if(typeof s==="undefined"){s=this.height}this.imageData=this.context.getImageData(t,e,i,s);this.data=this.imageData.data;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window["ArrayBuffer"]){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}return this},processPixelRGB:function(t,e,i,s,n,r){if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}if(typeof n==="undefined"){n=this.width}if(typeof r==="undefined"){r=this.height}var a=i+n;var o=s+r;var h=L.Color.createColor();var l={r:0,g:0,b:0,a:0};var u=false;for(var f=s;f<o;f++){for(var c=i;c<a;c++){L.Color.unpackPixel(this.getPixel32(c,f),h);l=t.call(e,h,c,f);if(l!==false&&l!==null&&l!==undefined){this.setPixel32(c,f,l.r,l.g,l.b,l.a,false);u=true}}}if(u){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},processPixel:function(t,e,i,s,n,r){if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}if(typeof n==="undefined"){n=this.width}if(typeof r==="undefined"){r=this.height}var a=i+n;var o=s+r;var h=0;var l=0;var u=false;for(var f=s;f<o;f++){for(var c=i;c<a;c++){h=this.getPixel32(c,f);l=t.call(e,h,c,f);if(l!==h){this.pixels[f*this.width+c]=l;u=true}}}if(u){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},replaceRGB:function(t,e,i,s,n,r,a,o,h){var l=0;var u=0;var f=this.width;var c=this.height;var d=L.Color.packPixel(t,e,i,s);if(h!==undefined&&h instanceof L.Rectangle){l=h.x;u=h.y;f=h.width;c=h.height}for(var p=0;p<c;p++){for(var g=0;g<f;g++){if(this.getPixel32(l+g,u+p)===d){this.setPixel32(l+g,u+p,n,r,a,o,false)}}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setHSL:function(t,e,i,s){if(typeof t==="undefined"||t===null){t=false}if(typeof e==="undefined"||e===null){e=false}if(typeof i==="undefined"||i===null){i=false}if(!t&&!e&&!i){return}if(typeof s==="undefined"){s=new L.Rectangle(0,0,this.width,this.height)}var n=L.Color.createColor();for(var r=s.y;r<s.bottom;r++){for(var a=s.x;a<s.right;a++){L.Color.unpackPixel(this.getPixel32(a,r),n,true);if(t){n.h=t}if(e){n.s=e}if(i){n.l=i}L.Color.HSLtoRGB(n.h,n.s,n.l,n);this.setPixel32(a,r,n.r,n.g,n.b,n.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},shiftHSL:function(t,e,i,s){if(typeof t==="undefined"||t===null){t=false}if(typeof e==="undefined"||e===null){e=false}if(typeof i==="undefined"||i===null){i=false}if(!t&&!e&&!i){return}if(typeof s==="undefined"){s=new L.Rectangle(0,0,this.width,this.height)}var n=L.Color.createColor();for(var r=s.y;r<s.bottom;r++){for(var a=s.x;a<s.right;a++){L.Color.unpackPixel(this.getPixel32(a,r),n,true);if(t){n.h=this.game.math.wrap(n.h+t,0,1)}if(e){n.s=this.game.math.limitValue(n.s+e,0,1)}if(i){n.l=this.game.math.limitValue(n.l+i,0,1)}L.Color.HSLtoRGB(n.h,n.s,n.l,n);this.setPixel32(a,r,n.r,n.g,n.b,n.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setPixel32:function(t,e,i,s,n,r,a){if(typeof a==="undefined"){a=true}if(t>=0&&t<=this.width&&e>=0&&e<=this.height){if(L.Device.LITTLE_ENDIAN){this.pixels[e*this.width+t]=r<<24|n<<16|s<<8|i}else{this.pixels[e*this.width+t]=i<<24|s<<16|n<<8|r}if(a){this.context.putImageData(this.imageData,0,0);this.dirty=true}}return this},setPixel:function(t,e,i,s,n,r){return this.setPixel32(t,e,i,s,n,255,r)},getPixel:function(t,e,i){if(!i){i=L.Color.createColor()}var s=~~(t+e*this.width);s*=4;i.r=this.data[s];i.g=this.data[++s];i.b=this.data[++s];i.a=this.data[++s];return i},getPixel32:function(t,e){if(t>=0&&t<=this.width&&e>=0&&e<=this.height){return this.pixels[e*this.width+t]}},getPixelRGB:function(t,e,i,s,n){return L.Color.unpackPixel(this.getPixel32(t,e),i,s,n)},getPixels:function(t){return this.context.getImageData(t.x,t.y,t.width,t.height)},getFirstPixel:function(t){if(typeof t==="undefined"){t=0}var e=L.Color.createColor();var i=0;var s=0;var n=1;var r=false;if(t===1){n=-1;s=this.height}else if(t===3){n=-1;i=this.width}do{L.Color.unpackPixel(this.getPixel32(i,s),e);if(t===0||t===1){i++;if(i===this.width){i=0;s+=n;if(s>=this.height||s<=0){r=true}}}else if(t===2||t===3){s++;if(s===this.height){s=0;i+=n;if(i>=this.width||i<=0){r=true}}}}while(e.a===0&&!r);e.x=i;e.y=s;return e},getBounds:function(t){if(typeof t==="undefined"){t=new L.Rectangle}t.x=this.getFirstPixel(2).x;if(t.x===this.width){return t.setTo(0,0,0,0)}t.y=this.getFirstPixel(0).y;t.width=this.getFirstPixel(3).x-t.x+1;t.height=this.getFirstPixel(1).y-t.y+1;return t},addToWorld:function(t,e,i,s,n,r){n=n||1;r=r||1;var a=this.game.add.image(t,e,this);a.anchor.set(i,s);a.scale.set(n,r);return a},copy:function(t,e,i,s,n,r,a,o,h,l,u,f,c,d,p,g,m){if(typeof t==="undefined"||t===null){t=this}this._image=t;if(t instanceof L.Sprite||t instanceof L.Image||t instanceof L.Text){this._pos.set(t.texture.crop.x,t.texture.crop.y);this._size.set(t.texture.crop.width,t.texture.crop.height);this._scale.set(t.scale.x,t.scale.y);this._anchor.set(t.anchor.x,t.anchor.y);this._rotate=t.rotation;this._alpha.current=t.alpha;this._image=t.texture.baseTexture.source;if(typeof r==="undefined"||r===null){r=t.x}if(typeof a==="undefined"||a===null){a=t.y}if(t.texture.trim){r+=t.texture.trim.x-t.anchor.x*t.texture.trim.width;a+=t.texture.trim.y-t.anchor.y*t.texture.trim.height}if(t.tint!==16777215){if(t.cachedTint!==t.tint){t.cachedTint=t.tint;t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)}this._image=t.tintedTexture}}else{this._pos.set(0);this._scale.set(1);this._anchor.set(0);this._rotate=0;this._alpha.current=1;if(t instanceof L.BitmapData){this._image=t.canvas}else if(typeof t==="string"){t=this.game.cache.getImage(t);if(t===null){return}else{this._image=t}}this._size.set(this._image.width,this._image.height)}if(typeof e==="undefined"||e===null){e=0}if(typeof i==="undefined"||i===null){i=0}if(s){this._size.x=s}if(n){this._size.y=n}if(typeof r==="undefined"||r===null){r=e}if(typeof a==="undefined"||a===null){a=i}if(typeof o==="undefined"||o===null){o=this._size.x}if(typeof h==="undefined"||h===null){h=this._size.y}if(typeof l==="number"){this._rotate=l}if(typeof u==="number"){this._anchor.x=u}if(typeof f==="number"){this._anchor.y=f}if(typeof c==="number"){this._scale.x=c}if(typeof d==="number"){this._scale.y=d}if(typeof p==="number"){this._alpha.current=p}if(typeof g==="undefined"){g=null}if(typeof m==="undefined"){m=false}if(this._alpha.current<=0||this._scale.x===0||this._scale.y===0||this._size.x===0||this._size.y===0){return}this._alpha.prev=this.context.globalAlpha;this.context.save();this.context.globalAlpha=this._alpha.current;if(g){this.context.globalCompositeOperation=g}if(m){r|=0;a|=0}this.context.translate(r,a);this.context.scale(this._scale.x,this._scale.y);this.context.rotate(this._rotate);this.context.drawImage(this._image,this._pos.x+e,this._pos.y+i,this._size.x,this._size.y,-o*this._anchor.x,-h*this._anchor.y,o,h);this.context.restore();this.context.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyRect:function(t,e,i,s,n,r,a){return this.copy(t,e.x,e.y,e.width,e.height,i,s,e.width,e.height,0,0,0,1,1,n,r,a)},draw:function(t,e,i,s,n,r,a){return this.copy(t,null,null,null,null,e,i,s,n,null,null,null,null,null,null,r,a)},drawGroup:function(t,e,i){if(t.total>0){t.forEachExists(this.copy,this,null,null,null,null,null,null,null,null,null,null,null,null,null,null,e,i)}return this},shadow:function(t,e,i,s){if(typeof t==="undefined"||t===null){this.context.shadowColor="rgba(0,0,0,0)"}else{this.context.shadowColor=t;this.context.shadowBlur=e||5;this.context.shadowOffsetX=i||10;this.context.shadowOffsetY=s||10}},alphaMask:function(t,e,i,s){if(typeof s==="undefined"||s===null){this.draw(e).blendSourceAtop()}else{this.draw(e,s.x,s.y,s.width,s.height).blendSourceAtop()}if(typeof i==="undefined"||i===null){this.draw(t).blendReset()}else{this.draw(t,i.x,i.y,i.width,i.height).blendReset()}return this},extract:function(s,n,r,a,o,t,h,l,u){if(typeof o==="undefined"){o=255}if(typeof t==="undefined"){t=false}if(typeof h==="undefined"){h=n}if(typeof l==="undefined"){l=r}if(typeof u==="undefined"){u=a}if(t){s.resize(this.width,this.height)}this.processPixelRGB(function(t,e,i){if(t.r===n&&t.g===r&&t.b===a){s.setPixel32(e,i,h,l,u,o,false)}return false},this);s.context.putImageData(s.imageData,0,0);s.dirty=true;return s},rect:function(t,e,i,s,n){if(typeof n!=="undefined"){this.context.fillStyle=n}this.context.fillRect(t,e,i,s);return this},text:function(t,e,i,s,n,r){if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s="14px Courier"}if(typeof n==="undefined"){n="rgb(255,255,255)"}if(typeof r==="undefined"){r=true}var a=this.context.font;this.context.font=s;if(r){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(t,e+1,i+1)}this.context.fillStyle=n;this.context.fillText(t,e,i);this.context.font=a},circle:function(t,e,i,s){if(typeof s!=="undefined"){this.context.fillStyle=s}this.context.beginPath();this.context.arc(t,e,i,0,Math.PI*2,false);this.context.closePath();this.context.fill();return this},textureLine:function(t,e,i){if(typeof i==="undefined"){i="repeat-x"}if(typeof e==="string"){e=this.game.cache.getImage(e);if(!e){return}}var s=t.length;if(i==="no-repeat"&&s>e.width){s=e.width}this.context.fillStyle=this.context.createPattern(e,i);this._circle=new L.Circle(t.start.x,t.start.y,e.height);this._circle.circumferencePoint(t.angle-1.5707963267948966,false,this._pos);this.context.save();this.context.translate(this._pos.x,this._pos.y);this.context.rotate(t.angle);this.context.fillRect(0,0,s,e.height);this.context.restore();this.dirty=true;return this},render:function(){if(!this.disableTextureUpload&&this.dirty){this.baseTexture.dirty();this.dirty=false}return this},blendReset:function(){this.context.globalCompositeOperation="source-over";return this},blendSourceOver:function(){this.context.globalCompositeOperation="source-over";return this},blendSourceIn:function(){this.context.globalCompositeOperation="source-in";return this},blendSourceOut:function(){this.context.globalCompositeOperation="source-out";return this},blendSourceAtop:function(){this.context.globalCompositeOperation="source-atop";return this},blendDestinationOver:function(){this.context.globalCompositeOperation="destination-over";return this},blendDestinationIn:function(){this.context.globalCompositeOperation="destination-in";return this},blendDestinationOut:function(){this.context.globalCompositeOperation="destination-out";return this},blendDestinationAtop:function(){this.context.globalCompositeOperation="destination-atop";return this},blendXor:function(){this.context.globalCompositeOperation="xor";return this},blendAdd:function(){this.context.globalCompositeOperation="lighter";return this},blendMultiply:function(){this.context.globalCompositeOperation="multiply";return this},blendScreen:function(){this.context.globalCompositeOperation="screen";return this},blendOverlay:function(){this.context.globalCompositeOperation="overlay";return this},blendDarken:function(){this.context.globalCompositeOperation="darken";return this},blendLighten:function(){this.context.globalCompositeOperation="lighten";return this},blendColorDodge:function(){this.context.globalCompositeOperation="color-dodge";return this},blendColorBurn:function(){this.context.globalCompositeOperation="color-burn";return this},blendHardLight:function(){this.context.globalCompositeOperation="hard-light";return this},blendSoftLight:function(){this.context.globalCompositeOperation="soft-light";return this},blendDifference:function(){this.context.globalCompositeOperation="difference";return this},blendExclusion:function(){this.context.globalCompositeOperation="exclusion";return this},blendHue:function(){this.context.globalCompositeOperation="hue";return this},blendSaturation:function(){this.context.globalCompositeOperation="saturation";return this},blendColor:function(){this.context.globalCompositeOperation="color";return this},blendLuminosity:function(){this.context.globalCompositeOperation="luminosity";return this}};Object.defineProperty(L.BitmapData.prototype,"smoothed",{get:function(){L.Canvas.getSmoothingEnabled(this.context)},set:function(t){L.Canvas.setSmoothingEnabled(this.context,t)}});L.BitmapData.getTransform=function(t,e,i,s,n,r){if(typeof t!=="number"){t=0}if(typeof e!=="number"){e=0}if(typeof i!=="number"){i=1}if(typeof s!=="number"){s=1}if(typeof n!=="number"){n=0}if(typeof r!=="number"){r=0}return{sx:i,sy:s,scaleX:i,scaleY:s,skewX:n,skewY:r,translateX:t,translateY:e,tx:t,ty:e}};L.BitmapData.prototype.constructor=L.BitmapData;L.Graphics=function(t,e,i){e=e||0;i=i||0;this.type=L.GRAPHICS;this.physicsType=L.SPRITE;PIXI.Graphics.call(this);L.Component.Core.init.call(this,t,e,i,"",null)};L.Graphics.prototype=Object.create(PIXI.Graphics.prototype);L.Graphics.prototype.constructor=L.Graphics;L.Component.Core.install.call(L.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);L.Graphics.prototype.preUpdatePhysics=L.Component.PhysicsBody.preUpdate;L.Graphics.prototype.preUpdateLifeSpan=L.Component.LifeSpan.preUpdate;L.Graphics.prototype.preUpdateInWorld=L.Component.InWorld.preUpdate;L.Graphics.prototype.preUpdateCore=L.Component.Core.preUpdate;L.Graphics.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};L.Graphics.prototype.destroy=function(t){this.clear();L.Component.Destroy.prototype.destroy.call(this,t)};L.Graphics.prototype.drawTriangle=function(t,e){if(typeof e==="undefined"){e=false}var i=new L.Polygon(t);if(e){var s=new L.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y);var n=new L.Point(t[1].x-t[0].x,t[1].y-t[0].y);var r=new L.Point(t[1].x-t[2].x,t[1].y-t[2].y);var a=r.cross(n);if(s.dot(a)>0){this.drawPolygon(i)}}else{this.drawPolygon(i)}};L.Graphics.prototype.drawTriangles=function(t,e,i){if(typeof i==="undefined"){i=false}var s=new L.Point;var n=new L.Point;var r=new L.Point;var a=[];var o;if(!e){if(t[0]instanceof L.Point){for(o=0;o<t.length/3;o++){this.drawTriangle([t[o*3],t[o*3+1],t[o*3+2]],i)}}else{for(o=0;o<t.length/6;o++){s.x=t[o*6+0];s.y=t[o*6+1];n.x=t[o*6+2];n.y=t[o*6+3];r.x=t[o*6+4];r.y=t[o*6+5];this.drawTriangle([s,n,r],i)}}}else{if(t[0]instanceof L.Point){for(o=0;o<e.length/3;o++){a.push(t[e[o*3]]);a.push(t[e[o*3+1]]);a.push(t[e[o*3+2]]);if(a.length===3){this.drawTriangle(a,i);a=[]}}}else{for(o=0;o<e.length;o++){s.x=t[e[o]*2];s.y=t[e[o]*2+1];a.push(s.copyTo({}));if(a.length===3){this.drawTriangle(a,i);a=[]}}}}};L.RenderTexture=function(t,e,i,s,n,r){if(typeof s==="undefined"){s=""}if(typeof n==="undefined"){n=L.scaleModes.DEFAULT}if(typeof r==="undefined"){r=1}this.game=t;this.key=s;this.type=L.RENDERTEXTURE;this.matrix=new PIXI.Matrix;PIXI.RenderTexture.call(this,e,i,this.game.renderer,n,r);this.render=L.RenderTexture.prototype.render};L.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);L.RenderTexture.prototype.constructor=L.RenderTexture;L.RenderTexture.prototype.renderXY=function(t,e,i,s){this.matrix.tx=e;this.matrix.ty=i;if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(t,this.matrix,s)}else{this.renderCanvas(t,this.matrix,s)}};L.RenderTexture.prototype.render=function(t,e,i){this.matrix.tx=e.x;this.matrix.ty=e.y;if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(t,this.matrix,i)}else{this.renderCanvas(t,this.matrix,i)}};L.Text=function(t,e,i,s,n){e=e||0;i=i||0;s=s||" ";n=n||{};if(s.length===0){s=" "}else{s=s.toString()}this.type=L.TEXT;this.physicsType=L.SPRITE;this.padding=new L.Point;this._text=s;this._fontComponents=null;this._lineSpacing=0;this._charCount=0;this.colors=[];this.setStyle(n);PIXI.Text.call(this,t,s,this.style);L.Component.Core.init.call(this,t,e,i,"",null);if(s!==" "){this.updateText()}};L.Text.prototype=Object.create(PIXI.Text.prototype);L.Text.prototype.constructor=L.Text;L.Component.Core.install.call(L.Text.prototype,["Angle","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","Overlap","PhysicsBody","Reset","Smoothed"]);L.Text.prototype.preUpdatePhysics=L.Component.PhysicsBody.preUpdate;L.Text.prototype.preUpdateLifeSpan=L.Component.LifeSpan.preUpdate;L.Text.prototype.preUpdateInWorld=L.Component.InWorld.preUpdate;L.Text.prototype.preUpdateCore=L.Component.Core.preUpdate;L.Text.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};L.Text.prototype.update=function(){};L.Text.prototype.destroy=function(t){this.texture.destroy(true);if(this.canvas&&this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}else{this.canvas=null;this.context=null}L.Component.Destroy.prototype.destroy.call(this,t)};L.Text.prototype.setShadow=function(t,e,i,s){if(typeof t==="undefined"){t=0}if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i="rgba(0, 0, 0, 1)"}if(typeof s==="undefined"){s=0}this.style.shadowOffsetX=t;this.style.shadowOffsetY=e;this.style.shadowColor=i;this.style.shadowBlur=s;this.dirty=true};L.Text.prototype.setStyle=function(t){t=t||{};t.font=t.font||"bold 20pt Arial";t.backgroundColor=t.backgroundColor||null;t.fill=t.fill||"black";t.align=t.align||"left";t.stroke=t.stroke||"black";t.strokeThickness=t.strokeThickness||0;t.wordWrap=t.wordWrap||false;t.wordWrapWidth=t.wordWrapWidth||100;t.shadowOffsetX=t.shadowOffsetX||0;t.shadowOffsetY=t.shadowOffsetY||0;t.shadowColor=t.shadowColor||"rgba(0,0,0,0)";t.shadowBlur=t.shadowBlur||0;var e=this.fontToComponents(t.font);if(t.fontStyle){e.fontStyle=t.fontStyle}if(t.fontVariant){e.fontVariant=t.fontVariant}if(t.fontWeight){e.fontWeight=t.fontWeight}if(t.fontSize){if(typeof t.fontSize==="number"){t.fontSize=t.fontSize+"px"}e.fontSize=t.fontSize}this._fontComponents=e;t.font=this.componentsToFont(this._fontComponents);this.style=t;this.dirty=true};L.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var t=this.text;if(this.style.wordWrap){t=this.runWordWrap(this.text)}var e=t.split(/(?:\r\n|\r|\n)/);var i=[];var s=0;var n=this.determineFontProperties(this.style.font);for(var r=0;r<e.length;r++){var a=this.context.measureText(e[r]).width+this.padding.x;i[r]=a;s=Math.max(s,a)}var o=s+this.style.strokeThickness;this.canvas.width=o*this.resolution;var h=n.fontSize+this.style.strokeThickness+this.padding.y;var l=h*e.length;var u=this._lineSpacing;if(u<0&&Math.abs(u)>h){u=-h}if(u!==0){var f=u*(e.length-1);l+=f}this.canvas.height=l*this.resolution;this.context.scale(this.resolution,this.resolution);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}if(this.style.backgroundColor){this.context.fillStyle=this.style.backgroundColor;this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline="alphabetic";this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur;this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";var c;var d;this._charCount=0;for(r=0;r<e.length;r++){c=this.style.strokeThickness/2;d=this.style.strokeThickness/2+r*h+n.ascent;if(r>0){d+=u*r}if(this.style.align==="right"){c+=s-i[r]}else if(this.style.align==="center"){c+=(s-i[r])/2}if(this.colors.length>0){this.updateLine(e[r],c,d)}else{if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(e[r],c,d)}if(this.style.fill){this.context.fillText(e[r],c,d)}}}this.updateTexture()};L.Text.prototype.updateLine=function(t,e,i){for(var s=0;s<t.length;s++){var n=t[s];if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount];this.context.strokeStyle=this.colors[this._charCount]}if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(n,e,i)}if(this.style.fill){this.context.fillText(n,e,i)}e+=this.context.measureText(n).width;this._charCount++}};L.Text.prototype.clearColors=function(){this.colors=[];this.dirty=true};L.Text.prototype.addColor=function(t,e){this.colors[e]=t;this.dirty=true};L.Text.prototype.runWordWrap=function(t){var e="";var i=t.split("\n");for(var s=0;s<i.length;s++){var n=this.style.wordWrapWidth;var r=i[s].split(" ");for(var a=0;a<r.length;a++){var o=this.context.measureText(r[a]).width;var h=o+this.context.measureText(" ").width;if(h>n){if(a>0){e+="\n"}e+=r[a]+" ";n=this.style.wordWrapWidth-o}else{n-=h;e+=r[a]+" "}}if(s<i.length-1){e+="\n"}}return e};L.Text.prototype.updateFont=function(t){var e=this.componentsToFont(t);if(this.style.font!==e){this.style.font=e;this.dirty=true;if(this.parent){this.updateTransform()}}};L.Text.prototype.fontToComponents=function(t){var e=t.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(e){return{font:t,fontStyle:e[1]||"normal",fontVariant:e[2]||"normal",fontWeight:e[3]||"normal",fontSize:e[4]||"medium",fontFamily:e[5]}}else{console.warn("Phaser.Text - unparsable CSS font: "+t);return{font:t}}};L.Text.prototype.componentsToFont=function(t){var e=[];var i;i=t.fontStyle;if(i&&i!=="normal"){e.push(i)}i=t.fontVariant;if(i&&i!=="normal"){e.push(i)}i=t.fontWeight;if(i&&i!=="normal"){e.push(i)}i=t.fontSize;if(i&&i!=="medium"){e.push(i)}i=t.fontFamily;if(i){e.push(i)}if(!e.length){e.push(t.font)}return e.join(" ")};Object.defineProperty(L.Text.prototype,"text",{get:function(){return this._text},set:function(t){if(t!==this._text){this._text=t.toString()||" ";this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(L.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(t){t=t||"bold 20pt Arial";this._fontComponents=this.fontToComponents(t);this.updateFont(this._fontComponents)}});Object.defineProperty(L.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(t){t=t||"Arial";t=t.trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)&&!/['",]/.exec(t)){t="'"+t+"'"}this._fontComponents.fontFamily=t;this.updateFont(this._fontComponents)}});Object.defineProperty(L.Text.prototype,"fontSize",{get:function(){var t=this._fontComponents.fontSize;if(t&&/(?:^0$|px$)/.exec(t)){return parseInt(t,10)}else{return t}},set:function(t){t=t||"0";if(typeof t==="number"){t=t+"px"}this._fontComponents.fontSize=t;this.updateFont(this._fontComponents)}});Object.defineProperty(L.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontWeight=t;this.updateFont(this._fontComponents)}});Object.defineProperty(L.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontStyle=t;this.updateFont(this._fontComponents)}});Object.defineProperty(L.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontVariant=t;this.updateFont(this._fontComponents)}});Object.defineProperty(L.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){if(t!==this.style.fill){this.style.fill=t;this.dirty=true}}});Object.defineProperty(L.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){if(t!==this.style.align){this.style.align=t;this.dirty=true}}});Object.defineProperty(L.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){if(t!==this.style.stroke){this.style.stroke=t;this.dirty=true}}});Object.defineProperty(L.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){if(t!==this.style.strokeThickness){this.style.strokeThickness=t;this.dirty=true}}});Object.defineProperty(L.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){if(t!==this.style.wordWrap){this.style.wordWrap=t;this.dirty=true}}});Object.defineProperty(L.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){if(t!==this.style.wordWrapWidth){this.style.wordWrapWidth=t;this.dirty=true}}});Object.defineProperty(L.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(t){if(t!==this._lineSpacing){this._lineSpacing=parseFloat(t);this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(L.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){if(t!==this.style.shadowOffsetX){this.style.shadowOffsetX=t;this.dirty=true}}});Object.defineProperty(L.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){if(t!==this.style.shadowOffsetY){this.style.shadowOffsetY=t;this.dirty=true}}});Object.defineProperty(L.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){if(t!==this.style.shadowColor){this.style.shadowColor=t;this.dirty=true}}});Object.defineProperty(L.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){if(t!==this.style.shadowBlur){this.style.shadowBlur=t;this.dirty=true}}});L.BitmapText=function(t,e,i,s,n,r){e=e||0;i=i||0;s=s||"";n=n||"";r=r||32;this.type=L.BITMAPTEXT;this.physicsType=L.SPRITE;this._text=n;this._font=s;this._fontSize=r;this._align="left";this._tint=16777215;this._tw=0;this._th=0;PIXI.BitmapText.call(this,n);L.Component.Core.init.call(this,t,e,i,"",null)};L.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype);L.BitmapText.prototype.constructor=L.BitmapText;L.Component.Core.install.call(L.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);L.BitmapText.prototype.preUpdatePhysics=L.Component.PhysicsBody.preUpdate;L.BitmapText.prototype.preUpdateLifeSpan=L.Component.LifeSpan.preUpdate;L.BitmapText.prototype.preUpdateInWorld=L.Component.InWorld.preUpdate;L.BitmapText.prototype.preUpdateCore=L.Component.Core.preUpdate;L.BitmapText.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};L.BitmapText.prototype.postUpdate=function(){L.Component.PhysicsBody.postUpdate.call(this);L.Component.FixedToCamera.postUpdate.call(this);if(this.body&&(this.textWidth!==this._tw||this.textHeight!==this._th)){this.body.setSize(this.textWidth,this.textHeight);this._tw=this.textWidth;this._th=this.textHeight}};L.BitmapText.prototype.setStyle=function(){this.style={align:this._align};this.fontName=this._font;this.fontSize=this._fontSize;this.dirty=true};Object.defineProperty(L.BitmapText.prototype,"align",{get:function(){return this._align},set:function(t){if(t!==this._align){this._align=t;this.setStyle()}}});Object.defineProperty(L.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(t){if(t!==this._tint){this._tint=t;this.dirty=true}}});Object.defineProperty(L.BitmapText.prototype,"font",{get:function(){return this._font},set:function(t){if(t!==this._font){this._font=t.trim();this.fontName=this._font;this.style.font=this._fontSize+"px '"+this._font+"'";this.dirty=true}}});Object.defineProperty(L.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){t=parseInt(t,10);if(t!==this._fontSize){this._fontSize=t;this.style.font=this._fontSize+"px '"+this._font+"'";this.dirty=true}}});Object.defineProperty(L.BitmapText.prototype,"text",{get:function(){return this._text},set:function(t){if(t!==this._text){this._text=t.toString()||" ";this.dirty=true}}});L.RetroFont=function(t,e,i,s,n,r,a,o,h,l){if(!t.cache.checkImageKey(e)){return false}if(typeof r==="undefined"||r===null){r=t.cache.getImage(e).width/i}this.characterWidth=i;this.characterHeight=s;this.characterSpacingX=a||0;this.characterSpacingY=o||0;this.characterPerRow=r;this.offsetX=h||0;this.offsetY=l||0;this.align="left";this.multiLine=false;this.autoUpperCase=true;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=t.cache.getImage(e);this._text="";this.grabData=[];this.frameData=new L.FrameData;var u=this.offsetX;var f=this.offsetY;var c=0;for(var d=0;d<n.length;d++){var p=t.rnd.uuid();var g=this.frameData.addFrame(new L.Frame(d,u,f,this.characterWidth,this.characterHeight,"",p));this.grabData[n.charCodeAt(d)]=g.index;PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[e],{x:u,y:f,width:this.characterWidth,height:this.characterHeight});c++;if(c==this.characterPerRow){c=0;u=this.offsetX;f+=this.characterHeight+this.characterSpacingY}else{u+=this.characterWidth+this.characterSpacingX}}t.cache.updateFrameData(e,this.frameData);this.stamp=new L.Image(t,0,0,e,0);L.RenderTexture.call(this,t,100,100,"",L.scaleModes.NEAREST);this.type=L.RETROFONT};L.RetroFont.prototype=Object.create(L.RenderTexture.prototype);L.RetroFont.prototype.constructor=L.RetroFont;L.RetroFont.ALIGN_LEFT="left";L.RetroFont.ALIGN_RIGHT="right";L.RetroFont.ALIGN_CENTER="center";L.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";L.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";L.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";L.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";L.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";L.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";L.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";L.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";L.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";L.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";L.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";L.RetroFont.prototype.setFixedWidth=function(t,e){if(typeof e==="undefined"){e="left"}this.fixedWidth=t;this.align=e};L.RetroFont.prototype.setText=function(t,e,i,s,n,r){this.multiLine=e||false;this.customSpacingX=i||0;this.customSpacingY=s||0;this.align=n||"left";if(r){this.autoUpperCase=false}else{this.autoUpperCase=true}if(t.length>0){this.text=t}};L.RetroFont.prototype.buildRetroFontText=function(){var t=0;var e=0;this.clear();if(this.multiLine){var i=this._text.split("\n");if(this.fixedWidth>0){this.resize(this.fixedWidth,i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,true)}else{this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,true)}for(var s=0;s<i.length;s++){switch(this.align){case L.RetroFont.ALIGN_LEFT:t=0;break;case L.RetroFont.ALIGN_RIGHT:t=this.width-i[s].length*(this.characterWidth+this.customSpacingX);break;case L.RetroFont.ALIGN_CENTER:t=this.width/2-i[s].length*(this.characterWidth+this.customSpacingX)/2;t+=this.customSpacingX/2;break}if(t<0){t=0}this.pasteLine(i[s],t,e,this.customSpacingX);e+=this.characterHeight+this.customSpacingY}}else{if(this.fixedWidth>0){this.resize(this.fixedWidth,this.characterHeight,true)}else{this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,true)}switch(this.align){case L.RetroFont.ALIGN_LEFT:t=0;break;case L.RetroFont.ALIGN_RIGHT:t=this.width-this._text.length*(this.characterWidth+this.customSpacingX);break;case L.RetroFont.ALIGN_CENTER:t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2;t+=this.customSpacingX/2;break}this.textureBuffer.clear();this.pasteLine(this._text,t,0,this.customSpacingX)}};L.RetroFont.prototype.pasteLine=function(t,e,i,s){var n=new L.Point;for(var r=0;r<t.length;r++){if(t.charAt(r)==" "){e+=this.characterWidth+s}else{if(this.grabData[t.charCodeAt(r)]>=0){this.stamp.frame=this.grabData[t.charCodeAt(r)];n.set(e,i);this.render(this.stamp,n,false);e+=this.characterWidth+s;if(e>this.width){break}}}}};L.RetroFont.prototype.getLongestLine=function(){var t=0;if(this._text.length>0){var e=this._text.split("\n");for(var i=0;i<e.length;i++){if(e[i].length>t){t=e[i].length}}}return t};L.RetroFont.prototype.removeUnsupportedCharacters=function(t){var e="";for(var i=0;i<this._text.length;i++){var s=this._text[i];var n=s.charCodeAt(0);if(this.grabData[n]>=0||!t&&s==="\n"){e=e.concat(s)}}return e};L.RetroFont.prototype.updateOffset=function(t,e){if(this.offsetX===t&&this.offsetY===e){return}var i=t-this.offsetX;var s=e-this.offsetY;var n=this.game.cache.getFrameData(this.stamp.key).getFrames();var r=n.length;while(r--){n[r].x+=i;n[r].y+=s;PIXI.TextureCache[n[r].uuid].frame.x=n[r].x;PIXI.TextureCache[n[r].uuid].frame.y=n[r].y}this.buildRetroFontText()};Object.defineProperty(L.RetroFont.prototype,"text",{get:function(){return this._text},set:function(t){var e;if(this.autoUpperCase){e=t.toUpperCase()}else{e=t}if(e!==this._text){this._text=e;this.removeUnsupportedCharacters(this.multiLine);this.buildRetroFontText()}}});Object.defineProperty(L.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(t){this.stamp.smoothed=t;this.buildRetroFontText()}});L.Device=function(){this.deviceReadyAt=0;this.initialized=false;this.desktop=false;this.iOS=false;this.cocoonJS=false;this.cocoonJSApp=false;this.cordova=false;this.node=false;this.nodeWebkit=false;this.ejecta=false;this.crosswalk=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.canvasBitBltShift=null;this.webGL=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.worker=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.vibration=false;this.getUserMedia=false;this.quirksMode=false;this.touch=false;this.mspointer=false;this.wheelEvent=null;this.arora=false;this.chrome=false;this.epiphany=false;this.firefox=false;this.ie=false;this.ieVersion=0;this.trident=false;this.tridentVersion=0;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.webApp=false;this.silk=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this.LITTLE_ENDIAN=false;this.support32bit=false;this.fullscreen=false;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=false};L.Device=new L.Device;L.Device.onInitialized=new L.Signal;L.Device.whenReady=function(t,e,i){var s=this._readyCheck;if(this.deviceReadyAt||!s){t.call(e,this)}else if(s._monitor||i){s._queue=s._queue||[];s._queue.push([t,e])}else{s._monitor=s.bind(this);s._queue=s._queue||[];s._queue.push([t,e]);var n=typeof window.cordova!=="undefined";var r=navigator["isCocoonJS"];if(document.readyState==="complete"||document.readyState==="interactive"){window.setTimeout(s._monitor,0)}else if(n&&!r){document.addEventListener("deviceready",s._monitor,false)}else{document.addEventListener("DOMContentLoaded",s._monitor,false);window.addEventListener("load",s._monitor,false)}}};L.Device._readyCheck=function(){var t=this._readyCheck;if(!document.body){window.setTimeout(t._monitor,20)}else if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",t._monitor);document.removeEventListener("DOMContentLoaded",t._monitor);window.removeEventListener("load",t._monitor);this._initialize();this.initialized=true;this.onInitialized.dispatch(this);var e;while(e=t._queue.shift()){var i=e[0];var s=e[1];i.call(s,this)}this._readyCheck=null;this._initialize=null;this.onInitialized=null}};L.Device._initialize=function(){var n=this;function t(){var t=navigator.userAgent;if(/Playstation Vita/.test(t)){n.vita=true}else if(/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)){n.kindle=true}else if(/Android/.test(t)){n.android=true}else if(/CrOS/.test(t)){n.chromeOS=true}else if(/iP[ao]d|iPhone/i.test(t)){n.iOS=true}else if(/Linux/.test(t)){n.linux=true}else if(/Mac OS/.test(t)){n.macOS=true}else if(/Windows/.test(t)){n.windows=true;if(/Windows Phone/i.test(t)){n.windowsPhone=true}}var e=/Silk/.test(t);if(n.windows||n.macOS||n.linux&&!e||n.chromeOS){n.desktop=true}if(n.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t)){n.desktop=false}}function e(){var t=this;n.canvas=!!window["CanvasRenderingContext2D"]||n.cocoonJS;try{n.localStorage=!!localStorage.getItem}catch(t){n.localStorage=false}n.file=!!window["File"]&&!!window["FileReader"]&&!!window["FileList"]&&!!window["Blob"];n.fileSystem=!!window["requestFileSystem"];n.webGL=function(){try{if(window.__wx)return true;var t=document.createElement("canvas");var e={stencil:true};t.screencanvas=false;return!!window.WebGLRenderingContext&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(t){return false}}();n.webGL=!!n.webGL;n.worker=!!window["Worker"];n.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;n.quirksMode=document.compatMode==="CSS1Compat"?false:true;n.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);if(!n.iOS&&(n.ie||n.firefox||n.chrome)){n.canvasBitBltShift=true}if(n.safari||n.mobileSafari){n.canvasBitBltShift=false}}function i(){if("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1){n.touch=true}if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled){n.mspointer=true}if(!n.cocoonJS){if("onwheel"in window||n.ie&&"WheelEvent"in window){n.wheelEvent="wheel"}else if("onmousewheel"in window){n.wheelEvent="mousewheel"}else if(n.firefox&&"MouseScrollEvent"in window){n.wheelEvent="DOMMouseScroll"}}}function s(){var t=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"];var e=document.createElement("div");for(var i=0;i<t.length;i++){if(e[t[i]]){n.fullscreen=true;n.requestFullscreen=t[i];break}}var s=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(n.fullscreen){for(var i=0;i<s.length;i++){if(document[s[i]]){n.cancelFullscreen=s[i];break}}}if(window["Element"]&&Element["ALLOW_KEYBOARD_INPUT"]){n.fullscreenKeyboard=true}}function r(){var t=navigator.userAgent;if(/Arora/.test(t)){n.arora=true}else if(/Chrome/.test(t)){n.chrome=true}else if(/Epiphany/.test(t)){n.epiphany=true}else if(/Firefox/.test(t)){n.firefox=true}else if(/AppleWebKit/.test(t)&&n.iOS){n.mobileSafari=true}else if(/MSIE (\d+\.\d+);/.test(t)){n.ie=true;n.ieVersion=parseInt(RegExp.$1,10)}else if(/Midori/.test(t)){n.midori=true}else if(/Opera/.test(t)){n.opera=true}else if(/Safari/.test(t)){n.safari=true}else if(/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(t)){n.ie=true;n.trident=true;n.tridentVersion=parseInt(RegExp.$1,10);n.ieVersion=parseInt(RegExp.$3,10)}if(/Silk/.test(t)){n.silk=true}if(navigator["standalone"]){n.webApp=true}if(typeof window.cordova!=="undefined"){n.cordova=true}if(typeof process!=="undefined"&&typeof require!=="undefined"){n.node=true}if(n.node){try{n.nodeWebkit=typeof require("nw.gui")!=="undefined"}catch(t){n.nodeWebkit=false}}if(navigator["isCocoonJS"]){n.cocoonJS=true}if(n.cocoonJS){try{n.cocoonJSApp=typeof CocoonJS!=="undefined"}catch(t){n.cocoonJSApp=false}}if(typeof window.ejecta!=="undefined"){n.ejecta=true}if(/Crosswalk/.test(t)){n.crosswalk=true}}function a(){n.audioData=!!window["Audio"];n.webAudio=!!(window["AudioContext"]||window["webkitAudioContext"]);var t=document.createElement("audio");var e=false;try{if(e=!!t.canPlayType){if(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){n.ogg=true}if(t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||t.canPlayType("audio/opus;").replace(/^no$/,"")){n.opus=true}if(t.canPlayType("audio/mpeg;").replace(/^no$/,"")){n.mp3=true}if(t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){n.wav=true}if(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;").replace(/^no$/,"")){n.m4a=true}if(t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")){n.webm=true}}}catch(t){}}function o(){n.pixelRatio=window["devicePixelRatio"]||1;n.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;n.iPhone4=n.pixelRatio==2&&n.iPhone;n.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1;if(typeof Int8Array!=="undefined"){n.typedArray=true}else{n.typedArray=false}if(typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint32Array!=="undefined"){n.littleEndian=h();n.LITTLE_ENDIAN=n.littleEndian}n.support32bit=typeof ArrayBuffer!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Int32Array!=="undefined"&&n.littleEndian!==null&&l();navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate){n.vibration=true}}function h(){var t=new ArrayBuffer(4);var e=new Uint8Array(t);var i=new Uint32Array(t);e[0]=161;e[1]=178;e[2]=195;e[3]=212;if(i[0]==3569595041){return true}if(i[0]==2712847316){return false}else{return null}}function l(){if(typeof Uint8ClampedArray==="undefined"){return false}var t=PIXI.sharedCanvas;var e=t.getContext("2d");if(!e){return false}var i=e.createImageData(1,1);return i.data instanceof Uint8ClampedArray}function u(){var t=document.createElement("p");var e;var i={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(t,null);for(var s in i){if(t.style[s]!==undefined){t.style[s]="translate3d(1px,1px,1px)";e=window.getComputedStyle(t).getPropertyValue(i[s])}}document.body.removeChild(t);n.css3D=e!==undefined&&e.length>0&&e!=="none"}t();a();r();u();o();e();s();i()};L.Device.canPlayAudio=function(t){if(t=="mp3"&&this.mp3){return true}else if(t=="ogg"&&(this.ogg||this.opus)){return true}else if(t=="m4a"&&this.m4a){return true}else if(t=="opus"&&this.opus){return true}else if(t=="wav"&&this.wav){return true}else if(t=="webm"&&this.webm){return true}return false};L.Device.isConsoleOpen=function(){if(window.console&&window.console["firebug"]){return true}if(window.console){console.profile();console.profileEnd();if(console.clear){console.clear()}if(console["profiles"]){return console["profiles"].length>0}}return false};L.Device.isAndroidStockBrowser=function(){var t=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return t&&t[1]<537};L.DOM={getOffset:function(t,e){e=e||new L.Point;try{var i=t.getBoundingClientRect()}catch(t){return{top:0,left:0,right:0,bottom:0}}var s=L.DOM.scrollY;var n=L.DOM.scrollX;var r=document.documentElement.clientTop;var a=document.documentElement.clientLeft;e.x=i.left+n-a;e.y=i.top+s-r;return e},getBounds:function(t,e){if(typeof e==="undefined"){e=0}t=t&&!t.nodeType?t[0]:t;if(!t||t.nodeType!==1){return false}else{return this.calibrate(t.getBoundingClientRect(),e)}},calibrate:function(t,e){e=+e||0;var i={width:0,height:0,left:0,right:0,top:0,bottom:0};i.width=(i.right=t.right+e)-(i.left=t.left-e);i.height=(i.bottom=t.bottom+e)-(i.top=t.top-e);return i},getAspectRatio:function(t){t=null==t?this.visualBounds:1===t.nodeType?this.getBounds(t):t;var e=t["width"];var i=t["height"];if(typeof e==="function"){e=e.call(t)}if(typeof i==="function"){i=i.call(t)}return e/i},inLayoutViewport:function(t,e){var i=this.getBounds(t,e);return!!i&&i.bottom>=0&&i.right>=0&&i.top<=this.layoutBounds.width&&i.left<=this.layoutBounds.height},getScreenOrientation:function(t){var e=window.screen;var i=e.orientation||e.mozOrientation||e.msOrientation;if(i&&typeof i.type==="string"){return i.type}else if(typeof i==="string"){return i}var s="portrait-primary";var n="landscape-primary";if(t==="screen"){return e.height>e.width?s:n}else if(t==="viewport"){return this.visualBounds.height>this.visualBounds.width?s:n}else if(t==="window.orientation"&&typeof window.orientation==="number"){return window.orientation===0||window.orientation===180?s:n}else if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches){return s}else if(window.matchMedia("(orientation: landscape)").matches){return n}}return this.visualBounds.height>this.visualBounds.width?s:n},visualBounds:new L.Rectangle,layoutBounds:new L.Rectangle,documentBounds:new L.Rectangle};L.Device.whenReady(function(t){var e=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft};var i=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(L.DOM,"scrollX",{get:e});Object.defineProperty(L.DOM,"scrollY",{get:i});Object.defineProperty(L.DOM.visualBounds,"x",{get:e});Object.defineProperty(L.DOM.visualBounds,"y",{get:i});Object.defineProperty(L.DOM.layoutBounds,"x",{value:0});Object.defineProperty(L.DOM.layoutBounds,"y",{value:0});var s=t.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight;if(s){var n=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)};var r=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(L.DOM.visualBounds,"width",{get:n});Object.defineProperty(L.DOM.visualBounds,"height",{get:r});Object.defineProperty(L.DOM.layoutBounds,"width",{get:n});Object.defineProperty(L.DOM.layoutBounds,"height",{get:r})}else{Object.defineProperty(L.DOM.visualBounds,"width",{get:function(){return window.innerWidth}});Object.defineProperty(L.DOM.visualBounds,"height",{get:function(){return window.innerHeight}});Object.defineProperty(L.DOM.layoutBounds,"width",{get:function(){var t=document.documentElement.clientWidth;var e=window.innerWidth;return t<e?e:t}});Object.defineProperty(L.DOM.layoutBounds,"height",{get:function(){var t=document.documentElement.clientHeight;var e=window.innerHeight;return t<e?e:t}})}Object.defineProperty(L.DOM.documentBounds,"x",{value:0});Object.defineProperty(L.DOM.documentBounds,"y",{value:0});Object.defineProperty(L.DOM.documentBounds,"width",{get:function(){var t=document.documentElement;return Math.max(t.clientWidth,t.offsetWidth,t.scrollWidth)}});Object.defineProperty(L.DOM.documentBounds,"height",{get:function(){var t=document.documentElement;return Math.max(t.clientHeight,t.offsetHeight,t.scrollHeight)}})},null,true);L.Canvas={create:function(t,e,i){t=t||256;e=e||256;var s=document.createElement("canvas");if(typeof i==="string"&&i!==""){s.id=i}s.width=t;s.height=e;s.style.display="block";return s},setBackgroundColor:function(t,e){e=e||"rgb(0,0,0)";t.style.backgroundColor=e;return t},setTouchAction:function(t,e){e=e||"none";t.style.msTouchAction=e;t.style["ms-touch-action"]=e;t.style["touch-action"]=e;return t},setUserSelect:function(t,e){e=e||"none";t.style["-webkit-touch-callout"]=e;t.style["-webkit-user-select"]=e;t.style["-khtml-user-select"]=e;t.style["-moz-user-select"]=e;t.style["-ms-user-select"]=e;t.style["user-select"]=e;t.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)";return t},addToDOM:function(t,e,i){var s;if(typeof i==="undefined"){i=true}if(e){if(typeof e==="string"){s=document.getElementById(e)}else if(typeof e==="object"&&e.nodeType===1){s=e}}if(!s){s=document.body}if(i&&s.style){s.style.overflow="hidden"}s.appendChild(t);return t},removeFromDOM:function(t){if(t.parentNode){t.parentNode.removeChild(t)}},setTransform:function(t,e,i,s,n,r,a){t.setTransform(s,r,a,n,e,i);return t},setSmoothingEnabled:function(t,e){t["imageSmoothingEnabled"]=e;t["mozImageSmoothingEnabled"]=e;t["oImageSmoothingEnabled"]=e;t["webkitImageSmoothingEnabled"]=e;t["msImageSmoothingEnabled"]=e;return t},getSmoothingEnabled:function(t){return t["imageSmoothingEnabled"]||t["mozImageSmoothingEnabled"]||t["oImageSmoothingEnabled"]||t["webkitImageSmoothingEnabled"]||t["msImageSmoothingEnabled"]},setImageRenderingCrisp:function(t){t.style["image-rendering"]="optimizeSpeed";t.style["image-rendering"]="crisp-edges";t.style["image-rendering"]="-moz-crisp-edges";t.style["image-rendering"]="-webkit-optimize-contrast";t.style["image-rendering"]="optimize-contrast";t.style["image-rendering"]="pixelated";t.style.msInterpolationMode="nearest-neighbor";return t},setImageRenderingBicubic:function(t){t.style["image-rendering"]="auto";t.style.msInterpolationMode="bicubic";return t}};L.Canvas.getOffset=L.DOM.getOffset;L.Canvas.getAspectRatio=L.DOM.getAspectRatio;L.RequestAnimationFrame=function(t,e){if(typeof e==="undefined"){e=false}this.game=t;this.isRunning=false;this.forceSetTimeOut=e;var i=["ms","moz","webkit","o"];for(var s=0;s<i.length&&!window.requestAnimationFrame;s++){window.requestAnimationFrame=window[i[s]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[i[s]+"CancelAnimationFrame"]}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};L.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var e=this;if(!window.requestAnimationFrame||this.forceSetTimeOut){this._isSetTimeOut=true;this._onLoop=function(){return e.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(t){return e.updateRAF(t)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(t){this.game.update(Math.floor(t));this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===false}};L.RequestAnimationFrame.prototype.constructor=L.RequestAnimationFrame;L.Math={PI2:Math.PI*2,fuzzyEqual:function(t,e,i){if(typeof i==="undefined"){i=1e-4}return Math.abs(t-e)<i},fuzzyLessThan:function(t,e,i){if(typeof i==="undefined"){i=1e-4}return t<e+i},fuzzyGreaterThan:function(t,e,i){if(typeof i==="undefined"){i=1e-4}return t>e-i},fuzzyCeil:function(t,e){if(typeof e==="undefined"){e=1e-4}return Math.ceil(t-e)},fuzzyFloor:function(t,e){if(typeof e==="undefined"){e=1e-4}return Math.floor(t+e)},average:function(){var t=0;for(var e=0;e<arguments.length;e++){t+=+arguments[e]}return t/arguments.length},truncate:function(t){return Math.trunc(t)},shear:function(t){return t%1},snapTo:function(t,e,i){if(typeof i==="undefined"){i=0}if(e===0){return t}t-=i;t=e*Math.round(t/e);return i+t},snapToFloor:function(t,e,i){if(typeof i==="undefined"){i=0}if(e===0){return t}t-=i;t=e*Math.floor(t/e);return i+t},snapToCeil:function(t,e,i){if(typeof i==="undefined"){i=0}if(e===0){return t}t-=i;t=e*Math.ceil(t/e);return i+t},snapToInArray:function(t,e,i){if(typeof i==="undefined"){i=true}if(i){e.sort()}return L.ArrayUtils.findClosest(t,e)},roundTo:function(t,e,i){if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i=10}var s=Math.pow(i,-e);return Math.round(t*s)/s},floorTo:function(t,e,i){if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i=10}var s=Math.pow(i,-e);return Math.floor(t*s)/s},ceilTo:function(t,e,i){if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i=10}var s=Math.pow(i,-e);return Math.ceil(t*s)/s},interpolateFloat:function(t,e,i){return(e-t)*i+t},angleBetween:function(t,e,i,s){return Math.atan2(s-e,i-t)},angleBetweenY:function(t,e,i,s){return Math.atan2(i-t,s-e)},angleBetweenPoints:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenPointsY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},reverseAngle:function(t){return this.normalizeAngle(t+Math.PI,true)},normalizeAngle:function(t){t=t%(2*Math.PI);return t>=0?t:t+2*Math.PI},normalizeLatitude:function(t){return L.Math.clamp(t,-90,90)},normalizeLongitude:function(t){return L.Math.wrap(t,-180,180)},chanceRoll:function(t){return L.Utils.chanceRoll(t)},numberArray:function(t,e){return L.ArrayUtils.numberArray(t,e)},numberArrayStep:function(t,e,i){return L.ArrayUtils.numberArrayStep(t,e,i)},maxAdd:function(t,e,i){return Math.min(t+e,i)},minSub:function(t,e,i){return Math.max(t-e,i)},wrap:function(t,e,i){var s=i-e;if(s<=0){return 0}var n=(t-e)%s;if(n<0){n+=s}return n+e},wrapValue:function(t,e,i){var s;t=Math.abs(t);e=Math.abs(e);i=Math.abs(i);s=(t+e)%i;return s},limitValue:function(t,e,i){return L.Math.clamp(t,e,i)},randomSign:function(){return L.Utils.randomChoice(-1,1)},isOdd:function(t){return t&1},isEven:function(t){return!(t&1)},min:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var t=arguments[0]}else{var t=arguments}for(var e=1,i=0,s=t.length;e<s;e++){if(t[e]<t[i]){i=e}}return t[i]},max:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var t=arguments[0]}else{var t=arguments}for(var e=1,i=0,s=t.length;e<s;e++){if(t[e]>t[i]){i=e}}return t[i]},minProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var e=arguments[1]}else{var e=arguments.slice(1)}for(var i=1,s=0,n=e.length;i<n;i++){if(e[i][t]<e[s][t]){s=i}}return e[s][t]},maxProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var e=arguments[1]}else{var e=arguments.slice(1)}for(var i=1,s=0,n=e.length;i<n;i++){if(e[i][t]>e[s][t]){s=i}}return e[s][t]},wrapAngle:function(t,e){return e?this.wrap(t,-Math.PI,Math.PI):this.wrap(t,-180,180)},angleLimit:function(t,e,i){var s=t;if(t>i){s=i}else if(t<e){s=e}return s},linearInterpolation:function(t,e){var i=t.length-1;var s=i*e;var n=Math.floor(s);if(e<0){return this.linear(t[0],t[1],s)}if(e>1){return this.linear(t[i],t[i-1],i-s)}return this.linear(t[n],t[n+1>i?i:n+1],s-n)},bezierInterpolation:function(t,e){var i=0;var s=t.length-1;for(var n=0;n<=s;n++){i+=Math.pow(1-e,s-n)*Math.pow(e,n)*t[n]*this.bernstein(s,n)}return i},catmullRomInterpolation:function(t,e){var i=t.length-1;var s=i*e;var n=Math.floor(s);if(t[0]===t[i]){if(e<0){n=Math.floor(s=i*(1+e))}return this.catmullRom(t[(n-1+i)%i],t[n],t[(n+1)%i],t[(n+2)%i],s-n)}else{if(e<0){return t[0]-(this.catmullRom(t[0],t[0],t[1],t[1],-s)-t[0])}if(e>1){return t[i]-(this.catmullRom(t[i],t[i],t[i-1],t[i-1],s-i)-t[i])}return this.catmullRom(t[n?n-1:0],t[n],t[i<n+1?i:n+1],t[i<n+2?i:n+2],s-n)}},linear:function(t,e,i){return(e-t)*i+t},bernstein:function(t,e){return this.factorial(t)/this.factorial(e)/this.factorial(t-e)},factorial:function(t){if(t===0){return 1}var e=t;while(--t){e*=t}return e},catmullRom:function(t,e,i,s,n){var r=(i-t)*.5,a=(s-e)*.5,o=n*n,h=n*o;return(2*e-2*i+r+a)*h+(-3*e+3*i-2*r-a)*o+r*n+e},difference:function(t,e){return Math.abs(t-e)},getRandom:function(t,e,i){return L.ArrayUtils.getRandomItem(t,e,i)},removeRandom:function(t,e,i){return L.ArrayUtils.removeRandomItem(t,e,i)},floor:function(t){return Math.trunc(t)},ceil:function(t){return L.Math.roundAwayFromZero(t)},roundAwayFromZero:function(t){return t>0?Math.ceil(t):Math.floor(t)},sinCosGenerator:function(t,e,i,s){if(typeof e==="undefined"){e=1}if(typeof i==="undefined"){i=1}if(typeof s==="undefined"){s=1}var n=e;var r=i;var a=s*Math.PI/t;var o=[];var h=[];for(var l=0;l<t;l++){r-=n*a;n+=r*a;o[l]=r;h[l]=n}return{sin:h,cos:o,length:t}},shift:function(t){var e=t.shift();t.push(e);return e},shuffleArray:function(t){return L.ArrayUtils.shuffle(t)},distance:function(t,e,i,s){var n=t-i;var r=e-s;return Math.sqrt(n*n+r*r)},distancePow:function(t,e,i,s,n){if(typeof n==="undefined"){n=2}return Math.sqrt(Math.pow(i-t,n)+Math.pow(s-e,n))},distanceRounded:function(t,e,i,s){return Math.round(L.Math.distance(t,e,i,s))},clamp:function(t,e,i){return t<e?e:t>i?i:t},clampBottom:function(t,e){return t<e?e:t},within:function(t,e,i){return Math.abs(t-e)<=i},mapLinear:function(t,e,i,s,n){return s+(t-e)*(n-s)/(i-e)},smoothstep:function(t,e,i){t=Math.max(0,Math.min(1,(t-e)/(i-e)));return t*t*(3-2*t)},smootherstep:function(t,e,i){t=Math.max(0,Math.min(1,(t-e)/(i-e)));return t*t*t*(t*(t*6-15)+10)},sign:function(t){return t<0?-1:t>0?1:0},percent:function(t,e,i){if(typeof i==="undefined"){i=0}if(t>e||i>e){return 1}else if(t<i||i>t){return 0}else{return(t-i)/e}}};var n=Math.PI/180;var r=180/Math.PI;L.Math.degToRad=function t(e){return e*n};L.Math.radToDeg=function t(e){return e*r};L.RandomDataGenerator=function(t){if(typeof t==="undefined"){t=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;this.sow(t)};L.RandomDataGenerator.prototype={rnd:function(){var t=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=t|0;this.s0=this.s1;this.s1=this.s2;this.s2=t-this.c;return this.s2},sow:function(t){this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;if(!t){return}for(var e=0;e<t.length&&t[e]!=null;e++){var i=t[e];this.s0-=this.hash(i);this.s0+=~~(this.s0<0);this.s1-=this.hash(i);this.s1+=~~(this.s1<0);this.s2-=this.hash(i);this.s2+=~~(this.s2<0)}},hash:function(t){var e,i,s;s=4022871197;t=t.toString();for(i=0;i<t.length;i++){s+=t.charCodeAt(i);e=.02519603282416938*s;s=e>>>0;e-=s;e*=s;s=e>>>0;e-=s;s+=e*4294967296}return(s>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*11102230246251565e-32},real:function(){return this.integer()+this.frac()},integerInRange:function(t,e){return Math.floor(this.realInRange(0,e-t+1)+t)},between:function(t,e){return this.integerInRange(t,e)},realInRange:function(t,e){return this.frac()*(e-t)+t},normal:function(){return 1-2*this.frac()},uuid:function(){var t="";var e="";for(e=t="";t++<36;e+=~t%5|t*3&4?(t^15?8^this.frac()*(t^20?16:4):4).toString(16):"-"){}return e},pick:function(t){return t[this.integerInRange(0,t.length-1)]},weightedPick:function(t){return t[~~(Math.pow(this.frac(),2)*(t.length-1))]},timestamp:function(t,e){return this.realInRange(t||9466848e5,e||1577862e6)},angle:function(){return this.integerInRange(-180,180)}};L.RandomDataGenerator.prototype.constructor=L.RandomDataGenerator;L.QuadTree=function(t,e,i,s,n,r,a){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(t,e,i,s,n,r,a)};L.QuadTree.prototype={reset:function(t,e,i,s,n,r,a){this.maxObjects=n||10;this.maxLevels=r||4;this.level=a||0;this.bounds={x:Math.round(t),y:Math.round(e),width:i,height:s,subWidth:Math.floor(i/2),subHeight:Math.floor(s/2),right:Math.round(t)+Math.floor(i/2),bottom:Math.round(e)+Math.floor(s/2)};this.objects.length=0;this.nodes.length=0},populate:function(t){t.forEach(this.populateHandler,this,true)},populateHandler:function(t){if(t.body&&t.exists){this.insert(t.body)}},split:function(){this.nodes[0]=new L.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[1]=new L.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[2]=new L.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[3]=new L.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(t){var e=0;var i;if(this.nodes[0]!=null){i=this.getIndex(t);if(i!==-1){this.nodes[i].insert(t);return}}this.objects.push(t);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(e<this.objects.length){i=this.getIndex(this.objects[e]);if(i!==-1){this.nodes[i].insert(this.objects.splice(e,1)[0])}else{e++}}}},getIndex:function(t){var e=-1;if(t.x<this.bounds.right&&t.right<this.bounds.right){if(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom){e=1}else if(t.y>this.bounds.bottom){e=2}}else if(t.x>this.bounds.right){if(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom){e=0}else if(t.y>this.bounds.bottom){e=3}}return e},retrieve:function(t){if(t instanceof L.Rectangle){var e=this.objects;var i=this.getIndex(t)}else{if(!t.body){return this._empty}var e=this.objects;var i=this.getIndex(t.body)}if(this.nodes[0]){if(i!==-1){e=e.concat(this.nodes[i].retrieve(t))}else{e=e.concat(this.nodes[0].retrieve(t));e=e.concat(this.nodes[1].retrieve(t));e=e.concat(this.nodes[2].retrieve(t));e=e.concat(this.nodes[3].retrieve(t))}}return e},clear:function(){this.objects.length=0;var t=this.nodes.length;while(t--){this.nodes[t].clear();this.nodes.splice(t,1)}this.nodes.length=0}};L.QuadTree.prototype.constructor=L.QuadTree;L.Net=function(t){this.game=t};L.Net.prototype={getHostName:function(){if(window.location&&window.location.hostname){return window.location.hostname}return null},checkDomainName:function(t){return window.location.hostname.indexOf(t)!==-1},updateQueryString:function(t,e,i,s){if(typeof i==="undefined"){i=false}if(typeof s==="undefined"||s===""){s=window.location.href}var n="";var r=new RegExp("([?|&])"+t+"=.*?(&|#|$)(.*)","gi");if(r.test(s)){if(typeof e!=="undefined"&&e!==null){n=s.replace(r,"$1"+t+"="+e+"$2$3")}else{n=s.replace(r,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof e!=="undefined"&&e!==null){var a=s.indexOf("?")!==-1?"&":"?";var o=s.split("#");s=o[0]+a+t+"="+e;if(o[1]){s+="#"+o[1]}n=s}else{n=s}}if(i){window.location.href=n}else{return n}},getQueryString:function(t){if(typeof t==="undefined"){t=""}var e={};var i=location.search.substring(1).split("&");for(var s in i){var n=i[s].split("=");if(n.length>1){if(t&&t==this.decodeURI(n[0])){return this.decodeURI(n[1])}else{e[this.decodeURI(n[0])]=this.decodeURI(n[1])}}}return e},decodeURI:function(t){return decodeURIComponent(t.replace(/\+/g," "))}};L.Net.prototype.constructor=L.Net;L.TweenManager=function(t){this.game=t;this._tweens=[];this._add=[];this.easeMap={Power0:L.Easing.Power0,Power1:L.Easing.Power1,Power2:L.Easing.Power2,Power3:L.Easing.Power3,Power4:L.Easing.Power4,Linear:L.Easing.Linear.None,Quad:L.Easing.Quadratic.Out,Cubic:L.Easing.Cubic.Out,Quart:L.Easing.Quartic.Out,Quint:L.Easing.Quintic.Out,Sine:L.Easing.Sinusoidal.Out,Expo:L.Easing.Exponential.Out,Circ:L.Easing.Circular.Out,Elastic:L.Easing.Elastic.Out,Back:L.Easing.Back.Out,Bounce:L.Easing.Bounce.Out,"Quad.easeIn":L.Easing.Quadratic.In,"Cubic.easeIn":L.Easing.Cubic.In,"Quart.easeIn":L.Easing.Quartic.In,"Quint.easeIn":L.Easing.Quintic.In,"Sine.easeIn":L.Easing.Sinusoidal.In,"Expo.easeIn":L.Easing.Exponential.In,"Circ.easeIn":L.Easing.Circular.In,"Elastic.easeIn":L.Easing.Elastic.In,"Back.easeIn":L.Easing.Back.In,"Bounce.easeIn":L.Easing.Bounce.In,"Quad.easeOut":L.Easing.Quadratic.Out,"Cubic.easeOut":L.Easing.Cubic.Out,"Quart.easeOut":L.Easing.Quartic.Out,"Quint.easeOut":L.Easing.Quintic.Out,"Sine.easeOut":L.Easing.Sinusoidal.Out,"Expo.easeOut":L.Easing.Exponential.Out,"Circ.easeOut":L.Easing.Circular.Out,"Elastic.easeOut":L.Easing.Elastic.Out,"Back.easeOut":L.Easing.Back.Out,"Bounce.easeOut":L.Easing.Bounce.Out,"Quad.easeInOut":L.Easing.Quadratic.InOut,"Cubic.easeInOut":L.Easing.Cubic.InOut,"Quart.easeInOut":L.Easing.Quartic.InOut,"Quint.easeInOut":L.Easing.Quintic.InOut,"Sine.easeInOut":L.Easing.Sinusoidal.InOut,"Expo.easeInOut":L.Easing.Exponential.InOut,"Circ.easeInOut":L.Easing.Circular.InOut,"Elastic.easeInOut":L.Easing.Elastic.InOut,"Back.easeInOut":L.Easing.Back.InOut,"Bounce.easeInOut":L.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};L.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var t=0;t<this._tweens.length;t++){this._tweens[t].pendingDelete=true}this._add=[]},removeFrom:function(t,e){if(typeof e==="undefined"){e=true}var i;var s;if(Array.isArray(t)){for(i=0,s=t.length;i<s;i++){this.removeFrom(t[i])}}else if(t.type===L.GROUP&&e){for(var i=0,s=t.children.length;i<s;i++){this.removeFrom(t.children[i])}}else{for(i=0,s=this._tweens.length;i<s;i++){if(t===this._tweens[i].target){this.remove(this._tweens[i])}}for(i=0,s=this._add.length;i<s;i++){if(t===this._add[i].target){this.remove(this._add[i])}}}},add:function(t){t._manager=this;this._add.push(t)},create:function(t){return new L.Tween(t,this.game,this)},remove:function(t){var e=this._tweens.indexOf(t);if(e!==-1){this._tweens[e].pendingDelete=true}else{e=this._add.indexOf(t);if(e!==-1){this._add[e].pendingDelete=true}}},update:function(){var t=this._add.length;var e=this._tweens.length;if(e===0&&t===0){return false}var i=0;while(i<e){if(this._tweens[i].update(this.game.time.time)){i++}else{this._tweens.splice(i,1);e--}}if(t>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(e){return this._tweens.some(function(t){return t.target===e})},_pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t]._pause()}},_resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t]._resume()}},pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t].pause()}},resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t].resume(true)}}};L.TweenManager.prototype.constructor=L.TweenManager;L.Tween=function(t,e,i){this.game=e;this.target=t;this.manager=i;this.timeline=[];this.reverse=false;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=false;this.onStart=new L.Signal;this.onLoop=new L.Signal;this.onRepeat=new L.Signal;this.onChildComplete=new L.Signal;this.onComplete=new L.Signal;this.isRunning=false;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this._codePaused=false};L.Tween.prototype={to:function(t,e,i,s,n,r,a){if(typeof e==="undefined"){e=1e3}if(typeof i==="undefined"){i=L.Easing.Default}if(typeof s==="undefined"){s=false}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}if(typeof a==="undefined"){a=false}if(typeof i==="string"&&this.manager.easeMap[i]){i=this.manager.easeMap[i]}if(this.isRunning){console.warn("Phaser.Tween.to cannot be called after Tween.start");return this}this.timeline.push(new L.TweenData(this).to(t,e,i,n,r,a));if(s){this.start()}return this},from:function(t,e,i,s,n,r,a){if(typeof e==="undefined"){e=1e3}if(typeof i==="undefined"){i=L.Easing.Default}if(typeof s==="undefined"){s=false}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}if(typeof a==="undefined"){a=false}if(typeof i==="string"&&this.manager.easeMap[i]){i=this.manager.easeMap[i]}if(this.isRunning){console.warn("Phaser.Tween.from cannot be called after Tween.start");return this}this.timeline.push(new L.TweenData(this).from(t,e,i,n,r,a));if(s){this.start()}return this},start:function(t){if(typeof t==="undefined"){t=0}if(this.game===null||this.target===null||this.timeline.length===0||this.isRunning){return this}for(var e=0;e<this.timeline.length;e++){for(var i in this.timeline[e].vEnd){this.properties[i]=this.target[i]||0;if(!Array.isArray(this.properties[i])){this.properties[i]*=1}}}for(var e=0;e<this.timeline.length;e++){this.timeline[e].loadValues()}this.manager.add(this);this.isRunning=true;if(t<0||t>this.timeline.length-1){t=0}this.current=t;this.timeline[this.current].start();this.onStart.dispatch(this.target,this);return this},stop:function(t){if(typeof t==="undefined"){t=false}this.isRunning=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;if(t){this.onComplete.dispatch(this.target,this);if(this.chainedTween){this.chainedTween.start()}}this.manager.remove(this);return this},updateTweenData:function(t,e,i){if(this.timeline.length===0){return this}if(typeof i==="undefined"){i=0}if(i===-1){for(var s=0;s<this.timeline.length;s++){this.timeline[s][t]=e}}else{this.timeline[i][t]=e}return this},delay:function(t,e){return this.updateTweenData("delay",t,e)},repeat:function(t,e,i){if(typeof e==="undefined"){e=0}this.updateTweenData("repeatCounter",t,i);return this.updateTweenData("repeatDelay",e,i)},repeatDelay:function(t,e){return this.updateTweenData("repeatDelay",t,e)},yoyo:function(t,e,i){if(typeof e==="undefined"){e=0}this.updateTweenData("yoyo",t,i);return this.updateTweenData("yoyoDelay",e,i)},yoyoDelay:function(t,e){return this.updateTweenData("yoyoDelay",t,e)},easing:function(t,e){if(typeof t==="string"&&this.manager.easeMap[t]){t=this.manager.easeMap[t]}return this.updateTweenData("easingFunction",t,e)},interpolation:function(t,e,i){if(typeof e==="undefined"){e=L.Math}this.updateTweenData("interpolationFunction",t,i);return this.updateTweenData("interpolationContext",e,i)},repeatAll:function(t){if(typeof t==="undefined"){t=0}this.repeatCounter=t;return this},chain:function(){var t=arguments.length;while(t--){if(t>0){arguments[t-1].chainedTween=arguments[t]}else{this.chainedTween=arguments[t]}}return this},loop:function(t){if(typeof t==="undefined"){t=true}if(t){this.repeatAll(-1)}else{this.repeatCounter=0}return this},onUpdateCallback:function(t,e){this._onUpdateCallback=t;this._onUpdateCallbackContext=e;return this},pause:function(){this.isPaused=true;this._codePaused=true;this._pausedTime=this.game.time.time},_pause:function(){if(!this._codePaused){this.isPaused=true;this._pausedTime=this.game.time.time}},resume:function(){if(this.isPaused){this.isPaused=false;this._codePaused=false;for(var t=0;t<this.timeline.length;t++){if(!this.timeline[t].isRunning){this.timeline[t].startTime+=this.game.time.time-this._pausedTime}}}},_resume:function(){if(this._codePaused){return}else{this.resume()}},update:function(t){if(this.pendingDelete){return false}if(this.isPaused){return true}var e=this.timeline[this.current].update(t);if(e===L.TweenData.PENDING){return true}else if(e===L.TweenData.RUNNING){if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current])}return this.isRunning}else if(e===L.TweenData.LOOPED){this.onLoop.dispatch(this.target,this);return true}else if(e===L.TweenData.COMPLETE){var i=false;if(this.reverse){this.current--;if(this.current<0){this.current=this.timeline.length-1;i=true}}else{this.current++;if(this.current===this.timeline.length){this.current=0;i=true}}if(i){if(this.repeatCounter===-1){this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else if(this.repeatCounter>0){this.repeatCounter--;this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else{this.isRunning=false;this.onComplete.dispatch(this.target,this);if(this.chainedTween){this.chainedTween.start()}return false}}else{this.onChildComplete.dispatch(this.target,this);this.timeline[this.current].start();return true}}},generateData:function(t,e){if(this.game===null||this.target===null){return null}if(typeof e==="undefined"){e=[]}for(var i=0;i<this.timeline.length;i++){for(var s in this.timeline[i].vEnd){this.properties[s]=this.target[s]||0;if(!Array.isArray(this.properties[s])){this.properties[s]*=1}}}for(var i=0;i<this.timeline.length;i++){this.timeline[i].loadValues()}for(var i=0;i<this.timeline.length;i++){e=e.concat(this.timeline[i].generateData(t))}return e}};Object.defineProperty(L.Tween.prototype,"totalDuration",{get:function(){var t=0;for(var e=0;e<this.timeline.length;e++){t+=this.timeline[e].duration}return t}});L.Tween.prototype.constructor=L.Tween;L.TweenData=function(t){this.parent=t;this.game=t.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1e3;this.percent=0;this.value=0;this.repeatCounter=0;this.repeatDelay=0;this.interpolate=false;this.yoyo=false;this.yoyoDelay=0;this.inReverse=false;this.delay=0;this.dt=0;this.startTime=null;this.easingFunction=L.Easing.Default;this.interpolationFunction=L.Math.linearInterpolation;this.interpolationContext=L.Math;this.isRunning=false;this.isFrom=false};L.TweenData.PENDING=0;L.TweenData.RUNNING=1;L.TweenData.LOOPED=2;L.TweenData.COMPLETE=3;L.TweenData.prototype={to:function(t,e,i,s,n,r){this.vEnd=t;this.duration=e;this.easingFunction=i;this.delay=s;this.repeatCounter=n;this.yoyo=r;this.isFrom=false;return this},from:function(t,e,i,s,n,r){this.vEnd=t;this.duration=e;this.easingFunction=i;this.delay=s;this.repeatCounter=n;this.yoyo=r;this.isFrom=true;return this},start:function(){this.startTime=this.game.time.time+this.delay;if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}if(this.delay>0){this.isRunning=false}else{this.isRunning=true}if(this.isFrom){for(var t in this.vStartCache){this.vStart[t]=this.vEndCache[t];this.vEnd[t]=this.vStartCache[t];this.parent.target[t]=this.vStart[t]}}this.value=0;this.yoyoCounter=0;return this},loadValues:function(){for(var t in this.parent.properties){this.vStart[t]=this.parent.properties[t];if(Array.isArray(this.vEnd[t])){if(this.vEnd[t].length===0){continue}this.vEnd[t]=[this.vStart[t]].concat(this.vEnd[t])}if(typeof this.vEnd[t]!=="undefined"){if(typeof this.vEnd[t]==="string"){this.vEnd[t]=this.vStart[t]+parseFloat(this.vEnd[t],10)}this.parent.properties[t]=this.vEnd[t]}else{this.vEnd[t]=this.vStart[t]}this.vStartCache[t]=this.vStart[t];this.vEndCache[t]=this.vEnd[t]}return this},update:function(){if(!this.isRunning){if(this.game.time.time>=this.startTime){this.isRunning=true}else{return L.TweenData.PENDING}}else{if(this.game.time.time<this.startTime){return L.TweenData.RUNNING}}if(this.parent.reverse){this.dt-=this.game.time.physicsElapsedMS*this.parent.timeScale;this.dt=Math.max(this.dt,0)}else{this.dt+=this.game.time.physicsElapsedMS*this.parent.timeScale;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var t in this.vEnd){var e=this.vStart[t];var i=this.vEnd[t];if(Array.isArray(i)){this.parent.target[t]=this.interpolationFunction.call(this.interpolationContext,i,this.value)}else{this.parent.target[t]=e+(i-e)*this.value}}if(!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0){return this.repeat()}return L.TweenData.RUNNING},generateData:function(t){if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}var e=[];var i=false;var s=1/t*1e3;do{if(this.parent.reverse){this.dt-=s;this.dt=Math.max(this.dt,0)}else{this.dt+=s;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var n={};for(var r in this.vEnd){var a=this.vStart[r];var o=this.vEnd[r];if(Array.isArray(o)){n[r]=this.interpolationFunction(o,this.value)}else{n[r]=a+(o-a)*this.value}}e.push(n);if(!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0){i=true}}while(!i);if(this.yoyo){var h=e.slice();h.reverse();e=e.concat(h)}return e},repeat:function(){if(this.yoyo){if(this.inReverse&&this.repeatCounter===0){return L.TweenData.COMPLETE}this.inReverse=!this.inReverse}else{if(this.repeatCounter===0){return L.TweenData.COMPLETE}}if(this.inReverse){for(var t in this.vStartCache){this.vStart[t]=this.vEndCache[t];this.vEnd[t]=this.vStartCache[t]}}else{for(var t in this.vStartCache){this.vStart[t]=this.vStartCache[t];this.vEnd[t]=this.vEndCache[t]}if(this.repeatCounter>0){this.repeatCounter--}}this.startTime=this.game.time.time;if(this.yoyo&&this.inReverse){this.startTime+=this.yoyoDelay}else if(!this.inReverse){this.startTime+=this.repeatDelay}if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}return L.TweenData.LOOPED}};L.TweenData.prototype.constructor=L.TweenData;L.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){if((t*=2)<1)return.5*t*t;return-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){if((t*=2)<1)return.5*t*t*t;return.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){if((t*=2)<1)return.5*t*t*t*t;return-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){if((t*=2)<1)return.5*t*t*t*t*t;return.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){if(t===0)return 0;if(t===1)return 1;return 1-Math.cos(t*Math.PI/2)},Out:function(t){if(t===0)return 0;if(t===1)return 1;return Math.sin(t*Math.PI/2)},InOut:function(t){if(t===0)return 0;if(t===1)return 1;return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return t===0?0:Math.pow(1024,t-1)},Out:function(t){return t===1?1:1-Math.pow(2,-10*t)},InOut:function(t){if(t===0)return 0;if(t===1)return 1;if((t*=2)<1)return.5*Math.pow(1024,t-1);return.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){if((t*=2)<1)return-.5*(Math.sqrt(1-t*t)-1);return.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1,s=.4;if(t===0)return 0;if(t===1)return 1;if(!i||i<1){i=1;e=s/4}else e=s*Math.asin(1/i)/(2*Math.PI);return-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s))},Out:function(t){var e,i=.1,s=.4;if(t===0)return 0;if(t===1)return 1;if(!i||i<1){i=1;e=s/4}else e=s*Math.asin(1/i)/(2*Math.PI);return i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/s)+1},InOut:function(t){var e,i=.1,s=.4;if(t===0)return 0;if(t===1)return 1;if(!i||i<1){i=1;e=s/4}else e=s*Math.asin(1/i)/(2*Math.PI);if((t*=2)<1)return-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s));return i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s)*.5+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=1.70158*1.525;if((t*=2)<1)return.5*(t*t*((e+1)*t-e));return.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-L.Easing.Bounce.Out(1-t)},Out:function(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){return 7.5625*(t-=1.5/2.75)*t+.75}else if(t<2.5/2.75){return 7.5625*(t-=2.25/2.75)*t+.9375}else{return 7.5625*(t-=2.625/2.75)*t+.984375}},InOut:function(t){if(t<.5)return L.Easing.Bounce.In(t*2)*.5;return L.Easing.Bounce.Out(t*2-1)*.5+.5}}};L.Easing.Default=L.Easing.Linear.None;L.Easing.Power0=L.Easing.Linear.None;L.Easing.Power1=L.Easing.Quadratic.Out;L.Easing.Power2=L.Easing.Cubic.Out;L.Easing.Power3=L.Easing.Quartic.Out;L.Easing.Power4=L.Easing.Quintic.Out;L.Time=function(t){this.game=t;this.time=0;this.prevTime=0;this.now=0;this.elapsed=0;this.elapsedMS=0;this.physicsElapsed=0;this.physicsElapsedMS=0;this.desiredFps=60;this.suggestedFps=null;this.slowMotion=1;this.advancedTiming=false;this.frames=0;this.fps=0;this.fpsMin=1e3;this.fpsMax=0;this.msMin=1e3;this.msMax=0;this.pauseDuration=0;this.timeToCall=0;this.timeExpected=0;this.events=new L.Timer(this.game,false);this._frameCount=0;this._elapsedAccumulator=0;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=false;this._timers=[]};L.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start()},add:function(t){this._timers.push(t);return t},create:function(t){if(typeof t==="undefined"){t=true}var e=new L.Timer(this.game,t);this._timers.push(e);return e},removeAll:function(){for(var t=0;t<this._timers.length;t++){this._timers[t].destroy()}this._timers=[];this.events.removeAll()},update:function(t){var e=this.time;this.time=Date.now();this.elapsedMS=this.time-e;this.prevTime=this.now;this.now=t;this.elapsed=this.now-this.prevTime;this.timeToCall=Math.floor(Math.max(0,1e3/this.desiredFps-(this.timeCallExpected-t)));this.timeCallExpected=t+this.timeToCall;this._frameCount++;this._elapsedAccumulator+=this.elapsed;if(this._frameCount>=this.desiredFps*2){this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5;this._frameCount=0;this._elapsedAccumulator=0}this.physicsElapsed=1/this.desiredFps;this.physicsElapsedMS=this.physicsElapsed*1e3;if(this.advancedTiming){this.msMin=Math.min(this.msMin,this.elapsed);this.msMax=Math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1e3){this.fps=Math.round(this.frames*1e3/(this.now-this._timeLastSecond));this.fpsMin=Math.min(this.fpsMin,this.fps);this.fpsMax=Math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0}}if(!this.game.paused){this.events.update(this.time);var i=0;var s=this._timers.length;while(i<s){if(this._timers[i].update(this.time)){i++}else{this._timers.splice(i,1);s--}}}},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();var t=this._timers.length;while(t--){this._timers[t]._pause()}},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();var t=this._timers.length;while(t--){this._timers[t]._resume()}},totalElapsedSeconds:function(){return(this.time-this._started)*.001},elapsedSince:function(t){return this.time-t},elapsedSecondsSince:function(t){return(this.time-t)*.001},reset:function(){this._started=this.time;this.removeAll()}};L.Time.prototype.constructor=L.Time;L.Timer=function(t,e){if(typeof e==="undefined"){e=true}this.game=t;this.running=false;this.autoDestroy=e;this.expired=false;this.elapsed=0;this.events=[];this.onComplete=new L.Signal;this.nextTick=0;this.timeCap=1e3;this.paused=false;this._codePaused=false;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};L.Timer.MINUTE=6e4;L.Timer.SECOND=1e3;L.Timer.HALF=500;L.Timer.QUARTER=250;L.Timer.prototype={create:function(t,e,i,s,n,r){t=Math.round(t);var a=t;if(this._now===0){a+=this.game.time.time}else{a+=this._now}var o=new L.TimerEvent(this,t,a,i,e,s,n,r);this.events.push(o);this.order();this.expired=false;return o},add:function(t,e,i){return this.create(t,false,0,e,i,Array.prototype.splice.call(arguments,3))},repeat:function(t,e,i,s){return this.create(t,false,e,i,s,Array.prototype.splice.call(arguments,4))},loop:function(t,e,i){return this.create(t,true,0,e,i,Array.prototype.splice.call(arguments,3))},start:function(t){if(this.running){return}this._started=this.game.time.time+(t||0);this.running=true;for(var e=0;e<this.events.length;e++){this.events[e].tick=this.events[e].delay+this._started}},stop:function(t){this.running=false;if(typeof t==="undefined"){t=true}if(t){this.events.length=0}},remove:function(t){for(var e=0;e<this.events.length;e++){if(this.events[e]===t){this.events[e].pendingDelete=true;return true}}return false},order:function(){if(this.events.length>0){this.events.sort(this.sortHandler);this.nextTick=this.events[0].tick}},sortHandler:function(t,e){if(t.tick<e.tick){return-1}else if(t.tick>e.tick){return 1}return 0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--){if(this.events[this._i].pendingDelete){this.events.splice(this._i,1)}}this._len=this.events.length;this._i=0},update:function(t){if(this.paused){return true}this.elapsed=t-this._now;this._now=t;if(this.elapsed>this.timeCap){this.adjustEvents(t-this.elapsed)}this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){if(this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete){this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick);if(this._newTick<0){this._newTick=this._now+this.events[this._i].delay}if(this.events[this._i].loop===true){this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else if(this.events[this._i].repeatCount>0){this.events[this._i].repeatCount--;this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{this._marked++;this.events[this._i].pendingDelete=true;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}this._i++}else{break}}if(this.events.length>this._marked){this.order()}else{this.expired=true;this.onComplete.dispatch(this)}}if(this.expired&&this.autoDestroy){return false}else{return true}},pause:function(){if(!this.running){return}this._codePaused=true;if(this.paused){return}this._pauseStarted=this.game.time.time;this.paused=true},_pause:function(){if(this.paused||!this.running){return}this._pauseStarted=this.game.time.time;this.paused=true},adjustEvents:function(t){for(var e=0;e<this.events.length;e++){if(!this.events[e].pendingDelete){var i=this.events[e].tick-t;if(i<0){i=0}this.events[e].tick=this._now+i}}var s=this.nextTick-t;if(s<0){this.nextTick=this._now}else{this.nextTick=this._now+s}},resume:function(){if(!this.paused){return}var t=this.game.time.time;this._pauseTotal+=t-this._now;this._now=t;this.adjustEvents(this._pauseStarted);this.paused=false;this._codePaused=false},_resume:function(){if(this._codePaused){return}else{this.resume()}},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=false;this.events=[];this._len=0;this._i=0}};Object.defineProperty(L.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(L.Timer.prototype,"duration",{get:function(){if(this.running&&this.nextTick>this._now){return this.nextTick-this._now}else{return 0}}});Object.defineProperty(L.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(L.Timer.prototype,"ms",{get:function(){if(this.running){return this._now-this._started-this._pauseTotal}else{return 0}}});Object.defineProperty(L.Timer.prototype,"seconds",{get:function(){if(this.running){return this.ms*.001}else{return 0}}});L.Timer.prototype.constructor=L.Timer;L.TimerEvent=function(t,e,i,s,n,r,a,o){this.timer=t;this.delay=e;this.tick=i;this.repeatCount=s-1;this.loop=n;this.callback=r;this.callbackContext=a;this.args=o;this.pendingDelete=false};L.TimerEvent.prototype.constructor=L.TimerEvent;L.AnimationManager=function(t){this.sprite=t;this.game=t.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};L.AnimationManager.prototype={loadFrameData:function(t,e){if(typeof t==="undefined"){return false}if(this.isLoaded){for(var i in this._anims){this._anims[i].updateFrameData(t)}}this._frameData=t;if(typeof e==="undefined"||e===null){this.frame=0}else{if(typeof e==="string"){this.frameName=e}else{this.frame=e}}this.isLoaded=true;return true},copyFrameData:function(t,e){this._frameData=t.clone();if(this.isLoaded){for(var i in this._anims){this._anims[i].updateFrameData(this._frameData)}}if(typeof e==="undefined"||e===null){this.frame=0}else{if(typeof e==="string"){this.frameName=e}else{this.frame=e}}this.isLoaded=true;return true},add:function(t,e,i,s,n){e=e||[];i=i||60;if(typeof s==="undefined"){s=false}if(typeof n==="undefined"){if(e&&typeof e[0]==="number"){n=true}else{n=false}}this._outputFrames.length=0;this._frameData.getFrameIndexes(e,n,this._outputFrames);this._anims[t]=new L.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,s);this.currentAnim=this._anims[t];this.currentFrame=this.currentAnim.currentFrame;if(this.sprite.__tilePattern){this.sprite.__tilePattern=false;this.tilingTexture=false}return this._anims[t]},validateFrames:function(t,e){if(typeof e==="undefined"){e=true}for(var i=0;i<t.length;i++){if(e===true){if(t[i]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(t[i])===false){return false}}}return true},play:function(t,e,i,s){if(this._anims[t]){if(this.currentAnim===this._anims[t]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(e,i,s)}return this.currentAnim}else{if(this.currentAnim&&this.currentAnim.isPlaying){this.currentAnim.stop()}this.currentAnim=this._anims[t];this.currentAnim.paused=false;this.currentFrame=this.currentAnim.currentFrame;return this.currentAnim.play(e,i,s)}}},stop:function(t,e){if(typeof e==="undefined"){e=false}if(typeof t==="string"){if(this._anims[t]){this.currentAnim=this._anims[t];this.currentAnim.stop(e)}}else{if(this.currentAnim){this.currentAnim.stop(e)}}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()){this.currentFrame=this.currentAnim.currentFrame;return true}return false},next:function(t){if(this.currentAnim){this.currentAnim.next(t);this.currentFrame=this.currentAnim.currentFrame}},previous:function(t){if(this.currentAnim){this.currentAnim.previous(t);this.currentFrame=this.currentAnim.currentFrame}},getAnimation:function(t){if(typeof t==="string"){if(this._anims[t]){return this._anims[t]}}return null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}},destroy:function(){var t=null;for(var t in this._anims){if(this._anims.hasOwnProperty(t)){this._anims[t].destroy()}}this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};L.AnimationManager.prototype.constructor=L.AnimationManager;Object.defineProperty(L.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(L.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(L.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}});Object.defineProperty(L.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim){return this.currentAnim.name}}});Object.defineProperty(L.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this.currentFrame.index}},set:function(t){if(typeof t==="number"&&this._frameData&&this._frameData.getFrame(t)!==null){this.currentFrame=this._frameData.getFrame(t);if(this.currentFrame){this.sprite.setFrame(this.currentFrame);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}}});Object.defineProperty(L.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(t){if(typeof t==="string"&&this._frameData.getFrameByName(t)!==null){this.currentFrame=this._frameData.getFrameByName(t);if(this.currentFrame){this._frameIndex=this.currentFrame.index;this.sprite.setFrame(this.currentFrame);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}else{console.warn("Cannot set frameName: "+t)}}});L.Animation=function(t,e,i,s,n,r,a){if(typeof a==="undefined"){a=false}this.game=t;this._parent=e;this._frameData=s;this.name=i;this._frames=[];this._frames=this._frames.concat(n);this.delay=1e3/r;this.loop=a;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new L.Signal;this.onUpdate=null;this.onComplete=new L.Signal;this.onLoop=new L.Signal;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};L.Animation.prototype={play:function(t,e,i){if(typeof t==="number"){this.delay=1e3/t}if(typeof e==="boolean"){this.loop=e}if(typeof i!=="undefined"){this.killOnComplete=i}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.updateCurrentFrame(false);this._parent.events.onAnimationStart$dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},setFrame:function(t,e){var i;if(typeof e==="undefined"){e=false}if(typeof t==="string"){for(var s=0;s<this._frames.length;s++){if(this._frameData.getFrame(this._frames[s]).name===t){i=s}}}else if(typeof t==="number"){if(e){i=t}else{for(var s=0;s<this._frames.length;s++){if(this._frames[s]===i){i=s}}}}if(i){this._frameIndex=i-1;this._timeNextFrame=this.game.time.time;this.update()}},stop:function(t,e){if(typeof t==="undefined"){t=false}if(typeof e==="undefined"){e=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(t){this.currentFrame=this._frameData.getFrame(this._frames[0]);this._parent.setFrame(this.currentFrame)}if(e){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.time}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.time+this._frameDiff}},update:function(){if(this.isPaused){return false}if(this.isPlaying&&this.game.time.time>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.time-this._timeNextFrame;this._timeLastFrame=this.game.time.time;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=this._frameSkip*this.delay}this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff);this._frameIndex+=this._frameSkip;if(this._frameIndex>=this._frames.length){if(this.loop){this._frameIndex%=this._frames.length;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this);return this.updateCurrentFrame(true)}else{this.complete();return false}}else{return this.updateCurrentFrame(true)}}return false},updateCurrentFrame:function(t){if(!this._frameData){return false}this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}}if(this.onUpdate&&t){this.onUpdate.dispatch(this,this.currentFrame);return!!this._frameData}else{return true}},next:function(t){if(typeof t==="undefined"){t=1}var e=this._frameIndex+t;if(e>=this._frames.length){if(this.loop){e%=this._frames.length}else{e=this._frames.length-1}}if(e!==this._frameIndex){this._frameIndex=e;this.updateCurrentFrame(true)}},previous:function(t){if(typeof t==="undefined"){t=1}var e=this._frameIndex-t;if(e<0){if(this.loop){e=this._frames.length+e}else{e++}}if(e!==this._frameIndex){this._frameIndex=e;this.updateCurrentFrame(true)}},updateFrameData:function(t){this._frameData=t;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){if(!this._frameData){return}this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose();if(this.onUpdate){this.onUpdate.dispose()}},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};L.Animation.prototype.constructor=L.Animation;Object.defineProperty(L.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t;if(t){this._pauseStartTime=this.game.time.time}else{if(this.isPlaying){this._timeNextFrame=this.game.time.time+this.delay}}}});Object.defineProperty(L.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(L.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(t){this.currentFrame=this._frameData.getFrame(this._frames[t]);if(this.currentFrame!==null){this._frameIndex=t;this._parent.setFrame(this.currentFrame);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame)}}}});Object.defineProperty(L.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(t){if(t>=1){this.delay=1e3/t}}});Object.defineProperty(L.Animation.prototype,"enableUpdate",{get:function(){return this.onUpdate!==null},set:function(t){if(t&&this.onUpdate===null){this.onUpdate=new L.Signal}else if(!t&&this.onUpdate!==null){this.onUpdate.dispose();this.onUpdate=null}}});L.Animation.generateFrameNames=function(t,e,i,s,n){if(typeof s==="undefined"){s=""}var r=[];var a="";if(e<i){for(var o=e;o<=i;o++){if(typeof n==="number"){a=L.Utils.pad(o.toString(),n,"0",1)}else{a=o.toString()}a=t+a+s;r.push(a)}}else{for(var o=e;o>=i;o--){if(typeof n==="number"){a=L.Utils.pad(o.toString(),n,"0",1)}else{a=o.toString()}a=t+a+s;r.push(a)}}return r};L.Frame=function(t,e,i,s,n,r,a){this.index=t;this.x=e;this.y=i;this.width=s;this.height=n;this.name=r;this.uuid=a;this.centerX=Math.floor(s/2);this.centerY=Math.floor(n/2);this.distance=L.Math.distance(0,0,s,n);this.rotated=false;this.rotationDirection="cw";this.trimmed=false;this.sourceSizeW=s;this.sourceSizeH=n;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};L.Frame.prototype={setTrim:function(t,e,i,s,n,r,a){this.trimmed=t;if(t){this.sourceSizeW=e;this.sourceSizeH=i;this.centerX=Math.floor(e/2);this.centerY=Math.floor(i/2);this.spriteSourceSizeX=s;this.spriteSourceSizeY=n;this.spriteSourceSizeW=r;this.spriteSourceSizeH=a}},clone:function(){var t=new L.Frame(this.index,this.x,this.y,this.width,this.height,this.name,this.uuid);for(var e in this){if(this.hasOwnProperty(e)){t[e]=this[e]}}return t},getRect:function(t){if(typeof t==="undefined"){t=new L.Rectangle(this.x,this.y,this.width,this.height)}else{t.setTo(this.x,this.y,this.width,this.height)}return t}};L.Frame.prototype.constructor=L.Frame;L.FrameData=function(){this._frames=[];this._frameNames=[]};L.FrameData.prototype={addFrame:function(t){t.index=this._frames.length;this._frames.push(t);if(t.name!==""){this._frameNames[t.name]=t.index}return t},getFrame:function(t){if(t>=this._frames.length){t=0}return this._frames[t]},getFrameByName:function(t){if(typeof this._frameNames[t]==="number"){return this._frames[this._frameNames[t]]}return null},checkFrameName:function(t){if(this._frameNames[t]==null){return false}return true},clone:function(){var t=new L.FrameData;for(var e=0;e<this._frames.length;e++){t._frames.push(this._frames[e].clone())}for(var i in this._frameNames){if(this._frameNames.hasOwnProperty(i)){t._frameNames.push(this._frameNames[i])}}return t},getFrameRange:function(t,e,i){if(typeof i==="undefined"){i=[]}for(var s=t;s<=e;s++){i.push(this._frames[s])}return i},getFrames:function(t,e,i){if(typeof e==="undefined"){e=true}if(typeof i==="undefined"){i=[]}if(typeof t==="undefined"||t.length===0){for(var s=0;s<this._frames.length;s++){i.push(this._frames[s])}}else{for(var s=0,n=t.length;s<n;s++){if(e){i.push(this.getFrame(t[s]))}else{i.push(this.getFrameByName(t[s]))}}}return i},getFrameIndexes:function(t,e,i){if(typeof e==="undefined"){e=true}if(typeof i==="undefined"){i=[]}if(typeof t==="undefined"||t.length===0){for(var s=0,n=this._frames.length;s<n;s++){i.push(this._frames[s].index)}}else{for(var s=0,n=t.length;s<n;s++){if(e){i.push(t[s])}else{if(this.getFrameByName(t[s])){i.push(this.getFrameByName(t[s]).index)}}}}return i}};L.FrameData.prototype.constructor=L.FrameData;Object.defineProperty(L.FrameData.prototype,"total",{get:function(){return this._frames.length}});L.AnimationParser={spriteSheet:function(t,e,i,s,n,r,a){var o=t.cache.getImage(e);if(o==null){return null}var h=o.width;var l=o.height;if(i<=0){i=Math.floor(-h/Math.min(-1,i))}if(s<=0){s=Math.floor(-l/Math.min(-1,s))}var u=Math.floor((h-r)/(i+a));var f=Math.floor((l-r)/(s+a));var c=u*f;if(n!==-1){c=n}if(h===0||l===0||h<i||l<s||c===0){console.warn("Phaser.AnimationParser.spriteSheet: '"+e+"'s width/height zero or width/height < given frameWidth/frameHeight");return null}var d=new L.FrameData;var p=r;var g=r;for(var m=0;m<c;m++){var y=t.rnd.uuid();d.addFrame(new L.Frame(m,p,g,i,s,m.toString(),y));PIXI.TextureCache[y]=new PIXI.Texture(PIXI.BaseTextureCache[e],{x:p,y:g,width:i,height:s});p+=i+a;if(p+i>h){p=r;g+=s+a}}return d},JSONData:function(t,e,i){if(!e["frames"]){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(e);return}var s=new L.FrameData;var n=e["frames"];var r;for(var a=0;a<n.length;a++){var o=t.rnd.uuid();r=s.addFrame(new L.Frame(a,n[a].frame.x,n[a].frame.y,n[a].frame.w,n[a].frame.h,n[a].filename,o));PIXI.TextureCache[o]=new PIXI.Texture(PIXI.BaseTextureCache[i],{x:n[a].frame.x,y:n[a].frame.y,width:n[a].frame.w,height:n[a].frame.h});if(n[a].trimmed){r.setTrim(n[a].trimmed,n[a].sourceSize.w,n[a].sourceSize.h,n[a].spriteSourceSize.x,n[a].spriteSourceSize.y,n[a].spriteSourceSize.w,n[a].spriteSourceSize.h)}}return s},JSONDataHash:function(t,e,i){if(!e["frames"]){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(e);return}var s=new L.FrameData;var n=e["frames"];var r;var a=0;for(var o in n){var h=t.rnd.uuid();r=s.addFrame(new L.Frame(a,n[o].frame.x,n[o].frame.y,n[o].frame.w,n[o].frame.h,o,h));PIXI.TextureCache[h]=new PIXI.Texture(PIXI.BaseTextureCache[i],{x:n[o].frame.x,y:n[o].frame.y,width:n[o].frame.w,height:n[o].frame.h});if(n[o].trimmed){r.setTrim(n[o].trimmed,n[o].sourceSize.w,n[o].sourceSize.h,n[o].spriteSourceSize.x,n[o].spriteSourceSize.y,n[o].spriteSourceSize.w,n[o].spriteSourceSize.h)}a++}return s},XMLData:function(t,e,i){if(!e.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var s=new L.FrameData;var n=e.getElementsByTagName("SubTexture");var r;var a;var o;var h;var l;var u;var f;var c;var d;var p;var g;var m;for(var y=0;y<n.length;y++){a=t.rnd.uuid();h=n[y].attributes;o=h.name.value;l=parseInt(h.x.value,10);u=parseInt(h.y.value,10);f=parseInt(h.width.value,10);c=parseInt(h.height.value,10);d=null;p=null;if(h.frameX){d=Math.abs(parseInt(h.frameX.value,10));p=Math.abs(parseInt(h.frameY.value,10));g=parseInt(h.frameWidth.value,10);m=parseInt(h.frameHeight.value,10)}r=s.addFrame(new L.Frame(y,l,u,f,c,o,a));PIXI.TextureCache[a]=new PIXI.Texture(PIXI.BaseTextureCache[i],{x:l,y:u,width:f,height:c});if(d!==null||p!==null){r.setTrim(true,f,c,d,p,g,m)}}return s}};L.Cache=function(t){this.game=t;this.autoResolveURL=false;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._json={};this._xml={};this._physics={};this._tilemaps={};this._binary={};this._bitmapDatas={};this._bitmapFont={};this._urlMap={};this._urlResolver=new Image;this._urlTemp=null;this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new L.Signal;this._cacheMap=[];this._cacheMap[L.Cache.CANVAS]=this._canvases;this._cacheMap[L.Cache.IMAGE]=this._images;this._cacheMap[L.Cache.TEXTURE]=this._textures;this._cacheMap[L.Cache.SOUND]=this._sounds;this._cacheMap[L.Cache.TEXT]=this._text;this._cacheMap[L.Cache.PHYSICS]=this._physics;this._cacheMap[L.Cache.TILEMAP]=this._tilemaps;this._cacheMap[L.Cache.BINARY]=this._binary;this._cacheMap[L.Cache.BITMAPDATA]=this._bitmapDatas;this._cacheMap[L.Cache.BITMAPFONT]=this._bitmapFont;this._cacheMap[L.Cache.JSON]=this._json;this._cacheMap[L.Cache.XML]=this._xml};L.Cache.CANVAS=1;L.Cache.IMAGE=2;L.Cache.TEXTURE=3;L.Cache.SOUND=4;L.Cache.TEXT=5;L.Cache.PHYSICS=6;L.Cache.TILEMAP=7;L.Cache.BINARY=8;L.Cache.BITMAPDATA=9;L.Cache.BITMAPFONT=10;L.Cache.JSON=11;L.Cache.XML=12;L.Cache.prototype={addCanvas:function(t,e,i){this._canvases[t]={canvas:e,context:i}},addBinary:function(t,e){this._binary[t]=e},addBitmapData:function(t,e,i){e.key=t;if(typeof i==="undefined"){i=new L.FrameData;i.addFrame(e.textureFrame)}this._bitmapDatas[t]={data:e,frameData:i};return e},addRenderTexture:function(t,e){var i=new L.Frame(0,0,0,e.width,e.height,"","");this._textures[t]={texture:e,frame:i}},addSpriteSheet:function(t,e,i,s,n,r,a,o){this._images[t]={url:e,data:i,frameWidth:s,frameHeight:n,margin:a,spacing:o};PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(i);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);this._images[t].frameData=L.AnimationParser.spriteSheet(this.game,t,s,n,r,a,o);this._resolveURL(e,this._images[t])},addTilemap:function(t,e,i,s){this._tilemaps[t]={url:e,data:i,format:s};this._resolveURL(e,this._tilemaps[t])},addTextureAtlas:function(t,e,i,s,n){this._images[t]={url:e,data:i};PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(i);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);if(n==L.Loader.TEXTURE_ATLAS_JSON_ARRAY){this._images[t].frameData=L.AnimationParser.JSONData(this.game,s,t)}else if(n==L.Loader.TEXTURE_ATLAS_JSON_HASH){this._images[t].frameData=L.AnimationParser.JSONDataHash(this.game,s,t)}else if(n==L.Loader.TEXTURE_ATLAS_XML_STARLING){this._images[t].frameData=L.AnimationParser.XMLData(this.game,s,t)}this._resolveURL(e,this._images[t])},addBitmapFont:function(t,e,i,s,n,r){this._images[t]={url:e,data:i};PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(i);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);L.LoaderParser.bitmapFont(this.game,s,t,n,r);this._bitmapFont[t]=PIXI.BitmapText.fonts[t];this._resolveURL(e,this._bitmapFont[t])},addPhysicsData:function(t,e,i,s){this._physics[t]={url:e,data:i,format:s};this._resolveURL(e,this._physics[t])},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images["__default"]={url:null,data:t};this._images["__default"].frame=new L.Frame(0,0,0,32,32,"","");this._images["__default"].frameData=new L.FrameData;this._images["__default"].frameData.addFrame(new L.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache["__default"]=new PIXI.BaseTexture(t);PIXI.TextureCache["__default"]=new PIXI.Texture(PIXI.BaseTextureCache["__default"])},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";this._images["__missing"]={url:null,data:t};this._images["__missing"].frame=new L.Frame(0,0,0,32,32,"","");this._images["__missing"].frameData=new L.FrameData;this._images["__missing"].frameData.addFrame(new L.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache["__missing"]=new PIXI.BaseTexture(t);PIXI.TextureCache["__missing"]=new PIXI.Texture(PIXI.BaseTextureCache["__missing"])},addText:function(t,e,i){this._text[t]={url:e,data:i};this._resolveURL(e,this._text[t])},addJSON:function(t,e,i){this._json[t]={url:e,data:i};this._resolveURL(e,this._json[t])},addXML:function(t,e,i){this._xml[t]={url:e,data:i};this._resolveURL(e,this._xml[t])},addImage:function(t,e,i){if(this.checkImageKey(t)){this.removeImage(t)}this._images[t]={url:e,data:i};this._images[t].frame=new L.Frame(0,0,0,i.width,i.height,t,this.game.rnd.uuid());this._images[t].frameData=new L.FrameData;this._images[t].frameData.addFrame(new L.Frame(0,0,0,i.width,i.height,e,this.game.rnd.uuid()));PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(i);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);this._resolveURL(e,this._images[t])},addSound:function(t,e,i,s,n){s=s||true;n=n||false;var r=false;if(n){r=true}this._sounds[t]={url:e,data:i,isDecoding:false,decoded:r,webAudio:s,audioTag:n,locked:this.game.sound.touchLocked};this._resolveURL(e,this._sounds[t])},reloadSound:function(t){var e=this;if(this._sounds[t]){this._sounds[t].data.src=this._sounds[t].url;this._sounds[t].data.addEventListener("canplaythrough",function(){return e.reloadSoundComplete(t)},false);this._sounds[t].data.load()}},reloadSoundComplete:function(t){if(this._sounds[t]){this._sounds[t].locked=false;this.onSoundUnlock.dispatch(t)}},updateSound:function(t,e,i){if(this._sounds[t]){this._sounds[t][e]=i}},decodedSound:function(t,e){this._sounds[t].data=e;this._sounds[t].decoded=true;this._sounds[t].isDecoding=false},getCanvas:function(t){if(this._canvases[t]){return this._canvases[t].canvas}else{console.warn('Phaser.Cache.getCanvas: Invalid key: "'+t+'"');return null}},getBitmapData:function(t){if(this._bitmapDatas[t]){return this._bitmapDatas[t].data}else{console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+t+'"');return null}},getBitmapFont:function(t){if(this._bitmapFont[t]){return this._bitmapFont[t]}else{console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+t+'"');return null}},getPhysicsData:function(t,e,i){if(typeof e==="undefined"||e===null){if(this._physics[t]){return this._physics[t].data}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+t+'"')}}else{if(this._physics[t]&&this._physics[t].data[e]){var s=this._physics[t].data[e];if(s&&i){for(var n in s){n=s[n];if(n.fixtureKey===i){return n}}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+i+" in "+t+'"')}else{return s}}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+t+" / "+e+'"')}}return null},checkKey:function(t,e){if(this._cacheMap[t][e]){return true}return false},checkCanvasKey:function(t){return this.checkKey(L.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(L.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(L.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(L.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(L.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(L.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(L.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(L.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(L.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(L.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(L.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(L.Cache.XML,t)},checkURL:function(t){if(this._urlMap[this._resolveURL(t)]){return true}return false},getImage:function(t){if(this._images[t]){return this._images[t].data}else{return null}},getTilemapData:function(t){if(this._tilemaps[t]){return this._tilemaps[t]}else{console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+t+'"');return null}},getFrameData:function(t,e){if(typeof e==="undefined"){e=L.Cache.IMAGE}if(this._cacheMap[e][t]){return this._cacheMap[e][t].frameData}return null},updateFrameData:function(t,e){if(this._images[t]){this._images[t].frameData=e}},getFrameByIndex:function(t,e){if(this._images[t]){return this._images[t].frameData.getFrame(e)}return null},getFrameByName:function(t,e){if(this._images[t]){return this._images[t].frameData.getFrameByName(e)}return null},getFrame:function(t){if(this._images[t]){return this._images[t].frame}return null},getTextureFrame:function(t){if(this._textures[t]){return this._textures[t].frame}return null},getRenderTexture:function(t){if(this._textures[t]){return this._textures[t]}else{console.warn('Phaser.Cache.getTexture: Invalid key: "'+t+'"');return null}},getTexture:function(t){if(this._textures[t]){return this._textures[t]}else{}},getSound:function(t){if(this._sounds[t]){return this._sounds[t]}else{console.warn('Phaser.Cache.getSound: Invalid key: "'+t+'"');return null}},getSoundData:function(t){if(this._sounds[t]){return this._sounds[t].data}else{console.warn('Phaser.Cache.getSoundData: Invalid key: "'+t+'"');return null}},isSoundDecoded:function(t){if(this._sounds[t]){return this._sounds[t].decoded}},isSoundReady:function(t){return this._sounds[t]&&this._sounds[t].decoded&&this.game.sound.touchLocked===false},getFrameCount:function(t){if(this._images[t]){return this._images[t].frameData.total}return 0},getText:function(t){if(this._text[t]){return this._text[t].data}else{return null}},getJSON:function(t){if(this._json[t]){return this._json[t].data}else{console.warn('Phaser.Cache.getJSON: Invalid key: "'+t+'"');return null}},getXML:function(t){if(this._xml[t]){return this._xml[t].data}else{console.warn('Phaser.Cache.getXML: Invalid key: "'+t+'"');return null}},getBinary:function(t){if(this._binary[t]){return this._binary[t]}else{console.warn('Phaser.Cache.getBinary: Invalid key: "'+t+'"');return null}},getURL:function(t){var t=this._resolveURL(t);if(t){return this._urlMap[t]}else{console.warn('Phaser.Cache.getUrl: Invalid url: "'+t+'" or Cache.autoResolveURL was false');return null}},getUrl:function(t){return this.getURL(t)},getKeys:function(t){var e=null;switch(t){case L.Cache.CANVAS:e=this._canvases;break;case L.Cache.IMAGE:e=this._images;break;case L.Cache.TEXTURE:e=this._textures;break;case L.Cache.SOUND:e=this._sounds;break;case L.Cache.TEXT:e=this._text;break;case L.Cache.PHYSICS:e=this._physics;break;case L.Cache.TILEMAP:e=this._tilemaps;break;case L.Cache.BINARY:e=this._binary;break;case L.Cache.BITMAPDATA:e=this._bitmapDatas;break;case L.Cache.BITMAPFONT:e=this._bitmapFont;break;case L.Cache.JSON:e=this._json;break;case L.Cache.XML:e=this._xml;break}if(!e){return}var i=[];for(var s in e){if(s!=="__default"&&s!=="__missing"){i.push(s)}}return i},removeCanvas:function(t){delete this._canvases[t]},removeImage:function(t,e){if(typeof e==="undefined"){e=true}delete this._images[t];if(e){PIXI.BaseTextureCache[t].destroy()}},removeSound:function(t){delete this._sounds[t]},removeText:function(t){delete this._text[t]},removeJSON:function(t){delete this._json[t]},removeXML:function(t){delete this._xml[t]},removePhysics:function(t){delete this._physics[t]},removeTilemap:function(t){delete this._tilemaps[t]},removeBinary:function(t){delete this._binary[t]},removeBitmapData:function(t){delete this._bitmapDatas[t]},removeBitmapFont:function(t){delete this._bitmapFont[t]},_resolveURL:function(t,e){if(!this.autoResolveURL){return null}this._urlResolver.src=this.game.load.baseURL+t;this._urlTemp=this._urlResolver.src;this._urlResolver.src="";if(e){this._urlMap[this._urlTemp]=e}return this._urlTemp},destroy:function(){for(var t in this._images){if(t!=="__default"&&t!=="__missing"){delete this._images[t]}}var e=[this._canvases,this._sounds,this._text,this._json,this._xml,this._textures,this._physics,this._tilemaps,this._binary,this._bitmapDatas,this._bitmapFont];for(var i=0;i<e.length;i++){for(var t in e[i]){delete e[i][t]}}this._urlMap=null;this._urlResolver=null;this._urlTemp=null}};L.Cache.prototype.constructor=L.Cache;L.Loader=function(t){this.game=t;this.resetLocked=false;this.isLoading=false;this.hasLoaded=false;this.preloadSprite=null;this.crossOrigin=false;this.baseURL="";this.onLoadStart=new L.Signal;this.onLoadComplete=new L.Signal;this.onPackComplete=new L.Signal;this.onFileStart=new L.Signal;this.onFileComplete=new L.Signal;this.onFileError=new L.Signal;this.useXDomainRequest=false;this._warnedAboutXDomainRequest=false;this.enableParallel=true;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=false;this._totalPackCount=0;this._totalFileCount=0;this._loadedPackCount=0;this._loadedFileCount=0};L.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;L.Loader.TEXTURE_ATLAS_JSON_HASH=1;L.Loader.TEXTURE_ATLAS_XML_STARLING=2;L.Loader.PHYSICS_LIME_CORONA_JSON=3;L.Loader.PHYSICS_PHASER_JSON=4;L.Loader.prototype={setPreloadSprite:function(t,e){e=e||0;this.preloadSprite={sprite:t,direction:e,width:t.width,height:t.height,rect:null};if(e===0){this.preloadSprite.rect=new L.Rectangle(0,0,1,t.height)}else{this.preloadSprite.rect=new L.Rectangle(0,0,t.width,1)}t.crop(this.preloadSprite.rect);t.visible=true},resize:function(){if(this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height){this.preloadSprite.rect.height=this.preloadSprite.sprite.height}},checkKeyExists:function(t,e){return this.getAssetIndex(t,e)>-1},getAssetIndex:function(t,e){var i=-1;for(var s=0;s<this._fileList.length;s++){var n=this._fileList[s];if(n.type===t&&n.key===e){i=s;if(!n.loaded&&!n.loading){break}}}return i},getAsset:function(t,e){var i=this.getAssetIndex(t,e);if(i>-1){return{index:i,file:this._fileList[i]}}return false},reset:function(t,e){if(typeof e==="undefined"){e=false}if(this.resetLocked){return}if(t){this.preloadSprite=null}this.isLoading=false;this._processingHead=0;this._fileList.length=0;this._flightQueue.length=0;this._fileLoadStarted=false;this._totalFileCount=0;this._totalPackCount=0;this._loadedPackCount=0;this._loadedFileCount=0;if(e){this.onLoadStart.removeAll();this.onLoadComplete.removeAll();this.onPackComplete.removeAll();this.onFileStart.removeAll();this.onFileComplete.removeAll();this.onFileError.removeAll()}},addToFileList:function(t,e,i,s,n){var r={type:t,key:e,url:i,syncPoint:this._withSyncPointDepth>0,data:null,loading:false,loaded:false,error:false};if(s){for(var a in s){r[a]=s[a]}}var o=this.getAssetIndex(t,e);if(n&&o>-1){var h=this._fileList[o];if(!h.loading&&!h.loaded){this._fileList[o]=r}else{this._fileList.push(r);this._totalFileCount++}}else if(o===-1){this._fileList.push(r);this._totalFileCount++}},replaceInFileList:function(t,e,i,s){return this.addToFileList(t,e,i,s,true)},pack:function(t,e,i,s){if(typeof e==="undefined"){e=null}if(typeof i==="undefined"){i=null}if(typeof s==="undefined"){s=null}if(!e&&!i){console.warn("Phaser.Loader.pack - Both url and data are null. One must be set.");return this}var n={type:"packfile",key:t,url:e,syncPoint:true,data:null,loading:false,loaded:false,error:false,callbackContext:s};if(i){if(typeof i==="string"){i=JSON.parse(i)}n.data=i||{};n.loaded=true}for(var r=0;r<this._fileList.length+1;r++){var a=this._fileList[r];if(!a||!a.loaded&&!a.loading&&a.type!=="packfile"){this._fileList.splice(r,1,n);this._totalPackCount++;break}}return this},image:function(t,e,i){if(typeof i==="undefined"){i=false}this.addToFileList("image",t,e,undefined,i);return this},text:function(t,e,i){if(typeof i==="undefined"){i=false}this.addToFileList("text",t,e,undefined,i);return this},json:function(t,e,i){if(typeof i==="undefined"){i=false}this.addToFileList("json",t,e,undefined,i);return this},xml:function(t,e,i){if(typeof i==="undefined"){i=false}this.addToFileList("xml",t,e,undefined,i);return this},script:function(t,e,i,s){if(typeof i==="undefined"){i=false}if(i!==false&&typeof s==="undefined"){s=i}this.addToFileList("script",t,e,{syncPoint:true,callback:i,callbackContext:s});return this},binary:function(t,e,i,s){if(typeof i==="undefined"){i=false}if(i!==false&&typeof s==="undefined"){s=i}this.addToFileList("binary",t,e,{callback:i,callbackContext:s});return this},spritesheet:function(t,e,i,s,n,r,a){if(typeof n==="undefined"){n=-1}if(typeof r==="undefined"){r=0}if(typeof a==="undefined"){a=0}this.addToFileList("spritesheet",t,e,{frameWidth:i,frameHeight:s,frameMax:n,margin:r,spacing:a});return this},audio:function(t,e,i){if(typeof i==="undefined"){i=true}if(typeof e==="string"){e=[e]}this.addToFileList("audio",t,e,{buffer:null,autoDecode:i});return this},audiosprite:function(t,e,i,s,n){if(typeof i==="undefined"){i=null}if(typeof s==="undefined"){s=null}if(typeof n==="undefined"){n=true}this.audio(t,e,n);if(i){this.json(t+"-audioatlas",i)}else if(s){if(typeof s==="string"){s=JSON.parse(s)}this.game.cache.addJSON(t+"-audioatlas","",s)}else{console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object")}return this},tilemap:function(t,e,i,s){if(typeof e==="undefined"){e=null}if(typeof i==="undefined"){i=null}if(typeof s==="undefined"){s=L.Tilemap.CSV}if(!e&&!i){console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set.");return this}if(i){switch(s){case L.Tilemap.CSV:break;case L.Tilemap.TILED_JSON:if(typeof i==="string"){i=JSON.parse(i)}break}this.game.cache.addTilemap(t,null,i,s)}else{this.addToFileList("tilemap",t,e,{format:s})}return this},physics:function(t,e,i,s){if(typeof e==="undefined"){e=null}if(typeof i==="undefined"){i=null}if(typeof s==="undefined"){s=L.Physics.LIME_CORONA_JSON}if(!e&&!i){console.warn("Phaser.Loader.physics - Both url and data are null. One must be set.");return this}if(i){if(typeof i==="string"){i=JSON.parse(i)}this.game.cache.addPhysicsData(t,null,i,s)}else{this.addToFileList("physics",t,e,{format:s})}return this},bitmapFont:function(t,e,i,s,n,r){if(typeof i==="undefined"){i=null}if(typeof s==="undefined"){s=null}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}if(i){this.addToFileList("bitmapfont",t,e,{xmlURL:i,xSpacing:n,ySpacing:r})}else{if(typeof s==="string"){var a=this.parseXml(s);if(!a){throw new Error("Phaser.Loader. Invalid Bitmap Font XML given")}this.addToFileList("bitmapfont",t,e,{xmlURL:null,xmlData:a,xSpacing:n,ySpacing:r})}}return this},atlasJSONArray:function(t,e,i,s){return this.atlas(t,e,i,s,L.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,e,i,s){return this.atlas(t,e,i,s,L.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,e,i,s){return this.atlas(t,e,i,s,L.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,e,i,s,n){if(typeof i==="undefined"){i=null}if(typeof s==="undefined"){s=null}if(typeof n==="undefined"){n=L.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(i){this.addToFileList("textureatlas",t,e,{atlasURL:i,format:n})}else{switch(n){case L.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof s==="string"){s=JSON.parse(s)}break;case L.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof s==="string"){var r=this.parseXml(s);if(!r){throw new Error("Phaser.Loader. Invalid Texture Atlas XML given")}s=r}break}this.addToFileList("textureatlas",t,e,{atlasURL:null,atlasData:s,format:n})}return this},withSyncPoint:function(t,e){this._withSyncPointDepth++;try{t.call(e||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(t,e){var i=this.getAsset(t,e);if(i){i.file.syncPoint=true}return this},removeFile:function(t,e){var i=this.getAsset(t,e);if(i){if(!i.loaded&&!i.loading){this._fileList.splice(i.index,1)}}},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){if(this.isLoading){return}this.hasLoaded=false;this.isLoading=true;this.updateProgress();this.processLoadQueue()},processLoadQueue:function(){if(!this.isLoading){console.warn("Phaser.Loader - active loading canceled / reset");this.finishedLoading(true);return}for(var t=0;t<this._flightQueue.length;t++){var e=this._flightQueue[t];if(e.loaded||e.error){this._flightQueue.splice(t,1);t--;e.loading=false;e.requestUrl=null;e.requestObject=null;if(e.error){this.onFileError.dispatch(e.key,e)}if(e.type!=="packfile"){this._loadedFileCount++;this.onFileComplete.dispatch(this.progress,e.key,!e.error,this._loadedFileCount,this._totalFileCount)}else if(e.type==="packfile"&&e.error){this._loadedPackCount++;this.onPackComplete.dispatch(e.key,!e.error,this._loadedPackCount,this._totalPackCount)}}}var i=false;var s=this.enableParallel?L.Math.clamp(this.maxParallelDownloads,1,12):1;for(var t=this._processingHead;t<this._fileList.length;t++){var e=this._fileList[t];if(e.type==="packfile"&&!e.error&&e.loaded&&t===this._processingHead){this.processPack(e);this._loadedPackCount++;this.onPackComplete.dispatch(e.key,!e.error,this._loadedPackCount,this._totalPackCount)}if(e.loaded||e.error){if(t===this._processingHead){this._processingHead=t+1}}else if(!e.loading&&this._flightQueue.length<s){if(e.type==="packfile"&&!e.data){this._flightQueue.push(e);e.loading=true;this.loadFile(e)}else if(!i){if(!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this._flightQueue.push(e);e.loading=true;this.onFileStart.dispatch(this.progress,e.key,e.url);this.loadFile(e)}}if(!e.loaded&&e.syncPoint){i=true}if(this._flightQueue.length>=s||i&&this._loadedPackCount===this._totalPackCount){break}}this.updateProgress();if(this._processingHead>=this._fileList.length){this.finishedLoading()}else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var n=this;setTimeout(function(){n.finishedLoading(true)},2e3)}},finishedLoading:function(t){if(this.hasLoaded){return}this.hasLoaded=true;this.isLoading=false;if(!t&&!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this.onLoadComplete.dispatch();this.reset();this.game.state.loadComplete()},asyncComplete:function(t,e){if(typeof e==="undefined"){e=""}t.loaded=true;t.error=!!e;if(e){t.errorMessage=e;console.warn("Phaser.Loader - "+t.type+"["+t.key+"]"+": "+e)}this.processLoadQueue()},processPack:function(t){var e=t.data[t.key];if(!e){console.warn("Phaser.Loader - "+t.key+": pack has data, but not for pack key");return}for(var i=0;i<e.length;i++){var s=e[i];switch(s.type){case"image":this.image(s.key,s.url,s.overwrite);break;case"text":this.text(s.key,s.url,s.overwrite);break;case"json":this.json(s.key,s.url,s.overwrite);break;case"xml":this.xml(s.key,s.url,s.overwrite);break;case"script":this.script(s.key,s.url,s.callback,t.callbackContext||this);break;case"binary":this.binary(s.key,s.url,s.callback,t.callbackContext||this);break;case"spritesheet":this.spritesheet(s.key,s.url,s.frameWidth,s.frameHeight,s.frameMax,s.margin,s.spacing);break;case"audio":this.audio(s.key,s.urls,s.autoDecode);break;case"audiosprite":this.audio(s.key,s.urls,s.jsonURL);break;case"tilemap":this.tilemap(s.key,s.url,s.data,L.Tilemap[s.format]);break;case"physics":this.physics(s.key,s.url,s.data,L.Loader[s.format]);break;case"bitmapFont":this.bitmapFont(s.key,s.textureURL,s.xmlURL,s.xmlData,s.xSpacing,s.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlasXML":this.atlasXML(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlas":this.atlas(s.key,s.textureURL,s.atlasURL,s.atlasData,L.Loader[s.format]);break}}},transformUrl:function(t){return this.baseURL+t},loadFile:function(e){switch(e.type){case"packfile":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(e);break;case"audio":e.url=this.getAudioURL(e.url);if(e.url){if(this.game.sound.usingWebAudio){this.xhrLoad(e,this.transformUrl(e.url,e),"arraybuffer",this.fileComplete)}else if(this.game.sound.usingAudioTag){if(window.__wx&&typeof wx.getSharedCanvas!="function"){var i=this;var s=wx.getFileSystemManager();var n="";var t=[wx.env.USER_DATA_PATH];t=t.concat(e.url.split("/"));for(var r=0;r<t.length-1;r++){if(r===0)n=t[0];else n=n+"/"+t[r];try{s.accessSync(n)}catch(t){try{s.mkdirSync(n)}catch(t){i.game._qc.log.trace("创建目录{0}失败：{1}",n,JSON.stringify(t))}}}wx.downloadFile({url:this.transformUrl(e.url,e),filePath:wx.env.USER_DATA_PATH+"/"+e.url,success:function(t){i.game._qc.log.trace("音频 {0} 下载成功. res : {1}",e.url,JSON.stringify(t));e.localPath=wx.env.USER_DATA_PATH+"/"+e.url;i.loadAudioTag(e)},fail:function(t){i.game._qc.log.error("Download "+i.transformUrl(e.url,e)+" fail："+JSON.stringify(t));i.asyncComplete(e,"Download fail: "+e.url)}})}else this.loadAudioTag(e)}}else{this.fileError(e,null,"no supported audio URL specified")}break;case"json":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.xmlLoadComplete);break;case"tilemap":if(e.format===L.Tilemap.TILED_JSON){this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.jsonLoadComplete)}else if(e.format===L.Tilemap.CSV){this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.csvLoadComplete)}else{this.asyncComplete(e,"invalid Tilemap format: "+e.format)}break;case"text":case"script":case"physics":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.fileComplete);break;case"binary":this.xhrLoad(e,this.transformUrl(e.url,e),"arraybuffer",this.fileComplete);break}},loadImageTag:function(t){var e=this;t.data=new Image;t.data.name=t.key;if(this.crossOrigin){t.data.crossOrigin=this.crossOrigin}t.data.onload=function(){if(t.data.onload){t.data.onload=null;t.data.onerror=null;e.fileComplete(t)}};t.data.onerror=function(){if(t.data.onload){t.data.onload=null;t.data.onerror=null;e.fileError(t)}};t.data.src=this.transformUrl(t.url,t);if(t.data.complete&&t.data.width&&t.data.height){t.data.onload=null;t.data.onerror=null;this.fileComplete(t)}},loadAudioTag:function(t){var e=this;if(this.game.sound.touchLocked){t.data=new Audio;t.data.name=t.key;t.data.preload="auto";t.data.src=this.transformUrl(t.url,t);this.fileComplete(t)}else{t.data=new Audio;t.data.name=t.key;var i=function(){t.data.removeEventListener("canplaythrough",i,false);t.data.onerror=null;L.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener("canplaythrough",i,false);t.data.onerror=null;e.fileError(t)};t.data.preload="auto";t.data.src=this.transformUrl(t.url,t);t.data.addEventListener("canplaythrough",i,false);t.data.load()}},xhrLoad:function(e,t,i,s,n){var r=this;if(window.__wx&&typeof wx.getSharedCanvas!="function"){n=n||this.fileError;var a=wx.request({url:t,dataType:i,success:function(t){try{return s.call(r,e,t.data)}catch(t){if(!r.hasLoaded){r.asyncComplete(e,t.message||"Exception")}else{if(window["console"]){console.error(t)}}}},fail:function(t){try{return n.call(r,e)}catch(t){if(!r.hasLoaded){r.asyncComplete(e,t.message||"Exception")}else{if(window["console"]){console.error(t)}}}}});e.requestObject=a;e.requestUrl=t;return}if(this.useXDomainRequest&&window.XDomainRequest){this.xhrLoadWithXDR(e,t,i,s,n);return}if(window.hasBase64&&window.hasBase64()){var o=window.getKeyByUrl(t);var h=window.getAssestByKey(o);if(h){console.log("usebase64 :"+e.url);var l={};l.responseType=i;l.response=l.responseText=h;return s.call(r,e,l)}}else if(window.assetsPackage){var u=t.split("/");var f=u[u.length-1];f=f.replace(".","_");if(window.assetsPackage[f]){console.log("usebase64 :"+e.url);var l={};l.responseType=i;l.response=l.responseText=window.assetsPackage[f];return s.call(r,e,l)}}var a=new XMLHttpRequest;a.open("GET",t,true);a.responseType=i;n=n||this.fileError;a.onload=function(){try{if(window["printingloading"]){console.log("资源加载完成:"+e.url);if(e.url.indexOf(".bin")>-1){console.log("这是bin资源！")}}return s.call(r,e,a)}catch(t){if(!r.hasLoaded){r.asyncComplete(e,t.message||"Exception")}else{if(window["console"]){console.error(t)}}}};a.onerror=function(){try{return n.call(r,e,a)}catch(t){if(!r.hasLoaded){r.asyncComplete(e,t.message||"Exception")}else{if(window["console"]){console.error(t)}}}};e.requestObject=a;e.requestUrl=t;a.send()},xhrLoadWithXDR:function(e,t,i,s,n){if(!this._warnedAboutXDomainRequest&&(!this.game.device.ie||this.game.device.ieVersion>=10)){this._warnedAboutXDomainRequest=true;console.warn("Phaser.Loader - using XDomainRequest outside of IE 9")}var r=new window.XDomainRequest;r.open("GET",t,true);r.responseType=i;r.timeout=3e3;n=n||this.fileError;var a=this;r.onerror=function(){try{return n.call(a,e,r)}catch(t){a.asyncComplete(e,t.message||"Exception")}};r.ontimeout=function(){try{return n.call(a,e,r)}catch(t){a.asyncComplete(e,t.message||"Exception")}};r.onprogress=function(){};r.onload=function(){try{return s.call(a,e,r)}catch(t){a.asyncComplete(e,t.message||"Exception")}};e.requestObject=r;e.requestUrl=t;setTimeout(function(){r.send()},0)},getAudioURL:function(t){for(var e=0;e<t.length;e++){var i=t[e];var s;if(i.uri){i=i.uri;s=i.type}else{if(i.indexOf("blob:")===0||i.indexOf("data:")===0){return i}if(i.indexOf("?")>=0){i=i.substr(0,i.indexOf("?"))}var n=i.substr((Math.max(0,i.lastIndexOf("."))||Infinity)+1);s=n.toLowerCase()}if(this.game.device.canPlayAudio(s)){return t[e]}}return null},fileError:function(t,e,i){var s=t.requestUrl||this.transformUrl(t.url,t);var n="error loading asset from URL "+s;if(!i&&e){i=e.status}if(i){n=n+" ("+i+")"}this.asyncComplete(t,n)},fileComplete:function(t,e){var i;var s=true;if(window.__wx&&typeof wx.getSharedCanvas!="function")i=e;else if(e){if(t.type==="binary"||t.type==="audio"){i=e.response}else{i=e.responseText}}switch(t.type){case"packfile":var n=JSON.parse(i);t.data=n||{};break;case"image":this.game.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.game.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing);break;case"textureatlas":if(t.atlasURL==null){this.game.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format)}else{s=false;if(t.format==L.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format==L.Loader.TEXTURE_ATLAS_JSON_HASH){this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete)}else if(t.format==L.Loader.TEXTURE_ATLAS_XML_STARLING){this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete)}else{throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format)}}break;case"bitmapfont":if(!t.xmlURL){this.game.cache.addBitmapFont(t.key,t.url,t.data,t.xmlData,t.xSpacing,t.ySpacing)}else{s=false;this.xhrLoad(t,this.transformUrl(t.xmlURL,t),"text",this.xmlLoadComplete)}break;case"audio":if(this.game.sound.usingWebAudio){t.data=i;this.game.cache.addSound(t.key,t.url,t.data,true,false);if(t.autoDecode){this.game.sound.decode(t.key)}}else{this.game.cache.addSound(t.key,t.url,t.data,false,true)}break;case"text":t.data=i;this.game.cache.addText(t.key,t.url,t.data);break;case"physics":var n=JSON.parse(i);this.game.cache.addPhysicsData(t.key,t.url,n,t.format);break;case"script":t.data=document.createElement("script");t.data.language="javascript";t.data.type="text/javascript";t.data.defer=false;t.data.text=i;document.head.appendChild(t.data);if(t.callback){t.data=t.callback.call(t.callbackContext,t.key,i)}break;case"binary":if(t.callback){t.data=t.callback.call(t.callbackContext,t.key,i)}else{t.data=i}this.game.cache.addBinary(t.key,t.data);break}if(s){this.asyncComplete(t)}},jsonLoadComplete:function(t,e){var i=window.__wx&&typeof wx.getSharedCanvas!="function"?e:JSON.parse(e.responseText);if(t.type==="tilemap"){this.game.cache.addTilemap(t.key,t.url,i,t.format)}else if(t.type==="json"){this.game.cache.addJSON(t.key,t.url,i)}else{this.game.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format)}this.asyncComplete(t)},csvLoadComplete:function(t,e){var i=window.__wx&&typeof wx.getSharedCanvas!="function"?e:e.responseText;this.game.cache.addTilemap(t.key,t.url,i,t.format);this.asyncComplete(t)},xmlLoadComplete:function(t,e){var i=window.__wx&&typeof wx.getSharedCanvas!="function"?e:e.responseText;var s=this.parseXml(i);if(!s){var n=e.responseType||e.contentType;console.warn("Phaser.Loader - "+t.key+": invalid XML ("+n+")");this.asyncComplete(t,"invalid XML");return}if(t.type==="bitmapfont"){this.game.cache.addBitmapFont(t.key,t.url,t.data,s,t.xSpacing,t.ySpacing)}else if(t.type==="textureatlas"){this.game.cache.addTextureAtlas(t.key,t.url,t.data,s,t.format)}else if(t.type==="xml"){this.game.cache.addXML(t.key,t.url,s)}this.asyncComplete(t)},parseXml:function(t){var e;try{if(window["DOMParser"]){var i=new DOMParser;e=i.parseFromString(t,"text/xml")}else{e=new ActiveXObject("Microsoft.XMLDOM");e.async="false";e.loadXML(t)}}catch(t){e=null}if(!e||!e.documentElement||e.getElementsByTagName("parsererror").length){return null}else{return e}},updateProgress:function(){if(this.preloadSprite){if(this.preloadSprite.direction===0){this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress)}else{this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress)}if(this.preloadSprite.sprite){this.preloadSprite.sprite.updateCrop()}else{this.preloadSprite=null}}},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(L.Loader.prototype,"progressFloat",{get:function(){var t=this._loadedFileCount/this._totalFileCount*100;return L.Math.clamp(t||0,0,100)}});Object.defineProperty(L.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});L.Loader.prototype.constructor=L.Loader;L.LoaderParser={bitmapFont:function(t,e,i,s,n){if(window.__wx&&window.Tautologistics){var r={};var a=Tautologistics.NodeHtmlParser.DomUtils.getElementsByTagName("info",e)[0];var o=Tautologistics.NodeHtmlParser.DomUtils.getElementsByTagName("common",e)[0];r.font=a["attribs"]["face"];r.size=parseInt(a["attribs"]["size"],10);r.lineHeight=parseInt(o["attribs"]["lineHeight"],10)+n;r.chars={};var h=Tautologistics.NodeHtmlParser.DomUtils.getElementsByTagName("char",e);for(var l=0;l<h.length;l++){var u=parseInt(h[l].attribs.id,10);var f=new PIXI.Rectangle(parseInt(h[l].attribs.x,10),parseInt(h[l].attribs.y,10),parseInt(h[l].attribs.width,10),parseInt(h[l].attribs.height,10));r.chars[u]={xOffset:parseInt(h[l].attribs.xoffset,10),yOffset:parseInt(h[l].attribs.yoffset,10),xAdvance:parseInt(h[l].attribs.xadvance,10)+s,kerning:{},texture:PIXI.TextureCache[i]=new PIXI.Texture(PIXI.BaseTextureCache[i],f)}}var c=Tautologistics.NodeHtmlParser.DomUtils.getElementsByTagName("kerning",e);for(l=0;l<c.length;l++){var d=parseInt(c[l].attribs.first,10);var p=parseInt(c[l].attribs.second,10);var g=parseInt(c[l].attribs.amount,10);r.chars[p].kerning[d]=g}PIXI.BitmapText.fonts[i]=r;return}var r={};var a=e.getElementsByTagName("info")[0];var o=e.getElementsByTagName("common")[0];r.font=a.getAttribute("face");r.size=parseInt(a.getAttribute("size"),10);r.lineHeight=parseInt(o.getAttribute("lineHeight"),10)+n;r.chars={};var h=e.getElementsByTagName("char");for(var l=0;l<h.length;l++){var u=parseInt(h[l].getAttribute("id"),10);var f=new PIXI.Rectangle(parseInt(h[l].getAttribute("x"),10),parseInt(h[l].getAttribute("y"),10),parseInt(h[l].getAttribute("width"),10),parseInt(h[l].getAttribute("height"),10));r.chars[u]={xOffset:parseInt(h[l].getAttribute("xoffset"),10),yOffset:parseInt(h[l].getAttribute("yoffset"),10),xAdvance:parseInt(h[l].getAttribute("xadvance"),10)+s,kerning:{},texture:PIXI.TextureCache[i]=new PIXI.Texture(PIXI.BaseTextureCache[i],f)}}var c=e.getElementsByTagName("kerning");for(l=0;l<c.length;l++){var d=parseInt(c[l].getAttribute("first"),10);var p=parseInt(c[l].getAttribute("second"),10);var g=parseInt(c[l].getAttribute("amount"),10);r.chars[p].kerning[d]=g}PIXI.BitmapText.fonts[i]=r}};L.AudioSprite=function(t,e){this.game=t;this.key=e;this.config=this.game.cache.getJSON(e+"-audioatlas");this.autoplayKey=null;this.autoplay=false;this.sounds={};for(var i in this.config.spritemap){var s=this.config.spritemap[i];var n=this.game.add.sound(this.key);n.addMarker(i,s.start,s.end-s.start,null,s.loop);this.sounds[i]=n}if(this.config.autoplay){this.autoplayKey=this.config.autoplay;this.play(this.autoplayKey);this.autoplay=this.sounds[this.autoplayKey]}};L.AudioSprite.prototype={play:function(t,e){if(typeof e==="undefined"){e=1}return this.sounds[t].play(t,null,e)},stop:function(t){if(!t){for(var e in this.sounds){this.sounds[e].stop()}}else{this.sounds[t].stop()}},get:function(t){return this.sounds[t]}};L.AudioSprite.prototype.constructor=L.AudioSprite;L.Sound=function(t,e,i,s,n){if(typeof i==="undefined"){i=1}if(typeof s==="undefined"){s=false}if(typeof n==="undefined"){n=t.sound.connectToMaster}this.game=t;this.name=e;this.key=e;this.loop=s;this.volume=i;this.markers={};this.context=null;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker="";this.fadeTween=null;this.pendingPlayback=false;this.override=false;this.allowMultiple=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this._sound=null;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(typeof this.context.createGain==="undefined"){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=i*this.game.sound.volume;if(n){this.gainNode.connect(this.masterGainNode)}}else if(this.usingAudioTag){if(this.game.cache.getSound(e)&&this.game.cache.isSoundReady(e)){this._sound=this.game.cache.getSoundData(e);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}this.onDecoded=new L.Signal;this.onPlay=new L.Signal;this.onPause=new L.Signal;this.onResume=new L.Signal;this.onLoop=new L.Signal;this.onStop=new L.Signal;this.onMute=new L.Signal;this.onMarkerComplete=new L.Signal;this.onFadeComplete=new L.Signal;this._volume=i;this._buffer=null;this._muted=false;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._muteVolume=0;this._tempLoop=0;this._paused=false;this._onDecodedEventDispatched=false};L.Sound.prototype={soundHasUnlocked:function(t){if(t===this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(t,e,i,s,n){if(typeof s==="undefined"){s=1}if(typeof n==="undefined"){n=false}this.markers[t]={name:t,start:e,stop:e+i,volume:s,duration:i,durationMS:i*1e3,loop:n}},removeMarker:function(t){delete this.markers[t]},onEndedHandler:function(){this.isPlaying=false;this.stop()},update:function(){if(this.isDecoded&&!this._onDecodedEventDispatched){this.onDecoded.dispatch(this);this._onDecodedEventDispatched=true}if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}if(this.isPlaying){this.currentTime=this.game.time.time-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time}else{this.onMarkerComplete.dispatch(this.currentMarker,this);this.play(this.currentMarker,0,this.volume,true,true)}}else{if(this.currentMarker!==""){this.stop()}}}else{if(this.loop){this.onLoop.dispatch(this);this.play(this.currentMarker,0,this.volume,true,true)}else{this.stop()}}}}},loopFull:function(t){this.play(null,0,t,true)},play:function(t,e,i,s,n){if(typeof t==="undefined"||t===false||t===null){t=""}if(typeof n==="undefined"){n=true}if(this.isPlaying&&!this.allowMultiple&&!n&&!this.override){return this}if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||n)){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(t){}}}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}if(t===""&&Object.keys(this.markers).length>0){return this}if(t!==""){this.currentMarker=t;if(this.markers[t]){this.position=this.markers[t].start;this.volume=this.markers[t].volume;this.loop=this.markers[t].loop;this.duration=this.markers[t].duration;this.durationMS=this.markers[t].durationMS;if(typeof i!=="undefined"){this.volume=i}if(typeof s!=="undefined"){this.loop=s}this._tempMarker=t;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{return this}}else{e=e||0;if(typeof i==="undefined"){i=this._volume}if(typeof s==="undefined"){s=this.loop}this.position=e;this.volume=i;this.loop=s;this.duration=0;this.durationMS=0;this._tempMarker=t;this._tempPosition=e;this._tempVolume=i;this._tempLoop=s}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){if(this._buffer===null){this._buffer=this.game.cache.getSoundData(this.key)}this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop&&t===""){this._sound.loop=true}if(!this.loop&&t===""){this._sound.onended=this.onEndedHandler.bind(this)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=Math.ceil(this.totalDuration*1e3)}if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,this.position,this.duration)}else{if(this.loop&&t===""){this._sound.start(0)}else{this._sound.start(0,this.position,this.duration)}}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)){this._sound.play();this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1e3}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}return this},restart:function(t,e,i,s){t=t||"";e=e||0;i=i||1;if(typeof s==="undefined"){s=false}this.play(t,e,i,s,true)},pause:function(){if(this.isPlaying&&this._sound){this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.time;this.onPause.dispatch(this);this.stop()}},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var t=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop){this._sound.loop=true}if(!this.loop&&this.currentMarker===""){this._sound.onended=this.onEndedHandler.bind(this)}var e=this.duration-this.pausedPosition/1e3;if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,t,e)}else{this._sound.start(0,t,e)}}else{this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=this.game.time.time-this.pausedTime;this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(t){}}}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}this.pendingPlayback=false;this.isPlaying=false;var t=this.currentMarker;if(this.currentMarker!==""){this.onMarkerComplete.dispatch(this.currentMarker,this)}this.currentMarker="";if(this.fadeTween!==null){this.fadeTween.stop()}if(!this.paused){this.onStop.dispatch(this,t)}},fadeIn:function(t,e,i){if(typeof e==="undefined"){e=false}if(typeof i==="undefined"){i=this.currentMarker}if(this.paused){return}this.play(i,0,0,e);this.fadeTo(t,1)},fadeOut:function(t){this.fadeTo(t,0)},fadeTo:function(t,e){if(!this.isPlaying||this.paused||e===this.volume){return}if(typeof t==="undefined"){t=1e3}if(typeof e==="undefined"){console.warn("Phaser.Sound.fadeTo: No Volume Specified.");return}this.fadeTween=this.game.add.tween(this).to({volume:e},t,L.Easing.Linear.None,true);this.fadeTween.onComplete.add(this.fadeComplete,this)},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);if(this.volume===0){this.stop()}},destroy:function(t){if(typeof t==="undefined"){t=true}this.stop();if(t){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}}};L.Sound.prototype.constructor=L.Sound;Object.defineProperty(L.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(L.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(L.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(t){t=t||null;if(t){this._muted=true;if(this.usingWebAudio){this._muteVolume=this.gainNode.gain.value;this.gainNode.gain.value=0}else if(this.usingAudioTag&&this._sound){this._muteVolume=this._sound.volume;this._sound.volume=0}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}this.onMute.dispatch(this)}});Object.defineProperty(L.Sound.prototype,"volume",{get:function(){return this._volume},set:function(t){if(this.usingWebAudio){this._volume=t;this.gainNode.gain.value=t}else if(this.usingAudioTag&&this._sound){if(t>=0&&t<=1){this._volume=t;this._sound.volume=t}}}});L.SoundManager=function(t){this.game=t;this.onSoundDecode=new L.Signal;this._codeMuted=false;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new L.ArraySet;this._watching=false;this._watchCallback=null;this._watchContext=null;this.context=null;this.usingWebAudio=true;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32};L.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(!this.game.device.cocoonJS&&this.game.device.iOS||window["PhaserGlobal"]&&window["PhaserGlobal"].fakeiOSTouchLock){this.game.input.touch.callbackContext=this;this.game.input.touch.touchStartCallback=this.unlock;this.game.input.mouse.callbackContext=this;this.game.input.mouse.mouseDownCallback=this.unlock;this.touchLocked=true}else{this.touchLocked=false}if(window["PhaserGlobal"]){if(window["PhaserGlobal"].disableAudio===true){this.usingWebAudio=false;this.noAudio=true;return}if(window["PhaserGlobal"].disableWebAudio===true){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false;return}}if(window["PhaserGlobal"]&&window["PhaserGlobal"].audioContext){this.context=window["PhaserGlobal"].audioContext}else{if(!!window["AudioContext"]){try{this.context=new window["AudioContext"]}catch(t){this.context=null;this.usingWebAudio=false;this.noAudio=true}}else if(!!window["webkitAudioContext"]){try{this.context=new window["webkitAudioContext"]}catch(t){this.context=null;this.usingWebAudio=false;this.noAudio=true}}}if(!!window["Audio"]&&this.context===null){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false}if(this.context!==null){if(typeof this.context.createGain==="undefined"){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}},unlock:function(){if(this.touchLocked===false){return}if(this.game.device.webAudio===false||window["PhaserGlobal"]&&window["PhaserGlobal"].disableWebAudio===true){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null;this.game.input.mouse.callbackContext=null;this.game.input.mouse.mouseDownCallback=null}else{var t=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=t;this._unlockSource.connect(this.context.destination);if(typeof this._unlockSource.start==="undefined"){this._unlockSource.noteOn(0)}else{this._unlockSource.start(0)}}},stopAll:function(){for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].stop()}}},pauseAll:function(){for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].pause()}}},resumeAll:function(){for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].resume()}}},decode:function(e,i){i=i||null;var t=this.game.cache.getSoundData(e);if(t){if(this.game.cache.isSoundDecoded(e)===false){this.game.cache.updateSound(e,"isDecoding",true);var s=this;this.context.decodeAudioData(t,function(t){if(t){s.game.cache.decodedSound(e,t);s.onSoundDecode.dispatch(e,i)}})}}},setDecodedCallback:function(t,e,i){if(typeof t==="string"){t=[t]}this._watchList.reset();for(var s=0;s<t.length;s++){if(t[s]instanceof L.Sound){if(!this.game.cache.isSoundDecoded(t[s].key)){this._watchList.add(t[s].key)}}else if(!this.game.cache.isSoundDecoded(t[s])){this._watchList.add(t[s])}}if(this._watchList.total===0){this._watching=false;e.call(i)}else{this._watching=true;this._watchCallback=e;this._watchContext=i}},update:function(){if(this.touchLocked){if(this.game.device.webAudio&&this._unlockSource!==null){if(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null}}}for(var t=0;t<this._sounds.length;t++){this._sounds[t].update()}if(this._watching){var e=this._watchList.first;while(e){if(this.game.cache.isSoundDecoded(e)){this._watchList.remove(e)}e=this._watchList.next}if(this._watchList.total===0){this._watching=false;this._watchCallback.call(this._watchContext)}}},add:function(t,e,i,s){if(typeof e==="undefined"){e=1}if(typeof i==="undefined"){i=false}if(typeof s==="undefined"){s=this.connectToMaster}var n=new L.Sound(this.game,t,e,i,s);this._sounds.push(n);return n},addSprite:function(t){var e=new L.AudioSprite(this.game,t);return e},remove:function(t){var e=this._sounds.length;while(e--){if(this._sounds[e]===t){this._sounds[e].destroy(false);this._sounds.splice(e,1);return true}}return false},removeByKey:function(t){var e=this._sounds.length;var i=0;while(e--){if(this._sounds[e].key===t){this._sounds[e].destroy(false);this._sounds.splice(e,1);i++}}return i},play:function(t,e,i){var s=this.add(t,e,i);s.play();return s},setMute:function(){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t].usingAudioTag){this._sounds[t].mute=true}}},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t].usingAudioTag){this._sounds[t].mute=false}}},destroy:function(){this.stopAll();for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].destroy()}}this._sounds=[];this.onSoundDecode.dispose();if(this.context&&window["PhaserGlobal"]){window["PhaserGlobal"].audioContext=this.context}}};L.SoundManager.prototype.constructor=L.SoundManager;Object.defineProperty(L.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(t){t=t||null;if(t){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(L.SoundManager.prototype,"volume",{get:function(){if(this.usingWebAudio){return this.masterGain.gain.value}else{return this._volume}},set:function(t){this._volume=t;if(this.usingWebAudio){this.masterGain.gain.value=t}else{for(var e=0;e<this._sounds.length;e++){if(this._sounds[e].usingAudioTag){this._sounds[e].volume=this._sounds[e].volume*t}}}}});L.Utils.Debug=function(t){this.game=t;this.sprite=null;this.bmd=null;this.canvas=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=true;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=false};L.Utils.Debug.prototype={boot:function(){if(this.game.renderType===L.CANVAS){this.context=this.game.context}else{this.bmd=this.game.make.bitmapData(this.game.width,this.game.height);this.sprite=this.game.make.image(0,0,this.bmd);this.game.stage.addChild(this.sprite);this.canvas=L.Canvas.create(this.game.width,this.game.height,"",true);this.context=this.canvas.getContext("2d")}},preUpdate:function(){if(this.dirty&&this.sprite){this.bmd.clear();this.bmd.draw(this.canvas,0,0);this.context.clearRect(0,0,this.game.width,this.game.height);this.dirty=false}},reset:function(){if(this.context){this.context.clearRect(0,0,this.game.width,this.game.height)}if(this.sprite){this.bmd.clear()}},start:function(t,e,i,s){if(typeof t!=="number"){t=0}if(typeof e!=="number"){e=0}i=i||"rgb(255,255,255)";if(typeof s==="undefined"){s=0}this.currentX=t;this.currentY=e;this.currentColor=i;this.currentAlpha=this.context.globalAlpha;this.columnWidth=s;this.dirty=true;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=i;this.context.fillStyle=i;this.context.font=this.font;this.context.globalAlpha=1},stop:function(){this.context.restore();this.context.globalAlpha=this.currentAlpha},line:function(){var t=this.currentX;for(var e=0;e<arguments.length;e++){if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(arguments[e],t+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(arguments[e],t,this.currentY);t+=this.columnWidth}this.currentY+=this.lineHeight},soundInfo:function(t,e,i,s){this.start(e,i,s);this.line("Sound: "+t.key+" Locked: "+t.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(t.key)+" Pending Playback: "+t.pendingPlayback);this.line("Decoded: "+t.isDecoded+" Decoding: "+t.isDecoding);this.line("Total Duration: "+t.totalDuration+" Playing: "+t.isPlaying);this.line("Time: "+t.currentTime);this.line("Volume: "+t.volume+" Muted: "+t.mute);this.line("WebAudio: "+t.usingWebAudio+" Audio: "+t.usingAudioTag);if(t.currentMarker!==""){this.line("Marker: "+t.currentMarker+" Duration: "+t.duration+" (ms: "+t.durationMS+")");this.line("Start: "+t.markers[t.currentMarker].start+" Stop: "+t.markers[t.currentMarker].stop);this.line("Position: "+t.position)}this.stop()},cameraInfo:function(t,e,i,s){this.start(e,i,s);this.line("Camera ("+t.width+" x "+t.height+")");this.line("X: "+t.x+" Y: "+t.y);if(t.bounds){this.line("Bounds x: "+t.bounds.x+" Y: "+t.bounds.y+" w: "+t.bounds.width+" h: "+t.bounds.height)}this.line("View x: "+t.view.x+" Y: "+t.view.y+" w: "+t.view.width+" h: "+t.view.height);this.line("Total in view: "+t.totalInView);this.stop()},timer:function(t,e,i,s){this.start(e,i,s);this.line("Timer (running: "+t.running+" expired: "+t.expired+")");this.line("Next Tick: "+t.next+" Duration: "+t.duration);this.line("Paused: "+t.paused+" Length: "+t.length);this.stop()},pointer:function(t,e,i,s,n){if(t==null){return}if(typeof e==="undefined"){e=false}i=i||"rgba(0,255,0,0.5)";s=s||"rgba(255,0,0,0.5)";if(e===true&&t.isUp===true){return}this.start(t.x,t.y-100,n);this.context.beginPath();this.context.arc(t.x,t.y,t.circle.radius,0,Math.PI*2);if(t.active){this.context.fillStyle=i}else{this.context.fillStyle=s}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(t.positionDown.x,t.positionDown.y);this.context.lineTo(t.position.x,t.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();this.line("ID: "+t.id+" Active: "+t.active);this.line("World X: "+t.worldX+" World Y: "+t.worldY);this.line("Screen X: "+t.x+" Screen Y: "+t.y);this.line("Duration: "+t.duration+" ms");this.line("is Down: "+t.isDown+" is Up: "+t.isUp);this.stop()},spriteInputInfo:function(t,e,i,s){this.start(e,i,s);this.line("Sprite Input: ("+t.width+" x "+t.height+")");this.line("x: "+t.input.pointerX().toFixed(1)+" y: "+t.input.pointerY().toFixed(1));this.line("over: "+t.input.pointerOver()+" duration: "+t.input.overDuration().toFixed(0));this.line("down: "+t.input.pointerDown()+" duration: "+t.input.downDuration().toFixed(0));this.line("just over: "+t.input.justOver()+" just out: "+t.input.justOut());this.stop()},key:function(t,e,i,s){this.start(e,i,s,150);this.line("Key:",t.keyCode,"isDown:",t.isDown);this.line("justDown:",t.justDown,"justUp:",t.justUp);this.line("Time Down:",t.timeDown.toFixed(0),"duration:",t.duration.toFixed(0));this.stop()},inputInfo:function(t,e,i){this.start(t,e,i);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(t,e,i){var s=t.getBounds();s.x+=this.game.camera.x;s.y+=this.game.camera.y;this.rectangle(s,e,i)},ropeSegments:function(t,e,i){var s=t.segments;s.forEach(function(t){this.rectangle(t,e,i)},this)},spriteInfo:function(t,e,i,s){this.start(e,i,s);this.line("Sprite: "+" ("+t.width+" x "+t.height+") anchor: "+t.anchor.x+" x "+t.anchor.y);this.line("x: "+t.x.toFixed(1)+" y: "+t.y.toFixed(1));this.line("angle: "+t.angle.toFixed(1)+" rotation: "+t.rotation.toFixed(1));this.line("visible: "+t.visible+" in camera: "+t.inCamera);this.line("bounds x: "+t._bounds.x.toFixed(1)+" y: "+t._bounds.y.toFixed(1)+" w: "+t._bounds.width.toFixed(1)+" h: "+t._bounds.height.toFixed(1));this.stop()},spriteCoords:function(t,e,i,s){this.start(e,i,s,100);if(t.name){this.line(t.name)}this.line("x:",t.x.toFixed(2),"y:",t.y.toFixed(2));this.line("pos x:",t.position.x.toFixed(2),"pos y:",t.position.y.toFixed(2));this.line("world x:",t.world.x.toFixed(2),"world y:",t.world.y.toFixed(2));this.stop()},lineInfo:function(t,e,i,s){this.start(e,i,s,80);this.line("start.x:",t.start.x.toFixed(2),"start.y:",t.start.y.toFixed(2));this.line("end.x:",t.end.x.toFixed(2),"end.y:",t.end.y.toFixed(2));this.line("length:",t.length.toFixed(2),"angle:",t.angle);this.stop()},pixel:function(t,e,i,s){s=s||2;this.start();this.context.fillStyle=i;this.context.fillRect(t,e,s,s);this.stop()},geom:function(t,e,i,s){if(typeof i==="undefined"){i=true}if(typeof s==="undefined"){s=0}e=e||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=e;this.context.strokeStyle=e;if(t instanceof L.Rectangle||s===1){if(i){this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}else{this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}}else if(t instanceof L.Circle||s===2){this.context.beginPath();this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,Math.PI*2,false);this.context.closePath();if(i){this.context.fill()}else{this.context.stroke()}}else if(t instanceof L.Point||s===3){this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4)}else if(t instanceof L.Line||s===4){this.context.lineWidth=1;this.context.beginPath();this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y);this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y);this.context.closePath();this.context.stroke()}this.stop()},rectangle:function(t,e,i){if(typeof i==="undefined"){i=true}e=e||"rgba(0, 255, 0, 0.4)";this.start();if(i){this.context.fillStyle=e;this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}else{this.context.strokeStyle=e;this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}this.stop()},text:function(t,e,i,s,n){s=s||"rgb(255,255,255)";n=n||"16px Courier";this.start();this.context.font=n;if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(t,e+1,i+1)}this.context.fillStyle=s;this.context.fillText(t,e,i);this.stop()},quadTree:function(t,e){e=e||"rgba(255,0,0,0.3)";this.start();var i=t.bounds;if(t.nodes.length===0){this.context.strokeStyle=e;this.context.strokeRect(i.x,i.y,i.width,i.height);this.text("size: "+t.objects.length,i.x+4,i.y+16,"rgb(0,200,0)","12px Courier");this.context.strokeStyle="rgb(0,255,0)";for(var s=0;s<t.objects.length;s++){this.context.strokeRect(t.objects[s].x,t.objects[s].y,t.objects[s].width,t.objects[s].height)}}else{for(var s=0;s<t.nodes.length;s++){this.quadTree(t.nodes[s])}}this.stop()},body:function(t,e,i){if(t.body){this.start();if(t.body.type===L.Physics.ARCADE){L.Physics.Arcade.Body.render(this.context,t.body,e,i)}else if(t.body.type===L.Physics.NINJA){L.Physics.Ninja.Body.render(this.context,t.body,e,i)}else if(t.body.type===L.Physics.BOX2D){L.Physics.Box2D.renderBody(this.context,t.body,e)}this.stop()}},bodyInfo:function(t,e,i,s){if(t.body){this.start(e,i,s,210);if(t.body.type===L.Physics.ARCADE){L.Physics.Arcade.Body.renderBodyInfo(this,t.body)}else if(t.body.type===L.Physics.BOX2D){this.game.physics.box2d.renderBodyInfo(this,t.body)}this.stop()}},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(t,e){this.start();L.Physics.Box2D.renderBody(this.context,t,e);this.stop()}};L.Utils.Debug.prototype.constructor=L.Utils.Debug;L.ArraySet=function(t){this.position=0;this.list=t||[]};L.ArraySet.prototype={add:function(t){if(!this.exists(t)){this.list.push(t)}return t},getIndex:function(t){return this.list.indexOf(t)},getByKey:function(t,e){var i=this.list.length;while(i--){if(this.list[i][t]===e){return this.list[i]}}return null},exists:function(t){return this.list.indexOf(t)>-1},reset:function(){this.list.length=0},remove:function(t){var e=this.list.indexOf(t);if(e>-1){this.list.splice(e,1);return t}},setAll:function(t,e){var i=this.list.length;while(i--){if(this.list[i]){this.list[i][t]=e}}},callAll:function(t){var e=Array.prototype.splice.call(arguments,1);var i=this.list.length;while(i--){if(this.list[i]&&this.list[i][t]){this.list[i][t].apply(this.list[i],e)}}},removeAll:function(t){if(typeof t==="undefined"){t=false}var e=this.list.length;while(e--){if(this.list[e]){var i=this.remove(this.list[e]);if(t){i.destroy()}}}this.position=0;this.list=[]}};Object.defineProperty(L.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(L.ArraySet.prototype,"first",{get:function(){this.position=0;if(this.list.length>0){return this.list[0]}else{return null}}});Object.defineProperty(L.ArraySet.prototype,"next",{get:function(){if(this.position<this.list.length){this.position++;return this.list[this.position]}else{return null}}});L.ArraySet.prototype.constructor=L.ArraySet;L.ArrayList=L.ArraySet;L.ArrayUtils={getRandomItem:function(t,e,i){if(t==null){return null}if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i=t.length}var s=e+Math.floor(Math.random()*i);return t[s]===undefined?null:t[s]},removeRandomItem:function(t,e,i){if(t==null){return null}if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i=t.length}var s=e+Math.floor(Math.random()*i);if(s<t.length){var n=t.splice(s,1);return n[0]===undefined?null:n[0]}else{return null}},shuffle:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1));var s=t[e];t[e]=t[i];t[i]=s}return t},transposeMatrix:function(t){var e=t.length;var i=t[0].length;var s=new Array(i);for(var n=0;n<i;n++){s[n]=new Array(e);for(var r=e-1;r>-1;r--){s[n][r]=t[r][n]}}return s},rotateMatrix:function(t,e){if(typeof e!=="string"){e=(e%360+360)%360}if(e===90||e===-270||e==="rotateLeft"){t=L.ArrayUtils.transposeMatrix(t);t=t.reverse()}else if(e===-90||e===270||e==="rotateRight"){t=t.reverse();t=L.ArrayUtils.transposeMatrix(t)}else if(Math.abs(e)===180||e==="rotate180"){for(var i=0;i<t.length;i++){t[i].reverse()}t=t.reverse()}return t},findClosest:function(t,e){if(!e.length){return NaN}else if(e.length===1||t<e[0]){return e[0]}var i=1;while(e[i]<t){i++}var s=e[i-1];var n=i<e.length?e[i]:Number.POSITIVE_INFINITY;return n-t<=t-s?n:s},rotate:function(t){var e=t.shift();t.push(e);return e},numberArray:function(t,e){var i=[];for(var s=t;s<=e;s++){i.push(s)}return i},numberArrayStep:function(t,e,i){t=+t||0;var s=typeof e;if((s==="number"||s==="string")&&i&&i[e]===t){e=i=null}i=i==null?1:+i||0;if(e===null){e=t;t=0}else{e=+e||0}var n=-1;var r=Math.max(L.Math.roundAwayFromZero((e-t)/(i||1)),0);var a=new Array(r);while(++n<r){a[n]=t;t+=i}return a}};L.Color={packPixel:function(t,e,i,s){if(L.Device.LITTLE_ENDIAN){return(s<<24|i<<16|e<<8|t)>>>0}else{return(t<<24|e<<16|i<<8|s)>>>0}},unpackPixel:function(t,e,i,s){if(typeof e==="undefined"||e===null){e=L.Color.createColor()}if(typeof i==="undefined"||i===null){i=false}if(typeof s==="undefined"||s===null){s=false}if(L.Device.LITTLE_ENDIAN){e.a=(t&4278190080)>>>24;e.b=(t&16711680)>>>16;e.g=(t&65280)>>>8;e.r=t&255}else{e.r=(t&4278190080)>>>24;e.g=(t&16711680)>>>16;e.b=(t&65280)>>>8;e.a=t&255}e.color=t;e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a/255+")";if(i){L.Color.RGBtoHSL(e.r,e.g,e.b,e)}if(s){L.Color.RGBtoHSV(e.r,e.g,e.b,e)}return e},fromRGBA:function(t,e){if(!e){e=L.Color.createColor()}e.r=(t&4278190080)>>>24;e.g=(t&16711680)>>>16;e.b=(t&65280)>>>8;e.a=t&255;e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";return e},toRGBA:function(t,e,i,s){return t<<24|e<<16|i<<8|s},RGBtoHSL:function(t,e,i,s){if(!s){s=L.Color.createColor(t,e,i,1)}t/=255;e/=255;i/=255;var n=Math.min(t,e,i);var r=Math.max(t,e,i);s.h=0;s.s=0;s.l=(r+n)/2;if(r!==n){var a=r-n;s.s=s.l>.5?a/(2-r-n):a/(r+n);if(r===t){s.h=(e-i)/a+(e<i?6:0)}else if(r===e){s.h=(i-t)/a+2}else if(r===i){s.h=(t-e)/a+4}s.h/=6}return s},HSLtoRGB:function(t,e,i,s){if(!s){s=L.Color.createColor(i,i,i)}else{s.r=i;s.g=i;s.b=i}if(e!==0){var n=i<.5?i*(1+e):i+e-i*e;var r=2*i-n;s.r=L.Color.hueToColor(r,n,t+1/3);s.g=L.Color.hueToColor(r,n,t);s.b=L.Color.hueToColor(r,n,t-1/3)}s.r=Math.floor(s.r*255|0);s.g=Math.floor(s.g*255|0);s.b=Math.floor(s.b*255|0);L.Color.updateColor(s);return s},RGBtoHSV:function(t,e,i,s){if(!s){s=L.Color.createColor(t,e,i,255)}t/=255;e/=255;i/=255;var n=Math.min(t,e,i);var r=Math.max(t,e,i);var a=r-n;s.h=0;s.s=r===0?0:a/r;s.v=r;if(r!==n){if(r===t){s.h=(e-i)/a+(e<i?6:0)}else if(r===e){s.h=(i-t)/a+2}else if(r===i){s.h=(t-e)/a+4}s.h/=6}return s},HSVtoRGB:function(t,e,i,s){if(typeof s==="undefined"){s=L.Color.createColor(0,0,0,1,t,e,0,i)}var n,r,a;var o=Math.floor(t*6);var h=t*6-o;var l=i*(1-e);var u=i*(1-h*e);var f=i*(1-(1-h)*e);switch(o%6){case 0:n=i;r=f;a=l;break;case 1:n=u;r=i;a=l;break;case 2:n=l;r=i;a=f;break;case 3:n=l;r=u;a=i;break;case 4:n=f;r=l;a=i;break;case 5:n=i;r=l;a=u;break}s.r=Math.floor(n*255);s.g=Math.floor(r*255);s.b=Math.floor(a*255);L.Color.updateColor(s);return s},hueToColor:function(t,e,i){if(i<0){i+=1}if(i>1){i-=1}if(i<1/6){return t+(e-t)*6*i}if(i<1/2){return e}if(i<2/3){return t+(e-t)*(2/3-i)*6}return t},createColor:function(t,e,i,s,n,r,a,o){var h={r:t||0,g:e||0,b:i||0,a:s||1,h:n||0,s:r||0,l:a||0,v:o||0,color:0,color32:0,rgba:""};h.color=L.Color.getColor(h.r,h.g,h.b);h.color32=L.Color.getColor32(h.a,h.r,h.g,h.b);return L.Color.updateColor(h)},updateColor:function(t){t.rgba="rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+t.a.toString()+")";return t},getColor32:function(t,e,i,s){return t<<24|e<<16|i<<8|s},getColor:function(t,e,i){return t<<16|e<<8|i},RGBtoString:function(t,e,i,s,n){if(typeof s==="undefined"){s=255}if(typeof n==="undefined"){n="#"}if(n==="#"){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)}else{return"0x"+L.Color.componentToHex(s)+L.Color.componentToHex(t)+L.Color.componentToHex(e)+L.Color.componentToHex(i)}},hexToRGB:function(t){var e=L.Color.hexToColor(t);if(e){return L.Color.getColor32(e.a,e.r,e.g,e.b)}},hexToColor:function(t,e){t=t.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,s){return e+e+i+i+s+s});var i=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(i){var s=parseInt(i[1],16);var n=parseInt(i[2],16);var r=parseInt(i[3],16);if(!e){e=L.Color.createColor(s,n,r)}else{e.r=s;e.g=n;e.b=r}}return e},webToColor:function(t,e){if(!e){e=L.Color.createColor()}var i=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t);if(i){e.r=parseInt(i[1],10);e.g=parseInt(i[2],10);e.b=parseInt(i[3],10);e.a=i[4]!==undefined?parseFloat(i[4]):1}return e},valueToColor:function(t,e){if(!e){e=L.Color.createColor()}if(typeof t==="string"){if(t.indexOf("rgb")===0){return L.Color.webToColor(t,e)}else{e.a=1;return L.Color.hexToColor(t,e)}}else if(typeof t==="number"){var i=L.Color.getRGB(t);e.r=i.r;e.g=i.g;e.b=i.b;e.a=i.a/255;return e}else{return e}},componentToHex:function(t){var e=t.toString(16);return e.length==1?"0"+e:e},HSVColorWheel:function(t,e){if(typeof t==="undefined"){t=1}if(typeof e==="undefined"){e=1}var i=[];for(var s=0;s<=359;s++){i.push(L.Color.HSVtoRGB(s/359,t,e))}return i},HSLColorWheel:function(t,e){if(typeof t==="undefined"){t=.5}if(typeof e==="undefined"){e=.5}var i=[];for(var s=0;s<=359;s++){i.push(L.Color.HSLtoRGB(s/359,t,e))}return i},interpolateColor:function(t,e,i,s,n){if(typeof n==="undefined"){n=255}var r=L.Color.getRGB(t);var a=L.Color.getRGB(e);var o=(a.red-r.red)*s/i+r.red;var h=(a.green-r.green)*s/i+r.green;var l=(a.blue-r.blue)*s/i+r.blue;return L.Color.getColor32(n,o,h,l)},interpolateColorWithRGB:function(t,e,i,s,n,r){var a=L.Color.getRGB(t);var o=(e-a.red)*r/n+a.red;var h=(i-a.green)*r/n+a.green;var l=(s-a.blue)*r/n+a.blue;return L.Color.getColor(o,h,l)},interpolateRGB:function(t,e,i,s,n,r,a,o){var h=(s-t)*o/a+t;var l=(n-e)*o/a+e;var u=(r-i)*o/a+i;return L.Color.getColor(h,l,u)},getRandomColor:function(t,e,i){if(typeof t==="undefined"){t=0}if(typeof e==="undefined"){e=255}if(typeof i==="undefined"){i=255}if(e>255||t>e){return L.Color.getColor(255,255,255)}var s=t+Math.round(Math.random()*(e-t));var n=t+Math.round(Math.random()*(e-t));var r=t+Math.round(Math.random()*(e-t));return L.Color.getColor32(i,s,n,r)},getRGB:function(t){if(t>16777215){return{alpha:t>>>24,red:t>>16&255,green:t>>8&255,blue:t&255,a:t>>>24,r:t>>16&255,g:t>>8&255,b:t&255}}else{return{alpha:255,red:t>>16&255,green:t>>8&255,blue:t&255,a:255,r:t>>16&255,g:t>>8&255,b:t&255}}},getWebRGB:function(t){if(typeof t==="object"){return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")"}else{var e=L.Color.getRGB(t);return"rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+(e.a/255).toString()+")"}},getAlpha:function(t){return t>>>24},getAlphaFloat:function(t){return(t>>>24)/255},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return t&255}};L.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};L.LinkedList.prototype={add:function(t){if(this.total===0&&this.first===null&&this.last===null){this.first=t;this.last=t;this.next=t;t.prev=this;this.total++;return t}this.last.next=t;t.prev=this.last;this.last=t;this.total++;return t},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(t){if(this.total===1){this.reset();t.next=t.prev=null;return}if(t===this.first){this.first=this.first.next}else if(t===this.last){this.last=this.last.prev}if(t.prev){t.prev.next=t.next}if(t.next){t.next.prev=t.prev}t.next=t.prev=null;if(this.first===null){this.last=null}this.total--},callAll:function(t){if(!this.first||!this.last){return}var e=this.first;do{if(e&&e[t]){e[t].call(e)}e=e.next}while(e!=this.last.next)}};L.LinkedList.prototype.constructor=L.LinkedList;L.Physics=function(t,e){e=e||{};this.game=t;this.config=e;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.parseConfig()};L.Physics.ARCADE=0;L.Physics.P2JS=1;L.Physics.NINJA=2;L.Physics.CHIPMUNK=4;L.Physics.prototype={parseConfig:function(){if((!this.config.hasOwnProperty("arcade")||this.config["arcade"]===true)&&L.Physics.hasOwnProperty("Arcade")){this.arcade=new L.Physics.Arcade(this.game);this.game.time.deltaCap=.2}if(this.config.hasOwnProperty("ninja")&&this.config["ninja"]===true&&L.Physics.hasOwnProperty("Ninja")){this.ninja=new L.Physics.Ninja(this.game)}if(this.config.hasOwnProperty("p2")&&this.config["p2"]===true&&L.Physics.hasOwnProperty("P2")){this.p2=new L.Physics.P2(this.game,this.config)}if(L.Physics.hasOwnProperty("BOX2D")){this.box2d=new L.Physics.BOX2D(this.game,this.config)}},startSystem:function(t){if(t===L.Physics.ARCADE){this.arcade=new L.Physics.Arcade(this.game)}else if(t===L.Physics.P2JS){if(this.p2===null){this.p2=new L.Physics.P2(this.game,this.config)}else{this.p2.reset()}}else if(t===L.Physics.NINJA){this.ninja=new L.Physics.Ninja(this.game)}else if(t===L.Physics.BOX2D){if(this.box2d===null){this.box2d=new L.Physics.Box2D(this.game,this.config)}else{this.box2d.reset()}}},enable:function(t,e,i){if(typeof e==="undefined"){e=L.Physics.ARCADE}if(typeof i==="undefined"){i=false}if(e===L.Physics.ARCADE){this.arcade.enable(t)}else if(e===L.Physics.P2JS&&this.p2){this.p2.enable(t,i)}else if(e===L.Physics.NINJA&&this.ninja){this.ninja.enableAABB(t)}else if(e===L.Physics.BOX2D&&this.box2d){this.box2d.enable(t)}},preUpdate:function(){if(this.arcade){this.arcade.preUpdate()}if(this.p2){this.p2.preUpdate()}if(this.box2d){this.box2d.preUpdate()}},update:function(){if(this.p2){this.p2.update()}if(this.box2d){this.box2d.update()}},setBoundsToWorld:function(){if(this.arcade){this.arcade.setBoundsToWorld()}if(this.ninja){this.ninja.setBoundsToWorld()}if(this.p2){this.p2.setBoundsToWorld()}if(this.box2d){this.box2d.setBoundsToWorld()}},clear:function(){if(this.p2){this.p2.clear()}if(this.box2d){this.box2d.clear()}},reset:function(){if(this.p2){this.p2.reset()}if(this.box2d){this.box2d.reset()}},destroy:function(){if(this.p2){this.p2.destroy()}if(this.box2d){this.box2d.destroy()}this.arcade=null;this.ninja=null;this.p2=null;this.box2d=null}};L.Physics.prototype.constructor=L.Physics;L.Tile=function(t,e,i,s,n,r){this.layer=t;this.index=e;this.x=i;this.y=s;this.rotation=0;this.flipped=false;this.worldX=i*n;this.worldY=s*r;this.width=n;this.height=r;this.centerX=Math.abs(n/2);this.centerY=Math.abs(r/2);this.alpha=1;this.properties={};this.scanned=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.collisionCallback=null;this.collisionCallbackContext=this};L.Tile.prototype={containsPoint:function(t,e){return!(t<this.worldX||e<this.worldY||t>this.right||e>this.bottom)},intersects:function(t,e,i,s){if(i<=this.worldX){return false}if(s<=this.worldY){return false}if(t>=this.worldX+this.width){return false}if(e>=this.worldY+this.height){return false}return true},setCollisionCallback:function(t,e){this.collisionCallback=t;this.collisionCallbackContext=e},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(t,e,i,s){this.collideLeft=t;this.collideRight=e;this.collideUp=i;this.collideDown=s;this.faceLeft=t;this.faceRight=e;this.faceTop=i;this.faceBottom=s},resetCollision:function(){this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false},isInteresting:function(t,e){if(t&&e){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback}else if(t){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}else if(e){return this.faceTop||this.faceBottom||this.faceLeft||this.faceRight}return false},copy:function(t){this.index=t.index;this.alpha=t.alpha;this.properties=t.properties;this.collideUp=t.collideUp;this.collideDown=t.collideDown;this.collideLeft=t.collideLeft;this.collideRight=t.collideRight;this.collisionCallback=t.collisionCallback;this.collisionCallbackContext=t.collisionCallbackContext}};L.Tile.prototype.constructor=L.Tile;Object.defineProperty(L.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}});Object.defineProperty(L.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}});Object.defineProperty(L.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(L.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(L.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(L.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});L.Tilemap=function(t,e,i,s,n,r){this.game=t;this.key=e;var a=L.TilemapParser.parse(this.game,e,i,s,n,r);if(a===null){return}this.width=a.width;this.height=a.height;this.tileWidth=a.tileWidth;this.tileHeight=a.tileHeight;this.orientation=a.orientation;this.format=a.format;this.version=a.version;this.properties=a.properties;this.widthInPixels=a.widthInPixels;this.heightInPixels=a.heightInPixels;this.layers=a.layers;this.tilesets=a.tilesets;this.tiles=a.tiles;this.objects=a.objects;this.collideIndexes=[];this.collision=a.collision;this.images=a.images;this.currentLayer=0;this.debugMap=[];this._results=[];this._tempA=0;this._tempB=0};L.Tilemap.CSV=0;L.Tilemap.TILED_JSON=1;L.Tilemap.NORTH=0;L.Tilemap.EAST=1;L.Tilemap.SOUTH=2;L.Tilemap.WEST=3;L.Tilemap.prototype={create:function(t,e,i,s,n,r){if(typeof r==="undefined"){r=this.game.world}this.width=e;this.height=i;this.setTileSize(s,n);this.layers.length=0;return this.createBlankLayer(t,e,i,s,n,r)},setTileSize:function(t,e){this.tileWidth=t;this.tileHeight=e;this.widthInPixels=this.width*t;this.heightInPixels=this.height*e},addTilesetImage:function(t,e,i,s,n,r,a){if(typeof i==="undefined"){i=this.tileWidth}if(typeof s==="undefined"){s=this.tileHeight}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}if(typeof a==="undefined"){a=0}if(i===0){i=32}if(s===0){s=32}if(typeof e==="undefined"){if(typeof t==="string"){e=t;if(!this.game.cache.checkImageKey(e)){console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+e+'"');return null}}else{return null}}if(typeof t==="string"){t=this.getTilesetIndex(t);if(t===null&&this.format===L.Tilemap.TILED_JSON){console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+e+'"');return null}}if(this.tilesets[t]){this.tilesets[t].setImage(this.game.cache.getImage(e));return this.tilesets[t]}else{var o=new L.Tileset(e,a,i,s,n,r,{});o.setImage(this.game.cache.getImage(e));this.tilesets.push(o);var h=this.tilesets.length-1;var l=n;var u=n;var f=0;var c=0;var d=0;for(var p=a;p<a+o.total;p++){this.tiles[p]=[l,u,h];l+=i+r;f++;if(f===o.total){break}c++;if(c===o.columns){l=n;u+=s+r;c=0;d++;if(d===o.rows){break}}}return o}return null},createFromObjects:function(t,e,i,s,n,r,a,o,h){if(typeof n==="undefined"){n=true}if(typeof r==="undefined"){r=false}if(typeof a==="undefined"){a=this.game.world}if(typeof o==="undefined"){o=L.Sprite}if(typeof h==="undefined"){h=true}if(!this.objects[t]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+t);return}var l;for(var u=0,f=this.objects[t].length;u<f;u++){if(this.objects[t][u].gid===e){l=new o(this.game,this.objects[t][u].x,this.objects[t][u].y,i,s);l.name=this.objects[t][u].name;l.visible=this.objects[t][u].visible;l.autoCull=r;l.exists=n;if(this.objects[t][u].rotation){l.angle=this.objects[t][u].rotation}if(h){l.y-=l.height}a.add(l);for(var c in this.objects[t][u].properties){a.set(l,c,this.objects[t][u].properties[c],false,false,0,true)}}}},createFromTiles:function(t,e,i,s,n,r){if(typeof t==="number"){t=[t]}if(typeof e==="undefined"||e===null){e=[]}else if(typeof e==="number"){e=[e]}s=this.getLayer(s);if(typeof n==="undefined"){n=this.game.world}if(typeof r==="undefined"){r={}}if(r.customClass===undefined){r.customClass=L.Sprite}if(r.adjustY===undefined){r.adjustY=true}var a=this.layers[s].width;var o=this.layers[s].height;this.copy(0,0,a,o,s);if(this._results.length<2){return 0}var h=0;var l;for(var u=1,f=this._results.length;u<f;u++){if(t.indexOf(this._results[u].index)!==-1){l=new r.customClass(this.game,this._results[u].worldX,this._results[u].worldY,i);for(var c in r){l[c]=r[c]}n.add(l);h++}}if(e.length===1){for(u=0;u<t.length;u++){this.replace(t[u],e[0],0,0,a,o,s)}}else if(e.length>1){for(u=0;u<t.length;u++){this.replace(t[u],e[u],0,0,a,o,s)}}return h},createLayer:function(t,e,i,s){if(typeof e==="undefined"){e=this.game.width}if(typeof i==="undefined"){i=this.game.height}if(typeof s==="undefined"){s=this.game.world}var n=t;if(typeof t==="string"){n=this.getLayerIndex(t)}if(n===null||n>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+n);return}return s.add(new L.TilemapLayer(this.game,this,n,e,i))},createBlankLayer:function(t,e,i,s,n,r){if(typeof r==="undefined"){r=this.game.world}if(this.getLayerIndex(t)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");return}var a={name:t,x:0,y:0,width:e,height:i,widthInPixels:e*s,heightInPixels:i*n,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:null};var o;var h=[];for(var l=0;l<i;l++){o=[];for(var u=0;u<e;u++){o.push(new L.Tile(a,-1,u,l,s,n))}h.push(o)}a.data=h;this.layers.push(a);this.currentLayer=this.layers.length-1;var f=a.widthInPixels;var c=a.heightInPixels;if(f>this.game.width){f=this.game.width}if(c>this.game.height){c=this.game.height}var h=new L.TilemapLayer(this.game,this,this.layers.length-1,f,c);h.name=t;return r.add(h)},getIndex:function(t,e){for(var i=0;i<t.length;i++){if(t[i].name===e){return i}}return null},getLayerIndex:function(t){return this.getIndex(this.layers,t)},getTilesetIndex:function(t){return this.getIndex(this.tilesets,t)},getImageIndex:function(t){return this.getIndex(this.images,t)},getObjectIndex:function(t){return this.getIndex(this.objects,t)},setTileIndexCallback:function(t,e,i,s){s=this.getLayer(s);if(typeof t==="number"){this.layers[s].callbacks[t]={callback:e,callbackContext:i}}else{for(var n=0,r=t.length;n<r;n++){this.layers[s].callbacks[t[n]]={callback:e,callbackContext:i}}}},setTileLocationCallback:function(t,e,i,s,n,r,a){a=this.getLayer(a);this.copy(t,e,i,s,a);if(this._results.length<2){return}for(var o=1;o<this._results.length;o++){this._results[o].setCollisionCallback(n,r)}},setCollision:function(t,e,i,s){if(typeof e==="undefined"){e=true}if(typeof s==="undefined"){s=true}i=this.getLayer(i);if(typeof t==="number"){return this.setCollisionByIndex(t,e,i,true)}else if(Array.isArray(t)){for(var n=0;n<t.length;n++){this.setCollisionByIndex(t[n],e,i,false)}if(s){this.calculateFaces(i)}}},setCollisionBetween:function(t,e,i,s,n){if(typeof i==="undefined"){i=true}if(typeof n==="undefined"){n=true}s=this.getLayer(s);if(t>e){return}for(var r=t;r<=e;r++){this.setCollisionByIndex(r,i,s,false)}if(n){this.calculateFaces(s)}},setCollisionByExclusion:function(t,e,i,s){if(typeof e==="undefined"){e=true}if(typeof s==="undefined"){s=true}i=this.getLayer(i);for(var n=0,r=this.tiles.length;n<r;n++){if(t.indexOf(n)===-1){this.setCollisionByIndex(n,e,i,false)}}if(s){this.calculateFaces(i)}},setCollisionByIndex:function(t,e,i,s){if(typeof e==="undefined"){e=true}if(typeof i==="undefined"){i=this.currentLayer}if(typeof s==="undefined"){s=true}if(e){this.collideIndexes.push(t)}else{var n=this.collideIndexes.indexOf(t);if(n>-1){this.collideIndexes.splice(n,1)}}for(var r=0;r<this.layers[i].height;r++){for(var a=0;a<this.layers[i].width;a++){var o=this.layers[i].data[r][a];if(o&&o.index===t){if(e){o.setCollision(true,true,true,true)}else{o.resetCollision()}o.faceTop=e;o.faceBottom=e;o.faceLeft=e;o.faceRight=e}}}if(s){this.calculateFaces(i)}return i},getLayer:function(t){if(typeof t==="undefined"){t=this.currentLayer}else if(typeof t==="string"){t=this.getLayerIndex(t)}else if(t instanceof L.TilemapLayer){t=t.index}return t},setPreventRecalculate:function(t){if(t===true&&this.preventingRecalculate!==true){this.preventingRecalculate=true;this.needToRecalculate={}}if(t===false&&this.preventingRecalculate===true){this.preventingRecalculate=false;for(var e in this.needToRecalculate){this.calculateFaces(e)}this.needToRecalculate=false}},calculateFaces:function(t){if(this.preventingRecalculate){this.needToRecalculate[t]=true;return}var e=null;var i=null;var s=null;var n=null;for(var r=0,a=this.layers[t].height;r<a;r++){for(var o=0,h=this.layers[t].width;o<h;o++){var l=this.layers[t].data[r][o];if(l){e=this.getTileAbove(t,o,r);i=this.getTileBelow(t,o,r);s=this.getTileLeft(t,o,r);n=this.getTileRight(t,o,r);if(l.collides){l.faceTop=true;l.faceBottom=true;l.faceLeft=true;l.faceRight=true}if(e&&e.collides){l.faceTop=false}if(i&&i.collides){l.faceBottom=false}if(s&&s.collides){l.faceLeft=false}if(n&&n.collides){l.faceRight=false}}}}},getTileAbove:function(t,e,i){if(i>0){return this.layers[t].data[i-1][e]}return null},getTileBelow:function(t,e,i){if(i<this.layers[t].height-1){return this.layers[t].data[i+1][e]}return null},getTileLeft:function(t,e,i){if(e>0){return this.layers[t].data[i][e-1]}return null},getTileRight:function(t,e,i){if(e<this.layers[t].width-1){return this.layers[t].data[i][e+1]}return null},setLayer:function(t){t=this.getLayer(t);if(this.layers[t]){this.currentLayer=t}},hasTile:function(t,e,i){i=this.getLayer(i);return this.layers[i].data[e][t].index>-1},removeTile:function(t,e,i){i=this.getLayer(i);if(t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height){if(this.hasTile(t,e,i)){var s=this.layers[i].data[e][t];this.layers[i].data[e][t]=new L.Tile(this.layers[i],-1,t,e,this.tileWidth,this.tileHeight);this.layers[i].dirty=true;this.calculateFaces(i);return s}}},removeTileWorldXY:function(t,e,i,s,n){n=this.getLayer(n);t=this.game.math.snapToFloor(t,i)/i;e=this.game.math.snapToFloor(e,s)/s;return this.removeTile(t,e,n)},putTile:function(t,e,i,s){if(t===null){return this.removeTile(e,i,s)}s=this.getLayer(s);if(e>=0&&e<this.layers[s].width&&i>=0&&i<this.layers[s].height){var n;if(t instanceof L.Tile){n=t.index;if(this.hasTile(e,i,s)){this.layers[s].data[i][e].copy(t)}else{this.layers[s].data[i][e]=new L.Tile(s,n,e,i,t.width,t.height)}}else{n=t;if(this.hasTile(e,i,s)){this.layers[s].data[i][e].index=n}else{this.layers[s].data[i][e]=new L.Tile(this.layers[s],n,e,i,this.tileWidth,this.tileHeight)}}if(this.collideIndexes.indexOf(n)>-1){this.layers[s].data[i][e].setCollision(true,true,true,true)}else{this.layers[s].data[i][e].resetCollision()}this.layers[s].dirty=true;this.calculateFaces(s);return this.layers[s].data[i][e]}return null},putTileWorldXY:function(t,e,i,s,n,r){r=this.getLayer(r);e=this.game.math.snapToFloor(e,s)/s;i=this.game.math.snapToFloor(i,n)/n;return this.putTile(t,e,i,r)},searchTileIndex:function(t,e,i,s){if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i=false}s=this.getLayer(s);var n=0;if(i){for(var r=this.layers[s].height-1;r>=0;r--){for(var a=this.layers[s].width-1;a>=0;a--){if(this.layers[s].data[r][a].index===t){if(n===e){return this.layers[s].data[r][a]}else{n++}}}}}else{for(var r=0;r<this.layers[s].height;r++){for(var a=0;a<this.layers[s].width;a++){if(this.layers[s].data[r][a].index===t){if(n===e){return this.layers[s].data[r][a]}else{n++}}}}}return null},getTile:function(t,e,i,s){if(typeof s==="undefined"){s=false}i=this.getLayer(i);if(t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height){if(this.layers[i].data[e][t].index===-1){if(s){return this.layers[i].data[e][t]}else{return null}}else{return this.layers[i].data[e][t]}}else{return null}},getTileWorldXY:function(t,e,i,s,n){if(typeof i==="undefined"){i=this.tileWidth}if(typeof s==="undefined"){s=this.tileHeight}n=this.getLayer(n);t=this.game.math.snapToFloor(t,i)/i;e=this.game.math.snapToFloor(e,s)/s;return this.getTile(t,e,n)},copy:function(t,e,i,s,n){n=this.getLayer(n);if(!this.layers[n]){this._results.length=0;return}if(typeof t==="undefined"){t=0}if(typeof e==="undefined"){e=0}if(typeof i==="undefined"){i=this.layers[n].width}if(typeof s==="undefined"){s=this.layers[n].height}if(t<0){t=0}if(e<0){e=0}if(i>this.layers[n].width){i=this.layers[n].width}if(s>this.layers[n].height){s=this.layers[n].height}this._results.length=0;this._results.push({x:t,y:e,width:i,height:s,layer:n});for(var r=e;r<e+s;r++){for(var a=t;a<t+i;a++){this._results.push(this.layers[n].data[r][a])}}return this._results},paste:function(t,e,i,s){if(typeof t==="undefined"){t=0}if(typeof e==="undefined"){e=0}s=this.getLayer(s);if(!i||i.length<2){return}var n=t-i[1].x;var r=e-i[1].y;for(var a=1;a<i.length;a++){this.layers[s].data[r+i[a].y][n+i[a].x].copy(i[a])}this.layers[s].dirty=true;this.calculateFaces(s)},swap:function(t,e,i,s,n,r,a){a=this.getLayer(a);this.copy(i,s,n,r,a);if(this._results.length<2){return}this._tempA=t;this._tempB=e;this._results.forEach(this.swapHandler,this);this.paste(i,s,this._results,a)},swapHandler:function(t){if(t.index===this._tempA){t.index=this._tempB}else if(t.index===this._tempB){t.index=this._tempA}},forEach:function(t,e,i,s,n,r,a){a=this.getLayer(a);this.copy(i,s,n,r,a);if(this._results.length<2){return}this._results.forEach(t,e);this.paste(i,s,this._results,a)},replace:function(t,e,i,s,n,r,a){a=this.getLayer(a);this.copy(i,s,n,r,a);if(this._results.length<2){return}for(var o=1;o<this._results.length;o++){if(this._results[o].index===t){this._results[o].index=e}}this.paste(i,s,this._results,a)},random:function(t,e,i,s,n){n=this.getLayer(n);this.copy(t,e,i,s,n);if(this._results.length<2){return}var r=[];for(var a=1;a<this._results.length;a++){if(this._results[a].index){var o=this._results[a].index;if(r.indexOf(o)===-1){r.push(o)}}}for(var h=1;h<this._results.length;h++){this._results[h].index=this.game.rnd.pick(r)}this.paste(t,e,this._results,n)},shuffle:function(t,e,i,s,n){n=this.getLayer(n);this.copy(t,e,i,s,n);if(this._results.length<2){return}var r=[];for(var a=1;a<this._results.length;a++){if(this._results[a].index){r.push(this._results[a].index)}}L.Utils.shuffle(r);for(var o=1;o<this._results.length;o++){this._results[o].index=r[o-1]}this.paste(t,e,this._results,n)},fill:function(t,e,i,s,n,r){r=this.getLayer(r);this.copy(e,i,s,n,r);if(this._results.length<2){return}for(var a=1;a<this._results.length;a++){this._results[a].index=t}this.paste(e,i,this._results,r)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var t="";var e=[""];for(var i=0;i<this.layers[this.currentLayer].height;i++){for(var s=0;s<this.layers[this.currentLayer].width;s++){t+="%c  ";if(this.layers[this.currentLayer].data[i][s]>1){if(this.debugMap[this.layers[this.currentLayer].data[i][s]]){e.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][s]])}else{e.push("background: #ffffff")}}else{e.push("background: rgb(0, 0, 0)")}}t+="\n"}e[0]=t;console.log.apply(console,e)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};L.Tilemap.prototype.constructor=L.Tilemap;Object.defineProperty(L.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(t){if(t!==this.currentLayer){this.setLayer(t)}}});L.TilemapLayer=function(t,e,i,s,n){s|=0;n|=0;PIXI.Sprite.call(this,PIXI.TextureCache["__default"]);L.Component.Core.init.call(this,t,0,0,null,null);this.map=e;this.index=i;this.layer=e.layers[i];this.canvas=L.Canvas.create(s,n);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new L.Frame(0,0,0,s,n,"tilemapLayer",t.rnd.uuid());this.type=L.TILEMAPLAYER;this.physicsType=L.TILEMAPLAYER;this.renderSettings={enableScrollDelta:true,overdrawRatio:.2,copyCanvas:null};this.debug=false;this.exists=true;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:true,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=true;this.rayStepRate=4;this._wrap=false;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:e.tileWidth,tileHeight:e.tileHeight,cw:e.tileWidth,ch:e.tileHeight,tilesets:[]};this._scrollX=0;this._scrollY=0;this._results=[];if(!t.device.canvasBitBltShift){this.renderSettings.copyCanvas=L.TilemapLayer.ensureSharedCopyCanvas()}this.fixedToCamera=true};L.TilemapLayer.prototype=Object.create(PIXI.Sprite.prototype);L.TilemapLayer.prototype.constructor=L.TilemapLayer;var a=["Bounds","Destroy","FixedToCamera","Reset","Smoothed"];L.Component.Core.install.call(L.TilemapLayer.prototype,a);L.TilemapLayer.sharedCopyCanvas=null;L.TilemapLayer.ensureSharedCopyCanvas=function(){if(!this.sharedCopyCanvas){this.sharedCopyCanvas=L.Canvas.create(2,2)}return this.sharedCopyCanvas};L.TilemapLayer.prototype.preUpdate=function(){L.Component.Core.preUpdate.call(this);return true};L.TilemapLayer.prototype.postUpdate=function(){L.Component.Core.prototype.postUpdate.call(this);var t=this.game.camera;this.scrollX=t.x*this.scrollFactorX/this.scale.x;this.scrollY=t.y*this.scrollFactorY/this.scale.y;this.render()};L.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};L.TilemapLayer.prototype._fixX=function(t){if(t<0){t=0}if(this.scrollFactorX===1){return t}return this._scrollX+(t-this._scrollX/this.scrollFactorX)};L.TilemapLayer.prototype._unfixX=function(t){if(this.scrollFactorX===1){return t}return this._scrollX/this.scrollFactorX+(t-this._scrollX)};L.TilemapLayer.prototype._fixY=function(t){if(t<0){t=0}if(this.scrollFactorY===1){return t}return this._scrollY+(t-this._scrollY/this.scrollFactorY)};L.TilemapLayer.prototype._unfixY=function(t){if(this.scrollFactorY===1){return t}return this._scrollY/this.scrollFactorY+(t-this._scrollY)};L.TilemapLayer.prototype.getTileX=function(t){return Math.floor(this._fixX(t)/this._mc.tileWidth)};L.TilemapLayer.prototype.getTileY=function(t){return Math.floor(this._fixY(t)/this._mc.tileHeight)};L.TilemapLayer.prototype.getTileXY=function(t,e,i){i.x=this.getTileX(t);i.y=this.getTileY(e);return i};L.TilemapLayer.prototype.getRayCastTiles=function(t,e,i,s){if(!e){e=this.rayStepRate}if(typeof i==="undefined"){i=false}if(typeof s==="undefined"){s=false}var n=this.getTiles(t.x,t.y,t.width,t.height,i,s);if(n.length===0){return[]}var r=t.coordinatesOnLine(e);var a=[];for(var o=0;o<n.length;o++){for(var h=0;h<r.length;h++){var l=n[o];var u=r[h];if(l.containsPoint(u[0],u[1])){a.push(l);break}}}return a};L.TilemapLayer.prototype.getTiles=function(t,e,i,s,n,r){if(typeof n==="undefined"){n=false}if(typeof r==="undefined"){r=false}var a=!(n||r);t=this._fixX(t);e=this._fixY(e);var o=Math.floor(t/(this._mc.cw*this.scale.x));var h=Math.floor(e/(this._mc.ch*this.scale.y));var l=Math.ceil((t+i)/(this._mc.cw*this.scale.x))-o;var u=Math.ceil((e+s)/(this._mc.ch*this.scale.y))-h;while(this._results.length){this._results.pop()}for(var f=h;f<h+u;f++){for(var c=o;c<o+l;c++){var d=this.layer.data[f];if(d&&d[c]){if(a||d[c].isInteresting(n,r)){this._results.push(d[c])}}}}return this._results.slice()};Object.defineProperty(L.TilemapLayer.prototype,"tileColor",{get:function(){return this.debugSettings.missingImageFill},set:function(t){this.debugSettings.missingImageFill=t}});Object.defineProperty(L.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(t){this._wrap=t;this.dirty=true}});L.TilemapLayer.prototype.resolveTileset=function(t){var e=this._mc.tilesets;if(t<2e3){while(e.length<t){e.push(undefined)}}var i=this.map.tiles[t]&&this.map.tiles[t][2];if(i!=null){var s=this.map.tilesets[i];if(s&&s.containsTileIndex(t)){return e[t]=s}}return e[t]=null};L.TilemapLayer.prototype.resetTilesetCache=function(){var t=this._mc.tilesets;while(t.length){t.pop()}};L.TilemapLayer.prototype.setScale=function(t,e){t=t||1;e=e||t;for(var i=0;i<this.layer.data.length;i++){var s=this.layer.data[i];for(var n=0;n<s.length;n++){var r=s[n];r.width=this.map.tileWidth*t;r.height=this.map.tileHeight*e;r.worldX=r.x*r.width;r.worldY=r.y*r.height}}this.scale.setTo(t,e)};L.TilemapLayer.prototype.shiftCanvas=function(t,e,i){var s=t.canvas;var n=s.width-Math.abs(e);var r=s.height-Math.abs(i);var a=0;var o=0;var h=e;var l=i;if(e<0){a=-e;h=0}if(i<0){o=-i;l=0}var u=this.renderSettings.copyCanvas;if(u){if(u.width<n||u.height<r){u.width=n;u.height=r}var f=u.getContext("2d");f.clearRect(0,0,n,r);f.drawImage(s,a,o,n,r,0,0,n,r);t.clearRect(h,l,n,r);t.drawImage(u,0,0,n,r,h,l,n,r)}else{t.save();t.globalCompositeOperation="copy";t.drawImage(s,a,o,n,r,h,l,n,r);t.restore()}};L.TilemapLayer.prototype.renderRegion=function(t,e,i,s,n,r){var a=this.context;var o=this.layer.width;var h=this.layer.height;var l=this._mc.tileWidth;var u=this._mc.tileHeight;var f=this._mc.tilesets;var c=NaN;if(!this._wrap){if(i<=n){i=Math.max(0,i);n=Math.min(o-1,n)}if(s<=r){s=Math.max(0,s);r=Math.min(h-1,r)}}var d=i*l-t;var p=s*u-e;var g=(i+(1<<20)*o)%o;var m=(s+(1<<20)*h)%h;var y,v,x,b,_,w;a.fillStyle=this.tileColor;for(b=m,w=r-s,v=p;w>=0;b++,w--,v+=u){if(b>=h){b-=h}var T=this.layer.data[b];for(x=g,_=n-i,y=d;_>=0;x++,_--,y+=l){if(x>=o){x-=o}var C=T[x];if(!C||C.index<0){continue}var S=C.index;var P=f[S];if(P===undefined){P=this.resolveTileset(S)}if(C.alpha!==c&&!this.debug){a.globalAlpha=C.alpha;c=C.alpha}if(P){if(C.rotation||C.flipped){a.save();a.translate(y+C.centerX,v+C.centerY);a.rotate(C.rotation);if(C.flipped){a.scale(-1,1)}P.draw(a,-C.centerX,-C.centerY,S);a.restore()}else{P.draw(a,y,v,S)}}else if(this.debugSettings.missingImageFill){a.fillStyle=this.debugSettings.missingImageFill;a.fillRect(y,v,l,u)}if(C.debug&&this.debugSettings.debuggedTileOverfill){a.fillStyle=this.debugSettings.debuggedTileOverfill;a.fillRect(y,v,l,u)}}}};L.TilemapLayer.prototype.renderDeltaScroll=function(t,e){var i=this._mc.scrollX;var s=this._mc.scrollY;var n=this.canvas.width;var r=this.canvas.height;var a=this._mc.tileWidth;var o=this._mc.tileHeight;var h=0;var l=-a;var u=0;var f=-o;if(t<0){h=n+t;l=n-1}else if(t>0){l=t}if(e<0){u=r+e;f=r-1}else if(e>0){f=e}this.shiftCanvas(this.context,t,e);h=Math.floor((h+i)/a);l=Math.floor((l+i)/a);u=Math.floor((u+s)/o);f=Math.floor((f+s)/o);if(h<=l){this.context.clearRect(h*a-i,0,(l-h+1)*a,r);var c=Math.floor((0+s)/o);var d=Math.floor((r-1+s)/o);this.renderRegion(i,s,h,c,l,d)}if(u<=f){this.context.clearRect(0,u*o-s,n,(f-u+1)*o);var p=Math.floor((0+i)/a);var g=Math.floor((n-1+i)/a);this.renderRegion(i,s,p,u,g,f)}};L.TilemapLayer.prototype.renderFull=function(){var t=this._mc.scrollX;var e=this._mc.scrollY;var i=this.canvas.width;var s=this.canvas.height;var n=this._mc.tileWidth;var r=this._mc.tileHeight;var a=Math.floor(t/n);var o=Math.floor((i-1+t)/n);var h=Math.floor(e/r);var l=Math.floor((s-1+e)/r);this.context.clearRect(0,0,i,s);this.renderRegion(t,e,a,h,o,l)};L.TilemapLayer.prototype.render=function(){var t=false;if(!this.visible){return}this.context.save();if(this.dirty||this.layer.dirty){this.layer.dirty=false;t=true}var e=this.canvas.width;var i=this.canvas.height;var s=this._scrollX|0;var n=this._scrollY|0;var r=this._mc;var a=r.scrollX-s;var o=r.scrollY-n;if(!t&&a===0&&o===0&&r.renderWidth===e&&r.renderHeight===i){return}r.scrollX=s;r.scrollY=n;if(r.renderWidth!==e||r.renderHeight!==i){r.renderWidth=e;r.renderHeight=i}if(this.debug){this.context.globalAlpha=this.debugSettings.debugAlpha;if(this.debugSettings.forceFullRedraw){t=true}}if(!t&&this.renderSettings.enableScrollDelta&&Math.abs(a)+Math.abs(o)<Math.min(e,i)){this.renderDeltaScroll(a,o)}else{this.renderFull()}if(this.debug){this.context.globalAlpha=1;this.renderDebug()}this.baseTexture.dirty();this.dirty=false;this.context.restore();return true};L.TilemapLayer.prototype.renderDebug=function(){var t=this._mc.scrollX;var e=this._mc.scrollY;var i=this.context;var s=this.canvas.width;var n=this.canvas.height;var r=this.layer.width;var a=this.layer.height;var o=this._mc.tileWidth;var h=this._mc.tileHeight;var l=Math.floor(t/o);var u=Math.floor((s-1+t)/o);var f=Math.floor(e/h);var c=Math.floor((n-1+e)/h);var d=l*o-t;var p=f*h-e;var g=(l+(1<<20)*r)%r;var m=(f+(1<<20)*a)%a;var y,v,x,b,_,w;i.strokeStyle=this.debugSettings.facingEdgeStroke;for(b=m,w=c-f,v=p;w>=0;b++,w--,v+=h){if(b>=a){b-=a}var T=this.layer.data[b];for(x=g,_=u-l,y=d;_>=0;x++,_--,y+=o){if(x>=r){x-=r}var C=T[x];if(!C||C.index<0||!C.collides){continue}if(this.debugSettings.collidingTileOverfill){i.fillStyle=this.debugSettings.collidingTileOverfill;i.fillRect(y,v,this._mc.cw,this._mc.ch)}if(this.debugSettings.facingEdgeStroke){i.beginPath();if(C.faceTop){i.moveTo(y,v);i.lineTo(y+this._mc.cw,v)}if(C.faceBottom){i.moveTo(y,v+this._mc.ch);i.lineTo(y+this._mc.cw,v+this._mc.ch)}if(C.faceLeft){i.moveTo(y,v);i.lineTo(y,v+this._mc.ch)}if(C.faceRight){i.moveTo(y+this._mc.cw,v);i.lineTo(y+this._mc.cw,v+this._mc.ch)}i.stroke()}}}};Object.defineProperty(L.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(t){this._scrollX=t}});Object.defineProperty(L.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(t){this._scrollY=t}});Object.defineProperty(L.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(t){this._mc.cw=t|0;this.dirty=true}});Object.defineProperty(L.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(t){this._mc.ch=t|0;this.dirty=true}});L.TilemapParser={parse:function(t,e,i,s,n,r){if(typeof i==="undefined"){i=32}if(typeof s==="undefined"){s=32}if(typeof n==="undefined"){n=10}if(typeof r==="undefined"){r=10}if(typeof e==="undefined"){return this.getEmptyData()}if(e===null){return this.getEmptyData(i,s,n,r)}var a=t.cache.getTilemapData(e);if(a){if(a.format===L.Tilemap.CSV){return this.parseCSV(e,a.data,i,s)}else if(!a.format||a.format===L.Tilemap.TILED_JSON){return this.parseTiledJSON(a.data)}}else{console.warn("Phaser.TilemapParser.parse - No map data found for key "+e)}},parseCSV:function(t,e,i,s){var n=this.getEmptyData();e=e.trim();var r=[];var a=e.split("\n");var o=a.length;var h=0;for(var l=0;l<a.length;l++){r[l]=[];var u=a[l].split(",");for(var f=0;f<u.length;f++){r[l][f]=new L.Tile(n.layers[0],parseInt(u[f],10),f,l,i,s)}if(h===0){h=u.length}}n.format=L.Tilemap.CSV;n.name=t;n.width=h;n.height=o;n.tileWidth=i;n.tileHeight=s;n.widthInPixels=h*i;n.heightInPixels=o*s;n.layers[0].width=h;n.layers[0].height=o;n.layers[0].widthInPixels=n.widthInPixels;n.layers[0].heightInPixels=n.heightInPixels;n.layers[0].data=r;return n},getEmptyData:function(t,e,i,s){var n={};n.width=0;n.height=0;n.tileWidth=0;n.tileHeight=0;if(typeof t!=="undefined"&&t!==null){n.tileWidth=t}if(typeof e!=="undefined"&&e!==null){n.tileHeight=e}if(typeof i!=="undefined"&&i!==null){n.width=i}if(typeof s!=="undefined"&&s!==null){n.height=s}n.orientation="orthogonal";n.version="1";n.properties={};n.widthInPixels=0;n.heightInPixels=0;var r=[];var a={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:[]};r.push(a);n.layers=r;n.images=[];n.objects={};n.collision={};n.tilesets=[];n.tiles=[];return n},parseTiledJSON:function(t){if(t.orientation!=="orthogonal"){console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser");return null}var e={};e.width=t.width;e.height=t.height;e.tileWidth=t.tilewidth;e.tileHeight=t.tileheight;e.orientation=t.orientation;e.format=L.Tilemap.TILED_JSON;e.version=t.version;e.properties=t.properties;e.widthInPixels=e.width*e.tileWidth;e.heightInPixels=e.height*e.tileHeight;var i=[];for(var s=0;s<t.layers.length;s++){if(t.layers[s].type!=="tilelayer"){continue}var n={name:t.layers[s].name,x:t.layers[s].x,y:t.layers[s].y,width:t.layers[s].width,height:t.layers[s].height,widthInPixels:t.layers[s].width*t.tilewidth,heightInPixels:t.layers[s].height*t.tileheight,alpha:t.layers[s].opacity,visible:t.layers[s].visible,properties:{},indexes:[],callbacks:[],bodies:[]};if(t.layers[s].properties){n.properties=t.layers[s].properties}var r=0;var a=[];var o=[];var h,l,u,f;for(var c=0,d=t.layers[s].data.length;c<d;c++){h=0;l=false;f=t.layers[s].data[c];if(f>536870912){u=0;if(f>2147483648){f-=2147483648;u+=4}if(f>1073741824){f-=1073741824;u+=2}if(f>536870912){f-=536870912;u+=1}switch(u){case 5:h=Math.PI/2;break;case 6:h=Math.PI;break;case 3:h=3*Math.PI/2;break;case 4:h=0;l=true;break;case 7:h=Math.PI/2;l=true;break;case 2:h=Math.PI;l=true;break;case 1:h=3*Math.PI/2;l=true;break}}if(f>0){a.push(new L.Tile(n,f,r,o.length,t.tilewidth,t.tileheight));a[a.length-1].rotation=h;a[a.length-1].flipped=l}else{a.push(new L.Tile(n,-1,r,o.length,t.tilewidth,t.tileheight))}r++;if(r===t.layers[s].width){o.push(a);r=0;a=[]}}n.data=o;i.push(n)}e.layers=i;var p=[];for(var s=0;s<t.layers.length;s++){if(t.layers[s].type!=="imagelayer"){continue}var g={name:t.layers[s].name,image:t.layers[s].image,x:t.layers[s].x,y:t.layers[s].y,alpha:t.layers[s].opacity,visible:t.layers[s].visible,properties:{}};if(t.layers[s].properties){g.properties=t.layers[s].properties}p.push(g)}e.images=p;var m=[];for(var s=0;s<t.tilesets.length;s++){var y=t.tilesets[s];if(y.image){var v=new L.Tileset(y.name,y.firstgid,y.tilewidth,y.tileheight,y.margin,y.spacing,y.properties);if(y.tileproperties){v.tileProperties=y.tileproperties}v.updateTileData(y.imagewidth,y.imageheight);m.push(v)}else{console.warn("Phaser.TilemapParser - Image Collection Tilesets are not support")}}e.tilesets=m;var x={};var b={};function _(t,e){var i={};for(var s in e){var n=e[s];if(t[n]){i[n]=t[n]}}return i}for(var s=0;s<t.layers.length;s++){if(t.layers[s].type!=="objectgroup"){continue}x[t.layers[s].name]=[];b[t.layers[s].name]=[];for(var w=0,d=t.layers[s].objects.length;w<d;w++){if(t.layers[s].objects[w].gid){var T={gid:t.layers[s].objects[w].gid,name:t.layers[s].objects[w].name,type:t.layers[s].objects[w].hasOwnProperty("type")?t.layers[s].objects[w].type:"",x:t.layers[s].objects[w].x,y:t.layers[s].objects[w].y,visible:t.layers[s].objects[w].visible,properties:t.layers[s].objects[w].properties};if(t.layers[s].objects[w].rotation){T.rotation=t.layers[s].objects[w].rotation}x[t.layers[s].name].push(T)}else if(t.layers[s].objects[w].polyline){var T={name:t.layers[s].objects[w].name,type:t.layers[s].objects[w].type,x:t.layers[s].objects[w].x,y:t.layers[s].objects[w].y,width:t.layers[s].objects[w].width,height:t.layers[s].objects[w].height,visible:t.layers[s].objects[w].visible,properties:t.layers[s].objects[w].properties};if(t.layers[s].objects[w].rotation){T.rotation=t.layers[s].objects[w].rotation}T.polyline=[];for(var C=0;C<t.layers[s].objects[w].polyline.length;C++){T.polyline.push([t.layers[s].objects[w].polyline[C].x,t.layers[s].objects[w].polyline[C].y])}b[t.layers[s].name].push(T);x[t.layers[s].name].push(T)}else if(t.layers[s].objects[w].polygon){var T=_(t.layers[s].objects[w],["name","type","x","y","visible","rotation","properties"]);T.polygon=[];for(var C=0;C<t.layers[s].objects[w].polygon.length;C++){T.polygon.push([t.layers[s].objects[w].polygon[C].x,t.layers[s].objects[w].polygon[C].y])}x[t.layers[s].name].push(T)}else if(t.layers[s].objects[w].ellipse){var T=_(t.layers[s].objects[w],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);x[t.layers[s].name].push(T)}else{var T=_(t.layers[s].objects[w],["name","type","x","y","width","height","visible","rotation","properties"]);T.rectangle=true;x[t.layers[s].name].push(T)}}}e.objects=x;e.collision=b;e.tiles=[];for(var s=0;s<e.tilesets.length;s++){var y=e.tilesets[s];var r=y.tileMargin;var S=y.tileMargin;var P=0;var A=0;var M=0;for(var c=y.firstgid;c<y.firstgid+y.total;c++){e.tiles[c]=[r,S,s];r+=y.tileWidth+y.tileSpacing;P++;if(P===y.total){break}A++;if(A===y.columns){r=y.tileMargin;S+=y.tileHeight+y.tileSpacing;A=0;M++;if(M===y.rows){break}}}}var n;var R;var E;var y;for(var s=0;s<e.layers.length;s++){n=e.layers[s];for(var O=0;O<n.data.length;O++){a=n.data[O];for(var I=0;I<a.length;I++){R=a[I];if(R.index<0){continue}E=e.tiles[R.index][2];y=e.tilesets[E];if(y.tileProperties&&y.tileProperties[R.index-y.firstgid]){R.properties=L.Utils.mixin(y.tileProperties[R.index-y.firstgid],R.properties)}}}}return e}};L.Tileset=function(t,e,i,s,n,r,a){if(typeof i==="undefined"||i<=0){i=32}if(typeof s==="undefined"||s<=0){s=32}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}this.name=t;this.firstgid=e|0;this.tileWidth=i|0;this.tileHeight=s|0;this.tileMargin=n|0;this.tileSpacing=r|0;this.properties=a||{};this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};L.Tileset.prototype={draw:function(t,e,i,s){var n=s-this.firstgid<<1;if(n>=0&&n+1<this.drawCoords.length){t.drawImage(this.image,this.drawCoords[n],this.drawCoords[n+1],this.tileWidth,this.tileHeight,e,i,this.tileWidth,this.tileHeight)}},containsTileIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},setImage:function(t){this.image=t;this.updateTileData(t.width,t.height)},setSpacing:function(t,e){this.tileMargin=t|0;this.tileSpacing=e|0;if(this.image){this.updateTileData(this.image.width,this.image.height)}},updateTileData:function(t,e){var i=(e-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing);var s=(t-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing);if(i%1!==0||s%1!==0){console.warn("Phaser.Tileset - image tile area is not an even multiple of tile size")}i=Math.floor(i);s=Math.floor(s);if(this.rows&&this.rows!==i||this.columns&&this.columns!==s){console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ")}this.rows=i;this.columns=s;this.total=i*s;this.drawCoords.length=0;var n=this.tileMargin;var r=this.tileMargin;for(var a=0;a<this.rows;a++){for(var o=0;o<this.columns;o++){this.drawCoords.push(n);this.drawCoords.push(r);n+=this.tileWidth+this.tileSpacing}n=this.tileMargin;r+=this.tileHeight+this.tileSpacing}}};L.Tileset.prototype.constructor=L.Tileset;if(PIXI.blendModes===undefined){PIXI.blendModes=L.blendModes}if(PIXI.scaleModes===undefined){PIXI.scaleModes=L.scaleModes}if(PIXI.Texture.emptyTexture===undefined){PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture)}if(PIXI.DisplayObject._tempMatrix===undefined){PIXI.DisplayObject._tempMatrix=new PIXI.Matrix}if(PIXI.RenderTexture.tempMatrix===undefined){PIXI.RenderTexture.tempMatrix=new PIXI.Matrix}if(PIXI.Graphics.POLY===undefined){PIXI.Graphics.POLY=L.POLYGON;PIXI.Graphics.RECT=L.RECTANGLE;PIXI.Graphics.CIRC=L.CIRCLE;PIXI.Graphics.ELIP=L.ELLIPSE;PIXI.Graphics.RREC=L.ROUNDEDRECTANGLE}if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=L}exports.Phaser=L}else if(typeof define!=="undefined"&&define.amd){define("Phaser",function(){return t.Phaser=L}())}else{t.Phaser=L}}).call(this);