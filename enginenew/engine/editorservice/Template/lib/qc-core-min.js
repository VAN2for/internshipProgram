function GraphemeSplitter(){function t(t,e){return 55296<=t.charCodeAt(e)&&t.charCodeAt(e)<=56319&&56320<=t.charCodeAt(e+1)&&t.charCodeAt(e+1)<=57343}function e(t,e){void 0===e&&(e=0);var i=t.charCodeAt(e);if(55296<=i&&i<=56319&&e<t.length-1){var r=i,n=t.charCodeAt(e+1);return 56320<=n&&n<=57343?1024*(r-55296)+(n-56320)+65536:r}if(56320<=i&&i<=57343&&e>=1){r=t.charCodeAt(e-1),n=i;return 55296<=r&&r<=56319?1024*(r-55296)+(n-56320)+65536:n}return i}function i(t,e,i){var r=[t].concat(e).concat([i]),_=r[r.length-2],E=i,D=r.lastIndexOf(y);if(D>1&&r.slice(1,D).every(function(t){return t==o})&&-1==[o,m,x].indexOf(t))return S;var C=r.lastIndexOf(h);if(C>0&&r.slice(1,C).every(function(t){return t==h})&&-1==[g,h].indexOf(_))return r.filter(function(t){return t==h}).length%2==1?w:P;if(_==n&&E==a)return b;if(_==s||_==n||_==a)return E==y&&e.every(function(t){return t==o})?S:A;if(E==s||E==n||E==a)return A;if(_==u&&(E==u||E==c||E==d||E==f))return b;if(!(_!=d&&_!=c||E!=c&&E!=p))return b;if((_==f||_==p)&&E==p)return b;if(E==o||E==v)return b;if(E==l)return b;if(_==g)return b;var O=-1!=r.indexOf(o)?r.lastIndexOf(o)-1:r.length-2;return-1!=[m,x].indexOf(r[O])&&r.slice(O+1,-1).every(function(t){return t==o})&&E==y?b:_==v&&-1!=[T,x].indexOf(E)?b:-1!=e.indexOf(h)?S:_==h&&E==h?b:A}function r(t){return 1536<=t&&t<=1541||1757==t||1807==t||2274==t||3406==t||69821==t||70082<=t&&t<=70083||72250==t||72326<=t&&t<=72329||73030==t?g:13==t?n:10==t?a:0<=t&&t<=9||11<=t&&t<=12||14<=t&&t<=31||127<=t&&t<=159||173==t||1564==t||6158==t||8203==t||8206<=t&&t<=8207||8232==t||8233==t||8234<=t&&t<=8238||8288<=t&&t<=8292||8293==t||8294<=t&&t<=8303||55296<=t&&t<=57343||65279==t||65520<=t&&t<=65528||65529<=t&&t<=65531||113824<=t&&t<=113827||119155<=t&&t<=119162||917504==t||917505==t||917506<=t&&t<=917535||917632<=t&&t<=917759||918e3<=t&&t<=921599?s:768<=t&&t<=879||1155<=t&&t<=1159||1160<=t&&t<=1161||1425<=t&&t<=1469||1471==t||1473<=t&&t<=1474||1476<=t&&t<=1477||1479==t||1552<=t&&t<=1562||1611<=t&&t<=1631||1648==t||1750<=t&&t<=1756||1759<=t&&t<=1764||1767<=t&&t<=1768||1770<=t&&t<=1773||1809==t||1840<=t&&t<=1866||1958<=t&&t<=1968||2027<=t&&t<=2035||2070<=t&&t<=2073||2075<=t&&t<=2083||2085<=t&&t<=2087||2089<=t&&t<=2093||2137<=t&&t<=2139||2260<=t&&t<=2273||2275<=t&&t<=2306||2362==t||2364==t||2369<=t&&t<=2376||2381==t||2385<=t&&t<=2391||2402<=t&&t<=2403||2433==t||2492==t||2494==t||2497<=t&&t<=2500||2509==t||2519==t||2530<=t&&t<=2531||2561<=t&&t<=2562||2620==t||2625<=t&&t<=2626||2631<=t&&t<=2632||2635<=t&&t<=2637||2641==t||2672<=t&&t<=2673||2677==t||2689<=t&&t<=2690||2748==t||2753<=t&&t<=2757||2759<=t&&t<=2760||2765==t||2786<=t&&t<=2787||2810<=t&&t<=2815||2817==t||2876==t||2878==t||2879==t||2881<=t&&t<=2884||2893==t||2902==t||2903==t||2914<=t&&t<=2915||2946==t||3006==t||3008==t||3021==t||3031==t||3072==t||3134<=t&&t<=3136||3142<=t&&t<=3144||3146<=t&&t<=3149||3157<=t&&t<=3158||3170<=t&&t<=3171||3201==t||3260==t||3263==t||3266==t||3270==t||3276<=t&&t<=3277||3285<=t&&t<=3286||3298<=t&&t<=3299||3328<=t&&t<=3329||3387<=t&&t<=3388||3390==t||3393<=t&&t<=3396||3405==t||3415==t||3426<=t&&t<=3427||3530==t||3535==t||3538<=t&&t<=3540||3542==t||3551==t||3633==t||3636<=t&&t<=3642||3655<=t&&t<=3662||3761==t||3764<=t&&t<=3769||3771<=t&&t<=3772||3784<=t&&t<=3789||3864<=t&&t<=3865||3893==t||3895==t||3897==t||3953<=t&&t<=3966||3968<=t&&t<=3972||3974<=t&&t<=3975||3981<=t&&t<=3991||3993<=t&&t<=4028||4038==t||4141<=t&&t<=4144||4146<=t&&t<=4151||4153<=t&&t<=4154||4157<=t&&t<=4158||4184<=t&&t<=4185||4190<=t&&t<=4192||4209<=t&&t<=4212||4226==t||4229<=t&&t<=4230||4237==t||4253==t||4957<=t&&t<=4959||5906<=t&&t<=5908||5938<=t&&t<=5940||5970<=t&&t<=5971||6002<=t&&t<=6003||6068<=t&&t<=6069||6071<=t&&t<=6077||6086==t||6089<=t&&t<=6099||6109==t||6155<=t&&t<=6157||6277<=t&&t<=6278||6313==t||6432<=t&&t<=6434||6439<=t&&t<=6440||6450==t||6457<=t&&t<=6459||6679<=t&&t<=6680||6683==t||6742==t||6744<=t&&t<=6750||6752==t||6754==t||6757<=t&&t<=6764||6771<=t&&t<=6780||6783==t||6832<=t&&t<=6845||6846==t||6912<=t&&t<=6915||6964==t||6966<=t&&t<=6970||6972==t||6978==t||7019<=t&&t<=7027||7040<=t&&t<=7041||7074<=t&&t<=7077||7080<=t&&t<=7081||7083<=t&&t<=7085||7142==t||7144<=t&&t<=7145||7149==t||7151<=t&&t<=7153||7212<=t&&t<=7219||7222<=t&&t<=7223||7376<=t&&t<=7378||7380<=t&&t<=7392||7394<=t&&t<=7400||7405==t||7412==t||7416<=t&&t<=7417||7616<=t&&t<=7673||7675<=t&&t<=7679||8204==t||8400<=t&&t<=8412||8413<=t&&t<=8416||8417==t||8418<=t&&t<=8420||8421<=t&&t<=8432||11503<=t&&t<=11505||11647==t||11744<=t&&t<=11775||12330<=t&&t<=12333||12334<=t&&t<=12335||12441<=t&&t<=12442||42607==t||42608<=t&&t<=42610||42612<=t&&t<=42621||42654<=t&&t<=42655||42736<=t&&t<=42737||43010==t||43014==t||43019==t||43045<=t&&t<=43046||43204<=t&&t<=43205||43232<=t&&t<=43249||43302<=t&&t<=43309||43335<=t&&t<=43345||43392<=t&&t<=43394||43443==t||43446<=t&&t<=43449||43452==t||43493==t||43561<=t&&t<=43566||43569<=t&&t<=43570||43573<=t&&t<=43574||43587==t||43596==t||43644==t||43696==t||43698<=t&&t<=43700||43703<=t&&t<=43704||43710<=t&&t<=43711||43713==t||43756<=t&&t<=43757||43766==t||44005==t||44008==t||44013==t||64286==t||65024<=t&&t<=65039||65056<=t&&t<=65071||65438<=t&&t<=65439||66045==t||66272==t||66422<=t&&t<=66426||68097<=t&&t<=68099||68101<=t&&t<=68102||68108<=t&&t<=68111||68152<=t&&t<=68154||68159==t||68325<=t&&t<=68326||69633==t||69688<=t&&t<=69702||69759<=t&&t<=69761||69811<=t&&t<=69814||69817<=t&&t<=69818||69888<=t&&t<=69890||69927<=t&&t<=69931||69933<=t&&t<=69940||70003==t||70016<=t&&t<=70017||70070<=t&&t<=70078||70090<=t&&t<=70092||70191<=t&&t<=70193||70196==t||70198<=t&&t<=70199||70206==t||70367==t||70371<=t&&t<=70378||70400<=t&&t<=70401||70460==t||70462==t||70464==t||70487==t||70502<=t&&t<=70508||70512<=t&&t<=70516||70712<=t&&t<=70719||70722<=t&&t<=70724||70726==t||70832==t||70835<=t&&t<=70840||70842==t||70845==t||70847<=t&&t<=70848||70850<=t&&t<=70851||71087==t||71090<=t&&t<=71093||71100<=t&&t<=71101||71103<=t&&t<=71104||71132<=t&&t<=71133||71219<=t&&t<=71226||71229==t||71231<=t&&t<=71232||71339==t||71341==t||71344<=t&&t<=71349||71351==t||71453<=t&&t<=71455||71458<=t&&t<=71461||71463<=t&&t<=71467||72193<=t&&t<=72198||72201<=t&&t<=72202||72243<=t&&t<=72248||72251<=t&&t<=72254||72263==t||72273<=t&&t<=72278||72281<=t&&t<=72283||72330<=t&&t<=72342||72344<=t&&t<=72345||72752<=t&&t<=72758||72760<=t&&t<=72765||72767==t||72850<=t&&t<=72871||72874<=t&&t<=72880||72882<=t&&t<=72883||72885<=t&&t<=72886||73009<=t&&t<=73014||73018==t||73020<=t&&t<=73021||73023<=t&&t<=73029||73031==t||92912<=t&&t<=92916||92976<=t&&t<=92982||94095<=t&&t<=94098||113821<=t&&t<=113822||119141==t||119143<=t&&t<=119145||119150<=t&&t<=119154||119163<=t&&t<=119170||119173<=t&&t<=119179||119210<=t&&t<=119213||119362<=t&&t<=119364||121344<=t&&t<=121398||121403<=t&&t<=121452||121461==t||121476==t||121499<=t&&t<=121503||121505<=t&&t<=121519||122880<=t&&t<=122886||122888<=t&&t<=122904||122907<=t&&t<=122913||122915<=t&&t<=122916||122918<=t&&t<=122922||125136<=t&&t<=125142||125252<=t&&t<=125258||917536<=t&&t<=917631||917760<=t&&t<=917999?o:127462<=t&&t<=127487?h:2307==t||2363==t||2366<=t&&t<=2368||2377<=t&&t<=2380||2382<=t&&t<=2383||2434<=t&&t<=2435||2495<=t&&t<=2496||2503<=t&&t<=2504||2507<=t&&t<=2508||2563==t||2622<=t&&t<=2624||2691==t||2750<=t&&t<=2752||2761==t||2763<=t&&t<=2764||2818<=t&&t<=2819||2880==t||2887<=t&&t<=2888||2891<=t&&t<=2892||3007==t||3009<=t&&t<=3010||3014<=t&&t<=3016||3018<=t&&t<=3020||3073<=t&&t<=3075||3137<=t&&t<=3140||3202<=t&&t<=3203||3262==t||3264<=t&&t<=3265||3267<=t&&t<=3268||3271<=t&&t<=3272||3274<=t&&t<=3275||3330<=t&&t<=3331||3391<=t&&t<=3392||3398<=t&&t<=3400||3402<=t&&t<=3404||3458<=t&&t<=3459||3536<=t&&t<=3537||3544<=t&&t<=3550||3570<=t&&t<=3571||3635==t||3763==t||3902<=t&&t<=3903||3967==t||4145==t||4155<=t&&t<=4156||4182<=t&&t<=4183||4228==t||6070==t||6078<=t&&t<=6085||6087<=t&&t<=6088||6435<=t&&t<=6438||6441<=t&&t<=6443||6448<=t&&t<=6449||6451<=t&&t<=6456||6681<=t&&t<=6682||6741==t||6743==t||6765<=t&&t<=6770||6916==t||6965==t||6971==t||6973<=t&&t<=6977||6979<=t&&t<=6980||7042==t||7073==t||7078<=t&&t<=7079||7082==t||7143==t||7146<=t&&t<=7148||7150==t||7154<=t&&t<=7155||7204<=t&&t<=7211||7220<=t&&t<=7221||7393==t||7410<=t&&t<=7411||7415==t||43043<=t&&t<=43044||43047==t||43136<=t&&t<=43137||43188<=t&&t<=43203||43346<=t&&t<=43347||43395==t||43444<=t&&t<=43445||43450<=t&&t<=43451||43453<=t&&t<=43456||43567<=t&&t<=43568||43571<=t&&t<=43572||43597==t||43755==t||43758<=t&&t<=43759||43765==t||44003<=t&&t<=44004||44006<=t&&t<=44007||44009<=t&&t<=44010||44012==t||69632==t||69634==t||69762==t||69808<=t&&t<=69810||69815<=t&&t<=69816||69932==t||70018==t||70067<=t&&t<=70069||70079<=t&&t<=70080||70188<=t&&t<=70190||70194<=t&&t<=70195||70197==t||70368<=t&&t<=70370||70402<=t&&t<=70403||70463==t||70465<=t&&t<=70468||70471<=t&&t<=70472||70475<=t&&t<=70477||70498<=t&&t<=70499||70709<=t&&t<=70711||70720<=t&&t<=70721||70725==t||70833<=t&&t<=70834||70841==t||70843<=t&&t<=70844||70846==t||70849==t||71088<=t&&t<=71089||71096<=t&&t<=71099||71102==t||71216<=t&&t<=71218||71227<=t&&t<=71228||71230==t||71340==t||71342<=t&&t<=71343||71350==t||71456<=t&&t<=71457||71462==t||72199<=t&&t<=72200||72249==t||72279<=t&&t<=72280||72343==t||72751==t||72766==t||72873==t||72881==t||72884==t||94033<=t&&t<=94078||119142==t||119149==t?l:4352<=t&&t<=4447||43360<=t&&t<=43388?u:4448<=t&&t<=4519||55216<=t&&t<=55238?c:4520<=t&&t<=4607||55243<=t&&t<=55291?p:44032==t||44060==t||44088==t||44116==t||44144==t||44172==t||44200==t||44228==t||44256==t||44284==t||44312==t||44340==t||44368==t||44396==t||44424==t||44452==t||44480==t||44508==t||44536==t||44564==t||44592==t||44620==t||44648==t||44676==t||44704==t||44732==t||44760==t||44788==t||44816==t||44844==t||44872==t||44900==t||44928==t||44956==t||44984==t||45012==t||45040==t||45068==t||45096==t||45124==t||45152==t||45180==t||45208==t||45236==t||45264==t||45292==t||45320==t||45348==t||45376==t||45404==t||45432==t||45460==t||45488==t||45516==t||45544==t||45572==t||45600==t||45628==t||45656==t||45684==t||45712==t||45740==t||45768==t||45796==t||45824==t||45852==t||45880==t||45908==t||45936==t||45964==t||45992==t||46020==t||46048==t||46076==t||46104==t||46132==t||46160==t||46188==t||46216==t||46244==t||46272==t||46300==t||46328==t||46356==t||46384==t||46412==t||46440==t||46468==t||46496==t||46524==t||46552==t||46580==t||46608==t||46636==t||46664==t||46692==t||46720==t||46748==t||46776==t||46804==t||46832==t||46860==t||46888==t||46916==t||46944==t||46972==t||47e3==t||47028==t||47056==t||47084==t||47112==t||47140==t||47168==t||47196==t||47224==t||47252==t||47280==t||47308==t||47336==t||47364==t||47392==t||47420==t||47448==t||47476==t||47504==t||47532==t||47560==t||47588==t||47616==t||47644==t||47672==t||47700==t||47728==t||47756==t||47784==t||47812==t||47840==t||47868==t||47896==t||47924==t||47952==t||47980==t||48008==t||48036==t||48064==t||48092==t||48120==t||48148==t||48176==t||48204==t||48232==t||48260==t||48288==t||48316==t||48344==t||48372==t||48400==t||48428==t||48456==t||48484==t||48512==t||48540==t||48568==t||48596==t||48624==t||48652==t||48680==t||48708==t||48736==t||48764==t||48792==t||48820==t||48848==t||48876==t||48904==t||48932==t||48960==t||48988==t||49016==t||49044==t||49072==t||49100==t||49128==t||49156==t||49184==t||49212==t||49240==t||49268==t||49296==t||49324==t||49352==t||49380==t||49408==t||49436==t||49464==t||49492==t||49520==t||49548==t||49576==t||49604==t||49632==t||49660==t||49688==t||49716==t||49744==t||49772==t||49800==t||49828==t||49856==t||49884==t||49912==t||49940==t||49968==t||49996==t||50024==t||50052==t||50080==t||50108==t||50136==t||50164==t||50192==t||50220==t||50248==t||50276==t||50304==t||50332==t||50360==t||50388==t||50416==t||50444==t||50472==t||50500==t||50528==t||50556==t||50584==t||50612==t||50640==t||50668==t||50696==t||50724==t||50752==t||50780==t||50808==t||50836==t||50864==t||50892==t||50920==t||50948==t||50976==t||51004==t||51032==t||51060==t||51088==t||51116==t||51144==t||51172==t||51200==t||51228==t||51256==t||51284==t||51312==t||51340==t||51368==t||51396==t||51424==t||51452==t||51480==t||51508==t||51536==t||51564==t||51592==t||51620==t||51648==t||51676==t||51704==t||51732==t||51760==t||51788==t||51816==t||51844==t||51872==t||51900==t||51928==t||51956==t||51984==t||52012==t||52040==t||52068==t||52096==t||52124==t||52152==t||52180==t||52208==t||52236==t||52264==t||52292==t||52320==t||52348==t||52376==t||52404==t||52432==t||52460==t||52488==t||52516==t||52544==t||52572==t||52600==t||52628==t||52656==t||52684==t||52712==t||52740==t||52768==t||52796==t||52824==t||52852==t||52880==t||52908==t||52936==t||52964==t||52992==t||53020==t||53048==t||53076==t||53104==t||53132==t||53160==t||53188==t||53216==t||53244==t||53272==t||53300==t||53328==t||53356==t||53384==t||53412==t||53440==t||53468==t||53496==t||53524==t||53552==t||53580==t||53608==t||53636==t||53664==t||53692==t||53720==t||53748==t||53776==t||53804==t||53832==t||53860==t||53888==t||53916==t||53944==t||53972==t||54e3==t||54028==t||54056==t||54084==t||54112==t||54140==t||54168==t||54196==t||54224==t||54252==t||54280==t||54308==t||54336==t||54364==t||54392==t||54420==t||54448==t||54476==t||54504==t||54532==t||54560==t||54588==t||54616==t||54644==t||54672==t||54700==t||54728==t||54756==t||54784==t||54812==t||54840==t||54868==t||54896==t||54924==t||54952==t||54980==t||55008==t||55036==t||55064==t||55092==t||55120==t||55148==t||55176==t?d:44033<=t&&t<=44059||44061<=t&&t<=44087||44089<=t&&t<=44115||44117<=t&&t<=44143||44145<=t&&t<=44171||44173<=t&&t<=44199||44201<=t&&t<=44227||44229<=t&&t<=44255||44257<=t&&t<=44283||44285<=t&&t<=44311||44313<=t&&t<=44339||44341<=t&&t<=44367||44369<=t&&t<=44395||44397<=t&&t<=44423||44425<=t&&t<=44451||44453<=t&&t<=44479||44481<=t&&t<=44507||44509<=t&&t<=44535||44537<=t&&t<=44563||44565<=t&&t<=44591||44593<=t&&t<=44619||44621<=t&&t<=44647||44649<=t&&t<=44675||44677<=t&&t<=44703||44705<=t&&t<=44731||44733<=t&&t<=44759||44761<=t&&t<=44787||44789<=t&&t<=44815||44817<=t&&t<=44843||44845<=t&&t<=44871||44873<=t&&t<=44899||44901<=t&&t<=44927||44929<=t&&t<=44955||44957<=t&&t<=44983||44985<=t&&t<=45011||45013<=t&&t<=45039||45041<=t&&t<=45067||45069<=t&&t<=45095||45097<=t&&t<=45123||45125<=t&&t<=45151||45153<=t&&t<=45179||45181<=t&&t<=45207||45209<=t&&t<=45235||45237<=t&&t<=45263||45265<=t&&t<=45291||45293<=t&&t<=45319||45321<=t&&t<=45347||45349<=t&&t<=45375||45377<=t&&t<=45403||45405<=t&&t<=45431||45433<=t&&t<=45459||45461<=t&&t<=45487||45489<=t&&t<=45515||45517<=t&&t<=45543||45545<=t&&t<=45571||45573<=t&&t<=45599||45601<=t&&t<=45627||45629<=t&&t<=45655||45657<=t&&t<=45683||45685<=t&&t<=45711||45713<=t&&t<=45739||45741<=t&&t<=45767||45769<=t&&t<=45795||45797<=t&&t<=45823||45825<=t&&t<=45851||45853<=t&&t<=45879||45881<=t&&t<=45907||45909<=t&&t<=45935||45937<=t&&t<=45963||45965<=t&&t<=45991||45993<=t&&t<=46019||46021<=t&&t<=46047||46049<=t&&t<=46075||46077<=t&&t<=46103||46105<=t&&t<=46131||46133<=t&&t<=46159||46161<=t&&t<=46187||46189<=t&&t<=46215||46217<=t&&t<=46243||46245<=t&&t<=46271||46273<=t&&t<=46299||46301<=t&&t<=46327||46329<=t&&t<=46355||46357<=t&&t<=46383||46385<=t&&t<=46411||46413<=t&&t<=46439||46441<=t&&t<=46467||46469<=t&&t<=46495||46497<=t&&t<=46523||46525<=t&&t<=46551||46553<=t&&t<=46579||46581<=t&&t<=46607||46609<=t&&t<=46635||46637<=t&&t<=46663||46665<=t&&t<=46691||46693<=t&&t<=46719||46721<=t&&t<=46747||46749<=t&&t<=46775||46777<=t&&t<=46803||46805<=t&&t<=46831||46833<=t&&t<=46859||46861<=t&&t<=46887||46889<=t&&t<=46915||46917<=t&&t<=46943||46945<=t&&t<=46971||46973<=t&&t<=46999||47001<=t&&t<=47027||47029<=t&&t<=47055||47057<=t&&t<=47083||47085<=t&&t<=47111||47113<=t&&t<=47139||47141<=t&&t<=47167||47169<=t&&t<=47195||47197<=t&&t<=47223||47225<=t&&t<=47251||47253<=t&&t<=47279||47281<=t&&t<=47307||47309<=t&&t<=47335||47337<=t&&t<=47363||47365<=t&&t<=47391||47393<=t&&t<=47419||47421<=t&&t<=47447||47449<=t&&t<=47475||47477<=t&&t<=47503||47505<=t&&t<=47531||47533<=t&&t<=47559||47561<=t&&t<=47587||47589<=t&&t<=47615||47617<=t&&t<=47643||47645<=t&&t<=47671||47673<=t&&t<=47699||47701<=t&&t<=47727||47729<=t&&t<=47755||47757<=t&&t<=47783||47785<=t&&t<=47811||47813<=t&&t<=47839||47841<=t&&t<=47867||47869<=t&&t<=47895||47897<=t&&t<=47923||47925<=t&&t<=47951||47953<=t&&t<=47979||47981<=t&&t<=48007||48009<=t&&t<=48035||48037<=t&&t<=48063||48065<=t&&t<=48091||48093<=t&&t<=48119||48121<=t&&t<=48147||48149<=t&&t<=48175||48177<=t&&t<=48203||48205<=t&&t<=48231||48233<=t&&t<=48259||48261<=t&&t<=48287||48289<=t&&t<=48315||48317<=t&&t<=48343||48345<=t&&t<=48371||48373<=t&&t<=48399||48401<=t&&t<=48427||48429<=t&&t<=48455||48457<=t&&t<=48483||48485<=t&&t<=48511||48513<=t&&t<=48539||48541<=t&&t<=48567||48569<=t&&t<=48595||48597<=t&&t<=48623||48625<=t&&t<=48651||48653<=t&&t<=48679||48681<=t&&t<=48707||48709<=t&&t<=48735||48737<=t&&t<=48763||48765<=t&&t<=48791||48793<=t&&t<=48819||48821<=t&&t<=48847||48849<=t&&t<=48875||48877<=t&&t<=48903||48905<=t&&t<=48931||48933<=t&&t<=48959||48961<=t&&t<=48987||48989<=t&&t<=49015||49017<=t&&t<=49043||49045<=t&&t<=49071||49073<=t&&t<=49099||49101<=t&&t<=49127||49129<=t&&t<=49155||49157<=t&&t<=49183||49185<=t&&t<=49211||49213<=t&&t<=49239||49241<=t&&t<=49267||49269<=t&&t<=49295||49297<=t&&t<=49323||49325<=t&&t<=49351||49353<=t&&t<=49379||49381<=t&&t<=49407||49409<=t&&t<=49435||49437<=t&&t<=49463||49465<=t&&t<=49491||49493<=t&&t<=49519||49521<=t&&t<=49547||49549<=t&&t<=49575||49577<=t&&t<=49603||49605<=t&&t<=49631||49633<=t&&t<=49659||49661<=t&&t<=49687||49689<=t&&t<=49715||49717<=t&&t<=49743||49745<=t&&t<=49771||49773<=t&&t<=49799||49801<=t&&t<=49827||49829<=t&&t<=49855||49857<=t&&t<=49883||49885<=t&&t<=49911||49913<=t&&t<=49939||49941<=t&&t<=49967||49969<=t&&t<=49995||49997<=t&&t<=50023||50025<=t&&t<=50051||50053<=t&&t<=50079||50081<=t&&t<=50107||50109<=t&&t<=50135||50137<=t&&t<=50163||50165<=t&&t<=50191||50193<=t&&t<=50219||50221<=t&&t<=50247||50249<=t&&t<=50275||50277<=t&&t<=50303||50305<=t&&t<=50331||50333<=t&&t<=50359||50361<=t&&t<=50387||50389<=t&&t<=50415||50417<=t&&t<=50443||50445<=t&&t<=50471||50473<=t&&t<=50499||50501<=t&&t<=50527||50529<=t&&t<=50555||50557<=t&&t<=50583||50585<=t&&t<=50611||50613<=t&&t<=50639||50641<=t&&t<=50667||50669<=t&&t<=50695||50697<=t&&t<=50723||50725<=t&&t<=50751||50753<=t&&t<=50779||50781<=t&&t<=50807||50809<=t&&t<=50835||50837<=t&&t<=50863||50865<=t&&t<=50891||50893<=t&&t<=50919||50921<=t&&t<=50947||50949<=t&&t<=50975||50977<=t&&t<=51003||51005<=t&&t<=51031||51033<=t&&t<=51059||51061<=t&&t<=51087||51089<=t&&t<=51115||51117<=t&&t<=51143||51145<=t&&t<=51171||51173<=t&&t<=51199||51201<=t&&t<=51227||51229<=t&&t<=51255||51257<=t&&t<=51283||51285<=t&&t<=51311||51313<=t&&t<=51339||51341<=t&&t<=51367||51369<=t&&t<=51395||51397<=t&&t<=51423||51425<=t&&t<=51451||51453<=t&&t<=51479||51481<=t&&t<=51507||51509<=t&&t<=51535||51537<=t&&t<=51563||51565<=t&&t<=51591||51593<=t&&t<=51619||51621<=t&&t<=51647||51649<=t&&t<=51675||51677<=t&&t<=51703||51705<=t&&t<=51731||51733<=t&&t<=51759||51761<=t&&t<=51787||51789<=t&&t<=51815||51817<=t&&t<=51843||51845<=t&&t<=51871||51873<=t&&t<=51899||51901<=t&&t<=51927||51929<=t&&t<=51955||51957<=t&&t<=51983||51985<=t&&t<=52011||52013<=t&&t<=52039||52041<=t&&t<=52067||52069<=t&&t<=52095||52097<=t&&t<=52123||52125<=t&&t<=52151||52153<=t&&t<=52179||52181<=t&&t<=52207||52209<=t&&t<=52235||52237<=t&&t<=52263||52265<=t&&t<=52291||52293<=t&&t<=52319||52321<=t&&t<=52347||52349<=t&&t<=52375||52377<=t&&t<=52403||52405<=t&&t<=52431||52433<=t&&t<=52459||52461<=t&&t<=52487||52489<=t&&t<=52515||52517<=t&&t<=52543||52545<=t&&t<=52571||52573<=t&&t<=52599||52601<=t&&t<=52627||52629<=t&&t<=52655||52657<=t&&t<=52683||52685<=t&&t<=52711||52713<=t&&t<=52739||52741<=t&&t<=52767||52769<=t&&t<=52795||52797<=t&&t<=52823||52825<=t&&t<=52851||52853<=t&&t<=52879||52881<=t&&t<=52907||52909<=t&&t<=52935||52937<=t&&t<=52963||52965<=t&&t<=52991||52993<=t&&t<=53019||53021<=t&&t<=53047||53049<=t&&t<=53075||53077<=t&&t<=53103||53105<=t&&t<=53131||53133<=t&&t<=53159||53161<=t&&t<=53187||53189<=t&&t<=53215||53217<=t&&t<=53243||53245<=t&&t<=53271||53273<=t&&t<=53299||53301<=t&&t<=53327||53329<=t&&t<=53355||53357<=t&&t<=53383||53385<=t&&t<=53411||53413<=t&&t<=53439||53441<=t&&t<=53467||53469<=t&&t<=53495||53497<=t&&t<=53523||53525<=t&&t<=53551||53553<=t&&t<=53579||53581<=t&&t<=53607||53609<=t&&t<=53635||53637<=t&&t<=53663||53665<=t&&t<=53691||53693<=t&&t<=53719||53721<=t&&t<=53747||53749<=t&&t<=53775||53777<=t&&t<=53803||53805<=t&&t<=53831||53833<=t&&t<=53859||53861<=t&&t<=53887||53889<=t&&t<=53915||53917<=t&&t<=53943||53945<=t&&t<=53971||53973<=t&&t<=53999||54001<=t&&t<=54027||54029<=t&&t<=54055||54057<=t&&t<=54083||54085<=t&&t<=54111||54113<=t&&t<=54139||54141<=t&&t<=54167||54169<=t&&t<=54195||54197<=t&&t<=54223||54225<=t&&t<=54251||54253<=t&&t<=54279||54281<=t&&t<=54307||54309<=t&&t<=54335||54337<=t&&t<=54363||54365<=t&&t<=54391||54393<=t&&t<=54419||54421<=t&&t<=54447||54449<=t&&t<=54475||54477<=t&&t<=54503||54505<=t&&t<=54531||54533<=t&&t<=54559||54561<=t&&t<=54587||54589<=t&&t<=54615||54617<=t&&t<=54643||54645<=t&&t<=54671||54673<=t&&t<=54699||54701<=t&&t<=54727||54729<=t&&t<=54755||54757<=t&&t<=54783||54785<=t&&t<=54811||54813<=t&&t<=54839||54841<=t&&t<=54867||54869<=t&&t<=54895||54897<=t&&t<=54923||54925<=t&&t<=54951||54953<=t&&t<=54979||54981<=t&&t<=55007||55009<=t&&t<=55035||55037<=t&&t<=55063||55065<=t&&t<=55091||55093<=t&&t<=55119||55121<=t&&t<=55147||55149<=t&&t<=55175||55177<=t&&t<=55203?f:9757==t||9977==t||9994<=t&&t<=9997||127877==t||127938<=t&&t<=127940||127943==t||127946<=t&&t<=127948||128066<=t&&t<=128067||128070<=t&&t<=128080||128110==t||128112<=t&&t<=128120||128124==t||128129<=t&&t<=128131||128133<=t&&t<=128135||128170==t||128372<=t&&t<=128373||128378==t||128400==t||128405<=t&&t<=128406||128581<=t&&t<=128583||128587<=t&&t<=128591||128675==t||128692<=t&&t<=128694||128704==t||128716==t||129304<=t&&t<=129308||129310<=t&&t<=129311||129318==t||129328<=t&&t<=129337||129341<=t&&t<=129342||129489<=t&&t<=129501?m:127995<=t&&t<=127999?y:8205==t?v:9792==t||9794==t||9877<=t&&t<=9878||9992==t||10084==t||127752==t||127806==t||127859==t||127891==t||127908==t||127912==t||127979==t||127981==t||128139==t||128187<=t&&t<=128188||128295==t||128300==t||128488==t||128640==t||128658==t?T:128102<=t&&t<=128105?x:_}var n=0,a=1,s=2,o=3,h=4,l=5,u=6,c=7,p=8,d=9,f=10,_=11,g=12,m=13,y=14,v=15,T=16,x=17,b=0,A=1,S=2,w=3,P=4;return this.nextBreak=function(n,a){if(void 0===a&&(a=0),a<0)return 0;if(a>=n.length-1)return n.length;for(var s=r(e(n,a)),o=[],h=a+1;h<n.length;h++)if(!t(n,h-1)){var l=r(e(n,h));if(i(s,o,l))return h;o.push(l)}return n.length},this.splitGraphemes=function(t){for(var e,i=[],r=0;(e=this.nextBreak(t,r))<t.length;)i.push(t.slice(r,e)),r=e;return r<t.length&&i.push(t.slice(r)),i},this.iterateGraphemes=function(t){var e=0,i={next:function(){var i,r;return(r=this.nextBreak(t,e))<t.length?(i=t.slice(e,r),e=r,{value:i,done:!1}):e<t.length?(i=t.slice(e),e=t.length,{value:i,done:!1}):{value:void 0,done:!0}}.bind(this)};return"undefined"!=typeof Symbol&&Symbol.iterator&&(i[Symbol.iterator]=function(){return i}),i},this.countGraphemes=function(t){for(var e,i=0,r=0;(e=this.nextBreak(t,r))<t.length;)r=e,i++;return r<t.length&&i++,i},this}(function(t,e,i){"use strict";function r(t,e){this._scaleFactor=t,this._deltaMode=e,this.originalEvent=null}if(!t.qc||!t.qc.Node){var n=function(t){var e=[],i=function(t,e){for(var i in t)if(t[i]==e)return!0;return!1},r=function(t){if("object"!=typeof t||null===t)return t;if(i(e,t))return t;e.push(t);var n={};for(var a in Array.isArray(t)&&(n=[]),t)t.hasOwnProperty(a)&&(n[a]=r(t[a]));return n};return r(t)},a=function(t,e,r){for(var n in e)r&&t[n]!==i||(t[n]=e[n]);return t};t.qc||(t.qc={});var s=t.qc,o=t.Phaser,h=t.PIXI;a(s,{PHASER_VERSION:o.VERSION,PUBLISH_VERSION:20220311,GAMES:o.GAMES,AUTO:o.AUTO,CANVAS:o.CANVAS,WEBGL:o.WEBGL,HEADLESS:o.HEADLESS,NONE:o.NONE,LEFT:o.LEFT,RIGHT:o.RIGHT,UP:o.UP,DOWN:o.DOWN,scaleModes:o.scaleModes}),this.qc=this.qc||{};var l=s.Log=function(t){var e=this;e.game=t,e.enableTrace=!1};l.prototype.trace=function(){if(t.printingloading){var e=s.Util.formatString.apply(null,arguments);console.log(e)}},l.prototype.important=function(){var e=s.Util.formatString.apply(null,arguments);t.__wx?console.log(e):console.log("%c"+e,"color:green")},l.prototype.error=function(){var e,i=s.Util.formatString.apply(null,arguments);t.__wx?console.log(i):console.log("%c"+i,"color:red");for(var r=1;r<arguments.length;r++)if(arguments[r]&&arguments[r].stack){e=arguments[r].stack,console.error(e);break}e||t.__wx||console.trace()},l.prototype.remoteReply=function(){var t=s.Util.formatString.apply(null,arguments);console.log("%c"+t,"color:green")},s.Circle=o.Circle,e.defineProperty(s.Circle.prototype,"class",{get:function(){return"qc.Circle"}}),s.Circle.prototype.toJson=function(){return[this.x,this.y,this.diameter]},s.Circle.prototype.fromJson=function(t){this.x=t[0],this.y=t[1],this.diameter=t[2]},s.Ellipse=o.Ellipse,e.defineProperty(s.Ellipse.prototype,"class",{get:function(){return"qc.Ellipse"}}),s.Ellipse.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]},s.Ellipse.prototype.fromJson=function(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]},s.Line=o.Line,e.defineProperty(s.Line.prototype,"class",{get:function(){return"qc.Line"}}),s.Line.prototype.toJson=function(){return[this.start.x,this.start.y,this.end.x,this.end.y]},s.Line.prototype.fromJson=function(t){this.start.setTo(t[0],t[1]),this.end.setTo(t[2],t[3])},s.Matrix=o.Matrix,e.defineProperty(s.Matrix.prototype,"class",{get:function(){return"qc.Matrix"}}),s.Matrix.prototype.toJson=function(){return this.toArray()},s.Matrix.prototype.fromJson=function(t){this.fromArray(t)},s.Point=o.Point,e.defineProperty(s.Point.prototype,"class",{get:function(){return"qc.Point"}}),s.Point.prototype.toJson=function(){return[this.x,this.y]},s.Point.prototype.fromJson=function(t){this.x=t[0],this.y=t[1]},s.Polygon=o.Polygon,e.defineProperty(s.Polygon.prototype,"class",{get:function(){return"qc.Polygon"}}),s.Polygon.prototype.toJson=function(){return[this.toNumberArray(),this.closed]},s.Polygon.prototype.fromJson=function(t){this.setTo(t[0]),this.closed=t[1]},s.Rectangle=o.Rectangle,e.defineProperty(s.Rectangle.prototype,"class",{get:function(){return"qc.Rectangle"}}),s.Rectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]},s.Rectangle.prototype.fromJson=function(t){this.setTo(t[0],t[1],t[2],t[3])},s.RoundedRectangle=o.RoundedRectangle,e.defineProperty(s.RoundedRectangle.prototype,"class",{get:function(){return"qc.RoundedRectangle"}}),s.RoundedRectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height,this.radius]},s.RoundedRectangle.prototype.fromJson=function(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3],this.radius=t[4]};var u=s.Keyframe=function(t,e,i,r){this.time=t,this.value=e,this.type=u.FREE_SMOOTH,this.inTangent=isNaN(i)?0:i,this.outTangent=isNaN(r)?0:r};u.prototype={},u.prototype.constructor=u,u.prototype.clone=function(){var t=new u(this.time,this.value,this.inTangent,this.outTangent);return t.type=this.type,t},u.AUTO=0,u.FREE_SMOOTH=1,u.FLAT=2,u.BROKEN=3,u.LINEAR=4,u.InfinityValue=Math.tan(Math.PI/2),e.defineProperties(u.prototype,{inAngle:{get:function(){return Math.atan(this.inTangent)},set:function(t){this.inTangent=Math.tan(t*Math.PI/180)}},outAngle:{get:function(){return Math.atan(this.outTangent)},set:function(t){this.outTangent=Math.tan(t*Math.PI/180)}},inTangent:{get:function(){return this._inTangent||0},set:function(t){this._inTangent=Math.abs(t)===u.InfinityValue?1/0*(t<0?-1:1):t}},outTangent:{get:function(){return this._outTangent||0},set:function(t){this._outTangent=Math.abs(t)===u.InfinityValue?1/0*(t<0?-1:1):t}},isFlat:{get:function(){return this.inTangent===this.outTangent&&0===this.outTangent}},isBroken:{get:function(){return this.inTangent!==this.outTangent}}});var c=s.BezierCurve=function(t){if(this._keys=[],Array.isArray(t))for(var e in t)this.addKey(t[e]);else for(e=0;e<arguments.length;++e)this.addKey(arguments[e])};c.prototype={},c.prototype.constructor=c,e.defineProperties(c.prototype,{class:{get:function(){return"qc.BezierCurve"}},keys:{get:function(){return this._keys},set:function(t){for(var e in this._keys=[],t)this.addKey(t[e])}},length:{get:function(){return this._keys.length}},startTime:{get:function(){return this.keys&&this.keys.length?this.keys[0].time:0}},endTime:{get:function(){return this.keys&&this.keys.length?this.keys[this.keys.length-1].time:0}},totalTime:{get:function(){return this.keys&&this.keys.length?this.keys[this.keys.length-1].time-this.keys[0].time:0}},postWrapMode:{get:function(){return isNaN(this._postWrapMode)?c.WRAP_CLAMP:this._postWrapMode},set:function(t){this._postWrapMode=t}},preWrapMode:{get:function(){return isNaN(this._preWrapMode)?c.WRAP_CLAMP:this._preWrapMode},set:function(t){this._preWrapMode=t}}}),c.prototype.toJson=function(){for(var t=[],e=0;e<this._keys.length;++e)t.push([this._keys[e].time,this._keys[e].value,this._keys[e].inTangent===1/0?"Infinity":this._keys[e].inTangent,this._keys[e].outTangent===1/0?"Infinity":this._keys[e].outTangent]);return t.push([this.preWrapMode,this.postWrapMode]),t},c.prototype.fromJson=function(t){for(var e=0;e<t.length;++e)4===t[e].length&&this.addKey(t[e][0],t[e][1],"Infinity"===t[e][2]?1/0:t[e][2],"Infinity"===t[e][3]?1/0:t[e][3]);2===t[t.length-1].length&&(this.preWrapMode=t[t.length-1][0],this.postWrapMode=t[t.length-1][1])},c.prototype.sort=function(){this._keys.sort(function(t,e){return t.time-e.time})},c.prototype.addKey=function(t,e,i,r){var n=!(t instanceof u)&&(isNaN(i)||isNaN(r)),a=t instanceof u?t:new u(t,e,i,r),o=s.Util.insertSortedList(this._keys,a,this._keyframeLess);return n&&this.makeKeyframeAuto(o),o},c.prototype.removeKey=function(t){return this._keys?this._keys.splice(t,1):null},c.prototype._keyframeLess=function(t,e){return t.time<e.time},c.prototype._calc=function(t,e,i,r,n){var a=Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*i+3*(1-t)*Math.pow(t,2)*n+r*Math.pow(t,3);return a===1/0||isNaN(a)||Math.abs(a)>=2147483647?1===t?r:e:a},c.prototype._calcDerivative=function(t,e,i,r,n){var a=1-t,s=-3*e*a*a+3*i*a*(1-3*t)+3*n*t*(2-3*t)+3*r*Math.pow(t,2);return s===1/0||isNaN(s)?0:s},c.prototype.evaluate=function(t,e){var i=0,r=this._keys?this._keys.length:0;if(0===r)return NaN;if(1===r)return this._keys[0].value;var n,a=this._keys[0].time,s=this._keys[r-1].time,o=s-a;if(a>t){if(0===o||this.preWrapMode===c.WRAP_CLAMP)return this._keys[0].value;if(this.preWrapMode===c.WRAP_LOOP){var h=a-t;return h-=Math.floor(h/o)*o,this.evaluate(s-h,e)}if(this.preWrapMode===c.WRAP_PINGPONG){h=a-t;return h-=2*Math.floor(h/(2*o))*o,h<=o?this.evaluate(a+h,e):this.evaluate(s-h+o,e)}}if(t>s){if(0===o||this.postWrapMode===c.WRAP_CLAMP)return this._keys[r-1].value;if(this.postWrapMode===c.WRAP_LOOP){h=t-s;return h-=Math.floor(h/o)*o,this.evaluate(a+h,e)}if(this.postWrapMode===c.WRAP_PINGPONG){h=t-s;return h-=2*Math.floor(h/(2*o))*o,h<=o?this.evaluate(s-h,e):this.evaluate(a+h-o,e)}}for(t===a&&e&&this.preWrapMode!==c.WRAP_CLAMP&&(t=s);++i<r;)if(n=this._keys[i].time,n!==a){if(t<=n){var l=n-a,u=(this._keys[i].value,this._keys[i-1].value,(t-a)/l),p=this._calc(u,this._keys[i-1].value,this._keys[i-1].value+l*this._keys[i-1].outTangent/3,this._keys[i].value,this._keys[i].value-l*this._keys[i].inTangent/3);return p}a=this._keys[i].time}return NaN},c.prototype.evaluateDerivative=function(t){var e=0,i=this._keys?this._keys.length:0;if(0===i)return NaN;var r,n=this._keys[0].time;if(n>t||t>this._keys[i-1].time)return NaN;for(;++e<i;)if(r=this._keys[e].time,r!==n){if(t<r){var a=r-n,s=(t-n)/a,o=this._calcDerivative(s,this._keys[e-1].value,this._keys[e-1].value+a*this._keys[e-1].outTangent/3,this._keys[e].value,this._keys[e].value-a*this._keys[e].inTangent/3);return o/a}n=this._keys[e].time}return NaN},c.prototype.makeKeyframeAuto=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null,i=t>0&&t<this._keys.length?this._keys[t-1]:null,r=t<=this._keys.length-1&&t>=0?this._keys[t+1]:null,n=0,a=0;e&&(i&&(n++,
a+=Math.atan2(e.value-i.value,e.time-i.time)),r&&(n++,a+=Math.atan2(r.value-e.value,r.time-e.time)),n>0&&(e.inTangent=e.outTangent=Math.tan(a/n)))},c.prototype.makeKeyframeSmooth=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null;if(e){var i=Math.atan(e.inTangent)+Math.atan(e.outTangent);e.inTangent=e.outTangent=Math.tan(i/2)}},c.prototype.makeKeyframeFlat=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null;e&&(e.inTangent=e.outTangent=0)},c.prototype.makeKeyframeLinear=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null,i=t>0&&t<this._keys.length?this._keys[t-1]:null,r=t<=this._keys.length-1&&t>=0?this._keys[t+1]:null;e&&(i&&(e.inTangent=(e.value-i.value)/(e.time-i.time)),r&&(e.outTangent=(r.value-e.value)/(r.time-e.time)))},c.prototype.clone=function(){var t=new c([]);for(var e in this._keys)t.addKey(this._keys[e].clone());return t},c.WRAP_CLAMP=0,c.WRAP_LOOP=1,c.WRAP_PINGPONG=2;var p=s.GeometricTool={};p.flattenPolygon=function(t){for(var e=new Array(2*t.length),i=t.length;i--;)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},p.polygonContains=function(t,e,i){if(isNaN(t[0])){for(var r=t.length,n=!1,a=-1,s=r-1;++a<r;s=a){var o=t[a].x,h=t[a].y,l=t[s].x,u=t[s].y;(h<=i&&i<u||u<=i&&i<h)&&e<(l-o)*(i-h)/(u-h)+o&&(n=!n)}return n}for(r=t.length/2,n=!1,a=-1,s=r-1;++a<r;s=a){o=t[2*a],h=t[2*a+1],l=t[2*s],u=t[2*s+1];(h<=i&&i<u||u<=i&&i<h)&&e<(l-o)*(i-h)/(u-h)+o&&(n=!n)}return n},p.pointOnLine=function(t,e,i,r){return(i-t.x)*(e.y-t.y)==(e.x-t.x)*(r-t.y)},p.pointOnSegment=function(t,e,i,r){var n=Math.min(t.x,e.x),a=Math.max(t.x,e.x),o=Math.min(t.y,e.y),h=Math.max(t.y,e.y);return s.GeometricTool.pointOnLine(t,e,i,r)&&i>=n&&i<=a&&r>=o&&r<=h},p.lineIntersectsPoints=function(t,e,i,r,n,a){void 0===n&&(n=!0),a||(a=new s.Point);var o=e.y-t.y,h=r.y-i.y,l=t.x-e.x,u=i.x-r.x,c=e.x*t.y-t.x*e.y,p=r.x*i.y-i.x*r.y,d=o*u-h*l;if(0===d)return null;if(t.equals(i)||t.equals(r))return a.x=t.x,a.y=t.y,a;if(e.equals(i)||e.equals(r))return a.x=e.x,a.y=e.y,a;if(a.x=(l*p-u*c)/d,a.y=(h*c-o*p)/d,n){var f=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y),_=((r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x))/f,g=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/f;return _>=0&&_<=1&&g>=0&&g<=1?a:null}return a};var d=p._sutherlandHodgmanInside=function(t,e,i,r){return(e.x-t.x)*(i.y-t.y)+r>=(e.y-t.y)*(i.x-t.x)},f=p._sutherlandHodgmanIntersection=function(t,e,i,r){var n=[t.x-e.x,t.y-e.y],a=[i.x-r.x,i.y-r.y],s=t.x*e.y-t.y*e.x,o=i.x*r.y-i.y*r.x,h=1/(n[0]*a[1]-n[1]*a[0]);return{x:(s*a[0]-o*n[0])*h,y:(s*a[1]-o*n[1])*h}};p.sutherlandHodgman=function(t,e){var i,r,n,a,s=1e-6,o=t;for(n in i=e[e.length-1],e){var h=e[n],l=o;for(a in o=[],r=l[l.length-1],l){var u=l[a];d(i,h,u,s)?(d(i,h,r,s)||o.push(f(i,h,r,u)),o.push(u)):d(i,h,r,s)&&o.push(f(i,h,r,u)),r=u}i=h}return o},p.Triangulate=function(t){var e=!0,i=t.length;if(i<3)return[];for(var r=[],n=[],a=0;a<i;a++)n.push(a);a=0;for(var s=i;s>3;){var o=n[(a+0)%s],l=n[(a+1)%s],u=n[(a+2)%s],c=t[o].x,p=t[o].y,d=t[l].x,f=t[l].y,_=t[u].x,g=t[u].y,m=!1;if(h.PolyK._convex(c,p,d,f,_,g,e)){m=!0;for(var y=0;y<s;y++){var v=n[y];if(v!==o&&v!==l&&v!==u&&h.PolyK._PointInTriangle(t[v].x,t[v].y,c,p,d,f,_,g)){m=!1;break}}}if(m)r.push(o,l,u),n.splice((a+1)%s,1),s--,a=0;else if(a++>3*s){if(!e)return null;for(r=[],n=[],a=0;a<i;a++)n.push(a);a=0,s=i,e=!1}}return r.push(n[0],n[1],n[2]),r},p.area=function(t,e,i){return t&&e&&i?(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y):0},p.left=function(t,e,i){return p.area(t,e,i)>0},p.leftOn=function(t,e,i){return p.area(t,e,i)>=0},p.right=function(t,e,i){return p.area(t,e,i)<0},p.rightOn=function(t,e,i){return p.area(t,e,i)<=0},p.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r},p.atPolygon=function(t,e){var i=t.length;return t[e<0?e%i+i:e%i]},p.lineInt=function(t,e,i){i=i||0;var r,n,a,o,h,l,u,c=new s.Point;return r=t[1].y-t[0].y,n=t[0].x-t[1].x,a=r*t[0].x+n*t[0].y,o=e[1].y-e[0].y,h=e[0].x-e[1].x,l=o*e[0].x+h*e[0].y,u=1/(r*h-o*n),p._equals(u,0,i)||(c.x=(h*a-n*l)*u,c.y=(r*l-o*a)*u),c},p.isPolygonReflex=function(t,e){return p.right(p.atPolygon(t,e-1),p.atPolygon(t,e),p.atPolygon(t,e+1))},p.polygonCanSee=function(t,e,i){var r,n,a=[],s=[];if(p.leftOn(p.atPolygon(t,e+1),p.atPolygon(t,e),p.atPolygon(t,i))&&p.rightOn(p.atPolygon(t,e-1),p.atPolygon(t,e),p.atPolygon(t,i)))return!1;n=p.distance(p.atPolygon(t,e),p.atPolygon(t,i));for(var o=0;o!=t.length;++o)if((o+1)%t.length!==e&&o!==e&&p.leftOn(p.atPolygon(t,e),p.atPolygon(t,i),p.atPolygon(t,o+1))&&p.rightOn(p.atPolygon(t,e),p.atPolygon(t,i),p.atPolygon(t,o))&&(a[0]=p.atPolygon(t,e),a[1]=p.atPolygon(t,i),s[0]=p.atPolygon(t,o),s[1]=p.atPolygon(t,o+1),r=p.lineInt(a,s),p.distance(p.atPolygon(t,e),r)<n))return!1;return!0},p._equals=function(t,e,i){return i=i||0,Math.abs(t-e)<i},p.getIntersectionPoint=function(t,e,i,r,n){n=n||0;var a=e.y-t.y,s=t.x-e.x,o=a*t.x+s*t.y,h=r.y-i.y,l=i.x-r.x,u=h*i.x+l*i.y,c=a*l-h*s;return p._equals(c,0,n)?{x:0,y:0}:{x:(l*o-s*u)/c,y:(a*u-h*o)/c}},p.quickDecomp=function(t,e,i,r,n,a,s){a=a||100,s=s||0,n=n||25,e=void 0!==e?e:[],i=i||[],r=r||[];var o=[0,0],h=[0,0],l=[0,0],u=0,c=0,d=0,f=0,_=0,g=0,m=0,y=[],v=[],T=t;if(T.length<3)return e;if(s++,s>a)return e;for(var x=0;x<T.length;++x)if(p.isPolygonReflex(T,x)){i.push(T[x]),u=c=Number.MAX_VALUE;for(var b=0;b<T.length;++b)p.left(p.atPolygon(T,x-1),p.atPolygon(T,x),p.atPolygon(T,b))&&p.rightOn(p.atPolygon(T,x-1),p.atPolygon(T,x),p.atPolygon(T,b-1))&&(l=p.getIntersectionPoint(p.atPolygon(T,x-1),p.atPolygon(T,x),p.atPolygon(T,b),p.atPolygon(T,b-1)),p.right(p.atPolygon(T,x+1),p.atPolygon(T,x),l)&&(d=p.distance(T[x],l),d<c&&(c=d,h=l,g=b))),p.left(p.atPolygon(T,x+1),p.atPolygon(T,x),p.atPolygon(T,b+1))&&p.rightOn(p.atPolygon(T,x+1),p.atPolygon(T,x),p.atPolygon(T,b))&&(l=p.getIntersectionPoint(p.atPolygon(T,x+1),p.atPolygon(T,x),p.atPolygon(T,b),p.atPolygon(T,b+1)),p.left(p.atPolygon(T,x-1),p.atPolygon(T,x),l)&&(d=p.distance(T[x],l),d<u&&(u=d,o=l,_=b)));if(g==(_+1)%T.length)l.x=(h.x+o.x)/2,l.y=(h.y+o.y)/2,r.push(l),x<_?(Array.prototype.push.apply(y,T.slice(x,_+1)),y.push(l),v.push(l),0!=g&&Array.prototype.push.apply(v,T.slice(g,T.length)),Array.prototype.push.apply(v,T.slice(0,x+1))):(0!=x&&Array.prototype.push.apply(y,T.slice(x,T.length)),Array.prototype.push.apply(y,T.slice(0,_+1)),y.push(l),v.push(l),Array.prototype.push.apply(v,T.slice(g,x+1)));else{if(g>_&&(_+=T.length),f=Number.MAX_VALUE,_<g)return e;for(b=g;b<=_;++b)p.leftOn(p.atPolygon(T,x-1),p.atPolygon(T,x),p.atPolygon(T,b))&&p.rightOn(p.atPolygon(T,x+1),p.atPolygon(T,x),p.atPolygon(T,b))&&(d=p.distance(p.atPolygon(T,x),p.atPolygon(T,b)),d<f&&(f=d,m=b%T.length));x<m?(Array.prototype.push.apply(y,T.slice(x,m+1)),0!=m&&Array.prototype.push.apply(v,T.slice(m,T.length)),Array.prototype.push.apply(v,T.slice(0,x+1))):(0!=x&&Array.prototype.push.apply(y,T.slice(x,T.length)),Array.prototype.push.apply(y,T.slice(0,m+1)),Array.prototype.push.apply(v,T.slice(m,x+1)))}return y.length<v.length?(p.quickDecomp(y,e,i,r,n,a,s),p.quickDecomp(v,e,i,r,n,a,s)):(p.quickDecomp(v,e,i,r,n,a,s),p.quickDecomp(y,e,i,r,n,a,s)),e}return e.push(T),e},p.decomp=function(t){var e=p.getCutEdges(t);return e.length>0?p.polygonSlice(t,e):[t]},p.polygonSlice=function(t,e){if(0===e.length)return[this];if(e instanceof Array&&e.length&&e[0]instanceof Array&&2==e[0].length&&e[0][0]instanceof Array){for(var i=[t],r=0;r<e.length;r++)for(var n=e[r],a=0;a<i.length;a++){var s=i[a],o=p.polygonSlice(s,n);if(o){i.splice(a,1),i.push(o[0],o[1]);break}}return i}n=e,r=t.indexOf(n[0]),a=t.indexOf(n[1]);return-1!=r&&-1!=a&&[p.copyPolygon(t,r,a),p.copyPolygon(t,a,1)]},p.copyPolygon=function(t,e,i,r){var n=r||[];if(e<i)for(var a=e;a<=i;a++)n.push(t[a]);else{for(a=0;a<=i;a++)n.push(t[a]);for(a=e;a<t.length;a++)n.push(t[a])}return n},p.getCutEdges=function(t){for(var e=[],i=[],r=[],n=Number.MAX_VALUE,a=0;a<t.length;++a)if(p.isPolygonReflex(t,a))for(var s=0;s<t.length;++s)if(p.polygonCanSee(t,a,s)){i=p.getCutEdges(p.copyPolygon(t,a,s)),r=p.getCutEdges(p.copyPolygon(t,s,a));for(var o=0;o<r.length;o++)i.push(r[o]);i.length<n&&(e=i,n=i.length,e.push([p.atPolygon(t,a),p.atPolygon(t,s)]))}return e};var _,g=s.AssetUtil={ASSET_SCENE:1,ASSET_PREFAB:2,ASSET_ATLAS:3,ASSET_TEXT:4,ASSET_FONT:5,ASSET_SOUND:6,ASSET_EXCEL:7,ASSET_WEBFONT:8,ASSET_ACTION:9,ASSET_ACTIONMANAGER:10,ASSET_TS:99,ASSET_JS:100,ASSET_UNKNOWN:101,parse:function(e,r,n,a){var o,h=r.key,l=r.url,u=r.data;if(/\.bin$/.test(l)){if(r.isSound){var c,p;u=u||e.assets._cache.getBinary(l),delete e.assets._cache._binary[l];var d=new Uint8Array(u);if(81!==d[0]||67!==d[1])return e.log.error("Asset({0}) parse fail",l),void e.assets._parsing--;c=d,p=2;var f,_=function(){var t=c[p]<<24|c[p+1]<<16|c[p+2]<<8|c[p+3],e=p+4;return p+=t+4,[e,t]};o=[],f=_(),o.push(e.serializer.unpackUTF8(c.subarray(f[0],f[0]+f[1]))),f=_(),o.push(u.slice(f[0],f[1]))}else{u=u||e.assets._cache.getText(l),delete e.assets._cache._text[l],r.data=u;try{o=JSON.parse(u)}catch(t){return e.log.error("Asset{0}/{1} Parse fail",h,l),s.Util.popupError(t.message),void(n&&n())}}var m=JSON.parse(o[0]);switch(t.__wx&&!r.data&&g.wxSaveAsset(e,l,u),m.type){case g.ASSET_ATLAS:if(t.hasBase64&&t.hasBase64()||t.assetsPackage){console.log("使用data.js资源");for(var y=r.url.split("/"),v=y[y.length-1],T=[],x=0;x<m.source.length;x++){var b="";b=2==x&&".json"==m.source[x]?v.replace("_tex.bin","_ske.json"):v.replace(".bin",m.source[x]);var A=b.replace(".","_");T.push(A)}if(1==T.length){var S=t.getAssestByKey(T[0]);S&&(o[1]="{}",o[2]=S)}else for(x=0;x<T.length;x++){S=t.getAssestByKey(T[x]);S&&(o[x+1]=S)}}else{for(T=[],x=0;x<m.source.length;x++)if(2==x&&".json"==m.source[x]){b=r.url.replace("_tex.bin","_ske.json");T.push(b)}else{b=r.url.replace(".bin",m.source[x]);T.push(b)}var w=!1;for(x=0;x<T.length;x++)(r.override&&!r.hasLoadDep||null==e.phaser.cache.getText(T[x])&&null==e.phaser.cache.getImage(T[x]))&&(r.hasLoadDep=!0,w=!0);if(w)return r.loadCnt=T.length,void(a&&(e.assets._uuid2UrlConf[m.uuid]=r.url,a(m.uuid,T)));if(1==T.length)o[1]="{}",o[2]=e.phaser.cache.getText(T[0])||e.phaser.cache.getImage(T[0]);else for(x=0;x<T.length;x++)if(e.phaser.cache.getText(T[x])||e.phaser.cache.getImage(T[x])){var P=e.phaser.cache.getText(T[x])||e.phaser.cache.getImage(T[x]);o[x+1]=P}}return g._parseAtlas(e,m,JSON.parse(o[1]),o[2],o[3]?JSON.parse(o[3]):i,h,l,n);case g.ASSET_PREFAB:return g._parsePrefab(e,JSON.parse(o[1]),h,l,m,n);case g.ASSET_SCENE:return g._parseScene(e,JSON.parse(o[1]),h,l,m,n);case g.ASSET_TEXT:return g._parseText(e,o[1],h,l,m,n);case g.ASSET_FONT:return g._parseFont(e,m,o[1],o[2],h,l,n);case g.ASSET_SOUND:return g._parseSound(e,m,o[1],h,l,n);case g.ASSET_EXCEL:return g._parseExcel(e,m,JSON.parse(o[1]),h,l,n);case g.ASSET_WEBFONT:return g._parseWebFont(e,m,JSON.parse(o[1]),h,l,n);case g.ASSET_ACTION:return g._parseAction(e,JSON.parse(o[1]),h,l,m,n);case g.ASSET_ACTIONMANAGER:return g._parseActionManager(e,JSON.parse(o[1]),h,l,m,n);default:throw new Error("unsupported asset type："+m.type)}}else{if(r.isRaw)this._addAtlasToCache(e,h,l);else{var E=e.assets._cache.getSound(l);if(E){var D=new s.SoundAsset(h,l,E.data,{uuid:h,type:g.ASSET_SOUND});e.assets.cache(h,l,D)}if(t.__wx){var C=e.storage.get("localFiles")||{},O=e.storage.get("assetsMd5")||{};h=l.replace("Assets/","");if(O[h]){var M=C[h];M?M.md5==O[h]&&(e.log.important("文件({0})md5一致，不缓存。",l),M.time=e.time.now,e.storage.delaySet("localFiles",C,1e4)):(M={},M.md5=O[h],M.time=e.time.now,C[h]=M,e.storage.delaySet("localFiles",C,1e4))}}}n&&n()}},isSound:function(t){if(s.Util.isArray(t)){for(var e=0;e<t.length;e++)if(t[e]&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(t[e].toLowerCase()))return!0;return!1}return t&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(t.toLowerCase())},_parseAtlas:function(r,n,a,l,u,c,p,d){var f=new Image;f.url=p;var _=function(t){for(var e,i,r={meta:{image:t.imagePath},frames:e={}},n=t.SubTexture,a=n.length,s=0;s<a;s++)i=n[s],e[i.name]={filename:i.name,frame:{x:i.x,y:i.y,w:i.width,h:i.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:i.width,h:i.height},sourceSize:{w:i.width,h:i.height}};return r},g=function(e,i,r){t.drawcanvas||(t.drawcanvas=document.createElement("canvas"),t.drawctx=drawcanvas.getContext("2d")),drawcanvas.width=i,drawcanvas.height=r,drawctx.drawImage(e,0,0,i,r),e.key=null,e.remove();var n=drawcanvas.toDataURL("image/png");return n},m=function(){f.onload=i;var l=r.assets._cache,y=p.split("/"),v=y[y.length-1],T=v.replace(".","_");if(t.picDesc&&t.picDesc[T]){var x=t.picDesc[T],b=x.split(","),A=parseInt(b[0]),S=parseInt(b[1]);if(A!=f.width){var w=g(f,A,S);return f.src=w,void(f.onload=m)}}if(l._images[p]={url:p,data:f},h.BaseTextureCache[p]=new h.BaseTexture(f),h.TextureCache[p]=new h.Texture(h.BaseTextureCache[p]),e.keys(a).length>0)if(!u||n.animationType!==_e.DRAGON_BONES&&n.animationType!==_e.FRAME_SAMPLES)a&&s.Util.isArray(a.frames)?l._images[p].frameData=o.AnimationParser.JSONData(r.phaser,a,p):l._images[p].frameData=o.AnimationParser.JSONDataHash(r.phaser,a,p);else{var P=_(a);l._images[p].frameData=o.AnimationParser.JSONDataHash(r.phaser,P,p)}else if(n.spriteSheet){var E=f.width/(n.spriteSheet.columns||1),D=f.height/(n.spriteSheet.rows||1),C=n.spriteSheet.margin||0,O=n.spriteSheet.spacing||0;l._images[p].frameData=o.AnimationParser.spriteSheet(r.phaser,p,E,D,-1,C,O)}else l._images[p].frameData=new o.FrameData,l._images[p].frame=new o.Frame(0,0,0,f.width,f.height,"",""),l._images[p].frameData.addFrame(new o.Frame(0,0,0,f.width,f.height,null,r.math.uuid()));l._resolveURL(p,l._images[p]);var M=new s.Atlas(c,p,l._images[p],n,u);M.json=a,M.img=f,r.assets.cache(c,p,M),d()};"string"==typeof l?0==l.search("data")?f.src=l:f.src="data:image/png;base64,"+l:(f=l,m()),f.onerror=function(){f.onerror=i,d()},f.onload=m},addAtlasFromImage:function(t,e,i,r){return t.assets._cache.addImage(i,i,r),this._addAtlasToCache(t,e,i)},_addAtlasToCache:function(t,e,i){var r=t.assets._cache._images[i],n=new s.Atlas(e,i,r,{uuid:t.math.uuid(),type:g.ASSET_ATLAS});return n.img=r.data,t.assets.cache(e,i,n),n},_parseFont:function(e,r,n,a,o,h,l){t.__wx||(a=e.assets._loader.parseXml(a));var u=new Image;u.src="data:image/png;base64,"+n,u.onerror=function(){u.onerror=i,l()},u.onload=function(){if(u.onload=i,t.__wx){if(t.Tautologistics){var n=new Tautologistics.NodeHtmlParser.DefaultHandler(function(t,i){if(t)e.log.error("解析字体文件{0}的 xml 失败。",h),l();else{var n=new s.Font(o,h,u,i,r);n._fontFamily=s.UIText.BITMAPFONT,e.assets._cache.addBitmapFont(h,h,u,i,n.xSpacing,n.ySpacing),e.assets.cache(o,h,n),l()}}),c=new Tautologistics.NodeHtmlParser.Parser(n);c.parseComplete(a)}}else{var p=new s.Font(o,h,u,a,r);p._fontFamily=s.UIText.BITMAPFONT,e.assets._cache.addBitmapFont(h,h,u,a,p.xSpacing,p.ySpacing),e.assets.cache(o,h,p),l()}}},_parseText:function(t,e,i,r,n,a){t.assets._cache.addText(r,r,e),t.assets.cache(i,r,new s.TextAsset(i,r,e,n)),a()},_parseScene:function(t,e,i,r,n,a){return g._parsePrefab(t,e,i,r,n,a)},_parsePrefab:function(t,e,i,r,n,a){t.assets.cache(i,r,new T(i,r,e,n)),a()},_parseAction:function(t,e,i,r,n,a){t.assets.cache(i,r,new C(i,r,e,n)),a()},_parseActionManager:function(t,e,i,r,n,a){t.assets.cache(i,r,new O(i,r,e,n)),a()},_parseSound:function(t,e,i,r,n,a){if(t.assets._cache.addSound(n,n,i),t.assets._cache.isSoundDecoded(n)){var o=new s.SoundAsset(r,n,t.phaser.cache.getSound(n),e);t.assets.cache(r,n,o),a()}else t.sound.phaser.decode(n,{url:n,key:r,meta:e,nextStep:a})},_parseExcel:function(t,e,i,r,n,a){t.assets.cache(r,n,new s.ExcelAsset(r,n,i,e)),a()},_parseWebFont:function(i,r,n,a,o,l){g._deleteWebFont(r.uuid),g._loadWebFont(i,r.uuid,n.url);var u=new s.Font(r.uuid,o,u,null,r);"string"==typeof n.url?u._fontUrl=[n.url]:u._fontUrl=n.url,u._fontFamily=s.UIText.WEBFONT,i.assets.cache(a,o.toString(),u),l();var c=function(t){i.world&&(e.keys(h.Text.fontPropertiesCache).forEach(function(t){t.indexOf(r.uuid)>=0&&delete h.Text.fontPropertiesCache[t]}),g._refreshWebFont(t,i.world)),i.assets.webFontLoaded.dispatch()};if(t.__wx)for(var p=0;p<u._fontUrl.length;p++){o=u._fontUrl[p];var d=wx.env.USER_DATA_PATH+"/"+o,f=wx.getFileSystemManager();try{f.accessSync(d);var _=wx.loadFont(d);if(_){i.log.trace("Asset {0}->{1} load from local filesystem.",o,_);u=i.assets.find(a);u?u.wxFontName=_:i.log.error("加载本地字体"+o+"成功后取不到 font 资源"),c(_)}}catch(t){g.wxAssureDirectory(i,o),wx.downloadFile({url:i.assets.baseURL+o,filePath:wx.env.USER_DATA_PATH+"/"+o,success:function(t){i.log.trace("字体 {0} 下载成功. res : {1}",o,JSON.stringify(t));var e=wx.loadFont(wx.env.USER_DATA_PATH+"/"+o);if(e){i.log.trace("Asset {0}->{1} load from local filesystem.",o,e);var r=i.assets.find(a);r?r.wxFontName=e:i.log.error("从网络加载本地字体"+o+"成功后取不到 font 资源"),c(e)}},fail:function(t){i.log.error("Download "+i.assets.baseURL+o+" fail："+JSON.stringify(t))}})}}else t.WebFont&&WebFont.load({timeout:6e4,custom:{families:[r.uuid]},fontactive:function(t){c(t)},fontinactive:function(t){i.log.error("Load "+t+" fail")}})},_webFontType:{eot:"embedded-opentype",ttf:"truetype",ttc:"truetype",woff:"woff",svg:"svg"},_loadWebFont:function(e,i,r){var n=g._webFontType,a=document.createElement("style");a.type="text/css",a.id="qc.webfont."+i,document.getElementsByTagName("head")[0].appendChild(a);var o="@font-face { font-family:"+i+"; src:";if(t.hasBase64&&t.hasBase64()){var h="data:application/octet-stream;base64,"+t.getAssestByKey(t.getKeyByUrl(r[0])),l=new FontFace(i,'local(""),url(\''+h+"') format('ttf'),url('"+h+"')");l.load().then(function(t){document.fonts.add(t)})}else if(s.Util.isArray(r))for(var u=0,c=r.length;u<c;u++){r[u];var p=g._getSuffix(r[u]);r[u].indexOf("http")>=0?o+="url('"+r[u]+"') format('"+n[p]+"')":o+="url('"+(e.assets.baseURL+r[u])+"') format('"+n[p]+"')",o+=u===c-1?";":","}else{p=g._getSuffix(r);o+="url('"+r+"') format('"+n[p]+"');"}a.textContent+=o+"};"},_deleteWebFont:function(t){for(;;){var e=document.getElementById("qc.webfont."+t);if(!e)break;s.Util.removeHTML(e)}},_refreshWebFont:function(t,e){e instanceof s.UIText&&e._refreshWebFont(t);for(var i=e.children,r=i.length;r--;){var n=i[r];g._refreshWebFont(t,n)}},_getSuffix:function(t){var e=t.substr((Math.max(0,t.lastIndexOf("."))||1/0)+1);return e.toLowerCase()},_createStandardXHR:function(){try{return new t.XMLHttpRequest}catch(t){}},_createActiveXHR:function(){try{return new t.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}},getXHR:function(){var e;try{e=location.href}catch(t){e=document.createElement("a"),e.href="",e=e.href}var i=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,r=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,n=i.exec(e.toLowerCase())||[],a=r.test(n[1]),s=t.ActiveXObject?function(){return!a&&g._createStandardXHR()||g._createActiveXHR()}:g._createStandardXHR;return s()},get:function(e,i,r){if(t.__wx){var n={"Content-Type":"text/plain;charset=UTF-8"};wx.request({url:e,header:n,dataType:"text",success:function(t){i(t.data)},fail:function(t){console.log("err:"+JSON.stringify(t)),r()}})}else{var a=g.getXHR();a.open("GET",e,!0),a.responseType="text",a.onreadystatechange=function(){4===a.readyState&&(200===a.status?i(a.responseText):r&&r(a))},a.send()}},post:function(e,i,r,n){if(t.__wx){var a={"Content-Type":"text/plain;charset=UTF-8"};wx.request({url:e,method:"POST",data:i,header:a,dataType:"text",success:function(t){r(t.data)},fail:function(){n()}})}else{var s=g.getXHR();s.open("POST",e,!0),s.responseType="text",s.onreadystatechange=function(){4===s.readyState&&(200===s.status?r(s.responseText):n&&n(s))},s.send(i)}},createAtlasFromCanvas:function(t,e,i){var r=t.assets.find(e);if(r){var n=h.BaseTextureCache[e];if(n&&n.source==i)return n.dirty(),r;r.unload(t)}var a=t.assets._cache;h.BaseTextureCache[e]=new h.BaseTexture(i),h.TextureCache[e]=new h.Texture(h.BaseTextureCache[e]),a._images[e]={url:e,data:i},a._images[e].frameData=new o.FrameData,a._images[e].frame=new o.Frame(0,0,0,i.width,i.height,"",""),a._images[e].frameData.addFrame(new o.Frame(0,0,0,i.width,i.height,null,t.math.uuid()));r=new s.Atlas(e,e,a._images[e],{});return r.json={},r.img=i,t.assets.cache(e,e,r),r},wxRemoveUnusedAssets:function(e){if(t.__wx&&"function"!=typeof wx.getSharedCanvas){var i=e.storage.get("assetsMd5")||{},r=wx.getFileSystemManager(),n=wx.env.USER_DATA_PATH+"/Assets",a=function(t){try{for(var s=r.readdirSync(t),o=0;o<s.length;o++){var h=s[o],l=t+"/"+h;try{var u=r.statSync(l);if(u.isDirectory())a(l);else{var c=l.replace(n+"/","");i[c]||(e.log.trace("本地文件({0})不在md5列表中，删除之！",c),r.unlink({filePath:l}))}}catch(t){e.log.important("wxRemoveUnusedAssets statSync({0}) 出错：{1}",l,t)}}}catch(i){return void e.log.important("wxRemoveUnusedAssets readdirSync({0}) 出错：{1}",t,i)}};a(n)}},wxCleanLocalFiles:function(e,i,r,n){if(t.__wx&&"function"!=typeof wx.getSharedCanvas){var a=e.storage.get("localFiles")||{},o=[];for(var h in a){var l={key:h,time:a[h].time};s.Util.insertSortedList(o,l,function(t,e){return t.time<e.time},!0)}for(var u=wx.getFileSystemManager(),c=0,p=20971520,d=0;d<o.length&&!(c>=p);d++){h=o[d].key;try{var f=wx.env.USER_DATA_PATH+"/Assets/"+h,_=u.statSync(f);c+=_.size,u.unlinkSync(f)}catch(t){e.log.important("wxCleanLocalFiles statSync({0}) 出错：{1}",f,t)}}n||i&&r&&s.AssetUtil.wxWriteFile(e,i,r,!0)}},wxAssureDirectory:function(e,i){if(t.__wx&&"function"!=typeof wx.getSharedCanvas){var r=wx.getFileSystemManager(),n="",a=[wx.env.USER_DATA_PATH];a=a.concat(i.split("/"));for(var s=0;s<a.length-1;s++){n=0===s?a[0]:n+"/"+a[s];try{r.accessSync(n)}catch(t){try{r.mkdirSync(n)}catch(t){e.log.trace("创建目录{0}失败：{1}",n,JSON.stringify(t))}}}}},wxWriteFile:function(e,i,r,n,a){if(t.__wx){g.wxAssureDirectory(e,i);var s=wx.getFileSystemManager(),o=wx.env.USER_DATA_PATH+"/"+i;s.writeFile({filePath:o,data:r,encoding:"utf8",success:function(){e.log.trace("资源({0})写入本地文件",i),a&&a.apply(null,[i])},fail:function(t){e.log.important("资源({0})写入本地文件{1}失败：{2}",i,o,t.errMsg),s.unlink({filePath:o}),g.wxCleanLocalFiles(e,i,r,n)}})}},wxSaveAsset:function(e,i,r){if(t.__wx&&"function"!=typeof wx.getSharedCanvas){var n=e.storage.get("localFiles")||{},a=e.storage.get("assetsMd5")||{},s=i.replace("Assets/","");if(a[s]){var o=n[s];if(o){if(o.md5==a[s])return e.log.important("文件({0})md5一致，不缓存。",i),o.time=e.time.now,void e.storage.delaySet("localFiles",n,1e4)}else o={};o.md5=a[s],o.time=e.time.now,n[s]=o,e.storage.delaySet("localFiles",n,1e4),g.wxWriteFile(e,i,r)}else e.log.important("文件({0})不在md5列表中，不缓存。",i)}},wxReadAsset:function(e,i){if(t.__wx&&"function"!=typeof wx.getSharedCanvas){var r=i.url,n=e.storage.get("localFiles")||{},a=e.storage.get("assetsMd5")||{},s=r.replace("Assets/",""),o=function(t){var n=wx.getFileSystemManager();try{if(i.isSound){n.accessSync(t);var a=new Audio;a.name=r;var s=function(){a.removeEventListener("canplaythrough",s,!1),a.removeEventListener("stalled",o,!1),a.onerror=null};a.onerror=function(){a.removeEventListener("canplaythrough",s,!1),a.removeEventListener("stalled",o,!1),a.onerror=null;var t=e.assets.find(r);t&&t.unload(e)};var o=function(){a.removeEventListener("canplaythrough",s,!1),a.removeEventListener("stalled",o,!1),a.onerror=null;var t=e.assets.find(r);t&&t.unload(e)};return a.preload="auto",a.src=t,a.addEventListener("canplaythrough",s,!1),a.addEventListener("stalled",o,!1),i.data=a,e.assets._cache.addSound(r,r,a,!1,!0),a}return a=n.readFileSync(t,"utf8"),i.data=a,a}catch(t){}},h=o(r);if(h)return e.log.trace("Asset {0} load from package.",r),h;if(a[s]){var l=n[s];if(l&&l.md5==a[s]){var u=wx.env.USER_DATA_PATH+"/"+r;h=o(u);if(h)return e.log.trace("Asset {0} load from local filesystem.",r),l.time=e.time.now,n[s]=l,e.storage.delaySet("localFiles",n,1e4),h;delete n[s],e.storage.delaySet("localFiles",n,1e4);var c=wx.getFileSystemManager();c.unlink({filePath:u})}}else e.log.important("文件({0})不在md5列表中，不尝试读取本地资源。",r)}},updateWxResMd5:function(t,e,i,r){g.get(e,function(n){try{var a=JSON.parse(n);t.log.trace("Download dislist success: {0}",n);var s=t.storage.get("version")||"",o=t.storage.get("assetsMd5");if(s==a.version&&o)return t.log.trace("资源版本一致。"),void("function"==typeof r&&r.apply(null,[a]));g.get(i,function(e){var n={};try{n=JSON.parse(e),t.log.trace("下载 md5List 成功。"),t.storage.set("assetsMd5",n),t.storage.set("version",a.version),g.wxRemoveUnusedAssets(t),"function"==typeof r&&r.apply(null,[a])}catch(e){t.log.error("parse md5List({0}) fail.",i),"function"==typeof r&&r.apply(null,[])}},function(){t.log.error("download md5List({0}) fail.",i),"function"==typeof r&&r.apply(null,[])})}catch(i){return t.log.error("parse dislist({0}) fail.",e),void("function"==typeof r&&r.apply(null,[]))}},function(){t.log.error("download dislist({0}) fail.",e),"function"==typeof r&&r.apply(null,[])})}},m=s.Assets=function(e,i,r){this._loader=i,this._cache=r,this.game=e,i._qc=this,r._qc=this,this._uuid2UrlConf=t.urlMapConfig||{},this._uuid2UrlConf.__builtin_resource__="__builtin_resource__",this.assetCountMap=t.assetCountMap||{},this.batchTotalCount=0,this.batchCurCount=0,this.batchLoadFlag=!1,this.inBatchLoadFlag=!1,this.maxRetryTimes=1,this.webFontLoaded=new s.Signal,this._parsing=0,this._loaderTimerMutex=-1024,this._assets={},this._keyUrl={},this._complete={};var n=this;i.onFileComplete.add(function(t,e,i){if(!i){var r=n._complete[e];if(!r||0===r.length)return;return r[0].retry>=n.maxRetryTimes?(n.game.log.important("Asset({0}) load fail",e),void n._callCb(e,null,r[0])):void n.game.timer.add(1e3,function(){n.game.log.trace("Retry download:{0}",e),r[0].retry++,n._internalLoad(r[0])})}n._parseAsset(e)}),e.sound.phaser.onSoundDecode.add(function(t,i){var r=n.game.phaser.cache.getSound(t);if(r&&r.decoded){var a=e.assets.find(t);if(!a){a=new s.SoundAsset(t,t,r,{uuid:t,type:g.ASSET_SOUND});e.assets.cache(t,t,a)}}i&&i.nextStep&&i.nextStep()}),this._loadBuiltin()};m.prototype={},m.prototype.constructor=m,m.IMAGE=1,m.AUDIO=2,m.TEXT=3,m.BITMAPFONT=4,m.BINARY=5,m.ATLAS=6,m.JSON=7,e.defineProperties(m.prototype,{isLoading:{get:function(){return this._loader.isLoading}},hasLoaded:{get:function(){return this._loader.hasLoaded}},baseURL:{get:function(){return this._loader.baseURL},set:function(t){this._loader.baseURL=t}},parsing:{get:function(){return this._parsing>0}},loaded:{get:function(){return this.batchCurCount?this.batchCurCount:this._loader._loadedFileCount}},total:{get:function(){return this.batchTotalCount?this.batchTotalCount:this._loader._totalFileCount}}}),m.prototype.loadBatch=(_=function(t,e,i,r){t.inBatchLoadFlag=!0,e.loaded=!1,t.load(e.key,e.url,function(n,a){n&&(e.loaded=!0),e.asset=n,e.dependenceAsset=a,e.callback&&e.callback(e);for(var s=0;s<i.length;s++)if(!i[s].loaded)return;t.inBatchLoadFlag=!1,r(i)},e.override,e.isRaw)},function(t,e){this.beginBatchLoad();for(var i=0;i<t.length;i++)_(this,t[i],t,e);this.endBatchLoad()}),m.prototype._internalLoad=function(e){var i=this;e.retry||(e.retry=0),e.isSound=g.isSound(e.url),e.isSound&&(e.url=i.game.sound.tryGetUrl(e.url));var r=e.url;if(!e.override){var n=i.find(r);if(n&&(!n.hasUnloadedDependence||!n.hasUnloadedDependence(this.game)))return i._keyUrl[e.key]=r,"__builtin_resource__"!==e.key&&i.batchTotalCount&&i.batchCurCount<i.batchTotalCount&&(e.inPrefab||(i.batchCurCount+=1,i.game.log.trace("Asset {0} load from cache: {1} / {2}",r,i.batchCurCount,i.batchTotalCount))),void(e.callback&&e.callback(n))}if("__builtin_resource__"!==e.key){t.assetDataMap&&t.assetDataMap[r]&&(e.data=t.assetDataMap[r]),t.__wx&&g.wxReadAsset(i.game,e);var a=i._loader;0===e.retry&&(i._complete[r]?i._complete[r].push(e):i._complete[r]=[e]),e.data?a.onFileComplete.dispatch(0,r,!0):(i.game.log.trace("Asset {0} ready to download from network.",r),e.isSound?r.indexOf(".bin")<0?a.audio(r,r):g.isSound(r)&&a.binary(r,r):e.isRaw?a.image(r,r):a.text(r,r),i.start())}},m.prototype.load=function(){var t,e,i,r=this,n=!1,a=!1,s=!1;if(1===arguments.length?e=arguments[0]:2===arguments.length?"string"==typeof arguments[1]?(t=arguments[0],e=arguments[1]):(e=arguments[0],i=arguments[1]):(t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],a=arguments[4],s=arguments[5]),t=t||e,!e)throw new Error("url is empty.");var o={key:t,url:e,callback:i,override:n,isRaw:a,inPrefab:s};if(r.batchLoadFlag&&"__builtin_resource__"!==t){var h=r.assetCountMap[e]||1;r.batchTotalCount+=h}else r.batchLoadFlag||"__builtin_resource__"===t||r.batchTotalCount&&r.batchCurCount>=r.batchTotalCount&&(r.batchTotalCount=r.batchCurCount=0);r.game.phaser.state._created?r.game.timer.add(1,function(){r._internalLoad(o)}):r._internalLoad(o)},m.prototype.beginBatchLoad=function(){this.batchLoadFlag=!0,this.batchTotalCount=0,this.batchCurCount=0},m.prototype.endBatchLoad=function(){this.batchLoadFlag=!1},m.prototype.loadByUUID=function(t,e,i,r){var n=this,a=this._uuid2UrlConf[t];if(!a)return this.game.log.important("UUID({0}) not found.",t),n.batchTotalCount&&n.batchCurCount<n.batchTotalCount&&(r||(n.batchCurCount+=1,n.game.log.trace("Asset {0} load failed: {1} / {2}",t,n.batchCurCount,n.batchTotalCount))),void(e&&e());this.load(t,a,e,i,!1,r)},m.prototype.loadTexture=function(){var t,e,i,r,n=this;if(1===arguments.length?"string"==typeof arguments[0]?e=arguments[0]:i=arguments[0]:2===arguments.length?"string"==typeof arguments[0]&&"function"==typeof arguments[1]?(e=arguments[0],r=arguments[1]):"function"==typeof arguments[1]?(i=arguments[0],r=arguments[1]):(t=arguments[0],e=arguments[1]):"string"==typeof arguments[1]?(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],i=arguments[1],r=arguments[2]),t=t||e,i){if(!t)throw new Error("key cannot be null.");n._keyUrl[t]=t;var a=g.addAtlasFromImage(n.game,t,t,i);n.batchTotalCount&&n.batchCurCount<n.batchTotalCount&&(n.batchCurCount+=1,n.game.log.trace("Asset {0} loaded: {1} / {2}",t,n.batchCurCount,n.batchTotalCount)),r(a)}else n.load(t,e,r,!1,!0)},m.prototype.find=function(t){if(g.isSound(t)&&(t=this.game.sound.tryGetUrl(t)),!s.Util.isArray(t)){var e=this._keyUrl[t];return e?this._assets[e]:null}for(var i=0;i<t.length;i++){var r=this.find(t[i]);if(r)return r}},m.prototype.unload=function(t){if("string"==typeof t&&!this._keyUrl[t]){var e=g.isSound(t);e&&(t=this.game.sound.tryGetUrl(t))}if(s.Util.isArray(t))for(var i=0;i<t.length;i++)this.unload(t[i]);else if("string"==typeof t){var r=this._keyUrl[t];r&&(this._assets[r]&&this._assets[r].unload&&this._assets[r].unload(this.game),delete this._assets[r],delete this._keyUrl[t])}else this.unload(t.url)},m.prototype.findByUUID=function(t){for(var e in this._assets){var i=this._assets[e];if(i.uuid===t)return i}},m.prototype.cache=function(t,e,i){t=t||e,this._assets[e]=i,this._keyUrl[t]=e,this._keyUrl[e]=e},m.prototype.clear=function(){var t=this,i=e.keys(h.TextureCache);i.forEach(function(t){"__default"!==t&&"__missing"!==t&&"__builtin_resource__"!==t&&(h.TextureCache[t].destroy(),delete h.TextureCache[t])}),i=e.keys(h.BaseTextureCache),i.forEach(function(t){"__default"!==t&&"__missing"!==t&&"__builtin_resource__"!==t&&delete h.BaseTextureCache[t]});var r=t._cache._images.__builtin_resource__;t._cache.destroy(),t._cache._images.__builtin_resource__=r,i=e.keys(t._keyUrl),i.forEach(function(e){"__builtin_resource__"!==e&&delete t._keyUrl[e]}),i=e.keys(t._assets),i.forEach(function(e){"__builtin_resource__"!==e&&(t._assets[e]&&t._assets[e].unload&&t._assets[e].unload(t.game),delete t._assets[e])})},m.prototype.start=function(){var t=this;t.game.time.fixedTime-t._loaderTimerMutex<1||(t._loaderTimerMutex=t.game.time.fixedTime,t.game.timer.add(1,function(){t._loaderTimerMutex=-1024,t._loader.start()}))},m.prototype.addUrlConf=function(t,e){this._uuid2UrlConf[t]=e},m.prototype._parseAsset=function(e){var i=this,r=i._complete[e];if(r&&0!=r.length){var n=function(e){i=i;var r=this.key,n=i._uuid2UrlConf[r],a=i._complete[n];a?(a[0].loadCnt--,0==a[0].loadCnt&&(t.printingloading&&console.log("依赖资源加载完成:"+n),i._parseAsset(n))):console.warn("error url:"+n)},a=function(e,r){i._parsing--;e=e;for(var a=0;a<r.length;a++){var s=r[a];t.printingloading&&console.log("loadDependenceRaw:"+e+" "+s);var o=s.indexOf(".png")>-1||s.indexOf(".jpg")>-1;i.load(e,s,n,!1,o,!0)}},o=function(){i._parsing--;var t=i.find(e)
;if(t&&(t.meta.type!==g.ASSET_SCENE||i.inBatchLoadFlag)&&t.hasUnloadedDependence&&t.hasUnloadedDependence(i.game))for(var n in t.dependences){var a=t.dependences[n],s=function(n){n=n;return function(a,s,o){if(!a&&!s){i.game.log.important("预制的依赖资源({0})加载失败.",n.uuid);var h=t.dependences[n.uuid];h&&(h.ok=!0)}if(i.inBatchLoadFlag&&!o){var l=i._complete[e];l&&l[0]&&l[0].callback&&l[0].callback(null,a,!0)}t.hasUnloadedDependence(i.game)||i._callCb(e,t,r[0])}},o=!0;i.inBatchLoadFlag&&(o=!1),i.loadByUUID(a.uuid,s(a),!1,o)}else i._callCb(e,t,r[0])};i.nextStep=o,i.loadDependenceRaw=a,i._parsing++;try{g.parse(this.game,r[0],o,a)}catch(t){i._parsing--,i.game.log.error("Asset({0}) Parse fail",e,t),s.Util.popupError(t.message),i._callCb(e,null,r[0])}}},m.prototype._callCb=function(t,e,i){var r=this,n=r._complete[t];n&&(delete r._complete[t],n.forEach(function(i){e&&(r._keyUrl[i.key]=i.url),r.game.loadingProcessCallback&&(i.inPrefab||r.game.loadingProcessCallback(t,e,i)),r.batchTotalCount&&r.batchCurCount<r.batchTotalCount&&(i.inPrefab||(r.batchCurCount+=1,e?r.game.log.trace("Asset {0} loaded: {1} / {2}",t,r.batchCurCount,r.batchTotalCount):r.game.log.trace("Asset {0} load failed: {1} / {2}",t,r.batchCurCount,r.batchTotalCount))),i.callback&&i.callback(e)}))},m.prototype._loadBuiltin=function(){var t=this,e="__builtin_resource__",r="iVBORw0KGgoAAAANSUhEUgAAAIAAAABACAYAAADS1n9/AAAURElEQVR4Xu1cCVRUR9au1w2NrL8LAoIoEFBJ0w8QIioJRBRB1BE1qCCLBCUaEyMBo6AnYlSYqIjGOaNxieKekBicIKIoZnFQiUjTiKgoIAoBo8ggi2z95tyXLv62pbtfb7Q61DkegXer6ta9X92qunVvEUiFQpLkSDabPUFfX5+HELJqbGy0pijqoYmJyROhUHitra2ttKOjI6ekpKRdhW5eqEpRFIEQGokQMlSx3WaE0C2CICim7URERERdu3ZtfF1dnUlTUxPTajSdkZERMjc3bxw9enReWlraPqaVeTzeBQ6H83ZHR4cOi8VCHA6HaVWUn58PspJaZH6U10sfAF5+AIAOZYFAYQC4uLi4GBgYLGltbQ1yc3Mb4Ofnh7hcLiIIAo0aNYrGzM2bNxFFUejKlSvo7NmzHaWlpVcJgthlb29/JD09vUsesOR937x5c3Z2drZfeXk5evLkiTzyHr8PGDAA2dnZIX9//zMrVqzwl9dIXFycz9GjRzdyOBz9hIQEWzs7O30Oh0PAOJkUkE97eztVXl7empSUVNHe3t4aEhKyesuWLbnS6ru6unoJhcKzlpaWeqGhoSgkJIRJVy/QENC5lMIYACRJ2hobG39tb2/vu2TJEuTh4aEQM7m5uSg1NfXhgwcPPuLz+ekKVRYRx8bGzjpy5MjxpqYm3bCwMDR9+nRka2uLwCyCIuQpA+QA/4RCIaqoqEA//fQTOnToEJjmjpCQEK+tW7de7omvNWvWOKSkpBxZt26dmZ+f3xCEEAf6VKZA3wih9jNnzvyxdu3ah7GxsfM3bNhQJtnWmDFjRrS3t99cu3YtERgYqExX3XVUBsDEiRO36+rqfrR48WLWjBkzVGLmwIED6JtvvrldX1/vW1JSUsW0sYSEBDI1NZUfFRVFzJ07F5mZmdGKh3+SAJcEQk/fQRHw7+HDh+jbb79F+/bto2JiYqySkpL+kOTJxsbmzOzZs4eHh4fbcTgcXfxdHuAk2xHno729vePgwYPlP/zww73Kyko/SVoej/d4xowZAxMTE1FHRwc9TswzU5lhOkNDQ+UsAJfLNTI1NT3v7e09BhgRHwAMvqur6zmmROimmYWCFcRms1+oGxkZ2czn86cXFRVdYDIge3v7/4wbN85kw4YNNLmuri6CdiXbFm8L+O1JSZh34B+EC2XNmjXo0qVLjXfu3Pk/sTa+gp8DAgJ8N2/eDBtcQ2VnvuQYQVYEQTSvWLHiflZW1gHR9y/d3d3pGfbGG29k7N+/n/6zokCT7EspAHC5XIv+/ftfmzlz5pDY2NjuNkFonZ2dtPIVKaAoHR0dWmG4xMbGCnNzcz/g8/l7ZbSVBt8sLS3DL1++TLcBu2A9PT26LawQGcvcc01jYYICYAxtbW2wNtNjGjt2LKqpqfm7qEI8Qugq/Hzjxg03aWBSRAY9WQTg58033ywQfXN3dnb+N/ycl5f3iCCIaTCPeh0AXC6XM2TIkBsBAQFvxMTEdKMQhIVnubIDB4WB8rDC4uLiqPPnz8/i8/kZUtqkd1lbt25F8+fPR/369XtO+XhdV4QfvF8QB8GzZ8/QkSNH0KeffoqbArNJA6C0tNSFoqj/R64incmhJQiiy9HRkY8BwOPxauDny5cv1xEE4aIVC+Dn55c1fvz4KZ9//jnNF54hahx390yGNhcsWNBRWFjIEwgEt3rogwbA1atX0ciRI1+Y+aryJA6CW7duIXd39xcAcPPmTRehUKgRALBYrK5Ro0aJA+ChCAA1BEE4Y2ZUsQIKLQF+fn7LjY2NU7/77jt6lsKsV9TcM1UKmHCwBjC4CRMmlJuZmY3o4ZhIA+Dx48fI2Nj4ObPPtB95dBgET58+RYMGDdIqAEiSvCECwFqE0He9CgAulzvQ2tq6ZtmyZXpTpkxBYBZVNfnyhA9LAph12Ilv3rw5rqCgIEWiDg0AUI6+vn6Pu355fcj7DgCEcba2ttIgE5XuJaA3LYCbm9sqUf/JFy9e7N4A9ooFIElyu7e397KvvvpKI2ZfmiLwxm7mzJlPy8rKTCVcxzQAWlpaaGuhrl24JC8AALB2BgYGWgUA7pwkybbY2FjOnDlzVJ6EjJaAcePG6ffv379h3bp1nNGjR9PC6M0Cyv3tt99QTExMNJ/P3yPWNw0AsEZw9NMkAOBICNZImxYAd/7WW29FdnR0fLNr1y7k7OzMyNElTV+MAODt7R2MEDr6888/06ZQFZOjDHBgvwEm3sPDoyQ/P99JEgAASAAA0+OeojzAeAEAAMSXAQDAg4uLy0aKolZ5enqyVq1ahQYPHqyUXgwMDOQ7gsLCwi7Y29u/Gx8f3+0cUVSIqtCDYmEpWLp0KZWXl2cKbZWUlNSDHwR+hpMIAECTBQAgdtOmlT2A5Pi8vLysnzx5UkAQxGCQD3hAxUDKSBwnT56UD4DZs2c3RkZGGk+cOFHlNYcRVz0QgXnPzMxEGzduBAcI4vP5pzAAwFEj7kRStg9Z9eC0A0J+WSwA8KEqAGQpH9onYOcPP1haWj5OTU0FF6RWAXD37l0UHh6+CXi6du3aSgwAmJ1iytGE/mlvoJiV0YojSCMDk9Eo4ezsPAa+6+joXMnOzkaGhoZKrTPqYByWgebmZuTr63taZAECMABgdmpqA4h5h5OAmJXpBsDt27dHd3V1Mb76ZSoLGC+bzaZGjBhxTVSH9kJRKm7AZN3+SfJGODk5+Yr+eBZ87fhqlekg1EmH/e1jx469BO0WFxePfxkAkJGRYWdjY2PSr18/trr8IiDnZ8+edVVWVjYGBgaWYwCoqvzu9YvhbplwcXGZCpU6OzszXyIAFIoAMBoDAK6R582bp/AGiClA4ZRx/PhxcEt3y/CDDz7wgl+ysrL+8eOPP9oaGhoaqTg5u9kRWbummTNnVgQEBHwEH77++utfex0APB7PGzrncDg/v0RLwK+iJcDbx8fnB/j54sWLsxobGzUKABMTE/T222+fgP5yc3NnY21ZWVldWLhw4fDAwMBhYAVEZpoptp6jwxMTZn9GRkbV3r1771VXV0/ARL0OAFdX1zehc3Nz85JNmzYhBwcHrW4Cy8rKUFRU1HHg6ffffwffBF2GDRv2dNKkSUY7d+6k+RNz2CilCFwJHExgjiHK6dy5c01VVVXdvmBMs3LlyvG7du3aFh8fb+7r62uhq6vLYWhhX+BN5G9oz8nJqU1OTq5bvHjx8i+//DJPawCAq1/onCTJZ/PmzSMmT56sNQDABgys0Pr16+OAJ/F7AYjb271796ng4GAWxCfY29urpHhc+c6dOyglJQUdO3ZMGB0dPRXiDXtqGMcEGhgYGMbHx9vY2trqw6mE6Z4AQAanjIqKitbk5OTKlpaW5p5iAnvdAuDBfvjhh9WDBg2yXL16NT0oda11TLUEMwqEBB6vCxcu0AGHRUVF+eL1RTGBx5qbmzkQjArX1TweRKQrXoqLi9EXX3yBzpw5Ayef9vnz5wenpKTQ5l9aiY6O1m1ra4u8evWq559//mmgTFj44MGDW9zd3f+tp6e3f/fu3X+FI4kVrQHg/fff33v37t2onJwcGqnaAADMKG9v72dDhw41Apn0FEGcmJjIqa6uTrx3715kS0uLBVwSKVPg0sfAwKB2+PDh+62srBITExPl5i681gDg8Xhu9vb2V5cvX05H/GoqBkCassD85+fngwX4V15entTIU20CQBmgKVpHaxYAGOVyuVXvvvuuNYRfAQB6ywqIHCIoOjoavH/uxcXFOEZOUfm9MvQ8Hi+SIIi5XV1dfxO//tYqAHx8fIIHDRp0FBIQICCkt6wAzP7Tp0+jbdu2CX755ZfuMChp2oyIiFhTWFjoX1dXN1CZddjc3Lze1dU1Oy0t7a8QYy0UcQBA9xgEWgUAMBITE3OzpqZmJDheoDDd5SorQ+zenTt3LlVVVTWaz+fj+DipTb7qAODxeIcIgggVDXAp/C8QCP4J/2sdAOAX8PT0FJiamrLhaljZZAQmgMB5A+vXr4c0sn05OTkLZdWDU8Dhw4ePNjc368EpYOPGjXSgqCIFAj/hpCPa/beFhoaGyNv9K9K+PFqSJJchhLaL0dHZSAKBYNxLAQBgIiQkJBwhlObi4oI++eQTjYAAK3/79u1w9r9dV1fHk5VFLMoMKoyKimIBMC0tLeXJWub3mpoalJycDBlBwpiYGNekpCSBSg0yqMzj8bwIgoBEGPG8MvqoKxAI6KOv1i0AHseCBQtSqqurP4WZ9vHHH6sVBFj5O3bsQCdOnHjc2trqWFhY+KcsGdrY2PzxzjvvWBw8eJCBqJmThIeHQyhabWVlJeT8aaw4OTmZs1isSoRQd8wZQqitq6uLRrIo+OXlAQAwFRwcvImiqBWQ9bty5cruxEplTwfY2QP1k5KSIPulvLa21rOkpKRWhuTpiCCY8dXV1TQZDt9SZnnC4BMPL7OysoKMIMwC44RZRdBCkiTkHFqI1yEIYnZRUdFzzqeXxgJgRidPnjzfwcHhwKNHj3TgNi4gIOA5T6E8MGCfOVZ+VlYWOnz4MGpqajrd2Ng4+9KlS61yBEkDAOpAZhBO51JE+NJocXoZZARB+rWoqB0AJEleRAh5ivNBUdSPxcXFsyR5e+kAAAzCxtDLy+tIRUWFi7W1NX0tO2bMmBdi1jEYxJUO9eF3cPIcPXoU3b59u5kgiBXnzp3byVCJNADu378PF1Zqj1cES1BXV4dgXJoAAEmS2xBCn0iM9ZFAIBgsbfyqgkChgBCGSqDJxo4dO8nDw2P/vXv3htbX1yMfHx96Fw5LBJhWR0dHmq60tJS2EvBQBOy6z58/D27XdhaLldrQ0LCOwax/brLALzhDSZ7FUWQ8GJw4Q0kaAMBLShCEp0Ag+AecjJn24ezsHEpR1CEJeqFQKHS9fv26xjedTPhUytzB0zCenp5LdXV1ZzQ0NAyDtC1QOMTzwWyHlzfgd1NT02YdHZ3fqqqqdpqamp5S8nWQ7qhgTdxR4GhkiWhgWnb4ppTNZuMkCbgpfE8gEMDbQjKLk5MTyWKxINRLMqdwnUAgSJRVOSgiZAmiqOUIdfqmH0zv8Q2FoPDgZITQVETpzEg/dKhCHj/SvisFAMnGnJ2drYRCoQVFUQMJgoBQ7vZiuG5TT9EaAHg8HgSlAqhxyjj8ms9ms6fJOrXAuwpsNhs2tpKPWAkEAoFMTyetfCgKAADIlQVBHwBE+Qg9WQAej0c/ekQQBNxNdOeMIYRgxk0UCAQ9zjySJO8ihOwk8E8f+fBxT9rcCAoPpsPhIC8EIaIKoY53JK1AUETwBkSh1YhAN3TakQ8QHzt2rE6Z+aYWACjTsQJ1tGYBMI9OTk7WLBarBCEkHi1Uz2Kx/Pl8/u/iY+HxeJkEQdBxluKlpyNfTzIICgqir8KRvk4mQshbEgRBEcHrEIUgb78AsTunpO9Pl+k/kSfnHgFQW1trePDgwdgrV65MKykpcYSNl6IhULgOl8st9fDwyAwPD0+xsLCQu3b2wLDWAQA8iRw5pQihAWI8thIEMaeoqAiUBVFVsLZDWvdzRdqRT5ZygoKCOEhf5wjsOTAIEKETJVL+JdSvc0r67vT/yFOwvO99AJCxBEgKD5Jo2Gw2PGJBp66JShdFUR+yWKwGiqIgllFSpjKPfPIUFBQ+bwdCBEQNg7Lh/aJc1No5Iz09XbFHCqV09AIA0tLSQrds2bIjLCysv5OTE72jlzb75b2bA1YA3vK7fv06PMfWEBcX93FERMRheYOWnEDwO36rQBPHQPxGgahfmcuiaIMHIJC8jIBHkyR3/Go58gWFBcN6D+t+NnrWOSs9PV2e84yxiJ8b7KJFizKNjIyeBAYGhlpYWKiUkow5wG/41NbWooyMjMNNTU0D9uzZQ+f+MSz0EgD3/ppIWgH+4MgKz7gyAQDQwPFQZAls5IxB7pGPoQzQnPCQSVRrx6/p6elyQ9eYtgl03QDYtGnT5w8fPrRbtGhRBH5ESV2zDYMA/t+zZ0+amZlZ+WefffYFQ0ZpAED0Lvjs1R2fAKCCOwaxKGNGG2MRCCB24S/v14tF7pGP4fhpMo0BoKyszAQ6mDZtWvX3339vBK5RdQsZDxSEDUme7733XlNmZqYV/N3BwaFRjiBoAODMIHVGLOP7CcmMIEUUQ5JkEez/JOowOvIp0o+maAmY+aLG18EroOoUsCTTWOAnT56ET/RuWZ4liIqKmg50hw4d+hdkBuH3fNQhEPzKKGQEhYWF/Q3a3Ldv30+Ktk2SJOQyjsX1mB75FO1HE/TE1KlTaY9dTEyM09ChQzU2+8WtwIMHD+Dd4Ovwt1OnTjEK7Le0tHzi7+/fH2cG4WVKGaHgJQlnBGVnZzfU1NSIH+8UbpYkyRyE0CRljnwKd6bGCoSbmxvtQdq7d68ZpFupa92XxiMIH3b0CxcupN/DKygoMGcyHsnMILi9UwYEWPlwu8gkI4gJb5jG2dn570VFRfiVL0Wqao2WcHV1pT1JBw4cMAV3aG8AAJ57WbBgwSPot7CwUOq1qKRUcExgS0sLHRMImUH4iXqmEoQbSpwRZGBgoNaYwFcSAK/KEoAVDIkh5eXlCQUFBVMePXpkrExYuKmp6VM3N7fTdnZ2SUwygpiC61WkI5KSkjYC43p6egnTpk3TeC4A3L3DO0BtbW1J0G9CQsJqRQTXBwBFpCWflqioqOgPZP7+/vdPnDgB15ga2wjCpgtCumbNmtWUnZ1Nh+DY2to2yGezj0JTEuh2eoAlqK+vt+oNR9DAgQOrFZ35mhLA/3q7r4Ir+H9dRxodv8zLIJIk6csgVQpcBgkEAlUug1Tpvq+uHAnIvA7Oy8sLLC0tdVBFio6OjmXjx4/PUCEeQJXu++r2AaAPA7IkwOjmq0+Er68E+gDw+uqW0cj6AMBITK8vUR8AXl/dMhpZHwAYien1JeoDwOurW0Yj+y97o2/XSZsB1wAAAABJRU5ErkJggg==",n={ver:1,uuid:e,padding:{"button.png":[10,9,10,9],"button2.png":[10,9,10,9],"slider.png":[12,10,12,10],"sliderbg.png":[13,7,13,7],"sliderbg2.png":[14,0,0,0]}},a=JSON.parse('{"frames":{"circle.png":{"frame":{"x":1,"y":1,"w":37,"h":37},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":37},"sourceSize":{"w":37,"h":37}},"sliderbg.png":{"frame":{"x":1,"y":41,"w":30,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":30,"h":16},"sourceSize":{"w":30,"h":16}},"slider.png":{"frame":{"x":41,"y":1,"w":28,"h":24},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":28,"h":24},"sourceSize":{"w":28,"h":24}},"button.png":{"frame":{"x":41,"y":28,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"button2.png":{"frame":{"x":72,"y":1,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"ok.png":{"frame":{"x":72,"y":27,"w":25,"h":22},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":25,"h":22},"sourceSize":{"w":25,"h":22}},"sliderbg2.png":{"frame":{"x":101,"y":1,"w":19,"h":14},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":19,"h":14},"sourceSize":{"w":19,"h":14}},"empty.png":{"frame":{"x":101,"y":18,"w":16,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":16,"h":16},"sourceSize":{"w":16,"h":16}},"arrow.png":{"frame":{"x":101,"y":37,"w":12,"h":7},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":12,"h":7},"sourceSize":{"w":12,"h":7}}},"meta":{"app":"QCEngine","version":"1.0","image":"__builtin_resource__","format":"RGBA8888","size":{"w":128,"h":64},"scale":"1"}}');t._parsing++,g._parseAtlas(this.game,n,a,r,i,n.uuid,e,function(){t._parsing--,t._callCb(e,t.find(e))})};var y=s.Atlas=function(t,e,r,n,a){this.key=e,this.url=e,this.meta=n,this.animation=i,this.json=i,this.img=i,this._data=r,a&&(this.animation={type:n.animationType,data:a})};y.prototype.constructor=y,e.defineProperties(y.prototype,{count:{get:function(){return this._data.frameData.total}},frames:{get:function(){return this._data.frameData._frames}},frameNames:{get:function(){var t=this.frames;if(!t||t.length<1)return[0];var e=[];for(var i in t)e.push(t[i].name);return e}},uuid:{get:function(){return this.meta.uuid}},class:{get:function(){return"qc.Atlas"}}}),y.prototype.getFrame=function(t){return"number"==typeof t?this._data.frameData.getFrame(t):this._data.frameData.getFrameByName(t)},y.prototype.getTexture=function(t){return new s.Texture(this,t)},y.prototype.getPadding=function(t){if(!this.meta||!this.meta.padding)return[0,0,0,0];if(1==this.count){var r=e.keys(this.meta.padding);t=r.length>0?r[0]:0}t===i&&(t=0);var n=this.meta.padding[t];return n&&(n[0]*=1,n[1]*=1,n[2]*=1,n[3]*=1),n||[0,0,0,0]},y.prototype.unload=function(t){t.assets._cache.removeImage(this.key,!1),delete h.TextureCache[this.key],delete h.BaseTextureCache[this.key]};var v=s.Texture=function(t,e){var i=this;i.atlas=t,i.frame=e||0};v.prototype.constructor=v,e.defineProperties(v.prototype,{padding:{get:function(){return this.atlas.getPadding(this.frame)}},class:{get:function(){return"qc.Texture"}}});var T=s.Prefab=function(t,e,i,r){this.key=t,this.url=e,this.meta=r,this.json=i};T.prototype.constructor=T,e.defineProperties(T.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),T.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(!i.ok&&i.uuid!==this.uuid){var r=t.assets.find(i.uuid);if(!r)return!0;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return!0;i.ok=!0}}return!1};var x=s.Font=function(t,e,i,r,n){this.key=t,this.url=e,this.meta=n,this.xml=r,this.image=i,this._fontUrl,this._fontFamily=s.UIText.SYSTEMFONT};x.prototype.constructor=x,e.defineProperties(x.prototype,{uuid:{get:function(){return this.meta.uuid}},xSpacing:{get:function(){return this.meta.xSpacing}},ySpacing:{get:function(){return this.meta.ySpacing}}}),x.prototype.unload=function(t){t.assets._cache.removeBitmapData(this.key),t.assets._cache.removeBitmapFont(this.key)};var b=s.SoundAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.sound=i};b.prototype.constructor=b,e.defineProperties(b.prototype,{uuid:{get:function(){return this.meta.uuid}}}),b.prototype.unload=function(e){t.__wx&&this.sound.destroy(),e.assets._cache.removeSound(this.key)};var A=s.TextAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.text=i};A.prototype.constructor=A,e.defineProperties(A.prototype,{uuid:{get:function(){return this.meta.uuid}}}),A.prototype.unload=function(t){t.assets._cache.removeText(this.key)};var S=s.ExcelAsset=function(t,e,i,r){this.key=e,this.url=e,this._meta=r,this._data="string"==typeof i?JSON.parse(i):i,this._sheets={},this._makeSheetData()};S.prototype.constructor=S,e.defineProperties(S.prototype,{uuid:{get:function(){return this.meta.uuid}},sheetsName:{get:function(){return this._sheets?e.keys(this._sheets):[]}},sheets:{get:function(){return this._sheets}},meta:{get:function(){return this._meta}}}),S.prototype._makeSheetData=function(){for(var t=this._data?e.keys(this._data):[],i=0;i<t.length;i++){var r=t[i],n=this._data[r].rows,a=this._data[r].cols,o=this._meta[r]&&this._meta[r].primaryKey||[],h=new s.ExcelSheet(a,n,o);this._sheets[r]=h}},S.prototype.findSheet=function(t){return this.sheets[t]},S.prototype.unload=function(t){},S._EXCEL_DATE_OFF=-22089888e5,S._TIMEZONE_OFF=60*(new Date).getTimezoneOffset()*1e3,S.parseToDate=function(t){return new Date(S._EXCEL_DATE_OFF+864e5*t+S._TIMEZONE_OFF)};var w=s.ExcelSheet=function(t,e,i){this._cols=t||[],this._rows=e||[],this._indexes={},this._primaryKey=i,this._buildPrimaryIndex()};w.prototype.constructor=w,e.defineProperties(w.prototype,{columns:{get:function(){return this._cols}},rows:{get:function(){return this._rows}}}),w.prototype._buildPrimaryIndex=function(){this.addSortIndex("primary",this._primaryKey)},w.prototype.addSortIndex=function(t){var e,i=Array.prototype.slice.call(arguments,1);return e=Array.isArray(i[0])?new s.ExcelSortSheetIndex(this,i[0]):new s.ExcelSortSheetIndex(this,i),this._indexes[t]=e,e},w.prototype.addHashIndex=function(t,e,r){var n=new s.ExcelHashSheetIndex(this,e,r===i||r);return this._indexes[t]=n,n},w.prototype.getIndex=function(t){return this._indexes[t]},w.prototype.getPrimary=function(){return this.getIndex("primary")},w.prototype.find=function(t){for(var e=this._rows,i=e.length,r=-1;++r<i;)if(t(e[r]))return r;return-1},w.prototype.findLast=function(t){for(var e=this._rows,i=e.length;i-- >0;)if(t(e[i]))return i;return-1},w.prototype.matches=function(t){for(var e=this._rows,i=e.length,r=-1,n=[];++r<i;)t(e[r])&&n.push(r);return n},w.prototype.parseColumnToData=function(t){for(var e=this._rows,i=e.length,r=-1,n=[];++r<i;)t in e[r]&&(e[r][t]=S.parseToDate(e[r][t]));return n};var P=s.ExcelSortSheetIndex=function(t,e){this.sheet=t,this._keys=e,this._buildIndex()};P.prototype={},P.prototype.constructor=P,e.defineProperties(P.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}}}),P.prototype._buildIndex=function(){var t=this,e=this.sheet.columns.slice(0);if(this._keys){for(var i=0;i<this._keys.length;i++){var r=e.indexOf(this._keys[i]);e.splice(r,1)}Array.prototype.unshift.apply(e,this._keys)}t._cols=e,t._rows=this.sheet.rows.slice(0),t._rows.sort(function(i,r){t._rowCompare(e,i,r)})},P.prototype.first=function(){var t=arguments.length;if(0===t)return 0;var e=this;return this._dichotomySearchFirst(this._rows,arguments,function(t,i){return e._searchCompare(t,i)})},P.prototype.last=function(){var t=arguments.length;if(0===t)return 0;var e=this;return this._dichotomySearchLast(this._rows,arguments,function(t,i){return e._searchCompare(t,i)})},P.prototype.matches=function(){var t=arguments.length;if(0===t)return[0,this._rows.length];var e=this,i=this._dichotomySearchFirst(this._rows,arguments,function(t,i){return e._searchCompare(t,i)});if(i<0)return null;var r=this._dichotomySearchFirst(this._rows,arguments,function(t,i){return e._searchCompare(t,i)},i);return[i,r]},P.prototype._cellCompare=function(t,e){return t?e?t===e?0:t<e?-1:1:-1:e?1:0},P.prototype._searchCompare=function(t,e){if(!e)return 1;for(var i,r=this._cols,n=t.length,a=-1;++a<n;){if(i=this._cellCompare(t[a],e[r[a]]),i>0)return 1;if(i<0)return-1}return 0},P.prototype._rowCompare=function(t,e,i,r,n){if(!t)return e?1:0;if(!e)return-1;r=r||0;for(var a,s,o=r+(n||i.length-r),h=r;h<o;h++)if(a=i[h],s=this._cellCompare(t[a],e[a]),0!==s)return s;return 0},P.prototype._dichotomySearch=function(t,e,i){for(var r=0,n=t.length-1,a=0,s=0;r<=n;)if(a=Math.floor((r+n)/2),s=i(e,t[a]),s<0)n=a-1;else{if(!(s>0))return a;r=a+1}return-1},P.prototype._dichotomySearchFirst=function(t,e,i,r,n){r=r||0,n=n||t.length-1;for(var a=0,s=0;r<n;)a=Math.floor((r+n)/2),s=i(e,t[a]),s<=0?n=a:r=a+1;return 0===i(e,t[r])?r:-1},P.prototype._dichotomySearchLast=function(t,e,i,r,n){r=r||0,n=n||t.length-1;for(var a=0,s=0;r<n;)a=Math.ceil((r+n)/2),s=i(e,t[a]),s<0?n=a-1:r=a;return 0===i(e,t[n])?r:-1};var E=s.ExcelHashSheetIndex=function(t,e,i){this._buildIndex(t,e,i)};E.prototype={},E.prototype.constructor=E,e.defineProperties(E.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}},keys:{get:function(){return this._keys}}}),E.prototype._buildIndex=function(t,e,i){var r=t.rows;this._rows=r,this._cols=t.columns.slice(0),this._keys=[];for(var n=r.length,a=-1;++a<n;){var s=r[a],o=s[e];i?(this[o]=s,this._keys.push(o)):o in this?this[o].push(s):(this[o]=[s],this._keys.push(o))}};var D=o.Loader.prototype.fileComplete;o.Loader.prototype.fileComplete=function(t,e){this.game.cache&&D.call(this,t,e)};var C=s.ActionAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.json=i};C.prototype.constructor=C,e.defineProperties(C.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),C.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(!i.ok&&i.uuid!==this.uuid){var r=t.assets.find(i.uuid);if(!r)return!0;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return!0;i.ok=!0}}return!1};var O=s.ActionManagerAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.json=i};O.prototype.constructor=O,e.defineProperties(O.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),O.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(!i.ok&&i.uuid!==this.uuid){var r=t.assets.find(i.uuid);if(!r)return!0;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return!0;i.ok=!0}}return!1};var M,I=s.Math=function(t){this.phaserMath=o.Math,this.arrayUtils=o.ArrayUtils,this.phaserRnd=t};I.prototype={},I.prototype.constructor=I,I.prototype.fuzzyEqual=function(t,e,i){return this.phaserMath.fuzzyEqual(t,e,i)},I.prototype.shuffle=function(t){return this.arrayUtils.shuffle(t)},I.prototype.fuzzyLessThan=function(t,e,i){return this.phaserMath.fuzzyLessThan(t,e,i)},I.prototype.fuzzyGreaterThan=function(t,e,i){return this.phaserMath.fuzzyGreaterThan(t,e,i)},I.prototype.fuzzyCeil=function(t,e){return this.phaserMath.fuzzyCeil(t,e)},I.prototype.fuzzyFloor=function(t,e){return this.phaserMath.fuzzyFloor(t,e)},I.prototype.average=function(){return this.phaserMath.average.apply(null,arguments)},I.prototype.shear=function(t){return this.phaserMath.shear(t)},I.prototype.snapTo=function(t,e,i){return this.phaserMath.snapTo(t,e,i)},I.prototype.snapToFloor=function(t,e,i){return this.phaserMath.snapToFloor(t,e,i)},I.prototype.snapToCeil=function(t,e,i){return this.phaserMath.snapToCeil(t,e,i)},I.prototype.roundTo=function(t,e,i){return this.phaserMath.roundTo(t,e,i)},I.prototype.floorTo=function(t,e,i){return this.phaserMath.floorTo(t,e,i)},I.prototype.ceilTo=function(t,e,i){return this.phaserMath.ceilTo(t,e,i)},I.prototype.angleBetween=function(t,e,i,r){return this.phaserMath.angleBetween(t,e,i,r)},I.prototype.angleBetweenY=function(t,e,i,r){return this.phaserMath.angleBetweenY(t,e,i,r)},I.prototype.reverseAngle=function(t){return this.phaserMath.reverseAngle(t)},I.prototype.normalizeAngle=function(t){return this.phaserMath.normalizeAngle(t)},I.prototype.maxAdd=function(t,e,i){return this.phaserMath.maxAdd(t,e,i)},I.prototype.minSub=function(t,e,i){return this.phaserMath.minSub(t,e,i)},I.prototype.wrap=function(t,e,i){return e<i?this.phaserMath.wrap(t,e,i):this.phaserMath.wrap(t,i,e)},I.prototype.wrapValue=function(t,e,i){return this.phaserMath.wrapValue(t,e,i)},I.prototype.isOdd=function(t){return!!this.phaserMath.isOdd(t)},I.prototype.isEven=function(t){return!!this.phaserMath.isEven(t)},I.prototype.min=function(){return this.phaserMath.min.apply(null,arguments)},I.prototype.max=function(){return this.phaserMath.max.apply(null,arguments)},I.prototype.wrapAngle=function(t,e){return this.phaserMath.wrapAngle(t,e)},I.prototype.linear=function(t,e,i){return this.phaserMath.linear(t,e,i)},I.prototype.factorial=function(t){return this.phaserMath.factorial(t)},I.prototype.getRandom=function(t,e,i){return o.ArrayUtils.getRandomItem(t,e,i)},I.prototype.distance=function(t,e,i,r){return this.phaserMath.distance(t,e,i,r)},I.prototype.clamp=function(t,e,i){return this.phaserMath.clamp(t,e,i)},I.prototype.within=function(t,e,i){return this.phaserMath.within(t,e,i)},I.prototype.sign=function(t){return this.phaserMath.sign(t)},I.prototype.degToRad=function(t){return this.phaserMath.degToRad(t)},I.prototype.radToDeg=function(t){return this.phaserMath.radToDeg(t)},I.prototype.random=function(t,e){return void 0===t||void 0===e?this.phaserRnd.frac():t>e?this.phaserRnd.integerInRange(e,t):this.phaserRnd.integerInRange(t,e)},I.prototype.uuid=function(){return this.phaserRnd.uuid()},I.prototype.id=(M=1,function(){return++M}),I.prototype.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],l=e[7],u=e[8],c=u*s-o*l,p=-u*a+o*h,d=l*a-s*h,f=i*c+r*p+n*d;return f?(f=1/f,t[0]=c*f,t[1]=(-u*r+n*l)*f,t[2]=(o*r-n*s)*f,t[3]=p*f,t[4]=(u*i-n*h)*f,t[5]=(-o*i+n*a)*f,t[6]=d*f,t[7]=(-l*i+r*h)*f,t[8]=(s*i-r*a)*f,t):null},I.prototype.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=i[0],d=i[1],f=i[2],_=i[3],g=i[4],m=i[5],y=i[6],v=i[7],T=i[8];return t[0]=p*r+d*s+f*l,t[1]=p*n+d*o+f*u,t[2]=p*a+d*h+f*c,t[3]=_*r+g*s+m*l,t[4]=_*n+g*o+m*u,t[5]=_*a+g*h+m*c,t[6]=y*r+v*s+T*l,t[7]=y*n+v*o+T*u,t[8]=y*a+v*h+T*c,t},I.prototype.smoothDamp=function(t,e,i,r,n,a){r=Math.max(1e-4,r);var s=2/r,o=s*a,h=1/(1+o+.48*o*o+.235*o*o*o),l=t-e,u=e,c=n*r;l=this.clamp(l,-c,c),e=t-l;var p=(i+s*l)*a;i=(i-s*p)*h;var d=e+(l+p)*h;return u-t>0&&d>u&&(d=u,i=(d-u)/a),[d,i]},s.CleanPIXISpriteRetainer=function(t,e){this._frameCount=0,this.game=t},s.CleanPIXISpriteRetainer.prototype={postRender:function(){if(this._frameCount++,!(this._frameCount<100)){this._frameCount=0;var t=this.game.phaser.renderer;if(t instanceof h.WebGLRenderer)for(var e=t.spriteBatch.sprites,i=t.spriteBatch.currentBatchSize,r=e.length,n=i;n<r;n++)e[n]=null}}},s.CleanPIXISpriteRetainer.prototype.constructor=s.CleanPIXISpriteRetainer;var R=s.NodePool=function(t){this._game=t,this._nodes={},this._nameUuidMap={}};R.prototype={},R.prototype.constructor=R,e.defineProperties(R.prototype,{game:{get:function(){return this._game}}}),R.prototype.add=function(t,e){this._nodes[t]&&this.game.log.error("uuid {0} already exists",t),this._nodes[t]=e,e.uniqueName&&!this._nameUuidMap[e.uniqueName]&&(this._nameUuidMap[e.uniqueName]=t)},R.prototype.remove=function(t){this._nodes[t]&&(this._nodes[t].uniqueName&&delete this._nameUuidMap[this._nodes[t].uniqueName],delete this._nodes[t])},R.prototype.find=function(t){if(this._nodes[t])return this._nodes[t]},R.prototype.findByName=function(t){var e=this._nameUuidMap[t];if(e)return this._nodes[e]},R.prototype.removeName=function(t){delete this._nameUuidMap[t]},R.prototype.addName=function(t,e){this._nameUuidMap[t]=e};var N=s.Behaviour=function(t){this._gameObject=t,this.cookie=0,this._events={},this.__hadUpdateOrRender=!!(this.preUpdate||this.update||this.postUpdate)};N.prototype.constructor=N,s._userScripts={};var B=s.defineBehaviour=function(i,r,n,o){for(var h=i.split("."),l=t,u=0;u<h.length-1;u++)l[h[u]]||(l[h[u]]={}),l=l[h[u]];var c=h[h.length-1];return r=r||s.Behaviour,"function"==typeof o&&(o=o.call(this)),o=o||{},l[c]=function(t){r.call(this,t),this.class=i,this.super=r.prototype,"function"==typeof n&&n.call(this)},l[c].prototype=e.create(r.prototype),l[c].prototype.constructor=l[c],l[c].prototype.getMeta=function(){var t=r.prototype.getMeta.call(this);return a(t,o)},l[c].prototype.clazz=i,s._userScripts[i]=l[c],l[c]};s.registerBehaviour=function(e,i){for(var r=e.split("."),n=t,o=0;o<r.length-1;o++)n[r[o]]||(n[r[o]]={}),n=n[r[o]];var h=r[r.length-1];n[h]=i;var l=i.prototype.getMeta;i.prototype.getMeta=function(){var t=l.call(this);return a(t,this.serializableFields||{})},i.prototype.clazz=e,s._userScripts[e]=i},e.defineProperties(N.prototype,{uuid:{get:function(){return this._uuid},set:function(t){this._uuid=t}},gameObject:{get:function(){return this._gameObject}},name:{get:function(){return this.gameObject.name},set:function(t){this.gameObject.name=t}},key:{get:function(){if(this._key)return this._key;if(this.class){var t=this.class.match(/([^\..]*)$/);t&&(this._key=t[1])}return this._key},set:function(t){this._key&&this.gameObject&&this.gameObject[this._key]&&this.gameObject[this._key].uuid===this.uuid&&delete this.gameObject[this._key],this._key=t,this.gameObject&&!this.gameObject[t]&&(this.gameObject[t]=this)}},enable:{get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this._enable&&this.onEnable?this.onEnable():!this._enable&&this.onDisable&&this.onDisable())}},runInEditor:{get:function(){return!0===this._runInEditor},set:function(t){this._runInEditor=t}},game:{get:function(){return this.gameObject.game}}}),N.prototype.addScript=function(t){return this.gameObject.addScript(t)},N.prototype.getScript=function(t){return this.gameObject.getScript(t)},N.prototype.getScripts=function(t){return this.gameObject.getScripts(t)},N.prototype.destroy=function(){for(var t in this.gameObject.removeScript(this),this.onDestroy&&this.onDestroy(),this._events){var e=this._events[t];e&&e[0].remove(e[1],e[2])}this._events=[]},N.prototype.isEnable=function(){return this._enable},N.prototype.getMeta=function(){return{uuid:s.Serializer.STRING,enable:{get:function(t){return t.enable},set:function(t,e){t._enable=e}}}},N.prototype._restoreInit=function(){this.gameObject._initGetSetField.call(this)},N.prototype.addListener=function(t,e,i,r){return t.add(e,i,r),this.cookie++,this._events[this.cookie]=[t,e,i],this.cookie},N.prototype.addListenerOnce=function(t,e,i,r){t.addOnce(e,i,r)},N.prototype.removeListener=function(t){var e=this._events[t];e&&(e[0].remove(e[1],e[2]),delete this._events[t])};var L=s.Storage=function(t){this.game=t,this._data={},this.timerMap={}};L.prototype={},L.prototype.constructor=L,e.defineProperties(L.prototype,{key:{get:function(){return this.game.localStorageID}}}),L.prototype.restore=function(){},L.prototype.save=function(){},L.prototype.set=function(e,i){var r=this.key+"_"+e;this._data[r]=i;var n=JSON.stringify(i);t.__wx?wx.setStorage({key:r,data:n}):t.localStorage.setItem(r,n)},L.prototype.delaySet=function(t,e,i){if(!this.timerMap[t]){var r=this.key+"_"+t;this._data[r]=e;var n=this;this.timerMap[t]=this.game.timer.add(i,function(){delete n.timerMap[t],n.set(t,e)})}},L.prototype.del=function(e){var i=this.key+"_"+e;this._data[i]&&delete this._data[i],t.__wx?wx.removeStorageSync(i):t.localStorage.removeItem(i)},L.prototype.get=function(e){var i,r,n=this.key+"_"+e;return this._data[n]?this._data[n]:(i=t.__wx?wx.getStorageSync(n):t.localStorage.getItem(n),i&&(r=JSON.parse(i),this._data[n]=r),r)};var F=s.Node=function(t,e,r){var n=this;n.game=t.game._qc,n.phaser=t,t._qc=this,n.uuid=r||n.game.math.uuid(),n._uniqueName="",n._interactive=!1,n._draggable=!1,n._children=null,n._prefab="",n.scripts=[],n.scriptMap={},n.static=!1,n._localZOrder=0,n.hitArea=i,this.cookie=0,n._events=[];var a=t.destroy;t.destroy=function(){if(!n._destroy)if(this.maybeOutWorld&&this.maybeOutWorld(),n===n.game.world)a.call(t,!0,!0),n._dispatchModelChangeEvent("destroy",n);else{n.onDestroy(),a.call(t);for(var e=n.scripts.length;e--;)n.scripts[e].destroy();n.scripts=[],n.scriptMap={},n._dispatchModelChangeEvent("destroy",n),n._destroy=!0}},e!==this&&((e||this.game.world).addChild(this),this instanceof dragonBones.PhaserArmatureDisplay||this instanceof dragonBones.PhaserSlotDisplay||(this.pivotX=this.pivotY=.5,this.minAnchor.x=this.minAnchor.y=this.maxAnchor.x=this.maxAnchor.y=.5,this.anchoredX=this.anchoredY=0)),this._defaultTransform()};F.prototype.constructor=F,e.defineProperties(F.prototype,{uuid:{get:function(){return this._uuid},set:function(t){this._uuid&&this.game.nodePool.remove(this.uuid),this._uuid=t,this.game.nodePool.add(this.uuid,this)}},name:{get:function(){return this.phaser.name},set:function(t){t=t||"",t=t.replace(/\//g,""),this.phaser.name=t,this._dispatchModelChangeEvent("name",this)}},uniqueName:{get:function(){return this._uniqueName},set:function(t){this._uniqueName&&this.game.nodePool.removeName(this._uniqueName),this._uniqueName=t,this._uniqueName&&!this.game.nodePool.findByName(this._uniqueName)&&this.game.nodePool.addName(this._uniqueName,this.uuid)}},ignoreDestroy:{get:function(){return this.parent===this.game.world&&this.phaser.ignoreDestroy},set:function(t){this.parent===this.game.world?this.phaser.ignoreDestroy=t:(this.phaser.ignoreDestroy=!1,t&&this.game.log.error("Only Root Node can set: ignoreDestroy=true"))}},alpha:{get:function(){return this.phaser.alpha},set:function(t){this.phaser.alpha=t,this.phaser.displayChanged(s.DisplayChangeStatus.ALPHA)}},visible:{get:function(){return this.phaser.visible},set:function(t){this.phaser.visible!==t&&(t&&this._toDestroy||(this.phaser.visible=t,this._isTransformDirty=!0,this._dispatchLayoutArgumentChanged("size"),this.phaser.displayChanged(t?s.DisplayChangeStatus.SHOW:s.DisplayChangeStatus.HIDE),this._notifyVisibleChanged(t),this._dispatchEnable()))}},parent:{get:function(){var t=this.phaser.parent;return t?t._qc:null},set:function(t){t?t.addChild(this):this.parent instanceof F&&this.parent.removeChild(this)}},worldVisible:{get:function(){return this.phaser&&this.phaser.worldVisible}},mask:{get:function(){return this.phaser.mask},set:function(t){this.phaser.mask=t}},children:{get:function(){if(!this._children){this._children=[];for(var t=this.phaser.children,e=0,i=t.length;e<i;e++){var r=t[e]._qc;r&&this._children.push(r)}}return this._children}},localZOrder:{get:function(){return this._localZOrder},set:function(t){this._localZOrder=t,this.parent&&(this.parent._orderDirty=!0)}},colorTint:{get:function(){return new vt(this.phaser.tint)},set:function(t){if(t=t||new vt(16777215),!(t instanceof vt))return console.error(t),void this.game.log.error("Expected qc.Color");this.phaser.tint=t.toNumber(),this.phaser.displayChanged(s.DisplayChangeStatus.TINT)}},onChildrenChanged:{get:function(){return this._onChildrenChanged||(this._onChildrenChanged=new o.Signal)}}}),F.prototype.preUpdate=function(){if(this._orderDirty&&(this._orderDirty=i,this.phaser&&"function"==typeof this.phaser.updateZ)){var t=this.getChildren();t.sort(function(t,e){var i=(t._localZOrder||0)-(e._localZOrder||0)
;return 0===i?t.phaser.z-e.phaser.z:i});for(var e=[],r=0,n=t.length;r<n;r++){var a=t[r];e.push(a.phaser)}this.phaser.children=e,this.phaser.updateZ(),this._children=null}},F.prototype.isVisible=function(){return this.phaser.visible},F.prototype.isWorldVisible=function(){var t=this;do{if(!t.phaser.visible)return!1;t=t.parent}while(t);return!0},F.prototype.addScript=function(t,e){var r=t;if("string"==typeof t&&(r=s.Util.findClass(t)),"function"==typeof r){var n=new r(this);if(n instanceof s.Behaviour)return n.uuid=this.game.math.uuid(),n._clazz=t,n.class=t,this[n.key]=n,this.scripts.push(n),this.scriptMap[t]=n,(e||e===i)&&(!n.awake||!0===this.game.device.editor&&!0!==n.runInEditor||n.awake()),n._enable===i&&!1!==e&&(!0===this.game.device.editor&&!0!==n.runInEditor?n._enable=!0:n.enable=!0),n;this.game.log.error("Must inherit from qc.Behaviour")}else this.game.log.error("Class:{0} not exists",t)},F.prototype.removeScript=function(t){var e=this.scripts.indexOf(t);e>-1&&this.scripts.splice(e,1),delete this.scriptMap[t.class],this[t._key]&&this[t._key].uuid===t.uuid&&delete this[t._key],this.__json&&this.__json[t.uuid]&&delete this.__json[t.uuid]},F.prototype.getScript=function(t,e){var i=t;if("string"!=typeof t&&(t=i.prototype.clazz),this.scriptMap[t])return this.scriptMap[t];if("string"==typeof t&&(i=s.Util.findClass(t)),!i)return"playsmart.editor.data"!==t&&this.game.log.error("Class:{0} not exists",t),null;if(1===arguments.length||e){for(var r in this.scripts)if(this.scripts[r]instanceof i)return this.scripts[r]}else for(var r in this.scripts)if(this.scripts[r].class===i.prototype.clazz)return this.scripts[r]},F.prototype.getScripts=function(t,e){var i=t;"string"==typeof t&&(i=s.Util.findClass(t));var r=[];if(!i)return this.game.log.error("Class:{0} not exists",t),r;if(1===arguments.length||e)for(var n in this.scripts)this.scripts[n]instanceof i&&r.push(this.scripts[n]);else for(var n in this.scripts)this.scripts[n].class===i.prototype.clazz&&r.push(this.scripts[n]);return r},F.prototype.isDescendantOf=function(t){for(var e=this.parent;e;){if(t===e)return!0;e=e.parent}return!1},F.prototype.getChildren=function(){var t=this._children;return t||(t=this.children),t},F.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},F.prototype.addChildAt=function(t,e){if(t.parent!==this){if(!(t instanceof F))throw new Error("Expected qc.Node");if(t===this)throw new Error("The child is myself");if(this.isDescendantOf(t))throw new Error("child is my parent");var i=t.parent;return i instanceof F&&(i._children=null),this.phaser.addAt?this.phaser.addAt(t.phaser,e):this.phaser.addChildAt(t.phaser,e),this._orderDirty=!0,this._dispatchModelChangeEvent("parent",t),t._callChildrenFunc("onAddToWorld"),t}},F.prototype.swapChildren=function(t,e){this.phaser.swapChildren(t.phaser,e.phaser),this._dispatchModelChangeEvent("parent",t),this._dispatchModelChangeEvent("parent",e)},F.prototype.getChildIndex=function(t){return this.children.indexOf(t)},F.prototype.setChildIndex=function(t,e){if(t.parent===this){var i=this.phaser.children,r=i.indexOf(t.phaser);r!==e&&(i.splice(r,1),i.splice(e,0,t.phaser),this.phaser.updateZ&&this.phaser.updateZ(),t.phaser.displayChanged(s.DisplayChangeStatus.ORDER),this._dispatchModelChangeEvent("parent",t),this._dispatchChildrenChanged("order",[t]))}},F.prototype.getChildAt=function(t){return this.children[t]},F.prototype.removeChild=function(t){return this.phaser.remove?this.phaser.remove(t.phaser):this.phaser.removeChild(t.phaser),this._children=null,this._dispatchModelChangeEvent("parent",t),t._callChildrenFunc("onRemoveFromWorld"),t},F.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.removeChild(e)},F.prototype.removeChildren=function(){var t=this.children;this.phaser.removeAll?this.phaser.removeAll():this.phaser.removeChildren(),this._dispatchModelChangeEvent("removeChildren",this),t.forEach(function(t){t&&t._callChildrenFunc("onRemoveFromWorld")})},F.prototype.onDestroy=function(){this.parent=null,this.game.nodePool.remove(this.uuid)},F.prototype.destroy=function(){this._toDestroy||(this._toDestroy=!0,this.visible=!1,this.game.world.addToDestroy(this))},F.prototype.destroyImmediately=function(){if(!this._destroy&&!this._destroying){for(var t in this._events){var e=this._events[t];e&&e[0].remove(e[1],e[2])}this._events=[],this.visible=!1,this._destroying=!0,this.phaser&&this.phaser.destroy(),this._destroying=!1}},F.prototype.find=function(t){if(""===t||"."===t||"./"===t)return this;for(var e=t.split("/"),i=this,r=0;r<e.length-1;r++){var n=e[r];if(""!==n)if(".."!==n){if(i=i._findByName(e[r]),!i)return i}else if(i=this.parent,i===this.game.stage)return null}n=e[e.length-1];return""===n||"."===n?i:".."===n?i.parent===this.game.stage?null:i.parent:i._findByName(n)},F.prototype._findByName=function(t){var e=this.children;for(var i in e){if(e[i].name===t)return e[i];if(e[i].uniqueName===t)return e[i]}},F.prototype._dispatchModelChangeEvent=function(t,e){"name"!==t&&(this._children=null);var i=this.game.world;i.onModelChange.dispatch({type:t,target:e})},F.prototype._sendMessage=function(t,e){if(this.scripts)for(var i=this.scripts.length,r=Array.prototype.slice.call(arguments,2),n=0;n<i;n++){var a=this.scripts[n];if(a&&a.enable){var s=a[t];if(!s)continue;var o=s.apply(a,r);if(!0===e&&!0===o)return!0}}},F.prototype._broadcast=function(t){if(this.scripts){for(var e=this.scripts.length,i=Array.prototype.slice.call(arguments,1);e--;){var r=this.scripts[e];if(r&&r.enable&&(!0!==this.game.device.editor||!0===r.runInEditor)){if(this._toDestroy||this._destroy)return;var n=r[t];n&&n.apply(r,i)}}var a=this._children;a||(a=this.getChildren());var s=a.length;for(e=0;e<s;e++)a[e][t](i)}},F.prototype._dispatchChildrenChanged=function(t,e){for(var i=this,r={source:this,type:t,children:e};i;)i._onChildrenChanged&&i._onChildrenChanged.dispatch(r),i=i.parent},F.prototype._notifyVisibleChanged=function(t){this.onVisibleChange&&this.onVisibleChange();var e=this._children;e||(e=this.children);for(var i=e.length;i--;)e[i].visible&&e[i]._notifyVisibleChanged(t)},F.prototype._notifyCacheChanged=function(t){this.cacheEnable=t;var e=this._children;e||(e=this.children);for(var i=e.length;i--;)e[i]._notifyCacheChanged(t)},F.prototype._callChildrenFunc=function(t){var e=this[t];e&&e.apply(this,arguments);var i=this._children;i||(i=this.children);for(var r=i.length;r--;){var n=i[r];n&&(e=n[t],e&&e.apply(n,arguments))}},F.prototype.addListener=function(t,e,i,r){return t.add(e,i,r),this.cookie++,this._events[this.cookie]=[t,e,i],this.cookie},F.prototype.addListenerOnce=function(t,e,i,r){t.addOnce(e,i,r)},F.prototype.removeListener=function(t){var e=this._events[t];e&&(e[0].remove(e[1],e[2]),delete this._events[t])},e.defineProperties(F.prototype,{x:{get:function(){return this.phaser.x},set:function(t){this.x!==t&&(this.minAnchor.x<this.maxAnchor.x&&(this._left=this.left+(t-this.x),this._right=this.right-(t-this.x)),this.phaser.x=t,this._calcAnchoredX(),this.phaser.displayChanged(s.DisplayChangeStatus.OFFSET),this._isTransformDirty=!0)}},y:{get:function(){return this.phaser.y},set:function(t){this.y!==t&&(this.minAnchor.y<this.maxAnchor.y&&(this._top=this.top+(t-this.y),this._bottom=this.bottom-(t-this.y)),this.phaser.y=t,this._calcAnchoredY(),this.phaser.displayChanged(s.DisplayChangeStatus.OFFSET),this._isTransformDirty=!0)}},anchoredX:{get:function(){return this._anchoredX===i&&this._calcAnchoredX(),this._anchoredX},set:function(t){t!==this.anchoredX&&(this._anchoredX=t,this._calcX(),this._isTransformDirty=!0)}},anchoredY:{get:function(){return this._anchoredY===i&&this._calcAnchoredY(),this._anchoredY},set:function(t){t!==this.anchoredY&&(this._anchoredY=t,this._calcY(),this._isTransformDirty=!0)}},scaleX:{get:function(){return this.phaser.scale.x},set:function(t){t!==this.scaleX&&(this.phaser.scale.x=t,this.phaser.displayChanged(s.DisplayChangeStatus.SCALE),this._isTransformDirty=!0)}},scaleY:{get:function(){return this.phaser.scale.y},set:function(t){t!==this.scaleY&&(this.phaser.scale.y=t,this.phaser.displayChanged(s.DisplayChangeStatus.SCALE),this._isTransformDirty=!0)}},pivotX:{get:function(){return this.phaser.anchor||(this.phaser.anchor=new s.Point(.5,.5)),this.phaser.anchor.x},set:function(t){this.phaser.anchor||(this.phaser.anchor=new s.Point(.5,.5)),this.phaser.anchor.x!==t&&(this.phaser.anchor.x=t,this.phaser.displayChanged(s.DisplayChangeStatus.ROTATION),this.relayout())}},pivotY:{get:function(){return this.phaser.anchor||(this.phaser.anchor=new s.Point(.5,.5)),this.phaser.anchor.y},set:function(t){this.phaser.anchor||(this.phaser.anchor=new s.Point(.5,.5)),this.phaser.anchor.y!==t&&(this.phaser.anchor.y=t,this.phaser.displayChanged(s.DisplayChangeStatus.ROTATION),this.relayout())}},rotation:{get:function(){return this.phaser.rotation},set:function(t){this.phaser.rotation!==t&&(this.phaser.rotation=t,this.phaser.displayChanged(s.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX!==t&&(this._skewX=t,this.phaser.displayChanged(s.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY!==t&&(this._skewY=t,this.phaser.displayChanged(s.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},width:{get:function(){return this._width=this._width||0},set:function(t){if(!this.game.math.fuzzyEqual(this._width,t,.001)){if(this.minAnchor.x<this.maxAnchor.x){var e=t-this.width,i=e*this.pivotX,r=e-i;this._left-=i,this._right-=r}else this.setWidth(t);this.relayout()}}},height:{get:function(){return this._height=this._height?this._height:0},set:function(t){if(!this.game.math.fuzzyEqual(this._height,t,.001)){if(this.minAnchor.y<this.maxAnchor.y){var e=t-this.height,i=e*this.pivotY,r=e-i;this._top-=i,this._bottom-=r}else this.setHeight(t);this.relayout()}}},minAnchor:{get:function(){return this._minAnchor||(this._minAnchor=new s.Point(0,0)),this._minAnchor},set:function(t){throw new Error("user function:setAnchor")}},maxAnchor:{get:function(){return this._maxAnchor||(this._maxAnchor=new s.Point(0,0)),this._maxAnchor},set:function(t){throw new Error("use function:setAnchor")}},left:{get:function(){return this._left===i&&(this._left=0),this._left},set:function(t){this._left!==t&&(this._left=t,this.relayout())}},right:{get:function(){return this._right===i&&(this._right=0),this._right},set:function(t){this._right!==t&&(this._right=t,this.relayout())}},top:{get:function(){return this._top===i&&(this._top=0),this._top},set:function(t){this._top!==t&&(this._top=t,this.relayout())}},bottom:{get:function(){return this._bottom===i&&(this._bottom=0),this._bottom},set:function(t){this._bottom!==t&&(this._bottom=t,this.relayout())}},rect:{get:function(){var t=this.width,e=this.height;return new s.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,t,e)}},worldTransform:{get:function(){return this.nodeUpdateTransform(),this.phaser.worldTransform}},localBounds:{get:function(){return this.phaser.getLocalBounds()}},_isTransformDirty:{get:function(){return!this.phaser._isNotNeedCalcTransform},set:function(t){this.phaser._isNotNeedCalcTransform!==!t&&(this.phaser._isNotNeedCalcTransform=!t)}},onLayoutArgumentChanged:{get:function(){return this._onLayoutArgumentChanged||(this._onLayoutArgumentChanged=new o.Signal)}},onRelayout:{get:function(){return this._onRelayout||(this._onRelayout=new o.Signal)}},onTransformChanged:{get:function(){return this.phaser._onTransformChanged||(this.phaser._onTransformChanged=new o.Signal)}}}),F.prototype.setStretch=function(t,e,r,n){var a=!1;this.minAnchor.x>=this.maxAnchor.x?this._anchoredX!==t&&(this._anchoredX=t,a=!0):(t!==i&&this._left!==t&&(this._left=t,a=!0),e!==i&&this._right!==e&&(this._right=e,a=!0)),this.minAnchor.y>=this.maxAnchor.y?this._anchoredY!==r&&(this._anchoredY=r,a=!0):(r!==i&&this._top!==r&&(this._top=r,a=!0),n!==i&&this._bottom!==n&&(this._bottom=n,a=!0)),a&&this.relayout()},F.prototype.setAnchor=function(t,e,r){if(r=r===i||r,t=t||this.minAnchor,e=e||this.maxAnchor,t.x<0&&(t.x=0),t.y<0&&(t.y=0),t.x>1&&(t.x=1),t.y>1&&(t.y=1),e.x<0&&(e.x=0),e.y<0&&(e.y=0),e.x>1&&(e.x=1),e.y>1&&(e.y=1),t.x>e.x||t.y>e.y)throw new Error("Expected:min < max");t.x===this.minAnchor.x&&t.y===this.minAnchor.y&&e.x===this.maxAnchor.x&&e.y===this.maxAnchor.y||(this._minAnchor=t,this._maxAnchor=e,r?(this._calcAnchoredX(),this._calcAnchoredY(),this._calcMargin()):this.relayout())},F.prototype.relayout=function(){var t=this.parent.rect;if(this.minAnchor.x<this.maxAnchor.x){var e=t.x+t.width*this.minAnchor.x+this.left,i=t.x+t.width*this.maxAnchor.x-this.right,r=i-e;this.setWidth(r),this.phaser.x=e+r*this.pivotX,this._calcAnchoredX()}else this.phaser.x=t.x+t.width*this.minAnchor.x+this.anchoredX;if(this.minAnchor.y<this.maxAnchor.y){var n=t.y+t.height*this.minAnchor.y+this.top,a=t.y+t.height*this.maxAnchor.y-this.bottom,o=a-n;this.setHeight(o),this.phaser.y=n+o*this.pivotY,this._calcAnchoredY()}else this.phaser.y=t.y+t.height*this.minAnchor.y+this.anchoredY;this._isTransformDirty=!0;for(var h=this.children,l=0;l<h.length;l++)h[l].relayout();this._calcWorldCorners(!0),this._dispatchLayoutArgumentChanged("size"),this._lastRectInfo=new s.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),this._onRelayout&&this._onRelayout.dispatch()},F.prototype.setWidth=function(t){this._width=t,this.phaser.displayChanged(s.DisplayChangeStatus.SIZE)},F.prototype.setHeight=function(t){this._height=t,this.phaser.displayChanged(s.DisplayChangeStatus.SIZE)},F.prototype._defaultTransform=function(){this.parent&&this.parent!==this.game.stage&&(this.x=0,this.y=0,this.width=100,this.height=100)},F.prototype._calcMargin=function(){var t=this.parent.rect;if(this.minAnchor.x>=this.maxAnchor.x)this._left=this._right=0;else{var e=this.x-this.pivotX*this.width,i=t.x+t.width*this.minAnchor.x;this._left=e-i;var r=t.x+t.width*this.maxAnchor.x;this._right=r-(e+this.width)}if(this.minAnchor.y>=this.maxAnchor.y)this._top=this._bottom=0;else{var n=this.y-this.pivotY*this.height,a=t.y+t.height*this.minAnchor.y;this._top=n-a;var s=t.y+t.height*this.maxAnchor.y;this._bottom=s-(n+this.height)}},F.prototype._calcAnchoredX=function(){var t=this.parent.rect;this._anchoredX=this.x-(t.width*this.minAnchor.x+t.x)},F.prototype._calcAnchoredY=function(){var t=this.parent.rect;this._anchoredY=this.y-(t.height*this.minAnchor.y+t.y)},F.prototype._calcX=function(){var t=this.parent.rect;this.x=this._anchoredX+(t.width*this.minAnchor.x+t.x)},F.prototype._calcY=function(){var t=this.parent.rect;this.y=this._anchoredY+(t.height*this.minAnchor.y+t.y)},F.prototype.toLocal=function(t){return this.worldTransform.applyInverse(t)},F.prototype.toGlobal=function(t){return this.worldTransform.apply(t)},F.prototype.nodeUpdateTransform=function(){var t=!1;return this.parent&&this.parent.nodeUpdateTransform&&(t=this.parent.nodeUpdateTransform()),this._isTransformDirty?(t||this.phaser.updateTransform(),!0):t},F.prototype.getWorldPosition=function(){var t=this.worldTransform;return new s.Point(t.tx,t.ty)},F.prototype.getWorldScale=function(){var t=this.worldTransform,e=Math.atan2(t.b,t.a),i=Math.atan2(-t.c,t.d);t.b/t.a==-t.c/t.d&&i!==e&&(e=Math.atan(t.b/t.a),i=Math.atan(-t.c/t.d));var r=e===Math.PI||0===e||0===t.b&&0!==t.a?t.a/Math.cos(e):t.b/Math.sin(e),n=i===Math.PI||0===i||0===t.c&&0!==t.d?t.d/Math.cos(i):-t.c/Math.sin(i);return new s.Point(r,n)},F.prototype.getWorldSkew=function(){var t=this.worldTransform;return t.b/t.a==-t.c/t.d?new s.Point(0,0):new s.Point(Math.atan2(-t.c,t.d),Math.atan2(t.b,t.a))},F.prototype.getWorldRotation=function(){if(this.worldRotationTmp!=i)return this.worldRotationTmp;var t=this.worldTransform;return t.b/t.a!=-t.c/t.d?0:Math.atan2(t.b,t.a)},F.prototype.setTransformToWorld=function(t,e,i,r,n){this.setTransformTo(this.game.world,t,e,i,r,n)},F.prototype.setTransformTo=function(t,e,i,r,n,a){e=e||0,i=i||0,r=r||1,n=n||1,a=a||0;var s=0,o=0;arguments.length>6&&"number"==typeof arguments[6]&&(s=arguments[6]),arguments.length>7&&"number"==typeof arguments[7]&&(o=arguments[7]);var h=Math.cos(s),l=Math.sin(s),u=Math.cos(o),c=Math.sin(o),p=Math.cos(a),d=Math.sin(a),f=(p*u-d*l)*r,_=(p*c+d*h)*r,g=(-d*u-p*l)*n,m=(-d*c+p*h)*n,y=e,v=i;this.setTransformToWithMatrix(t,f,_,g,m,y,v)},F.prototype.setTransformToWithMatrix=function(t,e,i,r,n,a,o){var h=[e,i,0,r,n,0,a,o,1];if(t){var l=t&&t.worldTransform||new s.Matrix,u=l.toArray(!0);this.game.math.multiply(h,u,h)}var c=this.parent&&this.parent.worldTransform||new s.Matrix,p=c.toArray(!0),d=[];this.game.math.invert(d,p),this.game.math.multiply(d,d,h);e=d[0],i=d[1],r=d[3],n=d[4];if(this.x=d[6],this.y=d[7],i/e!=-r/n){var f=Math.atan2(i,e),_=Math.atan2(-r,n);this.rotation=f,this.scaleX=0===f||0===i&&0!==e?e/Math.cos(f):i/Math.sin(f),this.scaleY=0===_||0===r&&0!==n?n/Math.cos(_):-r/Math.sin(_)}else{var g=this.rotation;this.scaleX=0===g||0===i&&0!==e?e/Math.cos(g):i/Math.sin(g),this.scaleY=0===g||0===r&&0!==n?n/Math.cos(g):-r/Math.sin(g)}this._calcAnchoredX(),this._calcAnchoredY(),this._calcMargin()};var k=F.prototype.addChildAt;F.prototype.addChildAt=function(t,e){k.call(this,t,e),t._isSwitchParent||t.relayout(),t._isTransformDirty=!0},F.prototype.switchParent=function(t,e){if(t!==this&&!t.isDescendantOf(this)){var i=this.worldTransform,r=i.a,n=i.b,a=i.c,s=i.d,o=i.tx,h=i.ty;this._isSwitchParent=!0,this.parent=t,delete this._isSwitchParent,void 0!==e&&this.parent.setChildIndex(this,e),this.setTransformToWithMatrix(null,r,n,a,s,o,h)}},F.prototype._calcWorldCorners=function(t){if(t||this.nodeUpdateTransform()){var e=this.rect,i=new s.Point(e.x,e.y),r=new s.Point(e.x+e.width,e.y),n=new s.Point(e.x+e.width,e.y+e.height),a=new s.Point(e.x,e.y+e.height),o=this.phaser.worldTransform;this._worldLeftTop=o.apply(i),this._worldRightTop=o.apply(r),this._worldRightBottom=o.apply(n),this._worldLeftBottom=o.apply(a);var h=Math.min(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x),l=Math.max(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x),u=Math.min(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y),c=Math.max(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y);this._worldBox=new s.Rectangle(h,u,l-h,c-u)}},F.prototype.getWorldCorners=function(){return this._calcWorldCorners(!0),[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]},F.prototype.getCornersIn=function(t){var e=t&&t.phaser.worldTransform;return this._calcWorldCorners(),e?[e.applyInverse(this._worldLeftTop),e.applyInverse(this._worldRightTop),e.applyInverse(this._worldRightBottom),e.applyInverse(this._worldLeftBottom)]:[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]},F.prototype.getWorldBox=function(){return this._calcWorldCorners(!0),this._worldBox},F.prototype.getBoxIn=function(t){for(var e=this.getCornersIn(t),i=new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE),r=new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),n=0;n<4;n++){var a=e[n];i.x=Math.max(i.x,a.x),i.y=Math.max(i.y,a.y),r.x=Math.min(r.x,a.x),r.y=Math.min(r.y,a.y)}return new s.Rectangle(r.x,r.y,i.x-r.x,i.y-r.y)},F.prototype.rectContains=function(t){var e=this.toLocal(t);return this.rect.contains(e.x,e.y)},F.prototype._dispatchLayoutArgumentChanged=function(t){this._onLayoutArgumentChanged&&this._onLayoutArgumentChanged.dispatch(t)},e.defineProperties(F.prototype,{hitArea:{get:function(){return this.phaser.hitArea===i?this.rect:this.phaser.hitArea},set:function(t){this.phaser.hitArea=t}},serializeHitArea:{get:function(){return this.phaser.hitArea},set:function(t){this.phaser.hitArea=t}},onDown:{get:function(){return this._onDown||(this._onDown=new o.Signal),this._onDown}},onUp:{get:function(){return this._onUp||(this._onUp=new o.Signal),this._onUp}},onClick:{get:function(){return this._onClick||(this._onClick=new o.Signal),this._onClick}},onDragStart:{get:function(){return this._onDragStart||(this._onDragStart=new o.Signal),this._onDragStart}},onDrag:{get:function(){return this._onDrag||(this._onDrag=new o.Signal),this._onDrag}},onDragEnd:{get:function(){return this._onDragEnd||(this._onDragEnd=new o.Signal),this._onDragEnd}},onDragDrop:{get:function(){return this._onDragDrop||(this._onDragDrop=new o.Signal),this._onDragDrop}},onWheel:{get:function(){return this._onWheel||(this._onWheel=new o.Signal),this._onWheel}},onEnter:{get:function(){return this._onEnter||(this._onEnter=new o.Signal),this._onEnter}},onExit:{get:function(){return this._onExit||(this._onExit=new o.Signal),this._onExit}},onInteractive:{get:function(){return this._onInteractive||(this._onInteractive=new o.Signal),this._onInteractive}},interactive:{get:function(){return this._interactive},set:function(t){this._interactive=t,this._onInteractive&&this._onInteractive.dispatch()}},passEvent:{get:function(){return this._passEvent},set:function(t){this._passEvent=t}}}),F.prototype.checkAllowDrop=function(t){for(var e=!1,i=this.scripts.length,r=0;r<i;r++){var n=this.scripts[r];if(n){var a=n.isAllowDrop;if(!a)continue;if(a.call(n,t))return!0;e=!0}}return this.isAllowDrop?this.isAllowDrop(t):!e},F.prototype.canHandleInputEvent=function(t){if(!this.interactive)return!1;var e=this["_"+t];if(e&&e.getNumListeners()>0)return!0;for(var i=this.scripts.length,r=0;r<i;r++){var n=this.scripts[r];if(n){var a=n[t];if(!a)continue;return!0}}return!1},F.prototype.getInputEventHandle=function(t,e,i){for(var r,n=Array.isArray(t)?t:[t],a=this,s=this.game.stage,o=[];a&&a!==s;){r=n.length;for(var h=a.phaser.worldTransform.applyInverse({x:e,y:i});r--;)if(a.canHandleInputEvent(n[r])&&a.checkHit(h.x,h.y)){if(o.push(a),!a.passEvent)return o;break}a=a.parent}return o},F.prototype.getInputEventHandleAndEventType=function(t,e,i){for(var r,n=Array.isArray(t)?t:[t],a=this,s=this.game.stage,o=[];a&&a!==s;){r=n.length;for(var h=a.phaser.worldTransform.applyInverse({x:e,y:i});r--;)if(a.canHandleInputEvent(n[r])&&a.checkHit(h.x,h.y)){if(o.push([a,n[r]]),!a.passEvent)return o;break}a=a.parent}return o},F.prototype.fireInputEvent=function(t,e){if(!this.interactive||this.state===s.UIState.DISABLED)return!1;var i=this._sendMessage(t,!0,e);if(!0===i)return!0;var r=this["_"+t];r&&r.getNumListeners()>0&&r.dispatch(this,e)},F.prototype.checkHit=function(t,e){var r=this;if(r._interactive){var n=r.phaser.hitArea===i?this._lastRectInfo:this.phaser.hitArea;return n&&n.contains&&n.contains(t,e)}},e.defineProperty(F.prototype,"class",{get:function(){return"qc.Node"}}),F.prototype.getMeta=function(){var t=s.Serializer,e=this;return{uuid:{type:t.STRING,get:function(t,e){return t.uuid},set:function(t,i){e.game.serializer.restoreContext[i]=e.uuid}},_prefab:t.STRING,__lock:t.BOOLEAN,name:t.STRING,uniqueName:t.STRING,ignoreDestroy:t.BOOLEAN,banPSRemove:t.BOOLEAN,alpha:t.NUMBER,visible:t.BOOLEAN,colorTint:t.COLOR,static:t.BOOLEAN,scripts:{get:function(t,i){return e._packScripts.call(t,i)},set:function(t,i){e._unpackScripts.call(t,i)}},position:{get:function(t,e){return[t.pivotX,t.pivotY,t.anchoredX,t.anchoredY,t.x,t.y,t.width,t.height,t.left,t.right,t.top,t.bottom,t.minAnchor.x,t.minAnchor.y,t.maxAnchor.x,t.maxAnchor.y]},set:function(t,e){var i=t;i._minAnchor=new s.Point(e[12],e[13]),i._maxAnchor=new s.Point(e[14],e[15]),i.phaser.anchor=new s.Point(e[0],e[1]),i._anchoredX=e[2],i._anchoredY=e[3],i._minAnchor.x<i._maxAnchor.x?(i._left=e[8],i._right=e[9]):i.setWidth(e[6]),i._minAnchor.y<i._maxAnchor.y?(i._top=e[10],i._bottom=e[11]):i.setHeight(e[7]),i.relayout()}},scaleX:t.NUMBER,scaleY:t.NUMBER,rotation:t.NUMBER,serializeHitArea:t.AUTO,interactive:t.BOOLEAN,isFiltersThrough:t.BOOLEAN,children:{get:function(t,i){return e._packChildren.call(t,i)},set:function(t,i){e._unpackChildren.call(t,i)}}}},F.prototype._packChildren=function(t){var e=this.children;if(0===e.length)return[];if(this instanceof s.UIText||this instanceof s.Sprite)return[];var i=[];for(var r in e){var n=e[r],a=this.game.serializer.buildBundle(n,t);i.push(a)}return i},F.prototype._unpackChildren=function(t){for(var e in t)this.game.serializer.restoreBundle(t[e],this,!0)},F.prototype._packScripts=function(t){var e=this.scripts;if(!e||0===e.length)return[];var i=[];for(var r in e){var n=e[r],a=null;"qc.NonexistScript"!==n._clazz?(this.__json&&this.__json[n.uuid]&&(a=this.__json[n.uuid].data),a=this.game.serializer.buildBundle(n,t,a),i.push({clazz:n._clazz,data:n.uuid}),this.__json||(this.__json={}),this.__json[n.uuid]=a):i.push({clazz:n.script,data:n.data.uuid[1]})}return i},F.prototype._unpackScripts=function(t){for(var e in t){var i=t[e],r=i.data;r="string"==typeof r?this.__json[r].data:r.data;var n=s.Util.findClass(i.clazz);if("function"==typeof n)try{h=this.addScript(i.clazz,!1);var a={};for(var o in h.getMeta&&(a=h.getMeta()),a)try{this.game.serializer.fromJson(h,r,o,a[o])}catch(t){console.error("Deserialize fail!",t),s.Util.popupError(t.message)}}catch(t){console.error("Deserialize error!",t),s.Util.popupError(t.message)}else{if(r&&r.uuid){var h=this.addScript("qc.NonexistScript");h.script=i.clazz,h.data=r}console.error("Class: "+i.clazz+" is not exist!")}}this.game.device.editor||delete this.__json},F.prototype._findPath=function(t,e){var r="";if(t===this)return r;e===i&&(e=!0);var n=this.children;for(var a in n){var s=n[a],o=s._findPath(t,!1);if(""===o)return r+=s.name,r;if(o)return r+=s.name+"/"+o,r}if(!e)return null;var h=this.parent;for(r+="/..";h!==this.game.stage;){o=h._findPath(t,!1);if(""===o)return r;if(o)return r+="/"+o,r;h=h.parent,r+="/.."}return null},F.prototype._restoreNodeRef=function(){var t={};for(var e in this.getMeta&&(t=this.getMeta()),t){var i="__BUILTIN_NODE__"+e;this[i]&&"string"==typeof this[i]&&(this[e]=this.game.serializer.findNodeRef(this[i]),delete this[i]);var r="__BUILTIN_NODE_ARRAY__"+e;if(this[r]&&"object"==typeof this[r]){var n=[];for(var a in this[r])this[r][a]&&this[r][a][1]?n.push(this.game.serializer.findNodeRef(this[r][a][1])):n.push(null);this[e]=n,delete this[r]}}for(var a in this.scripts){var s=this.scripts[a];t={};for(var e in s.getMeta&&(t=s.getMeta()),t){i="__BUILTIN_NODE__"+e;s[i]&&"string"==typeof s[i]&&(s[e]=this.game.serializer.findNodeRef(s[i]),delete s[i]);r="__BUILTIN_NODE_ARRAY__"+e;if(s[r]&&"object"==typeof s[r]){n=[];for(var a in s[r])s[r][a]&&s[r][a][1]?n.push(this.game.serializer.findNodeRef(s[r][a][1])):n.push(null);s[e]=n,delete s[r]}}}var o=this.children;for(var e in o)o[e]._restoreNodeRef()},F.prototype._restoreInit=function(){for(var t in this._initGetSetField(),this.scripts){var e=this.scripts[t];e._restoreInit&&e._restoreInit()}var i=this.children;for(var r in i)i[r]._restoreInit()},F.prototype._dispatchAwake=function(){var t=this.children;for(var e in t)t[e]._dispatchAwake();for(var i in this.scripts){var r=this.scripts[i];(!0!==this.game.device.editor||r.runInEditor)&&(r.awake&&r.awake.call(r))}},F.prototype._dispatchEnable=function(){if(this.visible){var t=this.children;for(var e in t)t[e]._dispatchEnable();for(var i in this.scripts){var r=this.scripts[i];(!0!==this.game.device.editor||r.runInEditor)&&(r.enable&&r.onEnable&&r.onEnable())}}},F.prototype._initGetSetField=function(){var t=this.__GET_SET__;if(t){for(var e in t){var i=t[e];this[i]=this["__BUILTIN_SET__"+i],delete this["__BUILTIN_SET__"+i]}delete this.__GET_SET__}};var U=function(t,e){return{type:e,get:function(e){return e[t]},set:function(e,i){e["__BUILTIN_SET__"+t]=i,e.__GET_SET__?e.__GET_SET__.push(t):e.__GET_SET__=[t]}}};F.prototype.generateTexture=function(t,e,i,r,n,a){if(!this.phaser)return new s.RenderTexture(0,0,renderer,e,t);var o=this.localBounds;o.x+=i||0,o.y+=r||0,isNaN(n)||(o.width=n),isNaN(a)||(o.height=a);var l=new s.RenderTexture(0|o.width,0|o.height,null,e,t);return h.DisplayObject._tempMatrix.tx=-o.x,h.DisplayObject._tempMatrix.ty=-o.y,l.render(this.phaser,h.DisplayObject._tempMatrix),l},F._snapTempMatrix=new h.Matrix,F.prototype._snapshotAsRenderTexture=function(t,e,i,r){if(!this.phaser)return new s.RenderTexture(0,0);var n=t,a=this.getWorldScale();n||(n=s.Bounds.getBounds(this)),e=e||n.width*a.x,i=i||n.height*a.y;var o=e/n.width,h=i/n.height;r=r||this.game.resolution,F._snapTempMatrix.a=o,F._snapTempMatrix.d=h,F._snapTempMatrix.tx=-n.x*o,F._snapTempMatrix.ty=-n.y*h;var l=this.game.phaser,u=new s.RenderTexture(1,1,l.renderer,l.scale.scaleMode,r);return u.resize(e,i,!0),u.render(this.phaser,F._snapTempMatrix),u},F.prototype.snapshotAsImage=function(t,e,i,r,n){var a=this._snapshotAsRenderTexture(t,e,i,r),s=a.getBase64();a.destroy(!0);var o=new Image;return o.src=s,n&&(o.onload=function(){n(o)}),o},F.prototype.snapshotAsAtlas=function(t,e,i,r,n){var a=this._snapshotAsRenderTexture(e,i,r,n),o=this.game.assets._cache;o.checkImageKey(t)&&o.removeImage(t,!1);var h=s.AssetUtil.addAtlasFromImage(this.game,t,t,a.getCanvas());return h};var j=s.Serializer=function(t){this.game=t};j.prototype={},j.prototype.constructor=j,j.customDeserializers={},j.AUTO=0,j.INT=1,j.INTS=2,j.NUMBER=3,j.NUMBERS=4,j.BOOLEAN=5,j.BOOLEANS=6,j.STRING=7,j.STRINGS=8,j.MAPPING=9,j.TEXTURE=10,j.TEXTURES=11,j.AUDIO=12,j.AUDIOS=13,j.COLOR=14,j.COLORS=15,j.PREFAB=16,j.PREFABS=17,j.NODE=18,j.NODES=19,j.SCRIPT=20,j.SCRIPTS=21,j.GEOM=22,j.GEOMS=23,j.POINT=24,j.POINTS=25,j.RECTANGLE=26,j.RECTANGLES=27,j.CIRCLE=28,j.CIRCLES=29,j.ELLIPSE=30,j.ELLIPSES=31,j.FONT=32,j.FONTS=33,j.FILTER=34,j.FILTERS=35,j.TEXTASSET=36,j.TEXTASSETS=37,j.EXCELASSET=38,j.EXCELASSETS=39,j.ACTION=40,j.ACTIONMANAGER=41,j.ANIMATOR=42,j.ANIMATORS=43,j.CUSTOMEVENT=44,j.prototype.buildBundle=function(t,e,i){e.dependences||(e.dependences=[]);var r={};for(var n in t.getMeta&&(r=t.getMeta()),i=i||{},r)this.toJson(t,i,e,n,t[n],r[n]);return{class:t.class,data:i,__json:t.__json}},j.prototype.combineDependence=function(t){var e={};for(var i in t.dependences){var r=t.dependences[i];e[r.uuid]||(e[r.uuid]=r)}return e},j.prototype.restoreBundle=function(t,e,i){i||(this.restoreContext={}),this.isRestoring=!0;var r=t.data.uuid;this.game.nodePool.find(r)&&(r=this.game.math.uuid());var a=this.newNode(t.class,e,r);t.__json&&(a.__json=n(t.__json));var s={};a.getMeta&&(s=a.getMeta());var o=t.data;for(var h in s)"scripts"!==h&&this.fromJson(a,o,h,s[h]);return s.scripts&&this.fromJson(a,o,"scripts",s.scripts),a.onDeserialized&&a.onDeserialized(),i?a:(a._restoreNodeRef(),a._restoreInit(),a._dispatchAwake(),a._dispatchEnable(),this.restoreContext={},this.isRestoring=!1,a)},j.prototype.restoreState=function(t){var e=[];for(var i in this.restoreContext={},this.isRestoring=!0,t.children){var r=this.restoreBundle(t.children[i],this.game.world,!0);e.push(r)}for(var i in e)e[i]._restoreNodeRef();for(var i in e)e[i]._restoreInit();for(var i in e)e[i]._dispatchAwake();for(var i in e)e[i]._dispatchEnable();this.restoreContext={},this.isRestoring=!1},j.prototype.toJson=function(t,e,r,n,a,o){if(o=o||j.AUTO,"object"!=typeof o||"function"!=typeof o.get||"function"!=typeof o.set)switch(o){case j.AUTO:o=this.getAutoType(a),o===i?e[n]=a:this.toJson(t,e,r,n,a,o);break;case j.INT:case j.NUMBER:case j.STRING:case j.BOOLEAN:case j.CUSTOMEVENT:this._saveCommonType(t,e,r,n,a,o);break;case j.INTS:case j.NUMBERS:case j.STRINGS:case j.BOOLEANS:this._saveCommonArray(t,e,r,n,a,o);break;case j.MAPPING:this._saveMapping(t,e,r,n,a,o);break;case j.COLOR:this.saveColor(t,e,r,n,a);break;case j.COLORS:this._saveArray(t,e,r,n,a,o,this._saveColorItem);break;case j.GEOM:case j.POINT:case j.RECTANGLE:case j.CIRCLE:case j.ELLIPSE:this.saveGeom(t,e,r,n,a);break;case j.POINTS:case j.RECTANGLES:case j.CIRCLES:case j.ELLIPSES:this._saveArray(t,e,r,n,a,o,this._saveGeomItem);break;case j.PREFAB:this.savePrefab(t,e,r,n,a);break;case j.PREFABS:this._saveArray(t,e,r,n,a,o,this._savePrefabItem);break;case j.TEXTURE:this.saveTexture(t,e,r,n,a);break;case j.TEXTURES:this._saveArray(t,e,r,n,a,o,this._saveTextureItem);break;case j.AUDIO:this.saveAudio(t,e,r,n,a);break;case j.AUDIOS:
this._saveArray(t,e,r,n,a,o,this._saveAudioItem);break;case j.TEXTASSET:this.saveTextAsset(t,e,r,n,a);break;case j.TEXTASSETS:this._saveArray(t,e,r,n,a,o,this._saveTextAssetItem);break;case j.EXCELASSET:this.saveExcelAsset(t,e,r,n,a);break;case j.EXCELASSETS:this._saveArray(t,e,r,n,a,o,this._saveExcelAssetItem);break;case j.FONT:this.saveFont(t,e,r,n,a);break;case j.FONTS:this._saveArray(t,e,r,n,a,o,this._saveFontItem);break;case j.NODE:this.saveNode(t,e,r,n,a);break;case j.NODES:this._saveArray(t,e,r,n,a,o,this._saveNodeItem);break;case j.FILTER:this._saveFilter(t,e,r,n,a);break;case j.FILTERS:this._saveArray(t,e,r,n,a,o,this._saveFilterItem);break;case j.ACTION:this.saveAction(t,e,r,n,a);break;case j.ACTIONMANAGER:this.saveActionManager(t,e,r,n,a);break;case j.ANIMATOR:a instanceof s.ActionAsset?this.saveAction(t,e,r,n,a):a instanceof s.ActionManagerAsset&&this.saveActionManager(t,e,r,n,a);break;case j.ANIMATORS:if(a)for(var h in e[n]=[o,[]],a){var l=a[h];l instanceof s.ActionAsset?e[n][1].push(this._saveActionItem(l,r)):l instanceof s.ActionManagerAsset&&e[n][1].push(this._saveActionManagerItem(l,r))}break;default:throw new Error("unsupported asset type:"+o)}else e[n]=o.get.call(t,t,r)},j.prototype.fromJson=function(t,e,r,n){if(n=n||j.AUTO,"object"!=typeof n||"function"!=typeof n.get||"function"!=typeof n.set){var a=e[r];if(a!==i)if(null!==a&&NaN!==a)switch(a[0]){case j.INT:case j.NUMBER:case j.STRING:case j.BOOLEAN:case j.CUSTOMEVENT:this._restoreCommonType(t,e,r,a[0]);break;case j.INTS:case j.NUMBERS:case j.STRINGS:case j.BOOLEANS:this._restoreCommonArray(t,e,r,a);break;case j.MAPPING:this._restoreMapping(t,e,r,a);break;case j.COLOR:this.restoreColor(t,e,r,a);break;case j.COLORS:this._restoreArray(t,e,r,a,this._restoreColorItem);break;case j.GEOM:case j.POINT:case j.RECTANGLE:case j.CIRCLE:case j.ELLIPSE:this.restoreGeom(t,e,r,a);break;case j.POINTS:case j.RECTANGLES:case j.CIRCLES:case j.ELLIPSES:this._restoreArray(t,e,r,a,this._restoreGeomItem);break;case j.PREFAB:this.restorePrefab(t,e,r,a);break;case j.PREFABS:this._restoreArray(t,e,r,a,this._restorePrefabItem);break;case j.TEXTURE:this.restoreTexture(t,e,r,a);break;case j.TEXTURES:this._restoreArray(t,e,r,a,this._restoreTextureItem);break;case j.EXCELASSET:this.restoreExcelAsset(t,e,r,a);break;case j.EXCELASSETS:this._restoreArray(t,e,r,a,this._restoreExcelAssetItem);break;case j.AUDIO:this.restoreAudio(t,e,r,a);break;case j.AUDIOS:this._restoreArray(t,e,r,a,this._restoreAudioItem);break;case j.TEXTASSET:this.restoreTextAsset(t,e,r,a);break;case j.TEXTASSETS:this._restoreArray(t,e,r,a,this._restoreTextAssetItem);break;case j.FONT:this.restoreFont(t,e,r,a);break;case j.FONTS:this._restoreArray(t,e,r,a,this._restoreFontItem);break;case j.NODE:this.restoreNode(t,e,r,a);break;case j.NODES:this.restoreNodes(t,e,r,a);break;case j.FILTER:this._restoreFilter(t,e,r,a);break;case j.FILTERS:this._restoreArray(t,e,r,a,this._restoreFilterItem);break;case j.ACTION:this.restoreAction(t,e,r,a);break;case j.ACTIONMANAGER:this.restoreActionManager(t,e,r,a);break;case j.ANIMATORS:var s=[];if(a)for(var o in a[1])a[1][o][0]===j.ACTION?s.push(this._restoreActionItem(a[1][o])):a[1][o][0]===j.ACTIONMANAGER&&s.push(this._restoreActionManagerItem(a[1][o]));t[r]=s;break;default:throw new Error("unsupported asset type:"+n)}else t[r]=a}else n.set.call(t,t,e[r])},j.prototype.atob=function(t){return decodeURIComponent(atob(t))},j.prototype.btoa=function(t){return btoa(encodeURIComponent(t))},j.prototype.unpackUTF8=function(t){var e,i,r,n,a=0,s=t.length;for(e="";a<s;)switch(i=t[a++],i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(i);break;case 12:case 13:r=t[a++],e+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=t[a++],n=t[a++],e+=String.fromCharCode((15&i)<<12|(63&r)<<6|(63&n)<<0)}return e},j.prototype.findNodeRef=function(t){var e=this.restoreContext[t]?this.restoreContext[t]:t;return this.game.nodePool.find(e)},j.prototype.saveAudio=function(t,e,i,r,n){e[r]=this._saveAudioItem(n,i)},j.prototype.restoreAudio=function(t,e,i,r){t[i]=this._restoreAudioItem(r)},j.prototype._saveAudioItem=function(t,e){return t instanceof s.SoundAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[j.AUDIO,t.key,t.uuid]):null},j.prototype._restoreAudioItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e?e instanceof s.SoundAsset?e:null:(console.error("音频资源尚未载入, 无法反序列化.",t[1]),null)},j.prototype.saveAction=function(t,e,i,r,n){e[r]=this._saveActionItem(n,i)},j.prototype.restoreAction=function(t,e,i,r){t[i]=this._restoreActionItem(r)},j.prototype._saveActionItem=function(t,e){return t instanceof s.ActionAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[j.ACTION,t.uuid]):null},j.prototype._restoreActionItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof s.ActionAsset?e:null},j.prototype.saveActionManager=function(t,e,i,r,n){e[r]=this._saveActionManagerItem(n,i)},j.prototype.restoreActionManager=function(t,e,i,r){t[i]=this._restoreActionManagerItem(r)},j.prototype._saveActionManagerItem=function(t,e){return t instanceof s.ActionManagerAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[j.ACTIONMANAGER,t.uuid]):null},j.prototype._restoreActionManagerItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof s.ActionManagerAsset?e:null},j.prototype.saveColor=function(t,e,i,r,n){e[r]=this._saveColorItem(n)},j.prototype.restoreColor=function(t,e,i,r){t[i]=this._restoreColorItem(r)},j.prototype._saveColorItem=function(t){return t instanceof vt?[j.COLOR,t.toNumber(!0)]:null},j.prototype._restoreColorItem=function(t){return t?new vt(t[1]):null},j.prototype.saveExcelAsset=function(t,e,i,r,n){e[r]=this._saveExcelAssetItem(n,i)},j.prototype.restoreExcelAsset=function(t,e,i,r){t[i]=this._restoreExcelAssetItem(r)},j.prototype._saveExcelAssetItem=function(t,e){return t instanceof s.ExcelAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[j.EXCELASSET,t.key,t.uuid]):null},j.prototype._restoreExcelAssetItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e&&e instanceof s.ExcelAsset?e:null},j.prototype.saveFont=function(t,e,i,r,n){e[r]=this._saveFontItem(n,i)},j.prototype.restoreFont=function(t,e,i,r){t[i]=this._restoreFontItem(r)},j.prototype._saveFontItem=function(t,e){if(t instanceof s.Font)var i=t;if(i&&i instanceof s.Font){e.dependences.push({key:i.key,uuid:i.uuid});var r=i.uuid;t=i.key}return[j.FONT,t,r]},j.prototype._restoreFontItem=function(t,e){if(!t)return null;e=e||this;var i=e.game.assets.find(t[1]);return i||(i=e.game.assets.findByUUID(t[2])),i||(i=t[1]),i},j.prototype.isGeom=function(t){return t instanceof s.Circle||t instanceof s.Ellipse||t instanceof s.Line||t instanceof s.Matrix||t instanceof s.Polygon||t instanceof s.Rectangle||t instanceof s.RoundedRectangle||t instanceof s.Point},j.prototype.saveGeom=function(t,e,i,r,n){e[r]=this._saveGeomItem(n,i)},j.prototype.restoreGeom=function(t,e,i,r){t[i]=this._restoreGeomItem(r)},j.prototype._saveGeomItem=function(t,e){var i=j.GEOM;return t instanceof s.Point?i=j.POINT:t instanceof s.Rectangle?i=j.RECTANGLE:t instanceof s.Circle?i=j.CIRCLE:t instanceof s.Ellipse&&(i=j.ELLIPSE),t?[i,t.class,t.toJson()]:null},j.prototype._restoreGeomItem=function(t){if(!t)return null;var e=s.Util.findClass(t[1]),i=new e;return i.fromJson(t[2]),i},j.prototype.saveNode=function(t,e,i,r,n){e[r]=this._saveNodeItem(n,i)},j.prototype.restoreNode=function(t,e,i,r){t["__BUILTIN_NODE__"+i]=r[1]},j.prototype.restoreNodes=function(t,e,i,r){t["__BUILTIN_NODE_ARRAY__"+i]=r[1]},j.prototype._saveNodeItem=function(t,e){return t instanceof s.Node?[j.NODE,t.uuid]:null},j.prototype.savePrefab=function(t,e,i,r,n){e[r]=this._savePrefabItem(n,i)},j.prototype.restorePrefab=function(t,e,i,r){t[i]=this._restorePrefabItem(r)},j.prototype._savePrefabItem=function(t,e){return t instanceof T?(e.dependences.push({key:t.uuid,uuid:t.uuid}),[j.PREFAB,t.uuid]):null},j.prototype._restorePrefabItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof T?e:null},j.prototype.saveTexture=function(t,e,i,r,n){e[r]=this._saveTextureItem(n,i)},j.prototype.restoreTexture=function(t,e,i,r){t[i]=this._restoreTextureItem(r)},j.prototype._saveTextureItem=function(t,e){if(!(t instanceof s.Texture))return null;var i=t.atlas;return e.dependences.push({key:i.key,uuid:i.uuid}),[j.TEXTURE,i.key,i.uuid,t.frame]},j.prototype._restoreTextureItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e?e instanceof s.Atlas?new s.Texture(e,t[3]):null:(console.error("贴图资源尚未载入，无法反序列化。",t[1]),null)},j.prototype.saveTextAsset=function(t,e,i,r,n){e[r]=this._saveTextAssetItem(n,i)},j.prototype.restoreTextAsset=function(t,e,i,r){t[i]=this._restoreTextAssetItem(r)},j.prototype._saveTextAssetItem=function(t,e){return t instanceof s.TextAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[j.TEXTASSET,t.key,t.uuid]):null},j.prototype._restoreTextAssetItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e?e instanceof s.TextAsset?e:null:(console.error("文本资源尚未载入, 无法反序列化.",t[1]),null)},j.registerCustomDeserializer=function(t,e){var i=j.customDeserializers;i[t]?console.error("Duplicate custom deserializer"):i[t]=e},j.prototype.getAutoType=function(t){if(t===i||null===t||NaN===t)return i;if("number"==typeof t)return j.NUMBER;if("string"==typeof t)return j.STRING;if("boolean"==typeof t)return j.BOOLEAN;if(t instanceof s.Node)return j.NODE;if(t instanceof s.Texture)return j.TEXTURE;if(t instanceof s.SoundAsset)return j.AUDIO;if(t instanceof s.TextAsset)return j.TEXTASSET;if(t instanceof s.ActionAsset)return j.ACTION;if(t instanceof s.ActionManagerAsset)return j.ACTIONMANAGER;if(this.isGeom(t))return j.GEOM;throw console.error(t),new Error("")},j.prototype.newNode=function(t,e,i){switch(t){case"qc.UIImage":return this.game.add.image(e,i);case"qc.Sprite":return this.game.add.sprite(e,i);case"qc.UIRoot":return new s.UIRoot(this.game,i);case"qc.Button":return this.game.add.button(e,i);case"qc.Toggle":return new s.Toggle(this.game,e,i);case"qc.UIText":return this.game.add.text(e,i);case"qc.Sound":return this.game.add.sound(e,i);case"qc.Video":return this.game.add.video(e,i);case"qc.Node":return this.game.add.node(e,i);case"qc.ScrollView":return this.game.add.scrollView(e,i);case"qc.ScrollBar":return this.game.add.scrollBar(e,!1,i);case"qc.InputField":return this.game.add.inputField(e,i);case"qc.ProgressBar":return this.game.add.progressBar(e,!1,i);case"qc.Slider":return this.game.add.slider(e,!1,i);case"qc.Tilemap":return this.game.add.tilemap(e,i);case"qc.TileLayer":return this.game.add.tileLayer(e,i);case"qc.ObjectLayer":return this.game.add.objectLayer(e,i);case"qc.Dom":return this.game.add.dom(e,i);case"qc.Graphics":return this.game.add.graphics(e,i);case"qc.Dropdown":return this.game.add.dropdown(e,i);default:var r=j.customDeserializers[t];if(r)return r(this.game,e,i);throw new Error("unsupported class:"+t)}},j.prototype._saveCommonType=function(t,e,i,r,n,a){e[r]=[a,n]},j.prototype._restoreCommonType=function(t,e,i,r){t[i]=e[i][1]},j.prototype._saveCommonArray=function(t,e,i,r,n,a){if(e[r]=[a,[]],n)for(var s in n)e[r][1].push(n[s])},j.prototype._restoreCommonArray=function(t,e,i,r){var n=[];if(r)for(var a in r[1])n.push(r[1][a]);t[i]=n},j.prototype._saveMapping=function(t,e,i,r,n,a){if(e[r]=[a,{}],n)for(var s in n)e[r][1][s]=n[s]},j.prototype._restoreMapping=function(t,e,i,r){var n={};if(r)for(var a in r[1])n[a]=r[1][a];t[i]=n},j.prototype._saveArray=function(t,e,i,r,n,a,s){if(e[r]=[a,[]],n)for(var o in n){var h=n[o],l=s.call(this,h,i);e[r][1].push(l)}},j.prototype._restoreArray=function(t,e,i,r,n){var a=this,s=[];if(r)for(var o in r[1])s.push(n.call(this,r[1][o],a));t[i]=s};var W=s.Camera=function(t){this.phaser=t,t._qc=this,t.roundPx=!1};W.prototype={},W.prototype.constructor=W,e.defineProperties(W.prototype,{game:{get:function(){return this.phaser.game._qc}},world:{get:function(){return this.phaser.world._qc}},id:{get:function(){return this.phaser.id}},view:{get:function(){return this.phaser.view}},position:{get:function(){return this.phaser.position},set:function(t){this.phaser.position=t}},size:{get:function(){return new s.Point(this.view.width,this.view.height)},set:function(t){this.setSize(t.x,t.y)}},x:{get:function(){return this.phaser.x},set:function(t){this.phaser.x=t}},y:{get:function(){return this.phaser.y},set:function(t){this.phaser.y=t}},width:{get:function(){return this.phaser.width},set:function(t){this.phaser.width=t}},height:{get:function(){return this.phaser.height},set:function(t){this.phaser.height=t}},bounds:{get:function(){return this.phaser.bounds},set:function(t){this.phaser.bounds=t}},visible:{get:function(){return this.phaser.visible},set:function(t){this.phaser.visible=t}},target:{get:function(){return this.phaser.target}}}),W.FOLLOW_LOCKON=o.Camera.FOLLOW_LOCKON,W.FOLLOW_PLATFORMER=o.Camera.FOLLOW_PLATFORMER,W.FOLLOW_TOPDOWN=o.Camera.FOLLOW_TOPDOWN,W.FOLLOW_TOPDOWN_TIGHT=o.Camera.FOLLOW_TOPDOWN_TIGHT,W.prototype.follow=function(t,e){null===t?this.phaser.unfollow():this.phaser.follow(t,e)},W.prototype.focusOn=function(t,e){this.phaser.focusOnXY(t,e)},W.prototype.reset=function(){this.phaser.reset()};var V=s.Game=function(e,i,r,n,a,h,l,u){var c,p=this;p.onStart=new s.Signal,p.log=new s.Log(p),p._debug=new s.Debug(p),p._device=new s.Device(p,o.Device),c="object"==typeof arguments[0]&&1===arguments.length?arguments[0]:{width:e,height:i,parent:r,state:n,transparent:a,physicsConfig:u},p.debug.on=c.debug,p.device.editor=c.editor,c.width>0&&c.height>0?p.fixedGameSize={width:c.width,height:c.height}:p.fixedGameSize=null,n=c.state,n=n||{preload:function(){},create:function(){}};var d=n.init;if(n.init=function(){var e=p.phaser;t.qc_game=p,p._nodePool=new s.NodePool(p),new s.SceneManager(e.state),new s.PluginManager(e.plugins),e.math._qc=new s.Math(e.rnd),p.timer=new s.Timer(p),p.time=new s.Time(p),p.sound=new s.SoundManager(p),p._assets=new s.Assets(p,e.load,e.cache),new s.Stage(e.stage),new s.Camera(e.camera),new s.World(e.world),new s.Input(e.input),p.dirtyRectangle=new s.DirtyRectangle(e),e.renderer.dirtyRectangle=p.dirtyRectangle,p.dirtyRectangle.enable=c.dirtyRectangles,p.dirtyRectangle.showDirtyRegion=c.dirtyRectanglesShow,p.canvas.style.outline=0,p.container&&p.container.style&&p.container.style.setProperty&&p.container.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null),p.plugins.add(s.dragonBonesDriver),p.plugins.add(s.CleanPIXISpriteRetainer),p._serializer=new s.Serializer(p),p._storage=new s.Storage(p),p.phaser.scale.pageAlignHorizontally=!0,p.phaser.scale.pageAlignVertically=!0,p.phaser.scale.scaleMode=o.ScaleManager.SHOW_ALL,p.phaser.scale.onSizeChange.add(function(){p.device.resetOrientation()}),p.device.resetOrientation(),d&&d.call(n),t.qc.initGame&&t.qc.initGame(p),p.onStart.dispatch()},c.state=n,c.renderer=null==c.renderer?o.AUTO:c.renderer,!("antialias"in c)){var f;switch(c.renderer){case o.HEADLESS:case o.CANVAS:f=!1;break;case o.AUTO:var _=function(){try{if(t.__wx)return!0;var e=document.createElement("canvas");return e.screencanvas=!1,!!t.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}();f=!!_;default:f=!0}c.antialias=f}if(c.disableVisibilityChange=c.runInBackground,c.disableVisibilityChange=null==c.disableVisibilityChange||c.disableVisibilityChange,!c.resolution){var g=t.devicePixelRatio;"number"==typeof c.resolutionRatio?c.resolution=1+Math.max(0,(g-1)*c.resolutionRatio):p.device.desktop?c.resolution=g:c.resolution=1+Math.max(0,(g-1)/4)}var m=c.backgroundColor;null==m&&(m=vt.background),m instanceof vt&&(m=m.toNumber()),c.backgroundColor=m,p.phaser=new o.Game(c),p.phaser._qc=this,this.phaser._calcTransformCount=0,p.phaser.forceSingleUpdate=!0,p.add=new ae(p)};e.defineProperties(V.prototype,{id:{get:function(){return this.phaser.id}},config:{get:function(){return this.phaser.config},set:function(t){this.phaser.config=t}},physicsConfig:{get:function(){return this.phaser.physicsConfig},set:function(t){this.phaser.physicsConfig=t}},parent:{get:function(){return this.phaser.parent}},width:{get:function(){return this.phaser.width}},height:{get:function(){return this.phaser.height}},resolution:{get:function(){return this.phaser.resolution}},transparent:{get:function(){return this.phaser.renderer.transparent},set:function(t){this.phaser.renderer.transparent=t}},antialias:{get:function(){return this.phaser.antialias},set:function(t){var e=this.phaser;if(e.antialias!==t){for(var i in e.antialias=t,e.stage.smoothed=t,h.BaseTextureCache)h.BaseTextureCache[i].scaleMode=t?h.scaleModes.LINEAR:h.scaleModes.NEAREST,this.phaser.renderType===o.WEBGL&&h.BaseTextureCache[i].dirty();this.dirtyRectangle.forceDirty=!0}}},isBooted:{get:function(){return this.phaser.isBooted}},isRunning:{get:function(){return this.phaser.isRunning}},camera:{get:function(){return this.phaser.camera._qc}},canvas:{get:function(){return this.phaser.canvas}},onPause:{get:function(){return this.phaser.onPause}},onResume:{get:function(){return this.phaser.onResume}},onBlur:{get:function(){return this.phaser.onBlur}},onFocus:{get:function(){return this.phaser.onFocus}},state:{get:function(){return this.phaser.state._qc}},scene:{get:function(){return this.phaser.state._qc}},stage:{get:function(){return this.phaser.stage._qc}},container:{get:function(){return this.phaser.canvas.parentNode}},input:{get:function(){return this.phaser.input._qc}},plugins:{get:function(){return this.phaser.plugins._qc}},math:{get:function(){return this.phaser.math._qc}},assets:{get:function(){return this._assets}},world:{get:function(){return this.phaser.world?this.phaser.world._qc:null}},serializer:{get:function(){return this._serializer}},nodePool:{get:function(){return this._nodePool}},storage:{get:function(){return this._storage}},paused:{get:function(){return this.phaser.paused},set:function(t){this.phaser.paused=t}},stepCount:{get:function(){return this.phaser.stepCount}},stepping:{get:function(){return this.phaser.stepping}},device:{get:function(){return this._device}},debug:{get:function(){return this._debug}}}),V.prototype.shutdown=function(){this.input.enable=!1,this.state.clearWorld(!0),this.assets.clear(),this.phaser.destroy()},V.prototype.enableStep=function(){this.phaser.enableStep()},V.prototype.disableStep=function(){this.phaser.disableStep()},V.prototype.step=function(){this.phaser.step()},V.prototype.updateScale=function(t){var e=this.phaser.scale;e&&(e._lastUpdate=0,t&&e.preUpdate())},V.prototype.fullScreen=function(){var e,i,r=this;r._adjustToFullScreen||(r._adjustToFullScreen=function(n){if(!r.isBooted||!r.input.inputting){var a=document.documentElement.clientWidth||t.innerWidth;t.innerWidth&&t.innerWidth<a&&(a=t.innerWidth);var s=document.documentElement.clientHeight||t.innerHeight;t.innerHeight&&t.innerHeight<s&&(s=t.innerHeight),(e!==a||i!==s||n)&&(e=a,i=s,r.device.iOS?(r.setGameSize(a-5,s+5),r.phaser.time.events.add(1,function(){r.setGameSize(a,s)})):r.setGameSize(a,s),r.container&&r.container.style&&(r.container.style.width=a+"px",r.container.style.height=s+"px"),r.updateScale(),r.device.phaser.UCBrowser&&(t.scrollTo(0,1),setTimeout(function(){var e=document.createElement("div");e.style.position="absolute",e.style.top=s+"px",e.style.width="100px",e.style.height="100px",document.body.appendChild(e),t.scrollTo(0,s),setTimeout(function(){t.scrollTo(0,1),document.body.removeChild(e)},10)},10)))}},t.addEventListener("orientationchange",r.updateGameLayout.bind(r,!1),!1),t.addEventListener("resize",r.updateGameLayout.bind(r,!1),!1),t.scrollTo(0,1),r._adjustToFullScreen())},V.prototype.setGameSize=function(t,e){this.fixedGameSize||this.phaser.scale.setGameSize(t,e),this.updateScale()},V.prototype.updateGameLayout=function(t){this._adjustToFullScreen&&this._adjustToFullScreen(t),this.world.updateDomRoot()},V.prototype.update=function(t){var e=this.phaser;if(this.time){t=this.time.now;(!this._lastUpdateGameSizeTime||t-this._lastUpdateGameSizeTime>1e3)&&(this._lastUpdateGameSizeTime=t,this.updateGameLayout())}e._calcTransformCount=0,e.time.update(t);var i=1/e.time.desiredFps;try{if(e._kickstart)return this.updateLogic(i),e._calcTransformCount=0,e.stage.updateTransform(),this.updateRender(e.time.slowMotion*e.time.desiredFps),void(e._kickstart=!1);if(!(e._spiraling>1)||e.forceSingleUpdate){var r=1e3*e.time.slowMotion/e.time.desiredFps;e._deltaTime+=Math.max(Math.min(3*r,e.time.elapsed),0);var n=0;e.updatesThisFrame=Math.floor(e._deltaTime/r),e.forceSingleUpdate&&(e.updatesThisFrame=Math.min(1,e.updatesThisFrame));for(var a=!1;e._deltaTime>=r&&(e._deltaTime-=r,e.currentUpdateID=n,a||this._paused||this.pendingStep||(a=!0),a&&(e.updateFrameDelta(),this.updateLogic(i),e._calcTransformCount=0,e.stage.updateTransform()),n++,!e.forceSingleUpdate||1!==n););return n>e._lastCount?e._spiraling++:n<e._lastCount&&(e._spiraling=0),e._lastCount=n,a&&this.updateRender(e._deltaTime/r),a}e.time.time>e._nextFpsNotification&&(e._nextFpsNotification=e.time.time+1e4,e.fpsProblemNotifier.dispatch()),e._deltaTime=0,e._spiraling=0,e.updateRender(e.time.slowMotion*e.time.desiredFps)}catch(t){this.log.error("{0}",t)}},V.prototype.updateLogic=function(t){var e=Date.now(),i=this.phaser;if(i._paused||i.pendingStep)i.scale.pauseUpdate(),i.state.pauseUpdate(),i.debug.preUpdate();else{this.timer&&this.timer.update(this.time.now),i.stepping&&(i.pendingStep=!0);var r=Date.now();i.scale.preUpdate(),i.debug.preUpdate(),i.world.camera.preUpdate(),i.state.preUpdate(t),i.plugins.preUpdate(t),i.stage.preUpdate(),i.physics.preUpdate(),this.debug.preUpdate+=Date.now()-r,r=Date.now(),i.input.update(),i.state.update(),i.stage.update(),i.tweens.update(t),i.sound.update(),i.physics.update(),i.plugins.update(),this.debug.update+=this.time.now-r,r=Date.now(),i.stage.postUpdate(),i.plugins.postUpdate(),this.debug.postUpdate+=Date.now()-r,r=Date.now()}this.debug.logic+=Date.now()-e},V.prototype.updateRender=function(t){var e=Date.now(),i=this.phaser;i.lockRender||(i.state.preRender(t),i.renderer.render(i.stage),i.plugins.render(t),i.state.render(t),i.plugins.postRender(t),s.CanvasPool.postRender(),this.debug.render+=Date.now()-e)},o.Game.prototype.gamePaused=function(t){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},o.Game.prototype.gameResumed=function(t){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))};var z=o.Game.prototype.parseConfig;o.Game.prototype.parseConfig=function(t){z.call(this,t),"antialias"in t&&(this.antialias=!!t.antialias)};var G=o.RequestAnimationFrame.prototype.updateSetTimeout;o.RequestAnimationFrame.prototype.updateSetTimeout=function(){try{G.call(this)}catch(t){this.game._qc.log.error("Error：{0}",t)}};var Y=o.RequestAnimationFrame.prototype.updateRAF;o.RequestAnimationFrame.prototype.updateRAF=function(t){try{Y.call(this,t)}catch(t){this.game._qc.log.error("Error：{0}",t)}},o.Game.prototype.updateFrameDelta=function(t){var e=this,i=e.time,r=i.time,n=e.__lastFrameTime?r-e.__lastFrameTime:t;e.__lastFrameTime=r,i.frameDeltaTime=n/i.slowMotion,i._totalEscapeTime=i.frameDeltaTime+(i._totalEscapeTime||0)};s.Plugin=o.Plugin;var X=s.PluginManager=function(t){t._qc=this,this.phaser=t};X.prototype={},X.prototype.constructor=X,e.defineProperties(X.prototype,{game:{get:function(){return this.phaser.game._qc}},plugins:{get:function(){return this.phaser.plugins}}}),X.prototype.add=function(t){t=this.phaser.add.apply(this.phaser,arguments);return t.game=this.game,t},X.prototype.remove=function(t){this.phaser.remove(t)},X.prototype.removeAll=function(){this.phaser.removeAll()},X.prototype.destroy=function(){this.phaser.destroy(),delete this.phaser},s.Signal=o.Signal,s.SignalBinding=o.SignalBinding;var H=s.Stage=function(t){this.phaser=t,t._qc=this};H.prototype={},H.prototype.constructor=H,e.defineProperties(H.prototype,{game:{get:function(){return this.phaser.game._qc}},name:{get:function(){return this.phaser.name},set:function(t){this.phaser.name=t}},runInBackground:{get:function(){return this.phaser.disableVisibilityChange},set:function(t){this.phaser.disableVisibilityChange=t}},useLanguages:{get:function(){return this.phaser.useLanguages},set:function(t){this.phaser.useLanguages=t}},backgroundColor:{get:function(){return new vt(this.phaser.backgroundColor)},set:function(t){if(t=t||vt.background,!(t instanceof vt))throw new Error("Expected qc.Color");this.phaser.backgroundColor=t.toNumber()}},x:{get:function(){return 0}},y:{get:function(){return 0}},rect:{get:function(){return new s.Rectangle(0,0,this.game.width,this.game.height)}},pivotX:{get:function(){return 0},set:function(t){throw new Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(t){throw new Error("pivotY cannot be modified")}},worldTransform:{get:function(){return this.phaser.worldTransform}}}),H.prototype.updateTransform=function(){this.phaser.updateTransform()},H.prototype.destroy=function(){this.phaser.destroy(),delete this.phaser};var q=s.State=function(){var t=new o.State;this.phaser=t,t._qc=this};q.prototype={},q.prototype.constructor=q,e.defineProperties(q.prototype,{game:{get:function(){return this.phaser.game}},key:{get:function(){return this.phaser.key},set:function(t){this.phaser.key=t}},add:{get:function(){return this.phaser.add._qc},set:function(t){this.phaser.add=t.phaser,t.phaser._qc=t}},make:{get:function(){return this.phaser.make._qc},set:function(t){this.phaser.make=t.phaser,t.phaser._qc=t}},camera:{get:function(){return this.phaser.camera._qc},set:function(t){this.phaser.camera=t.phaser,t.phaser._qc=t}},assets:{get:function(){return this._assets},set:function(t){this._assets=t}},input:{get:function(){return this.phaser.input._qc},set:function(t){this.phaser.input=t.phaser,t.phaser._qc=t}},math:{get:function(){return this.phaser.math._qc},set:function(t){this.phaser.math=t.phaser,t.phaser._qc=t}},time:{get:function(){return this.phaser.time._qc},set:function(t){this.phaser.time=t.phaser,t.phaser._qc=t}},tweens:{get:function(){return this.phaser.tweens._qc},set:function(t){this.phaser.tweens=t.phaser,t.phaser._qc=t}},world:{get:function(){return this.phaser.world?this.phaser.world._qc:null},set:function(t){this.phaser.world=t.phaser,t.phaser._qc=t}},physics:{get:function(){return this.phaser.physics._qc},set:function(t){this.phaser.physics=t.phaser,t.phaser._qc=t}}});var K=s.SceneManager=function(t){t._qc=this,this.phaser=t,this._onPreload=new s.Signal,this._onCreate=new s.Signal,this.onStartLoad=new s.Signal,this.onEndLoad=new s.Signal};K.prototype={},K.prototype.constructor=K,e.defineProperties(K.prototype,{game:{get:function(){return this.phaser.game._qc}},entry:{get:function(){return this._entry},set:function(t){this._entry=t}},list:{get:function(){return this._list},set:function(t){this._list=t;var e=this;for(var i in t){var r=t[i],n={preload:function(){e._onPreload.dispatch();var t=e.game.assets.find(e.current+".bin");if(t)for(var i in t.dependences){var r=t.dependences[i];e.game.assets.loadByUUID(r.uuid,function(t){t||(e.game.log.important("场景的依赖资源({0})加载失败.",r.uuid),"function"==typeof e.game.loadingProcessCallback&&e.game.loadingProcessCallback(r.key))})}},create:function(){try{e._parse()}catch(t){e.game.log.error("Parse scene fail：{0}",t),s.Util.popupError(t.message)}e.loading=!1,e._onCreate.dispatch(),e.onEndLoad.dispatch(n)}};this.phaser.add(r,n,!1)}}},loading:{get:function(){return this._loading||!1},set:function(t){this._loading=t}},current:{get:function(){return this.phaser.current}}}),K.prototype.download=function(t,e){t=t||this.entry;var i=t+".bin";this.game.log.trace("Start downloading scene:{0}",t),this.game.assets.beginBatchLoad(),this.game.assets.load(i,i,e),this.game.assets.endBatchLoad()},K.prototype.load=function(t,e,i,r){var n=this;n.loading?console.warn("Cannot call when switching scene."):(t=t||n.entry,/\//.test(t)||(t="Assets/scene/"+t),n.list.indexOf(t)<0?n.game.log.error("Scene:{0} not exists",t):(n.loading=!0,n.onStartLoad.dispatch(t),n.clearWorld(),!0!==e&&(e=!1),e&&n.game.assets.clear(),n.download(t,function(a){"function"==typeof i&&n._onPreload.addOnce(i),"function"==typeof r&&n._onCreate.addOnce(r),n.phaser.start(t,!1,e)})))},K.prototype.clearWorld=function(t){var e=this.game.world.children.slice(0);e.forEach(function(e){!t&&e.ignoreDestroy||e.destroy()})},K.prototype.destroy=function(){this.entry=i,this.list=[],this.phaser.destroy()},K.prototype._parse=function(){var t=this.current+".bin",e=this.game.assets.find(t);if(e){var i=e.json.data;this.game.serializer.restoreState(i),this.game.world._prefab=t}else this.game.log.error("Can not find scene {0} from assets",state)};var J=s.World=function(e){var i=this;if(i.onModelChange=new s.Signal,s.Node.call(i,e,i),i.name="world",i.onSizeChange.add(function(){i.relayout()}),i._toDestroyQ=[],t.__wx)return i.backDomRoot=null,void(i.frontDomRoot=null);i.game.container.style.overflow="hidden",i.backDomRoot=document.createElement("div"),i.backDomRoot.style.position="absolute",i.backDomRoot.style.left="0px",i.backDomRoot.style.top="0px",i.backDomRoot.style.overflow="hidden",i.game.container.insertBefore(i.backDomRoot,i.game.canvas),i.frontDomRoot=document.createElement("div"),i.frontDomRoot.style.position="absolute",i.frontDomRoot.style.left="0px",i.frontDomRoot.style.top="0px",i.frontDomRoot.style.overflow="hidden",i.game.container.appendChild(i.frontDomRoot)};J.prototype=e.create(s.Node.prototype),J.prototype.constructor=J,J.prototype.getMeta=function(){s.Serializer;var t=s.Node.prototype.getMeta.call(this);return delete t.uuid,t},J.prototype.relayout=function(){for(var t=this.children,e=0;e<t.length;e++)t[e].relayout()},e.defineProperties(J.prototype,{bounds:{get:function(){return this.phaser.bounds},set:function(t){this.phaser.setBounds(t.x,t.y,t.width,t.height)}},camera:{get:function(){return this.phaser.camera}},width:{get:function(){return this._editorWidth!==i?this._editorWidth:this.phaser.width},set:function(t){this.width!==t&&(this.phaser.width=t,this.phaser.displayChanged(s.DisplayChangeStatus.SIZE),e.getOwnPropertyDescriptor(s.Node.prototype,"width").set.call(this,t))}},height:{get:function(){return this._editorHeight!==i?this._editorHeight:this.phaser.height},set:function(t){this.height!==t&&(this.phaser.height=t,this.phaser.displayChanged(s.DisplayChangeStatus.SIZE),e.getOwnPropertyDescriptor(s.Node.prototype,"height").set.call(this,t))}},centerX:{get:function(){return this.phaser.centerX}},centerY:{get:function(){return this.phaser.centerY}},pivotX:{get:function(){return 0},set:function(t){throw new Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(t){throw new Error("pivotY cannot be modified")}},onSizeChange:{get:function(){return this.game.phaser.scale.onSizeChange}}}),J.prototype.preUpdate=function(){this._toDestroyQ.forEach(function(t){t.destroyImmediately()}),this._toDestroyQ.length=0},J.prototype.addToDestroy=function(t){this._toDestroyQ.push(t)},J.prototype.updateDomRoot=function(){if(!(t.__wx||this.game.isBooted&&this.game.input.inputting)){var e=this.frontDomRoot.style,i=this.backDomRoot.style,r=this.game.canvas.style;e.width=i.width=r.width,e.height=i.height=r.height,e.marginLeft=i.marginLeft=r.marginLeft,e.marginTop=i.marginTop=r.marginTop,e.marginRight=i.marginRight=r.marginRight,e.marginBottom=i.marginBottom=r.marginBottom}};var Z=s.Input=function(t){var e=this;t._qc=e;var i=t.destroy;t.destroy=function(){e.destroy(),i.call(t)};var r=t.update;t.update=function(){e.update(),r.call(t)},e.phaser=t,
e.game=t.game._qc,e._inputting=0,e.cursorPosition=new s.Point(NaN,NaN),e.onKeyDown=new o.Signal,e.onKeyUp=new o.Signal,e.onKeyRepeat=new o.Signal,e.onCursorMove=new o.Signal,e.onWheel=new o.Signal,e.onPointerUp=new o.Signal,e.onPointerDown=new o.Signal,e.onPointerMove=new o.Signal,e.nativeMode=!1,e.keyboard=new s.Keyboard(this),e.mouse=new s.Mouse(this),e.touch=new s.Touch(this),e.module=new s.BaseInputModule(e.game,e),e._init()};Z.prototype={},Z.prototype.constructor=Z,e.defineProperties(Z.prototype,{wheelDeltaX:{get:function(){return this._wheelDeltaX}},wheelDeltaY:{get:function(){return this._wheelDeltaY}},keyCount:{get:function(){return this.keyboard.keyCount}},keyCodes:{get:function(){return this.keyboard.keyCodes}},mouseCount:{get:function(){return this.mouse.mouseCount}},mouseIds:{get:function(){return this.mouse.mouseIds}},touchCount:{get:function(){return this.touch.touchCount}},touchIds:{get:function(){return this.touch.touchIds}},pointerCount:{get:function(){return this.mouseCount+this.touchCount}},pointers:{get:function(){return this.mouseIds.concat(this.touchIds)}},enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},inputting:{get:function(){return this._inputting>0}}}),Z.prototype._init=function(){var t=this;t.phaser.game.onBlur.add(this._onBlur,this),t.keyboard.onKeyUp.add(this.processKeyUp,this),t.keyboard.onKeyDown.add(this.processKeyDown,this),t.keyboard.onKeyRepeat.add(this.processKeyRepeat,this),t.mouse.onMouseDown.add(this.processPointerDown,this),t.mouse.onMouseUp.add(this.processPointerUp,this),t.mouse.onMousePressMove.add(this.processPointerMove,this),t.mouse.onMouseMove.add(this.processMouseMove,this),t.mouse.onMouseWheel.add(this.processMouseWheel,this),t.touch.onTouchStart.add(this.processPointerDown,this),t.touch.onTouchEnd.add(this.processPointerUp,this),t.touch.onTouchMove.add(this.processPointerMove,this),t.enable=!0},Z.prototype.destroy=function(){this.phaser.game.onBlur.remove(this._onBlur,this),this.keyboard.onKeyUp.remove(this.processKeyUp,this),this.keyboard.onKeyDown.remove(this.processKeyDown,this),this.keyboard.onKeyRepeat.remove(this.processKeyRepeat,this),this.mouse.onMouseDown.remove(this.processPointerDown,this),this.mouse.onMouseUp.remove(this.processPointerUp,this),this.mouse.onMousePressMove.remove(this.processPointerDown,this),this.mouse.onMouseMove.remove(this.processMouseMove,this),this.mouse.onMouseWheel.remove(this.processMouseWheel,this),this.touch.onTouchStart.remove(this.processPointerDown,this),this.touch.onTouchEnd.remove(this.processPointerUp,this),this.touch.onTouchMove.remove(this.processPointerMove,this),this.module&&this.module.destroy(),this.keyboard&&this.keyboard.destroy(),this.mouse&&this.mouse.destroy(),this.touch&&this.touch.destroy(),this.onKeyDown.removeAll(),this.onKeyUp.removeAll(),this.onKeyRepeat.removeAll(),this.onCursorMove.removeAll(),this.onWheel.removeAll(),this.onPointerDown.removeAll(),this.onPointerMove.removeAll(),this.onPointerUp.removeAll(),this.phaser=null,this.module=null,this.keyboard=null,this.mouse=null,this.touch=null},Z.prototype._setEnable=function(t){this._enable!==t&&(this._enable=t,this.touch&&(this.touch.enable=t),this.mouse&&(this.mouse.enable=t),this.keyboard&&(this.keyboard.enable=t))},Z.prototype.update=function(){this._wheelDeltaX=0,this._wheelDeltaY=0,this.keyboard.update(),this.touch.update(),this.mouse.update(),this.module.update()},Z.prototype._onBlur=function(){this.module.lossFocus(),this.keyboard.lossFocus(),this.mouse.lossFocus(),this.touch.lossFocus()},Z.prototype.processKeyDown=function(t,e){this.onKeyDown.dispatch(t,e)},Z.prototype.processKeyUp=function(t,e){this.onKeyUp.dispatch(t,e)},Z.prototype.processKeyRepeat=function(t,e){this.onKeyRepeat.dispatch(t,e)},Z.prototype.isKeyDown=function(t){return this.keyboard.isKeyDown(t)},Z.prototype.isAnyKeyDown=function(){return this.keyboard.isAnyKeyDown()},Z.prototype.isAnyKey=function(){return this.keyboard.isAnyKey()},Z.prototype.isAltDown=function(){return this.isKeyDown(s.Keyboard.ALT)},Z.prototype.isControlDown=function(){return this.isKeyDown(s.Keyboard.CONTROL)},Z.prototype.isShiftDown=function(){return this.isKeyDown(s.Keyboard.SHIFT)},Z.prototype.isMetaDown=function(){return this.isKeyDown(s.Keyboard.META)||this.isKeyDown(s.Keyboard.META_RWIN)||this.isKeyDown(s.Keyboard.META_RMAC)},Z.prototype.hasCursor=function(){return!isNaN(this.cursorPosition.x)&&!isNaN(this.cursorPosition.y)},Z.prototype.isMouse=function(t){return t<0&&t>=s.Mouse.BUTTON_FORWORD},Z.prototype.isAnyMouse=function(){return this.mouse.isAnyMouse()},Z.prototype.isAnyMouseDown=function(){return this.mouse.isAnyMouseDown()},Z.prototype.isMouseDown=function(t){return this.mouse.isMouseDown(t)},Z.prototype.isAnyTouch=function(){return this.touch.isAnyTouch()},Z.prototype.isAnyTouchStart=function(){return this.touch.isAnyTouchStart()},Z.prototype.isTouchStart=function(t){return this.touch.isTouchStart(t)},Z.prototype.isAnyPointer=function(){return this.touch.isAnyTouch()||this.mouse.isAnyMouse()},Z.prototype.isAnyPointerStart=function(){return this.touch.isAnyTouchStart()||this.mouse.isAnyMouseDown()},Z.prototype.isPointerStart=function(t){return this.isMouse(t)?this.isMouseDown(t):this.isTouchStart(t)},Z.prototype.getPointer=function(t){return t<0&&t>=s.Mouse.BUTTON_FORWORD?this.mouse.getMouseById(t):this.touch.getTouchById(t)},Z.prototype.processMouseMove=function(t,e){this.cursorPosition.x=t,this.cursorPosition.y=e,this.onCursorMove.dispatch(t,e)},Z.prototype.processMouseWheel=function(t,e){this._wheelDeltaX=t,this._wheelDeltaY=e,this.onWheel.dispatch(t,e)},Z.prototype.processPointerDown=function(t,e,i){this.onPointerDown.dispatch(t,e,i)},Z.prototype.processPointerUp=function(t,e,i){this.onPointerUp.dispatch(t,e,i)},Z.prototype.processPointerMove=function(t,e,i){this.onPointerMove.dispatch(t,e,i)},Z.prototype.ignoreDomEvent=function(t){var e=this,i=e.findDomNodeWithEvent(t);return i&&i.interactive&&i.hitArea},Z.prototype.findDomNodeWithEvent=function(t){var e=this,i=t.target;if(!i||i===e.game.world.frontDomRoot||i===e.game.world.backDomRoot||i===e.game.canvas.parentNode)return null;for(;i&&!i._qc;)i=i.parentNode;return i?i._qc:null};var Q=s.Debug=function(t){var e=this;e._game=t,e.on=!1,e.animation=0,e.total=0,e.logic=0,e.render=0,e.preUpdate=0,e.update=0,e.postUpdate=0,e.clientId=0};Q.prototype={},Q.prototype.constructor=Q,e.defineProperties(Q.prototype,{game:{get:function(){return this._game}},on:{get:function(){return this._on||!1},set:function(t){this._on=t,t&&(this.game.log.enableTrace=!0)}},remoteLogUrl:{set:function(t){}}});var $=s.Device=function(t,e){var i=this;i.phaser=e,i._game=t,i._orientation=$.PORTRAIT,i.onOrientationChange=new s.Signal};$.prototype={},$.prototype.constructor=Q,e.defineProperties($.prototype,{game:{get:function(){return this._game}},desktop:{get:function(){return this.phaser.initialized?this.phaser.desktop:(this._isDesktop===i&&this.checkOS(),this._isDesktop)}},iOS:{get:function(){return this.phaser.iOS}},android:{get:function(){return this.phaser.android}},webGL:{get:function(){return this.phaser.webGL}},vibration:{get:function(){return this.phaser.vibration}},browser:{get:function(){return this.phaser.chrome?$.CHROME:this.phaser.arora?$.ARORA:this.phaser.epiphany?$.EPIPHANY:this.phaser.firefox?$.FIREFOX:this.phaser.trident?$.TRIDENT:this.phaser.ie?$.IE:this.phaser.mobileSafari?$.MOBILE_SAFARI:this.phaser.midori?$.MIDORI:this.phaser.opera?$.OPERA:this.phaser.safari?$.SAFARI:this.phaser.silk?$.SILK:this.phaser.UCBrowser?$.UCBROWSER:$.UNKNOW}},resolution:{get:function(){return t.devicePixelRatio}},fullscreen:{get:function(){return this.phaser.fullscreen}},editor:{get:function(){return this._editor||!1},set:function(t){this._editor=t,t&&(this.game.debug.on=!0)}},orientation:{get:function(){return this._orientation},set:function(t){this.orientation!==t&&(this._orientation=t,this.onOrientationChange.dispatch(t))}}}),$.UNKNOW=-1,$.CHROME=0,$.ARORA=1,$.EPIPHANY=2,$.FIREFOX=3,$.IE=4,$.TRIDENT=5,$.MOBILE_SAFARI=6,$.MIDORI=7,$.OPERA=8,$.SAFARI=9,$.WEBAPP=10,$.SILK=11,$.UCBROWSER=12,$.AUTO=0,$.PORTRAIT=1,$.LANDSCAPE=2,$.prototype.resetOrientation=function(){this.game.world.width>this.game.world.height?this.orientation=$.LANDSCAPE:this.orientation=$.PORTRAIT},$.prototype.isCanvasRenderer=function(){return this.game.phaser.renderType===o.CANVAS},$.prototype.isWebGLRenderer=function(){return this.game.phaser.renderType===o.WEBGL},$.prototype.checkOS=function(){var t=navigator.userAgent,e={};/Playstation Vita/.test(t)?e.vita=!0:/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?e.kindle=!0:/Android/.test(t)?e.android=!0:/CrOS/.test(t)?e.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?e.iOS=!0:/Linux/.test(t)?e.linux=!0:/Mac OS/.test(t)?e.macOS=!0:/Windows/.test(t)&&(e.windows=!0,/Windows Phone/i.test(t)&&(e.windowsPhone=!0));var i=/Silk/.test(t);this._isDesktop=!1,(e.windows||e.macOS||e.linux&&!i||e.chromeOS)&&(this._isDesktop=!0),(e.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(this._isDesktop=!1)},s.RenderTexture=h.RenderTexture,s.RenderTexture.prototype.resize=function(t,e,i){t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=e*this.resolution,i&&(this.baseTexture.width=Math.round(this.width*this.resolution),this.baseTexture.height=Math.round(this.height*this.resolution)),this.renderer.type===h.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(Math.round(this.width*this.resolution),Math.round(this.height*this.resolution)))},s.RenderTexture.prototype.directRenderWebGL=function(t,e,i){if(this.valid){var r={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=e?e.x:0,this.renderer.offset.y=e?e.y:0;var n=this.renderer.gl;if(n.isContextLost())return!1;if(!n.replace){var a=n.viewport;n.viewport=function(t,e,i,r){(0===i||0===r||i*r<0)&&console.log("viewPort:",t,e,i,r,i*r),a.call(n,t,e,i,r)},n.replace=!0}n.viewport(0,0,this.width*this.resolution,this.height*this.resolution),n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear();var s=n.getError();s&&console.log("webgl gl.getError(",s,")"),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0,this.renderer.offset.x=r.x,this.renderer.offset.y=r.y}},h.RenderTexture.prototype.directRenderCanvas=function(t,e,i){if(this.valid){var r={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=e?e.x:0,this.renderer.offset.y=e?e.y:0,i&&this.textureBuffer.clear();var n=this.textureBuffer.context,a=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,n),this.renderer.resolution=a,this.renderer.offset.x=r.x,this.renderer.offset.y=r.y}},s.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid){t.game._qc.renderInRenderTexture=!0;var r=t.getWorldTransform();r.identity(),r.translate(0,2*this.projection.y),e&&r.append(e),r.scale(1,-1),t.worldAlpha=1,t._isSubNeedCalcTransform=!0;for(var n=t.children,a=0,s=n.length;a<s;a++)n[a].updateTransform();t.game._qc.renderInRenderTexture=!1;var o=this.renderer.gl;o.viewport(0,0,this.width*this.resolution,this.height*this.resolution),o.bindFramebuffer(o.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0,t._isNotNeedCalcTransform=!1}},h.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid){t.game._qc.renderInRenderTexture=!0;var r=t.worldTransform;r.identity(),e&&r.append(e),t.worldAlpha=1,t._isSubNeedCalcTransform=!0;for(var n=t.children,a=0,s=n.length;a<s;a++)n[a].updateTransform();t.game._qc.renderInRenderTexture=!1,i&&this.textureBuffer.clear();var o=this.textureBuffer.context,h=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,o),this.renderer.resolution=h,t._isNotNeedCalcTransform=!1}};var tt=s.SoftClipManager=function(t){this.renderSession=t,this._polygons=[]};tt.prototype={},tt.prototype.constructor=tt,e.defineProperties(tt.prototype,{needClip:{get:function(){return!!this._polygons.length}}}),tt.getManager=function(t){var e=t.softClipManager;return e||(e=t.softClipManager=new tt(t)),e},tt.prototype.pushPolygon=function(t){var e=this,i=[];if(e.renderSession.spriteBatch.batchType=s.BATCH_TRIANGLES,e._polygons.length){for(var r=e._polygons[e._polygons.length-1],n=r.length;n--;){var a=r[n];for(o=arguments.length;o--;){t=arguments[o];l=s.GeometricTool.sutherlandHodgman(t,a);i.push(l)}}e._polygons.push(i)}else{for(var o=arguments.length;o--;){var h=arguments[o],l=s.GeometricTool.quickDecomp(h);if(l.length)Array.prototype.push.apply(i,l);else for(var u=p.Triangulate(h),c=0;c<u.length;c+=3){var d=u[c],f=u[c+1],_=u[c+2];i.push([h[d],h[f],h[_]])}}e._polygons.push(i)}},tt.prototype.popPolygon=function(){var t=this;t._polygons.length&&t._polygons.splice(t._polygons.length-1,1),t._polygons.length||(t.renderSession.spriteBatch.batchType=s.BATCH_QUAD)},tt.prototype.getClipPolygon=function(t,e,i,r,n,a){var o=this,h=[],l=o._polygons[o._polygons.length-1],u=l.length,c=1/(t*r+i*-e);t*=c,e*=c,i*=c,r*=c;for(var p=a*i-n*r,d=-a*t+n*e,f=-1;++f<u;){for(var _=l[f],g=[],m=_.length,y=-1;++y<m;){var v=_[y];g.push(new s.Point(r*v.x-i*v.y+p,t*v.y-e*v.x+d))}h.push(g)}return h},tt.prototype.renderSprite=function(t,e,i,r,n,a,o,h,l,u,c,p,d,f,_,g,m){var y=this.getClipPolygon(c,p,d,f,_,g);if(0!==y.length){var v=[new s.Point(i,r),new s.Point(n,r),new s.Point(n,a),new s.Point(i,a)],T={x:i,y:r,width:n-i,height:a-r};if(T.width&&T.height)for(var x=function(t,e,i,r,n,a){return{x:e+(t.x-a.x)/a.width*(i-e),y:r+(t.y-a.y)/a.height*(n-r)}},b=y.length;b--;){var A=y[b],S=s.GeometricTool.sutherlandHodgman(A,v),w=S.length;if(!(w<3)){for(var P=[],E=[],D=-1;++D<w;)P[D]=x(S[D],o,l,h,u,T),E.push({x:c*S[D].x+d*S[D].y+_,y:f*S[D].y+p*S[D].x+g});var C=s.GeometricTool.Triangulate(E);if(C)for(D=0;D<C.length;D+=3){var O=C[D],M=C[D+1],I=C[D+2];this._addWebGLTriangle(t.spriteBatch,e,m,E[O],E[M],E[I],P[O],P[M],P[I])}}}}},tt.prototype._addWebGLTriangle=function(t,e,i,r,n,a,s,o,h){t.currentBatchSize>=t.triangleSize&&(t.flush(),t.currentBaseTexture=e.texture.baseTexture);var l=t.colors,u=t.positions,c=3*t.currentBatchSize*t.vertSize;t.renderSession.roundPixels?(u[c]=0|r.x,u[c+1]=0|r.y,u[c+5]=0|n.x,u[c+6]=0|n.y,u[c+10]=0|a.x,u[c+11]=0|a.y):(u[c]=r.x,u[c+1]=r.y,u[c+5]=n.x,u[c+6]=n.y,u[c+10]=a.x,u[c+11]=a.y),u[c+2]=s.x,u[c+3]=s.y,u[c+7]=o.x,u[c+8]=o.y,u[c+12]=h.x,u[c+13]=h.y,l[c+4]=l[c+9]=l[c+14]=i,t.sprites[t.currentBatchSize++]=e};var et=s.SoundManager=function(e){this.game=e,this.phaser=e.phaser.sound,this.phaser._qc=this;var i=this;e.onStart.add(function(){i._boot()}),this._soundDurationMap=t.soundDurationMap||{}};et.prototype.constructor=et,et.prototype._boot=function(){var e=this.phaser,i=this.game.input;!t.__wx&&!e.game.device.cocoonJS&&e.game.device.iOS||t.PhaserGlobal&&t.PhaserGlobal.fakeiOSTouchLock?(i.touch.callbackContext=e,e.game.device.iOSVersion>8?i.touch.touchEndCallback=e.unlock:i.touch.touchStartCallback=e.unlock,i.mouse.callbackContext=e,i.mouse.mouseDownCallback=e.unlock,e.touchLocked=!0):e.touchLocked=!1},e.defineProperties(et.prototype,{mute:{get:function(){return this.phaser.mute},set:function(t){this.phaser.mute=t}},volume:{get:function(){return this.phaser.volume},set:function(t){this.phaser.volume=t}},usingWebAudio:{get:function(){return this.phaser.usingWebAudio}},usingAudioTag:{get:function(){return this.phaser.usingAudioTag}},mp3Support:{get:function(){return this.game.phaser.device.mp3}},oggSupport:{get:function(){return this.game.phaser.device.ogg||this.game.phaser.device.opus}},webAudioSupport:{get:function(){return this.game.phaser.sound.usingWebAudio}}}),et.prototype._getAudioTagDurationInConfig=function(t){var e=t.key;return/\.bin$/i.test(e)||(e+=".bin"),this._soundDurationMap[e]||t._sound.duration},et.prototype.tryGetUrl=function(t){var e=t;return e.indexOf(".mp3.bin")>0?this.mp3Support||(e=e.replace(".mp3.bin",".ogg.bin")):e.indexOf(".ogg.bin")>0&&(this.oggSupport||(e=e.replace(".ogg.bin",".mp3.bin"))),this.webAudioSupport||(e=e.replace(".bin","")),e};var it=s.Key=function(t,e){this.game=t,this._keycode=e,this._isDown=!1,this._justDown=!1,this._justUp=!1,this.downTime=0,this.repeats=0,this._lastRepeatTime=0,this._eventList=[]};it.prototype={},it.prototype.constructor=it,e.defineProperties(it.prototype,{keyCode:{get:function(){return this._keycode}},currCharCode:{get:function(){return this._charCode},set:function(t){this._charCode=t}},isJustDown:{get:function(){var t=this._justDown;return t&&(this._justDown=!1,this._isDown=!0),t}},isJustUp:{get:function(){var t=this._justUp;return t&&(this._justUp=!1,this._isDown=!1),t}},isDown:{get:function(){return this._isDown}},duringTime:{get:function(){return this.isDown?this.game.time.fixedTime-this.downTime:-1}}}),it.prototype.destroy=function(){this.game=null},it.prototype.hasEvent=function(){return!!this._eventList.length},it.prototype.nextEvent=function(){if(!this._eventList.length)return!1;var t=this._eventList.shift();do{if(!t)break;switch(t.type){case it.DOWN:this._onDown(t.time);break;case rt.UP:this._onUp()}return!0}while(0);return!1},it.prototype.onDown=function(){return this._eventList.push({type:it.DOWN,time:this.game.time.fixedTime}),!0},it.prototype.onUp=function(){return this._eventList.push({type:it.UP}),!0},it.prototype._onDown=function(t){return!this.isDown&&!this._justDown&&(this._justDown=!0,this.downTime=t,this._lastRepeatTime=this.downTime,!0)},it.prototype._onUp=function(){return!(!this._isDown&&!this._justDown||this._justUp)&&(this._justUp=!0,!0)},it.prototype.setState=function(t){var e=(this._isDown||this._justDown)&&!this._justUp;return this._isDown=t,this._justDown=!1,this._justUp=!1,e^t},it.prototype.checkRepeat=function(t){if(!this.isDown)return!1;var e=this.game.time.fixedTime;return e-this._lastRepeatTime-t>0&&(this.repeats++,this._lastRepeatTime=e,!0)},it.UP=-1,it.DOWN=0;var rt=s.Pointer=function(t,e){this.game=t,this._id=e,this._isDown=!1,this._justDown=!1,this._justUp=!1,this.downTime=0,this.withinGame=!1,this.previousStatus=[],this._eventList=[]};rt.prototype={},rt.prototype.constructor=rt,e.defineProperties(rt.prototype,{id:{get:function(){return this._id}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},startX:{get:function(){return this._startX}},startY:{get:function(){return this._startY}},isMouse:{get:function(){return this._id<s.Mouse.NONE&&this._id>=s.Mouse.BUTTON_FORWORD}},isJustDown:{get:function(){var t=this._justDown;return t&&(this._justDown=!1,this._isDown=!0),t}},isJustUp:{get:function(){var t=this._justUp;return t&&(this._justUp=!1,this._isDown=!1),t}},isDown:{get:function(){return this._isDown}},isDowning:{get:function(){return this._justDown}},isUpping:{get:function(){return this._justUp}},deltaX:{get:function(){return this._deltaX}},deltaY:{get:function(){return this._deltaY}},distanceX:{get:function(){return this.x-this.startX}},distanceY:{get:function(){return this.y-this.startY}},deviceId:{get:function(){return this._deviceId||this.id},set:function(t){this._deviceId=t}},eventId:{get:function(){return this._eventId||this.id},set:function(t){this._eventId=t}},duringTime:{get:function(){return this.isDown?this.game.time.fixedTime-this.downTime:-1}}}),rt.prototype.destroy=function(){this.game=null},rt.prototype.update=function(){this._deltaX=this._tempX-this._x,this._deltaY=this._tempY-this._y,this._x=this._tempX,this._y=this._tempY},rt.prototype.hasEvent=function(){return!!this._eventList.length},rt.prototype.nextEvent=function(){if(!this._eventList.length)return!1;var t=this._eventList.shift();do{if(!t)break;switch(t.type){case rt.DOWN:this.withinGame=!0,this._onDown(t.x,t.y,t.time);break;case rt.UP:this._onUp(t.time);break;case rt.LEAVE:this.withinGame=!1,this._onMove(t.x,t.y);break;case rt.ENTER:this.withinGame=!0,this._onMove(t.x,t.y);break;case rt.MOVE:this._onMove(t.x,t.y);break;case rt.CANCEL:this._onCancel(t.time)}return!0}while(0);return!1},rt.prototype.onDown=function(t,e){return this._eventList.push({type:rt.DOWN,x:t,y:e,time:this.game.time.fixedTime}),!0},rt.prototype.onMove=function(t,e){var i=this._eventList.length;return i>0&&this._eventList[i-1].type===rt.MOVE?(this._eventList[i-1].x=t,this._eventList[i-1].y=e):this._eventList.push({type:rt.MOVE,x:t,y:e}),!0},rt.prototype.onLeave=function(t,e){return this._eventList.push({type:rt.LEAVE,x:t,y:e}),!0},rt.prototype.onEnter=function(t,e){return this._eventList.push({type:rt.ENTER,x:t,y:e}),!0},rt.prototype.onUp=function(){return this._eventList.push({type:rt.UP,time:this.game.time.fixedTime}),!0},rt.prototype.onCancel=function(){return this._eventList.push({type:rt.CANCEL,time:this.game.time.fixedTime}),!0},rt.prototype._onDown=function(t,e,i){return!this.isDown&&!this._justDown&&(this._justDown=!0,this.downTime=i,this._x=t,this._y=e,this._startX=t,this._startY=e,this._tempX=t,this._tempY=e,this._deltaX=0,this._deltaY=0,!0)},rt.prototype._onUp=function(t){if(!this._isDown&&!this._justDown||this._justUp)return!1;for(this._justUp=!0,this.previousStatus.unshift({startX:this._startX,startY:this._startY,endX:this.x,endY:this.y,downTime:this.downTime,upTime:t});this.previousStatus.length>10;)this.previousStatus.pop();return!0},rt.prototype._onCancel=function(t){return!this._justUp&&(this._onUp(t),!0)},rt.prototype._onMove=function(t,e){this._tempX=t,this._tempY=e},rt.prototype.isDouble=function(t,e){},rt.UP=-1,rt.DOWN=0,rt.MOVE=1,rt.ENTER=2,rt.LEAVE=3,rt.CANCEL=4;var nt=s.Keyboard=function(t,e){this.input=t,this.game=t.game,this.repeatInterval=100,this.onKeyDown=new o.Signal,this.onKeyUp=new o.Signal,this.onKeyRepeat=new o.Signal,this._keys=[],this._keyCodes={},this._capture={},this._keyDownNum=0,this._anyKeyDown=!1,this._init(e)};nt.prototype={},nt.prototype.constructor=nt,e.defineProperties(nt.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||t},set:function(t){if(t!==this._generator){var e=this.enable;this.enable=!1,this._generator=t,e&&(this.enable=!0)}}},gainFocusType:{get:function(){return this._gainFocusType},set:function(t){this._gainFocusType=t}},keyCount:{get:function(){return this._keyDownNum}},keyCodes:{get:function(){return e.keys(this._keyCodes)}}}),nt.prototype._init=function(t){this._onKeyDown=this._processKeyDown.bind(this),this._onKeyUp=this._processKeyUp.bind(this),this._onBlur=this.lossFocus.bind(this),this._onMouseOver=this._onOver.bind(this),this._onMouseClick=this._onClick.bind(this),this.generator=t,this.gainFocusType=nt.GAINFOCUS_CLICK,this.enable=!0,this.game.device.phaser.windows&&this.game.device.phaser.desktop&&this.addKeyCapture(nt.ALT)},nt.prototype.destroy=function(){this.enable=!1,this.input=null,this.generator=null,this._onKeyDown=null,this._onKeyUp=null,this._onBlur=null,this._onMouseOver=null,this._onMouseClick=null},nt.prototype.update=function(){if(this.enable){this._anyKeyDown=!1;for(var t,e=this._keys.length;e--;)if(t=this._keys[e],t)for(;t.nextEvent();)t.isJustDown&&(this._anyKeyDown=!0,this._recordKey(t.keyCode,!0),this.onKeyDown.dispatch(t.keyCode)),t.isJustUp&&(this._recordKey(t.keyCode,!1),this.onKeyUp.dispatch(t.keyCode)),t.checkRepeat(this.repeatInterval)&&this.onKeyRepeat.dispatch(t._keycode)}},nt.prototype.isKeyDown=function(t){return this._keys[t]&&this._keys[t].isDown},nt.prototype.isAnyKey=function(){return this._keyDownNum>0},nt.prototype.isAnyKeyDown=function(){return this._anyKeyDown},nt.prototype._recordKey=function(t,e){e?(this._keyDownNum++,this._keyCodes[t]=!0):(this._keyDownNum--,delete this._keyCodes[t])},nt.prototype._setEnable=function(t){if(this._enable!==t){this._enable=t;var e=this.generator;t?(e.addEventListener("keydown",this._onKeyDown,!1),e.addEventListener("keyup",this._onKeyUp,!1),e.addEventListener("blur",this._onBlur,!1),this._addFocusAbility(e,!0)):(e.removeEventListener("keydown",this._onKeyDown),e.removeEventListener("keyup",this._onKeyUp),e.removeEventListener("blur",this._onBlur),this._removeFocusAbility(e),this._clearKeys())}},nt.prototype._addFocusAbility=function(e,i){if(e!==t||t.parent&&t.parent!==t){e.tabIndex=e.tabIndex||-1;var r=this;e.addEventListener("mouseover",r._onMouseOver,!1),e.addEventListener("click",r._onMouseClick,!1),this.input.onPointerDown.add(r._onMouseClick,r),i&&setTimeout(function(){r.gainFocus()},1)}},nt.prototype._removeFocusAbility=function(e){(e!==t||t.parent&&t.parent!==t)&&(e.removeEventListener("mouseover",this._onMouseOver),e.removeEventListener("click",this._onMouseClick),this.input.onPointerDown.remove(this._onMouseClick,this))},nt.prototype._prepareKey=function(t){this._keys[t]||(this._keys[t]=new s.Key(this.game,t))},nt.prototype.setModifierKeysState=function(t,e){t.altKey!==i&&(this._setKeyCodeState(nt.ALT,t.altKey,e),this._setKeyCodeState(nt.SHIFT,t.shiftKey,e),this._setKeyCodeState(nt.CONTROL,t.ctrlKey,e),e!=nt.META&&e!=nt.META_RWIN&&e!=nt.META_RMAC&&this._setKeyCodeState(nt.META,t.metaKey,e))},nt.prototype._setKeyCodeState=function(t,e,i){t!==i&&(this._prepareKey(t),this._keys[t].setState(e)&&this._recordKey(t,e))},nt.prototype._processKeyDown=function(t){this._prepareKey(t.keyCode),this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode].onDown(),this._keys[t.keyCode].currCharCode=t.charCode,this.setModifierKeysState(t,t.keyCode),this.update()},nt.prototype._processKeyUp=function(t){this._prepareKey(t.keyCode),this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode].onUp(),this.setModifierKeysState(t,t.keyCode),this.update()},nt.prototype._onOver=function(t){this.gainFocusType===nt.GAINFOCUS_OVER&&this.gainFocus()},nt.prototype._onClick=function(t){this.gainFocusType===nt.GAINFOCUS_CLICK&&this.gainFocus()},nt.prototype.gainFocus=function(e){(this.generator!==t||t.parent&&t.parent!==t)&&this.generator.focus()},nt.prototype._clearKeys=function(){for(;this._keys.length>0;){var t=this._keys.pop();t&&t.destroy()}this._keyDownNum=0,this._keyCodes={}},nt.prototype.lossFocus=function(){this._clearKeys()},nt.prototype.addKeyCapture=function(t){if("object"==typeof t)for(var e in t)this._capture[t[e]]=!0;else this._capture[t]=!0},nt.prototype.removeKeyCapture=function(t){delete this._capture[t]},nt.prototype.clearCapture=function(){this._capture={}},nt.GAINFOCUS_OVER=0,nt.GAINFOCUS_CLICK=1,nt.A="A".charCodeAt(0),nt.B="B".charCodeAt(0),nt.C="C".charCodeAt(0),nt.D="D".charCodeAt(0),nt.E="E".charCodeAt(0),nt.F="F".charCodeAt(0),nt.G="G".charCodeAt(0),nt.H="H".charCodeAt(0),nt.I="I".charCodeAt(0),nt.J="J".charCodeAt(0),nt.K="K".charCodeAt(0),nt.L="L".charCodeAt(0),nt.M="M".charCodeAt(0),nt.N="N".charCodeAt(0),nt.O="O".charCodeAt(0),nt.P="P".charCodeAt(0),nt.Q="Q".charCodeAt(0),nt.R="R".charCodeAt(0),nt.S="S".charCodeAt(0),nt.T="T".charCodeAt(0),nt.U="U".charCodeAt(0),nt.V="V".charCodeAt(0),nt.W="W".charCodeAt(0),nt.X="X".charCodeAt(0),nt.Y="Y".charCodeAt(0),nt.Z="Z".charCodeAt(0),nt.ZERO="0".charCodeAt(0),nt.ONE="1".charCodeAt(0),nt.TWO="2".charCodeAt(0),nt.THREE="3".charCodeAt(0),nt.FOUR="4".charCodeAt(0),nt.FIVE="5".charCodeAt(0),nt.SIX="6".charCodeAt(0),nt.SEVEN="7".charCodeAt(0),nt.EIGHT="8".charCodeAt(0),nt.NINE="9".charCodeAt(0),nt.NUMPAD_0=96,nt.NUMPAD_1=97,nt.NUMPAD_2=98,nt.NUMPAD_3=99,nt.NUMPAD_4=100,nt.NUMPAD_5=101,nt.NUMPAD_6=102,nt.NUMPAD_7=103,nt.NUMPAD_8=104,nt.NUMPAD_9=105,nt.NUMPAD_MULTIPLY=106,nt.NUMPAD_ADD=107,nt.NUMPAD_ENTER=108,nt.NUMPAD_SUBTRACT=109,nt.NUMPAD_DECIMAL=110,nt.NUMPAD_DIVIDE=111,nt.F1=112,nt.F2=113,nt.F3=114,nt.F4=115,nt.F5=116,nt.F6=117,nt.F7=118,nt.F8=119,nt.F9=120,nt.F10=121,nt.F11=122,nt.F12=123,nt.F13=124,nt.F14=125,nt.F15=126,nt.COLON=186,nt.EQUALS=187,nt.UNDERSCORE=189,nt.QUESTION_MARK=191,nt.TILDE=192,nt.OPEN_BRACKET=219,nt.BACKWARD_SLASH=220,nt.CLOSED_BRACKET=221,nt.QUOTES=222,nt.BACKSPACE=8,nt.TAB=9,nt.CLEAR=12,nt.ENTER=13,nt.SHIFT=16,nt.CONTROL=17,nt.ALT=18,nt.META=91,nt.META_RWIN=92,nt.META_RMAC=93,nt.CAPS_LOCK=20,nt.ESC=27,nt.SPACEBAR=32,nt.PAGE_UP=33,nt.PAGE_DOWN=34,nt.END=35,nt.HOME=36,nt.LEFT=37,nt.UP=38,nt.RIGHT=39,nt.DOWN=40,nt.INSERT=45,nt.DELETE=46,nt.HELP=47,nt.NUM_LOCK=144,nt.PLUS=43,nt.MINUS=45;var at=s.Mouse=function(t,e){this.input=t,this.game=t.game,this._wheelEvent=null,this.capture=!0,this.callbackContext=this.game,this.mouseDownCallback=null,this.onMouseDown=new o.Signal,this.onMouseUp=new o.Signal,this.onMouseMove=new o.Signal,this.onMousePressMove=new o.Signal,this.onMouseWheel=new o.Signal,this._mouses=[],this._mouseIds={},this._mouseDownNum=0,this._anyMouseDown=!1,this._checkEventHandledByTouch=this.game.phaser.device.android&&!1===this.game.phaser.device.chrome,this._wheelInfo={deltaX:0,deltaY:0},this._init(e)};at.prototype={},at.prototype.constructor=at,e.defineProperties(at.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(t){if(t!==this._generator){var e=this.enable;this.enable=!1,this._generator=t,e&&(this.enable=!0)}}},mouseWheel:{get:function(){return this._wheelInfo}},mouseCount:{get:function(){return this._mouseDownNum}},mouseIds:{get:function(){return e.keys(this._mouseIds)}}}),at.prototype._init=function(t){this._mouseKeyMap={0:at.BUTTON_LEFT,1:at.BUTTON_MIDDLE,2:at.BUTTON_RIGHT,3:at.BUTTON_BACK,4:at.BUTTON_FORWORD},this._mouseKeyMap[-1]=at.NONE,this._onMouseDown=this.processMouseDown.bind(this),this._onMouseUp=this.processMouseUp.bind(this),this._onMouseOver=this.processMouseOver.bind(this),this._onMouseOut=this.processMouseOut.bind(this),this._onMouseUpGlobal=this.processMouseUpGlobal.bind(this),this._onMouseMove=this.processMouseMove.bind(this),this._onMouseWheel=this.processMouseWheel.bind(this),this.generator=t,this.enable=!0},at.prototype.update=function(){if(this.enable){this._anyMouseDown=!1;for(var t,e=this._mouses.length;e-- >1;)if(t=this._mouses[e],t)for(;t.nextEvent();)t.isJustDown&&(this._anyMouseDown=!0,this._recordMouse(t.id,!0),this.onMouseDown.dispatch(t.id,t.x,t.y)),t.update(),t.isDown&&(t.deltaX||t.deltaY)&&this.onMousePressMove.dispatch(t.id,t.x,t.y),t.isJustUp&&(this._recordMouse(t.id,!1),this.onMouseUp.dispatch(t.id,t.x,t.y));if(t=this.getMouseById(at.NONE),t)for(;t.nextEvent();)t.update(),(t.deltaX||t.deltaY)&&this.onMouseMove.dispatch(t.x,t.y);var i=this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0});i&&(i.deltaX||i.deltaY)?(this._wheelInfo.deltaX=i.deltaX||0,this._wheelInfo.deltaY=i.deltaY||0,this.onMouseWheel.dispatch(this._wheelInfo.deltaX,this._wheelInfo.deltaY)):(this._wheelInfo.deltaX=0,this._wheelInfo.deltaY=0),i.deltaX=0,i.deltaY=0}},at.prototype.destroy=function(){this.enable=!1,this._onMouseDown=null,this._onMouseUp=null,this._onMouseOver=null,this._onMouseOut=null,this._onMouseUpGlobal=null,this._onMouseMove=null,this._onMouseWheel=null,this.input=null,this.game=null,this.generator=null},at.prototype._setEnable=function(e){if(!(this._enable===e||this.game.phaser.device.android&&!1===this.game.phaser.device.chrome&&this.game.phaser.device.touch)){this._enable=e;var i=this.generator,n=this.game.phaser.device;if(e){i.addEventListener("mousedown",this._onMouseDown,!1),i.addEventListener("mouseup",this._onMouseUp,!1),i.addEventListener("mousemove",this._onMouseMove,!1),n.cocoonJS||(i===t||t.addEventListener("mouseup",this._onMouseUpGlobal,!1),i.addEventListener("mouseout",this._onMouseOut,!1),i.addEventListener("mouseover",this._onMouseOver,!1));var a=n.wheelEvent;a&&(i.addEventListener(a,this._onMouseWheel,!1),"mousewheel"===a?this._wheelEvent=new r(-.025,1):"DOMMouseScroll"===a&&(this._wheelEvent=new r(1,1))),this.getMouseById(at.NONE)}else{
i.removeEventListener("mousedown",this._onMouseDown),i.removeEventListener("mousemove",this._onMouseMove),i.removeEventListener("mouseup",this._onMouseUp),i.removeEventListener("mouseout",this._onMouseOut),i.removeEventListener("mouseover",this._onMouseOver);a=n.wheelEvent;a&&i.removeEventListener(a,this._onMouseWheel),i===t||t.removeEventListener("mouseup",this._onMouseUpGlobal),this._clearMouses()}}},at.prototype._clearMouses=function(){for(;this._mouses.length>0;){var t=this._mouses.pop();t&&t.destroy()}this._mouseDownNum=0,this._mouseIds={}},at.prototype.lossFocus=function(){this._clearMouses(),this.getMouseById(at.NONE)},at.prototype.isAnyMouse=function(){return this._mouseDownNum>0},at.prototype.isAnyMouseDown=function(){return this._anyMouseDown},at.prototype.isMouseDown=function(t){return!!this._mouseIds[t]},at.prototype._recordMouse=function(t,e){e?(this._mouseDownNum++,this._mouseIds[t]=!0):(this._mouseDownNum--,delete this._mouseIds[t])},at.prototype.getMouseById=function(t){var e=Math.abs(t);return this._mouses[e]||(this._mouses[e]=new s.Pointer(this.game,t)),this._mouses[e]},at.prototype._updateMousesPosition=function(t,e,i){for(var r,n=this._mouses.length;n--;)r=this._mouses[n],r&&(i===s.Pointer.ENTER?r.onEnter(t,e):i===s.Pointer.LEAVE?r.onLeave(t,e):r.onMove(t,e))},at.prototype._toWorld=function(t,e,i){var r=this.game.canvas,n=this.game.phaser.scale.scaleFactor,a=r.ownerDocument===(this.generator.ownerDocument||this.generator.document)?r.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(e-a.left)*n.x,y:(i-a.top)*n.y}},at.prototype.processMouseDown=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,t);var e=this._mouseKeyMap[t.button];if(e!=i){var r=this._toWorld(this.generator,t.clientX,t.clientY);if(!this._checkEventHandledByTouch||!this.input.touch.checkEventHandled(!0,r.x,r.y)){var n=this.getMouseById(e);n.deviceId=t.button,n.onDown(r.x,r.y),this.input.keyboard.setModifierKeysState(t),this.update()}}},at.prototype.processMouseUp=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=i){var r=this.getMouseById(e);r.deviceId=t.button,r.onUp(),this.input.keyboard.setModifierKeysState(t),this.update()}},at.prototype.processMouseUpGlobal=function(t){var e=this._mouseKeyMap[t.button];if(e!=i){var r=this.getMouseById(e);r.onUp(),this.input&&this.input.keyboard&&this.input.keyboard.setModifierKeysState(t),this.update()}},at.prototype.processMouseOut=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=i){var r=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(r.x,r.y,s.Pointer.LEAVE),this.update()}},at.prototype.processMouseOver=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=i){var r=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(r.x,r.y,s.Pointer.ENTER),this.input.keyboard.setModifierKeysState(t),this.update()}},at.prototype.processMouseMove=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=i){var r=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(r.x,r.y,s.Pointer.MOVE),this.input.keyboard.setModifierKeysState(t),this.update()}},at.prototype.processMouseWheel=function(t){this._wheelEvent&&(t=this._wheelEvent.bindEvent(t)),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();o.Math.clamp(-t.deltaY,-1,1);var e=this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0});e.deltaX+=t.deltaX,e.deltaY+=t.deltaY,this.input.keyboard.setModifierKeysState(t),this.update()},at.NONE=0,at.BUTTON_LEFT=-1,at.BUTTON_MIDDLE=-2,at.BUTTON_RIGHT=-3,at.BUTTON_BACK=-4,at.BUTTON_FORWORD=-5,r.prototype={},r.prototype.constructor=r,r.prototype.bindEvent=function(t){if(!r._stubsGenerated&&t){var i=function(t){return function(){var e=this.originalEvent[t];return"function"!=typeof e?e:e.bind(this.originalEvent)}};for(var n in t)n in r.prototype||e.defineProperty(r.prototype,n,{get:i(n)});r._stubsGenerated=!0}return this.originalEvent=t,this},e.defineProperties(r.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});var st=s.Touch=function(t,e){this.input=t,this.game=t.game,this.capture=!0,this.onTouchStart=new o.Signal,this.onTouchEnd=new o.Signal,this.onTouchMove=new o.Signal,this._touches=[],this._touchIds={},this._deviceIdMap={},this._touchesStartPosition=[],this._touchStartNum=0,this._anyTouchStart=!1,this._init(e),this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null};st.prototype={},st.prototype.constructor=st,e.defineProperties(st.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(t){if(t!==this._generator){var e=this.enable;this.enable=!1,this._generator=t,e&&(this.enable=!0)}}},touchCount:{get:function(){return this._touchStartNum}},touchIds:{get:function(){return e.keys(this._touchIds)}}}),st.prototype._init=function(t){this._onTouchStart=this.processTouchStart.bind(this),this._onTouchCancel=this.processTouchCancel.bind(this),this._onTouchEnd=this.processTouchEnd.bind(this),this._onTouchEnter=this.processTouchEnter.bind(this),this._onTouchLeave=this.processTouchLeave.bind(this),this._onTouchMove=this.processTouchMove.bind(this),this.generator=t,this.enable=!0},st.prototype.update=function(){if(this.enable){this._touchesStartPosition.splice(0,this._touchesStartPosition.length),this._anyTouchStart=!1;for(var t,e=this._touches.length;e--;)if(t=this._touches[e],t)for(;t.nextEvent();)t.isJustDown&&(this._anyTouchStart=!0,this._recordTouch(t.id,!0),this.onTouchStart.dispatch(t.id,t.x,t.y)),t.update(),t.isDown&&(t.deltaX||t.deltaY)&&this.onTouchMove.dispatch(t.id,t.x,t.y),t.isJustUp&&(this._recordTouch(t.id,!1),this.onTouchEnd.dispatch(t.id,t.x,t.y)),t.isDown||this._removeTouch(t.id)}},st.prototype.destroy=function(){this.enable=!1,this._onTouchStart=null,this._onTouchCancel=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchMove=null,this.input=null,this.game=null,this.generator=null},st.prototype.checkEventHandled=function(t,e,i){for(var r=this._touchesStartPosition.length;r--;){var n=this._touchesStartPosition[r];if(n.isDown===t&&n.x===e&&n.y===i)return!0}return!1},st.prototype._setEnable=function(t){if(this._enable!==t){var e=this.generator,i=this.game.phaser.device;i.touch?(this._enable=t,t?(e.addEventListener("touchstart",this._onTouchStart,!1),e.addEventListener("touchmove",this._onTouchMove,!1),e.addEventListener("touchend",this._onTouchEnd,!1),e.addEventListener("touchcancel",this._onTouchCancel,!1),i.cocoonJS||(e.addEventListener("touchenter",this._onTouchEnter,!1),e.addEventListener("touchleave",this._onTouchLeave,!1))):(e.removeEventListener("touchstart",this._onTouchStart),e.removeEventListener("touchmove",this._onTouchMove),e.removeEventListener("touchend",this._onTouchEnd),e.removeEventListener("touchcancel",this._onTouchCancel),e.removeEventListener("touchenter",this._onTouchEnter),e.removeEventListener("touchleave",this._onTouchLeave),this._clearTouches())):this._enable=!1}},st.prototype._clearTouches=function(){for(var t;this._touches.length>0;)t=this._touches.pop(),t&&t.destroy();this._deviceIdMap={},this._touchStartNum=0,this._touchIds={}},st.prototype.lossFocus=function(){this._clearTouches()},st.prototype.isAnyTouch=function(){return this._touchStartNum>0},st.prototype.isAnyTouchStart=function(){return this._anyTouchStart},st.prototype.isTouchStart=function(t){return!!this._touchIds[t]},st.prototype._recordTouch=function(t,e){e?(this._touchStartNum++,this._touchIds[t]=!0):(this._touchStartNum--,delete this._touchIds[t])},st.prototype.getTouchById=function(t){return this._touches[t]},st.prototype._getFirstInvalidTouch=function(){for(var t=-1,e=this._touches.length+1;++t<e;){var i=this._touches[t];if(!i)break;if(!i.isDown&&!i.hasEvent())return i}var r=new s.Pointer(this.game,t);return this._touches[t]=r,r},st.prototype._removeTouch=function(t){var e=this._touches[t];e&&delete this._deviceIdMap[e.deviceId]},st.prototype.getTouchByDeviceId=function(t,e){if(this._deviceIdMap[t]===i){if(e){var r=this._getFirstInvalidTouch();return r.deviceId=t,this._deviceIdMap[t]=r.id,r}return null}return this.getTouchById(this._deviceIdMap[t])},st.prototype._toWorld=function(t,e,i){var r=this.game.canvas,n=this.game.phaser.scale.scaleFactor,a=r.ownerDocument===(this.generator.ownerDocument||this.generator.document)?r.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(e-a.left)*n.x,y:(i-a.top)*n.y}},st.prototype._updateTouchWithTouches=function(t){for(var e=t.length,i={};e--;){var r=t[e];i[r.identifier]=!0;var n=this._toWorld(this.generator,r.clientX,r.clientY),a=this.getTouchByDeviceId(r.identifier);a&&(a.deviceId=r.identifier,a.onMove(n.x,n.y))}for(e=this._touches.length;e--;){r=this._touches[e];r&&!i[r.deviceId]&&r.onCancel(!1)}},st.prototype.processTouchStart=function(t){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,t),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();for(var e=t.changedTouches.length;e--;){var i=t.changedTouches[e];if(i){var r=this.getTouchByDeviceId(i.identifier,!0),n=this._toWorld(this.generator,i.clientX,i.clientY);this._touchesStartPosition.push({isDown:!0,x:n.x,y:n.y}),r.onDown(n.x,n.y)}}this._updateTouchWithTouches(t.touches),this.input.keyboard.setModifierKeysState(t),this.update()},st.prototype.processTouchEnd=function(t){this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,t),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();for(var e=t.changedTouches.length;e--;){var i=t.changedTouches[e];if(i){var r=this.getTouchByDeviceId(i.identifier);if(r){var n=this._toWorld(this.generator,i.clientX,i.clientY);this._touchesStartPosition.push({isDown:!1,x:n.x,y:n.y}),r.onUp(n.x,n.y)}}}this._updateTouchWithTouches(t.touches),this.input.keyboard.setModifierKeysState(t),this.update()},st.prototype.processTouchCancel=function(t){this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,t),this.processTouchEnd(t,!0)},st.prototype.processTouchLeave=function(t){this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,t),this.processTouchMove(t,!0)},st.prototype.processTouchEnter=function(t){this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,t),this.processTouchMove(t,!0)},st.prototype.processTouchMove=function(t,e){!e&&this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,t),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();for(var i=t.changedTouches.length;i--;){var r=t.changedTouches[i];if(r){var n=this.getTouchByDeviceId(r.identifier);if(n){var a=this._toWorld(this.generator,r.clientX,r.clientY);n.onMove(a.x,a.y)}}}this._updateTouchWithTouches(t.touches),this.input.keyboard.setModifierKeysState(t),this.update()},st.MAIN=0;var ot=s.BaseInputEvent=function(t){this.source=t,this.effect=!0};ot.prototype={},ot.prototype.constructor=ot;var ht=s.WheelEvent=function(t,e){ot.call(this,{deltaX:t,deltaY:e})};ht.prototype=e.create(ot.prototype),ht.prototype.constructor=ht,e.defineProperties(ht.prototype,{deltaX:{get:function(){return this.source.deltaX}},deltaY:{get:function(){return this.source.deltaY}}});var lt=s.CursorMoveEvent=function(t,e){ot.call(this,{x:t,y:e})};lt.prototype=e.create(ot.prototype),lt.prototype.constructor=lt,e.defineProperties(lt.prototype,{x:{get:function(){return this.source.x}},y:{get:function(){return this.source.y}}});var ut=s.PointerEvent=function(t){ot.call(this,t)};ut.prototype=e.create(ot.prototype),ut.prototype.constructor=ut;var ct=s.ClickEvent=function(t){ut.call(this,t),this.isTap=!1,this.isDoubleTap=!1,this.isDoubleClick=!1};ct.prototype=e.create(ut.prototype),ct.prototype.constructor=ct;var pt=s.DragStartEvent=function(t){ut.call(this,t),this.started=!0};pt.prototype=e.create(ut.prototype),pt.prototype.constructor=pt;var dt=s.DragEvent=function(t){ut.call(this,t)};dt.prototype=e.create(ut.prototype),dt.prototype.constructor=dt;var ft=s.DragEndEvent=function(t,e){ut.call(this,t),this.result=e};ft.prototype=e.create(ut.prototype),ft.prototype.constructor=ft;var _t=s.DropEvent=function(t,e){ut.call(this,t),this.dragging=e,this.result=null};_t.prototype=e.create(ut.prototype),_t.prototype.constructor=_t;var gt=s.BaseInputModule=function(t,e){this.game=t,this.input=e,this.handleTouchAsMouse=!0,this._currMainPointerId=NaN,this._needHandleEventTypes=["onDown","onUp","onClick"],this._needHandleDragTypes=["onDragStart","onDrag","onDragEnd"],this._needHandleClickAndDragType=["onClick","onDragStart","onDrag","onDragEnd"],this._startDragMoveDistance=10,this.tapDuringTime=200,this.doubleClickDuringTime=600,this._pointersEvent={},this._init()};gt.prototype={},gt.prototype.constructor=gt,gt.prototype._init=function(){this.input.onPointerDown.add(this.onPointerDown,this),this.input.onPointerUp.add(this.onPointerUp,this),this.input.onPointerMove.add(this.onPointerMove,this),this.input.onWheel.add(this.onWheel,this),this.input.onCursorMove.add(this.onCursorMove,this)},gt.prototype._buildPointerRecord=function(t,e){return{eventId:t,deviceId:t,isMouse:e,downNodeList:null,draggingNodeList:null,overNode:null}},gt.prototype.destroy=function(){this.input.onPointerDown.remove(this.onPointerDown,this),this.input.onPointerUp.remove(this.onPointerUp,this),this.input.onPointerMove.remove(this.onPointerMove,this),this.input.onWheel.remove(this.onWheel,this),this.input.onCursorMove.remove(this.onCursorMove,this),this.reset()},gt.prototype.lossFocus=function(){this.reset()},gt.prototype.update=function(){},gt.prototype.reset=function(){for(var t in this._pointersEvent){var e,i=this._pointersEvent[t];if(isNaN(i.deviceId)||(e=this.input.getPointer(i.deviceId),i.deviceId=NaN),i.downNodeList){for(var r=0;r<i.downNodeList.length;r++){var n=new s.PointerEvent(e);i.downNodeList[r].fireInputEvent("onUp",n)}i.downNodeList=null}if(i.draggingNodeList){for(r=0;r<i.draggingNodeList.length;r++){var a=new s.DragEndEvent(e,null);i.draggingNodeList[r].fireInputEvent("onDragEnd",a)}i.draggingNodeList=null}if(i.overNode){var o=new s.CursorMoveEvent(NaN,NaN);this.doPointerExitAndEnter(i,o,null),i.overNode=null}}this._pointersEvent={},this._currMainPointerId=NaN},gt.prototype.checkEventRecordNode=function(t){if(t.draggingNodeList){for(var e=[],i=0;i<t.draggingNodeList.length;i++)t.draggingNodeList[i]._destroy&&e.push(t.draggingNodeList[i]);for(i=0;i<e.length;i++)t.draggingNodeList.remove(e[i]);0===t.draggingNodeList.length&&(t.draggingNodeList=null)}if(t.downNodeList){for(e=[],i=0;i<t.downNodeList.length;i++)t.downNodeList[i]._destroy&&e.push(t.downNodeList[i]);for(i=0;i<e.length;i++)t.downNodeList.remove(e[i]);0===t.downNodeList.length&&(t.downNodeList=null)}t.overNode&&t.overNode._destroy&&(t.overNode=null)},gt.prototype.onPointerDown=function(t,e,i){var r=this.input.getPointer(t),n=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));if(this.handleTouchAsMouse&&(t===s.Mouse.BUTTON_LEFT||t===s.Touch.MAIN)){if(!isNaN(this._currMainPointerId)&&this._currMainPointerId!==t)return;this._currMainPointerId=t,r.eventId=s.Mouse.BUTTON_LEFT,n.eventId=s.Mouse.BUTTON_LEFT}this.checkEventRecordNode(n);var a=this._fetchNodeInParent(this.game.world,e,i);if(!n.isMouse){var o=new s.CursorMoveEvent(e,i);this.doPointerExitAndEnter(n,o,a)}var h=a?a.getInputEventHandle(this._needHandleEventTypes,e,i):[];if(0!==h.length){n.downNodeList=h;for(var l=new s.PointerEvent(r),u=0;u<h.length;u++)h[u].fireInputEvent("onDown",l)}},gt.prototype.onPointerUp=function(t,e,i){var r=this.input.getPointer(t),n=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));if(this.handleTouchAsMouse&&(t===s.Mouse.BUTTON_LEFT||t===s.Touch.MAIN)){if(this._currMainPointerId!==t)return;this._currMainPointerId=NaN,r.eventId=s.Mouse.BUTTON_LEFT,n.eventId=r.eventId}this.checkEventRecordNode(n);var a=this._fetchNodeInParent(this.game.world,e,i,n.draggingNodeList),o=a?a.getInputEventHandle(this._needHandleEventTypes,e,i):[],h=new s.PointerEvent(r);if(n.draggingNodeList&&n.draggingNodeList.length>0){for(var l=a?a.getInputEventHandle("onDragDrop",e,i):[],u=0;u<n.draggingNodeList.length;u++){for(var c=n.draggingNodeList[u],p=new s.DropEvent(r,c),d=0;d<l.length;d++){var f=l[d];f&&f.checkAllowDrop(c)&&f.fireInputEvent("onDragDrop",p)}var _=new s.DragEndEvent(r,p.result);c.fireInputEvent("onDragEnd",_)}n.draggingNodeList=null}else for(u=0;u<o.length;u++){var g=o[u];if(s.Util.isArray(n.downNodeList))for(d=0;d<n.downNodeList.length;d++){var m=n.downNodeList[d];if(g&&g===m){var y=new s.ClickEvent(r);if(r.previousStatus.length){var v=r.previousStatus[0],T=r.previousStatus[1];y.isTap=v.upTime-v.downTime<this.tapDuringTime,y.isDoubleTap=T&&v.upTime-T.downTime<2*this.tapDuringTime,y.isDoubleClick=T&&v.upTime-T.downTime<this.doubleClickDuringTime}g.fireInputEvent("onClick",y);break}}}if(s.Util.isArray(n.downNodeList))for(u=0;u<n.downNodeList.length;u++){m=n.downNodeList[u];h.downInside=!0,h.upInside=!1;for(d=0;d<o.length;d++){g=o[d];if(m===g){h.upInside=!0;break}}m.fireInputEvent("onUp",h)}for(u=0;u<o.length;u++){var x;g=o[u];if(h.downInside=!1,h.upInside=!0,s.Util.isArray(n.downNodeList))for(d=0;d<n.downNodeList.length;d++){m=n.downNodeList[d];if(g===m){x=!0;break}}x||g.fireInputEvent("onUp",h)}if(n.downNodeList=null,!n.isMouse){var b=new s.CursorMoveEvent(e,i);this.doPointerExitAndEnter(n,b,null)}delete this._buildPointerRecord[n.deviceId]},gt.prototype.onPointerMove=function(t,e,i){var r=this.input.getPointer(t),n=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));this.checkEventRecordNode(n);var a=this._fetchNodeInParent(this.game.world,e,i);if(!n.isMouse){var o=new s.CursorMoveEvent(e,i);this.doPointerExitAndEnter(n,o,a)}if(!n.draggingNodeList||0===n.draggingNodeList.length){var h=this._fetchNodeInParent(this.game.world,r.startX,r.startY),l={x:r.x,y:r.y},u=[];do{if(!h)break;var c=h.getInputEventHandleAndEventType(this._needHandleClickAndDragType,r.startX,r.startY);if(0===c.length)break;for(var p=0;p<c.length;p++){var d=c[p];"onClick"===d[1]&&(Math.abs(r.distanceX)<this._startDragMoveDistance||Math.abs(r.distanceY)<this._startDragMoveDistance)||u.push(d[0])}}while(0);var f=new s.DragStartEvent(r);r._x=r.startX,r._y=r.startY;for(p=0;p<u.length;p++)u[p].fireInputEvent("onDragStart",f);r._x=l.x,r._y=l.y,n.draggingNodeList=u}if((!n.draggingNodeList||0===n.draggingNodeList.length)&&(Math.abs(r.distanceX)>=this._startDragMoveDistance||Math.abs(r.distanceY)>=this._startDragMoveDistance)){h=this._fetchNodeInParent(this.game.world,r.startX,r.startY),l={x:r.x,y:r.y},u=h?h.getInputEventHandle(this._needHandleDragTypes,r.startX,r.startY):[],f=new s.DragStartEvent(r);r._x=r.startX,r._y=r.startY;for(p=0;p<u.length;p++)u[p].fireInputEvent("onDragStart",f);r._x=l.x,r._y=l.y,n.draggingNodeList=u}if(n.draggingNodeList&&n.draggingNodeList.length>0){for(u=a?a.getInputEventHandle("onDragDrop",e,i):[],p=0;p<u.length;p++)for(var _=u[p],g=0;g<n.draggingNodeList.length;g++){var m=n.draggingNodeList[g],y=new s.DropEvent(r,m);!_||_.isAllowDrop&&!_.isAllowDrop(m)||_.fireInputEvent("onDragOver",y)}var v=new s.DragEvent(r);for(g=0;g<n.draggingNodeList.length;g++){m=n.draggingNodeList[g];m.fireInputEvent("onDrag",v)}}},gt.prototype.onWheel=function(t,e){if(this.input.hasCursor)for(var i=this.input.cursorPosition,r=this._fetchNodeInParent(this.game.world,i.x,i.y),n=r?r.getInputEventHandle("onWheel"):[],a=0;a<n.length;a++){var o=n[a],h=new s.WheelEvent(-t,-e);o.fireInputEvent("onWheel",h),this.onCursorMove(i.x,i.y)}},gt.prototype.onCursorMove=function(t,e){var i=this._fetchNodeInParent(this.game.world,t,e),r=new s.CursorMoveEvent(t,e);this.checkEventRecordNode(this),this.doPointerExitAndEnter(this,r,i)},gt.prototype.doPointerExitAndEnter=function(t,e,i){if(t.overNode!==i){var r=this.findCommonRoot(t.overNode,i);if(t.overNode)for(var n=t.overNode;n&&n!==this.game.world&&(!r||r!==n);)n.fireInputEvent("onExit",e),n=n.parent;if(i)for(n=i;n&&n!==r&&n!==this.game.world;)n.fireInputEvent("onEnter",e),n=n.parent;t.overNode=i}},gt.prototype._flattenPolygonContains=function(t,e,i){for(var r=t.length/2,n=!1,a=-1,s=r-1;++a<r;s=a){var o=t[2*a],h=t[2*a+1],l=t[2*s],u=t[2*s+1];(h<=i&&i<u||u<=i&&i<h)&&e<(l-o)*(i-h)/(u-h)+o&&(n=!n)}return n},gt.prototype.findCommonRoot=function(t,e){if(!t||!e)return null;for(var i=t,r=e;i;){for(r=e;r;){if(i===r)return i;r=r.parent}i=i.parent}return null},gt.prototype._fetchNodeInParent=function(t,e,i,r){if(!t||!t.phaser.visible)return null;var n=t.phaser.worldTransform.applyInverse({x:e,y:i});if(t===this.game.world&&!t.rect.contains(n.x,n.y))return null;if(s.Util.isArray(r)){for(var a=0;a<r.length;a++)if(t===r[a])return null}else if(t===r)return null;if(t.phaser.mask){var o=t.phaser.mask.graphicsData.length,h=!1;for(a=0;a<t.phaser.mask.graphicsData.length;a++){var l=t.phaser.mask.graphicsData[a];if(l.fill&&l.shape){l.shape.points&&l.shape.points.length>0&&!(l.shape.points[0]instanceof s.Point)&&this._flattenPolygonContains(l.shape.points,e,i)?h=!0:l.shape.contains(e,i)&&(h=!0);break}}if(0!=o&&!h)return null}if(t.phaser.softClip&&t.phaser.softClip.length&&!s.GeometricTool.polygonContains(t.phaser.softClip,e,i))return null;var u=null,c=t.children;for(a=c.length;a--;)if(u=this._fetchNodeInParent(c[a],e,i,r),u)return u;return t.checkHit(n.x,n.y)?t:null};var mt=s.DirtyRectangle=function(t){var e=this;e._destroyRegion=[],e.game=t,e.game.world.getSelfWidth=function(){return this.width},e.game.world.getSelfHeight=function(){return this.height},e.game.scale.onSizeChange.add(e.onSizeChange,e),e.enable=!1,e.showDirtyRegion=!1,e.forceDirty=!1};mt.prototype={},mt.prototype.constructor=mt,e.defineProperties(mt.prototype,{enable:{get:function(){return this._enable},set:function(t){t!==this._enable&&(this._enable=t,this._recalcAll=t,t||this.releaseDirtyCanvas())}},showDirtyRegion:{get:function(){return this._showDirtyRegion},set:function(t){t!==this._showDirtyRegion&&(this._showDirtyRegion=t,t||this.releaseDirtyCanvas())}}}),mt.prototype.redirectDirty=function(t){var e=this;e._enable&&t&&e._destroyRegion.push(t)},mt.prototype.onSizeChange=function(){var t=this;t.game.world.displayChanged(s.DisplayChangeStatus.SIZE)},mt.prototype._unionRect=function(t,e){var i=t.x+t.width,r=t.y+t.height,n=e.x+e.width,a=e.y+e.height,s=t.x<e.x?t.x:e.x,o=t.y<e.y?t.y:e.y,h=i<n?n:i,l=r<a?a:r,u=h-s,c=l-o;return{x:s,y:o,width:u,height:c,area:u*c}},mt.prototype._insersectionRect=function(t,e){var i=t.x+t.width,r=t.y+t.height,n=e.x+e.width,a=e.y+e.height,s=t.x>e.x?t.x:e.x,o=t.y>e.y?t.y:e.y,h=i>n?n:i,l=r>a?a:r,u=h-s,c=l-o;if(u<0||c<0)return null;var p={x:s,y:o,width:u,height:c,area:u*c};return p},mt.prototype._mergeRect=function(t,e){var i=this,r=t.length;if(r<2)return!0;for(var n=-1,a=!1,s=null,o=0;!a&&++n<r;){var h=t[n];for(h.clip&&(h=h.clip),o=n;!a&&++o<r;){var l=t[o];l.clip&&(l=l.clip),s=i._unionRect(h,l),a=.8*s.area-h.area-l.area<0}}return!a||!s||(t[n]=s,t.splice(o,1),!1)},mt.prototype.collectDirtyRegion=function(t,e,i){var r=this;if(i=i||[],!e)return i;var n=t;e instanceof o.Text&&e.dirty&&(e.updateText(),e.getWorldTransform(),e.dirty=!1);var a=e.isSkipChildrenRender&&e.isSkipChildrenRender(),s=e.getDisplayProxy&&e.getDisplayProxy()||e;if(s!==e&&s.displayChanged(e._displayChangeStatus),s._updateBounds&&(a|=s._updateBounds(r._recalcAll)),s._mask){var h=s._currWorldBounds;h&&(n=n?r._insersectionRect(n,h):h)}if(s._dirtyBounds){var l=s._currWorldBounds;if(l&&n){var u=r._insersectionRect(l,n);u?s._currWorldBounds.clip=u:l=null}if(s._lastWorldBounds)for(var c=s._lastWorldBounds.length;c--;){var p=s._lastWorldBounds[c];p&&i.push(p)}s._lastWorldBounds=[],l&&i.push(l),s._dirtyBounds=!1}if(0===s._displayChangeStatus&&(a|=!e._subDisplayChanged),e._subDisplayChanged=!1,r._recalcAll||!a)for(var d=e.children.length;d--;)r.collectDirtyRegion(n,e.children[d],i);return e._resetDisplayChangeStatus&&e._resetDisplayChangeStatus(),s!==e&&s._resetDisplayChangeStatus&&s._resetDisplayChangeStatus(),i},mt.prototype.updateDirtyRegion=function(t,e,i){var r=this;Date.now();null==i._displayChangeStatus&&(i._displayChangeStatus=-1);var n=r._currDirtyRegion=r.collectDirtyRegion(null,i);if(r._destroyRegion&&(Array.prototype.push.apply(n,r._destroyRegion),r._destroyRegion=[]),r._recalcAll||r.forceDirty||n.length>500)r._recalcAll=!1,r._currDirtyRegion=n=[{x:0,y:0,width:r.game.width,height:r.game.height}],r.forceDirty=!1;else for(;!r._mergeRect(n););var a=n.length;if(!a)return!1;for(t.save(),r._saveContext=!0,t.beginPath();a--;){var s=n[a];s&&0!==s.clip&&(s.clip&&(s=s.clip),t.rect(s.x*e-1|0,s.y*e-1|0,s.width*e+3|0,s.height*e+3|0))}return t.clip(),i._displayChangeStatus=0,!0},mt.prototype.restore=function(t){var e=this;e._saveContext&&(t.restore(),e._saveContext=!1)},mt.prototype.checkShowDirtyCanvas=function(){var t=this,e=t.game.canvas,i=t._dirtyCanvas;return!!e&&(i||(i=t._dirtyCanvas=document.createElement("canvas"),t._dirtyContext=t._dirtyCanvas.getContext("2d"),e.parentNode.insertBefore(t._dirtyCanvas,e),i.style.left=i.style.top="0px",i.style.position="absolute"),i.style.width===e.style.width&&i.style.height===e.style.height&&i.width===e.width&&i.height===e.height||(i.width=e.width,i.height=e.height,i.style.width=e.style.width,i.style.height=e.style.height),!0)},mt.prototype.releaseDirtyCanvas=function(){var t=this,e=t._dirtyCanvas;e&&(this.dirtyContext=null,this._dirtyCanvas=null,e.parentElement&&e.parentElement.removeChild(e))},mt.prototype.showDirtyRectangle=function(t,e){if(this._showDirtyRegion){var i=this;if(i.checkShowDirtyCanvas()){var r=i._dirtyCanvas,n=i._dirtyContext;n.clearRect(0,0,r.width,r.height),n.beginPath();var a=this._currDirtyRegion,s=a.length,o=.9;for(0===s&&this._lastShowAlpha>0?(a=this._lastShowRegion,o=this._lastShowAlpha-.05,s=a.length):this._lastShowRegion=a,this._lastShowAlpha=o;s--;){var h=a[s];h&&(h.clip?n.rect(h.clip.x*e,h.clip.y*e,h.clip.width*e,h.clip.height*e):n.rect(h.x*e,h.y*e,h.width*e,h.height*e))}n.lineWidth=3,n.strokeStyle="rgba(255,255,0, "+this._lastShowAlpha+")",n.stroke()}}};var yt;s.dragonBonesDriver=function(e,i){t.dragonBones&&(dragonBones.PhaserFactory.init(e),s.dragonBones.game=e)},s.dragonBonesDriver.prototype={update:function(){}},s.dragonBonesDriver.prototype.constructor=s.dragonBonesDriver,s.Transition={NONE:0,COLOR_TINT:1,TEXTURE_SWAP:2,ANIMATION:3},s.UIState={NORMAL:0,PRESSED:1,DISABLED:2},s.Util={findClass:function(e){for(var i=e.split("."),r=t,n=0;n<i.length-1;n++){if(!r[i[n]])return;r=r[i[n]]}return r[i[i.length-1]]},clone:function(t){if(null===t||"object"!=typeof t)return t;var e=new t.constructor;for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},isArray:Array.isArray||function(t){return"[object Array]"===toString.call(t)},removeHTML:function(t){if(t&&t.parentNode){if(yt===t)return;yt=t,t.parentNode.removeChild(t),yt=null}},updateTransform:function(t,e){var i=t.game,r=i.phaser.scale.scaleFactorInversed,n=e.style,a=t.rect,s=t.worldTransform,o=(-a.x).toFixed(5)+"px "+(-a.y).toFixed(5)+"px",h="matrix("+(s.a*r.x).toFixed(5)+","+(s.b*r.x).toFixed(5)+","+(s.c*r.y).toFixed(5)+","+(s.d*r.y).toFixed(5)+","+(s.tx*r.x).toFixed(0)+","+(s.ty*r.y).toFixed(0)+")";n.left=a.x.toFixed(5)+"px",n.top=a.y.toFixed(5)+"px",n.width=a.width.toFixed(5)+"px",n.height=a.height.toFixed(5)+"px",n.webkitTransform=h,n.mozTransform=h,n.msTransform=h,n.oTransform=h,n.transform=h,n.webkitTransformOrigin=o,n.mozTransformOrigin=o,n.msTransformOrigin=o,n.oTransformOrigin=o,n.transformOrigin=o},formatString:function(t){var e=arguments;return e.length<=1?s.Util.formatValue(t).replace(/^\'|\'$/g,""):t.replace(/\{(\d+)\}/g,function(t,i){return s.Util.formatValue(e[parseInt(i)+1]).replace(/^\'|\'$/g,"")})},popupError:function(e){if(t.parent&&t.parent.G&&t.parent.G.notification){var i=t.parent.G,r=s.Util.formatString(i._("Exception notification"),e);i.notification.error(r)}else{r="Error: "+e;if("undefined"!=typeof qici&&qici.config){var n=qici.config.gameInstance,a=t[n];a&&(a.log.error(r),a.debug.on&&(t.__wx?wx.showModal({title:"",content:r,showCancel:!1}):alert(r)))}else console.error(r)}},formatValue:function(t,r,n){"number"!=typeof r&&(r=0),n=n||[];var a=function(t){if(t===i)return"undefined";if(null===t)return"null";var r=typeof t,n=e.prototype.toString.call(t);if("string"===r){var a="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a}if("number"===r)return 0===t&&1/t<0?"-0":""+t;if("boolean"===r)return""+t;if("symbol"===r)return t.toString();if("function"===r){var s=t.name?":"+t.name:"";return"[Function"+s+"]"}return"[object RegExp]"===n?"[RegExp: "+RegExp.prototype.toString.call(t)+"]":"[object Error]"===n?"[Error: "+t.stack+"]":"[object Date]"===n?"[Date: "+Date.prototype.toString.call(t)+"]":void 0},o=a(t);if(o)return o;var h=e.keys(t);if(0===h.length){var l=t;try{l=t.valueOf()}catch(t){}if(o=a(l),o)return o}var u,c,p=function(t,i,r,n){for(var a=[],s=0,o=t.length;s<o;++s)e.prototype.hasOwnProperty.call(t,String(s))?a.push(f(n,t,i,String(s),!0)):a.push("");return r.forEach(function(e){"symbol"!=typeof e&&e.match(/^\d+$/)||a.push(f(n,t,i,e,!0))}),a},d=function(t,e,i,r){return i.map(function(i){return f(r,t,e,i,!1)})};if(Array.isArray(t)?(u=["[","]"],c=p):(u=["{","}"],c=d),0===h.length)return u[0]+""+u[1];var f=function(t,i,r,n,a){var o,h,l;return l=e.getOwnPropertyDescriptor(i,n)||{value:i[n]},l.get?h=l.set?"[Getter/Setter]":"[Getter]":l.set&&(h="[Setter]"),h||(t.indexOf(l.value)<0?(h=null===r?s.Util.formatValue(l.value,null,t):s.Util.formatValue(l.value,r-1,t),h.indexOf("\n")>-1&&(h=a?h.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+h.split("\n").map(function(t){return"   "+t}).join("\n"))):h="[Circular]"),a&&n.match(/^\d+$/)?h:(o=JSON.stringify(""+n),o=o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?o.substr(1,o.length-2):o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'").replace(/\\\\/g,"\\"),o+": "+h)};if(r<0){var _="Object";return Array.isArray(t)?_="Array":(t.class&&"string"==typeof t.class&&(_=t.class),t.name&&"string"==typeof t.class&&(_=_+"("+t.name+")")),"["+_+"]"}n.push(t);var g=c(t,r,h,n);n.pop();var m=function(t,e){var i=t.reduce(function(t,e){return t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?e[0]+(1===e[0].length?"":"\n ")+" "+t.join(",\n  ")+" "+e[1]:e[0]+" "+t.join(", ")+" "+e[1]};return m(g,u)},insertSortedList:function(t,e,i,r){var n,a=function(t,e,i){var r=0,n=t.length-1;if(n<0)return-1;for(var a=0;r<n;)a=Math.floor((r+n)/2),i(t[a],e)?r=a+1:n=a;return i(t[r],e)?-1:r},s=a(t,e,i);return n=r?s<0?t.push(e)-1:t.splice(s,0,e)&&s:s<0?t.push(e)-1:t.splice(s,i(e,t[s])?0:1,e)&&s,n}},t.onerror=function(t,e,i,r,n){s.Util.popupError(t)};var vt=s.Color=function(t){if(this.alpha=1,this._rgb=[255,255,255],null!=t)if("number"==typeof t)this._rgb[0]=t>>16&255,this._rgb[1]=t>>8&255,this._rgb[2]=255&t,this.alpha=(t>>>24)/255;else if(s.Util.isArray(t))this.rgb=t;else{if("string"!=typeof t)throw new Error("Invalid color");if(t=t.toLowerCase(),0===t.indexOf("rgb"))var e=o.Color.webToColor(t);else{e=this._hexToColor(t);e.a=e.a/255}this._rgb[0]=e.r,this._rgb[1]=e.g,
this._rgb[2]=e.b,this.alpha=e.a}};vt.prototype={},vt.prototype.constructor=vt,e.defineProperties(vt.prototype,{alpha:{get:function(){return this._alpha},set:function(t){(t<0||t>1)&&(t=1),this._alpha=t}},rgb:{get:function(){return this._rgb},set:function(t){if(!s.Util.isArray(t))throw new Error("Expected:Array");if(t.length<3)throw new Error("Invalid rgb");this._rgb[0]=t[0],this._rgb[1]=t[1],this._rgb[2]=t[2],4===t.length?this.alpha=t[3]:this.alpha=1}},r:{get:function(){return this._rgb[0]},set:function(t){this._rgb[0]=t}},g:{get:function(){return this._rgb[1]},set:function(t){this._rgb[1]=t}},b:{get:function(){return this._rgb[2]},set:function(t){this._rgb[2]=t}},class:{get:function(){return"qc.Color"}}}),vt.prototype.toString=function(t){switch(t){case"#rgb":return"#"+o.Color.componentToHex(this._rgb[0])+o.Color.componentToHex(this._rgb[1])+o.Color.componentToHex(this._rgb[2]);case"#argb":return"#"+o.Color.componentToHex(Math.round(255*this.alpha))+o.Color.componentToHex(this._rgb[0])+o.Color.componentToHex(this._rgb[1])+o.Color.componentToHex(this._rgb[2]);case"rgb":return"rgb("+this._rgb[0].toString()+","+this._rgb[1].toString()+","+this._rgb[2].toString()+")";default:return"rgba("+this._rgb[0].toString()+","+this._rgb[1].toString()+","+this._rgb[2].toString()+","+this.alpha+")"}},vt.prototype.toNumber=function(t){return t?(255*this.alpha<<24|this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0:(this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0},vt.prototype._hexToColor=function(t){if(t.length<=0||"#"!==t[0])return{r:255,g:255,b:255,a:255};t=t.substr(1,t.length-1);var e=!1;if(t.length>6&&t.length<=8)for(e=!0;t.length<8;)t="0"+t;for(;t.length<6;)t="0"+t;var i=255,r=0;e&&(i=parseInt(t.substr(r,2),16),r+=2);var n=parseInt(t.substr(r,2),16);r+=2;var a=parseInt(t.substr(r,2),16);r+=2;var s=parseInt(t.substr(r,2),16);return{r:n,g:a,b:s,a:i}},vt.black=new vt(4278190080),vt.white=new vt(4294967295),vt.red=new vt(4294901760),vt.yellow=new vt(4294967040),vt.blue=new vt(4278255615),vt.green=new vt(4278255360),vt.grey=new vt(4291611852),vt.shadow=new vt(2147483648),vt.background=new vt(4282861383),s.CanvasPool={pool:{},unused:[],cookie:19870101,get:function(t){var e=s.CanvasPool.pool,i=e[t],r=!1;if(!i){r=!0;var n=s.CanvasPool.unused;n.length?e[t]=i=n.pop():e[t]=i=o.Canvas.create(1,1)}return i._cookie=s.CanvasPool.cookie,{canvas:i,dirty:r}},stat:function(){var t=0,e=0,i=s.CanvasPool.pool;for(var r in i){var n=i[r];n&&(t++,e+=n.width*n.height)}console.info("当前Canvas使用中："+t+"，总像素为："+e+"，未使用的Canvas数量："+s.CanvasPool.unused.length)},postRender:function(){var t=s.CanvasPool,i=t.cookie;t.cookie=i+1;for(var r=t.pool,n=t.unused,a=e.keys(r),o=0,h=a.length;o<h;o++){var l=a[o],u=r[l];u._cookie!==i&&(delete r[l],u.width=1,u.height=1,n.push(u))}}};var Tt=t.applicationCache;if(Tt){var xt=function(t){},bt=function(t){};Tt.addEventListener("cached",xt,!1),Tt.addEventListener("checking",xt,!1),Tt.addEventListener("downloading",xt,!1),Tt.addEventListener("error",bt,!1),Tt.addEventListener("noupdate",xt,!1),Tt.addEventListener("obsolete",xt,!1),Tt.addEventListener("progress",xt,!1),Tt.addEventListener("updateready",xt,!1)}var At=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964),St=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697),wt=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272),Pt=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144),Et=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256),Dt=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488),Ct=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746),Ot=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568),Mt=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578),It=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488),Rt=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800),Nt=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744),Bt=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128),Lt=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261),Ft=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756),kt=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344),Ut=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584),jt=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928),Wt=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080),Vt=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312),zt=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154),Gt=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696);s.Des={encrypt:function(t,e,i,r,n){return s.Des._des(t,e,!0,i,r,n)},decrypt:function(t,e,i,r,n){return s.Des._des(t,e,!1,i,r,n)},_des:function(t,e,i,r,n,a){var o,h,l,u,c,p,d,f,_,g,m,y,v,T,x=s.Des.des_createKeys(t),b=0,A=e.length,S=0,w=32==x.length?3:9;f=3==w?i?new Array(0,32,2):new Array(30,-2,-2):i?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2),2==a?e+="        ":1==a?(l=8-A%8,e+=String.fromCharCode(l,l,l,l,l,l,l,l),8==l&&(A+=8)):a||(e+="\0\0\0\0\0\0\0\0");var P="",E="";for(1==r&&(_=n.charCodeAt(b++)<<24|n.charCodeAt(b++)<<16|n.charCodeAt(b++)<<8|n.charCodeAt(b++),m=n.charCodeAt(b++)<<24|n.charCodeAt(b++)<<16|n.charCodeAt(b++)<<8|n.charCodeAt(b++),b=0);b<A;){for(p=e.charCodeAt(b++)<<24|e.charCodeAt(b++)<<16|e.charCodeAt(b++)<<8|e.charCodeAt(b++),d=e.charCodeAt(b++)<<24|e.charCodeAt(b++)<<16|e.charCodeAt(b++)<<8|e.charCodeAt(b++),1==r&&(i?(p^=_,d^=m):(g=_,y=m,_=p,m=d)),l=252645135&(p>>>4^d),d^=l,p^=l<<4,l=65535&(p>>>16^d),d^=l,p^=l<<16,l=858993459&(d>>>2^p),p^=l,d^=l<<2,l=16711935&(d>>>8^p),p^=l,d^=l<<8,l=1431655765&(p>>>1^d),d^=l,p^=l<<1,p=p<<1|p>>>31,d=d<<1|d>>>31,h=0;h<w;h+=3){for(v=f[h+1],T=f[h+2],o=f[h];o!=v;o+=T)u=d^x[o],c=(d>>>4|d<<28)^x[o+1],l=p,p=d,d=l^(kt[u>>>24&63]|jt[u>>>16&63]|Vt[u>>>8&63]|Gt[63&u]|Ft[c>>>24&63]|Ut[c>>>16&63]|Wt[c>>>8&63]|zt[63&c]);l=p,p=d,d=l}p=p>>>1|p<<31,d=d>>>1|d<<31,l=1431655765&(p>>>1^d),d^=l,p^=l<<1,l=16711935&(d>>>8^p),p^=l,d^=l<<8,l=858993459&(d>>>2^p),p^=l,d^=l<<2,l=65535&(p>>>16^d),d^=l,p^=l<<16,l=252645135&(p>>>4^d),d^=l,p^=l<<4,1==r&&(i?(_=p,m=d):(p^=g,d^=y)),E+=String.fromCharCode(p>>>24,p>>>16&255,p>>>8&255,255&p,d>>>24,d>>>16&255,d>>>8&255,255&d),S+=8,512==S&&(P+=E,E="",S=0)}return P+E},des_createKeys:function(t){for(var e,i,r,n=t.length>8?3:1,a=new Array(32*n),s=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0),o=0,h=0,l=0;l<n;l++){var u=t.charCodeAt(o++)<<24|t.charCodeAt(o++)<<16|t.charCodeAt(o++)<<8|t.charCodeAt(o++),c=t.charCodeAt(o++)<<24|t.charCodeAt(o++)<<16|t.charCodeAt(o++)<<8|t.charCodeAt(o++);r=252645135&(u>>>4^c),c^=r,u^=r<<4,r=65535&(c>>>-16^u),u^=r,c^=r<<-16,r=858993459&(u>>>2^c),c^=r,u^=r<<2,r=65535&(c>>>-16^u),u^=r,c^=r<<-16,r=1431655765&(u>>>1^c),c^=r,u^=r<<1,r=16711935&(c>>>8^u),u^=r,c^=r<<8,r=1431655765&(u>>>1^c),c^=r,u^=r<<1,r=u<<8|c>>>20&240,u=c<<24|c<<8&16711680|c>>>8&65280|c>>>24&240,c=r;for(var p=0;p<s.length;p++)s[p]?(u=u<<2|u>>>26,c=c<<2|c>>>26):(u=u<<1|u>>>27,c=c<<1|c>>>27),u&=-15,c&=-15,e=At[u>>>28]|St[u>>>24&15]|wt[u>>>20&15]|Pt[u>>>16&15]|Et[u>>>12&15]|Dt[u>>>8&15]|Ct[u>>>4&15],i=Ot[c>>>28]|Mt[c>>>24&15]|It[c>>>20&15]|Rt[c>>>16&15]|Nt[c>>>12&15]|Bt[c>>>8&15]|Lt[c>>>4&15],r=65535&(i>>>16^e),a[h++]=e^r,a[h++]=i^r<<16}return a}},o.Game.prototype.update=function(t){var e=Date.now();this._qc.update(t),this._qc.debug.total+=Date.now()-e};var Yt=o.Game.prototype.setUpRenderer;o.Game.prototype.setUpRenderer=function(){!this.device.webGL||this.device.desktop||this.device.iOS||s.isSupportWebGL&&!s.isSupportWebGL(this._qc)&&(this.device.webGL=!1),Yt.call(this)},o.Group.prototype.preUpdate=function(){var t=this._qc;if(t&&t.static)return!0;if(t){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.preUpdate(),!this.visible)))return}}var n=this.children;for(i=n.length;i--;)n[i]&&(n[i].visible?n[i].preUpdate():n[i].renderOrderID=-1);return!0},o.Group.prototype.update=function(){var t=this._qc;if(t&&t.static)return!0;if(t){t.update&&t.update();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.update&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.update(),!this.visible)))return}}var n=this.children;for(i=n.length;i--;)n[i]&&n[i].visible&&n[i].update()},o.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var t=this._qc;if(!t||!t.static){if(t){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.postUpdate(),!this.visible)))return}}var n=this.children;for(i=n.length;i--;)n[i]&&n[i].visible&&n[i].postUpdate()}},o.StateManager.prototype.loadComplete=function(){var t=this;if(!0!==t._created){var e=t.game._qc;e.assets.parsing||e.state.pendLoadComplete?e.timer.add(15,function(){t.loadComplete()}):!1===t._created&&t.onCreateCallback?(t._created=!0,t.onCreateCallback.call(t.callbackContext,t.game)):t._created=!0}};var Xt=o.StateManager.prototype.clearCurrentState;o.StateManager.prototype.clearCurrentState=function(){Xt.call(this),this.game.world.displayChanged(s.DisplayChangeStatus.SIZE)};var Ht=o.Device._initialize;o.Device._initialize=function(){Ht.call(this);var e=t.navigator.userAgent;this.UCBrowser=/UCBrowser/.test(e),this.iOS&&(navigator.appVersion.match(/OS (\d+)/),this.iOSVersion=parseInt(RegExp.$1,10));var i=/AppleWebKit\/([0-9\.]+)/,r=i.exec(navigator.userAgent);r&&r.length>0?(this.AppleWebKit=!0,this.AppleWebKitVersion=r[1].split(".")):this.AppleWebKit=!1,this.supportStencil=!this.AppleWebKit||this.AppleWebKitVersion[0]>534,this.android&&this.UCBrowser&&(s.__IS_ANDROID_UC=!0)},o.Animation=function(t,e,i,r,n,a,s){void 0===s&&(s=!1),this.game=t,this._parent=e,this._frameData=r,this.name=i,this._frames=[],this._frames=this._frames.concat(n),this.delay=1e3/a,this.loop=s,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.onStart=new o.Signal,this.onUpdate=null,this.onComplete=new o.Signal,this.onLoop=new o.Signal,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},o.Animation.prototype={play:function(t,e,i){return"number"==typeof t&&(this.delay=1e3/t),"boolean"==typeof e&&(this.loop=e),void 0!==i&&(this.killOnComplete=i),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.updateCurrentFrame(!1),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},setFrame:function(t,e){var i;if(void 0===e&&(e=!1),"string"==typeof t)for(var r=0;r<this._frames.length;r++)this._frameData&&this._frameData.getFrame(this._frames[r]).name===t&&(i=r);else if("number"==typeof t)if(e)i=t;else for(r=0;r<this._frames.length;r++)this._frames[r]===i&&(i=r);i&&(this._frameIndex=i-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,t&&(this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[0]):0,this._parent.setFrame(this.currentFrame)),e&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return!this.isPaused&&(!!(this.isPlaying&&this.game.time.time>=this._timeNextFrame)&&(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay,this._frameSkip+=1),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length?this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),this.updateCurrentFrame(!0)):(this.complete(),!1):this.updateCurrentFrame(!0)))},updateCurrentFrame:function(t){return!!this._frameData&&(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),!this.onUpdate||!t||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData))},next:function(t){void 0===t&&(t=1);var e=this._frameIndex+t;e>=this._frames.length&&(this.loop?e%=this._frames.length:e=this._frames.length-1),e!==this._frameIndex&&(this._frameIndex=e,this.updateCurrentFrame(!0))},previous:function(t){void 0===t&&(t=1);var e=this._frameIndex-t;e<0&&(this.loop?e=this._frames.length+e:e++),e!==this._frameIndex&&(this._frameIndex=e,this.updateCurrentFrame(!0))},updateFrameData:function(t){this._frameData=t,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):this._frameIndex%this._frames.length},destroy:function(){this.game&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},o.Animation.prototype.constructor=o.Animation,e.defineProperty(o.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t,t?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),e.defineProperty(o.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),e.defineProperty(o.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(t){this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[t]):t,null!==this.currentFrame&&(this._frameIndex=t,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),e.defineProperty(o.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(t){t>=1&&(this.delay=1e3/t)}}),e.defineProperty(o.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(t){t&&null===this.onUpdate?this.onUpdate=new o.Signal:t||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),o.Animation.generateFrameNames=function(t,e,i,r,n){void 0===r&&(r="");var a=[],s="";if(e<i)for(var h=e;h<=i;h++)s="number"==typeof n?o.Utils.pad(h.toString(),n,"0",1):h.toString(),s=t+s+r,a.push(s);else for(h=e;h>=i;h--)s="number"==typeof n?o.Utils.pad(h.toString(),n,"0",1):h.toString(),s=t+s+r,a.push(s);return a},o.AnimationManager=function(t){this.sprite=t,this.game=t.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},o.AnimationManager.prototype={loadFrameData:function(t,e){if(void 0===t)return!1;if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(t);return this._frameData=t,null==e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},copyFrameData:function(t,e){if(this._frameData=t.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return null==e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},add:function(t,e,i,r,n){if(e=e||[],i=i||60,void 0===r&&(r=!1),void 0===n&&(n=!(!e||"number"!=typeof e[0])),this._outputFrames.length=0,this.sprite._qc&&this.sprite._qc.animationType===s.Sprite.FRAME_ANIMATION)this._frameData.getFrameIndexes(e,n,this._outputFrames),this._anims[t]=new o.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,r);else{for(var a=this.sprite._qc._animation[t].last,h=new Array(a),l=0,u=a;l<u;l++)h[l]=l;this._anims[t]=new o.Animation(this.game,this.sprite,t,null,h,i,r)}return this.currentAnim=this._anims[t],this.sprite._qc&&this.sprite._qc.animationType===s.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame),this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[t]},validateFrames:function(t,e){void 0===e&&(e=!0);for(var i=0;i<t.length;i++)if(!0===e){if(t[i]>this._frameData.total)return!1}else if(!1===this._frameData.checkFrameName(t[i]))return!1;return!0},play:function(t,e,i,r){if(this._anims[t]){var n=this.currentAnim;return n===this._anims[t]?!1===n.isPlaying?(n.paused=!1,n.play(e,i,r)):("number"==typeof e&&n.delay!==1e3/e&&(n.delay=1e3/e,n._timeNextFrame=n._timeLastFrame+n.delay),"boolean"==typeof i&&(n.loop=i),void 0!==r&&(n.killOnComplete=r),n):(n&&n.isPlaying&&n.stop(),n=this._anims[t],n.paused=!1,this.sprite._qc&&this.sprite._qc.animationType===s.Sprite.FRAME_ANIMATION&&(this.currentFrame=n.currentFrame),n.play(e,i,r))}},stop:function(t,e){void 0===e&&(e=!1),"string"==typeof t?this._anims[t]&&(this.currentAnim=this._anims[t],this.currentAnim.stop(e)):this.currentAnim&&this.currentAnim.stop(e)},update:function(){return!(this.updateIfVisible&&!this.sprite.visible)&&(!(!this.currentAnim||!this.currentAnim.update())&&(this.sprite._qc&&this.sprite._qc.animationType===s.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame),!0))},next:function(t){this.currentAnim&&(this.currentAnim.next(t),this.sprite._qc&&this.sprite._qc.animationType===s.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame))},previous:function(t){this.currentAnim&&(this.currentAnim.previous(t),this.sprite._qc&&this.sprite._qc.animationType===s.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame))},getAnimation:function(t){return"string"==typeof t&&this._anims[t]?this._anims[t]:null},refreshFrame:function(){this.sprite.setTexture(h.TextureCache[this.currentFrame.uuid]),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var t=null;for(var t in this._anims)this._anims.hasOwnProperty(t)&&this._anims[t].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},o.AnimationManager.prototype.constructor=o.AnimationManager,e.defineProperty(o.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),e.defineProperty(o.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),e.defineProperty(o.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}}),e.defineProperty(o.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}}),e.defineProperty(o.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},set:function(t){"number"==typeof t&&this._frameData&&null!==this._frameData.getFrame(t)&&(this.currentFrame=this._frameData.getFrame(t),this.currentFrame&&(this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}}),e.defineProperty(o.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(t){"string"==typeof t&&null!==this._frameData.getFrameByName(t)&&(this.currentFrame=this._frameData.getFrameByName(t),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}}),s.BATCH_QUAD=0,s.BATCH_TRIANGLES=1;var qt=h.WebGLSpriteBatch.prototype.setContext;h.WebGLSpriteBatch.prototype.setContext=function(t){qt.call(this,t),this.quadSize=this.size,this.triangleSize=300,this.batchIndexNumber=6;var e=3*this.triangleSize;this.triangleIndices=new h.Uint16Array(e);for(var i=0;i<e;++i)this.triangleIndices[i]=i;this._batchType=s.BATCH_QUAD,this.quadIndexBuffer=this.indexBuffer,this.triangleIndexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.triangleIndices,t.STATIC_DRAW)};var Kt=h.WebGLSpriteBatch.prototype.destroy;h.WebGLSpriteBatch.prototype.destroy=function(){this.triangleIndices=null,this.gl.deleteBuffer(this.triangleIndexBuffer),Kt.call(this)},e.defineProperties(h.WebGLSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(t){t!==this._batchType&&(this.stop(),t===s.BATCH_TRIANGLES?(this.size=this.triangleSize,this.indexBuffer=this.triangleIndexBuffer,this._batchType=t,this.batchIndexNumber=3):(this.size=this.quadSize,this.indexBuffer=this.quadIndexBuffer,this._batchType=t,this.batchIndexNumber=6),this.start())}}}),h.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var r=this.gl;t._dirty[r.id]?this.renderSession.renderer.updateTexture(t):r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id]),r.drawElements(r.TRIANGLES,e*this.batchIndexNumber,r.UNSIGNED_SHORT,i*this.batchIndexNumber*2),this.renderSession.drawCount++}},h.CanvasMaskManager.prototype.popMask=function(t){if(t.context.restore(),s.__IS_ANDROID_UC){var e=s._tempCanvas;e||(e=s._tempCanvas=document.createElement("canvas"),e.width=128,e.height=128),t.context.drawImage(e,0,0,2,2,-5,-5,1,1)}},h.CanvasTinter.getTintedTexture=function(t,e){var i=t.tintedTexture||document.createElement("canvas");return h.CanvasTinter.tintMethod(t.texture,e,i),i};var Jt=s.DisplayChangeStatus={OFFSET:1,SCALE:2,ROTATION:4,SIZE:8,TINT:16,ALPHA:32,SHOW:64,HIDE:128,TEXTURE:256,ORDER:512};Jt.VISIBLE_MASK=Jt.SHOW|Jt.HIDE,Jt.INHERIT_MASK=Jt.SIZE|Jt.ORDER|Jt.OFFSET|Jt.SCALE|Jt.ROTATION|Jt.VISIBLE_MASK,Jt.RECALC_MASK=Jt.ROTATION|Jt.VISIBLE_MASK|Jt.SIZE|Jt.SCALE,Jt.REOFFSET_MASK=Jt.OFFSET;var Zt=h.DisplayObject.prototype.destroy;h.DisplayObject.prototype.destroy=function(){this.maybeOutWorld(),Zt.call(this)},h.DisplayObject.prototype.setDisplayProxy=function(t,e){this._displayProxy=t,this._skipChildren=e},h.DisplayObject.prototype.getDisplayProxy=function(){return this._displayProxy},h.DisplayObject.prototype.isSkipChildrenRender=function(){return this._skipChildren},h.DisplayObject.prototype.maybeOutWorld=function(){this.game?this.game._qc&&this.game._qc.dirtyRectangle.redirectDirty(this._currWorldBounds):this.stage&&this.stage.game._qc&&this.stage.game._qc.dirtyRectangle.redirectDirty(this._currWorldBounds)},h.DisplayObject.prototype.displayChanged=function(t){if(0!==t&&null!=t){var e=this;if(null==e._displayChangeStatus&&(e._displayChangeStatus=Jt.SHOW),e._displayChangeStatus|=t,t&Jt.HIDE){this.displayObjectUpdateTransform();for(var i=0,r=this.children.length;i<r;++i)this.children[i].updateTransform()}else t&Jt.SHOW&&(e._displayChangeStatus&=~Jt.HIDE);for(var n=e;(n=n.parent)&&!n._subDisplayChanged;)n._subDisplayChanged=!0}},h.DisplayObject.prototype._fastCalcBounds=function(t,e){var i=this,r=i.getSelfWidth&&i.getSelfWidth(),n=i.getSelfHeight&&i.getSelfHeight();if(e&Jt.HIDE||!i.worldAlpha||!i.worldVisible||!r||!n)return null;var a=i.worldTransform,s=a.a,o=a.b,h=a.c,l=a.d,u=a.tx,c=a.ty;if(!t||e&Jt.RECALC_MASK){var p,d,f,_,g,m,y,v,T,x,b,A,S,w=i.anchor?i.anchor.x:0,P=i.anchor?i.anchor.y:0,E=r*-w,D=n*-P,C=E+r,O=D+n;if(r<0&&(p=E,E=C,C=p),n<0&&(p=D,D=O,O=p),0===o&&0===h)s<0?(d=s*C+u,f=s*E+u):(d=s*E+u,f=s*C+u),l<0?(_=l*O+c,g=l*D+c):(_=l*D+c,g=l*O+c);else s>=0?(m=s*E,y=s*C):(m=s*C,y=s*E),o>=0?(v=o*E,T=o*C):(v=o*C,T=o*E),h>=0?(x=h*D,b=h*O):(x=h*O,b=h*D),l>=0?(A=l*D,S=l*O):(A=l*O,S=l*D),d=m+x+u,f=y+b+u,_=v+A+c,g=T+S+c;return{x:d,y:_,width:f-d,height:g-_,tx:u,ty:c,area:(f-d)*(g-_)}}if(e&Jt.REOFFSET_MASK){t.tx,t.ty;return{x:t.x+u-t.tx,y:t.y+c-t.ty,width:t.width,height:t.height,tx:u,ty:c,area:t.area}}return{x:t.x,y:t.y,tx:t.tx,ty:t.ty,width:t.width,height:t.height,area:t.area}},h.DisplayObject.prototype._updateBounds=function(t){var e=this,i=(e.worldTransform,e.parent),r=i?i._displayChangeStatus:0;(null==e._displayChangeStatus||t)&&(e._displayChangeStatus=Jt.SHOW);var n=e._displayChangeStatus;if(n|=r&Jt.INHERIT_MASK,!(e.worldVisible||n&Jt.HIDE))return!0;if(0===n)return!1;e._lastWorldBounds||(e._lastWorldBounds=[]);var a=e._qc&&e._qc.animationType===s.Sprite.FRAME_SAMPLES,o=e._currWorldBounds;if(e._currWorldBounds&&e._lastWorldBounds.push(e._currWorldBounds),e._displayChangeStatus=n,a){var h=e._qc.getSampledAnimationBounds(),l=e.worldTransform.apply(new s.Point(h.x,h.y)),u=e.worldTransform.apply(new s.Point(h.x+h.width,h.y)),c=e.worldTransform.apply(new s.Point(h.x+h.width,h.y+h.height)),p=e.worldTransform.apply(new s.Point(h.x,h.y+h.height)),d=Math.min(l.x,u.x,c.x,p.x),f=Math.max(l.x,u.x,c.x,p.x),_=Math.min(l.y,u.y,c.y,p.y),g=Math.max(l.y,u.y,c.y,p.y);e._currWorldBounds={x:d,y:_,width:f-d,height:g-_,area:(f-d)*(g-_)}}else e._currWorldBounds=e._fastCalcBounds(e._lastWorldBounds[e._lastWorldBounds.length-1],n);return e._dirtyBounds=o!==e._currWorldBounds,!1},h.DisplayObject.prototype._resetDisplayChangeStatus=function(){var t=this;t._displayChangeStatus=0},h.DisplayObject.prototype.updateTransform=function(){var t=this.parent;if(t)if(this.worldAlpha=this.alpha*this.parent.worldAlpha,this._lastWorldAlpha!==this.worldAlpha&&(this._lastWorldAlpha=this.worldAlpha,this.displayChanged(Jt.ALPHA)),!this._isNotNeedCalcTransform||t._isSubNeedCalcTransform){this.game&&this.game._calcTransformCount++;var e,i,r,n,a,s,o=this.parent.worldTransform,l=this.worldTransform;l.inUpdate=!0,this.rotation%h.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),e=this._cr*this.scale.x,i=this._sr*this.scale.x,r=-this._sr*this.scale.y,n=this._cr*this.scale.y,a=this.position.x,s=this.position.y,(this.pivot.x||this.pivot.y)&&(a-=this.pivot.x*e+this.pivot.y*r,s-=this.pivot.x*i+this.pivot.y*n),l.a=e*o.a+i*o.c,l.b=e*o.b+i*o.d,l.c=r*o.a+n*o.c,l.d=r*o.b+n*o.d,l.tx=a*o.a+s*o.c+o.tx,
l.ty=a*o.b+s*o.d+o.ty):(e=this.scale.x,n=this.scale.y,a=this.position.x-this.pivot.x*e,s=this.position.y-this.pivot.y*n,l.a=e*o.a,l.b=e*o.b,l.c=n*o.c,l.d=n*o.d,l.tx=a*o.a+s*o.c+o.tx,l.ty=a*o.b+s*o.d+o.ty),this._isNotNeedCalcTransform=!0,this._isSubNeedCalcTransform=!0,this.worldTransformChangedCallback&&this.worldTransformChangedCallback.call(this.worldTransformChangedContext),this.transformCallback&&(l.inUpdate=!1,this.transformCallback.call(this.transformCallbackContext,l,o)),this._onTransformChanged&&this._onTransformChanged.dispatch(l,o)}else{this._isSubNeedCalcTransform=!1;l=this.worldTransform,o=t.worldTransform;this.transformCallback&&(l.inUpdate=!1,this.transformCallback.call(this.transformCallbackContext,l,o))}},h.DisplayObject.prototype.displayObjectUpdateTransform=h.DisplayObject.prototype.updateTransform,h.DisplayObject.prototype.getWorldTransform=function(){for(var t=!1,e=this,i=null;e;)e._isNotNeedCalcTransform||(t=!0,i=e),e=e.parent;return t&&i.updateTransform(),this.worldTransform},h.DisplayObjectContainer.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else{var e;this.softClip&&tt.getManager(t).pushPolygon(this.softClip);var i=!1;if(this._graphicsFilter||this._mask||this._filters){if(this._graphicsFilter&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._renderSelfWebGL&&(i=this._renderSelfWebGL(t)),!i)for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&!this.filterSelf&&t.filterManager.popFilter(),this._graphicsFilter&&t.filterManager.popFilter(),t.spriteBatch.start()}else if(this._renderSelfWebGL&&(i=this._renderSelfWebGL(t)),!i)for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);this.softClip&&tt.getManager(t).popPolygon()}},h.DisplayObjectContainer.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(t);else{var e=!1;if(this._mask&&t.maskManager.pushMask(this._mask,t),this._renderSelfCanvas&&(e=this._renderSelfCanvas(t)),!e)for(var i=0;i<this.children.length;i++)this.children[i]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},h.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this._qc&&this._qc._dispatchChildrenChanged("add",[t._qc]),this.stage&&t.setStageReference(this.stage),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},h.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(i<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[r]=t,this._qc&&this._qc._dispatchChildrenChanged("order",[t._qc,e._qc]),t.displayChanged(s.DisplayChangeStatus.ORDER),e.displayChanged(s.DisplayChangeStatus.ORDER)}},h.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t),this._qc&&this._qc._dispatchChildrenChanged("order",[t._qc]),t.displayChanged(s.DisplayChangeStatus.ORDER)},h.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.maybeOutWorld(),this.stage&&e.removeStageReference(),e.parent=i,this.children.splice(t,1),this._qc&&this._qc._dispatchChildrenChanged("remove",[e._qc]),e},h.DisplayObjectContainer.prototype.remove=function(t){return this.removeChild(t)},h.DisplayObjectContainer.prototype.removeChildren=function(t,e){var r=t||0,n="number"==typeof e?e:this.children.length,a=n-r;if(a>0&&a<=n){for(var s=this.children.splice(r,a),o=[],h=0;h<s.length;h++){var l=s[h];l.maybeOutWorld(),this.stage&&l.removeStageReference(),l.parent=i,l._qc&&o.push(l._qc)}return this._qc&&this._qc._dispatchChildrenChanged("remove",o),s}if(0===a&&0===this.children.length)return this._qc&&this._qc._dispatchChildrenChanged("remove",[]),[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},h.DisplayObjectContainer.prototype.getLocalBounds=function(){var t=this.worldTransform;this._isSubNeedCalcTransform=!0,this.worldTransform=h.identityMatrix;for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateTransform();var r=this.getBounds();return this.worldTransform=t,this._isSubNeedCalcTransform=!0,this._isNotNeedCalcTransform=!1,r},h.DisplayObjectContainer.prototype.displayMaybeOutWorld=h.DisplayObject.prototype.maybeOutWorld,h.DisplayObjectContainer.prototype.maybeOutWorld=function(){this.displayMaybeOutWorld();for(var t=this.children,e=0,i=t.length;e<i;e++)t[e].maybeOutWorld()},h.PixiShader.prototype.init=function(){var t=this.gl,e=h.compileProgram(t,this.vertexSrc||h.PixiShader.defaultVertexSrc,this.fragmentSrc);if(t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.uSourceSampler=t.getUniformLocation(e,"uSourceSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.pixelSize=t.getUniformLocation(e,"pixelSize"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.extraAttribute)for(var i in this.extraAttribute){var r=this.extraAttribute[i].name;this[r]=t.getAttribLocation(e,r),this.attributes.push(this[r])}for(var r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(e,r);this.initUniforms(),this.program=e};var Qt=h.Sprite.prototype.setTexture;h.Sprite.prototype.setTexture=function(t){Qt.call(this,t),this.displayChanged(s.DisplayChangeStatus.TEXTURE|s.DisplayChangeStatus.SIZE)},h.Sprite.prototype.getSelfWidth=function(){return this._qc?this._qc.width:this.texture&&this.texture.frame&&this.texture.frame.width},h.Sprite.prototype.getSelfHeight=function(){return this._qc?this._qc.height:this.texture&&this.texture.frame&&this.texture.frame.height},h.Sprite.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)&&this.renderable){var e;if(this.softClip&&tt.getManager(t).pushPolygon(this.softClip),this.maskPixel){var i=t.spriteBatch;for(i.flush(),t.filterManager.pushFilter(this.maskPixel),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);i.stop(),t.filterManager.popFilter(),i.start()}else if(this._graphicsFilter||this._mask||this._filters){i=t.spriteBatch;if(this._graphicsFilter&&(i.flush(),t.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(i.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(i.stop(),t.maskManager.pushMask(this.mask,t),i.start()),this._filters&&this.filterSelf){i.stop();var r=this.texture.baseTexture._glTextures[t.gl.id],n=t.filterManager.buildFilterTexture(t,this._filterBlock,this);i.start();var a=this.texture._uvs;n&&(this.texture.baseTexture._glTextures[t.gl.id]=n.texture),this._renderWebGLImpl(t),i.flush(),n&&(this.texture.baseTexture._glTextures[t.gl.id]=r,t.filterManager.texturePool.push(n),this.texture._uvs=a)}else this._renderWebGLImpl(t);for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);i.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&!this.filterSelf&&t.filterManager.popFilter(),this._graphicsFilter&&t.filterManager.popFilter(),i.start()}else for(this._renderWebGLImpl(t),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);this.softClip&&tt.getManager(t).popPolygon()}},h.WebGLStencilManager.prototype.pushSpriteStencil=function(t,e){var i=this.gl;0===this.stencilStack.length&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(t);var r=this.count;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.ALWAYS,0,255),i.stencilOp(i.KEEP,i.KEEP,i.INVERT),this.reverse?(i.stencilFunc(i.EQUAL,r,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)):(i.stencilFunc(i.EQUAL,255-r,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)),t._renderWebGLImpl(e),e.spriteBatch.flush(),this.reverse?i.stencilFunc(i.EQUAL,r+1,255):i.stencilFunc(i.EQUAL,255-(r+1),255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),this.count++},h.WebGLStencilManager.prototype.popSpriteStencil=function(t,e){var i=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)i.disable(i.STENCIL_TEST);else{var r=this.count;i.colorMask(!1,!1,!1,!1),this.reverse?(i.stencilFunc(i.EQUAL,r+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)):(i.stencilFunc(i.EQUAL,255-(r+1),255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)),t._renderWebGLImpl(e),e.spriteBatch.flush(),this.reverse?i.stencilFunc(i.EQUAL,r,255):i.stencilFunc(i.EQUAL,255-r,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}},h.Sprite.prototype._renderWebGLImpl=function(t){var e=t.softClipManager,i=t.spriteBatch;if(e&&e.needClip){var r=this.texture,n=r.baseTexture.resolution,a=this.worldTransform,s=r._uvs;if(!s)return;var o,h,l,u,c=a.a/n,p=a.b/n,d=a.c/n,f=a.d/n,_=a.tx,g=a.ty,m=this.anchor.x,y=this.anchor.y;if(r.trim){var v=r.trim;h=v.x-m*v.width,o=h+r.crop.width,u=v.y-y*v.height,l=u+r.crop.height}else o=r.frame.width*(1-m),h=r.frame.width*-m,l=r.frame.height*(1-y),u=r.frame.height*-y;var T=this.tint;T=(T>>16)+(65280&T)+((255&T)<<16)+(255*this.worldAlpha<<24),e.renderSprite(t,this,h,u,o,l,s.x0,s.y0,s.x2,s.y2,c,p,d,f,_,g,T)}else i.render(this)},h.Sprite.prototype._renderCanvas=function(t){if(!(!1===this.visible||0===this.alpha||!1===this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.maskPixel){var e=t.bufferPool||(t.bufferPool=[]),i=t.context,r=i.globalOffX||0,n=i.globalOffY||0,a=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds(),s=Math.max(r,a.x),o=Math.max(n,a.y),l=Math.min(a.x+a.width,i.canvas.width+r),u=Math.min(a.y+a.height,i.canvas.height+n);a.x=s,a.y=o,a.width=l-s,a.height=u-o;var c=e.pop();c||(c=new h.CanvasBuffer(t.context.canvas.width*t.resolution,t.context.canvas.height*t.resolution),c.context._setTransform=c.context.setTransform,c.context.setTransform=function(t,e,i,r,n,a){this._setTransform(t,e,i,r,n-(this.globalOffX||0),a-(this.globalOffY||0))}),c.resize(a.width*t.resolution,a.height*t.resolution),c.context.clearRect(0,0,a.width*t.resolution,a.height*t.resolution),c.context.globalOffX=a.x*t.resolution+r,c.context.globalOffY=a.y*t.resolution+n,t.context=c.context}if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=h.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var p=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===h.scaleModes.LINEAR);var d=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,f=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;t.roundPixels?(t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),d|=0,f|=0):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),this.maskPixel||(16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=h.CanvasTinter.getTintedTexture(this,this.tint)),t.drawCount++,t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,d/p,f/p,this.texture.frame.width/p,this.texture.frame.height/p)):(t.drawCount++,t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,d/p,f/p,this.texture.frame.width/p,this.texture.frame.height/p)))}for(var _=0;_<this.children.length;_++)this.children[_]._renderCanvas(t);if(this._mask&&t.maskManager.popMask(t),this.maskPixel&&this.texture.valid){var g=t.context;g.globalCompositeOperation="destination-in",t.roundPixels?(g.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),d|=0,f|=0):g.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),t.drawCount++,g.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,d/p,f/p,this.texture.crop.width/p,this.texture.crop.height/p),g.globalCompositeOperation="source-over",t.context=i,t.roundPixels?t.context.setTransform(1,0,0,1,a.x*t.resolution|0,a.y*t.resolution|0):t.context.setTransform(1,0,0,1,a.x*t.resolution,a.y*t.resolution),t.drawCount++,t.context.drawImage(c.canvas,0,0,c.canvas.width,c.canvas.height,0,0,c.canvas.width,c.canvas.height),e.push(c)}}};var $t=h.WebGLFastSpriteBatch.prototype.setContext;h.WebGLFastSpriteBatch.prototype.setContext=function(t){$t.call(this,t),this.quadSize=this.size,this.triangleSize=300,this.batchIndexNumber=6;var e=3*this.triangleSize;this.triangleIndices=new h.Uint16Array(e);for(var i=0;i<e;++i)this.triangleIndices[i]=i;this._batchType=s.BATCH_QUAD,this.quadIndexBuffer=this.indexBuffer,this.triangleIndexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.triangleIndices,t.STATIC_DRAW)};var te=h.WebGLFastSpriteBatch.prototype.destroy;h.WebGLFastSpriteBatch.prototype.destroy=function(){this.triangleIndices=null,this.gl.deleteBuffer(this.triangleIndexBuffer),te.call(this)},e.defineProperties(h.WebGLFastSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(t){t!==this._batchType&&(this.stop(),t===s.BATCH_TRIANGLES?(this.size=this.triangleSize,this.indexBuffer=this.triangleIndexBuffer,this._batchType=t,this.batchIndexNumber=3):(this.size=this.quadSize,this.indexBuffer=this.quadIndexBuffer,this._batchType=t,this.batchIndexNumber=6),this.start())}}}),h.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,this.currentBatchSize*this.batchIndexNumber,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},h.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new h.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new h.Float32Array(8*xi.MAX_SAMPLE_COUNT),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new h.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},h.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl,i=this.renderSession.projection,r=this.renderSession.offset,n=t._filterArea=(t.target.filterArea||t.target.getBounds()).clone();t._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new h.WebGLStencilManager,this.renderSession.stencilManager.setContext(e),e.disable(e.STENCIL_TEST),this.filterStack.push(t);for(var a=t.filterPasses.length,s=0;a--;){var o=t.filterPasses[a];o.padding>s&&(s=o.padding)}n.x-=s,n.y-=s,n.width+=2*s,n.height+=2*s;var l=Math.max(this.offsetX,n.x),u=Math.max(this.offsetY,n.y),c=Math.max(l,Math.min(n.x+n.width,this.width+this.offsetX)),p=Math.max(u,Math.min(n.y+n.height,this.height+this.offsetY));n.x=l,n.y=u,n.width=c-l,n.height=p-u,this.offsetX+=n.x,this.offsetY+=n.y;var d=this.texturePool.pop();d?d.resize(this.width,this.height):d=new h.FilterTexture(this.gl,this.width,this.height),e.bindTexture(e.TEXTURE_2D,d.texture),e.bindFramebuffer(e.FRAMEBUFFER,d.frameBuffer),e.viewport(0,0,n.width,n.height),i.x=n.width/2,i.y=-n.height/2,r.x=-n.x,r.y=-n.y,e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t._glFilterTexture=d},h.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,e=this.filterStack.pop(),i=e._filterArea,r=e._glFilterTexture,n=e._glFilterTexture,a=this.renderSession.projection,s=this.renderSession.offset;if(e.filterPasses.length>1){t.viewport(0,0,i.width,i.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=0,this.uvArray[1]=0,this.uvArray[2]=i.width/this.width,this.uvArray[3]=0,this.uvArray[4]=0,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var o=r,l=this.texturePool.pop();l||(l=new h.FilterTexture(this.gl,this.width,this.height)),l.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,l.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var u=0;u<e.filterPasses.length-1;u++){var c=e.filterPasses[u],p=c.extraAttribute;if(p){t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);for(var d=0;d<p.length;++d){var f=c.uniforms[p[d].texture].value;if(f){var _=f._uvs;this.uvArray[8*(d+1)]=_.x3,this.uvArray[8*(d+1)+1]=_.y3,this.uvArray[8*(d+1)+2]=_.x2,this.uvArray[8*(d+1)+3]=_.y2,this.uvArray[8*(d+1)+4]=_.x0,this.uvArray[8*(d+1)+5]=_.y0,this.uvArray[8*(d+1)+6]=_.x1,this.uvArray[8*(d+1)+7]=_.y1}}t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray)}t.bindFramebuffer(t.FRAMEBUFFER,l.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o.texture),this.applyFilterPass(c,i,i.width,i.height,n);var g=o;o=l,g===n?(l=this.texturePool.pop(),l||(l=new h.FilterTexture(this.gl,this.width,this.height))):l=g}t.enable(t.BLEND),r=o,this.texturePool.push(l)}var m=e.filterPasses[e.filterPasses.length-1];this.offsetX-=i.x,this.offsetY-=i.y;var y=this.width,v=this.height,T=0,x=0,b=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var A=this.filterStack[this.filterStack.length-1];i=A._filterArea,y=i.width,v=i.height,T=i.x,x=i.y,b=A._glFilterTexture.frameBuffer}a.x=y/2,a.y=-v/2,s.x=T,s.y=x,i=e._filterArea;var S=i.x-T,w=i.y-x;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=S,this.vertexArray[1]=w+i.height,this.vertexArray[2]=S+i.width,this.vertexArray[3]=w+i.height,this.vertexArray[4]=S,this.vertexArray[5]=w,this.vertexArray[6]=S+i.width,this.vertexArray[7]=w,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=0,this.uvArray[1]=0,this.uvArray[2]=i.width/this.width,this.uvArray[3]=0,this.uvArray[4]=0,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height;p=m.extraAttribute;if(p)for(d=0;d<p.length;++d){f=m.uniforms[p[d].texture].value;if(f){_=f._uvs;this.uvArray[8*(d+1)]=_.x3,this.uvArray[8*(d+1)+1]=_.y3,this.uvArray[8*(d+1)+2]=_.x2,this.uvArray[8*(d+1)+3]=_.y2,this.uvArray[8*(d+1)+4]=_.x0,this.uvArray[8*(d+1)+5]=_.y0,this.uvArray[8*(d+1)+6]=_.x1,this.uvArray[8*(d+1)+7]=_.y1}}t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,y*this.renderSession.resolution,v*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,b),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=e._previous_stencil_mgr,e._previous_stencil_mgr=null,this.renderSession.stencilManager.count>0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.applyFilterPass(m,i,y,v,n),r!==n&&this.texturePool.push(n),this.texturePool.push(r),e._glFilterTexture=null},h.WebGLFilterManager.prototype.buildFilterTexture=function(t,e,i){var r=t.gl,n=r.isEnabled(r.STENCIL_TEST);n&&r.disable(r.STENCIL_TEST);var a=i.texture.baseTexture;a._glTextures[r.id]||t.renderer.updateTexture(a,r);var o=a._glTextures[r.id],l={texture:o},u=new s.Rectangle(0,0,a.width,a.height),c=i.texture.crop,p=i.texture._uvs,d=this.texturePool.pop();d||(d=new h.FilterTexture(this.gl,u.width,u.height)),d.resize(u.width,u.height),r.bindFramebuffer(r.FRAMEBUFFER,d.frameBuffer),r.viewport(0,0,u.width,u.height),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.disable(r.BLEND),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=c.x,this.vertexArray[1]=u.height-c.y,this.vertexArray[2]=c.x+c.width,this.vertexArray[3]=u.height-c.y,this.vertexArray[4]=c.x,this.vertexArray[5]=u.height-c.y-c.height,this.vertexArray[6]=c.x+c.width,this.vertexArray[7]=u.height-c.y-c.height,r.bufferSubData(r.ARRAY_BUFFER,0,this.vertexArray);var f=e.filterPasses[0];r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=p.x0,this.uvArray[1]=p.y0,this.uvArray[2]=p.x1,this.uvArray[3]=p.y1,this.uvArray[4]=p.x3,this.uvArray[5]=p.y3,this.uvArray[6]=p.x2,this.uvArray[7]=p.y2;var _=f.extraAttribute;if(_)for(var g=0;g<_.length;++g){var m=f.uniforms[_[g].texture].value;if(m){p=m._uvs;this.uvArray[8*(g+1)]=p.x0,this.uvArray[8*(g+1)+1]=p.y0,this.uvArray[8*(g+1)+2]=p.x1,this.uvArray[8*(g+1)+3]=p.y1,this.uvArray[8*(g+1)+4]=p.x3,this.uvArray[8*(g+1)+5]=p.y3,this.uvArray[8*(g+1)+6]=p.x2,this.uvArray[8*(g+1)+7]=p.y2}}r.bufferSubData(r.ARRAY_BUFFER,0,this.uvArray),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.texture),this.applyFilterPass(f,new s.Rectangle(0,0,u.width,u.height),u.width,u.height,l,u.width,u.height);for(var y=null,v=1;v<e.filterPasses.length;v++){var T=y;y=d,d=T,d||(d=this.texturePool.pop(),d||(d=new h.FilterTexture(this.gl,u.width,u.height)),d.resize(u.width,u.height)),r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this._filterSelfUVArray);f=e.filterPasses[v],_=f.extraAttribute;if(_){r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer);for(g=0;g<_.length;++g){m=f.uniforms[_[g].texture].value;if(m){p=m._uvs;this.uvArray[8*(g+1)]=p.x0,this.uvArray[8*(g+1)+1]=p.y0,this.uvArray[8*(g+1)+2]=p.x1,this.uvArray[8*(g+1)+3]=p.y1,this.uvArray[8*(g+1)+4]=p.x3,this.uvArray[8*(g+1)+5]=p.y3,this.uvArray[8*(g+1)+6]=p.x2,this.uvArray[8*(g+1)+7]=p.y2}}r.bufferSubData(r.ARRAY_BUFFER,0,this.uvArray)}r.bindFramebuffer(r.FRAMEBUFFER,d.frameBuffer),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,y.texture),this.applyFilterPass(f,new s.Rectangle(0,0,u.width,u.height),u.width,u.height,l,u.width,u.height)}return n&&r.enable(r.STENCIL_TEST),r.enable(r.BLEND),r.viewport(0,0,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),r.bindFramebuffer(r.FRAMEBUFFER,this.buffer),r.colorMask(!0,!0,!0,!0),d},h.WebGLFilterManager.prototype.applyFilterPass=function(t,e,i,r,n,a,s){var o=this.gl,l=t.shaders[o.id];if(l||(l=new h.PixiShader(o),l.fragmentSrc=t.fragmentSrc,t.vertexSrc&&(l.vertexSrc=t.vertexSrc),l.uniforms=t.uniforms,t.extraAttribute&&(l.extraAttribute=t.extraAttribute),l.init(),t.shaders[o.id]=l),this.renderSession.shaderManager.setShader(l),a=isNaN(a)?this.width:a,s=isNaN(s)?this.height:s,o.uniform2f(l.projectionVector,i/2,-r/2),o.uniform2f(l.offsetVector,0,0),l.pixelSize&&o.uniform2f(l.pixelSize,1/a,1/s),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=a,t.uniforms.dimensions.value[1]=s,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),l.syncUniforms(),l.uSourceSampler&&n){var u=l.textureCount++;o.activeTexture(o["TEXTURE"+u]),o.bindTexture(o.TEXTURE_2D,n.texture),o.uniform1i(l.uSourceSampler,u)}o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer),o.vertexAttribPointer(l.aVertexPosition,2,o.FLOAT,!1,0,0);var c=t.extraAttribute;if(o.bindBuffer(o.ARRAY_BUFFER,this.uvBuffer),o.vertexAttribPointer(l.aTextureCoord,2,o.FLOAT,!1,0,0),c)for(var p=0;p<c.length;++p)o.vertexAttribPointer(l[c[p].name],2,o.FLOAT,!1,0,32*(p+1));o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer),o.vertexAttribPointer(l.colorAttribute,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.indexBuffer),o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0),this.renderSession.drawCount++},h.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;t._webGL[i.id].data.length&&e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)};var ee=h.Text.prototype.updateTexture;h.Text.prototype.updateTexture=function(){ee.call(this),this.displayChanged(s.DisplayChangeStatus.SIZE|s.DisplayChangeStatus.TEXTURE)},h.Text.prototype.getSelfWidth=function(){return this.texture&&this.texture.frame&&this.texture.frame.width*(this._canvasDownScale?this._canvasDownScale.x:1)},h.Text.prototype.getSelfHeight=function(){return this.texture&&this.texture.frame&&this.texture.frame.height*(this._canvasDownScale?this._canvasDownScale.y:1)},h.Text.prototype._uploadToRenderTexture=function(){var t=this._frameTexture,e=t.baseTexture,i=this.game.renderer;e.source=this.canvas,i.updateTexture(e),this.texture=t,e.resolution=this.resolution,e.scaleMode=h.scaleModes.NEAREST,e.width=t.crop.width=t.frame.width=this.canvas.width,e.height=t.crop.height=t.frame.height=this.canvas.height},e.defineProperty(o.Text.prototype,"dirty",{get:function(){return this._dirty},set:function(t){this._dirty!==t&&(this._dirty=t,this.displayChanged(s.DisplayChangeStatus.SIZE|s.DisplayChangeStatus.TEXTURE))}}),e.defineProperty(o.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width/this.resolution},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),e.defineProperty(o.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height/this.resolution},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}});var ie=h.Sprite.prototype._renderCanvas,re=h.Sprite.prototype._renderWebGL,ne=function(t){return function(e){var i,r=this._canvasDownScale,n=!1!==this._nqc.roundPixels;if(n&&(i=e.roundPixels,e.roundPixels=!0),r){var a=this.worldTransform,s=a.a,o=a.b,l=a.c,u=a.d,c=r.x,p=r.y;a.a*=c,a.b*=c,a.c*=p,a.d*=p,!this.game.antialias||a.a===a.d&&0===a.b&&0===a.c?this.texture.baseTexture.scaleMode=h.scaleModes.NEAREST:this.texture.baseTexture.scaleMode=h.scaleModes.LINEAR,t.call(this,e),a.a=s,a.b=o,a.c=l,a.d=u}else t.call(this,e);n&&(e.roundPixels=i)}};h.Text.prototype.getBounds=function(t){this.dirty&&(this.updateText(),this.dirty=!1);var e=this._canvasDownScale,i=this.worldTransform;i.tx=i.tx||0,i.ty=i.ty||0;var r=i.a,n=i.b,a=i.c,s=i.d,o=e.x,l=e.y;i.a*=o,i.b*=o,i.c*=l,i.d*=l;var u=h.Sprite.prototype.getBounds.call(this,t);return i.a=r,i.b=n,i.c=a,i.d=s,u},h.Text.prototype._renderCanvas=ne(ie),h.Text.prototype._renderWebGL=ne(re),o.Text.prototype.updateLine=function(t,e,i,r,n,a,o,h,l,u){for(var c=0;c<t.length;c++){var p=t[c];this.colors[this._charCount]&&("defaultColor"===this.colors[this._charCount]?r.fillStyle=a:r.fillStyle=this.colors[this._charCount]);var d=r.measureText(p).width;if(this.style.stroke&&n&&(this._clearShadowStyle(r),r.strokeText(p,e,i),this._restoreShadowStyle(r)),this.style.fill)if(l===r.fillStyle&&u){if(r.save(),r.fillStyle="black",r.fillText(p,e,i),r.globalCompositeOperation="source-in",r.fillStyle=l,r.beginPath(),r.rect(e,i-h/2,d,h),r.clip(),r.fillRect(e,i-h/2,d,h),r.restore(),s.__IS_ANDROID_UC){var f=s._tempCanvas;f||(f=s._tempCanvas=document.createElement("canvas"),f.width=128,f.height=128),r.drawImage(f,0,0,2,2,-5,-5,1,1)}}else r.fillText(p,e,i);e+=d,this._charCount++}},o.Text.prototype._clearShadowStyle=function(t){this.style.fill&&this._nqc&&this._nqc.enableShadow&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=null)},o.Text.prototype._restoreShadowStyle=function(t){this.style.fill&&this._nqc&&this._nqc.enableShadow&&(this._shadowOffset?(t.shadowOffsetX=this._shadowOffset[0],t.shadowOffsetY=this._shadowOffset[1]):(t.shadowOffsetX=this.style.shadowOffsetX,t.shadowOffsetY=this.style.shadowOffsetY),t.shadowColor=this.style.shadowColor,t.shadowBlur=this.style.shadowBlur)},o.Text.prototype._getWorldWidth=function(t){if(t.length>0&&"\n"===t[t.length-1]){var e=t.substr(0,t.length-1);return this.context.measureText(e).width}return this.context.measureText(t).width},o.Text.prototype._isLetter=function(t){return!(t<"a"||t>"z")||!(t<"A"||t>"Z")},o.Text.prototype.runWordWrap=function(t,e){for(var i=e,r=[],n=0,a=!1,s=0;s<t.length;)if("\n"===t[s]){var o=t.substr(n,s-n+1);1===o.length&&r.length>0&&!a?r[r.length-1]+="\n":r.push(o),s++,n=s,a=!0}else{a=!1;for(var h=-1;s<t.length;){var l=t.charAt(s);if(!this._isLetter(l)){h>=0&&s--;break}-1===h&&(h=s),s++}s===t.length&&s--;var u=this._getWorldWidth(t.substr(n,s-n+1));if(u>i)if(h>=0&&h===n){o=t.substr(n,s-n+1);r.push(o),s++,n=s}else if(h>=0){var c=h-n;o=t.substr(n,c);r.push(o),s=n+c,n=s}else if(s-n==0){o=t.substr(n,s-n+1);r.push(o),s++,n=s}else{o=t.substr(n,s-n);r.push(o),n=s}else if(s++,s===t.length){o=t.substr(n,s-n+1);r.push(o)}}return r},o.Text.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(!0!==t.game.device.editor||!0===r.runInEditor)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.inUpdate=!0,this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._isNotNeedCalcTransform=!1,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation;for(i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},o.Text.prototype.update=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(!0!==t.game.device.editor||!0===r.runInEditor)){if(!this.visible)return;r.preUpdate()}}}},o.BitmapText.prototype._isLetter=o.Text.prototype._isLetter,o.BitmapText.prototype.runWordWrap=o.Text.prototype.runWordWrap,o.BitmapText.prototype._getWorldWidth=function(t){var e=0,i=h.BitmapText.fonts[this.fontName];if(!i||!t)return e
;for(var r=this.fontSize/i.size,n=null,a=0;a<t.length;a++){var s=t.charCodeAt(a),o=i.chars[s];o&&(n&&o.kerning[n]&&(e+=o.kerning[n]),e+=o.xAdvance,n=s)}return e*r},h.BitmapText.prototype.updateText=function(){var t=this.text;if(this._nqc){var e=h.BitmapText.fonts[this.fontName];if(e){var i=new h.Point,r=null,n=[],a=0,s=[],o=this.fontSize/e.size,l=[];if(this._nqc.wrap){t=t.replace(/\r/gi,"").replace(/\n/gi,"\n");l=this.runWordWrap(t,this._nqc.width)}else{l=t.split(/(?:\r\n|\r|\n)/);for(var u=0;u<l.length-1;u++)l[u]+="\n"}i.x=0,i.y=0;for(u=0;u<l.length;u++){i.x=0,r=null;for(var c=l[u],p=0;p<c.length;p++){var d=c.charCodeAt(p),f=e.chars[d];f&&(r&&f.kerning[r]&&(i.x+=f.kerning[r]),n.push({texture:f.texture,line:u,charCode:d,position:new h.Point(i.x+f.xOffset,i.y+f.yOffset)}),i.x+=f.xAdvance,r=d)}s.push(i.x),a=Math.max(a,i.x),i.y+=e.lineHeight}var _=[];for(u=0;u<=l.length;u++){var g=0;"right"===this.style.align?g=a-s[u]:"center"===this.style.align&&(g=(a-s[u])/2),_.push(g)}var m=this.children.length,y=n.length,v=this.tint||16777215;this.textWidth=a*o,this.textHeight=e.lineHeight*o;var T=this.textWidth*this.anchor.x,x=this.textHeight*this.anchor.y;for(u=0;u<y;u++){var b=u<m?this.children[u]:this._pool.pop();b?b.setTexture(n[u].texture):b=new h.Sprite(n[u].texture),b.position.x=(n[u].position.x+_[n[u].line])*o-T,b.position.y=Math.floor(n[u].position.y*o-x),b.scale.x=b.scale.y=o,b.tint=v,b.parent||this.addChild(b)}for(;this.children.length>y;){var A=this.getChildAt(this.children.length-1);this._pool.push(A),this.removeChild(A)}this._nqc.textRealWidth=this.textWidth,this._nqc.textRealHeight=this.textHeight,this.realWidth=this.textWidth,this.realHeight=this.textHeight,this._nqc._adjustTextPos(this.textWidth,this.textHeight)}}},o.BitmapText.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(!0!==t.game.device.editor||!0===r.runInEditor)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return t&&(t._isTransformDirty=!0),this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++;for(i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},o.BitmapText.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var t=this._qc;if(t&&!t.static){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.postUpdate(),!this.visible)))return}}},o.Graphics.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(!0!==t.game.device.editor||!0===r.runInEditor)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,t&&(t._isTransformDirty=!0),this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++;for(i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},o.Graphics.prototype.update=function(){var t=this._qc;if(t&&!t.static){t.update&&t.update();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.update&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.update(),!this.visible)))return}}for(i=this.children.length;i--;)this.children[i].visible&&this.children[i].update()},o.Graphics.prototype.postUpdate=function(){this.key instanceof o.BitmapData&&this.key.render();var t=this._qc;if(t&&!t.static){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.postUpdate(),!this.visible)))return}}for(i=this.children.length;i--;)this.children[i].visible&&this.children[i].postUpdate()},e.defineProperty(h.Graphics.prototype,"dirty",{get:function(){return this._dirty},set:function(t){t!==this._dirty&&(this._dirty=t,this.displayChanged(s.DisplayChangeStatus.RECALC_MASK))}}),h.Graphics.prototype._updateBounds=function(){var t=this,e=(t.worldTransform,t.parent),i=e?e._displayChangeStatus:0;null==t._displayChangeStatus&&(t._displayChangeStatus=Jt.SHOW);var r=t._displayChangeStatus;if(r|=i&Jt.INHERIT_MASK,!(t.worldVisible||r&Jt.HIDE))return!0;if(0===r)return!1;t._lastWorldBounds||(t._lastWorldBounds=[]),t._currWorldBounds&&t._lastWorldBounds.push(t._currWorldBounds),t._displayChangeStatus=r,t._currentBounds=null;var n=this.getBounds();return t._currWorldBounds={x:n.x,y:n.y,tx:n.x,ty:n.y,width:n.width,height:n.height,area:n.width*n.height},t._dirtyBounds=!0,!1},o.Sprite.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(!0!==t.game.device.editor||!0===r.runInEditor)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,t&&(t._isTransformDirty=!0),this.fresh=!1,!1;if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.lifespan>0&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0))return this.kill(),!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++,this.animations&&this.animations.update();for(i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},o.Sprite.prototype.update=function(){var t=this._qc;if(t&&!t.static){t.update&&t.update();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.update&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.update(),!this.visible)))return}}for(i=this.children.length;i--;)this.children[i].visible&&this.children[i].update()},o.Sprite.prototype.postUpdate=function(){this.key instanceof o.BitmapData&&this.key.render(),this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var t=this._qc;if(t&&!t.static){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&((!0!==t.game.device.editor||!0===r.runInEditor)&&(r.postUpdate(),!this.visible)))return}}for(i=this.children.length;i--;)this.children[i].visible&&this.children[i].postUpdate()},o.Tileset.prototype.updateTileData=function(t,e){var i,r;t-=this.tileMargin,e-=this.tileMargin,i=e>this.tileHeight?(e-this.tileHeight)/(this.tileHeight+this.tileSpacing)+1:e/this.tileHeight,r=t>this.tileWidth?(t-this.tileWidth)/(this.tileWidth+this.tileSpacing)+1:t/this.tileWidth,i=Math.floor(i),r=Math.floor(r),(this.rows&&this.rows!==i||this.columns&&this.columns!==r)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ"),this.rows=i,this.columns=r,this.total=i*r,this.drawCoords.length=0;for(var n=this.tileMargin,a=this.tileMargin,s=0;s<this.rows;s++){for(var o=0;o<this.columns;o++)this.drawCoords.push(n),this.drawCoords.push(a),n+=this.tileWidth+this.tileSpacing;n=this.tileMargin,a+=this.tileHeight+this.tileSpacing}},o.Cache.prototype.getSound=function(t){return this._sounds[t]?this._sounds[t]:null},o.Loader.prototype.loadAudioTag=function(t){var e=this;if(this.game.sound.touchLocked)t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=t.localPath||this.transformUrl(t.url,t),this.fileComplete(t);else{t.data=new Audio,t.data.name=t.key;var i=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.removeEventListener("stalled",r,!1),t.data.onerror=null,o.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.removeEventListener("stalled",r,!1),t.data.onerror=null,e.fileError(t)};var r=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.removeEventListener("stalled",r,!1),t.data.onerror=null,e.fileError(t)};t.data.preload="auto",t.data.src=t.localPath||this.transformUrl(t.url,t),t.data.addEventListener("canplaythrough",i,!1),t.data.addEventListener("stalled",r,!1)}},o.Sound.prototype.soundHasUnlocked=function(t){t===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this.game._qc.sound._getAudioTagDurationInConfig(this))},o.Sound.prototype.play=function(i,r,n,a,s){if(void 0!==i&&!1!==i&&null!==i||(i=""),void 0===s&&(s=!0),this.isPlaying&&!this.allowMultiple&&!s&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||s))if(this.usingWebAudio)if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(""===i&&e.keys(this.markers).length>0)return this;if(""!==i){if(this.currentMarker=i,!this.markers[i])return this;this.position=this.markers[i].start,this.volume=this.markers[i].volume,this.loop=this.markers[i].loop,this.duration=this.markers[i].duration,this.durationMS=this.markers[i].durationMS,void 0!==n&&(this.volume=n),void 0!==a&&(this.loop=a),this._tempMarker=i,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else r=r||0,void 0===n&&(n=this._volume),void 0===a&&(a=this.loop),this.position=r,this.volume=n,this.loop=a,this.duration=0,this.durationMS=0,this._tempMarker=i,this._tempPosition=r,this._tempVolume=n,this._tempLoop=a;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(null===this._buffer&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&""===i&&(this._sound.loop=!0),this.loop||""!==i||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1e3*this.totalDuration)),void 0===this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===i?this._sound.start(0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState||t.__wx&&this._sound.readyState>=2)?(this._sound.play(),this.totalDuration=this.game._qc.sound._getAudioTagDurationInConfig(this),0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._muted?this._sound.volume=0:this._sound.volume=this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},o.Sound.prototype.resume=function(){if(this.paused&&this._sound){if(this.usingWebAudio){var t=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var e=this.duration-this.pausedPosition/1e3;void 0===this._sound.start?this._sound.noteGrainOn(0,t,e):this.loop?this._sound.start(0,t):this._sound.start(0,t,e)}else this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},o.SoundManager.prototype.decode=function(t,e){e=e||null;var i=this.game.cache.getSoundData(t);if(i&&!1===this.game.cache.isSoundDecoded(t)){this.game.cache.updateSound(t,"isDecoding",!0);var r=this;try{var n=this.context.decodeAudioData(i,function(i){r.game.cache&&(i&&r.game.cache.decodedSound(t,i),r.onSoundDecode.dispatch(t,e))},function(){r.game._qc.log.trace("Sound decode failed: {0}",t),r.onSoundDecode.dispatch(t,e)});n&&n.catch&&n.catch(function(){})}catch(i){this.game._qc.log.trace("{0}",i.stack),r.onSoundDecode.dispatch(t,e)}}},o.SoundManager.prototype.boot=function(){if(this.game.device.iOS&&!1===this.game.device.webAudio&&(this.channels=1),t.PhaserGlobal){if(!0===t.PhaserGlobal.disableAudio)return this.usingWebAudio=!1,void(this.noAudio=!0);if(!0===t.PhaserGlobal.disableWebAudio)return this.usingWebAudio=!1,this.usingAudioTag=!0,void(this.noAudio=!1)}if(t.PhaserGlobal&&t.PhaserGlobal.audioContext)this.context=t.PhaserGlobal.audioContext;else if(t.AudioContext)try{this.context=new t.AudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.noAudio=!0,console.error("SoundManager boot error!",t),s.Util.popupError(t.message)}else if(t.webkitAudioContext)try{this.context=new t.webkitAudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.noAudio=!0,console.error("SoundManager boot error!",t),s.Util.popupError(t.message)}t.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1),null!==this.context&&(void 0===this.context.createGain?this.masterGain=this.context.createGainNode():this.masterGain=this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},o.SoundManager.prototype.unlock=function(){if(!1!==this.touchLocked)if(!1===this.game.device.webAudio||t.PhaserGlobal&&!0===t.PhaserGlobal.disableWebAudio)this.touchLocked=!1,this._unlockSource=null,this.game.input._qc.touch.callbackContext=null,this.game.device.iOSVersion>8?this.game.input._qc.touch.touchEndCallback=null:this.game.input._qc.touch.touchStartCallback=null,this.game.input._qc.mouse.callbackContext=null,this.game.input._qc.mouse.mouseDownCallback=null;else{var e=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=e,this._unlockSource.connect(this.context.destination),void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0)}},o.SoundManager.prototype.update=function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState!==this._unlockSource.PLAYING_STATE&&this._unlockSource.playbackState!==this._unlockSource.FINISHED_STATE||(this.touchLocked=!1,this._unlockSource=null,this.game.input._qc.touch.callbackContext=null,this.game.device.iOSVersion>8?this.game.input._qc.touch.touchEndCallback=null:this.game.input._qc.touch.touchStartCallback=null));for(var t=0;t<this._sounds.length;t++)this._sounds[t].update();if(this._watching){for(var e=this._watchList.first;e;)this.game.cache.isSoundDecoded(e)&&this._watchList.remove(e),e=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}},o.Loader.prototype.transformUrl=function(t){return/^http(s|):\/\//i.test(t)?t:this.baseURL+t},o.Loader.prototype.asyncComplete=function(e,i){void 0===i&&(i=""),e.loaded=!0,e.error=!!i,!t.__wx&&e.requestObject&&200!==e.requestObject.status&&304!==e.requestObject.status&&(e.error=!0),i&&(e.errorMessage=i,console.warn("Phaser.Loader - "+e.type+"["+e.key+"]: "+i)),this.processLoadQueue()},h.CanvasRenderer.prototype.render=function(t){if(this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.drawCount=0,this.renderSession.currentBlendMode=h.blendModes.NORMAL,this.context.globalCompositeOperation=h.blendModesCanvas[h.blendModes.NORMAL],this.dirtyRectangle.enable){if(!this.dirtyRectangle.updateDirtyRegion(this.context,this.resolution,t))return this.context.fillStyle="rgba(0, 0, 0, 0)",this.context.fillRect(0,0,1,1),void this.dirtyRectangle.showDirtyRectangle(this.context,this.resolution)}else navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t),this.dirtyRectangle.enable&&(this.dirtyRectangle.restore(this.context),this.dirtyRectangle.showDirtyRectangle(this.context,this.resolution))},h.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(this.__stage=t);var e=this.gl;e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.projection)}};var ae=s.GameObjectFactory=function(t){this.game=t};ae.prototype.constructor=ae,ae.prototype.clone=function(t,e){if(!t)return null;if(t instanceof T){var i=this.game.serializer.restoreBundle(t.json,e);return i._prefab=t.uuid,i}var r={},n=this.game.serializer.buildBundle(t,r);n.dependences=this.game.serializer.combineDependence(r);i=this.game.serializer.restoreBundle(n,e||t.parent);return i},ae.prototype.node=function(t,e){var i=new F(new o.Group(this.game.phaser,null),t,e);return i.name="node",i},ae.prototype.text=function(t,e){return new xe(this.game,t,e)},ae.prototype.image=function(t,e){return new se(this.game,t,e)},ae.prototype.button=function(t,e){return new be(this.game,t,e)},ae.prototype.toggle=function(t,e){return new Ae(this.game,t,e)},ae.prototype.sprite=function(t,e){return new _e(this.game,t,e)},ae.prototype.sound=function(t,e){return new Se(this.game,t,e)},ae.prototype.video=function(t,e){return new we(this.game,t,e)},ae.prototype.scrollView=function(t,e){return new Pe(this.game,t,e)},ae.prototype.scrollBar=function(t,e,r){var n=new Ee(this.game,t,r),a=r!==i;if(a)return n;if(n.width=160,n.height=20,n.size=.2,n.direction=s.ScrollBar.LEFT_TO_RIGHT,e){var o=this.node(n);o.name="slidingArea",o.setAnchor(new s.Point(0,0),new s.Point(1,1)),o.setStretch(0,0,0,0),o.pivotX=o.pivotY=.5;var h=this.image(o);h.name="sliders",h.setAnchor(new s.Point(0,0),new s.Point(1,1)),h.setStretch(0,0,0,0),h.pivotX=h.pivotY=.5,n.sliders=h,n.interactive=!0}return n},ae.prototype.progressBar=function(t,e,r){var n=new De(this.game,t,r),a=r!==i;if(a)return n;if(n.width=160,n.height=20,e){var o=this.node(n);o.name="progressArea",o.setAnchor(new s.Point(0,0),new s.Point(1,1)),o.setStretch(0,0,0,0),o.pivotX=o.pivotY=.5;var h=this.image(o);h.name="sliders",h.setAnchor(new s.Point(0,0),new s.Point(1,1)),h.setStretch(0,0,0,0),h.pivotX=h.pivotY=.5,n.sliders=h}return n},ae.prototype.slider=function(t,e,r){var n=new Ce(this.game,t,r),a=r!==i;if(a)return n;if(n.interactive=!0,n.width=160,n.height=20,e){var o=this.node(n);o.name="slidingArea",o.setAnchor(new s.Point(0,0),new s.Point(1,1)),o.setStretch(0,0,0,0),o.pivotX=o.pivotY=.5;var h=this.image(o);h.name="sliders",h.setAnchor(new s.Point(.5,.5),new s.Point(.5,.5)),h.setStretch(0,0,0,0),h.pivotX=h.pivotY=.5,n.sliders=h}return n},ae.prototype.inputField=function(t,e){return new Oe(this.game,t,e)},ae.prototype.dropdown=function(t,e){return new s.Dropdown(this.game,t,e)},ae.prototype.tilemap=function(t,e){return new Me(this.game,t,e)},ae.prototype.tileLayer=function(t,e){return new Ie(this.game,t,e)},ae.prototype.objectLayer=function(t,e){return new Re(this.game,t,e)},ae.prototype.dom=function(t,e){return new Ne(this.game,t,e)},ae.prototype.graphics=function(t,e){return new Be(this.game,t,e)};var se=s.UIImage=function(t,e,i){var r=this,n=new o.Sprite(t.phaser);s.Node.call(r,n,e,i),r._oldUpdateTransformFunc=n.updateTransform,n._renderWebGL=oe,n._renderCanvas=ce,r._borderLeft=0,r._borderRight=0,r._borderTop=0,r._borderBottom=0,r._imageType=s.UIImage.IMAGE_TYPE_SIMPLE,r.name="UIImage"};se.prototype=e.create(s.Node.prototype),se.prototype.constructor=se,se.IMAGE_TYPE_SIMPLE=0,se.IMAGE_TYPE_SLICED=1,se.IMAGE_TYPE_TILED=2,e.defineProperties(se.prototype,{texture:{get:function(){return this._atlas?new s.Texture(this._atlas,this.frame):null},set:function(t){var e=this;if(!t)return e._atlas=null,void e.phaser.loadTexture(null,e.frame);if(t instanceof s.Atlas)t=t.getTexture(this.frame);else if("string"==typeof t){if(!e._atlas)return;if(t=e._atlas.getTexture(t),!t)return}e._atlas===t.atlas&&e.frame===t.frame||(e._atlas=t.atlas,t.atlas.getFrame(t.frame)||(t.frame=0),e.phaser.key=t.atlas.key,e.frame=t.frame,e instanceof dragonBones.PhaserSlotDisplay&&(e.change_texture=t))}},frame:{get:function(){return this.phaser.frameName},set:function(t){if(this.texture){var e=this.texture.atlas.frameNames||[0];"string"==typeof t&&-1===e.indexOf(t)||(this.phaser.loadTexture(this.texture.atlas.key,t),this.setWidth(this.width),this.setHeight(this.height),this._resetNinePadding(),this._dispatchLayoutArgumentChanged("size"),this.phaser.displayChanged(s.DisplayChangeStatus.TEXTURE),this._onTextureChanged&&this._onTextureChanged.dispatch())}}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new s.Rectangle(0,0,0,0)}},imageType:{get:function(){return this._imageType},set:function(t){this._imageType!==t&&(this._imageType=t,this.phaser.displayChanged(s.DisplayChangeStatus.TEXTURE))}},borderTop:{get:function(){return this._borderTop},set:function(t){this._borderTop=t}},borderBottom:{get:function(){return this._borderBottom},set:function(t){this._borderBottom=t}},borderLeft:{get:function(){return this._borderLeft},set:function(t){this._borderLeft=t}},borderRight:{get:function(){return this._borderRight},set:function(t){this._borderRight=t}},onTextureChanged:{get:function(){return this._onTextureChanged||(this._onTextureChanged=new o.Signal),this._onTextureChanged}},skewX:{get:function(){return this._skewX},set:function(t){var e=this;e._skewX!==t&&(e._skewX=t,e.phaser.displayChanged(s.DisplayChangeStatus.ROTATION),e._isTransformDirty=!0,e._skewX||e._skewY?this.phaser.updateTransform=de:e.phaser.updateTransform=e._oldUpdateTransformFunc)}},skewY:{get:function(){return this._skewY},set:function(t){var e=this;e._skewY!==t&&(e._skewY=t,e.phaser.displayChanged(s.DisplayChangeStatus.ROTATION),e._isTransformDirty=!0,e._skewX||e._skewY?this.phaser.updateTransform=de:e.phaser.updateTransform=e._oldUpdateTransformFunc)}},class:{get:function(){return"qc.UIImage"}}}),se.prototype.resetNativeSize=function(){this.parent?(this.width=this.nativeSize.width,this.height=this.nativeSize.height):(this.setWidth(this.nativeSize.width),this.setHeight(this.nativeSize.height))},se.prototype.loadImg=function(t){var e=this;this.game.assets.load(t,t,function(){var i=qc_game.assets.find(t);e.texture=i,e.resetNativeSize(),e instanceof dragonBones.PhaserSlotDisplay&&(e.change_texture=i)})},se.prototype.setWidth=function(t){F.prototype.setWidth.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.width=t,this.phaser.displayChanged(s.DisplayChangeStatus.SIZE))},se.prototype.setHeight=function(t){F.prototype.setHeight.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.height=t,this.phaser.displayChanged(s.DisplayChangeStatus.SIZE))},se.prototype._resetNinePadding=function(){if(this.texture){var t=this.texture.padding;this._borderLeft=t[0],this._borderTop=t[1],this._borderRight=t[2],this._borderBottom=t[3]}},se.prototype.getMeta=function(){var t=s.Serializer,e=s.Node.prototype.getMeta.call(this);return e.texture=t.TEXTURE,e.frame=t.AUTO,e.imageType=t.NUMBER,e.skewX=t.NUMBER,e.skewY=t.NUMBER,e};var oe=function(t){var e=this._qc;if(e.imageType===s.UIImage.IMAGE_TYPE_SIMPLE)return o.Sprite.prototype._renderWebGL.call(this,t);if(this.visible&&!(this.alpha<=0)&&this.renderable){var i;if(this.softClip&&tt.getManager(t).pushPolygon(this.softClip),this._graphicsFilter||this._mask||this._filters){var r=t.spriteBatch;for(this._graphicsFilter&&(r.flush(),t.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(r.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),t.maskManager.pushMask(this.mask,t),r.start()),this._filters&&this.filterSelf&&(r.flush(),t.filterManager.pushFilter(this._filterBlock)),pe(r,this),this._filters&&this.filterSelf&&(r.stop(),t.filterManager.popFilter(),r.start()),i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);r.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&!this.filterSelf&&t.filterManager.popFilter(),this._graphicsFilter&&t.filterManager.popFilter(),r.start()}else for(pe(t.spriteBatch,this),i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);this.softClip&&tt.getManager(t).popPolygon()}},he=function(t,e){var i=e.texture,r=i._uvs;if(r){var n,a,s,h,l=e._qc,u=l.borderLeft,c=l.borderRight,p=l.borderTop,d=l.borderBottom,f=e.anchor.x,_=e.anchor.y;if(i.trim){var g=i.trim;a=g.x-f*g.width,n=a+i.crop.width,h=g.y-_*g.height,s=h+i.crop.height}else n=i.frame.width*(1-f),a=i.frame.width*-f,s=i.frame.height*(1-_),h=i.frame.height*-_;var m=i.baseTexture.width,y=i.baseTexture.height,v=[new o.Point(r.x0,r.y0),new o.Point(r.x0+u/m,r.y0+p/y),new o.Point(r.x2-c/m,r.y2-d/y),new o.Point(r.x2,r.y2)],T=Math.abs(n-a),x=Math.abs(s-h);T<u+c&&(u=T*u/(u+c),c=T-u),a>n&&(u=-u,c=-c),x<p+d&&(p=x*p/(p+d),d=x-p),h>s&&(p=-p,d=-d);var b=[new o.Point(a,h),new o.Point(a+u,h+p),new o.Point(n-c,s-d),new o.Point(n,s)],A=e.tint;A=(A>>16)+(65280&A)+((255&A)<<16)+(255*e.worldAlpha<<24);for(var S=i.baseTexture.resolution,w=e.worldTransform,P=w.a/S,E=w.b/S,D=w.c/S,C=w.d/S,O=w.tx,M=w.ty,I=0;I<3;++I)for(var R=I+1,N=0;N<3;++N){var B=N+1;le(t,e,b[I].x,b[N].y,b[R].x,b[B].y,v[I].x,v[N].y,v[R].x,v[B].y,P,E,D,C,O,M,A)}}},le=function(t,e,i,r,n,a,s,o,h,l,u,c,p,d,f,_,g){var m=t.renderSession.softClipManager;if(m&&m.needClip)m.renderSprite(t.renderSession,e,i,r,n,a,s,o,h,l,u,c,p,d,f,_,g);else{t.currentBatchSize>=t.size&&(t.flush(),t.currentBaseTexture=e.texture.baseTexture);var y=t.colors,v=t.positions,T=4*t.currentBatchSize*t.vertSize;t.renderSession.roundPixels?(v[T]=u*i+p*r+f|0,v[T+1]=d*r+c*i+_|0,v[T+5]=u*n+p*r+f|0,v[T+6]=d*r+c*n+_|0,v[T+10]=u*n+p*a+f|0,v[T+11]=d*a+c*n+_|0,v[T+15]=u*i+p*a+f|0,v[T+16]=d*a+c*i+_|0):(v[T]=u*i+p*r+f,v[T+1]=d*r+c*i+_,v[T+5]=u*n+p*r+f,v[T+6]=d*r+c*n+_,v[T+10]=u*n+p*a+f,v[T+11]=d*a+c*n+_,v[T+15]=u*i+p*a+f,v[T+16]=d*a+c*i+_),v[T+2]=s,v[T+3]=o,v[T+7]=h,v[T+8]=o,v[T+12]=h,v[T+13]=l,v[T+17]=s,v[T+18]=l,y[T+4]=y[T+9]=y[T+14]=y[T+19]=g,t.sprites[t.currentBatchSize++]=e}},ue=function(t,e){var i=e.texture,r=i._uvs;if(r){var n,a,s,h,l=e._qc,u=l.borderLeft,c=l.borderRight,p=l.borderTop,d=l.borderBottom,f=e.anchor.x,_=e.anchor.y;if(i.trim){var g=i.trim;a=g.x-f*g.width,n=a+i.crop.width,h=g.y-_*g.height,s=h+i.crop.height}else n=i.frame.width*(1-f),a=i.frame.width*-f,s=i.frame.height*(1-_),h=i.frame.height*-_;var m=i.baseTexture.width,y=i.baseTexture.height,v=[new o.Point(r.x0,r.y0),new o.Point(r.x0+u/m,r.y0+p/y),new o.Point(r.x2-c/m,r.y2-d/y),new o.Point(r.x2,r.y2)],T=r.x0+u/m,x=r.y0+p/y,b=r.x2-c/m,A=r.y2-d/y,S=Math.abs(n-a),w=Math.abs(s-h);S<u+c&&(u=S*u/(u+c),c=S-u),a>n&&(u=-u,c=-c),w<p+d&&(p=w*p/(p+d),d=w-p),h>s&&(p=-p,d=-d);var P=n-c,E=s-d,D=a+u,C=h+p,O=[new o.Point(a,h),new o.Point(D,C),new o.Point(P,E),new o.Point(n,s)],M=e.tint;M=(M>>16)+(65280&M)+((255&M)<<16)+(255*e.worldAlpha<<24);var I=i.baseTexture.resolution,R=e.worldTransform,N=R.a/I,B=R.b/I,L=R.c/I,F=R.d/I,k=R.tx,U=R.ty,j=(r.x2-r.x0)*m-u-c,W=(r.y2-r.y0)*y-p-d;S-u-c>32*j&&(j=(S-u-c)/32),w-p-d>32*W&&(W=(w-p-d)/32);var V=b,z=A;if(j>0&&W>0)for(var G=C;G<E;G+=W){var Y=G+W;Y>E&&(z=x+(A-x)*(E-G)/(Y-G),Y=E),V=b;for(var X=D;X<P;X+=j){var H=X+j;H>P&&(V=T+(b-T)*(P-X)/(H-X),H=P),le(t,e,X,G,H,Y,T,x,V,z,N,B,L,F,k,U,M)}}if(V=b,z=A,W)for(G=C;G<E;G+=W){Y=G+W;Y>E&&(z=x+(A-x)*(E-G)/(Y-G),Y=E),le(t,e,a,G,D,Y,r.x0,x,T,z,N,B,L,F,k,U,M),le(t,e,P,G,n,Y,b,x,r.x2,z,N,B,L,F,k,U,M)}if(V=b,z=A,j)for(X=D;X<P;X+=j){H=X+j;H>P&&(V=T+(b-T)*(P-X)/(H-X),H=P),le(t,e,X,h,H,C,T,r.y0,V,x,N,B,L,F,k,U,M),le(t,e,X,E,H,s,T,A,V,r.y2,N,B,L,F,k,U,M)}le(t,e,O[0].x,O[0].y,O[1].x,O[1].y,v[0].x,v[0].y,v[1].x,v[1].y,N,B,L,F,k,U,M),le(t,e,O[2].x,O[0].y,O[3].x,O[1].y,v[2].x,v[0].y,v[3].x,v[1].y,N,B,L,F,k,U,M),le(t,e,O[2].x,O[2].y,O[3].x,O[3].y,v[2].x,v[2].y,v[3].x,v[3].y,N,B,L,F,k,U,M),le(t,e,O[0].x,O[2].y,O[1].x,O[3].y,v[0].x,v[2].y,v[1].x,v[3].y,N,B,L,F,k,U,M)}},ce=function(t){if(!(!1===this.visible||0===this.alpha||!1===this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)){var e=this.texture.valid,i=this._qc,r=i.imageType;if(this.maskPixel&&e&&r===s.UIImage.IMAGE_TYPE_SIMPLE){var n=t.bufferPool||(t.bufferPool=[]),a=t.context,l=a.globalOffX||0,u=a.globalOffY||0,c=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds(),p=Math.max(l,c.x),d=Math.max(u,c.y),f=Math.min(c.x+c.width,a.canvas.width+l),_=Math.min(c.y+c.height,a.canvas.height+u);c.x=p,c.y=d,c.width=f-p,c.height=_-d;var g=n.pop();g||(g=new h.CanvasBuffer(t.context.canvas.width*t.resolution,t.context.canvas.height*t.resolution),g.context._setTransform=g.context.setTransform,g.context.setTransform=function(t,e,i,r,n,a){this._setTransform(t,e,i,r,n-(this.globalOffX||0),a-(this.globalOffY||0))}),g.resize(c.width*t.resolution,c.height*t.resolution),g.context.clearRect(0,0,c.width*t.resolution,c.height*t.resolution),g.context.globalOffX=c.x*t.resolution+l,g.context.globalOffY=c.y*t.resolution+u,t.context=g.context}var m=t.context;if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,m.globalCompositeOperation=h.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),e){var y=this.texture.baseTexture.resolution/t.resolution;m.globalAlpha=this.worldAlpha,!t.smoothProperty||t.scaleMode===this.texture.baseTexture.scaleMode&&m[t.smoothProperty]===(t.scaleMode===h.scaleModes.LINEAR)||(t.scaleMode=this.texture.baseTexture.scaleMode,m[t.smoothProperty]=t.scaleMode===h.scaleModes.LINEAR);var v=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,T=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,x=this.texture.trim?this.texture.crop.width:this.texture.frame.width,b=this.texture.trim?this.texture.crop.height:this.texture.frame.height;t.roundPixels?(m.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),v|=0,
T|=0):m.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution);var A,S,w,P,E,D=function(e,i,r,n,a,s,o,h,l,u){l&&u&&(t.drawCount++,e.drawImage(i,r,n,a||1,s||1,o,h,l,u))};if(16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=h.CanvasTinter.getTintedTexture(this,this.tint)),A=this.tintedTexture,S=0,w=0,P=this.texture.crop.width,E=this.texture.crop.height):(A=this.texture.baseTexture.source,S=this.texture.crop.x,w=this.texture.crop.y,P=this.texture.crop.width,E=this.texture.crop.height),v=Math.round(v/y),T=Math.round(T/y),x=Math.round(x/y),b=Math.round(b/y),r===s.UIImage.IMAGE_TYPE_SIMPLE)this.maskPixel||D(m,A,S,w,P,E,v,T,x,b);else if(i.texture&&x&&b){var C=""+i.texture.atlas.uuid+r+i.frame+this.tint+x+b,O=s.CanvasPool.get(C),M=O.canvas;if(O.dirty){var I=M.getContext("2d");t.smoothProperty&&I[t.smoothProperty]!==(t.scaleMode===h.scaleModes.LINEAR)&&(I[t.smoothProperty]=t.scaleMode===h.scaleModes.LINEAR),M.width=x,M.height=b,I.clearRect(0,0,x,b);var R=i.borderLeft,N=i.borderRight,B=i.borderTop,L=i.borderBottom,F=[new o.Point(S,w),new o.Point(S+R,w+B),new o.Point(S+P-N,w+E-L),new o.Point(S+P,w+E)];R/=y,B/=y,N/=y,L/=y,x<R+N&&(R=x*R/(R+N),N=x-R),b<B+L&&(B=b*B/(B+L),L=b-B);var k=[new o.Point(0,0),new o.Point(R,B),new o.Point(x-N,b-L),new o.Point(x,b)];if(r==s.UIImage.IMAGE_TYPE_SLICED)for(var U=0;U<3;++U)for(var j=U+1,W=0;W<3;++W){var V=W+1,z=F[U].x,G=F[W].y,Y=F[j].x,X=F[V].y,H=k[U].x,q=k[W].y,K=k[j].x,J=k[V].y;Y-z<=0||X-G<=0||K-H<=0||J-q<=0||D(I,A,z,G,Y-z,X-G,H,q,K-H,J-q)}else{var Z=F[1].x,Q=F[1].y,$=F[2].x,tt=F[2].y,et=x-N,it=b-L,rt=R,nt=B,at=P/y-R-N,st=E/y-B-L;x-R-N>32*at&&(at=(x-R-N)/32),b-B-L>32*st&&(st=(b-B-L)/32);var ot=$,ht=tt;if(at>0&&st>0)for(var lt=nt;lt<it;lt+=st){V=lt+st;V>it&&(ht=Q+(tt-Q)*(it-lt)/(V-lt),V=it),ot=$;for(var ut=rt;ut<et;ut+=at){j=ut+at;j>et&&(ot=Z+($-Z)*(et-ut)/(j-ut),j=et),ot-Z<=0||ht-Q<=0||j-ut<=0||V-lt<=0||D(I,A,Z,Q,ot-Z,ht-Q,ut,lt,j-ut,V-lt)}}if(ht=tt,st)for(lt=nt;lt<it;lt+=st){V=lt+st;V>it&&(ht=Q+(tt-Q)*(it-lt)/(V-lt),V=it),D(I,A,S,Q,Z-S,ht-Q,0,lt,R,V-lt),D(I,A,$,Q,S+P-$,ht-Q,et,lt,N,V-lt)}if(ot=$,at)for(ut=rt;ut<et;ut+=at){j=ut+at;j>et&&(ot=Z+($-Z)*(et-ut)/(j-ut),j=et),D(I,A,Z,w,ot-Z,Q-w,ut,0,j-ut,B),D(I,A,Z,tt,ot-Z,w+E-tt,ut,it,j-ut,L)}D(I,A,F[0].x,F[0].y,F[1].x-F[0].x,F[1].y-F[0].y,k[0].x,k[0].y,k[1].x-k[0].x,k[1].y-k[0].y),D(I,A,F[2].x,F[0].y,F[3].x-F[2].x,F[1].y-F[0].y,k[2].x,k[0].y,k[3].x-k[2].x,k[1].y-k[0].y),D(I,A,F[2].x,F[2].y,F[3].x-F[2].x,F[3].y-F[2].y,k[2].x,k[2].y,k[3].x-k[2].x,k[3].y-k[2].y),D(I,A,F[0].x,F[2].y,F[1].x-F[0].x,F[3].y-F[2].y,k[0].x,k[2].y,k[1].x-k[0].x,k[3].y-k[2].y)}}D(m,M,0,0,x,b,v,T,x,b)}}for(var ct=0;ct<this.children.length;ct++)this.children[ct]._renderCanvas(t);if(this._mask&&t.maskManager.popMask(t),this.maskPixel&&e&&r===s.UIImage.IMAGE_TYPE_SIMPLE){if(m.globalCompositeOperation="destination-in",t.roundPixels?(m.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),v|=0,T|=0):m.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),D(m,A,S,w,P,E,v,T,x,b),m.globalCompositeOperation="source-over",t.context=a,t.roundPixels?t.context.setTransform(1,0,0,1,c.x*t.resolution|0,c.y*t.resolution|0):t.context.setTransform(1,0,0,1,c.x*t.resolution,c.y*t.resolution),!g.canvas.height||!g.canvas.width)return;t.drawCount++,t.context.drawImage(g.canvas,0,0,g.canvas.width,g.canvas.height,0,0,g.canvas.width,g.canvas.height),n.push(g)}}},pe=function(t,e){switch(e._qc.imageType){case se.IMAGE_TYPE_SLICED:he(t,e);break;case se.IMAGE_TYPE_TILED:ue(t,e)}},de=function(){var t=this,e=t.parent;if(e&&t.visible){if(t.worldAlpha=t.alpha*e.worldAlpha,!t._isNotNeedCalcTransform||e._isSubNeedCalcTransform){var i,r,n,a,s,o,h,l,u,c,p,d,f,_,g,m,y,v,T,x,b,A;t.game&&t.game._calcTransformCount++,t.rotation!==t.rotationCache&&(t.rotationCache=t.rotation,t._sr=Math.sin(t.rotation),t._cr=Math.cos(t.rotation)),h=Math.cos(t._qc._skewY||0),l=Math.sin(t._qc._skewY||0),u=-Math.sin(t._qc._skewX||0),c=Math.cos(t._qc._skewX||0),p=t.position.x,d=t.position.y,f=t._cr*t.scale.x,_=t._sr*t.scale.x,g=-t._sr*t.scale.y,m=t._cr*t.scale.y,y=0,v=0,i=f*h+_*u,r=f*l+_*c,n=g*h+m*u,a=g*l+m*c,s=y*h+v*u+p,o=y*l+v*c+d;var S=t.worldTransform,w=e.worldTransform;T=w.a,x=w.b,b=w.c,A=w.d,S.a=i*T+r*b,S.b=i*x+r*A,S.c=n*T+a*b,S.d=n*x+a*A,S.tx=s*T+o*b+w.tx,S.ty=s*x+o*A+w.ty,this._isNotNeedCalcTransform=!0,this._isSubNeedCalcTransform=!0,t.transformCallback&&(S.inUpdate=!1,t.transformCallback.call(t.transformCallbackContext,S,w))}else{t._isSubNeedCalcTransform=!1;S=t.worldTransform,w=e.worldTransform;t.transformCallback&&(S.inUpdate=!1,t.transformCallback.call(t.transformCallbackContext,S,w))}if(!t._cacheAsBitmap)for(var P=0,E=t.children.length;P<E;P++)t.children[P].updateTransform()}},fe=s.UIRoot=function(t,e){s.Node.call(this,new o.Group(t.phaser,null),null,e),this.name="UIRoot";var r=e!==i;if(!r){var n=this.addScript("qc.ScaleAdapter");n.referenceResolution=new s.Point(640,960),n.manualType=s.ScaleAdapter.EXPAND,n.fullTarget=!0}this.setAnchor(new s.Point(0,0),new s.Point(0,0)),this.pivotX=0,this.pivotY=0;var a=this.getWorldScale();this.setTransformToWorld(0,0,a.x,a.y,this.getWorldRotation())};fe.prototype=e.create(s.Node.prototype),fe.prototype.constructor=fe,e.defineProperties(fe.prototype,{class:{get:function(){return"qc.UIRoot"}}}),fe.prototype.postUpdate=function(){this.x=0,this.y=0};var _e=s.Sprite=function(t,e,i){var r=new o.Sprite(t.phaser);s.Node.call(this,r,e,i),this.name="Sprite",this.animationType=s.Sprite.NONE_ANIMATION,this._phaserImageSetFrame=r.setFrame,r.setFrame=me,r._renderWebGL=ve,r._renderCanvas=Te};_e.prototype=e.create(s.Node.prototype),_e.prototype.constructor=_e,_e.NONE_ANIMATION=0,_e.FRAME_ANIMATION=1,_e.DRAGON_BONES=2,_e.FRAME_SAMPLES=3;var ge=8;_e.prototype.playAnimation=function(t,e,r){var n=this,a=n.animationType;if(a!==_e.NONE_ANIMATION&&t){if(a===_e.DRAGON_BONES){var s=n._armature.animation;if(s.animationNameList.indexOf(t)<0)return void console.warn("Animation is not exist.",t);e||(e=1);for(var o,h=s.animationNameList.length;h--;)if(s.animationNameList[h]==t){l=s.animations[t];break}return"number"==typeof e&&1!=e&&e>0&&l&&l.duration/e,o=r==i?0==l.playTimes?2097152:l.playTimes:!0===r?2097152:!1===r?1:i,n.paused=!1,n._armature.animation.timeScale=e,void n._armature.animation.play(t,o)}var l=this._animation[t];if(l){var u=l.rate?l.rate:60;if(a===_e.FRAME_SAMPLES&&(u*=ge),!n.phaser.animations._anims[t]){n.phaser.animations.add(t,l.frames,u);s=n.phaser.animations._anims[t];s.onStart.add(function(){n._onStart&&n._onStart.dispatch(n.lastAnimationName)}),s.onComplete.add(function(){n._onFinished&&n._onFinished.dispatch(n.lastAnimationName)}),s.onLoop.add(function(){n._onLoopFinished&&n._onLoopFinished.dispatch(n.lastAnimationName)})}"boolean"!=typeof r&&(r=!!l.loop),this._slowMotion=this.game.time.timeScale,this._speed=(e||1)*u,n.phaser.animations.play(t,this._speed/this._slowMotion,r)}else n.game.log.error("Animation {0} not exists",t)}},_e.prototype.stop=function(){var t=this,e=t.animationType;if(e!==_e.NONE_ANIMATION&&t.isPlaying)if(e!==_e.DRAGON_BONES){var r=t.phaser.animations.currentAnim;r&&r.stop(i,!0)}else{var n=t._armature.animation;n.stop()}},_e.prototype.update=function(){if(this.animationType===s.Sprite.FRAME_SAMPLES&&this.isPlaying&&this.phaser.displayChanged(s.DisplayChangeStatus.TEXTURE),this.animationType===s.Sprite.DRAGON_BONES&&this._armature){if(this.isPaused())return;var t=.001*this.game.time.deltaTime;this._armature.advanceTime(t),dragonBones.PhaserFactory.factory.dragonBones.advanceTime(t)}else if(this.animationType===s.Sprite.FRAME_ANIMATION||this.animationType===s.Sprite.FRAME_SAMPLES){var e=this.game.time.timeScale;if(e===this._slowMotion)return;this._slowMotion=e;var i=this.phaser.animations.currentAnim;i&&(i.speed=this._speed/e)}},_e.prototype.bindDragonBonesEvent=function(){var e=this;e._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.START,function(){e._onStart&&e._onStart.dispatch(e.lastAnimationName)}),e._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,function(){e._onStart&&e._onStart.dispatch(e.lastAnimationName)}),e._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.COMPLETE,function(){e._onFinished&&e._onFinished.dispatch(e.lastAnimationName)}),e._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.SOUND_EVENT,function(e){console.log("播放龙骨音效"),e&&e.name&&(t.soundIsPause=!1,t.webIsActivate&&t.playSoundEff&&t.playSoundEff("resource/game/audio/"+e.name+".mp3",1))})},_e.prototype.getAnimationInfo=function(t){var e=this.animationType;if(e!==_e.NONE_ANIMATION){if(e===_e.DRAGON_BONES){var i=this._armature.animation;if(i.animationNameList.indexOf(t)<0)return;for(var r=i.animationNameList.length;r--;)if(i.animationNameList[r]==t){n=i.animations[t];break}return n}var n=this._animation[t];if(n){var a=n.frames||[],s=n.rate?parseFloat(n.rate):30;return{frames:a,frameRate:s,loop:n.loop?0:1,duration:a.length/s}}}},e.defineProperties(_e.prototype,{texture:{get:function(){return this._atlas?new s.Texture(this._atlas,this.frame):null},set:function(t){var e=this;if(e.animationType===_e.DRAGON_BONES&&e._boneBase&&(e.removeChild(e._boneBase),e._armature=null,e._boneBase=null),!t)return e._atlas=null,e.phaser.loadTexture(null,e.frame),void(e.animationType=_e.NONE_ANIMATION);t instanceof s.Atlas&&(t=new s.Texture(t,e.frame));var i=e._atlas=t.atlas;if(e.animationType=i.animation?i.animation.type:_e.NONE_ANIMATION,e.animationType===_e.DRAGON_BONES){var r=e._armature=s.dragonBones.makeQcArmature(i.animation.data,i.json,i.img,i.key);if(!r)return void console.warn("makeQcArmature failed:(img:",i.img,"atlas:",i.json,"skeleton:",i.animation.data,")");e._armature=r;var n=r.display;e.addChild(n),e._boneBase=n,e.colorTint=e.colorTint;var a=i.animation.data.armature[0].canvas,h=e.getChildAt(0);if(a)e.width=a.width,e.height=a.height;else{for(var l=h.getChildAt(0).width,u=h.getChildAt(0).height,c=h.getChildAt(0)._anchoredX,p=h.getChildAt(0)._anchoredY,d=h.getChildAt(0)._anchoredX,f=h.getChildAt(0)._anchoredY,_=0;_<h._children.length;_++){var g=h.getChildAt(_),m=g.width,y=g.height,v=g._anchoredX,T=g._anchoredY;m>=l&&(l=m),y>=u&&(u=y),v<=d&&(d=v),v>=c&&(c=v),T<=f&&(f=T),T>=p&&(p=T)}var x=Math.round(Math.abs(d))+Math.round(Math.abs(c)),b=Math.round(Math.abs(f))+Math.round(Math.abs(p));e.width=x+l,e.height=b+u}h.pivotX=e.pivotX,h.pivotY=e.pivotY,h.maxAnchor.x=h.maxAnchor.y=.5,h.minAnchor.x=h.minAnchor.y=.5,h.resetNativeSize()}else e.animationType===_e.FRAME_ANIMATION?(e._animation=i.animation.data.animations,e.phaser.animations=new o.AnimationManager(e.phaser)):e.animationType===_e.FRAME_SAMPLES&&(e._animation=i.animation.data.samples,e.phaser.animations=new o.AnimationManager(e.phaser));i.getFrame(t.frame)||(t.frame=0),e.phaser.key=i.key,e.frame=t.frame,e.paused=!1,e.animationType===_e.DRAGON_BONES&&e.bindDragonBonesEvent(),e.defaultAnimation&&(!e.animationNameList||e.animationNameList.indexOf(e.defaultAnimation)<0?e.defaultAnimation=null:e.playAnimation(e.defaultAnimation)),e._dispatchLayoutArgumentChanged("size"),e._onTextureChanged&&e._onTextureChanged.dispatch()}},frame:{get:function(){return this.phaser.frameName},set:function(t){if(this.texture){var e=this.texture.atlas.frameNames||[0];"string"==typeof t&&-1===e.indexOf(t)||(this.phaser.loadTexture(this.texture.atlas.key,t,!1),this._dispatchLayoutArgumentChanged("size"),this._onTextureChanged&&this._onTextureChanged.dispatch())}}},defaultAnimation:{get:function(){return this._defaultAnimation},set:function(t){""===t&&(t=null),this._defaultAnimation=t,this.playAnimation(t)}},addInfo:{get:function(){function e(r,a){for(var o=0;o<r.children.length;o++){var h,l=r.children[o],u=l.getScript(ps.Layout);t.PlaySmartEditorData&&(h=l.getScript("playsmart.editor.data")),u&&(i[a+"_"+l.name]||(i[a+"_"+l.name]={}),i[a+"_"+l.name].layout=u.layout),t.PlaySmartEditorData&&h&&(i[a+"_"+l.name]||(i[a+"_"+l.name]={}),i[a+"_"+l.name].playsmart_editor_data_screenAdapter=h.screenAdapter),l.texture&&(i[a+"_"+l.name]||(i[a+"_"+l.name]={}),i[a+"_"+l.name].url=l.texture.atlas.url,n+=l.uuid+" "+l.texture),(l instanceof dragonBones.PhaserArmatureDisplay||l instanceof s.Sprite)&&(i[a+"_"+l.name]||(i[a+"_"+l.name]={}),i[a+"_"+l.name].x=l.x,i[a+"_"+l.name].y=l.y),l.children&&l.children.length>0&&e(l,a)}}var i={},r=this.name;e(this,r);var n=JSON.stringify(i);return n},set:function(e){function i(e,n){for(var a=0;a<e.children.length;a++){var o=e.children[a],h=n+"_"+o.name;if(r[h]){if(r[h].layout){var l=o.addScript("ps.Layout");l.layout=r[h].layout}if(r[h].playsmart_editor_data_screenAdapter&&t.PlaySmartEditorData){var u=o.addScript("playsmart.editor.data");void 0!==u&&(u.screenAdapter=r[h].playsmart_editor_data_screenAdapter)}(o instanceof dragonBones.PhaserArmatureDisplay||o instanceof s.Sprite)&&(o.x=r[h].x,o.y=r[h].y),null!=r[h].url&&(o.texture=null,dragonBones.game._qc.assets.find(r[h].url)?(o.texture=dragonBones.game._qc.assets.find(r[h].url),o.resetNativeSize()):o.loadImg(r[h].url))}o.children&&o.children.length>0&&i(o,n)}}var r=JSON.parse(e);this.changeData=r;var n=this.name;i(this,n)}},paused:{get:function(){return this.isPaused()},set:function(t){switch(this.animationType){case s.Sprite.FRAME_ANIMATION:case s.Sprite.FRAME_SAMPLES:if(!this.phaser.animations.currentAnim)return;this.phaser.animations.paused=t;break;case s.Sprite.DRAGON_BONES:this._paused=t}}},isPlaying:{get:function(){switch(this.animationType){case s.Sprite.FRAME_ANIMATION:case s.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return!!t&&t.isPlaying;case s.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsPlaying();default:return!1}}},isComplete:{get:function(){switch(this.animationType){case s.Sprite.FRAME_ANIMATION:case s.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return!!t&&t.isFinished;case s.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsComplete();default:return!1}}},lastAnimationName:{get:function(){switch(this.animationType){case s.Sprite.FRAME_ANIMATION:case s.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return t?t.name:null;case s.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getLastAnimationName();default:return!1}}},onStart:{get:function(){return this._onStart||(this._onStart=new o.Signal),this._onStart}},onFinished:{get:function(){return this._onFinished||(this._onFinished=new o.Signal),this._onFinished}},onLoopFinished:{get:function(){return this._onLoopFinished||(this._onLoopFinished=new o.Signal),this._onLoopFinished}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new s.Rectangle(0,0,0,0)}},armature:{get:function(){return this._armature}},animationNameList:{get:function(){switch(this.animationType){case s.Sprite.FRAME_ANIMATION:if(!this.texture)return null;var t=this.texture.atlas.animation.data.animations;return t?e.keys(t):null;case s.Sprite.DRAGON_BONES:return this._armature?this._armature.animation.animationNameList:null;case s.Sprite.FRAME_SAMPLES:var i=this._animation;return i?e.keys(i):null;default:return null}}},colorTint:{get:function(){return new vt(this.phaser.tint)},set:function(t){if(!(t instanceof vt))throw new Error("Expected:qc.Color");this.phaser.tint=t.toNumber()}},onTextureChanged:{get:function(){return this._onTextureChanged||(this._onTextureChanged=new o.Signal),this._onTextureChanged}},class:{get:function(){return"qc.Sprite"}}}),_e.prototype.resetNativeSize=function(){this.width=this.nativeSize.width,this.height=this.nativeSize.height},_e.prototype.isPaused=function(){switch(this.animationType){case s.Sprite.FRAME_ANIMATION:case s.Sprite.FRAME_SAMPLES:return!!this.phaser.animations.currentAnim&&this.phaser.animations.paused;case s.Sprite.DRAGON_BONES:return this._paused;default:return!1}};var me=function(t){var e=this._qc;e._phaserImageSetFrame.call(this,t),e.animationType!==s.Sprite.DRAGON_BONES&&(e.setWidth(e.width),e.setHeight(e.height))},ye=function(t,e,i,r,n,a,s,o,h,l,u,c,p,d,f,_,g,m,y,v,T){t.currentBatchSize>=t.size&&(t.flush(),t.currentBaseTexture=e.texture.baseTexture);var x=t.colors,b=t.positions,A=4*t.currentBatchSize*t.vertSize;t.renderSession.roundPixels?(b[A]=f*i+g*r+y|0,b[A+1]=m*r+_*i+v|0,b[A+5]=f*n+g*a+y|0,b[A+6]=m*a+_*n+v|0,b[A+10]=f*s+g*o+y|0,b[A+11]=m*o+_*s+v|0,b[A+15]=f*h+g*l+y|0,b[A+16]=m*l+_*h+v|0):(b[A]=f*i+g*r+y,b[A+1]=m*r+_*i+v,b[A+5]=f*n+g*a+y,b[A+6]=m*a+_*n+v,b[A+10]=f*s+g*o+y,b[A+11]=m*o+_*s+v,b[A+15]=f*h+g*l+y,b[A+16]=m*l+_*h+v),b[A+2]=u,b[A+3]=c,b[A+7]=p,b[A+8]=c,b[A+12]=p,b[A+13]=d,b[A+17]=u,b[A+18]=d,x[A+4]=x[A+9]=x[A+14]=x[A+19]=T,t.sprites[t.currentBatchSize++]=e},ve=function(t){var e=this._qc,i=e.animationType;if(i===s.Sprite.FRAME_SAMPLES){if(!this.visible||this.alpha<=0||!this.renderable)return;if(!this.animations.currentAnim)return;var r,n,a,l=t.spriteBatch,u=this,c=this.animations.currentAnim._frameIndex,p=e.texture.atlas.animation.data,d=p.uvs,f=e.lastAnimationName,_=e._animation[f],g=_.frames,m=u.texture,y=m.baseTexture.resolution,v=u.worldTransform,T=v.a/y,x=v.b/y,b=v.c/y,A=v.d/y,S=v.tx,w=v.ty,P=u.tint,E=u.parent.worldAlpha*u.alpha,D=_.last;P=(P>>16)+(65280&P)+((255&P)<<16);var C,O,M,I,R,N,B,L,F,k,U,j,W,V=-1;if(p.convert||(p.convert={}),p.convert[f]?M=p.convert[f]:p.convert[f]=M=new Array(g.length),0==(7&c)?(V=c>>3,M[V]||(I=[V])):c===D-1?(V=1+(c>>3),M[V]||(I=[V])):(C=c>>3,O=C+1,M[C]||M[O]?M[C]?M[O]||(I=[O]):I=[C]:I=[C,O]),I)for(var z=u.texture.baseTexture.width,G=u.texture.baseTexture.height,Y=d.length>>2,X=0,H=I.length;X<H;X++){var q=I[X],K=g[q];if(K){ft=new Array(Y);for(var J=0,Z=K.length/10;J<Z;J++){r=10*J,n=4*K[r],ft[n]=J;var Q=K[r+1],$=K[r+2],tt=K[r+3],et=K[r+4],it=K[r+5],rt=K[r+6],nt=K[r+7],at=K[r+8],st=(d[n+2]-d[n])*z,ot=(d[n+3]-d[n+1])*G,ht=st*-nt,lt=ot*-at,ut=st*(1-nt),ct=ot*(1-at);K[r+1]=Q*ht+tt*lt+it,K[r+2]=$*ht+et*lt+rt,K[r+3]=Q*ut+tt*lt+it,K[r+4]=$*ut+et*lt+rt,K[r+5]=Q*ut+tt*ct+it,K[r+6]=$*ut+et*ct+rt,K[r+7]=Q*ht+tt*ct+it,K[r+8]=$*ht+et*ct+rt}p.convert[f][q]=!0,p.uvmap||(p.uvmap={}),p.uvmap[f]||(p.uvmap[f]={}),p.uvmap[f][q]=ft}else console.log(q,I)}if(V>=0)for(K=g[V],J=0,Z=K.length/10;J<Z;J++)r=10*J,n=4*K[r],R=K[r+1],N=K[r+2],B=K[r+3],L=K[r+4],F=K[r+5],k=K[r+6],U=K[r+7],j=K[r+8],W=K[r+9],ye(l,u,R,N,B,L,F,k,U,j,d[n],d[n+1],d[n+2],d[n+3],T,x,b,A,S,w,P+(W*E<<24));else{var pt=(c-(C<<3))/(O===D?D-(C<<3):8),dt=(K=g[C],g[O]),ft=p.uvmap[f][O];for(J=0,Z=K.length/10;J<Z;J++)r=10*J,n=4*K[r],a=10*ft[n],isNaN(a)?(R=K[r+1],N=K[r+2],B=K[r+3],L=K[r+4],F=K[r+5],k=K[r+6],U=K[r+7],j=K[r+8],W=K[r+9]):(R=K[r+1],N=K[r+2],B=K[r+3],L=K[r+4],F=K[r+5],k=K[r+6],U=K[r+7],j=K[r+8],W=K[r+9],R+=(dt[a+1]-R)*pt,N+=(dt[a+2]-N)*pt,B+=(dt[a+3]-B)*pt,L+=(dt[a+4]-L)*pt,F+=(dt[a+5]-F)*pt,k+=(dt[a+6]-k)*pt,U+=(dt[a+7]-U)*pt,j+=(dt[a+8]-j)*pt,W+=(dt[a+9]-W)*pt),ye(l,u,R,N,B,L,F,k,U,j,d[n],d[n+1],d[n+2],d[n+3],T,x,b,A,S,w,P+(W*E<<24))}return h.DisplayObjectContainer.prototype._renderWebGL.call(this,t)}return i===s.Sprite.DRAGON_BONES&&e._armature?h.DisplayObjectContainer.prototype._renderWebGL.call(this,t):o.Sprite.prototype._renderWebGL.call(this,t)},Te=function(t){var e=this._qc,i=e.animationType;if(i!==s.Sprite.FRAME_SAMPLES)return i===s.Sprite.DRAGON_BONES&&e._armature?h.DisplayObjectContainer.prototype._renderCanvas.call(this,t):o.Sprite.prototype._renderCanvas.call(this,t);if(!(!1===this.visible||0===this.alpha||!1===this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)&&this.animations.currentAnim){var r=t.context;if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,r.globalCompositeOperation=h.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var n,a=this.texture.baseTexture.resolution/t.resolution;!t.smoothProperty||t.scaleMode===this.texture.baseTexture.scaleMode&&r[t.smoothProperty]===(t.scaleMode===h.scaleModes.LINEAR)||(t.scaleMode=this.texture.baseTexture.scaleMode,r[t.smoothProperty]=t.scaleMode===h.scaleModes.LINEAR);var l=this.texture.baseTexture.width,u=this.texture.baseTexture.height;if(16777215!==this.tint){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;var c=this.texture.crop,p=c.x,d=c.y,f=c.width,_=c.height;c.x=0,c.y=0,c.width=l,c.height=u,this.tintedTexture=h.CanvasTinter.getTintedTexture(this,this.tint),c.x=p,c.y=d,c.width=f,c.height=_}n=this.tintedTexture}else n=this.texture.baseTexture.source;var g,m,y,v,T,x,b,A,S,w,P,E=this,D=this.animations.currentAnim._frameIndex,C=e.texture.atlas.animation.data,O=C.uvs,M=e.lastAnimationName,I=e._animation[M].frames,R=E.texture.baseTexture.resolution,N=E.worldTransform,B=N.a/R,L=N.b/R,F=N.c/R,k=N.d/R,U=N.tx,j=N.ty,W=e._animation[M].last;if(0==(7&D))g=D>>3,x=I[g];else if(D===W-1)g=1+(D>>3),x=I[g];else if(m=D>>3,y=m+1,x=I[m],b=I[y],A=(D-(m<<3))/(y===W?W-(m<<3):8),C.uvmap||(C.uvmap={}),C.uvmap[M]?v=C.uvmap[M]:C.uvmap[M]=v=new Array(I.length),v[y])T=v[y];else{var V=O.length>>2;T=new Array(V),b=I[y];for(var z=0,G=b.length/10;z<G;z++)w=4*b[10*z],T[w]=z;v[y]=T}var Y=this.parent.worldAlpha*E.alpha;for(z=0,G=x.length/10;z<G;z++){S=10*z,w=4*x[S];var X=x[S+1],H=x[S+2],q=x[S+3],K=x[S+4],J=x[S+5],Z=x[S+6],Q=x[S+7],$=x[S+8],tt=x[S+9];y&&(P=10*T[w],isNaN(P)||(X+=(b[P+1]-X)*A,H+=(b[P+2]-H)*A,q+=(b[P+3]-q)*A,K+=(b[P+4]-K)*A,J+=(b[P+5]-J)*A,Z+=(b[P+6]-Z)*A,Q+=(b[P+7]-Q)*A,$+=(b[P+8]-$)*A,tt+=(b[P+9]-tt)*A));var et=O[w]*l,it=O[w+1]*u,rt=O[w+2]*l,nt=O[w+3]*u,at=X*B+H*F,st=X*L+H*k,ot=q*B+K*F,ht=q*L+K*k,lt=(J*B+Z*F+U)*t.resolution,ut=(J*L+Z*k+j)*t.resolution,ct=rt-et,pt=nt-it,dt=ct*-Q,ft=pt*-$;t.roundPixels?(r.setTransform(at,st,ot,ht,0|lt,0|ut),dt|=0,ft|=0):r.setTransform(at,st,ot,ht,lt,ut),r.globalAlpha=Y*(tt/255),r.drawImage(n,et,it,ct,pt,dt/a,ft/a,ct/a,pt/a)}}var _t=this.children;for(z=0;z<_t.length;z++)_t[z]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};_e.prototype.getSampledAnimationBounds=function(){var t=this.animationType;if(t!==s.Sprite.FRAME_SAMPLES)return new s.Rectangle(0,0,0,0);var e=this.lastAnimationName;if(!e)return new s.Rectangle(0,0,0,0);var i=this.texture.atlas.animation.data,r=i.bounds;r||(r=i.bounds={});var n=r[e];if(n)return n;var a,o,h,l,u,c,p,d,f,_,g,m,y,v,T,x,b,A,S,w,P,E,D,C,O,M,I,R,N,B,L=i.uvs,F=this.phaser.texture.baseTexture.width,k=this.phaser.texture.baseTexture.height,U=this._animation[e],j=i.convert&&i.convert[e]||{},W=1/0,V=1/0,z=-1/0,G=-1/0;for(a=0,o=U.frames.length;a<o;a++)for(h=U.frames[a],c=j[a],l=0,u=h.length/10;l<u;l++)p=10*l,d=4*h[p],c?(D=h[p+1],I=h[p+2],C=h[p+3],R=h[p+4],O=h[p+5],N=h[p+6],M=h[p+7],B=h[p+8]):(f=h[p+1],_=h[p+2],g=h[p+3],m=h[p+4],y=h[p+5],v=h[p+6],T=h[p+7],x=h[p+8],b=(L[d+2]-L[d])*F,A=(L[d+3]-L[d+1])*k,S=b*-T,w=A*-x,P=b*(1-T),E=A*(1-x),D=f*S+g*w+y,I=_*S+m*w+v,C=f*P+g*w+y,R=_*P+m*w+v,O=f*P+g*E+y,N=_*P+m*E+v,M=f*S+g*E+y,B=_*S+m*E+v),W=Math.min(W,D,C,O,M),z=Math.max(z,D,C,O,M),V=Math.min(V,I,R,N,B),G=Math.max(G,I,R,N,B);return n=r[e]=new s.Rectangle(W,V,z-W,G-V),n},_e.prototype.setWidth=function(t){F.prototype.setWidth.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.width=t)},_e.prototype.setHeight=function(t){F.prototype.setHeight.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.height=t)},_e.prototype.getMeta=function(){var t=s.Serializer,e=s.Node.prototype.getMeta.call(this);return e.texture=t.TEXTURE,e.frame=t.AUTO,e.defaultAnimation=t.STRING,e.addInfo=t.STRING,e};var xe=s.UIText=function(t,e,r){s.Node.call(this,new o.Group(t.phaser,null),e,r),this.textPhaser=new o.Text(t.phaser),this.textPhaser._nqc=this,this.textPhaser.wordWrapWidth=this.width,this.textPhaser.wordWrapHeight=this.height,this.phaser.addChildAt(this.textPhaser,0),this.textRealWidth=0,this.textRealHeight=0,this.fontSize=12,this._glowText=null,this.name="UIText",this._data="",this._colors=[],this.color=vt.black,this.colorfill,this._gradient=!1,this.startColor=vt.red,this.endColor=vt.black,this._gradientByLine=!0,this._fontFamily=xe.SYSTEMFONT,this.textPhaser.determineFontProperties=xe._phaserDetermineFontProperties,this.shadowBlur=10,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowColor=vt.shadow,this._enableShadow=!1,this._enableGlow=!1,this.glowColor=vt.red,this.stroke=vt.black,this._strokeThickness=0,this._glowBlur=1,this._wrap=!1,this._wrapWidth=this.width,this._wrapHeight=this.height,this._autoSize=!1,this._onPhaseTextSizeChange=new o.Signal,this._onPhaseTextSizeChange.add(function(t,e){this.autoSize&&(this.width=t,this.height=e)},this);var n=r!==i;!0!==n&&(this.bold=!1,this.alignH=xe.LEFT,this.alignV=xe.MIDDLE,this.overflow=!1);var a=this;this.onTransformChanged.add(function(t,e){a.textPhaser&&a.game.renderInRenderTexture&&!a.isUpating&&(a.isUpating=!0,a.textPhaser.updateText(),a.isUpating=!1)})};xe.prototype=e.create(s.Node.prototype),xe.prototype.constructor=xe,xe.LEFT=0,xe.RIGHT=1,xe.CENTER=2,xe.JUSTIFY=3,xe.TOP=0,xe.BOTTOM=1,xe.MIDDLE=2,xe.SYSTEMFONT=0,xe.WEBFONT=1,xe.BITMAPFONT=2,xe._SYMBOL_COLOR=0,xe._SYMBOL_END_COLOR=1,xe.scaleImmediatelyUpdateText=!0,xe.freezeScaleUpdateText=!1,e.defineProperties(xe.prototype,{colorTint:{get:function(){return new vt(this.textPhaser.tint)},set:function(t){if(t=t||new vt(16777215),!(t instanceof vt))throw new Error("Expected qc.Color");this.textPhaser.tint=t.toNumber()}},autoSize:{get:function(){return this._autoSize},set:function(t){t!==this._autoSize&&(this._autoSize=t,t&&this.textPhaser&&(this.width=this.textPhaser.width,this.height=this.textPhaser.height))}},fontFamily:{get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._changeText(""),this._isTransformDirty=!0)}},alignH:{get:function(){return this._alignH},set:function(t){t!==this._alignH&&(this._alignH=t,0==t&&(this.textPhaser.boundsAlignH="left"),1==t&&(this.textPhaser.boundsAlignH="right"),2==t&&(this.textPhaser.boundsAlignH="center"),3==t&&(this.textPhaser.boundsAlignH="justify"),this.textPhaser.dirty=!0,this._adjustTextPos(),this._enableGlow&&(this.enableGlow=!this.enableGlow,this.enableGlow=!this.enableGlow),this._isTransformDirty=!0)}},alignV:{get:function(){return this._alignV},set:function(t){t!==this._alignV&&(this._alignV=t,0==t&&(this.textPhaser.boundsAlignV="top"),2==t&&(this.textPhaser.boundsAlignV="middle"),1==t&&(this.textPhaser.boundsAlignV="bottom"),this.textPhaser.dirty=!0,this._adjustTextPos(),this._enableGlow&&(this.enableGlow=!this.enableGlow,this.enableGlow=!this.enableGlow),this._isTransformDirty=!0)}},font:{get:function(){var t=this.textPhaser.font.replace(/\'/g,"");return this.fontFamily!==xe.SYSTEMFONT?this.game.assets.find(this._fontKey||t):t},set:function(e){if(e){var i=e;if(this.fontFamily!==xe.SYSTEMFONT){if(!(e instanceof s.Font))return void this.game.log.error("Expected qc.Font");if(this.fontFamily!==e._fontFamily)return void this.game.log.error("Invalid font asset");this.fontFamily===xe.WEBFONT?(i=t.__wx&&e.wxFontName?e.wxFontName:e.uuid,this._fontKey=e.uuid):(i=e.url,this._fontKey=e.url)}else if("string"!=typeof e)return void this.game.log.error("Expected string");i!==this.textPhaser.font&&(this._changeText(i),this.enableGlow&&(this._glowText.font=i),this._isTransformDirty=!0)}}},bold:{get:function(){return"normal"!==this.textPhaser.fontWeight},set:function(t){var e=t?"bold":"normal";e!==this.textPhaser.fontWeight&&(this.textPhaser.fontWeight=e,this._enableGlow&&(this._glowText.fontWeight=e),this._isTransformDirty=!0)}},italic:{get:function(){return"normal"!==this.textPhaser.fontStyle},set:function(t){var e=t?"italic":"normal";e!==this.textPhaser.fontStyle&&(this.textPhaser.fontStyle=e,this._enableGlow&&(this._glowText.fontStyle=e),this._isTransformDirty=!0)}},fontSize:{get:function(){return this.textPhaser.fontSize},set:function(t){if("number"!=typeof t)throw new Error("Expected number");t!==this.textPhaser.fontSize&&(this.textPhaser.fontSize=t,this._enableGlow&&(this._glowText.fontSize=t),this._isTransformDirty=!0,this._changeGradient(!0))}},color:{get:function(){return new vt(this.colorfill)},set:function(t){if(!(t instanceof vt))throw new Error("Expected qc.Color");if(!this._gradient){var e=t.toString("rgb");e!==this.textPhaser.fill&&(this.textPhaser.tint=new vt(16777215).toNumber(),this.colorfill=e,this.textPhaser.fill=e,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}}},text:{get:function(){return this._data},set:function(t){if("string"!=typeof t)throw new Error("Expected string");t!==this._data&&(this._colors=[],this._data=t,this._parseTextColor(t),this._setTextColor(this.textPhaser),this._enableGlow&&(this._glowText.text=this.textPhaser.text),this._isTransformDirty=!0,this._changeGradient(!0))}},lineSpacing:{get:function(){return this.textPhaser.lineSpacing},set:function(t){t!==this.textPhaser.lineSpacing&&(this.textPhaser.lineSpacing=t,this._enableGlow&&(this._glowText.lineSpacing=t),this._isTransformDirty=!0,this._changeGradient(!0))}},lineHeight:{get:function(){return this.textPhaser.lineHeight},set:function(t){t!==this.textPhaser.lineHeight&&(this.textPhaser.lineHeight=t,this._enableGlow&&(this._glowText.lineHeight=t),this._isTransformDirty=!0)}},letterSpacing:{get:function(){return this.textPhaser.letterSpacing},set:function(t){t!==this.textPhaser.letterSpacing&&(this.textPhaser.letterSpacing=t,this._enableGlow&&(this._glowText.lineSpacing=t),this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},enableUnderline:{get:function(){return this.textPhaser.enableUnderline},set:function(t){t!==this.textPhaser.enableUnderline&&(this.textPhaser.enableUnderline=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},underlineColor:{get:function(){return this.textPhaser.underlineColor},set:function(t){t!==this.textPhaser.underlineColor&&(this.textPhaser.underlineColor=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},underlineWidth:{get:function(){return this.textPhaser.underlineWidth},set:function(t){t!==this.textPhaser.underlineWidth&&(this.textPhaser.underlineWidth=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},underlineSpacing:{get:function(){return this.textPhaser.underlineSpacing},set:function(t){t!==this.textPhaser.underlineSpacing&&(this.textPhaser.underlineSpacing=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},enableDeleteline:{get:function(){return this.textPhaser.enableDeleteline},set:function(t){t!==this.textPhaser.enableDeleteline&&(this.textPhaser.enableDeleteline=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},deletelineColor:{get:function(){return this.textPhaser.deletelineColor},set:function(t){t!==this.textPhaser.deletelineColor&&(this.textPhaser.deletelineColor=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},deletelineWidth:{get:function(){return this.textPhaser.deletelineWidth},set:function(t){t!==this.textPhaser.deletelineWidth&&(this.textPhaser.deletelineWidth=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},deletelineSpacing:{get:function(){return this.textPhaser.deletelineSpacing},set:function(t){t!==this.textPhaser.deletelineSpacing&&(this.textPhaser.deletelineSpacing=t,this._isTransformDirty=!0,this.textPhaser.dirty=!0)}},wrap:{get:function(){return this._wrap},set:function(t){t!==this._wrap&&(this._wrap=t,this.textPhaser.wordWrap=t,this.textPhaser.useAdvancedWrap=!0,this.textPhaser.style.wordWrap=this._wrap,this.textPhaser.dirty=!0,this._enableGlow&&(this._glowText.wordWrap=t),this._isTransformDirty=!0,this._changeGradient(!0))}},overflow:{get:function(){var t=this.getScript("qc.NodeMask");return!(!t||!t.enable)},set:function(t){var e=this.getScript("qc.NodeMask");e||(e=this.addScript("qc.NodeMask")),e.enable=t}},pivotX:{get:function(){return e.getOwnPropertyDescriptor(s.Node.prototype,"pivotX").get.call(this)},set:function(t){e.getOwnPropertyDescriptor(s.Node.prototype,"pivotX").set.call(this,t),
this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0}},pivotY:{get:function(){return e.getOwnPropertyDescriptor(s.Node.prototype,"pivotY").get.call(this)},set:function(t){e.getOwnPropertyDescriptor(s.Node.prototype,"pivotY").set.call(this,t),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0}},width:{get:function(){return e.getOwnPropertyDescriptor(s.Node.prototype,"width").get.call(this)},set:function(t){t!==this.width&&(e.getOwnPropertyDescriptor(s.Node.prototype,"width").set.call(this,t),this._wrapWidth=t,this._enableGlow&&(this._glowText.wordWrapWidth=t,this._glowText.x=this.textPhaser.x,this._glowText.y=this.textPhaser.y,this._glowText.dirty=!0),this.textPhaser&&(this.textPhaser.wordWrapWidth=t,this._adjustTextPos()),this._isTransformDirty=!0)}},height:{get:function(){return e.getOwnPropertyDescriptor(s.Node.prototype,"height").get.call(this)},set:function(t){t!==this.height&&(e.getOwnPropertyDescriptor(s.Node.prototype,"height").set.call(this,t),this._wrapHeight=t,this.textPhaser&&(this.textPhaser.dirty=!0,this.textPhaser.wordWrapHeight=t,this._adjustTextPos()),this._isTransformDirty=!0)}},class:{get:function(){return"qc.UIText"}},startColor:{get:function(){return new vt(this._startColor)},set:function(t){if(!(t instanceof vt))throw new Error("Expected qc.Color");var e=t.toString();this._startColor=e,this.textPhaser.dirty=!0,this.textPhaser.startColor=e,this._changeGradient(!0)}},endColor:{get:function(){return new vt(this._endColor)},set:function(t){if(!(t instanceof vt))throw new Error("Expected qc.Color");var e=t.toString();this._endColor=e,this.textPhaser.dirty=!0,this.textPhaser.endColor=e,this._changeGradient(!0)}},gradient:{get:function(){return this._gradient},set:function(t){t!==this._gradient&&(this._gradient=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0,this.textPhaser.gradient=t,this._changeGradient(!0))}},gradientByLine:{get:function(){return this._gradientByLine},set:function(t){t!==this._gradientByLine&&(this._gradientByLine=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0,this.textPhaser.gradientByLine=t,this._changeGradient(!0))}},stroke:{get:function(){return new vt(this.textPhaser.stroke)},set:function(t){if(!(t instanceof vt))throw new Error("Expected qc.Color");var e=t.toString();e!==this.textPhaser.stroke&&(this.textPhaser.stroke=e,this._isTransformDirty=!0)}},strokeThickness:{get:function(){return this._strokeThickness},set:function(t){t!==this._strokeThickness&&(this._strokeThickness=t,this.textPhaser.strokeThickness=t,this._enableGlow&&(this._glowText.strokeThickness=this.textPhaser.strokeThickness,this._glowText.dirty=!0),this.textPhaser.shadowStroke=t>0&&this.enableShadow,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},enableShadow:{get:function(){return this._enableShadow},set:function(t){this._enableShadow=t,this.textPhaser.shadowFill=t,this.textPhaser.shadowStroke=t&&this.strokeThickness>0,this.textPhaser.dirty=!0,this._isTransformDirty=!0}},shadowColor:{get:function(){return new vt(this.textPhaser.shadowColor)},set:function(t){if(!(t instanceof vt))throw new Error("Expected qc.Color");var e=t.toString();e!==this.textPhaser.shadowColor&&(this.textPhaser.style.shadowColor=e,this.textPhaser.shadowColor=e,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},shadowBlur:{get:function(){return this.textPhaser.shadowBlur},set:function(t){t!==this.textPhaser.shadowBlur&&(this.textPhaser.style.shadowBlur=t,this.textPhaser.shadowBlur=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},shadowOffsetX:{get:function(){return this.textPhaser.shadowOffsetX},set:function(t){this.textPhaser.shadowOffsetX=t,this.textPhaser.style.shadowOffsetX=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0}},shadowOffsetY:{get:function(){return this.textPhaser.shadowOffsetY},set:function(t){this.textPhaser.shadowOffsetY=t,this.textPhaser.style.shadowOffsetY=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0}},glowColor:{get:function(){return new vt(this._glowColor)},set:function(t){if(!(t instanceof vt))throw new Error("Expected qc.Color");var e=t.toString();e!==this._glowColor&&(this._glowColor=e,this._glowText&&(this._glowText.fill=e,this._glowText.stroke=e,this._glowText.shadowColor=e,this._glowText.dirty=!0))}},glowBlur:{get:function(){return this._glowBlur},set:function(t){t!==this._glowBlur&&(this._glowBlur=t,this.enableGlow&&(this._glowText.filterX.blur=t,this._glowText.filterY.blur=t))}},enableGlow:{get:function(){return this._enableGlow},set:function(t){if(t!==this._enableGlow){if(this._enableGlow=t,t){this._glowText=new o.Text(this.game.phaser),this._glowText._nqc=this,this._copyProperty(this._glowText,this.textPhaser),this._glowText.x=this.textPhaser.x,this._glowText.y=this.textPhaser.y,this._glowText.fill=this._glowColor,this._glowText.stroke=this._glowColor,this._glowText.shadowColor=this._glowColor,this._glowText.underlineColor=this._glowColor,this._glowText.determineFontProperties=xe._phaserDetermineFontProperties,this.phaser.addChildAt(this._glowText,0);var e=new s.Filter.BlurX(this.game),i=new s.Filter.BlurY(this.game);e.blur=this.glowBlur,i.blur=this.glowBlur,this._glowText.filters=[e,i],this._glowText.filterX=e,this._glowText.filterY=i}else this.phaser.removeChild(this._glowText),this._glowText.destroy(),this._glowText=null,this.textPhaser.dirty=!0;this._isTransformDirty=!0}}},nativeSize:{get:function(){var t=this.rect;return t.width=this.textRealWidth,t.height=this.textRealHeight,t}}}),xe.prototype._changeGradient=function(t){if(this._gradient){if(!this.gradientByLine){var e;!t&&this._grid||(this.textPhaser.context.clearRect(0,0,this.textPhaser._width,this.textPhaser._height),this._grid=this.textPhaser.context.createLinearGradient(0,0,0,this.textPhaser.height));var i=this.textPhaser.text;if(this.textPhaser.style.wordWrap)i=i.replace(/(?:\r\n|\r|\n)/g,"\n"),e=this.textPhaser.runWordWrap(i,this.textPhaser.wordWrapWidth);else{e=i.split(/(?:\r\n|\r|\n)/);for(var r=0;r<e.length-1;r++)e[r]+="\n"}e.length;this._grid.addColorStop(0,this.startColor),this._grid.addColorStop(1,this.endColor),this.textPhaser.fill=this._grid}}else this.textPhaser.fill=this.color.toString()},xe.prototype._changeText=function(t){var e,i=h.BitmapText.fonts[t];i?(e=new o.BitmapText(this.game.phaser,0,0,t),this._glowText&&(this._glowText.visible=!1)):(e=new o.Text(this.game.phaser),e.determineFontProperties=xe._phaserDetermineFontProperties,this._glowText&&(this._glowText.visible=!0)),e.font=t,e._nqc=this,this.textPhaser.font=t,this._copyProperty(e,this.textPhaser),e.style.shadowFill=this.enableShadow,e.x=this.textPhaser.x,e.y=this.textPhaser.y,this._glowText&&(this._glowText.font=e.font);var r=this.phaser.getChildIndex(this.textPhaser);this.phaser.removeAt?this.phaser.removeAt(r):this.phaser.removeChildAt(r),this.phaser.addAt?this.phaser.addAt(e,r):this.phaser.addChildAt(e,r),this.textPhaser.destroy(),this.textPhaser=e,this._isTransformDirty=!0,this._setTextColor(this.textPhaser)},xe.prototype.setWidth=function(t){s.Node.prototype.setWidth.call(this,t),this._wrapWidth=t,this.textPhaser&&(this.textPhaser.wordWrapWidth=t,this._adjustTextPos())},xe.prototype.setHeight=function(t){s.Node.prototype.setHeight.call(this,t),this._wrapHeight=t,this.textPhaser&&(this.textPhaser.dirty=!0,this.textPhaser.wordWrapHeight=t,this._adjustTextPos())},xe.prototype.postUpdate=function(){var t=this.textPhaser;this._adjustTextPos(),t.dirty&&t.updateText()},xe.prototype._copyProperty=function(t,e){t.align=e.align,t.boundsAlignH=e.boundsAlignH,t.boundsAlignV=e.boundsAlignV,t.fontWeight=e.fontWeight,t.fontSize=e.fontSize,t.lineSpacing=e.lineSpacing,t.lineHeight=e.lineHeight,t.letterSpacing=e.letterSpacing,t.enableUnderline=e.enableUnderline,t.underlineColor=e.underlineColor,t.underlineWidth=e.underlineWidth,t.underlineSpacing=e.underlineSpacing,t.enableDeleteline=e.enableDeleteline,t.deletelineColor=e.deletelineColor,t.deletelineWidth=e.deletelineWidth,t.deletelineSpacing=e.deletelineSpacing,t.wordWrap=this._wrap,t.name=e.name,t.scale=e.scale,t.pivot=e.pivot,t.rotation=e.rotation,t.alpha=e.alpha,t.visible=e.visible,t.renderable=e.renderable,t.mask=e.mask,t.text=e.text,t.wordWrapWidth=this._wrapWidth,t.wordWrapHeight=this._wrapHeight,t.stroke=e.stroke,t.strokeThickness=e.strokeThickness,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.shadowBlur=e.shadowBlur,t.fill=e.fill,t.fontFamily=this.fontFamily,t.fontWeight=e.fontWeight,t.fontStyle=e.fontStyle,t.font=e.font,t.gradient=e.gradient,t.startColor=e.startColor,t.endColor=e.endColor},xe.prototype._getColor=function(t){switch(t){case"red":return"#8d1d16";case"gray":return"#6a6a6a";case"gold":return"#fde67b";case"yellow":return"#f3e1a3";case"blue":return"#3e65c7";case"brown":return"#322310";case"green":return"#168d3d";case"light_green":return"#7fe39e";case"light_blue":return"#9ed4ec";case"light_red":return"#f86662";case"cyan":return"#52b1ff";case"black":return"#101010";case"gray2":return"#c0c0c0";case"orange":return"#f29f55";case"light_orange":return"#f2c440";case"orange2":return"#9d621c"}},xe.prototype._parseSymbol=function(t,e,i){var r={result:!1};if("["!==t[e])return r;for(var n=e;++n;){if("["===t[n]||n>=t.length||n-e>25)return r;if("]"===t[n])break}var a=n-e;if(a>2&&"#"===t[e+1])r.color=t.slice(e+1,n),r.result=!0,r.type=xe._SYMBOL_COLOR;else if(a>6&&"r"===t[e+1]&&"g"===t[e+2]&&"b"===t[e+3])r.color=t.slice(e+1,n),r.result=!0,r.type=xe._SYMBOL_COLOR;else if("-"===t[e+1]&&"]"===t[e+2])i.length>0&&(r.result=!0),r.type=xe._SYMBOL_END_COLOR;else if(a>=4){var s=t.slice(e+1,n),o=this._getColor(s);o&&(r.color=o,r.result=!0,r.type=xe._SYMBOL_COLOR)}return r.result&&(r.pos=n),r},xe.prototype._pushColor=function(t,e){var i={};i.color=t,i.pos=e,this._colors.push(i),this._isTransformDirty=!0},xe.prototype._setTextColor=function(t){if(t.clearColors&&t.clearColors(),t.addColor){for(var e=0;e<this._colors.length;e++){var i="defaultColor"===this._colors[e].color?"defaultColor":this._colors[e].color;t.addColor(i,this._colors[e].pos)}this._isTransformDirty=!0}},xe.prototype._parseTextColor=function(t){t=t.replace(/(?:\r\n|\r|\n)/g,"\n");for(var e="",i=[],r=0;r<t.length;r++){var n=this._parseSymbol(t,r,i);if(n.result){if(r=n.pos,n.type===xe._SYMBOL_COLOR)i.push(n.color),this._pushColor(n.color,e.length);else if(n.type===xe._SYMBOL_END_COLOR){i.pop();var a=i.length>0?i[i.length-1]:"defaultColor";this._pushColor(a,e.length)}}else e+=t[r]}this.textPhaser.text=e,this._isTransformDirty=!0},xe.prototype.getMeta=function(){var t=F.prototype.getMeta.call(this);return t.fontFamily=j.NUMBER,t.alignH=j.NUMBER,t.alignV=j.NUMBER,t.font=j.FONT,t.bold=j.BOOLEAN,t.italic=j.BOOLEAN,t.fontSize=j.NUMBER,t.color=j.COLOR,t.text=j.STRING,t.lineSpacing=j.NUMBER,t.lineHeight=j.NUMBER,t.letterSpacing=j.NUMBER,t.wrap=j.BOOLEAN,t.enableGlow=j.BOOLEAN,t.startColor=j.COLOR,t.endColor=j.COLOR,t.gradient=j.BOOLEAN,t.gradientByLine=j.BOOLEAN,t.stroke=j.COLOR,t.strokeThickness=j.NUMBER,t.glowColor=j.COLOR,t.autoSize=j.BOOLEAN,t.shadowColor=j.COLOR,t.shadowBlur=j.NUMBER,t.shadowOffsetX=j.NUMBER,t.shadowOffsetY=j.NUMBER,t.enableShadow=j.BOOLEAN,t.enableUnderline=j.BOOLEAN,t.underlineColor=j.COLOR,t.underlineWidth=j.NUMBER,t.underlineSpacing=j.NUMBER,t.enableDeleteline=j.BOOLEAN,t.deletelineColor=j.COLOR,t.deletelineWidth=j.NUMBER,t.deletelineSpacing=j.NUMBER,t},xe.prototype._adjustTextPos=function(){this.textPhaser.x=-this.pivotX*this.width,this.textPhaser.y=-this.pivotY*this.height,this._isTransformDirty=!0},xe.prototype._refreshWebFont=function(e){/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(e)||/['",]/.exec(e)||(e="'"+e+"'"),e===this.textPhaser.font&&(t.__wx&&(this.font=this.font),this.textPhaser.dirty=!0,this._glowText&&(this._glowText.dirty=!0),this._isTransformDirty=!0)},xe._phaserUpdateText=function(){},xe._phaserDetermineFontProperties=function(t){var e=h.Text.fontPropertiesCache[t];if(!e){e={},h.Text.fontPropertiesCanvas||(h.Text.fontPropertiesCanvas=h.sharedCanvas,h.Text.fontPropertiesContext=h.Text.fontPropertiesCanvas.getContext("2d"));var i=h.Text.fontPropertiesCanvas,r=h.Text.fontPropertiesContext;r.font=t;var n=Math.ceil(r.measureText("|MÉq").width);0===n&&(n=1);var a=Math.ceil(r.measureText("M").width),s=2*a;0===s&&(s=1),a=1.4*a|0,i.width=n,i.height=s,r.fillStyle="#f00",r.fillRect(0,0,n,s),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|MÉq",0,a);var o,l,u=r.getImageData(0,0,n,s).data,c=u.length,p=4*n,d=0,f=!1;for(o=0;o<a;o++){for(l=0;l<p;l+=4)if(255!==u[d+l]){f=!0;break}if(f)break;d+=p}for(e.ascent=a-o,d=c-p,f=!1,o=s;o>a;o--){for(l=0;l<p;l+=4)if(255!==u[d+l]){f=!0;break}if(f)break;d-=p}e.descent=o-a,e.fontSize=e.ascent+e.descent,h.Text.fontPropertiesCache[t]=e}return e};var be=s.Button=function(t,e,r){s.UIImage.call(this,t,e,r),this.name="Button",this.onStateChange=new s.Signal;var n=r!==i;if(!0!==n){this.text=t.add.text(this),this.text.text="Button",this.text.name="Text",this.text.interactive=!1,this.interactive=!0,this.state=s.UIState.NORMAL;var a=this.addScript("qc.TransitionBehaviour");a.target=this,this.width=120,this.height=40,this.text.setAnchor(new s.Point(0,0),new s.Point(1,1)),this.text.left=0,this.text.right=0,this.text.top=0,this.text.bottom=0,this.text.alignH=xe.CENTER}var o=this;this.onDown.add(function(){o.state!==s.UIState.DISABLED&&(o.state=s.UIState.PRESSED)}),this.onUp.add(function(){o.state===s.UIState.PRESSED&&(o.state=s.UIState.NORMAL)}),this._onNativeElementClick=this._processNativeClick.bind(this)};be.prototype=e.create(s.UIImage.prototype),be.prototype.constructor=be,e.defineProperties(be.prototype,{state:{get:function(){return this._state||s.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},colorTint:{get:function(){return e.getOwnPropertyDescriptor(s.Node.prototype,"colorTint").get.call(this)},set:function(t){e.getOwnPropertyDescriptor(s.Node.prototype,"colorTint").set.call(this,t),this.text&&(this.text.colorTint=t)}},supportNativeEvent:{get:function(){return this._supportNativeEvent},set:function(t){t!==this._supportNativeEvent&&(this._supportNativeEvent=t,this._checkNativeElement())}},onNativeClick:{get:function(){return this._onNativeClick||(this._onNativeClick=new o.Signal),this._onNativeClick}},class:{get:function(){return"qc.Button"}}}),be.prototype.getMeta=function(){var t=s.Serializer,e=s.UIImage.prototype.getMeta.call(this);return e.text=t.NODE,e.state=t.NUMBER,e.supportNativeEvent=t.BOOLEAN,e},be.prototype.update=function(t){this.isWorldVisible()&&this.supportNativeEvent?(this._checkNativeElement(),t&&this._updateNativeElement()):this._removeNativeElement()},be.prototype.onVisibleChange=function(){this.update(!0)},be.prototype.onDestroy=function(){this._removeNativeElement(),s.UIImage.prototype.onDestroy.call(this)},be.prototype._checkNativeElement=function(){this.supportNativeEvent&&this.worldVisible&&!this._nativeElement?this._createNativeElement():!this._nativeElement||this.supportNativeEvent&&this.worldVisible||this._removeNativeElement()},be.prototype._createNativeElement=function(){var t=this;if(!t._nativeElement){var e=t._nativeElement=document.createElement("div");e.addEventListener("click",t._onNativeElementClick,!1),e.addEventListener("touchstart",t._onNativeElementClick,!1);var i=e.style;i.position="absolute",i.padding=0,i.margin=0,i.border=0,i.outline=0,i.background="none",t.game.world.frontDomRoot.appendChild(e),t._updateNativeElement(),t.phaser.worldTransformChangedCallback=t._updateNativeElement.bind(t),t.phaser.worldTransformChangedContext=t}},be.prototype._removeNativeElement=function(){var t=this._nativeElement;t&&(this._nativeElement=null,t.removeEventListener("click",this._onNativeElementClick,!1),t.removeEventListener("touchstart",this._onNativeElementClick,!1),s.Util.removeHTML(t))},be.prototype._updateNativeElement=function(){var t=this,e=t._nativeElement;e&&(e._lastUpdate=t.game.time.now,s.Util.updateTransform(t,e))},be.prototype._processNativeClick=function(t){this.worldVisible||this._checkNativeElement(),this._onNativeClick&&this._onNativeClick.getNumListeners()>0&&this._onNativeClick.dispatch(this,t)};var Ae=s.Toggle=function(t,e,r){s.Node.call(this,new o.Group(t.phaser,null),e,r),this.name="Toggle",this.interactive=!0,this.onStateChange=new s.Signal,this.onValueChange=new s.Signal,this.canValueChange=new s.Signal;var n=r!==i;if(!0!==n){this.background=t.add.image(this),this.background.name="Background",this.background.interactive=!1,this.background.width=80,this.background.height=80,this.checkMark=t.add.image(this.background),this.checkMark.name="CheckMark",this.checkMark.interactive=!1,this.text=t.add.text(this),this.text.text="Button",this.text.name="Text",this.text.interactive=!1,this.on=!1,this.state=s.UIState.NORMAL,this.checkMark.pivotX=.5,this.checkMark.pivotY=.5,this.checkMark.setAnchor(new s.Point(.5,.5),new s.Point(.5,.5)),this.checkMark.anchoredX=0,this.checkMark.anchoredY=0,this.checkMark.width=50,this.checkMark.height=50,this.text.x=this.background.width+5,this.text.height=this.background.height;var a=this.addScript("qc.TransitionBehaviour");a.target=this.background,a.transition=s.Transition.TEXTURE_SWAP}var h=this;this.onDown.add(function(){h.state!==s.UIState.DISABLED&&(h.state=s.UIState.PRESSED)}),this.onUp.add(function(){h.state===s.UIState.PRESSED&&(h.state=s.UIState.NORMAL)}),this.onClick.add(function(){h.on=!h.on,h.checkMark.visible=h.on})};Ae.prototype=e.create(s.Node.prototype),Ae.prototype.constructor=Ae,e.defineProperties(Ae.prototype,{on:{get:function(){return!!this._on},set:function(t){var e=this.on,i={};this.canValueChange.dispatch(this,t,e,i),i.ignore||(this._on=t,this.checkMark.visible=t,e!==t&&this.onValueChange.dispatch(this))}},state:{get:function(){return this._state||s.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},class:{get:function(){return"qc.Toggle"}}}),Ae.prototype.getMeta=function(){var t=s.Serializer,e=s.Node.prototype.getMeta.call(this);return e.background=t.NODE,e.checkMark=t.NODE,e.text=t.NODE,e.on=U("on",t.BOOLEAN),e.state=U("state",t.NUMBER),e};var Se=s.Sound=function(t,e,i){this.soundPhaser=new o.Sound(t.phaser),this.soundPhaser._qc=this,this._loop=!1,this.game=t,s.Node.call(this,new o.Group(this.game.phaser,null),e,i),this.name="Sound",this._related(),t.phaser.sound._sounds.push(this.soundPhaser),this._playOnAwake=!1,this.destroyWhenStop=!0};Se.prototype=e.create(s.Node.prototype),Se.prototype.constructor=Se,e.defineProperties(Se.prototype,{loop:{get:function(){return this.soundPhaser.loop},set:function(t){this._loop=t,this.soundPhaser.loop=t,this.soundPhaser._sound&&(this.soundPhaser._sound.loop=t)}},audio:{get:function(){return this.audioUrl},set:function(e){if(e){var i=this.audio,r=this.soundPhaser;if(!e)return t.__wx&&i&&this.game.assets.unload(i),void(r.key=e);if(!i||i.key!==e.key){var n=e.key;if(r&&r.key){var a=this.loop,s=this.mute,h=this.volume;r.destroy(),t.__wx&&i&&this.game.assets.unload(i),r=this.soundPhaser=new o.Sound(this.game.phaser,n),r._qc=this,this._related(),this.game.phaser.sound._sounds.push(r),this.loop=a,this.mute=s,this.volume=h}else r.key=n,r.usingAudioTag&&(r.game.cache.getSound(n)&&r.game.cache.isSoundReady(n)?(r._sound=r.game.cache.getSoundData(n),r.totalDuration=0,r._sound.duration&&(r.totalDuration=r._sound.duration)):r.game.cache.onSoundUnlock.add(r.soundHasUnlocked,r))}}}},volume:{get:function(){return this.soundPhaser.volume},set:function(t){this.soundPhaser.volume=t}},playOnAwake:{get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},mute:{get:function(){return this.soundPhaser.mute},set:function(t){this.soundPhaser.mute=t}},destroyWhenStop:{get:function(){return this._destroyWhenStop||!1},set:function(t){this._destroyWhenStop=t}},class:{get:function(){return"qc.Sound"}},isPlaying:{get:function(){return this.soundPhaser.isPlaying},set:function(e){e?(this.soundPhaser.isPlaying=!0,t.playSoundEff(this.audioUrl)):(this.soundPhaser.isPlaying=!1,t.stopSoundEff(this.audioUrl))}},isPaused:{get:function(){return this.soundPhaser.paused}}}),Se.prototype._dispatchAwake=function(){var t=this;F.prototype._dispatchAwake.call(t),!t.game.device.editor&&t.playOnAwake&&t.play()},Se.prototype._related=function(){var t=this;t.onDecoded=t.soundPhaser.onDecoded,t.onStop=t.soundPhaser.onStop,this.onStop.add(function(e){!t.game.device.editor&&t.destroyWhenStop&&t.destroy()},t),t.onLoop=t.soundPhaser.onLoop},Se.prototype.play=function(){if(this.isPaused)return this.soundPhaser.resume(),this;this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio&&(this.soundPhaser._sound.onended=null);var t=this.marker?this.marker.name:null;return this.soundPhaser.play(t),this},Se.prototype.fadeIn=function(t){this.soundPhaser.fadeIn(t)},Se.prototype.fadeOut=function(t){this.soundPhaser.fadeOut(t)},Se.prototype.pause=function(){this.soundPhaser.pause()},Se.prototype.resume=function(){this.soundPhaser.resume()},Se.prototype.stop=function(){this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio&&(this.soundPhaser._sound.onended=null),this.soundPhaser.stop()},Se.prototype.addMarker=function(t,e,i){this.removeMarker(),this.marker={},this.marker.name="s",this.marker.start=t,this.marker.duration=e,this.marker.volume=i,this.soundPhaser.addMarker(this.marker.name,t,e,i)},Se.prototype.removeMarker=function(){this.marker&&(this.soundPhaser.currentMarker="",this.soundPhaser.markers={},this.marker=null)},Se.prototype.onDestroy=function(){if(t.__wx){var e=this.audio;e&&this.game.assets.unload(e)}this.game.phaser.sound.remove(this.soundPhaser),s.Node.prototype.onDestroy.call(this)},Se.prototype.getMeta=function(){var t=s.Serializer,e=s.Node.prototype.getMeta.call(this);return e.audioUrl=t.STRING,e.audio=t.AUDIO,e.loop=t.BOOLEAN,e.volume=t.NUMBER,e.playOnAwake=t.BOOLEAN,e.mute=t.BOOLEAN,e.destroyWhenStop=t.BOOLEAN,e};var we=s.Video=function(t,e,i){this.game=t,s.Node.call(this,new o.Group(this.game.phaser,null),e,i),this.name="video",this.keepLastFrame=!1,this.canPlay=!0,this.triggerNode=""};we.prototype=e.create(s.Node.prototype),we.prototype.constructor=we,e.defineProperties(we.prototype,{url:{get:function(){return this.videoUrl},set:function(t){this.videoUrl=t}},class:{get:function(){return"qc.Video"}},isPlaying:{get:function(){return this.isVideoPlaying},set:function(t){this.isVideoPlaying=t;var e=s.gameOb.world.children[0]._findByName("gamePlay").getScript("ps.VideoManager");if(void 0!==e)if(t){if(e.setVideoShow(this.uuid),!this.canPlay)return void e.setVideoPauseByTime(this.uuid,0);if(""!==this.triggerNode&&e.videoIsPlaying(this.uuid))return;var r=this.startTime||0,n=this.endTime||i;e.setVideoPlayByTime(this.uuid,r,n),e.setVideoMuted(this.uuid,this.muted),e.setVideoLoop(this.uuid,this.videoLoop)}else{if(""!==this.triggerNode&&e.videoIsPlaying(this.uuid))return;this.keepLastFrame||this.videoLoop||e.setVideoHide(this.uuid)}}}}),we.prototype.getMeta=function(){var t=s.Serializer,e=s.Node.prototype.getMeta.call(this);return e.url=t.STRING,e.keepLastFrame=t.BOOLEAN,e.muted=t.BOOLEAN,e.videoLoop=t.BOOLEAN,e.startTime=t.NUMBER,e.endTime=t.NUMBER,e.cutVideo=t.BOOLEAN,e.canPlay=t.BOOLEAN,e.triggerNode=t.STRING,e};var Pe=s.ScrollView=function(t,e,i){s.UIImage.call(this,t,e,i),this.name="ScrollView",this.canHorizontal=!0,this.canVertical=!0,this.movementType=Pe.MOVEMENT_ELASTIC,this.elasticity=1,this.inertia=!0,this.decelerationRate=.03,this.scrollSensitivity=1,this.propagationScroll=!1,this.onValueChange=new o.Signal,this._contentRect=null,this._viewRect=null,this._preContentPosition=null,this._preContentRect=null,this._preViewRect=null,this._velocity=new s.Point(0,0),this._isDragging=!1,this.onWheel.add(this._doWheel,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this)};Pe.prototype=e.create(s.UIImage.prototype),Pe.prototype.constructor=Pe,e.defineProperties(Pe.prototype,{class:{get:function(){return"qc.ScrollView"}},content:{get:function(){return this._content&&this._content._destroy&&(this._content=null),this._content},set:function(t){this._content=t,this._updateBounds()}},horizontalScrollBar:{get:function(){return this._horizontalScrollBar&&this._horizontalScrollBar._destroy&&(this._horizontalScrollBar=null),this._horizontalScrollBar},set:function(t){this._horizontalScrollBar&&this._horizontalScrollBar.onValueChange.remove(this._setHorizontalNormalizedPosition,this),this._horizontalScrollBar=t,this._horizontalScrollBar&&this._horizontalScrollBar.onValueChange.add(this._setHorizontalNormalizedPosition,this)}},verticalScrollBar:{get:function(){return this._verticalScrollBar&&this._verticalScrollBar._destroy&&(this._verticalScrollBar=null),this._verticalScrollBar},set:function(t){this._verticalScrollBar&&this._verticalScrollBar.onValueChange.remove(this._setVerticalNormalizedPosition,this),this._verticalScrollBar=t,this._verticalScrollBar&&this._verticalScrollBar.onValueChange.add(this._setVerticalNormalizedPosition,this)}},horizontalNormalizedPosition:{get:function(){return this._updateBounds(),this._contentRect.width<=this._viewRect.width?this._viewRect.x>this._contentRect.x?1:0:(this._viewRect.x-this._contentRect.x)/(this._contentRect.width-this._viewRect.width)},set:function(t){this.setNormalizedPosition(t,0)}},verticalNormalizedPosition:{get:function(){return this._updateBounds(),this._contentRect.height<=this._viewRect.height?this._viewRect.y>this._contentRect.y?1:0:(this._viewRect.y-this._contentRect.y)/(this._contentRect.height-this._viewRect.height)},set:function(t){this.setNormalizedPosition(t,1)}}}),Pe.prototype.getMeta=function(){var t=s.Serializer,e=s.UIImage.prototype.getMeta.call(this);return e.content=t.NODE,e.canHorizontal=t.BOOLEAN,e.canVertical=t.BOOLEAN,e.movementType=t.NUMBER,e.elasticity=t.NUMBER,e.inertia=t.BOOLEAN,e.decelerationRate=t.NUMBER,e.scrollSensitivity=t.NUMBER,e.horizontalScrollBar=t.NODE,e.verticalScrollBar=t.NODE,e.propagationScroll=t.BOOLEAN,e},Pe.prototype.onDestroy=function(){s.UIImage.prototype.onDestroy.call(this),this.content=null,this.horizontalScrollBar=null,this.verticalScrollBar=null,this.phaser.mask=null},Pe.prototype.update=function(){},Pe.prototype.postUpdate=function(){this._updateVelocity()},Pe.prototype._setHorizontalNormalizedPosition=function(t){this.setNormalizedPosition(t,0)},Pe.prototype._setVerticalNormalizedPosition=function(t){this.setNormalizedPosition(t,1)},Pe.prototype._setContentPosition=function(t,e){this.content.x=t,this.content.y=e},Pe.prototype._calculateOffset=function(t,e){var i=new s.Point(0,0);if(this.movementType===Pe.MOVEMENT_UNRESTRICTED)return i;var r=this.rect,n=this._contentRect,a=new s.Point(n.x,n.y),o=new s.Point(n.x+n.width,n.y+n.height);return this.canHorizontal&&(a.x+=t,o.x+=t,a.x>r.x?i.x=r.x-a.x:o.x<r.x+r.width&&(i.x=r.x+r.width-o.x)),this.canVertical&&(a.y+=e,o.y+=e,a.y>r.y?i.y=r.y-a.y:o.y<r.y+r.height&&(i.y=r.y+r.height-o.y)),i},Pe.prototype._calcVelocityEffect=function(t,e,i,r){if(this.movementType===Pe.MOVEMENT_ELASTIC&&0!==e[r]){var n=this["_lastOffset_"+r]||0;Math.abs(n)<Math.abs(e[r])?(this["_lastOffset_"+r]=e[r],this._currSmoothetTime=i):(this["_lastOffset_"+r]=e[r],this._currSmoothetTime+=i);this.elasticity<=0||this.elasticity;var a=this.game.math.smoothDamp(t[r],t[r]+e[r],this._velocity[r],this.elasticity,Number.MAX_VALUE,i/100);Math.abs(t[r]+e[r]-a[0])<1e-4?(t[r]=t[r]+e[r],this._velocity[r]=0):(t[r]=a[0],this._velocity[r]=a[1])}else if(this.movementType===Pe.MOVEMENT_CLAMPED&&0!==e[r])t[r]=t[r]+e[r];else if(this.inertia){var s=this._velocity[r]*Math.pow(Math.abs(this.decelerationRate),i/1e3);Math.abs(s)<1&&(s=0),this._velocity[r]=s,t[r]=t[r]+s*i/1e3}else this._velocity[r]=0},Pe.prototype._rubberDelta=function(t,e){return(1-1/(.55*Math.abs(t)/e+1))*e*this.game.math.sign(t)},Pe.prototype._updateVelocity=function(){if(this.content){var t=this.game.time.deltaTime,e=this._calculateOffset(0,0),i=new s.Point(this.content.x,this.content.y);if(this._isDragging||0===e.x&&0===e.y&&0===this._velocity.x&&0===this._velocity.y||(this._updateBounds(),this._calcVelocityEffect(i,e,t,"x"),this._calcVelocityEffect(i,e,t,"y"),0===this._velocity.x&&0===this._velocity.y||this.movementType===Pe.MOVEMENT_CLAMPED&&(e=this._calculateOffset(i.x-this.content.x,i.y-this.content.y),i.x+=e.x,i.y+=e.y),this._setContentPosition(i.x,i.y)),this._isDragging&&this.inertia){this._updateBounds();var r=this.content.x-this._preContentPosition.x,n=this.content.y-this._preContentPosition.y,a=this.game.math.clamp(t/1e3,0,1);this._velocity.x=r/a,this._velocity.y=n/a}this._preViewRect&&s.Rectangle.equals(this._viewRect,this._preViewRect)&&this._preContentRect&&s.Rectangle.equals(this._contentRect,this._preContentRect)&&this._preContentPosition&&s.Point.equals(this._preContentPosition,i)||(this._updateScrollBars(e.x,e.y),this.onValueChange.dispatch(new s.Point(this.horizontalNormalizedPosition,this.verticalNormalizedPosition)),this._updatePrevData())}},Pe.prototype.setNormalizedPosition=function(t,e){if(this._updateBounds(),this.content&&this._contentRect){var i=e?"height":"width",r=e?"y":"x",n=this._contentRect[i]-this._viewRect[i],a=this._viewRect[r]-t*n,s=this.content[r]+a-this._contentRect[r],o=this.content[r];Math.abs(o-s)>1&&(this.content[r]=s,this._velocity[r]=0,this._updateBounds())}},Pe.prototype._updatePrevData=function(){this.content?this._preContentPosition=new s.Point(this.content.x,this.content.y):this._preContentPosition=new s.Point(0,0),this._preContentRect=this._contentRect,this._preViewRect=this._viewRect},Pe.prototype._updateScrollBars=function(t,e){if(this.horizontalScrollBar){if(this._contentRect.width>0){var i=(this._viewRect.width-Math.abs(t))/this._contentRect.width;this.horizontalScrollBar.size=o.Math.clamp(i,0,1)}else this.horizontalScrollBar.size=1;this.horizontalScrollBar.value=this.horizontalNormalizedPosition}if(this.verticalScrollBar){if(this._contentRect.height>0){i=(this._viewRect.height-Math.abs(e))/this._contentRect.height;this.verticalScrollBar.size=o.Math.clamp(i,0,1)}else this.verticalScrollBar.size=1;this.verticalScrollBar.value=this.verticalNormalizedPosition}},Pe.prototype._updateBounds=function(){if(this._viewRect=this.rect,this._updateContentBounds(),this.content){var t=this.rect,e=t.width-this._contentRect.width,i=t.height-this._contentRect.height;e>0&&(this._contentRect.width=t.width,this._contentRect.x-=e*this.content.pivotX),i>0&&(this._contentRect.height=t.height,this._contentRect.y-=i*this.content.pivotY)}},Pe.prototype._updateContentBounds=function(){this.content?this._contentRect=s.Bounds.getBox(this.content,s.Bounds.USE_BOUNDS,!1,1,this):this._contentRect=new s.Rectangle(0,0,0,0)},Pe.prototype._doWheel=function(t,e){if(this.content){this._updateBounds();var i=new s.Point(e.source.deltaX,e.source.deltaY);this.canVertical||(i.y=0),this.canHorizontal||(i.x=0);var r=i.x*this.scrollSensitivity,n=i.y*this.scrollSensitivity;this.doScroll(r,n,!1)}},Pe.prototype._doDragStart=function(t,e){e.source.eventId===s.Mouse.BUTTON_LEFT&&(this._updateBounds(),this._contentStartPosition=new s.Point(this.content.x,this.content.y),this._pointerStartCursor=this.toLocal(new s.Point(e.source.startX,e.source.startY)),this._isDragging=!0)},Pe.prototype._doDragEnd=function(t,e){e.source.eventId===s.Mouse.BUTTON_LEFT&&(this._isDragging=!1)},Pe.prototype._doDrag=function(t,e){if(e.source.eventId===s.Mouse.BUTTON_LEFT){this._updateBounds();var i=this.toLocal(new s.Point(e.source.x,e.source.y));if(this._pointerStartCursor){var r=this.canHorizontal?i.x-this._pointerStartCursor.x:0,n=this.canVertical?i.y-this._pointerStartCursor.y:0;this.doScroll(this._contentStartPosition.x+r-this.content.x,this._contentStartPosition.y+n-this.content.y,!0)}}},Pe.prototype.doScroll=function(t,e,i){var r=new s.Point(this.content.x,this.content.y);r.x+=t,r.y+=e;var n=this._calculateOffset(t,e);if(r.x+=n.x,r.y+=n.y,
this.movementType===Pe.MOVEMENT_CLAMPED&&this.propagationScroll){for(var a=this.parent;!(a instanceof Pe)&&a!==this.game.world;)a=a.parent;a instanceof Pe&&a.doScroll(-n.x,-n.y,i)}else this.movementType===Pe.MOVEMENT_ELASTIC&&(i?(0!==n.x&&(r.x=r.x-this._rubberDelta(n.x,this._viewRect.width)),0!==n.y&&(r.y=r.y-this._rubberDelta(n.y,this._viewRect.height))):(r.x-=n.x,r.y-=n.y,Math.abs(n.x)>this._viewRect.width&&(r.x+=n.x-this.game.math.sign(n.x)*this._viewRect.width),Math.abs(n.y)>this._viewRect.height&&(r.y+=n.y-this.game.math.sign(n.y)*this._viewRect.height)));this._setContentPosition(r.x,r.y),i||this._updateBounds()},Pe.MOVEMENT_UNRESTRICTED=0,Pe.MOVEMENT_ELASTIC=1,Pe.MOVEMENT_CLAMPED=2;var Ee=s.ScrollBar=function(t,e,i){s.UIImage.call(this,t,e,i),this.name="ScrollBar",this.autoHide=!1,this._setValue(0,!1),this.onWheel.add(this._doWheel,this),this.onDown.add(this._doDown,this),this.onUp.add(this._doUp,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this)};Ee.prototype=e.create(s.UIImage.prototype),Ee.prototype.constructor=Ee,e.defineProperties(Ee.prototype,{class:{get:function(){return"qc.ScrollBar"}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(t){this._sliders=t,this._updateSliders()}},direction:{get:function(){return this._direction||Ee.LEFT_TO_RIGHT},set:function(t){this._setDirection(t,!1)}},value:{get:function(){return this._value},set:function(t){this._setValue(t,!0)}},size:{get:function(){return this._size},set:function(t){var e=o.Math.clamp(t,0,1);this.visible=!(this.autoHide&&this.game.math.fuzzyEqual(e,1)),this.visible&&!this.fixSlidersSize&&(this._size=e,this._size=Math.max(5/Math.max(this.height,this.width),this._size),this._updateSliders())}},numberOfStep:{get:function(){return this._numberOfStep},set:function(t){this._numberOfStep=t}},onValueChange:{get:function(){return this._onValueChange||(this._onValueChange=new o.Signal),this._onValueChange}},stepSize:{get:function(){return this.numberOfStep>1?1/(this.numberOfStep-1):.1}},fixSlidersSize:{get:function(){return this._fixSlidersSize},set:function(t){this._fixSlidersSize=t}},_axisPos:{get:function(){return this.direction===Ee.LEFT_TO_RIGHT||this.direction===Ee.RIGHT_TO_LEFT?"x":"y"}},_axisSize:{get:function(){return this.direction===Ee.LEFT_TO_RIGHT||this.direction===Ee.RIGHT_TO_LEFT?"width":"height"}},_reverseValue:{get:function(){return this.direction===Ee.RIGHT_TO_LEFT||this.direction===Ee.BOTTOM_TO_TOP}},_slidingRect:{get:function(){return this.sliders&&this.sliders.parent?this.sliders.parent.rect:null}}}),Ee.prototype.getMeta=function(){var t=s.Serializer,e=s.UIImage.prototype.getMeta.call(this);return e.sliders=t.NODE,e.value=t.NUMBER,e.size=t.NUMBER,e.numberOfStep=t.NUMBER,e.direction=t.NUMBER,e.fixSlidersSize=t.BOOLEAN,e.autoHide=t.BOOLEAN,e},Ee.prototype.onDestroy=function(){s.UIImage.prototype.onDestroy.call(this),this.sliders=null},Ee.prototype._setDirection=function(t,e){if(this._direction!==t){var i=this._axisPos;this._reverseValue;if(this._direction=t,e&&i!=this._axisPos){var r=this.width;this.width=this.height,this.height=r}this._updateSliders()}},Ee.prototype._setValue=function(t,e){var i=this._value;this._value=o.Math.clamp(t,0,1),i!==this.value&&(this._updateSliders(),e&&this.onValueChange.dispatch(this.value))},Ee.prototype.postUpdate=function(){this._isMoveNotDragging&&this._doPursued()},Ee.prototype._updateSliders=function(){if(this._slidingRect){var t=new s.Point(0,0),e=new s.Point(1,1),i=this.value*(1-this.size),r=this._axisPos;this._reverseValue?(t[r]=1-i-this.size,e[r]=1-i):(t[r]=i,e[r]=i+this.size),this.sliders.setAnchor(t,e,!1)}},Ee.prototype._getSlidersRectInBar=function(){var t=this.sliders.minAnchor,e=this.sliders.maxAnchor,i=this._slidingRect,r=i.width*t.x,n=i.height*t.y,a=i.width*(e.x-t.x),o=i.height*(e.y-t.y),h=i.width/this.rect.width,l=i.height/this.rect.height;return new s.Rectangle(this.rect.x+r*h,this.rect.y+n*l,a*h,o*l)},Ee.prototype._getSlidersPointInBar=function(t){var e=this.sliders.minAnchor,i=(this.sliders.maxAnchor,this._slidingRect),r=this.sliders.rect.width/i.width,n=this.sliders.rect.height/i.height,a=i.width*e.x+t.x*r,o=i.height*e.y+t.y*n,h=i.width/this.rect.width,l=i.height/this.rect.height;return new s.Point(this.rect.x+a*h,this.rect.y+o*l)},Ee.prototype._doPursued=function(){var t=this._getSlidersRectInBar(),e=this._axisPos,i=this._axisSize;if(this._pursuedPoint>=t[e]&&this._pursuedPoint<=t[e]+t[i])return this._isMoveNotDragging=!1,this._offset=this._pursuedPoint-t[e]-t[i]/2,this._pursuedPoint=0,void(this._pursuedType=0);this._pursuedPoint<t[e]^this._reverseValue?2!==this._pursuedType&&(this.value-=this.stepSize,this._pursuedType=1):1!==this._pursuedType&&(this.value+=this.stepSize,this._pursuedType=2)},Ee.prototype._doDown=function(t,e){if(this.sliders&&e.source.eventId==s.Mouse.BUTTON_LEFT){var i=new s.Point(e.source.x,e.source.y);if(!this.sliders.rectContains(i)){var r=this.toLocal(i);this._isMoveNotDragging=!0,this._pursuedPoint=r[this._axisPos],this._pursuedType=0}}},Ee.prototype._doUp=function(t,e){this._isMoveNotDragging=!1},Ee.prototype._doDragStart=function(t,e){if(this.sliders&&e.source.eventId==s.Mouse.BUTTON_LEFT){this._isMoveNotDragging=!1;var i=new s.Point(e.source.x,e.source.y),r=this.toLocal(i),n=this._getSlidersRectInBar(),a=this._axisPos,o=this._axisSize;this._offset=r[a]-n[a]-n[o]/2}},Ee.prototype._doDragEnd=function(t,e){this._isMoveNotDragging=!1},Ee.prototype._doDrag=function(t,e){if(this.sliders&&e.source.eventId==s.Mouse.BUTTON_LEFT){var i=new s.Point(e.source.x,e.source.y),r=this.toLocal(i),n=this._getSlidersRectInBar(),a=this._axisPos,o=this._axisSize,h=r[a]-this._offset-this.rect[a]-n[o]/2,l=this.rect[o]*(1-this.size);switch(this.direction){case Ee.LEFT_TO_RIGHT:case Ee.TOP_TO_BOTTOM:this._setValue(h/l,!0);break;case Ee.RIGHT_TO_LEFT:case Ee.BOTTOM_TO_TOP:this._setValue(1-h/l,!0)}}},Ee.prototype._doWheel=function(t,e){if(this.sliders){var i=e.source["delta"+this._axisPos.toUpperCase()],r=this.value;r+=(this._reverseValue?-1:1)*Math.sign(i)*this.stepSize,this._setValue(r,!0)}},Ee.LEFT_TO_RIGHT=0,Ee.RIGHT_TO_LEFT=1,Ee.TOP_TO_BOTTOM=2,Ee.BOTTOM_TO_TOP=3;var De=s.ProgressBar=function(t,e,i){s.UIImage.call(this,t,e,i),this.name="ProgressBar",this.style=De.STYLE_HORIZONTAL,this.value=0,this.minValue=0,this.maxValue=1,this.indeterminable=!1,this.loopTime=3e3,this.numberOfStep=0,this.fixedSize=-1,this._canSlideOut=!0,this.clipSliders=!1,this.showMode=De.SHOW_PROCESSED,this.reverse=!1};De.prototype=e.create(s.UIImage.prototype),De.prototype.constructor=De,e.defineProperties(De.prototype,{class:{get:function(){return"qc.ProgressBar"}},style:{get:function(){return this._style},set:function(t){this._setStyle(t)}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(t){this._sliders=t,this._updateSliders()}},indeterminable:{get:function(){return this._indeterminable},set:function(t){this._indeterminable=t}},minValue:{get:function(){return isNaN(this._minValue)||null===this._minValue?0:this._minValue},set:function(t){this.setMinMax(t)}},maxValue:{get:function(){return isNaN(this._maxValue)||null===this._maxValue?1:this._maxValue},set:function(t){this.setMinMax(null,t)}},length:{get:function(){return this.maxValue-this.minValue}},stepValue:{get:function(){var t=this.stepSize;return t>0?this.minValue+Math.round((this.value-this.minValue)/t)*t:this.value},set:function(t){var e=this.stepSize;e>0?this._setValue(this.minValue+Math.round((t-this.minValue)/e)*e,!0):this._setValue(t)}},value:{get:function(){return this._value||0},set:function(t){t!==this._value&&this._setValue(t,!0)}},loopTime:{get:function(){return this._loopTime},set:function(t){this._loopTime=t}},numberOfStep:{get:function(){return this._numberOfStep},set:function(t){this._numberOfStep=t}},stepSize:{get:function(){return this.numberOfStep>1?this.length/(this.numberOfStep-1):this.style===De.STYLE_CIRCLE?this.length/360:this.style===De.STYLE_HORIZONTAL?this.length/(this._slidingRect?this._slidingRect.width:this.width):this.length/(this._slidingRect?this._slidingRect.height:this.height)}},fixedSize:{get:function(){return this._fixedSize},set:function(t){this._fixedSize!==t&&(this._fixedSize=t,this._updateSliders())}},onValueChange:{get:function(){return this._onValueChange||(this._onValueChange=new o.Signal),this._onValueChange}},clipSliders:{get:function(){if(!this.sliders)return!1;var t=this.sliders.getScript(s.NodeMask);return t&&t.enable},set:function(t){this._setClipSliders(t)}},showMode:{get:function(){return this._showMode},set:function(t){this._setShowMode(t)}},reverse:{get:function(){return this._reverse},set:function(t){this._reverse=t,this._updateSliders()}},startRadian:{get:function(){return this._startRadian||0},set:function(t){this.setCircleScope(t)}},endRadian:{get:function(){return this._endRadian||2*Math.PI},set:function(t){this.setCircleScope(null,t)}},startAngle:{get:function(){return 180*this.startRadian/Math.PI},set:function(t){this.setCircleAngle(t)}},endAngle:{get:function(){return 180*this.endRadian/Math.PI},set:function(t){this.setCircleAngle(null,t)}},showRadian:{get:function(){return this.endRadian-this.startRadian}},_slidingRect:{get:function(){return this.sliders&&this.sliders.parent?this.sliders.parent.rect:null}},_axisPos:{get:function(){return this.style===De.STYLE_CIRCLE?"rotation":this.style===De.STYLE_HORIZONTAL?"x":"y"}},_axisSize:{get:function(){return this.style===De.STYLE_CIRCLE?"rotation":this.style===De.STYLE_HORIZONTAL?"width":"height"}}}),De.prototype.getMeta=function(){s.Serializer;var t=s.UIImage.prototype.getMeta.call(this);return t.style=s.Serializer.NUMBER,t.sliders=s.Serializer.NODE,t._minValue=s.Serializer.NUMBER,t._maxValue=s.Serializer.NUMBER,t.value=s.Serializer.NUMBER,t._startRadian=s.Serializer.NUMBER,t._endRadian=s.Serializer.NUMBER,t.indeterminable=s.Serializer.BOOLEAN,t.loopTime=s.Serializer.NUMBER,t.numberOfStep=s.Serializer.NUMBER,t.fixedSize=s.Serializer.NUMBER,t.showMode=s.Serializer.NUMBER,t.reverse=s.Serializer.NUMBER,t},De.prototype.onDestroy=function(){s.UIImage.prototype.onDestroy.call(this),this.sliders=null},De.prototype._resetSliders=function(){if(this.sliders){this.sliders.rotation=0,this.sliders.setAnchor(new s.Point(0,0),new s.Point(1,1),!1);var t=this.sliders.getScript(s.NodeMask);t&&t.setMask(new s.Point(0,0),new s.Point(1,1),0,2*Math.PI)}},De.prototype._setStyle=function(t){this._style!==t&&(this._style=t,this._resetSliders(),this._updateSliders())},De.prototype._setClipSliders=function(t){if(this.clipSliders!==t){if(this.sliders){this._resetSliders();var e=this.sliders.getScript(s.NodeMask);!e&&t&&(e=this.sliders.addScript("qc.NodeMask")),e&&(e.enable=t)}this._updateSliders()}},De.prototype._setShowMode=function(t){this._showMode!==t&&(this._showMode=t,this.sliders&&this._resetSliders(),this._updateSliders())},De.prototype.update=function(){this._indeterminable&&this._processIndeterminable()},De.prototype.setMinMax=function(t,e){if(t=null==t?this.minValue:t,e=null==e?this.maxValue:e,t>=e)throw new Error("Expected:min < max");this._minValue=t,this._maxValue=e,this._setValue(this.value,!0)},De.prototype.setCircleScope=function(t,e){if(t=null==t?this.startRadian:t,e=null==e?this.endRadian:e,t>=e||e>t+2*Math.PI)throw new Error("Expected:start < end and end <= 2*PI + start");this._startRadian=t,this._endRadian=e,this._updateSliders()},De.prototype.setCircleAngle=function(t,e){if(t=null==t?this.startAngle:t,e=null==e?this.endAngle:e,t>=e||e>t+360)throw new Error("Expected:start < end and end <= 360 + start");this._startRadian=t*Math.PI/180,this._endRadian=e*Math.PI/180,this._updateSliders()},De.prototype._setValue=function(t,e){var i=this.stepValue;this._value=o.Math.clamp(t,this.minValue,this.maxValue),i!==this.stepValue&&this._updateSliders(),e&&this.onValueChange.dispatch(this.value)},De.prototype._processIndeterminable=function(){this._loopValue=this._loopValue||this.value,this._loopValue+=this.length*this.game.time.deltaTime/this.loopTime,this._loopValue>this.maxValue+this.stepSize&&(this._loopValue=this.minValue),this.value=this._loopValue},De.prototype._updateSliders=function(){if(this._slidingRect){var t=this.sliders.getScript(s.NodeMask),e=(this.stepValue-this.minValue)/this.length;if(this.reverse&&(e=1-e),this.clipSliders&&t)switch(this.style){case De.STYLE_HORIZONTAL:case De.STYLE_VERTICAL:a=new s.Point(0,0),o=new s.Point(1,1),h=this._axisPos;this.fixedSize>=0?this._canSlideOut?(e*=1+this.fixedSize,o[h]=Math.min(1,e),a[h]=Math.max(0,e-this.fixedSize-1e-5)):(e*=1-this.fixedSize,a[h]=Math.max(0,e),o[h]=Math.min(1,e+this.fixedSize+1e-5)):this.showMode===De.SHOW_PROCESSED?o[h]=Math.min(1,e):a[h]=Math.min(1,e),t.setMask(a,o);break;case De.STYLE_CIRCLE:if(this.fixedSize>=0){var i=this.startRadian+(e-this.fixedSize)*this.showRadian,r=this.startRadian+e*this.showRadian;if(this.showMode===De.SHOW_REMAINED&&this.showRadian===2*Math.PI){var n=r;r=i+2*Math.PI,i=n}t.setMask(null,null,i,r)}else{i=-Math.PI/2+this.startRadian,r=-Math.PI/2+this.endRadian;this.showMode===De.SHOW_PROCESSED?r=i+e*this.showRadian:i+=e*this.showRadian,t.setMask(null,null,i,r)}}else switch(this.style){case De.STYLE_HORIZONTAL:case De.STYLE_VERTICAL:var a=new s.Point(0,0),o=new s.Point(1,1),h=this._axisPos;this.fixedSize>=0?this._canSlideOut?(e*=1+this.fixedSize,o[h]=Math.min(1,e),a[h]=Math.max(0,e-this.fixedSize-1e-5)):(e*=1-this.fixedSize,a[h]=Math.max(0,e),o[h]=Math.min(1,e+this.fixedSize+1e-5)):this.showMode===De.SHOW_PROCESSED?o[h]=Math.max(1e-5,Math.min(1,e)):a[h]=Math.min(.99999,e),this.sliders.setAnchor(a,o,!1);break;case De.STYLE_CIRCLE:this.sliders.rotation=e*this.showRadian+this.startRadian}}},De.STYLE_HORIZONTAL=0,De.STYLE_VERTICAL=1,De.STYLE_CIRCLE=2,De.SHOW_PROCESSED=0,De.SHOW_REMAINED=1;var Ce=s.Slider=function(t,e,r){s.ProgressBar.call(this,t,e,r),this.name="Slider",this.canPursue=!0,this._canSlideOut=!1,this.onWheel.add(this._doWheel,this),this.onDown.add(this._doDown,this),this.onUp.add(this._doUp,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this);var n=r!==i;if(!0!==n){this.state=s.UIState.NORMAL;var a=this.addScript("qc.TransitionBehaviour");a.target=this.sliders,a.transition=s.Transition.TEXTURE_SWAP}};Ce.prototype=e.create(s.ProgressBar.prototype),Ce.prototype.constructor=Ce,e.defineProperties(Ce.prototype,{state:{get:function(){return this._state||s.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this._onStateChange&&this._onStateChange.dispatch())}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(t){this._sliders=t;var e=this.getScript("qc.TransitionBehaviour");e&&(e.target=t||this),this._updateSliders()}},onStateChange:{get:function(){return this._onStateChange||(this._onStateChange=new s.Signal),this._onStateChange}},class:{get:function(){return"qc.Slider"}},canPursue:{get:function(){return this._canPursue},set:function(t){this._canPursue=t}},interactive:{get:function(){return this._interactive},set:function(t){this._interactive=t,this._onInteractive&&this._onInteractive.dispatch(),this.state=this.interactive?s.UIState.NORMAL:s.UIState.DISABLED}}}),Ce.prototype.getMeta=function(){s.Serializer;var t=s.ProgressBar.prototype.getMeta.call(this);return t.canPursue=s.Serializer.BOOLEAN,t},Ce.prototype.update=function(){s.ProgressBar.prototype.update.call(this),this._isMoveNotDragging&&this._canPursue&&this._doPursued()},Ce.prototype._setStyle=function(t){s.ProgressBar.prototype._setStyle.call(this,t),this.fixedSize=t===Ce.STYLE_CIRCLE?0:-1},Ce.prototype._calcPointValue=function(t,e){var i=0,r=this.rect;switch(this.style){case Ce.STYLE_HORIZONTAL:case Ce.STYLE_VERTICAL:i=this.minValue+(t[this._axisPos]-r[this._axisPos])*this.length/r[this._axisSize];break;case Ce.STYLE_CIRCLE:var n=2*Math.PI,a=Math.atan2(t.x-r.centerX,r.centerY-t.y);if(a<0&&(a+=n),e)if(void 0===this._tempDragAngle||null===this._tempDragAngle)this._tempDragAngle=a,this._recordDragAngle=a;else{var s=a-this._tempDragAngle;this._tempDragAngle=a,Math.abs(s)>Math.PI&&(s=o.Math.sign(s)*(n-Math.abs(s))),this._recordDragAngle+=s,a=this._recordDragAngle}i=this.minValue+(a-this.startRadian)*this.length/this.showRadian}return this.reverse&&(i=this.maxValue-i+this.minValue),i},Ce.prototype._doWheel=function(t,e){if(this.sliders){var i=Math.abs(e.source.deltaX)>=Math.abs(e.source.deltaY)?e.source.deltaX:e.source.deltaY,r=this.value;r+=(this.reverse?-1:1)*Math.sign(i)*this.stepSize,this.value=r}},Ce.prototype._doDown=function(t,e){if(this.sliders&&e.source.eventId==s.Mouse.BUTTON_LEFT){this.state=s.UIState.PRESSED,this._tempDragAngle=null,this._recordDragAngle=null;var i=new s.Point(e.source.x,e.source.y);if(!this.sliders.rectContains(i)||this.fixedSize<0){var r=this.toLocal(i);this._isMoveNotDragging=!0,this._pursuedPoint=this._calcPointValue(r),this._pursuedType=0}}},Ce.prototype._doUp=function(t,e){this._isMoveNotDragging=!1,this.state===s.UIState.PRESSED&&(this.state=s.UIState.NORMAL)},Ce.prototype._doDragStart=function(t,e){if(this.sliders&&e.source.eventId==s.Mouse.BUTTON_LEFT){this.state=s.UIState.PRESSED,this._isMoveNotDragging=!1;var i=new s.Point(e.source.x,e.source.y),r=this.toLocal(i);this._offset=this._calcPointValue(r,!0)-this.value}},Ce.prototype._doDragEnd=function(t,e){this._isMoveNotDragging=!1,this._tempDragAngle=null,this._recordDragAngle=null,this.state===s.UIState.PRESSED&&(this.state=s.UIState.NORMAL)},Ce.prototype._doDrag=function(t,e){if(this.sliders&&e.source.eventId==s.Mouse.BUTTON_LEFT){var i=new s.Point(e.source.x,e.source.y),r=this.toLocal(i),n=this._calcPointValue(r,!0)-this._offset;this._setValue(n,!0)}},Ce.prototype._doPursued=function(){for(var t=this.stepSize,e=Math.max(1,Math.ceil(this.length/10/t));e--;){if(this._pursuedPoint>=this.value&&this._pursuedPoint<=this.value+t)return this._isMoveNotDragging=!1,this._offset=this._pursuedPoint-this.value,this._pursuedPoint=0,void(this._pursuedType=0);this._pursuedPoint<this.value^this.reverse?2!==this._pursuedType&&(this.value-=t,this._pursuedType=1):1!==this._pursuedType&&(this.value+=t,this._pursuedType=2)}},Ce.STYLE_HORIZONTAL=s.ProgressBar.STYLE_HORIZONTAL,Ce.STYLE_VERTICAL=s.ProgressBar.STYLE_VERTICAL,Ce.STYLE_CIRCLE=s.ProgressBar.STYLE_CIRCLE,Ce.SHOW_PROCESSED=s.ProgressBar.SHOW_PROCESSED,Ce.SHOW_REMAINED=s.ProgressBar.SHOW_REMAINED;var Oe=s.InputField=function(e,r,n){var a=this;s.UIImage.call(a,e,r,n),a.name="InputField",a.onStateChange=new s.Signal,a.onValueChange=new s.Signal,a.interactive=!0;var o=a.div=document.createElement("div");if(!t.__wx){var h=o.style;h.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null),h.position="absolute",h.padding=0,h.margin=0,h.border=0,h.outline=0,h.background="none",a.game.world.frontDomRoot.appendChild(o)}var l=n!==i;if(!0!==l){var u=a.textComponent=e.add.text(a);u.text="",u.name="Text",u.setAnchor(new s.Point(0,0),new s.Point(1,1)),u.left=5,u.right=5,u.top=5,u.bottom=5,u.interactive=!1,u.color=vt.black,u.alignV=xe.MIDDLE,u.alignH=xe.LEFT;var c=a.placeholder=e.add.text(a);c.text="Enter text...",c.name="Placeholder",c.setAnchor(new s.Point(0,0),new s.Point(1,1)),c.left=5,c.right=5,c.top=5,c.bottom=5,c.interactive=!1,c.color=vt.grey,c.alignV=xe.MIDDLE,c.alignH=xe.LEFT,this.state=s.UIState.NORMAL;var p=this.addScript("qc.TransitionBehaviour");p.target=this}var d=function(t){t.preventDefault(),a.state!==s.UIState.DISABLED&&a.startEditing()};o.addEventListener("mouseup",d,!1),o.addEventListener("touchend",d,!1),this.onDown.add(function(){a.state!==s.UIState.DISABLED&&(a.state=s.UIState.PRESSED)}),this.onUp.add(function(e,i){a.state===s.UIState.PRESSED&&(a.state=s.UIState.NORMAL),t.__wx&&a.state!==s.UIState.DISABLED&&a.startEditing()}),a.phaser.worldTransformChangedCallback=a._updateNativeDiv.bind(a),a.phaser.worldTransformChangedContext=a,this.text="",this.width=120,this.height=30,this._checkVisibility()};Oe.SINGLE_LINE=0,Oe.MULTI_LINE=1,Oe.STANDARD=0,Oe.INT=1,Oe.NUMBER=2,Oe.TEL=3,Oe.EMAIL=4,Oe.PASSWORD=5,Oe.prototype=e.create(s.UIImage.prototype),Oe.prototype.constructor=Oe,Oe.prototype._characterLimit=-1,Oe.prototype._lineType=Oe.SINGLE_LINE,Oe.prototype._contentType=Oe.STANDARD,Oe.prototype._input=null,Oe.prototype._password="",Oe.prototype.textComponent=null,Oe.prototype.placeholder=null,e.defineProperties(Oe.prototype,{class:{get:function(){return"qc.InputField"}},state:{get:function(){return this._state||s.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},lineType:{get:function(){return this._lineType},set:function(t){this._lineType=t}},contentType:{get:function(){return this._contentType},set:function(t){this._contentType!==t&&(this._contentType=t,this.text=this.text)}},textComponent:{get:function(){return this._textComponent&&this._textComponent._destroy&&(this._textComponent=null),this._textComponent},set:function(t){this._textComponent=t}},placeholder:{get:function(){return this._placeholder&&this._placeholder._destroy&&(this._placeholder=null),this._placeholder},set:function(t){this._placeholder=t}},placeholderText:{get:function(){var t=this.placeholder;return t?t.text:""},set:function(t){var e=this.placeholder;e&&(e.text=t)}},text:{get:function(){var t=this.textComponent;return t?this._contentType===Oe.PASSWORD?this._password:this.textComponent.text:""},set:function(t){if(this.textComponent&&(t=this.toValidateText(t),t!==this.text)){if(this._contentType===Oe.PASSWORD){this._password=t;for(var e="",i=0;i<t.length;i++)e+="·";this.textComponent.text=e}else this.textComponent.text=t;this.onValueChange.dispatch(t)}}},characterLimit:{get:function(){return t.__wx&&-1===this._characterLimit?99999:this._characterLimit},set:function(t){this.characterLimit!==t&&(this._characterLimit=t,this.text=this.text)}},overflow:{get:function(){return!!this.textComponent&&this.textComponent.overflow},set:function(t){this.textComponent&&(this.textComponent.overflow=t)}},isFocused:{get:function(){return!!this.getInput()},set:function(t){t?this.startEditing():this.stopEditing()}}}),Oe.prototype.getMeta=function(){var t=s.Serializer,e=s.UIImage.prototype.getMeta.call(this);return e.lineType=t.NUMBER,e.contentType=t.NUMBER,e.placeholder=t.NODE,e.textComponent=t.NODE,e.text=t.STRING,e.overflow=t.BOOLEAN,e.state=t.NUMBER,e._password=t.STRING,e.characterLimit=t.NUMBER,e},Oe.prototype.update=function(){var t=this.getInput(),e=this.textComponent,i=this.placeholder,r=e.textPhaser.renderable;t?(e&&(e.textPhaser.renderable=!1),i&&(i.textPhaser.renderable=!1),this._updateInput(t)):(e&&(e.textPhaser.renderable=!0),i&&(i.textPhaser.renderable=""===this.text)),e.textPhaser.renderable!==r&&(e.textPhaser.displayChanged(e.textPhaser.renderable?s.DisplayChangeStatus.SHOW:s.DisplayChangeStatus.HIDE),this.phaser.displayChanged(e.textPhaser.renderable?s.DisplayChangeStatus.SHOW:s.DisplayChangeStatus.HIDE))},Oe.prototype.toValidateText=function(t){switch(t=t||"",this.contentType){case Oe.INT:t=t.replace(/[^\d\-]/g,"");break;case Oe.NUMBER:t=t.replace(/[^\d\.\-]/g,"");break;case Oe.EMAIL:t=t.replace(/[^\w0-9\@\.]/g,"");break;case Oe.TEL:t=t.replace(/[^\d\(\)\+\-\s]/g,"")}return this.characterLimit>0&&t.length>this.characterLimit&&(t=t.substr(0,this.characterLimit)),t},Oe.prototype.startEditing=function(){var e=this,i=e.textComponent;if(i){var r=this._input;if(!r)if(t.__wx){var n={defaultValue:e.text,maxLength:e.characterLimit,multiple:e.lineType===Oe.MULTI_LINE,confirmHold:!0,confirmType:"done",success:function(){e._input={value:e.text,_lastValue:e.text};var t=function(t){e._input._lastValue=e._input.value,e._input.value=t.value},i=function(t){e._input._lastValue=e._input.value,e._input.value=t.value,e.stopEditing()},r=function(t){e.cancelEditing()};wx.onKeyboardConfirm(i),wx.onKeyboardInput(t),wx.onKeyboardComplete(r)},fail:function(t){e.game.log.trace("showKeyboard fail : {0}",JSON.stringify(t))}};wx.showKeyboard(n)}else{if(this.lineType===Oe.MULTI_LINE)r=e._input=document.createElement("textarea"),r.onkeydown=function(t){nt.ESC===t.keyCode&&e.cancelEditing()};else{switch(r=e._input=document.createElement("input"),r.onkeydown=function(t){nt.ENTER===t.keyCode?e.stopEditing():nt.ESC===t.keyCode&&e.cancelEditing()},e.contentType){case Oe.PASSWORD:r.type="password";break;case Oe.EMAIL:r.type="email";break;case Oe.TEL:r.type="tel";break;case Oe.INT:case Oe.NUMBER:r.type="number";break;default:r.type="text"}switch(i.alignH){case xe.LEFT:r.style.textAlign="left";break;case xe.RIGHT:r.style.textAlign="right";break;default:r.style.textAlign="center"}switch(i.alignV){case xe.TOP:r.style.verticalAlign="top";break;case xe.BOTTOM:r.style.verticalAlign="bottom";break;default:r.style.verticalAlign="middle"}}this.characterLimit>0&&r.setAttribute("maxlength",this.characterLimit),r._qc=e,r.value=e.text;var a=r.style;a.position="absolute",a.padding=0,a.margin=0,a.border=0,a.outline=0,a.background="none",r.onblur=function(t){e.stopEditing()},r._handleClick=function(t){t.target!==e.div&&t.target!==r&&e.stopEditing()};var s=e.game.world.frontDomRoot;s.addEventListener("mousedown",r._handleClick,!1),s.addEventListener("touchstart",r._handleClick,!1),e.game.input._inputting++;var o=document.createElement("div");o.style.width=this.game.canvas.style.width,o.style.height=this.game.canvas.style.height,o.style.position="absolute",o.style.overflow="hidden",o.appendChild(r),s.appendChild(o),e._updateInput(r),r.focus(),e._updateNativeInput(),i.phaser.worldTransformChangedCallback=this._updateNativeInput.bind(e),i.phaser.worldTransformChangedContext=i}}},Oe.prototype._updateInput=function(e){var i=this.game.time.now;if(!(e._lastUpdate&&i-e._lastUpdate<100)){if(e._lastUpdate=i,!t.__wx){var r=this.textComponent;r.textPhaser instanceof o.Text&&(e.style.font=r.textPhaser.style.font),e.style.fontSize=r.fontSize+"px",e.style.color=r.color.toString()}e._lastValue!==e.value&&(e._lastValue=e.value,this.text=e.value)}},Oe.prototype.getInput=function(){return this._input&&!this.textComponent&&this.cancelEditing(),this._input},Oe.prototype.cancelEditing=function(){var e=this._input;if(e)if(t.__wx)this._input=null,wx.hideKeyboard(),wx.offKeyboardConfirm(),wx.offKeyboardInput(),wx.offKeyboardComplete();else{this._input=null,this.game.input._inputting--;var i=this.game.world.frontDomRoot;i.removeEventListener("mousedown",e._handleClick,!1),i.removeEventListener("touchstart",e._handleClick,!1),s.Util.removeHTML(e.parentNode)}},Oe.prototype.stopEditing=function(){var t=this.getInput();t&&(this.text=t.value,this.cancelEditing())},Oe.prototype.onDestroy=function(){this.cancelEditing(),s.Util.removeHTML(this.div),s.UIImage.prototype.onDestroy.call(this)},Oe.prototype._dispatchAwake=function(){F.prototype._dispatchAwake.call(this),this._checkVisibility()},Oe.prototype.onVisibleChange=function(){this._checkVisibility()},Oe.prototype._checkVisibility=function(){var t=this.isWorldVisible();this.div.style.display=t?"block":"none",t||this.stopEditing()},Oe.prototype._updateNativeDiv=function(){var t=this,e=t.div;e._lastUpdate=t.game.time.now,s.Util.updateTransform(t,e)},Oe.prototype._updateNativeInput=function(){var t=this,e=t.getInput();e&&s.Util.updateTransform(t.textComponent,e)};var Me=s.Tilemap=function(t,e,i){s.Node.call(this,new o.Group(t.phaser,null),e,i),this.name="Tilemap",this._copyCanvas=o.Canvas.create(1,1),this._copyContext=this._copyCanvas.getContext("2d")};Me.prototype=e.create(s.Node.prototype),Me.prototype.constructor=Me,Me.prototype._data=null,Me.prototype._scrollX=0,Me.prototype._scrollY=0,Me.prototype._layers=0,Me.prototype._tilesets=0,Me.prototype.getMeta=function(){var t=s.Node.prototype.getMeta.call(this);return t.data=j.TEXTASSET,t.scrollX=j.NUMBER,t.scrollY=j.NUMBER,t.layers=j.NODES,t.tilesets=j.TEXTURES,t},Me.prototype.generateLayers=function(t){var e=this,i=e.data;if(i){for(var r=e.game,n=e._dataInfo,a=n.json,o=a.tilesets,h=[],l=0;l<o.length;l++)h.push({key:o[l].name,url:n.prefix+o[l].name+".bin"});r.assets.loadBatch(h,function(){for(var i=[],n=0;n<h.length;n++)i.push(new s.Texture(h[n].asset));e.tilesets=i,e.removeChildren();var o=[];for(n=0;n<a.layers.length;n++){var l=a.layers[n];if("tilelayer"===l.type){var u=new Ie(r,e);u.name=l.name,u.tilemap=e,u.layerIndex=n,o.push(u)}else if("objectgroup"===l.type){var c=new Re(r,e);c.name=l.name,c.tilemap=e,c.layerIndex=n,o.push(c)}}e.layers=o,t&&t()})}},Me.prototype.getLayerByIndex=function(t){var e=this._layers;return e&&t>=0&&t<e.length?e[t]:null},Me.prototype.getLayerByName=function(t){var e=this._layers;if(e)for(var i=0;i<e.length;i++)if(e[i].name===t)return e[i];return null},Me.prototype._getLayerJson=function(t,e){if(this._dataInfo){var i=this._dataInfo.json.layers;if(t>=0&&t<i.length){var r=i[t];if(r.type===e)return r}return null}},Me.prototype.resetNativeSize=function(){var t=this.nativeSize;t&&(this.width=t.width,this.height=t.height)},Me.prototype.getTilePosition=function(t,e){return new s.Point(Math.floor(t/this.tileWidth),Math.floor(e/this.tileHeight))},e.defineProperties(Me.prototype,{nativeSize:{get:function(){var t=this._dataInfo;return t?new s.Rectangle(0,0,t.map.widthInPixels,t.map.heightInPixels):null}},layers:{get:function(){return this._layers},set:function(t){this._layers=t}},tilesets:{get:function(){return this._tilesets},set:function(t){this._tilesets=t}},scrollX:{get:function(){return this._scrollX},set:function(t){this._scrollX=t}},scrollY:{get:function(){return this._scrollY},set:function(t){this._scrollY=t}},tileWidth:{get:function(){return this._dataInfo.json.tilewidth}},tileHeight:{get:function(){return this._dataInfo.json.tileheight}},mapWidth:{get:function(){return this._dataInfo.json.width}},mapHeight:{get:function(){return this._dataInfo.json.height}},data:{get:function(){return this._data},set:function(t){var e=this,i=e.game,r=null;if(t){if(!(t instanceof A))return;try{var n=JSON.parse(t.text);if(!n.layers||!n.tilesets)throw new Error("Invalid tilemap data format");i.phaser.load.tilemap(t.url,null,n,o.Tilemap.TILED_JSON);for(var a=i.phaser.add.tilemap(t.url),h=0,l=0,u=0;u<a.tilesets.length;u++)h=Math.max(h,a.tilesets[u].tileWidth),l=Math.max(l,a.tilesets[u].tileHeight);a.maxTileWidth=h,a.maxTileHeight=l;var c=t.url.lastIndexOf("/");r={json:n,map:a,prefix:c>=0?t.url.substring(0,c+1):""}}catch(e){return i.log.error("Asset{0}/{1} Parse fail",t.key,t.url,e),void s.Util.popupError(e.message)}}e._data=t,e._dataInfo=r}},class:{get:function(){return"qc.Tilemap"}}});var Ie=s.TileLayer=function(t,e,i){var r=this,n=new o.Sprite(t.phaser);s.Node.call(r,n,e,i),r.name="TileLayer",r._cache={},r._dirtyTiles=null,n.canvas=o.Canvas.create(1,1),n.context=n.canvas.getContext("2d"),n.baseTexture=new h.BaseTexture(n.canvas),n.texture=new h.Texture(n.baseTexture),r.setAnchor(new s.Point(0,0),new s.Point(1,1)),r.setStretch(0,0,0,0);var a=n._renderCanvas,l=n._renderWebGL;n._renderCanvas=function(){r._renderTiles(),a.apply(n,arguments)},n._renderWebGL=function(){r._renderTiles(),l.apply(n,arguments)}};Ie.prototype=e.create(s.Node.prototype),Ie.prototype.constructor=Ie,Ie.prototype._tilemap=null,Ie.prototype._layerIndex=-1,Ie.prototype._scrollXRatio=1,Ie.prototype._scrollYRatio=1,Ie.prototype.getMeta=function(){var t=s.Node.prototype.getMeta.call(this);return t.tilemap=j.NODE,t.layerIndex=j.INT,t.scrollXRatio=j.NUMBER,t.scrollYRatio=j.NUMBER,t},Ie.prototype.getTile=function(t,e){var r=this._cache,n=this.tilemap;if(!n)return i;var a=r.phaserLayer;if(!a||r.tilemap!==n||r.layerIndex!==this.layerIndex){a=null;var s=n._getLayerJson(this.layerIndex,"tilelayer");if(s){var o=n._dataInfo.map,h=o.getLayerIndex(s.name);h>=0&&(a=o.layers[h])}}return a&&a.data&&a.data[e]?a.data[e][t]:i},Ie.prototype.getTileIndex=function(t,e){var i=this.getTile(t,e);return i?i.index:1/0},Ie.prototype.setTileIndex=function(t,e,i){var r=this.getTile(t,e);r&&r.index!==i&&(r.index=i,
this._dirtyTiles||(this._dirtyTiles={}),this._dirtyTiles[t+"|"+e]={x:t,y:e})},Ie.prototype.redrawAll=function(){this._redrawAllFlag=!0},Ie.prototype._renderTiles=function(){var t=this,e=t.tilemap;if(e){var i=t._cache,r=t.phaser,n=e._dataInfo.map,a=t._checkTileLayerChange(n),h=i.phaserLayer;if(h){t._redrawAllFlag&&(a=!0,t._redrawAllFlag=!1);var l=r.context,u=h.data,c=Math.round(t.width),p=Math.round(t.height),d=e.scrollX,f=e.scrollY,_=t.scrollXRatio,g=t.scrollYRatio;a=t._checkSizeChange(c,p)||a;var m=!1;if(a||i.scrollX!==d||i.scrollY!==f||i.scrollXRatio!==_||i.scrollYRatio!==g){var y=Math.round(d*_),v=Math.round(f*g),T=i.viewRect,x=new o.Rectangle(-y,-v,c,p);if(!a){var b=o.Rectangle.intersection(T,x);if(b.width>10&&b.height>10){var A=b.x-T.x,S=b.y-T.y,w=b.width,P=b.height;e._copyCanvas.width!==c&&(e._copyCanvas.width=c),e._copyCanvas.height!==p&&(e._copyCanvas.height=p),e._copyContext.clearRect(A,S,w,P),e._copyContext.drawImage(r.canvas,A,S,w,P,A,S,w,P)}else a=!0}l.clearRect(0,0,c,p),l.translate(y,v),a?(t._dirtyTiles=null,t._drawRect(l,n,u,-y,-v,c,p)):(l.drawImage(e._copyCanvas,A,S,w,P,b.x,b.y,w,P),x.contains(T.left,T.top)?(t._drawRect(l,n,u,x.x,x.y,b.x-x.x,x.height),t._drawRect(l,n,u,b.x,x.y,x.right-b.x,b.y-x.y)):x.contains(T.right,T.top)?(t._drawRect(l,n,u,x.x,x.y,b.right-x.x,b.y-x.y),t._drawRect(l,n,u,b.right,x.y,x.right-b.right,x.height)):x.contains(T.left,T.bottom)?(t._drawRect(l,n,u,x.x,x.y,b.x-x.x,x.height),t._drawRect(l,n,u,b.x,b.bottom,x.right-b.x,x.bottom-b.bottom)):x.contains(T.right,T.bottom)&&(t._drawRect(l,n,u,x.x,b.bottom,b.right-x.x,x.bottom-b.bottom),t._drawRect(l,n,u,b.right,x.y,x.right-b.right,x.height))),l.translate(-y,-v),m=!0,i.scrollX=d,i.scrollY=f,i.scrollXRatio=_,i.scrollYRatio=g,i.viewRect=x}var E=t._renderDirtyTiles(l,n,u);(m||E)&&(r.texture.baseTexture.dirty(),r.displayChanged(s.DisplayChangeStatus.TEXTURE))}}},Ie.prototype._renderDirtyTiles=function(t,e,i){var r=this,n=!1;if(r._dirtyTiles){var a=e.maxTileWidth,s=e.maxTileHeight,o=e.tileWidth,h=e.tileHeight,l=r._cache.viewRect,u=a>o?-a:0,c=s>h?s:0,p=Math.floor((l.x+u)/o),d=Math.floor(l.y/h),f=Math.ceil((l.x+l.width)/o),_=Math.ceil((l.y+l.height+c)/h);for(var g in t.translate(-l.x,-l.y),r._dirtyTiles){var m=r._dirtyTiles[g],y=m.x,v=m.y;y>=p&&y<=f&&v>=d&&v<=_&&(r._drawRect(t,e,i,y*o,v*h+h-s,a,s,!0),n=!0)}t.translate(l.x,l.y),r._dirtyTiles=null}return n},Ie.prototype._checkTileLayerChange=function(t){var e=this._cache,i=this.tilemap,r=this.layerIndex;if(e.tilemap!==i||e.layerIndex!==r){e.phaserLayer=null;var n=i._getLayerJson(r,"tilelayer");if(n){var a=t.getLayerIndex(n.name);a>=0&&(e.phaserLayer=t.layers[a])}return e.tilemap=i,e.layerIndex=r,!0}return!1},Ie.prototype._checkSizeChange=function(t,e){var i=this._cache,r=this.phaser,n=r.texture;return(i.width!==t||i.height!==e)&&(r.canvas.width=t,r.canvas.height=e,n.frame.width=t,n.frame.height=e,n.width=t,n.height=e,n.crop.width=t,n.crop.height=e,n.baseTexture.width=t,n.baseTexture.height=e,n.baseTexture.dirty(),i.width=t,i.height=e,!0)},Ie.prototype._drawRect=function(t,e,i,r,n,a,s,o){if(a&&s){o&&t.clearRect(r,n,a,s),t.save(),t.beginPath(),t.rect(r,n,a,s),t.clip();var h=e.maxTileWidth,l=e.maxTileHeight,u=e.tileWidth,c=e.tileHeight,p=Math.floor((h>u?r-h:r)/u),d=Math.floor(n/c),f=Math.ceil((r+a)/u),_=Math.ceil((l>c?n+s+l:n+s)/c);for(p<0&&(p=0),d<0&&(d=0),f>e.width&&(f=e.width),_>e.height&&(_=e.height),n=d;n<_;n++){var g=i[n];for(r=p;r<f;r++)this._drawTile(t,e,g[r],r,n)}t.restore()}},Ie.prototype._drawTile=function(t,e,r,n,a){var s=r.index;if(!(s<=0)){var o=e.tiles[s],h=e.tilesets[o[2]],l=h.asset;if(l===i){var u=this.tilemap._dataInfo.prefix+h.name+".bin",c=this.tilemap.tilesets;if(c)for(var p=0;p<c.length;p++)if(c[p].atlas.url===u){l=c[p];break}h.asset=l||null}l&&t.drawImage(l.atlas.img,o[0],o[1],h.tileWidth,h.tileHeight,r.worldX,r.worldY+e.tileHeight-h.tileHeight,h.tileWidth,h.tileHeight)}},e.defineProperties(Ie.prototype,{tilemap:{get:function(){return this._tilemap&&this._tilemap._destroy&&(this._tilemap=null),this._tilemap},set:function(t){(!t||t instanceof Me)&&(this._tilemap=t)}},layerIndex:{get:function(){return this._layerIndex},set:function(t){this._layerIndex=t}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(t){this._scrollXRatio=t}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(t){this._scrollYRatio=t}},class:{get:function(){return"qc.TileLayer"}}});var Re=s.ObjectLayer=function(t,e,i){s.Node.call(this,new o.Group(t.phaser,null),e,i),this.name="ObjectLayer",this.setAnchor(new s.Point(0,0),new s.Point(1,1)),this.setStretch(0,0,0,0)};Re.prototype=e.create(s.Node.prototype),Re.prototype.constructor=Re,Re.prototype._tilemap=null,Re.prototype._layerIndex=-1,Re.prototype._scrollXRatio=1,Re.prototype._scrollYRatio=1,Re.prototype.getMeta=function(){var t=s.Node.prototype.getMeta.call(this);return t.tilemap=j.NODE,t.layerIndex=j.INT,t.scrollXRatio=j.NUMBER,t.scrollYRatio=j.NUMBER,t},Re.prototype.update=function(){this._tilemap&&this._tilemap._destroy&&(this._tilemap=null);var t=this._tilemap;t&&(this.x=t.scrollX*this.scrollXRatio,this.y=t.scrollY*this.scrollXRatio)},e.defineProperties(Re.prototype,{tilemap:{get:function(){return this._tilemap&&this._tilemap._destroy&&(this._tilemap=null),this._tilemap},set:function(t){(!t||t instanceof Me)&&(this._tilemap=t)}},layerIndex:{get:function(){return this._layerIndex},set:function(t){this._layerIndex=t}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(t){this._scrollXRatio=t}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(t){this._scrollYRatio=t}},class:{get:function(){return"qc.ObjectLayer"}}});var Ne=s.Dom=function(t,e,i){var r=this;r.game=t,s.Node.call(this,new o.Group(this.game.phaser,null),e,i),r.name="dom";var n=r.div=document.createElement("div");n.style.position="absolute",n.setAttribute("id",r.uuid),n._qc=r,r.overflow="hidden",r.serializable=!0,r.phaser.worldTransformChangedCallback=r._updateDomTransform,r.phaser.worldTransformChangedContext=r,r.pos=Ne.POS_FRONT,r._updateDomTransform(),r.game.device.android&&(r.game.timer.add(1,function(){r._destroy||(r.rotation+=.001)}),r.game.timer.add(40,function(){r._destroy||(r.rotation-=.002)}),r.game.timer.add(300,function(){r._destroy||(r.rotation+=5e-4)}),r.game.timer.add(1e3,function(){r._destroy||(r.rotation+=5e-4)}))};Ne.prototype=e.create(s.Node.prototype),Ne.prototype.constructor=Ne,Ne.POS_NONE=-1,Ne.POS_BACK=0,Ne.POS_FRONT=1,e.defineProperties(Ne.prototype,{class:{get:function(){return"qc.Dom"}},pos:{get:function(){return this._pos},set:function(t){this.pos!==t&&(this._pos=t,this.div.parentNode&&this.div.parentNode.removeChild(this.div),t===Ne.POS_BACK?(this.game.world.backDomRoot.appendChild(this.div),this.zIndex>=0&&(this.zIndex=-1)):t===Ne.POS_FRONT&&(this.game.world.frontDomRoot.appendChild(this.div),this.zIndex<=0&&(this.zIndex=1)))}},zIndex:{get:function(){return this.div.style.zIndex||0},set:function(t){t!==this.div.style.zIndex&&(this._pos===Ne.POS_BACK&&t>=0?t=-1:this._pos===Ne.POS_FRONT&&t<=0&&(t=1),this.div.style.zIndex=t)}},innerHTML:{get:function(){return this.div.innerHTML},set:function(t){this.div.innerHTML=t}},className:{get:function(){return this.div.className},set:function(t){this.div.className=t}},overflow:{get:function(){return this._overflow},set:function(t){t!==this._overflow&&(this._overflow=t,this.div.style.overflow=t)}},alpha:{get:function(){var t=this.div,e=t.style.opacity;return e?1*e:1},set:function(t){var e=this,i=e.div;t!==i.alpha&&(i.style.filter="alpha(opacity:"+100*t+")",i.style.opacity=t)}}}),Ne.prototype._dispatchAwake=function(){F.prototype._dispatchAwake.call(this),this._updateDomTransform()},Ne.prototype.onVisibleChange=function(){this._updateDomTransform()},Ne.prototype.onRemoveFromWorld=function(){this.div&&this.div.parentNode&&this.div.parentNode.removeChild(this.div)},Ne.prototype.onAddToWorld=function(){if(this.div&&!this.div.parentNode){var t=this.pos;t===Ne.POS_BACK?(this.game.world.backDomRoot.appendChild(this.div),this.zIndex>=0&&(this.zIndex=-1)):t===Ne.POS_FRONT&&(this.game.world.frontDomRoot.appendChild(this.div),this.zIndex<=0&&(this.zIndex=1))}},Ne.prototype.onDestroy=function(){this.div._qc=null,this.div.parentNode&&this.div.parentNode.removeChild(this.div),s.Node.prototype.onDestroy.call(this)},Ne.prototype.getMeta=function(){var t=this,e=s.Serializer,r=s.Node.prototype.getMeta.call(this);return r.pos=e.NUMBER,r.className=e.STRING,r.overflow=e.STRING,r.innerHTML={get:function(t,e){return t.serializable?[!0,t.innerHTML]:i},set:function(e,i){i?(t.serializable=!0,t.innerHTML=i[1]):(t.serializable=!1,t.innerHTML="")}},r.zIndex=e.INT,r},Ne.prototype._updateDomTransform=function(){s.Util.updateTransform(this,this.div),this.div.style.display=this.isWorldVisible()?"block":"none"};var Be=s.Graphics=function(t,e,i){var r=this;r.game=t,s.Node.call(this,new o.Graphics(this.game.phaser),e,i),r.name="graphics"};Be.prototype=e.create(s.Node.prototype),Be.prototype.constructor=Be,e.defineProperties(Be.prototype,{class:{get:function(){return"qc.Graphics"}},fillAlpha:{get:function(){return this.phaser.fillAlpha},set:function(t){this.phaser.fillAlpha=t}},lineWidth:{get:function(){return this.phaser.lineWidth},set:function(t){this.phaser.lineWidth=t}},lineColor:{get:function(){return this.phaser.lineColor},set:function(t){this.phaser.lineColor=t}},blendMode:{get:function(){return this.phaser.blendMode},set:function(t){this.phaser.blendMode=t}},boundsPadding:{get:function(){return this.phaser.boundsPadding},set:function(t){this.phaser.boundsPadding=t}}}),Be.prototype.getMeta=function(){s.Serializer;var t=s.Node.prototype.getMeta.call(this);return t},Be.prototype.drawTriangle=function(t,e){return this.phaser.drawTriangle(t,e)},Be.prototype.drawTriangles=function(t,e,i){return this.phaser.drawTriangles(t,e,i)},Be.prototype.lineStyle=function(t,e,i){return this.phaser.lineStyle(t,e,i)},Be.prototype.moveTo=function(t,e){return this.phaser.moveTo(t,e)},Be.prototype.lineTo=function(t,e){return this.phaser.lineTo(t,e)},Be.prototype.quadraticCurveTo=function(t,e,i,r){return this.quadraticCurveTo(t,e,i,r)},Be.prototype.bezierCurveTo=function(t,e,i,r,n,a){return this.phaser.bezierCurveTo(t,e,i,r,n,a)},Be.prototype.arcTo=function(t,e,i,r,n){return this.phaser.arcTo(t,e,i,r,n)},Be.prototype.arc=function(t,e,i,r,n,a){return this.phaser.arc(t,e,i,r,n,a)},Be.prototype.beginFill=function(t,e){return this.phaser.beginFill(t,e)},Be.prototype.endFill=function(){return this.phaser.endFill()},Be.prototype.drawRect=function(t,e,i,r){return this.phaser.drawRect(t,e,i,r)},Be.prototype.drawRoundedRect=function(t,e,i,r,n){return this.phaser.drawRoundedRect(t,e,i,r,n)},Be.prototype.drawCircle=function(t,e,i){return this.phaser.drawCircle(t,e,i)},Be.prototype.drawEllipse=function(t,e,i,r){return this.phaser.drawEllipse(t,e,i,r)},Be.prototype.drawPolygon=function(t){return this.phaser.drawPolygon(t)},Be.prototype.clear=function(){return this.phaser.clear()},Be.prototype.generateTexture=function(t,e){return this.phaser.generateTexture(t,e)},Be.prototype.containsPoint=function(t){return this.phaser.containsPoint(t)},Be.prototype.drawShape=function(t){return this.phaser.drawShape(t)};var Le=s.Dropdown=function(t,e,r){var n=this;s.UIImage.call(n,t,e,r),n.onStateChange=new s.Signal,n.onValueChange=new s.Signal,n.captionImage=null,n.captionText=null,n.item=null,n.options=[],n.template=null;var a=r!==i;if(n.name="Dropdown",n.interactive=!0,n._items=[],n._value=-1,!0!==a){n.captionText=t.add.text(n),n.captionText.name="Label",n.captionImage=t.add.image(n),n.captionImage.name="Image",n.template=t.add.scrollView(n),n.template.interactive=!0,n.template.name="Template";var o=n.template.addScript("qc.NodeMask");o.checkInField=!1,n.template.content=t.add.node(n.template),n.template.visible=!1,n.template.content.name="Content";var h=n.item=t.add.node(n.template.content);h.name="Item",h.interactive=!0;var l=h.addScript("qc.DropdownItem");l.checkBackground=t.add.image(h),l.checkBackground.name="Background",l.checkMark=t.add.image(h),l.checkMark.name="CheckMark",l.text=t.add.text(h),l.text.name="Text",l.image=t.add.image(h),l.image.name="Image",l.image.visible=!1}n.addListener(n.onDown,function(){n.state!==s.UIState.DISABLED&&(n.state=s.UIState.PRESSED)}),n.addListener(n.onUp,function(){n.state===s.UIState.PRESSED&&(n.state=s.UIState.NORMAL)}),n.addListener(n.onClick,function(t){n.isFocused=!n.isFocused}),n.phaser.worldTransformChangedCallback=n._updatePosition,n.phaser.worldTransformChangedContext=n,n._updatePosition()};Le.prototype=e.create(s.UIImage.prototype),Le.prototype.constructor=Le,e.defineProperties(Le.prototype,{class:{get:function(){return"qc.Dropdown"}},state:{get:function(){return this._state||s.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},value:{get:function(){return this.options.length>0?this._value:-1},set:function(t){if(!(this._value===t||t>=this.options.length)&&"number"==typeof this._value){var e=this._items[this._value],i=this._items[t];this._value=t,e&&e.getScript("qc.DropdownItem").redraw(),i&&i.getScript("qc.DropdownItem").redraw(),this._redraw(),this.onValueChange.dispatch(t)}}},isFocused:{get:function(){return this._list&&this._list.visible},set:function(t){t!==this.isFocused&&(t?this.show():this.hide())}}}),Le.prototype._dispatchAwake=function(){var t=this;F.prototype._dispatchAwake.call(t),t._value&&0!==t.options.length||(t._value=-1),t._redraw()},Le.prototype.addOptions=function(t){var e=this,i=e.options.concat(t);0===e.options.length?(e.options=i,this.value=0):e.options=i,e.isFocused&&e.show()},Le.prototype.clearOptions=function(){var t=this;t.options=[],t._value>=0&&(t._value=-1,t.onValueChange.dispatch(t._value)),t.isFocused&&t.hide(),t._redraw()},Le.prototype.show=function(){var t=this,e=t._list;t.hide(),t._maskNode=t.game.add.node(t.game.world),t._maskNode.interactive=!0,t._maskNode.name="mask",t._maskNode.addListener(t._maskNode.onClick,function(){t.hide()}),t._items=[],t.item.visible=!1,e=t._list=t.game.add.clone(t.template,t.game.world);for(var i="",r=t.item.parent;r!==t.template;)i=""===i?r.name:r.name+"/"+i,r=r.parent;for(var n=""===i?e:e.find(i),a=0;a<t.options.length;a++){var s=t.game.add.clone(t.item,n);s.visible=!0;var o=s.getScript("qc.DropdownItem");o.dropdown=t,o.index=a,t._items.push(s)}e.visible=!0,t._updatePosition()},Le.prototype.hide=function(){var t=this,e=t._list;e&&(e.destroy(),delete t._list),t._maskNode&&(t._maskNode.destroy(),delete t._maskNode),t._items=[]},Le.prototype.getMeta=function(){var t=this,e=s.Serializer,r=s.UIImage.prototype.getMeta.call(t);return r.captionImage=e.NODE,r.captionText=e.NODE,r.template=e.NODE,r.item=e.NODE,r.maskNode=e.NODE,r.state=e.NUMBER,r._value=e.NUMBER,r.options={get:function(e,r){for(var n=[],a=0;a<t.options.length;a++){var s=t.options[a];s?"string"!=typeof s?n.push(t.game.serializer._saveTextureItem(s,r)):n.push(s):n.push(i)}return n},set:function(e,i){i.forEach(function(e){e&&"string"!=typeof e?t.options.push(t.game.serializer._restoreTextureItem(e)):t.options.push(e)})}},r},Le.prototype._redraw=function(){var t=this;if(0===t.options.length||t.value<0||t.value>=t.options.length)return t.captionImage&&(t.captionImage.visible=!1),void(t.captionText&&(t.captionText.visible=!1));var e=t.options[t.value];"string"==typeof e?(t.captionImage&&(t.captionImage.visible=!1),t.captionText&&(t.captionText.visible=!0,t.captionText.text=e)):e&&(t.captionText&&(t.captionText.visible=!1),t.captionImage&&(t.captionImage.visible=!0,t.captionImage.texture=e))},Le.prototype._updatePosition=function(){var t=this,e=t._list;if(e){t.template.visible=!0;var i=s.Bounds.getBox(t,Fe.USE_BOUNDS,!0,0),r=s.Bounds.getBox(t.template,Fe.USE_BOUNDS,!0,0),n=r.y;if(r.height<t.game.world.height/2&&r.y+r.height>t.game.world.height){var a=r.y-(i.y+i.height);n=i.y-a-r.height}var o=t.template.getWorldPosition();e.setAnchor(new s.Point(0,0),new s.Point(0,0)),e.x=o.x,e.y=n-e.pivotY*e.height;var h=t.template.getWorldScale();e.scaleX=h.x,e.scaleY=h.y,e.rotation=t.template.getWorldRotation(),e.width=t.template.width,e.height=t.template.height,t._maskNode.x=t._maskNode.y=0,t._maskNode.width=t.game.world.width,t._maskNode.height=t.game.world.height,t.template.visible=!1}};var Fe=B("qc.Bounds",s.Behaviour,function(){this._sizeProvider=Fe.USE_BOUNDS,this._autoCalcBounds=!0,this._marginTop=this._marginBottom=this._marginLeft=this._marginRight=0,this._paddingTop=this._paddingBottom=this._paddingLeft=this._paddingRight=0,this._deep=1},{_sizeProvider:s.Serializer.NUMBER,_marginTop:s.Serializer.NUMBER,_marginBottom:s.Serializer.NUMBER,_marginLeft:s.Serializer.NUMBER,_marginRight:s.Serializer.NUMBER,_paddingTop:s.Serializer.NUMBER,_paddingBottom:s.Serializer.NUMBER,_paddingLeft:s.Serializer.NUMBER,_paddingRight:s.Serializer.NUMBER,_autoCalcBounds:s.Serializer.BOOLEAN});Fe.__hiddenInMenu=!0,e.defineProperties(Fe.prototype,{sizeProvider:{get:function(){return this._sizeProvider},set:function(t){this._sizeProvider!==t&&(this._sizeProvider=t,this.getBounds(!0))}},marginTop:{get:function(){return this._marginTop},set:function(t){this.setMargin(t)}},marginBottom:{get:function(){return this._marginBottom},set:function(t){this.setMargin(null,null,t)}},marginLeft:{get:function(){return this._marginLeft},set:function(t){this.setMargin(null,null,null,t)}},marginRight:{get:function(){return this._marginRight},set:function(t){this.setMargin(null,t)}},paddingTop:{get:function(){return this._paddingTop},set:function(t){this.setPadding(t)}},paddingBottom:{get:function(){return this._paddingBottom},set:function(t){this.setPadding(null,null,t)}},paddingLeft:{get:function(){return this._paddingLeft},set:function(t){this.setPadding(null,null,null,t)}},paddingRight:{get:function(){return this._paddingRight},set:function(t){this.setPadding(null,t)}},autoCalcBounds:{get:function(){return this._autoCalcBounds},set:function(t){this._autoCalcBounds=t}}}),Fe.prototype.setPadding=function(t,e,i,r){null!=t&&(this._paddingTop=t),null!=e&&(this._paddingRight=e),null!=i&&(this._paddingBottom=i),null!=r&&(this._paddingLeft=r),this._lastWrapTime=null,this.relayout&&this.relayout(),this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")},Fe.prototype.setMargin=function(t,e,i,r){null!=t&&(this._marginTop=t),null!=e&&(this._marginRight=e),null!=i&&(this._marginBottom=i),null!=r&&(this._marginLeft=r),this._lastWrapTime=null,this.relayout&&this.relayout(),this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")},Fe.prototype.calcBounds=function(){this.getBounds(!0)},Fe.prototype.getBounds=function(t){var e=this._recordBounds||new s.Rectangle(0,0,0,0);if(!this.enable||!this.gameObject||!this.gameObject.isWorldVisible())return e;if(this._recordBounds&&!t&&(!this.autoCalcBounds||this._lastWrapTime===this.gameObject.game.time.fixedTime))return this._recordBounds;this._lastWrapTime=this.gameObject.game.time.fixedTime;var i=new s.Point(0,0),r=new s.Point(0,0);return Fe._calcBounds(i,r,this.sizeProvider,this.gameObject,this._deep),e.x=i.x,e.y=i.y,e.width=r.x-i.x,e.height=r.y-i.y,this._recordBounds=e,e},Fe.prototype.getWorldCorners=function(t){var e=this.getBounds(t),i=new s.Point(e.x,e.y),r=new s.Point(e.x+e.width,e.y),n=new s.Point(e.x+e.width,e.y+e.height),a=new s.Point(e.x,e.y+e.height),o=this.gameObject.worldTransform;return[o.apply(i),o.apply(r),o.apply(n),o.apply(a)]},Fe._calcBounds=function(t,e,i,r,n){var a=r.getScript("qc.Bounds");i=a&&a.enable?a.sizeProvider:i,i===Fe.USE_BOUNDS?this._calcRealBounds(t,e,r,n):this._calcRectBounds(t,e,r,n)},Fe._calcRectBounds=function(t,e,i,r){var n=i.getScript("qc.Bounds"),a=i.rect,o=a.x,h=a.y,l=a.x+a.width,u=a.y+a.height;if(0!==r)for(var c=i.children,p=c.length;p--;){var d=c[p];if(d.isWorldVisible()){var f=d.getScript("qc.Bounds"),_=new s.Point(0,0),g=new s.Point(0,0);if(f){var m=f.getBounds();_.x=m.x,_.y=m.y,g.x=m.x+m.width,g.y=m.y+m.height}else Fe._calcRectBounds(_,g,d,r-1);n&&n.enable&&(_.x-=n.paddingLeft,_.y-=n.paddingTop,g.x+=n.paddingRight,g.y+=n.paddingBottom),o=Math.min(o,_.x),h=Math.min(h,_.y),l=Math.max(l,g.x),u=Math.max(u,g.y)}}n&&n.enable&&(o-=n.marginLeft,h-=n.marginTop,l+=n.marginRight,u+=n.marginBottom),t.x=Math.min(t.x,o),t.y=Math.min(t.y,h),e.x=Math.max(e.x,l),e.y=Math.max(e.y,u)},Fe._calcRealBounds=function(t,e,i,r){var n=i.getScript("qc.Bounds"),a=i.rect,o=a.x,h=a.y,l=a.x+a.width,u=a.y+a.height;if(0!==r)for(var c=i.worldTransform,p=i.children,d=p.length;d--;){var f=p[d];if(f.isWorldVisible()){var _=f.getScript("qc.Bounds"),g=new s.Point(0,0),m=new s.Point(0,0);if(_){var y=_.getBounds();g.x=y.x,g.y=y.y,m.x=y.x+y.width,m.y=y.y+y.height}else Fe._calcRealBounds(g,m,f,r-1);var v=new s.Point(g.x,g.y),T=new s.Point(m.x,g.y),x=new s.Point(m.x,m.y),b=new s.Point(g.x,m.y),A=f.worldTransform;v=c.applyInverse(A.apply(v)),T=c.applyInverse(A.apply(T)),x=c.applyInverse(A.apply(x)),b=c.applyInverse(A.apply(b));var S=Math.min(v.x,T.x,x.x,b.x),w=Math.min(v.y,T.y,x.y,b.y),P=Math.max(v.x,T.x,x.x,b.x),E=Math.max(v.y,T.y,x.y,b.y);n&&n.enable&&(S-=n.paddingLeft,w-=n.paddingTop,P+=n.paddingRight,E+=n.paddingBottom),o=Math.min(o,S),h=Math.min(h,w),l=Math.max(l,P),u=Math.max(u,E)}}n&&n.enable&&(o-=n.marginLeft,h-=n.marginTop,l+=n.marginRight,u+=n.marginBottom),t.x=Math.min(t.x,o),t.y=Math.min(t.y,h),e.x=Math.max(e.x,l),e.y=Math.max(e.y,u)},Fe.getBounds=function(t,e,i,r){r=null==r?0:r;var n=t.getScript("qc.Bounds");if(n&&n.enable)return n.getBounds(i);var a=new s.Point(0,0),o=new s.Point(0,0);Fe._calcBounds(a,o,e,t,r);var h=new s.Rectangle(0,0,0,0);return h.x=a.x,h.y=a.y,h.width=o.x-a.x,h.height=o.y-a.y,h},Fe.getCorners=function(t,e,i,r,n){var a=Fe.getBounds(t,e,i,r),o=t.worldTransform,h=n&&n.worldTransform;if(e===Fe.USE_RECTTRANSFORM){for(var l=Fe.findCommonRoot(t,n||t.game.world),u=0,c=0,p=t;p&&p!==t.game.world&&p!==l;)u+=p.x,c+=p.y,p=p.parent;for(p=n;p&&p!==t.game.world&&p!==l;)u-=p.x,c-=p.y;var d=new s.Point(a.x+u,a.y+c),f=new s.Point(a.x+a.width+u,a.y+c),_=new s.Point(a.x+a.width+u,a.y+a.height+c),g=new s.Point(a.x+u,a.y+a.height+c);return[d,f,_,g]}d=new s.Point(a.x,a.y),f=new s.Point(a.x+a.width,a.y),_=new s.Point(a.x+a.width,a.y+a.height),g=new s.Point(a.x,a.y+a.height);return h?[h.applyInverse(o.apply(d)),h.applyInverse(o.apply(f)),h.applyInverse(o.apply(_)),h.applyInverse(o.apply(g))]:[o.apply(d),o.apply(f),o.apply(_),o.apply(g)]},Fe.getBox=function(t,e,i,r,n){for(var a=Fe.getCorners(t,e,i,r,n),o=new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE),h=new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),l=0;l<4;l++){var u=a[l];o.x=Math.max(o.x,u.x),o.y=Math.max(o.y,u.y),h.x=Math.min(h.x,u.x),h.y=Math.min(h.y,u.y)}return new s.Rectangle(h.x,h.y,o.x-h.x,o.y-h.y)},Fe.getContentRect=function(t){var e=t.rect,i=t.getScript("qc.Bounds");return i&&i.enable&&(e.x+=i.paddingLeft,e.y+=i.paddingTop,e.width-=i.paddingLeft+i.paddingRight,e.height-=i.paddingTop+i.paddingBottom),e},Fe.getMargin=function(t){var e=t.getScript("qc.Bounds");return e&&e.enable?{top:e._marginTop,bottom:e._marginBottom,left:e._marginLeft,right:e._marginRight}:{top:0,bottom:0,left:0,right:0}},Fe.findCommonRoot=function(t,e){if(!t||!e)return null;for(var i=t,r=e;i;){for(r=e;r;){if(i===r)return i;r=r.parent}i=i.parent}return null},Fe.USE_BOUNDS=0,Fe.USE_RECTTRANSFORM=1;var ke=B("qc.LayoutElement",s.Bounds,function(){this.ignoreLayout=!1,this.minWidth=-1,this.minHeight=-1,this.preferredWidth=-1,this.preferredHeight=-1,this.flexibleWidth=-1,this.flexibleHeight=-1,this._deep=0},{ignoreLayout:s.Serializer.BOOLEAN,minWidth:s.Serializer.NUMBER,minHeight:s.Serializer.NUMBER,preferredWidth:s.Serializer.NUMBER,preferredHeight:s.Serializer.NUMBER,flexibleWidth:s.Serializer.NUMBER,flexibleHeight:s.Serializer.NUMBER});ke.__menu="UI/Layout/LayoutElement",e.defineProperties(ke.prototype,{ignoreLayout:{get:function(){return this._ignoreLayout},set:function(t){t!==this._ignoreLayout&&(this._ignoreLayout=t)}},minWidth:{get:function(){return this._minWidth},set:function(t){t!==this._minWidth&&(this._minWidth=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},minHeight:{get:function(){return this._minHeight},set:function(t){t!==this._minHeight&&(this._minHeight=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},preferredWidth:{get:function(){return this._preferredWidth},set:function(t){t!==this._preferredWidth&&(this._preferredWidth=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},preferredHeight:{get:function(){return this._preferredHeight},set:function(t){t!==this._preferredHeight&&(this._preferredHeight=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},flexibleWidth:{get:function(){return this._flexibleWidth},set:function(t){t!==this._flexibleWidth&&(this._flexibleWidth=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},flexibleHeight:{get:function(){return this._flexibleHeight},set:function(t){t!==this._flexibleHeight&&(this._flexibleHeight=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},hasMinWidth:{get:function(){return this.minWidth>=0},set:function(t){this.hasMinWidth!==t&&(this.minWidth=t?0:-1)}},hasMinHeight:{get:function(){return this.minHeight>=0},set:function(t){this.hasMinHeight!==t&&(this.minHeight=t?0:-1)}},hasPreferredWidth:{get:function(){return this.preferredWidth>=0},set:function(t){this.hasPreferredWidth!==t&&(this.preferredWidth=t?this.gameObject?this.gameObject.width:0:-1)}},hasPreferredHeight:{get:function(){return this.preferredHeight>=0},set:function(t){this.hasPreferredHeight!==t&&(this.preferredHeight=t?this.gameObject?this.gameObject.height:0:-1)}},hasFlexibleWidth:{get:function(){return this.flexibleWidth>=0},set:function(t){this.hasFlexibleWidth!==t&&(this.flexibleWidth=t?1:-1)}},hasFlexibleHeight:{get:function(){return this.flexibleHeight>=0},set:function(t){this.hasFlexibleHeight!==t&&(this.flexibleHeight=t?1:-1)}}}),ke.getLayoutElement=function(t){var e=new ke,i=t.getScript("qc.LayoutElement");return i&&!i.ignoreLayout&&(e.ignoreLayout=i.ignoreLayout,e.minWidth=i.minWidth,e.minHeight=i.minHeight,e.preferredWidth=i.preferredWidth,e.preferredHeight=i.preferredHeight,e.flexibleWidth=i.flexibleWidth,e.flexibleHeight=i.flexibleHeight),e},ke.USE_RECTTRANSFORM=s.Bounds.USE_RECTTRANSFORM,ke.USE_BOUNDS=s.Bounds.USE_BOUNDS;var Ue=B("qc.TableLayout",s.Bounds,function(){this._cellStyle=[[this._buildCellInfo()]],this._constraint=Ue.CONSTRAINT_FLEXIBLE,this.runInEditor=!0,this.cellAlignment=Ue.ALIGN_TOP_LEFT,this.gameObject.onChildrenChanged.add(this._doChildrenChanged,this),this.gameObject.onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this)},{constraint:s.Serializer.NUMBER,stride:s.Serializer.NUMBER,startCorner:s.Serializer.NUMBER,startAxis:s.Serializer.NUMBER,contentSizeProvider:s.Serializer.NUMBER,style:s.Serializer.NUMBER,_cellStyle:s.Serializer.MAPPING,autoUpdate:s.Serializer.BOOLEAN,contentAlignment:s.Serializer.NUMBER,cellAlignment:s.Serializer.NUMBER,spacingX:s.Serializer.NUMBER,spacingY:s.Serializer.NUMBER,ignoreX:s.Serializer.BOOLEAN,ignoreY:s.Serializer.BOOLEAN});Ue.__menu="UI/Layout/TableLayout",Ue._precision=1e-7,e.defineProperties(Ue.prototype,{constraint:{get:function(){return isNaN(this._constraint)?Ue.CONSTRAINT_FLEXIBLE:this._constraint},set:function(t){this._constraint!==t&&(this._constraint=t,this.rebuildTable())}},stride:{get:function(){return isNaN(this._stride)?0:this._stride},set:function(t){t!==this._stride&&(this._stride=t,this.rebuildTable())}},startCorner:{get:function(){return this._startCorner||Ue.CORNER_TOP_LEFT},set:function(t){t!==this._startCorner&&(this._startCorner=t,this.rebuildTable())}},startAxis:{get:function(){return this._startAxis||Ue.AXIS_HORIZONTAL},set:function(t){t!==this._startAxis&&(this._startAxis=t,this.rebuildTable())}},contentSizeProvider:{get:function(){return this._contentSizeProvider||Ue.USE_BOUNDS},set:function(t){t!==this._contentSizeProvider&&(this._contentSizeProvider=t,this.rebuildTable())}},style:{get:function(){return this._style||Ue.STYLE_WRAP_ELEMENT},set:function(t){t!==this._style&&(this._style=t,this.rebuildTable())}},autoUpdate:{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate=t}},spacingX:{get:function(){return this._spacingX||0},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.rebuildTable())}},spacingY:{get:function(){return this._spacingY||0},set:function(t){this._spacingY!==t&&(this._spacingY=t,this.rebuildTable())}},cellWidth:{get:function(){return this.getCellStyle(null,null).cellWidth},set:function(t){this.setCellStyle(null,null,null,null,null,null,null,t)}},cellHeight:{get:function(){return this.getCellStyle(null,null).cellHeight},set:function(t){this.setCellStyle(null,null,null,null,null,null,null,null,t)}},contentAlignment:{get:function(){return this._contentAlignment||Ue.ALIGN_TOP_LEFT},set:function(t){this._contentAlignment!==t&&(this._contentAlignment=t,this.rebuildTable())}},cellAlignment:{get:function(){return this.getCellStyle(null,null).align},set:function(t){this.cellAlignment!==t&&(this.setCellStyle(null,null,t),this.rebuildTable())}},columnsCount:{get:function(){var t=this._calcColumnRow();return t.x}},rowsCount:{get:function(){var t=this._calcColumnRow();return t.y}},ignoreX:{get:function(){return!!this._ignoreX},set:function(t){this._ignoreX!==t&&(this._ignoreX=t)}},ignoreY:{get:function(){return!!this._ignoreY},set:function(t){this._ignoreY!==t&&(this._ignoreY=t)}}}),Ue.prototype.postUpdate=function(){this.enable&&(this.autoUpdate||this._needRebuildTable)&&(this.rebuildTable(),this._needRebuildTable=!1)},Ue.prototype._getChildrenCount=function(){for(var t=0,e=this.gameObject.children,i=0;i<e.length;++i)e[i]&&e[i].isWorldVisible()&&t++;return t},Ue.prototype._getChildren=function(){for(var t=[],e=this.gameObject.children,i=0;i<e.length;++i)e[i]&&e[i].isWorldVisible()&&t.push(e[i]);return t},Ue.prototype._mixinStyle=function(t,e){return{align:(0==(240&e.align)?240&t.align:240&e.align)|(0==(15&e.align)?15&t.align:15&e.align),timestamp:Math.max(e.timestamp,t.timestamp),paddingLeft:isNaN(e.paddingLeft)?t.paddingLeft:e.paddingLeft,paddingRight:isNaN(e.paddingRight)?t.paddingRight:e.paddingRight,paddingTop:isNaN(e.paddingTop)?t.paddingTop:e.paddingTop,paddingBottom:isNaN(e.paddingBottom)?t.paddingBottom:e.paddingBottom,cellWidth:isNaN(e.cellWidth)?t.cellWidth:e.cellWidth,cellHeight:isNaN(e.cellHeight)?t.cellHeight:e.cellHeight}},Ue._calcRectTransform=function(t,e){e=isNaN(e)?0:e;var i=t.rect;if(0!==e)return i;for(var r=t.children,n=r.length;n--;){var a=Ue._calcRectTransform(r[n],e-1);i.x=Math.min(i.x,a.x),i.y=Math.min(i.y,a.y),i.w=Math.max(i.x+i.width,a.x+a.width)-i.x,i.h=Math.max(i.y+i.height,a.y+a.height)-i.y}return i},Ue.prototype.getCellRect=function(t,e){return s.Bounds.getBox(t,this.contentSizeProvider,e,0,this.gameObject)},Ue.prototype.getCellStyle=function(t,e){t=null==t?0:t+1,e=null==e?0:e+1;var i=this._cellStyle[0][0],r=this._cellStyle[e]&&this._cellStyle[e][0],n=this._cellStyle[0][t];!n||r&&r.timestamp>n.timestamp?(n&&(i=this._mixinStyle(i,n)),r&&(i=this._mixinStyle(i,r))):(r&&(i=this._mixinStyle(i,r)),n&&(i=this._mixinStyle(i,n)));var a=this._cellStyle[e]&&this._cellStyle[e][t];return a&&(i=this._mixinStyle(i,a)),i.paddingTop=isNaN(i.paddingTop)?0:i.paddingTop,i.paddingLeft=isNaN(i.paddingLeft)?0:i.paddingLeft,i.paddingRight=isNaN(i.paddingRight)?0:i.paddingRight,i.paddingBottom=isNaN(i.paddingBottom)?0:i.paddingBottom,i.cellWidth=isNaN(i.cellWidth)?0:i.cellWidth,i.cellHeight=isNaN(i.cellHeight)?0:i.cellHeight,i},Ue.prototype.setCellStyle=function(t,e,i,r,n,a,s,o,h){t=null==t?0:t+1,e=null==e?0:e+1,this._cellStyle[e]||(this._cellStyle[e]=[]),this._cellStyle[e][t]||(this._cellStyle[e][t]=this._buildCellInfo());var l=this._cellStyle[e][t];null!=i&&(l.align=i),null!=r&&(l.paddingTop=r),null!=n&&(l.paddingRight=n),null!=a&&(l.paddingBottom=a),null!=s&&(l.paddingLeft=s),null!=o&&(l.cellWidth=o),l.cellHeight=h,
this._cellStyle[e][t].timestamp=this.gameObject.game.time.fixedTime,this.rebuildTable()},Ue.prototype.clearCellStyle=function(t,e){t=null==t?0:t+1,e=null==e?0:e+1,0!==t||0!==e?this._cellStyle[e]&&this._cellStyle[e][t]&&(this._cellStyle[e][t]=null):this._cellStyle[0][0]=this._buildCellInfo()},Ue.prototype._buildCellInfo=function(){return{align:0,timestamp:0,paddingLeft:NaN,paddingRight:NaN,paddingTop:NaN,paddingBottom:NaN,cellWidth:NaN,cellHeight:NaN}},Ue.prototype._calcColumnRow=function(){var t=this._getChildrenCount(),e=this.stride,i=this.constraint;if(i===Ue.CONSTRAINT_FLEXIBLE){var r=this.getCellStyle(null,null),n=s.Bounds.getContentRect(this.gameObject);this.startAxis===Ue.AXIS_HORIZONTAL?(e=Math.min(Math.max(1,Math.floor((n.width+this.spacingX)/(r.cellWidth+this.spacingX))),t),i=Ue.CONSTRAINT_FIX_COLUMN_COUNT):(e=Math.min(Math.max(1,Math.floor((n.height+this.spacingY)/(r.cellHeight+this.spacingY))),t),i=Ue.CONSTRAINT_FIX_ROW_COUNT)}var a=i===Ue.CONSTRAINT_FIX_ROW_COUNT?Math.ceil(t/e):e,o=i===Ue.CONSTRAINT_FIX_ROW_COUNT?e:Math.ceil(t/e);return new s.Point(a,o)},Ue.prototype._calcPos=function(t,e){var i=this._calcColumnRow();return e=e||new s.Point(0,0),this.startAxis===Ue.AXIS_HORIZONTAL?(e.x=t%i.x,e.y=Math.floor(t/i.x)):(e.x=Math.floor(t/i.y),e.y=t%i.y),0!=(240&this.startCorner)&&(e.x=i.x-1-e.x),0!=(15&this.startCorner)&&(e.y=i.y-1-e.y),e},Ue.prototype._setCellPosition=function(t,e){if(!this.ignoreX||this.columnsCount>1){var i=t.node.x;0!=(t.style.align&Ue.ALIGN_RIGHT)?i+=e.x-t.bounds.x+(e.width-t.bounds.width):0!=(t.style.align&Ue.ALIGN_CENTER)?i+=e.x-t.bounds.x+(e.width-t.bounds.width)/2:i+=e.x-t.bounds.x,Math.abs(i-t.node.x)>Ue._precision&&(t.node.x=i)}if(!this.ignoreY||this.rowsCount>1){var r=t.node.y;0!=(t.style.align&Ue.ALIGN_BOTTOM)?r+=e.y-t.bounds.y+(e.height-t.bounds.height):0!=(t.style.align&Ue.ALIGN_MIDDLE)?r+=e.y-t.bounds.y+(e.height-t.bounds.height)/2:r+=e.y-t.bounds.y,Math.abs(r-t.node.y)>Ue._precision&&(t.node.y=r)}},Ue.prototype._setCellSize=function(t,e,i){if(!(Math.abs(t.bounds.width-e)<Ue._precision&&Math.abs(t.bounds.height-i)<Ue._precision)){var r=Fe.getMargin(t.node),n=e-r.left-r.right,a=i-r.top-r.bottom,o=t.bounds.width-r.left-r.right,h=t.bounds.height-r.top-r.bottom;t.node.setAnchor(new s.Point(0,0),new s.Point(0,0),!1),t.node.x=0,t.node.y=0,o<=0?t.node.width=n:t.node.width*=n/o,h<=0?t.node.height=a:t.node.height*=a/h,t.node.setStretch(0,0,0,0),t.bounds=this.getCellRect(t.node,!0)}},Ue.prototype.relayout=function(){this.rebuildTable()},Ue.prototype.rebuildTable=function(){this.getCellStyle(null,null);this.style===Ue.STYLE_WRAP_ELEMENT?this._rebuildWrapTable():this._rebuildResizeTable()},Ue.prototype._getDefaultLayout=function(t){return{min:0,preferred:0,flexible:0,extra:0}},Ue.prototype.getCellLayout=function(t){return s.LayoutElement.getLayoutElement(t)},Ue.prototype._rebuildResizeTable=function(){for(var t=this._getChildren(),e=[],i=[],r=[],n=[],a=[],o=t.length,h=new s.Point(0,0),l=-1;++l<o;){this._calcPos(l,h);var u=this.getCellLayout(t[l]),c=this.getCellStyle(h.x,h.y),p=this.getCellRect(t[l]);(e[h.y]||(e[h.y]=[]))[h.x]={node:t[l],layout:u,bounds:p,style:c};var d=n[h.x]||(n[h.x]=this._getDefaultLayout("x")),f=a[h.y]||(a[h.y]=this._getDefaultLayout("y"));u.preferredWidth<0&&t[l].nativeSize&&(u.preferredWidth=t[l].nativeSize.width),u.preferredHeight<0&&t[l].nativeSize&&(u.preferredHeight=t[l].nativeSize.height),!isNaN(c.cellWidth)&&c.cellWidth>0&&(u.minWidth=c.cellWidth,u.preferredWidth=c.cellWidth),!isNaN(c.cellHeight)&&c.cellHeight>0&&(u.minHeight=c.cellHeight,u.preferredHeight=c.cellHeight),u.minWidth>=0&&(d.min=Math.max(d.min,u.minWidth)),u.minHeight>=0&&(f.min=Math.max(f.min,u.minHeight)),d.preferred=Math.max(d.preferred,u.preferredWidth,d.min),f.preferred=Math.max(f.preferred,u.preferredHeight,d.min),u.flexibleWidth>=0&&(d.flexible=Math.max(d.flexible,u.flexibleWidth)),u.flexibleHeight>=0&&(f.flexible=Math.max(f.flexible,u.flexibleHeight)),d.extra=Math.max(d.extra,c.paddingLeft+c.paddingRight),f.extra=Math.max(f.extra,c.paddingTop+c.paddingBottom)}var _={min:0,preferred:0,flexible:0,extra:0,fixed:0},g={min:0,preferred:0,flexible:0,extra:0,fixed:0};n.forEach(function(t){_.min+=t.min,_.preferred+=t.preferred,_.flexible+=t.flexible,_.extra+=t.extra}),a.forEach(function(t){g.min+=t.min,g.preferred+=t.preferred,g.flexible+=t.flexible,g.extra+=t.extra});var m=s.Bounds.getContentRect(this.gameObject),y=Math.max(0,n.length-1)*this.spacingX,v=Math.max(0,a.length-1)*this.spacingY,T=new s.Point(0,0);if(m.width<=_.min+_.extra+y)for(var x=0;x<n.length;++x)n[x]?i[x]=n[x].min+n[x].extra:i[x]=0;else if(m.width<=_.preferred+_.extra+y){var b=m.width-_.extra-_.min-y;for(x=0;x<n.length;++x)n[x]?i[x]=b*n[x].preferred/(_.preferred||1)+n[x].min+n[x].extra:i[x]=0}else{for(b=m.width-_.extra-_.preferred-y,x=0;x<n.length;++x)n[x]?i[x]=b*n[x].flexible/(_.flexible||1)+n[x].preferred+n[x].extra:i[x]=0;0===_.flexible&&(0!=(this.contentAlignment&Ue.ALIGN_RIGHT)?T.x=b:0!=(this.contentAlignment&Ue.ALIGN_CENTER)&&(T.x=b/2))}if(m.height<=g.min+g.extra+v)for(x=0;x<a.length;++x)a[x]?r[x]=a[x].min+a[x].extra:r[x]=0;else if(m.height<=g.preferred+g.extra+v)for(b=m.height-g.extra-g.min-v,x=0;x<a.length;++x)a[x]?r[x]=b*a[x].preferred/(g.preferred||1)+a[x].min+a[x].extra:r[x]=0;else{for(b=m.height-g.extra-g.preferred-v,x=0;x<a.length;++x)a[x]?r[x]=b*a[x].flexible/(g.flexible||1)+a[x].preferred+a[x].extra:r[x]=0;0===g.flexible&&(0!=(this.contentAlignment&Ue.ALIGN_BOTTOM)?T.y=b:0!=(this.contentAlignment&Ue.ALIGN_MIDDLE)&&(T.y=b/2))}for(var A=s.Bounds.getContentRect(this.gameObject),S=new s.Rectangle(0,0,0,0),w=0,P=0,E=0;E<r.length;E++){w=0;for(var D=0;D<i.length;D++){var C=e[E][D];if(C){S.x=A.x+w+C.style.paddingLeft+T.x,S.y=A.y+P+C.style.paddingTop+T.y,S.width=i[D]-C.style.paddingLeft-C.style.paddingRight,S.height=r[E]-C.style.paddingTop-C.style.paddingBottom;var O=S.width,M=S.height;C.layout.flexibleWidth<=0&&S.width>C.layout.preferredWidth&&C.layout.preferredWidth>0&&(O=C.layout.preferredWidth),C.layout.flexibleHeight<=0&&S.height>C.layout.preferredHeight&&C.layout.preferredHeight>0&&(M=C.layout.preferredHeight),this._setCellSize(C,O,M),this._setCellPosition(C,S),w+=i[D]+this.spacingX}else w+=i[D]+this.spacingX}P+=r[E]+this.spacingY}},Ue.prototype._rebuildWrapTable=function(){for(var t=this._getChildren(),e=[],r=[],n=[],a=t.length,o=new s.Point(0,0);a--;){this._calcPos(a,o);var h=this.getCellStyle(o.x,o.y),l=this.getCellRect(t[a]);(e[o.y]||(e[o.y]=[]))[o.x]={node:t[a],bounds:l,style:h},h.cellWidth>0?r[o.x]=h.cellWidth:r[o.x]=Math.max(l.width+h.paddingLeft+h.paddingRight,r[o.x]||0,h.cellWidth),h.cellHeight>0?n[o.y]=h.cellHeight:n[o.y]=Math.max(l.height+h.paddingTop+h.paddingBottom,n[o.y]||0,h.cellHeight)}for(var u=0,c=0,p=0;p<r.length;p++)u+=r[p];for(var d=0;d<n.length;d++)c+=n[d];var f=s.Bounds.getContentRect(this.gameObject),_=new s.Point(0,0);0!=(this.contentAlignment&Ue.ALIGN_BOTTOM)?_.y=f.height-c:0!=(this.contentAlignment&Ue.ALIGN_MIDDLE)&&(_.y=(f.height-c)/2),0!=(this.contentAlignment&Ue.ALIGN_RIGHT)?_.x=f.width-u:0!=(this.contentAlignment&Ue.ALIGN_CENTER)&&(_.x=(f.width-u)/2);var g=new s.Rectangle(0,0,0,0),m=0,y=0;for(d=0;d<n.length;d++){m=0;for(p=0;p<r.length;p++){var v=e[d][p];if(v)g.x=f.x+m+v.style.paddingLeft+_.x,g.y=f.y+y+v.style.paddingTop+_.y,g.width=r[p]-v.style.paddingLeft-v.style.paddingRight,g.height=n[d]-v.style.paddingTop-v.style.paddingBottom,this._setCellPosition(v,g),m+=r[p]+this.spacingX;else{h=this.getCellStyle(p,d);var T=r[p]===i?h.cellWidth:r[p];m+=T+this.spacingX}}y+=n[d]+this.spacingY}},Ue.prototype._doChildrenChanged=function(t){var e=t.children.length;if("add"===t.type)for(;e--;)t.children[e]&&t.children[e].onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this);else if("remove"===t.type)for(;e--;)t.children[e]&&t.children[e].onLayoutArgumentChanged.remove(this._doLayoutArgumentChanged,this);this._needRebuildTable=!0},Ue.prototype._doLayoutArgumentChanged=function(){this._needRebuildTable=!0},Ue.CONSTRAINT_FLEXIBLE=0,Ue.CONSTRAINT_FIX_COLUMN_COUNT=1,Ue.CONSTRAINT_FIX_ROW_COUNT=2,Ue.STYLE_WRAP_ELEMENT=0,Ue.STYLE_RESIZE_ELEMENT=1,Ue.USE_RECTTRANSFORM=s.LayoutElement.USE_RECTTRANSFORM,Ue.USE_BOUNDS=s.LayoutElement.USE_BOUNDS,Ue.AXIS_HORIZONTAL=0,Ue.AXIS_VERTICAL=1,Ue.CORNER_TOP_LEFT=0,Ue.CORNER_TOP_RIGHT=16,Ue.CORNER_BOTTOM_RIGHT=17,Ue.CORNER_BOTTOM_LEFT=1,Ue.ALIGN_LEFT=1,Ue.ALIGN_CENTER=2,Ue.ALIGN_RIGHT=4,Ue.ALIGN_TOP=16,Ue.ALIGN_MIDDLE=32,Ue.ALIGN_BOTTOM=64,Ue.ALIGN_TOP_LEFT=Ue.ALIGN_TOP|Ue.ALIGN_LEFT,Ue.ALIGN_TOP_CENTER=Ue.ALIGN_TOP|Ue.ALIGN_CENTER,Ue.ALIGN_TOP_RIGHT=Ue.ALIGN_TOP|Ue.ALIGN_RIGHT,Ue.ALIGN_MIDDLE_LEFT=Ue.ALIGN_MIDDLE|Ue.ALIGN_LEFT,Ue.ALIGN_MIDDLE_CENTER=Ue.ALIGN_MIDDLE|Ue.ALIGN_CENTER,Ue.ALIGN_MIDDLE_RIGHT=Ue.ALIGN_MIDDLE|Ue.ALIGN_RIGHT,Ue.ALIGN_BOTTOM_LEFT=Ue.ALIGN_BOTTOM|Ue.ALIGN_LEFT,Ue.ALIGN_BOTTOM_CENTER=Ue.ALIGN_BOTTOM|Ue.ALIGN_CENTER,Ue.ALIGN_BOTTOM_RIGHT=Ue.ALIGN_BOTTOM|Ue.ALIGN_RIGHT;var je=B("qc.Animator",s.Behaviour,function(){var t=this;t.animatorMap={},t.animatorList=[],t.animators=null,t.runInEditor=!0},{animators:s.Serializer.ANIMATORS,playActionManager:s.Serializer.STRING});je.__menu="Action/Animator",e.defineProperties(je.prototype,{animators:{get:function(){return this._animators},set:function(t){for(var e=0;e<this.animatorList.length;e++){var i=this.animatorList[e];i&&i.destroy()}if(this.animatorMap={},this.animatorList=[],this._animators=t,t)for(e=0;e<t.length;e++){var r=t[e];if(r){r instanceof s.ActionManagerAsset?this.animatorList[e]=s.ActionManager.restoreBundle(r,this.game,!this.game.serializer.isRestoring):r instanceof s.ActionAsset&&(this.animatorList[e]=s.Action.restoreBundle(r,this.game,!this.game.serializer.isRestoring)),this.animatorList[e].targetLocked||(this.animatorList[e].targetObject=this.gameObject);var n=this.animatorList[e].name;this.animatorMap[n]&&this.gameObject.game.log.error("Exist duplicate action's name: {0}",n),this.animatorMap[n]=this.animatorList[e]}}}}}),je.prototype.awake=function(){if(!(this.animatorList.length<1))for(var t=0;t<this.animatorList.length;t++)this.animatorList[t]&&this.animatorList[t].awake()},je.prototype.refresh=function(){var t=this.playActionManager;if(ps.ScrFix.isP){if(console.log("Animator.refresh.p"),!qici.config.editor){for(var e in this.gameObject.children)this.gameObject.children[e].uuid===t?this.gameObject.children[e].visible=!0:this.gameObject.children[e].visible=!1;this.play(this.playActionManager)}}else if(console.log("Animator.refresh.l"),!qici.config.editor){for(var e in this.gameObject.children)this.gameObject.children[e].uuid===t?this.gameObject.children[e].visible=!0:this.gameObject.children[e].visible=!1;this.play(this.playActionManager)}},je.prototype.update=function(){for(var t=0;t<this.animatorList.length;t++){var e=this.animatorList[t];e&&e.isRunning&&e.update()}},je.prototype.getAction=function(t){return this.animatorMap[t]||this.animatorList[t]},je.prototype.play=function(t,e,i){t=t||0,this.playActionManager=t;var r=this.getAction(t);if(r){e=e||this.gameObject,i="boolean"!=typeof i||i;var n=s.gameOb.world.children[0]._findByName("gamePlay").getScript("ps.VideoManager");void 0!==n&&n.setVideoAllHide(),r.playAction(e,i)}},je.prototype.stop=function(t){t=t||0;var e=this.getAction(t);e&&e.stop()},je.prototype.destroy=function(){this.animators=null,s.Behaviour.prototype.destroy.call(this)},je.prototype.vpEmitEvent=function(t){console.log(t),ps.mainState.dispatch("VPEMITEVENT",t)};var We=B("qc.AspectRatioFitter",s.Behaviour,function(){var t=this;t.mode=We.NONE,t.ratio=1,t.runInEditor=!0},{mode:s.Serializer.NUMBER,ratio:s.Serializer.NUMBER});We.__menu="UI/AspectRatioFitter",e.defineProperties(We.prototype,{mode:{get:function(){return this._mode||We.NONE},set:function(t){this.mode!==t&&(this._mode=t,this._reset())}},ratio:{get:function(){return this._ratio||1},set:function(t){t<=0&&(t=.001),this.ratio!==t&&(this._ratio=t,this._reset())}}}),We.NONE=0,We.WIDTH_CONTROLS_HEIGHT=1,We.HEIGHT_CONTROLS_WIDTH=2,We.FIT_IN_PARENT=3,We.ENVELOPE_PARENT=4,We.prototype.awake=function(){var t=this;t._reset();var e=t.gameObject;t.addListener(e.onRelayout,function(){t._reset()})},We.prototype._reset=function(){var t=this;if(t.mode!==We.NONE){var e=t.gameObject;if(t.mode!==We.WIDTH_CONTROLS_HEIGHT)if(t.mode!==We.HEIGHT_CONTROLS_WIDTH){var i=e.parent.rect;if(e.setAnchor(new s.Point(0,0),new s.Point(1,1)),t.mode===We.FIT_IN_PARENT){var r=i.width,n=r/t.ratio;return n>i.height&&(n=i.height,r=n*t.ratio),void e.setStretch((i.width-r)/2,(i.width-r)/2,(i.height-n)/2,(i.height-n)/2)}if(t.mode===We.ENVELOPE_PARENT){r=i.width,n=r/t.ratio;return n<i.height&&(n=i.height,r=n*t.ratio),void e.setStretch((i.width-r)/2,(i.width-r)/2,(i.height-n)/2,(i.height-n)/2)}}else e.width=e.height*t.ratio;else e.height=e.width/t.ratio}};var Ve=B("qc.CacheAsBitmap",s.Behaviour,function(){this._boundsType=Ve.BOUNDS_SELF,this._cacheType=Ve.CACHE_FOR_SCREEN,this._dirty=!0,this.boundsInScreen=!1,this.runInEditor=!0,this.offX=0,this.offY=0},{boundsType:s.Serializer.NUMBER,cacheType:s.Serializer.NUMBER,boundsInScreen:s.Serializer.BOOLEAN});Ve.__menu="UI/CacheAsBitmap",e.defineProperties(Ve.prototype,{boundsType:{get:function(){return this._boundsType},set:function(t){this._boundsType!==t&&(this._boundsType=t,this.dirty=!0)}},cacheType:{get:function(){return this._cacheType},set:function(t){this._cacheType!==t&&(this._cacheType=t,this.dirty=!0)}},dirty:{get:function(){return this._dirty},set:function(t){this._dirty!==t&&(this._dirty=t)}}}),Ve.prototype.awake=function(){var t=this,e=t.gameObject;t.addListener(t.game.assets.webFontLoaded,t._setDirty,t),e.onRelayout.add(t._setDirty,t)},Ve.prototype._setDirty=function(){this.dirty=!0},Ve.prototype.onEnable=function(){var t=this,e=t.gameObject;e._destroy||(t._cache||(t._cache=new s.RenderTexture(100,100,this.game.phaser.render,null,this.game.resolution),t._cacheSprite=new h.Sprite(t._cache)),t.dirty=!0,t.gameObject.phaser.setDisplayProxy(t._cacheSprite,!0),t._nodeRenderCanvas||(t._nodeRenderCanvas=t.gameObject.phaser._renderCanvas,t.gameObject.phaser._renderCanvas=t.renderCanvas.bind(t)),t._nodeRenderWebGL||(t._nodeRenderWebGL=t.gameObject.phaser._renderWebGL,t.gameObject.phaser._renderWebGL=t.renderWebGL.bind(t)))},Ve.prototype.onDisable=function(){var t=this;t.gameObject.phaser.setDisplayProxy(null,!1),t.gameObject._notifyCacheChanged(!1),t._nodeRenderCanvas&&(t.gameObject.phaser._renderCanvas=t._nodeRenderCanvas,t._nodeRenderCanvas=null),t._nodeRenderWebGL&&(t.gameObject.phaser._renderWebGL=t._nodeRenderWebGL,t._nodeRenderWebGL=null)},Ve.prototype.onDestroy=function(){var t=this;t.gameObject._notifyCacheChanged(!1),t._nodeRenderCanvas&&(t.gameObject.phaser._renderCanvas=t._nodeRenderCanvas,t._nodeRenderCanvas=null),t._nodeRenderWebGL&&(t.gameObject.phaser._renderWebGL=t._nodeRenderWebGL,t._nodeRenderWebGL=null),t._cache&&(t._cache.destroy(!0),t._cache=null),t._cacheSprite&&(t._cacheSprite=null),t.gameObject.onRelayout.remove(t._setDirty,t)},Ve.prototype._updateCache=function(){var t=this,e=t._cache,i=t._cacheSprite;t._updatingCache=!0;var r=null;r=this._cacheType!==Ve.CACHE_FOR_SCREEN?t._cacheBounds=t.getLocalBounds():t._cacheBounds=t.getBounds(),t.boundsInScreen?(r.x<0&&(r.width+=r.x,r.x=0),r.y<0&&(r.height+=r.y,r.y=0),r.width=Math.round(Math.max(1,Math.min(t.game.width*t.game.resolution-r.x,r.width))),r.height=Math.round(Math.max(1,Math.min(t.game.height*t.game.resolution-r.y,r.height)))):(r.width=Math.round(r.width),r.height=Math.round(r.height)),e.resize(r.width+(1&r.width),r.height+(1&r.height),!0);var n=t.gameObject.worldTransform;if(this._cacheType!==Ve.CACHE_FOR_SCREEN){var a=i.worldTransform;a.a=n.a,a.b=n.b,a.c=n.c,a.d=n.d,a.tx=n.tx,a.ty=n.ty,h.DisplayObject._tempMatrix.tx=-r.x,h.DisplayObject._tempMatrix.ty=-r.y,e.render(t.gameObject.phaser,h.DisplayObject._tempMatrix,!0),i.anchor.x=-r.x/r.width,i.anchor.y=-r.y/r.height}else t.offX=r.x-n.tx,t.offY=r.y-n.ty,i.anchor.x=0,i.anchor.y=0,Ve._tempMatrix.a=n.a,Ve._tempMatrix.b=n.b,Ve._tempMatrix.c=n.c,Ve._tempMatrix.d=n.d,Ve._tempMatrix.tx=Math.round(n.tx-r.x),Ve._tempMatrix.ty=Math.round(n.ty-r.y),e.render(t.gameObject.phaser,Ve._tempMatrix,!0),n=i.worldTransform,n.identity(),n.tx=r.x,n.ty=r.y;t._updatingCache=!1,t.dirty=!1,t.gameObject._isTransformDirty=!0,i.displayChanged(s.DisplayChangeStatus.TEXTURE|s.DisplayChangeStatus.SIZE),t.gameObject.phaser.displayChanged(s.DisplayChangeStatus.TEXTURE|s.DisplayChangeStatus.SIZE),e.baseTexture.scaleMode=h.scaleModes.NEAREST},Ve.prototype.postUpdate=function(){var t=this,e=t._cacheSprite;if(t._updateCache(),t.dirty)t.game.log.trace("[CacheAsBitmap]Update Cache.");else if(t._cacheType!==Ve.CACHE_FOR_SCREEN){var i=e.worldTransform,r=t.gameObject.worldTransform;i.a=r.a,i.b=r.b,i.c=r.c,i.d=r.d,i.tx=r.tx,i.ty=r.ty}else{var n=t.gameObject.worldTransform;r=e.worldTransform;r.identity(),r.tx=n.tx+t.offX,r.ty=n.ty+t.offY}},Ve.prototype.getBounds=function(){var t=this;return t.boundsType===Ve.BOUNDS_SELF?s.Bounds.getBox(t.gameObject,s.Bounds.USE_BOUNDS,!0,0):t.boundsType===Ve.BOUNDS_ALL?s.Bounds.getBox(t.gameObject,s.Bounds.USE_BOUNDS,!0,-1):new s.Rectangle(0,0,1,1)},Ve.prototype.getLocalBounds=function(){var t=this;return t.boundsType===Ve.BOUNDS_SELF?s.Bounds.getBox(t.gameObject,s.Bounds.USE_BOUNDS,!0,0,t.gameObject):t.boundsType===Ve.BOUNDS_ALL?s.Bounds.getBox(t.gameObject,s.Bounds.USE_BOUNDS,!0,-1,t.gameObject):new s.Rectangle(0,0,1,1)},Ve.prototype.renderCanvas=function(t){var e=this,i=e.gameObject;if(!1!==i.phaser.visible&&!1!==i.renderable){if(e._updatingCache&&e._nodeRenderCanvas)return e.gameObject._notifyCacheChanged(!0),void e._nodeRenderCanvas.call(e.gameObject.phaser,t);e._cacheSprite.worldAlpha=e._cacheSprite.alpha=e.gameObject.phaser.worldAlpha,e._cacheSprite._renderCanvas(t)}},Ve.prototype.renderWebGL=function(t){var e=this,i=e.gameObject;if(!1!==i.phaser.visible&&!1!==i.renderable){if(e._updatingCache&&e._nodeRenderWebGL)return e.gameObject._notifyCacheChanged(!0),void e._nodeRenderWebGL.call(e.gameObject.phaser,t);e._cacheSprite.worldAlpha=e._cacheSprite.alpha=e.gameObject.phaser.worldAlpha,e._cacheSprite._renderWebGL(t)}},Ve._tempMatrix=new h.Matrix,e.defineProperties(s.Node.prototype,{cacheAsBitmap:{get:function(){var t=this.getScript("qc.CacheAsBitmap");return t&&t.enable},set:function(t){var e=this.getScript("qc.CacheAsBitmap");(t||e)&&(e||(e=this.addScript("qc.CacheAsBitmap")),e.enable=t)}}}),Ve.BOUNDS_SELF=0,Ve.BOUNDS_ALL=1,Ve.CACHE_FOR_SCREEN=0,Ve.CACHE_FOR_SELF=1;var ze=B("qc.DebugViewer",s.Behaviour,function(){var t=this;t.count=1,t.now=t.game.time.now,t.runInEditor=!0,t.duration=1,t.detail=!1},{debugOn:s.Serializer.BOOLEAN,duration:s.Serializer.NUMBER,detail:s.Serializer.BOOLEAN});ze.__menu="Debug/DebugViewer",e.defineProperties(ze.prototype,{debugOn:{get:function(){return this.game.debug.on},set:function(t){this.game.debug.on=t}}}),ze.prototype.postUpdate=function(){var e=this.game.debug,i=this.game.time.now;if(i-this.now>=1e3*this.duration){var r=1e3*this.count/(i-this.now),n=(e.preUpdate/this.count).toFixed(1),a=(e.update/this.count).toFixed(1),h=(e.postUpdate/this.count).toFixed(1),l=(e.logic/this.count).toFixed(1),u=(e.render/this.count).toFixed(1),c=(e.total/this.count).toFixed(1),p=this.game.phaser.renderer.renderSession.drawCount;null==p&&(p="(N/A)");var d=this.game.phaser._calcTransformCount,f="FPS: "+r.toFixed(1)+"\nDraw Calls: "+p+"\nTotal: "+c+" ms\nLogic: "+l+" ms\nRender: "+u+" ms\nPreUpdate: "+n+" ms\nUpdate: "+a+" ms\nPostUpdate: "+h+" ms\nTransformCalc: "+d;if(this.detail){var _="Canvas";this.game.phaser.renderType===o.WEBGL?_="WebGL":this.game.phaser.renderType==o.HEADLESS&&(_="Headless"),f+="\n------------\nresolution="+this.game.phaser.resolution+"\ndevicePixelRatio="+t.devicePixelRatio+"\nsize="+this.game.width+"*"+this.game.height+"\nrenderType="+_+"\nantialias="+this.game.antialias}this.gameObject instanceof s.UIText?this.gameObject.text=f:this.gameObject instanceof s.Dom&&(f=f.replace(/\n/g,"<br/>"),this.gameObject.innerHTML=f),this.count=1,this.now=i,e.total=0,e.logic=0,e.preUpdate=0,e.update=0,e.postUpdate=0,e.render=0}else this.count++};var Ge=B("qc.DropdownItem",s.Behaviour,function(){var t=this;t.dropdown=null},{checkBackground:s.Serializer.NODE,checkMark:s.Serializer.NODE,text:s.Serializer.NODE,image:s.Serializer.NODE});Ge.__menu="UI/DropdownItem",e.defineProperties(Ge.prototype,{index:{get:function(){return this._index},set:function(t){this._index!==t&&(this._index=t,this.redraw())}}}),Ge.prototype.onDown=function(){this.checkBackground&&(this.checkBackground.visible=!0)},Ge.prototype.onUp=function(){this.checkBackground&&(this.checkBackground.visible=!1)},Ge.prototype.onClick=function(){var t=this;t.index!==t.dropdown.value&&(t.dropdown.value=t.index,t.dropdown.hide())},Ge.prototype.redraw=function(){var t=this,e=t.gameObject,i=t.dropdown.options[t.index];"string"==typeof i?(t.image&&(t.image.visible=!1),t.text.visible=!0,t.text.text=i):(t.text&&(t.text.visible=!1),t.image.visible=!0,t.image.texture=i),t.checkMark&&(t.checkMark.visible=t.index===t.dropdown.value),e.anchoredY=t.index*e.height,t.checkBackground&&(t.checkBackground.visible=!1)};var Ye=B("qc.FilterGroup",s.Behaviour,function(){this._filters=[]},{filters:j.FILTERS,inherited:j.BOOLEAN});Ye.__menu="UI/FilterGroup",e.defineProperties(Ye.prototype,{filters:{get:function(){return this._filters},set:function(t){this._filters=t,this.refresh()}},inherited:{get:function(){return!(this.gameObject&&this.gameObject.filterSelf)},set:function(t){this.gameObject&&(this.gameObject.filterSelf=!t)}}}),Ye.prototype.onDisable=function(){this.gameObject&&!this.gameObject._destroy&&this.refresh()},Ye.prototype.onEnable=function(){this.gameObject&&!this.gameObject._destroy&&this.refresh()},Ye.prototype.onDestroy=function(){this.gameObject&&!this.gameObject._destroy&&this.gameObject.phaser&&(this.gameObject.phaser.filters=null)},Ye.prototype.refresh=function(){this.gameObject&&!this.gameObject._destroy&&(this.enable?this.enable&&(this.gameObject.phaser.filters=this.filters&&this.filters.length>0?this.filters:null):this.gameObject.phaser.filters=null)},Ye.prototype.findFilter=function(t){"string"==typeof t&&(t=s.Util.findClass(t));var e=[];for(var i in this.filters)this.filters[i]instanceof t&&e.push(this.filters[i]);return e},Ye.prototype.removeFilterAt=function(t){if(!(t<0||t>=this.filters.length)){var e=this.filters.splice(t,1);return this.refresh(),e}},Ye.prototype.removeFilter=function(t){"string"==typeof t&&(t=s.Util.findClass(t));var e=[],i=this.filters.length;if("function"==typeof t)for(;i-- >0;)this.filters[i]instanceof t&&e.push(this.filters.splice(i,1));else for(;i-- >0;)this.filters[i]===t&&e.push(this.filters.splice(i,1));return this.refresh(),e},Ye.prototype.addFilter=function(t,e){if("string"==typeof t&&(t=s.Util.findClass(t),"function"!=typeof t))return null;if("function"==typeof t)t=new t(this.game);else for(e=this.filters.length;e-- >0;)if(this.filters[e]===t)return;return isNaN(e)||e<0||e>this.filters.length?this.filters.push(t):this.filters.splice(e,0,t),this.refresh(),t};var Xe=B("qc.HorizontalLayout",s.TableLayout,function(){this.style=s.TableLayout.STYLE_RESIZE_ELEMENT,this.constraint=s.TableLayout.CONSTRAINT_FIX_ROW_COUNT,this.contentSizeProvider=s.TableLayout.USE_RECTTRANSFORM,this.stride=1,this.startCorner=s.TableLayout.CORNER_TOP_LEFT,this.startAxis=s.TableLayout.AXIS_HORIZONTAL},{childForceExpandWidth:s.Serializer.NUMBER,childForceExpandHeight:s.Serializer.NUMBER});Xe.__menu="UI/Layout/HorizontalLayout",e.defineProperties(Xe.prototype,{spacing:{get:function(){return this.spacingX},set:function(t){this.spacingX=t}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(t){this._childForceExpandWidth!==t&&(this._childForceExpandWidth=t,this.rebuildTable())}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(t){this._childForceExpandHeight!==t&&(this._childForceExpandHeight=t,this.rebuildTable())}}}),Xe.prototype._getDefaultLayout=function(t){return"x"===t?{min:0,preferred:0,flexible:this.childForceExpandWidth?1:0,extra:0}:{min:0,preferred:this.childForceExpandHeight?this.gameObject.rect.height:-1,flexible:1,extra:0}},Xe.prototype.getCellLayout=function(t){var e=s.LayoutElement.getLayoutElement(t);return this.childForceExpandWidth&&(e.flexibleWidth=1),this.childForceExpandHeight&&(e.flexibleHeight=1),e};var He=B("qc.NodeMask",s.Behaviour,function(){this._mask=this.gameObject.game.phaser.add.graphics(0,0),this._mask.parent&&this._mask.parent.remove(this._mask),this.gameObject.onTextureChanged&&this.addListener(this.gameObject.onTextureChanged,this._doTextureChange,this),this.gameObject.onTransformChanged&&this.addListener(this.gameObject.onTransformChanged,this._doTransformChanged,this),this.onEnable(),this.runInEditor=!0},{checkInField:s.Serializer.BOOLEAN,minAnchor:s.Serializer.GEOM,maxAnchor:s.Serializer.GEOM,minRotation:s.Serializer.NUMBER,maxRotation:s.Serializer.NUMBER,clipType:s.Serializer.NUMBER,mode:s.Serializer.NUMBER});He.__menu="UI/NodeMask",e.defineProperties(He.prototype,{checkInField:{get:function(){return!!this._checkInField},set:function(t){this._checkInField!==t&&(this._checkInField=t,t||this._resetRenderAble(this.gameObject))}},minAnchor:{get:function(){return this._minAnchor||new s.Point(0,0)},set:function(t){this.setMask(t)}},maxAnchor:{get:function(){return this._maxAnchor||new s.Point(1,1)},set:function(t){this.setMask(null,t)}},minRotation:{get:function(){return void 0!==this._minRotation||null===this._minRotation?this._minRotation:0},set:function(t){this.setMask(null,null,t)}},maxRotation:{get:function(){return void 0!==this._maxRotation||null===this._maxRotation?this._maxRotation:2*Math.PI},set:function(t){this.setMask(null,null,null,t)}},clipType:{get:function(){return He.CLIP_STENCIL},set:function(t){}},mode:{get:function(){return this._mode||He.MODE_DEFAULT},set:function(t){this._mode!==t&&(this._mode=t,this._refresh())}},customGraphics:{get:function(){return this._customGraphics||(this._customGraphics=this.game.phaser.add.graphics(0,0),this._customGraphics.parent&&this._customGraphics.parent.remove(this._customGraphics)),this._customGraphics}},_maskFilter:{get:function(){return this.__maskFilter||(this.__maskFilter=new s.Filter.AlphaMask(this.game),this.__maskFilter.otherTexture=new s.Filter.FilterTexture(this.game),this.__maskFilter.otherTexture.texture=this.gameObject.texture,this.__maskFilter.otherTexture.frame=this.gameObject.frame),this.__maskFilter}},_graphicsFilter:{get:function(){return this.__graphicsFilter||(this.__graphicsFilter=new s.Filter.AlphaMask(this.game),this.__graphicsFilter.otherTexture=new s.Filter.GraphicsTexture(this.game)),this.__graphicsFilter}}}),He.prototype.onEnable=function(){this._refresh()},He.prototype.onDisable=function(){this._refresh()},He.prototype.onDestroy=function(){this.gameObject.phaser.mask=null,this.gameObject.phaser.softClip=null,this.gameObject.phaser.maskPixel=null,this.gameObject.phaser._graphicsFilter=null,this.gameObject._destroy||this._resetRenderAble(this.gameObject)},He.prototype._doTextureChange=function(){this.__maskFilter&&(this.__maskFilter.otherTexture.texture=this.gameObject.texture,this.__maskFilter.otherTexture.frame=this.gameObject.frame)},He.prototype._doTransformChanged=function(){this.postUpdate()},He.prototype._isNeedUseClipReplaceStencil=function(){return!this.game.device.phaser.supportStencil&&this.game.phaser.renderType===o.WEBGL&&this.clipType===He.CLIP_STENCIL},He.prototype._refresh=function(){this._isNeedUseClipReplaceStencil()?(this.gameObject.phaser.softClip=null,this.gameObject.phaser.mask=null,this.gameObject.phaser.maskPixel=null,this._graphicsFilter.otherTexture.updateTexture(),this.gameObject.phaser._graphicsFilter=this.enable?{target:this.gameObject.phaser,filterPasses:this._graphicsFilter.passes}:null):this.game.phaser.renderType!==o.WEBGL||this.clipType===He.CLIP_STENCIL?(this.gameObject.phaser.mask=this.enable&&this.mode!==He.MODE_PIXEL?this.mode===He.MODE_GRAPHICS?this.customGraphics:this._mask:null,this.gameObject.phaser.maskPixel=this.enable&&this.mode===He.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null,this.gameObject.phaser.softClip=null,this.gameObject._destroy||this._resetRenderAble(this.gameObject),this.gameObject.phaser._clipTexture=null,this.gameObject.phaser._graphicsFilter=null):(this.gameObject.phaser.softClip=this.enable&&this.mode!==He.MODE_PIXEL?this._softClip:null,this.gameObject.phaser.maskPixel=this.enable&&this.mode===He.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null,this.gameObject.phaser.mask=null,this.gameObject.phaser._clipTexture=null,this.gameObject.phaser._graphicsFilter=null)},He.prototype.postUpdate=function(){if(this.enable&&this.mode===He.MODE_DEFAULT&&(this._updateMask(),this._checkInField))for(var t=this.gameObject.children,e=this.gameObject.getWorldBox(),i=0;i<t.length;i++)this._checkRenderable(e,t[i])},He.prototype.setMask=function(t,e,i,r){var n=t||this.minAnchor,a=e||this.maxAnchor;if(i=null==i?this.minRotation:i,r=null==r?this.maxRotation:r,n.x<0&&(n.x=0),n.y<0&&(n.y=0),n.x>1&&(n.x=1),n.y>1&&(n.y=1),a.x<0&&(a.x=0),a.y<0&&(a.y=0),a.x>1&&(a.x=1),a.y>1&&(a.y=1),n.x>a.x||n.y>a.y)throw new Error("Expected:min < max");if(r<i)throw new Error("Expected:minRotation < maxRotation");n.x===this.minAnchor.x&&n.y===this.minAnchor.y&&a.x===this.maxAnchor.x&&a.y===this.maxAnchor.y&&i===this.minRotation&&r===this.maxRotation||(this._minAnchor=n,this._maxAnchor=a,this._minRotation=i,this._maxRotation=r,this._maskForceChange=!0,this.gameObject.phaser.displayChanged(s.DisplayChangeStatus.SIZE))},He.prototype._updateMask=function(){var t=this._mask,e=this.gameObject.worldTransform,i=this.gameObject.rect,r=[i.x,i.y,i.width,i.height,e.a,e.b,e.c,e.d,e.tx,e.ty];if(this._maskForceChange||!this._lastMaskRect||this._lastMaskRect[0]!==r[0]||this._lastMaskRect[1]!==r[1]||this._lastMaskRect[2]!==r[2]||this._lastMaskRect[3]!==r[3]||this._lastMaskRect[4]!==r[4]||this._lastMaskRect[5]!==r[5]||this._lastMaskRect[6]!==r[6]||this._lastMaskRect[7]!==r[7]||this._lastMaskRect[8]!==r[8]||this._lastMaskRect[9]!==r[9]){this._maskForceChange=!1,this._lastMaskRect=r;var n=this.minAnchor,a=this.maxAnchor,o=this.minRotation,h=this.maxRotation,l=i.x+n.x*i.width,u=i.y+n.y*i.height,c=i.x+a.x*i.width,p=i.y+a.y*i.height,d=this.gameObject.getWorldScale(),f=d.x*d.y<0,_=(l+c)/2,g=(u+p)/2,m=null;if(h-o>=2*Math.PI)m=[new s.Point(l,u),new s.Point(c,u),new s.Point(c,p),new s.Point(l,p)];else{for(var y,v,T,x=2*Math.PI,b=Math.atan2(p-u,c-l);o<-b||o>x-b;){var A=o<0?x:-x;o+=A,h+=A}o>=-b&&o<b?(y=c,v=g+(c-_)*Math.tan(o),T=0):o<Math.PI-b?(v=p,y=_+(p-g)/Math.tan(o),T=1):o<Math.PI+b?(y=l,v=g+(_-l)*Math.tan(Math.PI-o),T=2):(v=u,y=_+(g-u)/Math.tan(x-o),T=3);for(var S,w,P=0;h>x-b;)h-=x,P+=4;h>=-b&&h<b?(S=c,w=g+(c-_)*Math.tan(h),P+=0):h<Math.PI-b?(w=p,S=_+(p-g)/Math.tan(h),P+=1):h<Math.PI+b?(S=l,w=g+(_-l)*Math.tan(Math.PI-h),P+=2):(w=u,S=_+(g-u)/Math.tan(x-h),P+=3);var E=[new s.Point(c,p),new s.Point(l,p),new s.Point(l,u),new s.Point(c,u)];for(m=[new s.Point(_,g),new s.Point(y,v)];T<P;)m.push(E[T%4]),T++;m.push(new s.Point(S,w))}if(!this._isNeedUseClipReplaceStencil()){for(var D=0;D<m.length;D++)m[D]=e.apply(m[D]);f&&m.reverse()}if(this._softClip=m,this._isNeedUseClipReplaceStencil()){var C=this.gameObject.phaser.getBounds(),O=this._graphicsFilter.otherTexture;O.resize(C.width,C.height),O.offset.x=-C.x,O.offset.y=-C.y;var M=O.graphics;M.clear(),M.beginFill(16777215),M.drawPolygon(m),M.worldTransform=this.gameObject.worldTransform}else t.clear(),t.beginFill(16777215),t.drawPolygon(m);this._refresh()}},He.prototype._checkRenderable=function(t,e){var i=e.getWorldBox();s.Rectangle.intersects(t,i)?e.renderable=!0:e.renderable=!1;for(var r=e.children,n=0;n<r.length;n++)this._checkRenderable(t,r[n])},He.prototype._resetRenderAble=function(t){if(t){t.renderable=!0;for(var e=t.children,i=0;i<e.length;i++)this._resetRenderAble(e[i])}},
He.MODE_DEFAULT=0,He.MODE_PIXEL=1,He.MODE_GRAPHICS=2,He.CLIP_STENCIL=1;var qe=B("qc.NonexistScript",s.Behaviour,function(){this.script="",this.data={}},{});qe.__hiddenInMenu=!0;var Ke=B("qc.ScaleAdapter",s.Behaviour,function(){var t=this;t.target=null,t.referenceResolution=new s.Point(0,0),t.manualType=Ke.NONE,t.gameObjectRecord=t.gameObject?[t.gameObject.scaleX,t.gameObject.scaleY,t.gameObject.width,t.gameObject.height]:[],t._fullTarget=!1,t.runInEditor=!0},{target:s.Serializer.NODE,referenceResolution:s.Serializer.GEOM,manualType:s.Serializer.NUMBER,fullTarget:s.Serializer.BOOLEAN,gameObjectRecord:s.Serializer.NUMBERS});Ke.__hiddenInMenu=!0,e.defineProperties(Ke.prototype,{fullTarget:{get:function(){return this._fullTarget},set:function(t){this._fullTarget!==t&&(this._fullTarget=t,!t&&this.gameObject&&(this.gameObject.width=this.gameObjectRecord[2],this.gameObject.height=this.gameObjectRecord[3]),this._forceUpdate=!0)}}}),Ke.NONE=0,Ke.MANUAL_HEIGHT=1,Ke.MANUAL_WIDTH=2,Ke.EXPAND=3,Ke.SHRINK=4,Ke.FILL=5,Ke.prototype.awake=function(){if(this.game.fixedGameSize){var t=this.gameObject;t.width=this.game.world.width,t.height=this.game.world.height,t.scaleX=1,t.scaleY=1}},Ke.prototype.onEnable=function(){var t=this,e=t.gameObject,i=t.gameObjectRecord;i[0]=e.scaleX,i[1]=e.scaleY,i[2]=e.width,i[3]=e.height},Ke.prototype.onDisable=function(){var t=this,e=t.gameObject,i=t.gameObjectRecord;i.length<4||null===i[0]||isNaN(i[0])||(e.scaleX=i[0],e.scaleY=i[1],e.width=i[2],e.height=i[3])},Ke.prototype.preUpdate=function(){var t=this;if(!t.game.fixedGameSize){var e=t.gameObject;if(e&&e.scaleX){var i=t.getTargetSize(),r=t.getReferenceResolution();if(0!==i.x&&0!==i.y&&0!==r.x&&0!==r.y){var n=1,a=1;switch(this.manualType){case s.ScaleAdapter.MANUAL_HEIGHT:a=n=i.y/r.y;break;case s.ScaleAdapter.MANUAL_WIDTH:a=n=i.x/r.x;break;case s.ScaleAdapter.EXPAND:a=n=Math.min(i.x/r.x,i.y/r.y);break;case s.ScaleAdapter.SHRINK:a=n=Math.max(i.x/r.x,i.y/r.y);break;case s.ScaleAdapter.FILL:n=i.x/r.x,a=i.y/r.y}isNaN(n)||isNaN(a)||(this.fullTarget&&(this.gameObject.width=i.x/n,this.gameObject.height=i.y/a),(this._forceUpdate||this.gameObject.scaleX!==n||this.gameObject.scaleY!==a)&&(this._forceUpdate=!1,this.gameObject.scaleX=n,this.gameObject.scaleY=a))}}}},Ke.prototype.onDestroy=function(){this.target=null},Ke.prototype.getTargetSize=function(){var t=this.target||this.gameObject.game.world;return t&&t.width&&t.height?new s.Point(t.width,t.height):new s.Point(0,0)},Ke.prototype.getReferenceResolution=function(){return this.referenceResolution};var Je=s.defineBehaviour("qc.ToggleGroup",s.Behaviour,function(){this._toggles=[],this.runInEditor=!0,this.onValueChange=new s.Signal},{toggles:s.Serializer.NODES,allowSwitchOff:s.Serializer.BOOLEAN});Je.__menu="UI/ToggleGroup",e.defineProperties(Je.prototype,{toggle:{get:function(){for(var t=0;t<this._toggles.length;t++){var e=this._toggles[t];if(e&&e.on)return e}return null},set:function(t){var e=this._toggles.indexOf(t);if(-1!==e){for(var i=0;i<this._toggles.length;i++){var r=this._toggles[i];r&&(r.on=r===t)}this.onValueChange.dispatch(this,t,!0)}else this.game.log.error("target is not in this group")}},toggles:{get:function(){return this._toggles},set:function(t){var e=this;e._toggles.forEach(function(t){t&&(t.onValueChange.remove(e._onValueChange,e),t.canValueChange.remove(e._canValueChange,e))}),e._toggles=t||[],e._toggles.forEach(function(t){t&&(t.onValueChange.add(e._onValueChange,e),t.canValueChange.add(e._canValueChange,e))})}},allowSwitchOff:{get:function(){var t=this._allowSwitchOff;return t===i||t},set:function(t){t=!!t;var e=this.allowSwitchOff;e!==t&&(this._allowSwitchOff=t,t||this._assureSelection())}}}),Je.prototype._assureSelection=function(){if(null==this.toggle){var t=this.toggles;if(t&&t.length){var e=t[0];e&&(e.on=!0)}}},Je.prototype.add=function(t){-1===this._toggles.indexOf(t)&&(this._toggles.push(t),t.on=!1,t.onValueChange.add(this._onValueChange,this),t.canValueChange.add(this._canValueChange,this),this.allowSwitchOff||this._assureSelection())},Je.prototype.remove=function(t){var e=this._toggles.indexOf(t);-1!==e&&(this._toggles.splice(e,1),t.onValueChange.remove(this._onValueChange,this),t.canValueChange.remove(this._canValueChange,this),this.allowSwitchOff||this._assureSelection())},Je.prototype._canValueChange=function(t,e,i,r){if(!this.allowSwitchOff&&i&&!e){for(var n=!1,a=0,s=this.toggles.length;a<s;a++){var o=this.toggles[a];if(o!==t){if(o&&o.on)return}else n=!0}n&&(r.ignore=!0)}},Je.prototype._onValueChange=function(t){t.on?this.toggle=t:this.toggle||this.onValueChange.dispatch(this,t,!1)};var Ze=s.defineBehaviour("qc.TransitionBehaviour",s.Behaviour,function(){if(this.gameObject.state===i)throw new Error("The target node does not have the interactive function, and can not be added to this component.");this.target=this.gameObject,this._transition=s.Transition.TEXTURE_SWAP},{target:s.Serializer.NODE,_transition:s.Serializer.NUMBER,_normalTexture:{get:function(t,e){return this._saveTexture(t._normalTexture,e)},set:function(t,e){this._normalTexture=this._restoreTexture(e,t)}},_pressedTexture:{get:function(t,e){return this._saveTexture(t._pressedTexture,e)},set:function(t,e){this._pressedTexture=this._restoreTexture(e,t)}},_disabledTexture:{get:function(t,e){return this._saveTexture(t._disabledTexture,e)},set:function(t,e){this._disabledTexture=this._restoreTexture(e,t)}},_normalColor:s.Serializer.COLOR,_pressedColor:s.Serializer.COLOR,_disabledColor:s.Serializer.COLOR});Ze.__menu="UI/TransitionBehaviour",e.defineProperties(Ze.prototype,{target:{get:function(){return this._target},set:function(t){this._target=t,this._reset()}},transition:{get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition=t,this.target&&this._reset())}},normalTexture:{get:function(){return this._normalTexture},set:function(t){t!==this._normalTexture&&(this._normalTexture=t,this.target&&this.gameObject.state===s.UIState.NORMAL&&this.transition===s.Transition.TEXTURE_SWAP&&(this.target.texture=this.normalTexture))}},pressedTexture:{get:function(){return this._pressedTexture},set:function(t){t!==this._pressedTexture&&(this._pressedTexture=t,this.target&&this.gameObject.state===s.UIState.PRESSED&&this.transition===s.Transition.TEXTURE_SWAP&&(this.target.texture=this.pressedTexture))}},disabledTexture:{get:function(){return this._disabledTexture},set:function(t){t!==this._disabledTexture&&(this._disabledTexture=t,this.target&&this.gameObject.state===s.UIState.DISABLED&&this.transition===s.Transition.TEXTURE_SWAP&&(this.target.texture=this.disabledTexture))}},normalColor:{get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&this.target&&(t=t||vt.white,t instanceof vt?(this._normalColor=t,this.gameObject.state===s.UIState.NORMAL&&this.transition===s.Transition.COLOR_TINT&&(this.target.colorTint=this.normalColor)):this.game.log.error("Expected qc.Color, got:{0}",t))}},pressedColor:{get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this.target&&(t=t||vt.grey,t instanceof vt?(this._pressedColor=t,this.gameObject.state===s.UIState.PRESSED&&this.transition===s.Transition.COLOR_TINT&&(this.target.colorTint=this.pressedColor)):this.game.log.error("Expected qc.Color, got:{0}",t))}},disabledColor:{get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&this.target&&(t=t||vt.grey,t instanceof vt?(this._disabledColor=t,this.gameObject.state===s.UIState.DISABLED&&this.transition===s.Transition.COLOR_TINT&&(this.target.colorTint=this.disabledColor)):this.game.log.error("Expected:qc.Color, got:{0}",t))}},pressedAnimation:{get:function(){return this._pressedAnimation},set:function(t){this._pressedAnimation!==t&&(this._pressedAnimation=t)}}}),Ze.prototype._normalColor=vt.white,Ze.prototype._pressedColor=vt.grey,Ze.prototype._disabledColor=vt.grey,Ze.prototype.awake=function(){this.addListener(this.gameObject.onStateChange,this._reset,this),this._reset()},Ze.prototype._saveTexture=function(t,e){return this.gameObject.game.serializer._saveTextureItem(t,e)},Ze.prototype._restoreTexture=function(t,e){if(t&&t.length&&t[0]===s.Serializer.STRING){var i=e.gameObject.texture;return i&&i.atlas.frameNames.indexOf(t[1])>=0?e.gameObject.texture.atlas.getTexture(t[1]):null}return this.gameObject.game.serializer._restoreTextureItem(t)},Ze.prototype._reset=function(){if(this.target&&this.enable)switch(this.transition){case s.Transition.NONE:break;case s.Transition.TEXTURE_SWAP:switch(this.gameObject.state){case s.UIState.NORMAL:this.normalTexture&&(this.target.texture=this.normalTexture);break;case s.UIState.PRESSED:this.pressedTexture&&(this.target.texture=this.pressedTexture);break;case s.UIState.DISABLED:this.disabledTexture&&(this.target.texture=this.disabledTexture)}break;case s.Transition.COLOR_TINT:switch(this.gameObject.state){case s.UIState.NORMAL:this.target.colorTint=this.normalColor;break;case s.UIState.PRESSED:this.target.colorTint=this.pressedColor;break;case s.UIState.DISABLED:this.target.colorTint=this.disabledColor}break;case s.Transition.ANIMATION:}};var Qe=B("qc.Tween",s.Behaviour,function(){this._curve=new s.BezierCurve(new s.Keyframe(0,0,1,1),new s.Keyframe(1,1,1,1)),this._started=!1,this._startTime=0,this._amountPerDelta=1e3,this._factor=0,this.duration=1,this.runInEditor=!0,this.flag="",this.playOnAwake=!1,this.canRunInEditor=!1,this.animationName=""},{_curve:s.Serializer.GEOM,sampleMethod:s.Serializer.NUMBER,style:s.Serializer.NUMBER,delay:s.Serializer.NUMBER,duration:s.Serializer.NUMBER,tweenGroup:s.Serializer.NUMBER,flag:s.Serializer.STRING,playOnAwake:s.Serializer.BOOLEAN,addType:s.Serializer.NUMBER,animationId:s.Serializer.STRING,animationName:s.Serializer.STRING,builtinId:s.Serializer.STRING,builtinGroup:s.Serializer.STRING});Qe.__hiddenInMenu=!0,e.defineProperties(Qe.prototype,{curve:{get:function(){return this._curve}},sampleMethod:{get:function(){return this._sampleMethod||Qe.SAMPLE_LINEAR},set:function(t){this._sampleMethod!==t&&(this._sampleMethod=t)}},style:{get:function(){return this._style||0},set:function(t){this._style!==t&&(this._style=t)}},delay:{get:function(){return isNaN(this._delay)||this._delay<0?0:this._delay},set:function(t){this._delay!==t&&(this._delay=t)}},duration:{get:function(){return isNaN(this._duration)||this._duration<0?0:this._duration},set:function(t){this._duration!==t&&(this._duration=t,this._amountPerDelta=Math.abs(t>0?1/(1e3*t):1e3)*(this._amountPerDelta>=0?1:-1))}},tweenGroup:{get:function(){return this._tweenGroup||0},set:function(t){this._tweenGroup!==t&&(this._tweenGroup=t)}},onStart:{get:function(){return this._onStart||(this._onStart=new o.Signal),this._onStart}},onFinished:{get:function(){return this._onFinished||(this._onFinished=new o.Signal),this._onFinished}},onLoopFinished:{get:function(){return this._onLoopFinished||(this._onLoopFinished=new o.Signal),this._onLoopFinished}},amountPerDelta:{get:function(){return this._amountPerDelta}},tweenFactor:{get:function(){return this._factor},set:function(t){this._factor=o.Math.clamp(t,0,1)}},direction:{get:function(){return this.amountPerDelta<0?Qe.DIR_REVERSE:Qe.DIR_FORWARD}}}),Qe.prototype.awake=function(){var t=this;this.scene=null,t._started||(t.enable=!1,ps.mainState.add("scenechange",function(e){t.getCurrentScene(),t.scene.uuid===e&&t.playOnAwake&&(t.resetToBeginning(),t.playForward())},this))},Qe.prototype.getCurrentScene=function(){for(var t=this.gameObject;!t.parent.getScript("ps.VPGamePlay");)t=t.parent;this.scene=t},Qe.prototype._lineSample=function(t){return t},Qe.prototype.start=function(){this.update()},Qe.prototype.update=function(){if(this.enable&&(!this.gameObject||!this.game.device.editor||this.canRunInEditor)){var t=this.game.time.deltaTime,e=this.game.time.scaledTime;this._started||(this._started=!0,this._dispatchStart=!1,this._startTime=e+1e3*this.delay),e<this._startTime||(e===this._startTime?t=0:e-this._startTime<t&&(t=e-this._startTime),this._dispatchStart||(this._dispatchStart=!0,this._onStart&&this._onStart.dispatch(this)),this._factor+=this.amountPerDelta*t,this.style===Qe.STYLE_LOOP?this._factor>1&&(this._factor-=Math.floor(this._factor),this._onLoopFinished&&this._onLoopFinished.dispatch(this)):this.style===Qe.STYLE_PINGPONG&&(this._factor>1?(this._factor=1-(this._factor-Math.floor(this._factor)),this._amountPerDelta=-this._amountPerDelta,this._onLoopFinished&&this._onLoopFinished.dispatch(this)):this._factor<0&&(this._factor=-this._factor,this._factor-=Math.floor(this._factor),this._amountPerDelta=-this._amountPerDelta,this._onLoopFinished&&this._onLoopFinished.dispatch(this))),this.style===Qe.STYLE_ONCE&&(0===this.duration||this._factor>1||this._factor<0)?(this._factor=o.Math.clamp(this._factor,0,1),this.sample(this._factor,!0),this._onFinished&&this._onFinished.dispatch(this),(0===this.duration||1===this._factor&&this._amountPerDelta>0||0===this._factor&&this._amountPerDelta<0)&&(this.enable=!1)):this.sample(this._factor,!1))}},Qe.prototype.onDisable=function(){this._started=!1,this.canRunInEditor=!1},Qe.prototype.sample=function(t,e){var i=o.Math.clamp(t,0,1);switch(this.sampleMethod){case Qe.SAMPLE_LINEAR:i=this._lineSample(i)}this.onUpdate(this.curve.evaluate(i),e)},Qe.prototype._funcGroup=function(t){var e=this;0!==e.tweenGroup?Qe._funcGroup(e.gameObject,e.tweenGroup,t):t(e)},Qe.prototype.reset=function(t){this._started||(t?this.setEndToCurrValue():this.setStartToCurrValue())},Qe.prototype.resetGroup=function(t){var e=function(e){e.reset(t)};this._funcGroup(e)},Qe.prototype.playForward=function(t){var e=this,i=e.gameObject.getScripts(s.TweenPosition),r=i.indexOf(e);if(r>=1){var n=new s.Point(e.to.x-e.from.x,e.to.y-e.from.y),a=i[r-1];e.from=a.to,e.to=new s.Point(e.from.x+n.x,e.from.y+n.y)}t&&e.resetToBeginning(),e.play(!1)},Qe.prototype.playGroupForward=function(t){var e=function(e){e.playForward(t)};this._funcGroup(e)},Qe.prototype.playReverse=function(t){t&&this.resetToBeginning(!0),this.play(!0)},Qe.prototype.playGroupReverse=function(t){var e=function(e){e.playReverse(t)};this._funcGroup(e)},Qe.prototype.stop=function(){this.enable=!1,this.canRunInEditor=!1},Qe.prototype.stopGroup=function(){var t=function(t){t.stop()};this._funcGroup(t)},Qe.prototype.play=function(t){this._amountPerDelta=Math.abs(this.amountPerDelta)*(t?-1:1),this.enable=!0,this.canRunInEditor=!0,this.update()},Qe.prototype.playGroup=function(t){var e=function(e){e.play(t)};this._funcGroup(e)},Qe.prototype.resetToBeginning=function(t){this._started=!1,this._amountPerDelta=Math.abs(this.amountPerDelta)*(t?-1:1),this._factor=this.amountPerDelta<0?1:0,this.sample(this._factor,!1),t?this.setEndToCurrValue():this.setStartToCurrValue()},Qe.prototype.resetGroupToBeginning=function(t){var e=function(e){e.resetToBeginning(t)};this._funcGroup(e)},Qe.prototype.toggle=function(){this._factor>0?this._amountPerDelta=-this.amountPerDelta:this._amountPerDelta=Math.abs(this.amountPerDelta),this.enable=!0},Qe.prototype.onUpdate=function(t,e){},Qe.prototype.setStartToCurrValue=function(){},Qe.prototype.setEndToCurrValue=function(){},Qe.prototype.setCurrToStartValue=function(){},Qe.prototype.setCurrToEndValue=function(){},Qe.begin=function(t,e,i){var r=e.getScript(t,!1);if(r&&0!=r.tweenGroup){r=null;for(var n=e.getScripts(t,!1),a=0;a<n.length;++a)if(n[a]&&0===n[a].tweenGroup){r=n[a];break}}if((r||(r=e.addScript(t),r))&&r instanceof Qe)return r._started=!1,r.duration=i,r._factor=0,r._amountPerDelta=Math.abs(r.amountPerDelta),r.style=Qe.STYLE_ONCE,r._curve=new s.BezierCurve(new s.Keyframe(0,0,1,1),new s.Keyframe(1,1,1,1)),r.enable=!0,r},Qe._funcGroup=function(t,e,i){for(var r=t.getScripts?t.getScripts("qc.Tween"):[],n=r.length;n-- >0;)r[n].tweenGroup===e&&i(r[n]);var a=t.children;if(a)for(var s=a.length;s-- >0;){var o=a[s];Qe._funcGroup(o,e,i)}},Qe.resetGroup=function(t,e,i){var r=function(t){t.reset(i)};Qe._funcGroup(t,e,r)},Qe.playGroupForward=function(t,e){var i=function(t){t.playForward()};Qe._funcGroup(t,e,i)},Qe.playGroupReverse=function(t,e){var i=function(t){t.playReverse()};Qe._funcGroup(t,e,i)},Qe.stopGroup=function(t,e){var i=function(t){t.stop()};Qe._funcGroup(t,e,i)},Qe.playGroup=function(t,e,i){var r=function(t){t.play(i)};Qe._funcGroup(t,e,r)},Qe.resetGroupToBeginning=function(t,e,i){var r=function(t){t.resetToBeginning(i)};Qe._funcGroup(t,e,r)},Qe.STYLE_ONCE=0,Qe.STYLE_LOOP=1,Qe.STYLE_PINGPONG=2,Qe.DIR_FORWARD=0,Qe.DIR_REVERSE=1,Qe.SAMPLE_LINEAR=0;var $e=B("qc.TweenAlpha",s.Tween,function(){var t=this;t.from=0,t.to=1,t.enable=!1},{from:s.Serializer.NUMBER,to:s.Serializer.NUMBER});$e.__menu="Tween/TweenAlpha",$e.prototype.onUpdate=function(t,e){var i=this,r=i.from,n=i.to;i.gameObject.alpha=o.Math.clamp(r+t*(n-r),0,1)},$e.prototype.setStartToCurrValue=function(){this.gameObject.alpha=this.from},$e.prototype.setEndToCurrValue=function(){this.gameObject.alpha=this.to},$e.prototype.setCurrToStartValue=function(){this.from=this.gameObject.alpha},$e.prototype.setCurrToEndValue=function(){this.to=this.gameObject.alpha},$e.begin=function(t,e,i){var r=s.Tween.begin("qc.TweenAlpha",t,e);return r.from=t.alpha,r.to=i,e<=0&&(r.sample(1,!0),r.enable=!1),r};var ti=B("qc.TweenColor",s.Tween,function(){var t=this;t.from=vt.black,t.to=vt.white,t.enable=!1},{from:s.Serializer.COLOR,to:s.Serializer.COLOR});ti.__menu="Tween/TweenColor",ti.prototype.onUpdate=function(t,e){var i=this,r=i.from.rgb,n=i.to.rgb,a=[o.Math.clamp(Math.round(r[0]+t*(n[0]-r[0])),0,255),o.Math.clamp(Math.round(r[1]+t*(n[1]-r[1])),0,255),o.Math.clamp(Math.round(r[2]+t*(n[2]-r[2])),0,255),o.Math.clamp(i.from.alpha+t*(i.to.alpha-i.from.alpha),0,1)],s=new vt(a);i.gameObject.colorTint=s},ti.prototype.setStartToCurrValue=function(){this.gameObject.colorTint=new vt(this.from.toString())},ti.prototype.setEndToCurrValue=function(){this.gameObject.colorTint=new vt(this.to.toString())},ti.prototype.setCurrToStartValue=function(){this.from=new vt(this.gameObject.colorTint.toString())},ti.prototype.setCurrToEndValue=function(){this.to=new vt(this.gameObject.colorTint.toString())},ti.begin=function(t,e,i){var r=s.Tween.begin("qc.TweenColor",t,e);return r.from=new vt(t.colorTint.toString()),r.to=i,e<=0&&(r.sample(1,!0),r.enable=!1),r};var ei=B("qc.TweenPosition",s.Tween,function(){var t=this;t.from=new s.Point(0,0),t.to=new s.Point(0,0),t.moveAxis=ei.BOTH,t.isReSet=!1,t.enable=!1},{from:s.Serializer.POINT,to:s.Serializer.POINT,moveAxis:s.Serializer.NUMBER});ei.__menu="Tween/TweenPosition",ei.prototype.onUpdate=function(t,e){var i=this,r=i.from,n=i.to;0!=(i.moveAxis&ei.ONLY_X)&&(i.gameObject.x=r.x+t*(n.x-r.x)),0!=(i.moveAxis&ei.ONLY_Y)&&(i.gameObject.y=r.y+t*(n.y-r.y))},ei.prototype.updateFromAndTo=function(){var t=new s.Point(this.to.x-this.from.x,this.to.y-this.from.y);this.from=new s.Point(this.gameObject.x,this.gameObject.y),this.to=new s.Point(this.gameObject.x+t.x,this.gameObject.y+t.y)},ei.prototype.setStartToCurrValue=function(){0!=(this.moveAxis&ei.ONLY_X)&&(this.gameObject.x=this.from.x),0!=(this.moveAxis&ei.ONLY_Y)&&(this.gameObject.y=this.from.y)},ei.prototype.setEndToCurrValue=function(){0!=(this.moveAxis&ei.ONLY_X)&&(this.gameObject.x=this.to.x),0!=(this.moveAxis&ei.ONLY_Y)&&(this.gameObject.y=this.to.y)},ei.prototype.setCurrToStartValue=function(){this.from=new s.Point(this.gameObject.x,this.gameObject.y)},ei.prototype.setCurrToEndValue=function(){this.to=new s.Point(this.gameObject.x,this.gameObject.y)},ei.begin=function(t,e,i){var r=s.Tween.begin("qc.TweenPosition",t,e);return r.from=new s.Point(t.x,t.y),r.to=i.clone(),e<=0&&(r.sample(1,!0),r.enable=!1),r},ei.BOTH=255,ei.ONLY_X=1,ei.ONLY_Y=2;var ii=B("qc.TweenProperty",s.Tween,function(){var t=this;t.from=0,t.to=1,t.property="",t.enable=!1},{from:s.Serializer.NUMBER,to:s.Serializer.NUMBER,property:s.Serializer.STRING});ii.__menu="Tween/TweenProperty",e.defineProperties(ii.prototype,{property:{get:function(){return this._property},set:function(t){if(t!==this._property){for(var e=t.split("."),i=this.gameObject,r=0;r<e.length-1;r++)if(i=i[e[r]],!i)return void this.game.log.important("The property({0}) non-exist.",t);this._ob=i,this._attrib=e[e.length-1],this._property=t}}}}),ii.prototype.onUpdate=function(t,e){var i=this,r=i.from,n=i.to;i._ob[i._attrib]=r+t*(n-r)},ii.prototype.setStartToCurrValue=function(){this._ob[this._attrib]=this.from},ii.prototype.setEndToCurrValue=function(){this._ob[this._attrib]=this.to},ii.prototype.setCurrToStartValue=function(){this.from=this._ob[this._attrib]},ii.prototype.setCurrToEndValue=function(){this.to=this._ob[this._attrib]},ii.begin=function(t,e,i){var r=s.Tween.begin("qc.TweenProperty",t,e);return r.from=this._ob[this._attrib],r.to=i,e<=0&&(r.sample(1,!0),r.enable=!1),r};var ri=B("qc.TweenRotation",s.Tween,function(){var t=this;t.from=0,t.to=1,t.enable=!1},{from:s.Serializer.NUMBER,to:s.Serializer.NUMBER});ri.__menu="Tween/TweenRotation",ri.prototype.onUpdate=function(t,e){var i=this,r=i.from,n=i.to;i.gameObject.rotation=r+t*(n-r)},ri.prototype.setStartToCurrValue=function(){this.gameObject.rotation=this.from},ri.prototype.setEndToCurrValue=function(){this.gameObject.rotation=this.to},ri.prototype.setCurrToStartValue=function(){this.from=this.gameObject.rotation},ri.prototype.setCurrToEndValue=function(){this.to=this.gameObject.rotation},ri.begin=function(t,e,i){var r=s.Tween.begin("qc.TweenRotation",t,e);return r.from=t.rotation,r.to=i,e<=0&&(r.sample(1,!0),r.enable=!1),r};var ni=B("qc.TweenScale",s.Tween,function(){var t=this;t.from=new s.Point(0,0),t.to=new s.Point(1,1),t.isReSet=!1,t.enable=!1},{from:s.Serializer.POINT,to:s.Serializer.POINT});ni.__menu="Tween/TweenScale",ni.prototype.onUpdate=function(t,e){var i=this,r=i.from,n=i.to,a=new s.Point(r.x+t*(n.x-r.x),r.y+t*(n.y-r.y));i.gameObject.scaleX=a.x,i.gameObject.scaleY=a.y},ni.prototype.setStartToCurrValue=function(){this.gameObject.scaleX=this.from.x,this.gameObject.scaleY=this.from.y},ni.prototype.setEndToCurrValue=function(){this.gameObject.scaleX=this.to.x,this.gameObject.scaleY=this.to.y},ni.prototype.setCurrToStartValue=function(){this.from=new s.Point(this.gameObject.scaleX,this.gameObject.scaleY)},ni.prototype.setCurrToEndValue=function(){this.to=new s.Point(this.gameObject.scaleX,this.gameObject.scaleY)},ni.begin=function(t,e,i){var r=s.Tween.begin("qc.TweenScale",t,e);return r.from=new s.Point(t.scaleX,t.scaleY),r.to=i.clone(),e<=0&&(r.sample(1,!0),r.enable=!1),r};var ai=B("qc.TweenTransform",s.Tween,function(){var t=this;t.enable=!1,t.localFrom=new s.Point,t.localTo=new s.Point},{from:s.Serializer.NODE,to:s.Serializer.NODE});ai.__menu="Tween/TweenTransform",e.defineProperties(ai.prototype,{from:{get:function(){return this._from},set:function(t){if(this._from=t,t){var e=this._from.getWorldPosition();this.localFrom=this.gameObject.parent.toLocal(e)}}},to:{get:function(){return this._to},set:function(t){if(this._to=t,t){var e=this._to.getWorldPosition();this.localTo=this.gameObject.parent.toLocal(e)}}}}),ai.prototype.onUpdate=function(t,e){if(this._from&&this._to){var i=this;i.gameObject.x=i.localFrom.x+t*(i.localTo.x-i.localFrom.x),i.gameObject.y=i.localFrom.y+t*(i.localTo.y-i.localFrom.y)}};var si=B("qc.VerticalLayout",s.TableLayout,function(){this.style=s.TableLayout.STYLE_RESIZE_ELEMENT,this.constraint=s.TableLayout.CONSTRAINT_FIX_COLUMN_COUNT,this.contentSizeProvider=s.TableLayout.USE_RECTTRANSFORM,this.stride=1,this.startCorner=s.TableLayout.CORNER_TOP_LEFT,this.startAxis=s.TableLayout.AXIS_VERTICAL},{childForceExpandWidth:s.Serializer.NUMBER,childForceExpandHeight:s.Serializer.NUMBER});si.__menu="UI/Layout/VerticalLayout",e.defineProperties(si.prototype,{spacing:{get:function(){return this.spacingY},set:function(t){this.spacingY=t}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(t){this._childForceExpandWidth!==t&&(this._childForceExpandWidth=t,this.rebuildTable())}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(t){this._childForceExpandHeight!==t&&(this._childForceExpandHeight=t,this.rebuildTable())}}}),si.prototype._getDefaultLayout=function(t){return"y"===t?{min:0,preferred:0,flexible:this.childForceExpandHeight?1:0,extra:0}:{min:0,preferred:this.childForceExpandWidth?this.gameObject.rect.width:-1,flexible:0,extra:0}},si.prototype.getCellLayout=function(t){var e=s.LayoutElement.getLayoutElement(t);return this.childForceExpandWidth&&(e.flexibleWidth=1),this.childForceExpandHeight&&(e.flexibleHeight=1),e};var oi=s.Prop=function(t,e,i){var r=this;r.action=t,r.path=e,r.propertyId=i,r.propMap={},r.propDefaultValue={},r.keyIndexMap={}};oi.prototype.constructor=oi,oi.prototype.destroy=function(){this.action=null,this.propMap={}},oi.prototype.getPropMap=function(){return this.propMap},oi.prototype.saveValue=function(t,e,i){var r;switch(t){case j.INT:case j.NUMBER:case j.STRING:case j.BOOLEAN:case j.MAPPING:case j.CUSTOMEVENT:r=e;break;case j.COLOR:r=e instanceof vt?e.toNumber(!0):null;break;case j.GEOM:case j.POINT:case j.RECTANGLE:case j.CIRCLE:case j.ELLIPSE:r=[e.class,e.toJson()];break;case j.TEXTURE:if(e)if(e[0]instanceof s.Atlas){var n=e[0],a=e[1];i.dependences.push({key:n.key,uuid:n.uuid}),r=[n.uuid,a]}else r=null;else r=null;break;case j.AUDIO:e instanceof s.SoundAsset?(i.dependences.push({key:e.key,uuid:e.uuid}),r=e.uuid):r=null;break;default:throw new Error("unsupported asset type:"+t)}return r},oi.prototype.restoreValue=function(t,e){var i;switch(t){case j.INT:case j.NUMBER:case j.STRING:case j.BOOLEAN:case j.MAPPING:case j.CUSTOMEVENT:i=e;break;case j.COLOR:i=new vt(e);break;case j.GEOM:case j.POINT:case j.RECTANGLE:case j.CIRCLE:case j.ELLIPSE:if(e){var r=s.Util.findClass(e[0]),n=new r;n.fromJson(e[1]),i=n}else i=null;break;case j.TEXTURE:if(e){var a=e[0],o=e[1],h=this.action.game.assets.findByUUID(a);h?i=h instanceof s.Atlas?[h,o]:[null,o]:(console.error("贴图资源尚未载入，无法反序列化。",e),i=[null,o])}else i=[];break;case j.AUDIO:if(e){h=this.action.game.assets.findByUUID(e);h?i=h instanceof s.SoundAsset?h:null:(console.error("音频资源尚未载入，无法反序列化。",e),i=null)}else i=null;break;default:throw new Error("unsupported asset type:"+t)}return i},oi.prototype.setData=function(t,e){},oi.prototype.fromJson=function(t,e){return 0},oi.prototype.toJson=function(t){return[]},oi.prototype.addKey=function(t,e,i){return 0},oi.prototype.deleteKey=function(t,e){return 0},oi.prototype.getDuration=function(){return{}},oi.prototype.getValue=function(t,e){},oi.prototype.getValueByIndex=function(t,e){},oi.prototype.setValue=function(t,e,i){},oi.prototype.isKey=function(t,e){return!1},oi.prototype.update=function(t,e,i,r,n){},oi.prototype.reset=function(){this.keyIndexMap={}};var hi=s.KeyProp=function(t,e,i){var r=this;s.Prop.call(r,t,e,i)};hi.prototype=e.create(s.Prop.prototype),hi.prototype.constructor=hi,hi.prototype.fromJson=function(t,e){this.propertyInfo=t,this.forceUpdate=t.forceUpdate;for(var i=0,r=t.properties,n=0;n<r.length;n++){var a,s=r[n].attrib;if("string"==typeof s){var o=s.split(".");o.length>1&&(a=o)}if(this.propDefaultValue[s]=r[n].default,e){var h=e[n];if(h){for(var l=h[0],u=h[1],c=[],p=0;p<u.length;p++)c.push([u[p][0],this.restoreValue(l,u[p][1])]);if(this.propMap[s]=[l,c,a],c.length>0){var d=c[c.length-1][0];i<d&&(i=d)}}else this.propMap[s]||(this.propMap[s]=[r[n].type,[],a])}else this.propMap[s]=[r[n].type,[],a]}return i},hi.prototype.toJson=function(t){for(var e=[],i=this.propertyInfo.properties,r=0;r<i.length;r++){var n=i[r].attrib,a=this.propMap[n],s=a[0],o=a[1];if(s&&o){for(var h=[],l=0;l<o.length;l++)h.push([o[l][0],this.saveValue(s,o[l][1],t)]);e.push([s,h])}}return e},hi.prototype.addKey=function(t,e,r){var n=this.propMap[t];if(n){var a=function(t,e){return t[0]<e[0]};r!==i&&null!==r||this.propDefaultValue[t]==i||(r=this.propDefaultValue[t]);var o=s.Util.insertSortedList(n[1],[e,r],a);return o}this.action.game.log.important("KeyProp not find attrib({0}) in addKey.",t)},hi.prototype.deleteKey=function(t,e){var i=this.propMap[t];if(i)return i[1]?i[1].splice(e,1):null;this.action.game.log.important("KeyProp not find attrib({0}) in deleteKey.",t)},hi.prototype.getKeyTimeList=function(t){var e=[],i=this.propMap[t];if(!i)return this.action.game.log.important("KeyProp not find attrib({0}) in getKeyTimeList.",t),[];for(var r=0;r<i[1].length;r++)e.push(i[1][r][0]);return e},hi.prototype.getDuration=function(){var t=0;for(var e in this.propMap){var i=this.propMap[e];0!==i[1].length&&(i[1][i[1].length-1][0]>t&&(t=i[1][i[1].length-1][0]))}return t},hi.prototype.isKey=function(t,e){var i=this.propMap[t];if(0===i[1].length)return!1;for(var r=0;r<i[1].length;r++)if(this.action.game.math.fuzzyEqual(i[1][r][0],e))return r},hi.prototype.setValue=function(t,e,i){var r=this.isKey(t,e);if("number"!=typeof r)return this.addKey(t,e,i),e>this.action.duration&&(this.action.duration=e),!0;var n=this.propMap[t];n[1][r][1]=i},hi.prototype.getValue=function(t,e){var i=this.propMap[t];if(0===i[1].length)return null;for(var r=0;r<i[1].length;r++)if(!(i[1][r][0]<=e))return r=r>0?r-1:0,i[1][r][1];return i[1][i[1].length-1][1]},hi.prototype.getValueByIndex=function(t,e){var i=this.propMap[t];return 0===i[1].length?null:i[1][e]?i[1][e][1]:null},hi.prototype.updateAttrib=function(t,e,i,r){if(r){var n=r.length;if(2===n&&t[r[0]])t[r[0]][r[1]]=i;else if(n>2){for(var a=t,s=0;s<n-1&&(a=a[r[s]],a);s++);a&&(a[r[n-1]]=i)}}else t[e]=i},hi.prototype.update=function(t,e,i,r,n){for(var a in i&&(this.keyIndexMap={}),this.propMap){var s=this.keyIndexMap[a]||0,o=this.propMap[a];if(0!==o[1].length)if(s>o[1].length&&(this.keyIndexMap[a]=o[1].length,s=o[1].length),s<o[1].length&&o[1][s][0]<=e)for(var h=s;h<o[1].length&&o[1][h][0]<=e;h++)this.updateAttrib(t,a,o[1][h][1],o[2]),this.keyIndexMap[a]=h+1;else{var l=!1;for(h=s-1;h>=0;h--)if(o[1][h]){if(!(o[1][h][0]>e)){l=!0,(h!==s-1||r&&(n||this.forceUpdate))&&(this.updateAttrib(t,a,o[1][h][1],o[2]),this.keyIndexMap[a]=h+1);break}}else this.action.game.log.error("{0}:{1}~{2} update error: keyIndex({3}), propList({4})",this.path,this.propertyId,a,s,o[1]);l||(this.keyIndexMap[a]=0)}}};var li=s.LinearProp=function(t,e,i){var r=this;s.KeyProp.call(r,t,e,i)};li.prototype=e.create(s.KeyProp.prototype),li.prototype.constructor=li,li.prototype.calcValue=function(t,e,i){return t+i*(e-t)},li.prototype.getValue=function(t,e){var i=this.propMap[t];if(0===i[1].length)return null;if(e<=i[1][0][0])return i[1][0][1];for(var r=0;r<i[1].length;r++)if(!(i[1][r][0]<e)){r=r>0?r-1:0;var n=(e-i[1][r][0])/(i[1][r+1][0]-i[1][r][0]);return this.calcValue(i[1][r][1],i[1][r+1][1],n)}return i[1][i[1].length-1][1]},li.prototype.updateAttrib=function(t,e,i,r){if(r){var n=r.length;if(2===n&&t[r[0]])t[r[0]][r[1]]=i;else if(n>2){for(var a=t,s=0;s<n-1&&(a=a[r[s]],a);s++);a&&(a[r[n-1]]=i)}}else t[e]=i},li.prototype.update=function(t,e,i,r,n){for(var a in i&&(this.keyIndexMap={}),this.propMap){var s=this.keyIndexMap[a]||0,o=this.propMap[a];if(0!==o[1].length)if(s>=o[1].length&&(this.keyIndexMap[a]=o[1].length-1,s=o[1].length-1),o[1][s][0]<=e){for(var h=s;h<o[1].length;h++)if(h===o[1].length-1)h!==s&&(this.updateAttrib(t,a,o[1][h][1],o[2]),this.keyIndexMap[a]=h);else if(o[1][h][0]<=e&&o[1][h+1][0]>e){var l=(e-o[1][h][0])/(o[1][h+1][0]-o[1][h][0]);if(o[1][h][1]&&o[1][h+1][1]){var u=this.calcValue(o[1][h][1],o[1][h+1][1],l);this.updateAttrib(t,a,u,o[2])}this.keyIndexMap[a]=h;break}}else{if(o[1][0][0]>e){this.keyIndexMap[a]=0;continue}for(h=0;h<s;h++)if(o[1][h][0]<=e&&o[1][h+1][0]>e){l=(e-o[1][h][0])/(o[1][h+1][0]-o[1][h][0]);if(o[1][h][1]&&o[1][h+1][1]){u=this.calcValue(o[1][h][1],o[1][h+1][1],l);this.updateAttrib(t,a,u,o[2])}this.keyIndexMap[a]=h;break}}}};var ui=s.CurveProp=function(t,e,i){var r=this;s.Prop.call(r,t,e,i)};ui.prototype=e.create(s.Prop.prototype),ui.prototype.constructor=ui,ui.prototype.fromJson=function(t,e){this.propertyInfo=t;for(var i=0,r=t.properties,n=0;n<r.length;n++){var a,o=r[n].attrib;if("string"==typeof o){var h=o.split(".");h.length>1&&(a=h)}if(this.propDefaultValue[o]=r[n].default,e){var l=e[n];if(l){
var u=new s.BezierCurve;if(this.propMap[o]={curveType:l[0],curve:u,to:0,attribArray:a},u.fromJson(l[1]),l[0]>=s.CURVE_TYPE_TWEEN_RELATIVE?(this.propMap[o].from=l[2][0],this.propMap[o].to=l[2][1]||0,this.propMap[o].playTime=l[3]||-1,this.propMap[o.playAfterNumLoop]=l[4]||0):(this.propMap[o].playTime=l[2]||-1,this.propMap[o].playAfterNumLoop=l[3]||0),u._keys.length>0){var c=u._keys[u._keys.length-1].time;i<c&&(i=c)}}}else this.propMap[o]={curveType:s.CURVE_TYPE_ABSOLUTE,curve:new s.BezierCurve,to:0,attribArray:a}}return i},ui.prototype.toJson=function(t){for(var e=[],i=this.propertyInfo.properties,r=0;r<i.length;r++){var n=i[r].attrib,a=this.propMap[n],o=[a.curveType,a.curve.toJson()];a.curveType>=s.CURVE_TYPE_TWEEN_RELATIVE&&o.push([a.from,a.to]),o.push(a.playTime),o.push(a.playAfterNumLoop),e.push(o)}return e},ui.prototype.setData=function(t,e){var i=this.propMap[t];i?("number"==typeof e.curveType&&(i.curveType=e.curveType),"number"==typeof e.from&&(i.from=e.from),"number"==typeof e.to&&(i.to=e.to)):this.action.game.log.important("CurveProp not find attrib({0}) in setData.",t)},ui.prototype.getMaxValue=function(t){var e=this.propMap[t];if(e){for(var i=!1,r=0;r<e.curve._keys.length;r++)!1===i?i=e.curve._keys[r].value:i<e.curve._keys[r].value&&(i=e.curve._keys[r].value);return e.curveType===s.CURVE_TYPE_ABSOLUTE?i:e.curveType===s.CURVE_TYPE_RELATIVE?e.from+i:e.curveType===s.CURVE_TYPE_TWEEN_ABSOLUTE?e.from+i*(e.to-e.from):e.curveType===s.CURVE_TYPE_TWEEN_RELATIVE?e.from+i*e.to:void 0}this.action.game.log.important("CurveProp not find attrib({0}) in getMaxValue.",t)},ui.prototype.getFromValue=function(t,e,i){var r=this.propMap[e];if(r){if("number"==typeof r.from)return r.from;if(t){var n;if(r.attribArray){var a=r.attribArray.length;if(2===a)n=t[r.attribArray[0]]?t[r.attribArray[0]][r.attribArray[1]]:null;else if(a>2){for(var o=t,h=0;h<a-1&&(o=o[r.attribArray[h]],o);h++);o&&(n=o[r.attribArray[a-1]])}}else n=t[e];var l=this.getValue(e,i,!0)||0,u=r.to,c=l;return r.curveType===s.CURVE_TYPE_RELATIVE?c=n-l:r.curveType===s.CURVE_TYPE_TWEEN_RELATIVE&&(c=n-(u?u*l:0)),r.from=c,c}}else this.action.game.log.important("CurveProp not find attrib({0}) in getFromValue.",e)},ui.prototype.addKey=function(t,e,r){var n=this.propMap[t];if(n){r!==i&&null!==r||this.propDefaultValue[t]==i||(r=this.propDefaultValue[t]),r=r||0;var a=n.curve.addKey(e,r);return n.curve.makeKeyframeLinear(a-1),n.curve.makeKeyframeLinear(a),n.curve.makeKeyframeLinear(a+1),a}this.action.game.log.important("CurveProp not find attrib({0}) in addKey.",t)},ui.prototype.deleteKey=function(t,e){var i=this.propMap[t];i?i.curve.removeKey(e):this.action.game.log.important("CurveProp not find attrib({0}) in deleteKey.",t)},ui.prototype.getKeyTimeList=function(t){var e=[],i=this.propMap[t];if(!i)return this.action.game.log.important("CurveProp not find attrib({0}) in getKeyTimeList.",t),[];for(var r=0;r<i.curve._keys.length;r++)e.push(i.curve._keys[r].time);return e},ui.prototype.getDuration=function(){var t=0;for(var e in this.propMap){var i=this.propMap[e],r=i.curve;if(!(r._keys.length<1)){var n=r._keys[r._keys.length-1].time;t<n&&(t=n)}}return t},ui.prototype.getValue=function(t,e,i){var r=this.propMap[t],n=r.from,a=r.to,o=r.curveType,h=r.curve,l=h.evaluate(e);return i?l:o===s.CURVE_TYPE_ABSOLUTE?l:o===s.CURVE_TYPE_RELATIVE?n+l:o===s.CURVE_TYPE_TWEEN_ABSOLUTE?n+l*(a-n):n+l*a},ui.prototype.getValueByIndex=function(t,e){var i=this.propMap[t],r=i.curve;return r._keys[e]?r._keys[e].value:null},ui.prototype.setValue=function(t,e,i){var r=this.isKey(t,e);if("number"!=typeof r)return this.addKey(t,e,i),e>this.action.duration&&(this.action.duration=e),!0;var n=this.propMap[t],a=n.curve;a._keys[r].value=i,n.curve.makeKeyframeLinear(r-1),n.curve.makeKeyframeLinear(r),n.curve.makeKeyframeLinear(r+1)},ui.prototype.isKey=function(t,e){var i=this.propMap[t],r=i.curve;if(0===r._keys.length)return!1;for(var n=0;n<r._keys.length;n++)if(this.action.game.math.fuzzyEqual(r._keys[n].time,e))return n},ui.prototype.update=function(t,e,i,r,n){for(var a in i&&(this.keyIndexMap={}),this.propMap)if(0!==this.propMap[a].playTime&&(r||!this.keyIndexMap[a])){var o,h=this.propMap[a],l=h.curve,u=h.curveType;if(i&&(u===s.CURVE_TYPE_RELATIVE||u===s.CURVE_TYPE_TWEEN_RELATIVE)){if(h.attribArray){var c=h.attribArray.length;if(2===c)o=t[h.attribArray[0]]?t[h.attribArray[0]][h.attribArray[1]]:null;else if(c>2){for(var p=t,d=0;d<c-1&&(p=p[h.attribArray[d]],p);d++);p&&(o=p[h.attribArray[c-1]])}}else o=t[a];h.from=o}if(!(l._keys.length<=0||l._keys[0].time>e)){var f=this.getFromValue(t,a,e),_=h.to,g=l.evaluate(e);if(!r&&l._keys[l._keys.length-1].time<=e&&(-1!=this.propMap[a].playTime&&--this.propMap[a].playTime,this.propMap[a].playAfterNumLoop>0&&--this.propMap[a].playAfterNumLoop,this.keyIndexMap[a]=1),!(this.propMap[a].playAfterNumLoop>0))if(o=u===s.CURVE_TYPE_ABSOLUTE?g:u===s.CURVE_TYPE_RELATIVE?f+g:u===s.CURVE_TYPE_TWEEN_ABSOLUTE?f+g*(_-f):f+g*_,h.attribArray){c=h.attribArray.length;if(2===c&&t[h.attribArray[0]])t[h.attribArray[0]][h.attribArray[1]]=o;else if(c>2){for(p=t,d=0;d<c-1&&(p=p[h.attribArray[d]],p);d++);p&&(p[h.attribArray[c-1]]=o)}}else t[a]=o}}};var ci=s.ActionState=function(t){var e=this;e.game=t,e.name="",e.targetObject=null,e.targetLocked=!1,e.eventList=[],e.samples=60,e.duration=0,e.speed=1,e.startTime=0,e.elapsedFrame=0,e.loop=!1,e.playEventInEditor=!0,e.isRunning=!1,e.onFinished=new s.Signal,e.onLoopFinished=new s.Signal,e.unpackDone=!1};ci.prototype.constructor=ci,ci.prototype.awake=function(){this.unpackDone=!0,"string"==typeof this.targetObject&&(this.targetObject=this.game.nodePool.find(this.targetObject))},ci.prototype.destroy=function(){var t=this;t.targetObject=null,t.isRunning=!1,t.eventList=[],t.onFinished.removeAll(),t.onLoopFinished.removeAll()},ci.prototype.getDuration=function(t){return this.duration},ci.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0},ci.prototype.playAction=function(t,e){return this.isRunning=!0,!this.targetLocked&&t&&(this.targetObject=t),e&&this.reset(),this.update(null,!0)},ci.prototype.stop=function(){this.isRunning=!1},ci.prototype.addEvent=function(t,e,i){var r=function(t,e){return t[0]<e[0]},n=s.Util.insertSortedList(this.eventList,[t,e,i],r,!0);return n},ci.prototype.deleteEvent=function(t){return this.eventList?this.eventList.splice(t,1):null},ci.prototype.setEvent=function(t,e,i){var r=this.eventList[t];r&&(r[e]=i)},ci.prototype.getEventInfo=function(t){var e=this.eventList[t];if(e)return{func:e[1],para:e[2]}},ci.prototype.triggerEvent=function(t){var e=this.eventList[0][0],i=this.eventList[this.eventList.length-1][0];if(!(this.elapsedFrame<e||t>i))for(var r=0;r<this.eventList.length;r++)if(!(this.eventList[r][0]<=t)){if(!(this.eventList[r][0]<=this.elapsedFrame))break;if(this.eventList[r][1])for(var n=0;n<this.targetObject.scripts.length;n++){var a=this.targetObject.scripts[n];if(a[this.eventList[r][1]]){var s=this.eventList[r][2];Array.isArray(s)||(s="string"==typeof s?[s]:[]),a[this.eventList[r][1]].apply(a,s)}}}},ci.prototype.update=function(t,e,i,r){},ci.buildEmptyBundle=function(){return{}},ci.buildBundle=function(t){var e={dependences:[]};return t.targetObject&&(e.targetObject=t.targetObject.uuid),e.targetLocked=t.targetLocked,e.loop=t.loop,e.samples=t.samples,e.speed=t.speed,e.playEventInEditor=t.playEventInEditor,t.name&&(e.name=t.name,e.uniqueName=t.uniqueName||e.name),t.currentScene&&(e.currentScene=t.currentScene),e.eventList=JSON.stringify(t.eventList),e},ci.restoreBundle=function(t,e,i){var r=e.json,n=t.game;if(t.uuid=e.uuid,t.key=e.key,r.name?t.name=r.name:t.name=e.key.match(/\/([^\/]+?).bin/)[1],r.uniqueName?t.uniqueName=r.uniqueName:t.uniqueName=t.name,r.currentScene&&(t.currentScene=r.currentScene),r.__json&&(t.__json=r.__json),r.eventList)try{t.eventList=JSON.parse(r.eventList)}catch(t){n.log.error(t)}return t.targetLocked=r.targetLocked,t.loop=r.loop,t.samples=r.samples||60,t.speed=r.speed||1,t.playEventInEditor="boolean"!=typeof r.playEventInEditor||r.playEventInEditor,t.targetObject=i?n.nodePool.find(r.targetObject):n.nodePool.find(r.targetObject)||r.targetObject,i&&t.awake(),t};var pi=s.Action=function(t){var e=this;e.propertyList={},e.actionList=[],s.ActionState.call(e,t),e.class="qc.Action"};pi.prototype=e.create(s.ActionState.prototype),pi.prototype.constructor=pi,e.defineProperties(pi.prototype,{targetObject:{get:function(){return this._targetObject},set:function(t){this.unpackDone&&t===this._targetObject&&this._targetObject||(this._targetObject=t,this.unpackDone&&(this.actionList=[],t&&this.refreshActionList()))}}}),pi.prototype.awake=function(){this.unpackDone=!0,"string"==typeof this.targetObject?this.targetObject=this.game.nodePool.find(this.targetObject):"object"==typeof this.targetObject&&0===this.actionList.length&&this.refreshActionList(),this.targetObject||!this.targetLocked||this.game.log.trace("Action({0}) can not find targetObject.",this.name)},pi.prototype.destroy=function(){var t=this;for(var e in t.targetObject=null,t.isRunning=!1,t.propertyList)t.propertyList[e].destroy();t.propertyList={},t.actionList=[],t.eventList=[],t.onFinished.removeAll(),t.onLoopFinished.removeAll()},pi.prototype.refreshActionList=function(){if(this.targetObject)for(var t in this.actionList=[],this.propertyList){var e=t.match(/(.*):(.*)/),i=e[1],r=(e[2],this.targetObject.find(i));r?this.actionList.push({target:r,propOb:this.propertyList[t]}):this.game.log.error("In action({0}), target({1}) not find child({2})",this.key,this.targetObject?this.targetObject.name:null,i)}else this.game.log.trace("Action({0}) can not find targetObject.",this.name)},pi.prototype.addProperty=function(t,e,i,r){var n=t+":"+e,a=this.propertyList[n];if(a)this.game.log.important("Action has duplicate key : {0} in addProperty",n);else{var o=s.ActionProperties[e];if(o){var h=s.Util.findClass(o.class);a=new h(this,t,e);var l=a.fromJson(o,i);this.duration<l&&(this.duration=l),this.propertyList[n]=a,r&&this.refreshActionList()}else this.game.log.important("Can't find propertyId : {0} in addProperty",e)}},pi.prototype.removeProperty=function(t,e){var i=t+":"+e,r=this.propertyList[i];r?(r.destroy(),delete this.propertyList[i],this.refreshActionList(),this.duration=this.getDuration(!0,!0)):this.game.log.important("Action not find key : {0} in removeProperty",i)},pi.prototype.getPropertyInfo=function(t,e){var i=t+":"+e,r=this.propertyList[i];if(r)return r.getPropMap();this.game.log.important("Action not find key : {0} in getPropertyInfo",i)},pi.prototype.setData=function(t,e,i,r){var n=t+":"+e,a=this.propertyList[n];a?a.setData(i,r):this.game.log.important("Action has't property : {0} in setData",n)},pi.prototype.addKey=function(t,e,i,r,n){var a=t+":"+e,s=this.propertyList[a];if(s){s.addKey(i,r,n);r>this.duration&&(this.duration=r)}else this.game.log.important("Action has't property : {0} in addKey",a)},pi.prototype.deleteKey=function(t,e,i,r){var n=t+":"+e,a=this.propertyList[n];if(a){var s=a.getKeyTimeList(i),o=s[r];a.deleteKey(i,r),this.duration==o&&(this.duration=this.getDuration(!0,!0))}else this.game.log.important("Action has't property : {0} in deleteKey",n)},pi.prototype.getDuration=function(t,e){if(t){var i=0;for(var r in this.propertyList){var n=this.propertyList[r],a=n.getDuration();i<a&&(i=a)}this.duration=i}return this.loop&&!e?s.MAX_DURATION:this.duration},pi.prototype.getValue=function(t,e,i,r,n){var a=t+":"+e,s=this.propertyList[a];if(s)return s.getValue(i,r,n);this.game.log.important("Action has't property : {0} in getValue",a)},pi.prototype.getValueByIndex=function(t,e,i,r){var n=t+":"+e,a=this.propertyList[n];if(a)return a.getValueByIndex(i,r);this.game.log.important("Action has't property : {0} in getValueByIndex",n)},pi.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0;for(var t=0;t<this.actionList.length;t++){var e=this.actionList[t];e.propOb.reset()}},pi.prototype.update=function(t,e,i,r){if((this.isRunning||i)&&this.targetObject&&0!==this.duration){var n=this.game.time.scaledTime;if(this.elapsedFrame>=this.duration){if(!this.loop){for(var a=0;a<this.actionList.length;a++){var o=this.actionList[a];o.propOb.update(o.target,this.elapsedFrame,!0,i,r)}return this.isRunning=!1,this.onFinished.dispatch(this),s.FinishTrigger}this.onLoopFinished.dispatch(this),this.isRunning=!0;for(var h=this.elapsedFrame-this.duration;h>=this.duration;)h-=this.duration;t=h/(this.samples*this.speed)*1e3,this.reset(),this.startTime=n-t}t="number"==typeof t?t:this.game.time.deltaTime,this.startTime||(this.startTime=n),n===this.startTime&&(t=0);var l=e?-1:this.elapsedFrame;this.elapsedFrame+=t/1e3*this.samples*this.speed;for(a=0;a<this.actionList.length;a++){o=this.actionList[a];o.propOb.update(o.target,this.elapsedFrame,e,i,r)}i&&!this.playEventInEditor||this.eventList.length>0&&this.triggerEvent(l)}},pi.buildEmptyBundle=function(){return{propertyList:{}}},pi.buildBundle=function(t){var e=s.ActionState.buildBundle(t),i={};for(var r in t.propertyList){var n=r.match(/(.*):(.*)/),a=n[1],o=n[2];i[a]=i[a]||{},i[a][o]=t.propertyList[r].toJson(e)}return e.propertyList=i,e},pi.restoreBundle=function(t,e,i){var r=t.json,n=new s.Action(e);for(var a in r.propertyList)for(var o in r.propertyList[a])n.addProperty(a,o,r.propertyList[a][o]);return n=s.ActionState.restoreBundle(n,t,i),n},pi.prototype.stop=function(){this.isRunning=!1;for(var t=0;t<this.actionList.length;t++){this.actionList[t].target;Number(this.actionList[t].propOb.propertyId)===s.PROP_SOUND&&(this.actionList[t].target.isPlaying=!1)}},s.MAX_DURATION=4294967295,s.CURVE_TYPE_RELATIVE=1,s.CURVE_TYPE_ABSOLUTE=2,s.CURVE_TYPE_TWEEN_RELATIVE=3,s.CURVE_TYPE_TWEEN_ABSOLUTE=4,s.PROP_POSITION=1,s.PROP_ROTATION=2,s.PROP_ALPHA=3,s.PROP_SCALE=4,s.PROP_COLOR_TINT=5,s.PROP_VISIBLE=6,s.PROP_SIZE=7,s.PROP_SKEW=8,s.PROP_TEXTURE=9,s.PROP_ANIMATION=10,s.PROP_COLOR=11,s.PROP_TEXT=12,s.PROP_PIVOT=13,s.PROP_ANCHORED_POSITION=14,s.PROP_TOGGLE_ON=15,s.PROP_SCROLLBAR_VALUE=16,s.PROP_SCROLLVIEW_POSITION=17,s.PROP_PROGRESSBAR_VALUE=18,s.PROP_SLIDER_VALUE=19,s.PROP_SOUND=20,s.PROP_DOM_INNERHTML=21,s.PROP_TILEMAP_POSITION=22,s.PROP_SEQUENCE_FRAME=23,s.PROP_VIDEO=24,s.ActionProperties={},s.ActionProperties[s.PROP_POSITION]={name:"Position",class:"qc.CurveProp",curve:!0,properties:[{attrib:"x",type:j.NUMBER,defaultValue:0},{attrib:"y",type:j.NUMBER,defaultValue:0}]},s.ActionProperties[s.PROP_ANCHORED_POSITION]={name:"AnchoredPosition",class:"qc.CurveProp",curve:!0,properties:[{attrib:"anchoredX",type:j.NUMBER,defaultValue:0},{attrib:"anchoredY",type:j.NUMBER,defaultValue:0}]},s.ActionProperties[s.PROP_ROTATION]={name:"Rotation",class:"qc.CurveProp",curve:!0,properties:[{attrib:"rotation",type:"angle",defaultValue:0}]},s.ActionProperties[s.PROP_ALPHA]={name:"Alpha",class:"qc.CurveProp",curve:!0,properties:[{attrib:"alpha",type:j.NUMBER,min:0,max:1,precision:2,defaultValue:1}]},s.ActionProperties[s.PROP_SCALE]={name:"Scale",class:"qc.CurveProp",curve:!0,properties:[{attrib:"scaleX",type:j.NUMBER,defaultValue:1},{attrib:"scaleY",type:j.NUMBER,defaultValue:1}]},s.ActionProperties[s.PROP_COLOR_TINT]={name:"ColorTint",class:"qc.ColorLinearProp",properties:[{attrib:"colorTint",type:j.COLOR,default:s.Color.white}]},s.ActionProperties[s.PROP_VISIBLE]={name:"Visible",class:"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"visible",type:j.BOOLEAN,default:!0}]},s.ActionProperties[s.PROP_SIZE]={name:"Size",class:"qc.CurveProp",curve:!0,properties:[{attrib:"width",type:j.NUMBER},{attrib:"height",type:j.NUMBER}]},s.ActionProperties[s.PROP_PIVOT]={name:"Pivot",class:"qc.CurveProp",curve:!0,properties:[{attrib:"pivotX",type:j.NUMBER},{attrib:"pivotY",type:j.NUMBER}]},s.ActionProperties[s.PROP_SKEW]={name:"Skew",class:"qc.CurveProp",curve:!0,properties:[{attrib:"skewX",type:"angle"},{attrib:"skewY",type:"angle"}]},s.ActionProperties[s.PROP_TEXTURE]={name:"Texture",class:"qc.TextureKeyProp",forceUpdate:!0,properties:[{attrib:"texture",type:j.TEXTURE}]},s.ActionProperties[s.PROP_ANIMATION]={name:"Animation",class:"qc.AnimationKeyProp",properties:[{attrib:"defaultAnimation",type:j.STRING}]},s.ActionProperties[s.PROP_COLOR]={name:"Color",class:"qc.ColorLinearProp",properties:[{attrib:"color",type:j.COLOR,default:s.Color.white}]},s.ActionProperties[s.PROP_TEXT]={name:"Text",class:"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"text",type:j.STRING,default:""}]},s.ActionProperties[s.PROP_TOGGLE_ON]={name:"ToggleOn",class:"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"on",type:j.BOOLEAN,default:!0}]},s.ActionProperties[s.PROP_SCROLLBAR_VALUE]={name:"ScrollBarValue",class:"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:j.NUMBER}]},s.ActionProperties[s.PROP_SCROLLVIEW_POSITION]={name:"ScrollViewPosition",class:"qc.CurveProp",curve:!0,properties:[{attrib:"horizontalNormalizedPosition",type:j.NUMBER},{attrib:"verticalNormalizedPosition",type:j.NUMBER}]},s.ActionProperties[s.PROP_PROGRESSBAR_VALUE]={name:"ProgressBarValue",class:"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:j.NUMBER}]},s.ActionProperties[s.PROP_SLIDER_VALUE]={name:"SliderValue",class:"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:j.NUMBER}]},s.ActionProperties[s.PROP_SOUND]={name:"Sound",class:"qc.KeyProp",properties:[{attrib:"isPlaying",type:j.BOOLEAN,default:!0}]},s.ActionProperties[s.PROP_DOM_INNERHTML]={name:"DomInnerHTML",class:"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"innerHTML",type:j.STRING,default:""}]},s.ActionProperties[s.PROP_TILEMAP_POSITION]={name:"TilemapPosition",class:"qc.CurveProp",curve:!0,properties:[{attrib:"scrollX",type:j.NUMBER},{attrib:"scrollY",type:j.NUMBER}]},s.ActionProperties[s.PROP_SEQUENCE_FRAME]={name:"SequenceFrame",class:"qc.SequenceFrameKeyProp",properties:[{attrib:"sequenceFrame",type:j.STRING}]},s.ActionProperties[s.PROP_VIDEO]={name:"Video",class:"qc.KeyProp",properties:[{attrib:"isPlaying",type:j.BOOLEAN,default:!0}]},s.FinishTrigger=1,s.EventTrigger=2,s.propertyList={"qc.Node":[s.PROP_POSITION,s.PROP_ANCHORED_POSITION,s.PROP_ROTATION,s.PROP_ALPHA,s.PROP_SCALE,s.PROP_COLOR_TINT,s.PROP_VISIBLE,s.PROP_SIZE,s.PROP_PIVOT],"qc.UIImage":[s.PROP_SKEW,s.PROP_TEXTURE],"qc.Sprite":[s.PROP_TEXTURE,s.PROP_ANIMATION],"qc.UIText":[s.PROP_COLOR,s.PROP_TEXT],"qc.Button":[s.PROP_TEXTURE],"qc.Toggle":[s.PROP_TOGGLE_ON],"qc.ScrollBar":[s.PROP_TEXTURE,s.PROP_SCROLLBAR_VALUE],"qc.ScrollView":[s.PROP_TEXTURE,s.PROP_SCROLLVIEW_POSITION],"qc.ProgressBar":[s.PROP_TEXTURE,s.PROP_PROGRESSBAR_VALUE],"qc.Slider":[s.PROP_TEXTURE,s.PROP_SLIDER_VALUE],"qc.InputField":[s.PROP_TEXTURE,s.PROP_TEXT],"qc.Sound":[s.PROP_SOUND],"qc.Dom":[s.PROP_DOM_INNERHTML],"qc.Graphics":[],"qc.UIRoot":[],"qc.Tilemap":[s.PROP_TILEMAP_POSITION]},s.extend=s.extend||{},s.extend.addProperty=function(t,e,i){i===s.Serializer.NUMBER?s.ActionProperties[e]={name:e,class:"qc.CurveProp",curve:!0,isCustomProperty:!0,properties:[{attrib:e,type:s.Serializer.NUMBER}]}:i===s.Serializer.TEXTURE?s.ActionProperties[e]={name:e,class:"qc.TextureKeyProp",forceUpdate:!0,isCustomProperty:!0,properties:[{attrib:e,type:s.Serializer.TEXTURE}]}:i===s.Serializer.COLOR?s.ActionProperties[e]={name:e,class:"qc.ColorLinearProp",isCustomProperty:!0,properties:[{attrib:e,type:j.COLOR,default:s.Color.white}]}:s.ActionProperties[e]={name:e,class:"qc.KeyProp",forceUpdate:!0,isCustomProperty:!0,properties:[{attrib:e,type:i}]},s.propertyList[t]=s.propertyList[t]||[],s.propertyList[t].push(e)};var di=s.ActionManager=function(t){var e=this;e.actionList=[],s.ActionState.call(e,t),e.class="qc.ActionManager",e._endLinePos=-1,e.runningActions={}};di.prototype=e.create(s.ActionState.prototype),di.prototype.constructor=di,di.prototype.awake=function(){if(this.unpackDone=!0,"string"==typeof this.targetObject&&(this.targetObject=this.game.nodePool.find(this.targetObject)),this.targetObject||!this.targetLocked)for(var t=0;t<this.actionList.length;t++)this.actionList[t]&&this.actionList[t][1]&&this.actionList[t][1].awake();else this.game.log.trace("Action({0}) can not find targetObject.",this.name)},di.prototype.destroy=function(){var t=this;t.isRunning=!1,t._targetObject=null;for(var e=0;e<this.actionList.length;e++)this.actionList[e]&&this.actionList[e][1]&&this.actionList[e][1].destroy();t.actionList=[]},e.defineProperties(di.prototype,{targetObject:{get:function(){return this._targetObject},set:function(t){if(!this.unpackDone||t!==this._targetObject||!this._targetObject){this._targetObject=t;for(var e=0;e<this.actionList.length;e++)if(this.actionList[e]){var i=this.actionList[e][1];i&&!i.targetLocked&&(i.targetObject=t)}}}},isRunning:{get:function(){return this._isRunning},set:function(t){this._isRunning=t;for(var e=0;e<this.actionList.length;e++)if(this.actionList[e]){var i=this.actionList[e][1];i&&(i.isRunning=t)}}},endLinePos:{get:function(){return this._endLinePos},set:function(t){this._endLinePos=t,t>-1?this.duration=t:this.getDuration(!0)}}}),di.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0,this.runningActions={};for(var t=0;t<this.actionList.length;t++)if(this.actionList[t]){var e=this.actionList[t][1];e&&e.reset()}},di.prototype.update=function(t,e,i,r){if((this.isRunning||i)&&this.targetObject){var n=this.game.time.scaledTime;if(this.elapsedFrame>=this.duration){if(!this.loop)return this.isRunning=!1,this.onFinished.dispatch(this),s.FinishTrigger;this.onLoopFinished.dispatch(this),this.isRunning=!0;for(var a=this.elapsedFrame-this.duration;a>=this.duration;)a-=this.duration;t=a/(this.samples*this.speed)*1e3,this.reset();var o=function(t,e,i){t.startTime=e;var r=i*t.samples*t.speed/1e3;if(t.duration<r&&(t.elapsedFrame=r),t instanceof s.ActionManager)for(var n=0;n<t.actionList.length;n++){var a=t.actionList[n];if(a){var h=a[1];o(h,e,i)}}};o(this,n-t,t)}t="number"==typeof t?t:this.game.time.deltaTime,this.startTime||(this.startTime=n),n===this.startTime&&(t=0);var h=e?-1:this.elapsedFrame;this.elapsedFrame+=t/1e3*this.samples*this.speed,this.eventList.length>0&&(!i||this.playEventInEditor)&&this.triggerEvent(h),t*=this.speed;for(var l=0;l<this.actionList.length;l++){var u=this.actionList[l];if((!ps.ScrFix.isP||!/^heng_/.test(u[1].name))&&((!ps.ScrFix.isL||!/^shu_/.test(u[1].name))&&u)){n=u[0];var c=u[1];if(this.elapsedFrame<n){for(var p in c.propertyList)if("Visible"===c.propertyList[p].propertyInfo.name){var d=c.propertyList[p].path,f=s.gameOb.world.find("UIRoot/gamePlay/"+d);f.visible=!1}}else{var _=!1;this.runningActions[l]||(_=!0),this.elapsedFrame>=this.duration&&(c.elapsedFrame=c.duration),c.update(t,_,i,r),this.runningActions[l]=!0}}}}},di.prototype.addAction=function(t){var e=this,i=e.actionList.push(t),r=t[0],n=t[1];if(n.parent=e,e.endLinePos>-1)return i;var a=n.getDuration();if(a===s.MAX_DURATION)e.duration=a;else{var o=e.samples,h=n.samples;a=a*o/h,e.duration<r+a&&(e.duration=r+a)}return i},di.prototype.deleteAction=function(t){var e=this;if(e.actionList[t]){var r=e.actionList[t][1],n=0;if(r){var a=r.getDuration();if(a===s.MAX_DURATION)n=s.MAX_DURATION;else{var o=e.samples,h=r.samples;a=a*o/h,n=e.actionList[t][0]+a}r.destroy(),r.parent=i}e.actionList.splice(t,1),this.duration===n&&this.getDuration(!0)}},di.prototype.updateActionTime=function(t,e){var i=this,r=i.actionList[t];r&&(r[0]=e,i.getDuration(!0))},di.prototype.getDuration=function(t,e){if(t&&this.endLinePos<=-1){for(var i=0,r=0;r<this.actionList.length;r++){var n=this.actionList[r];if(n){var a=n[1].getDuration(),o=n[0];if(a===s.MAX_DURATION)i=s.MAX_DURATION;else{var h=this.samples,l=n[1].samples;a=a*h/l/n[1].speed,i<o+a&&(i=o+a)}}}this.duration=i}return this.loop&&!e?s.MAX_DURATION:this.endLinePos>-1?this.endLinePos:this.duration},di.buildEmptyBundle=function(){return{actionList:[]}},di.buildBundle=function(t){var e=s.ActionState.buildBundle(t);e.endLinePos=t.endLinePos;for(var r=[],n=0;n<t.actionList.length;n++){var a=t.actionList[n];if(a){var o=a[1],h=a[0],l=o.uuid,u=o.loop,c=o.targetObject?o.targetObject.uuid:i;e.dependences.push({key:o.key,uuid:l}),r.push([h,l,u,c,o.targetLocked,o.speed])}}return e.actionList=r,e},di.restoreBundle=function(t,e,i,r){var n=t.json,a=new s.ActionManager(e);if(r||(r={}),r[t.uuid])return e.log.error("Failed to add this action({0}) because of recursive reference.",t.key),!1;r[t.uuid]=!0,a.endLinePos=n.endLinePos?n.endLinePos:-1;for(var o=0;o<n.actionList.length;o++){var h=n.actionList[o]||[],l=h[0],u=h[1],c=h[2],p=h[3],d=h[4],f=h[5]||1,_=e.assets.findByUUID(u);if(_){var g;if(_ instanceof s.ActionAsset)g=s.Action.restoreBundle(_,e,!e.serializer.isRestoring);else if(_ instanceof s.ActionManagerAsset&&(g=s.ActionManager.restoreBundle(_,e,!e.serializer.isRestoring,r),!g))return delete r[t.uuid],!1;g.loop=c,g.speed=f,e.serializer.isRestoring?g.targetObject=e.nodePool.find(p)||p:g.targetObject=e.nodePool.find(p),g.targetLocked=d,a.addAction([l,g])}}return delete r[t.uuid],a=s.ActionState.restoreBundle(a,t,i),a},di.prototype.stop=function(){this.isRunning=!1;for(var t=0;t<this.actionList.length;t++)if(this.actionList[t]){var e=this.actionList[t][1];e&&e.stop()}};var fi=s.AnimationKeyProp=function(t,e,i){var r=this;s.KeyProp.call(r,t,e,i)};fi.prototype=e.create(s.KeyProp.prototype),fi.prototype.constructor=fi,fi.prototype.updateAttrib=function(t,e,i,r){var n=t.getScript("ps.SKPlayer");i!==n.animationName&&(n.animationName=i,n.play())};var _i=s.SequenceFrameKeyProp=function(t,e,i){var r=this;s.KeyProp.call(r,t,e,i)};_i.prototype=e.create(s.KeyProp.prototype),_i.prototype.constructor=_i,_i.prototype.updateAttrib=function(t,e,i,r){var n=t.getScript("ps.MovieClip");i!==n.currentFrameName&&n.gotoAndPlay(i)};var gi=s.ColorLinearProp=function(t,e,i){var r=this;s.LinearProp.call(r,t,e,i)};gi.prototype=e.create(s.LinearProp.prototype),gi.prototype.constructor=gi,gi.prototype.calcValue=function(t,e,i){if(!t||!e)return s.Color.white;var r=t.rgb,n=e.rgb,a=[o.Math.clamp(Math.round(r[0]+i*(n[0]-r[0])),0,255),o.Math.clamp(Math.round(r[1]+i*(n[1]-r[1])),0,255),o.Math.clamp(Math.round(r[2]+i*(n[2]-r[2])),0,255),o.Math.clamp(t.alpha+i*(e.alpha-t.alpha),0,1)],h=new vt(a);return h};var mi=s.TextureKeyProp=function(t,e,i){var r=this;s.KeyProp.call(r,t,e,i)};mi.prototype=e.create(s.KeyProp.prototype),mi.prototype.constructor=mi,mi.prototype.updateAttrib=function(t,e,i,r){if(!i){var n=this.action.game.assets.find("__builtin_resource__"),a=n?n.frameNames[0]:0;i=[n,a]}n=i[0],a=i[1];var o=n?new s.Texture(n,a):null;if(r){var h=r.length;if(2===h&&t[r[0]])t[r[0]][r[1]]=o;else if(h>2){for(var l=t,u=0;u<h-1&&(l=l[r[u]],l);u++);l&&(l[r[h-1]]=o)}}else t[e]=o};var yi=s.Time=function(t){this.phaser=t.phaser.time,this.phaser._qc=this,this.onFrameRateChanged=new s.Signal};yi.prototype.constructor=yi,e.defineProperties(yi.prototype,{game:{get:function(){return this.phaser.game._qc}},now:{get:function(){return Date.now()}},fixedTime:{get:function(){return 1e3*this.phaser.totalElapsedSeconds()}},scaledTime:{get:function(){return this.phaser._totalEscapeTime||0}},timeScale:{get:function(){return this.phaser.slowMotion},set:function(t){t<=0&&(t=1e-6),this.phaser.slowMotion=t}},frameRate:{get:function(){return this.phaser.desiredFps},set:function(t){this.phaser.desiredFps=t,this.onFrameRateChanged.dispatch(t)}},deltaTime:{get:function(){return this.phaser.frameDeltaTime}}}),yi.prototype.applyFrameRate=function(t){var e=this.game.device.desktop?t.desktop:t.mobile;this.frameRate=e};var vi=s.LinkList=function(t){for(this.length=t,this.head=null,this.tail=null;t--;)this.push({})};vi.prototype={},vi.prototype.constructor=vi,vi.prototype.push=function(t){t.pre=null,t.next=null,this.head?(this.tail.next=t,t.pre=this.tail,this.tail=this.tail.next):(this.head=t,this.tail=this.head),this.length++},vi.prototype.insertBefore=function(t,e){if(t){var i=t.pre;t.pre=e,e.next=t,e.pre=i,i&&(i.next=e),e.pre||(this.head=e)}else this.push(e)},vi.prototype.remove=function(t){var e=t.pre,i=t.next;e&&(e.next=i),i&&(i.pre=e),t===this.head&&(this.head=i),t===this.tail&&(this.tail=e),t.pre=null,t.next=null,this.length--};var Ti=s.Timer=function(t){var e=this;e.game=t,e.paused=!1,e.events=new s.LinkList(0),e.loopEvents=new s.LinkList(0),this._nextTimerBegin=0,this._nextLoopTimerBegin=0};Ti.prototype.constructor=Ti,Ti.prototype.create=function(t,e,i,r,n){t=Math.round(t);var a=new o.TimerEvent(this,t,t,0,e,i,r,n);return this._pushEvent(e?this.loopEvents:this.events,a),a},Ti.prototype.add=function(t,e,i){t=t>0?t:1;return t+=this._nextTimerBegin,this.create(t,!1,e,i,Array.prototype.splice.call(arguments,3))},Ti.prototype.loop=function(t,e,i){t=t>0?t:1;return t+=this._nextLoopTimerBegin,this.create(t,!0,e,i,Array.prototype.splice.call(arguments,3))},Ti.prototype.remove=function(t){t.__delete=!0},Ti.prototype.update=function(t){if(!this.paused){this._now=this._now?this._now:t;var e=(t-this._now)/this.game.time.timeScale;this._now=t;for(var i=this.events.head,r=e,n=0;i&&(i.delta-=r,!(i.delta>0));){if(n++,n>2e3)throw new Error("timer loop forever!");this._nextTimerBegin=r=-i.delta,this.events.remove(i),i.__delete||i.callback.apply(i.callbackContext,i.args),i=this.events.head}this._nextTimerBegin=0;var a=[];for(i=this.loopEvents.head,r=e;i&&(i.delta-=r,!(i.delta>0));){if(this._nextLoopTimerBegin=r=-i.delta,this.loopEvents.remove(i),!i.__delete){a.push(i);try{i.callback.apply(i.callbackContext,i.args)}catch(t){}}i=this.loopEvents.head}this._nextLoopTimerBegin=0;for(var s=0;s<a.length;s++)this._pushEvent(this.loopEvents,a[s])}},Ti.prototype._pushEvent=function(t,e){var i=t.head;if(!i)return e.delta=e.delay,void t.push(e);for(var r=e.delay;i;){if(!(r>=i.delta))return i.delta-=r,e.delta=r,t.insertBefore(i,e),e;r-=i.delta,i=i.next}return e.delta=r,t.push(e),e},s.TimerEvent=o.TimerEvent;var xi=s.Filter=function(t){o.Filter.call(this,t),this._textureCount=1,this.extraAttribute=[],this.customInspectors={}};xi.prototype=e.create(o.Filter.prototype),xi.prototype.constructor=xi,e.defineProperties(xi.prototype,{textureCount:{get:function(){return this._textureCount}}}),xi.prototype.registerCustomInspector=function(t,e){this.customInspectors[t]=e},xi.filters={},xi.F1="1f",xi.F1V="1fv",xi.I1="1i",xi.F2="2f",xi.F2V="2fv",xi.I2="2i",xi.I2V="2iv",xi.F3="3f",xi.F3V="3fv",xi.I3="3i",xi.I3V="3iv",xi.F4="4f",xi.F4V="4fv",xi.I4="4i",xi.I4V="4iv",xi.MAT2="mat2",xi.MAT3="mat3",xi.MAT4="mat4",xi.SAMPLER2D="sampler2D",xi.MAX_SAMPLE_COUNT=8,xi.mixinUniform=function(t,e){if(e)for(var i in e){var r=e[i],n=r===xi.SAMPLER2D;if(!(n&&t.textureCount>=xi.MAX_SAMPLE_COUNT)){var a=function(){var e=i;return n?(t._textureCount++,function(){return t[e]&&t[e].filterTexture}):function(){return t[e]}};if(t.uniforms[i]=new Si(r,a()),n){var s="a"+i.substring(0,1).toUpperCase()+i.substring(1)+"Coord";t.extraAttribute.push({name:s,texture:i})}}}},xi.uniformToJson=function(t,e,i){switch(t){case xi.F1:case xi.I1:case xi.I2V:case xi.F2V:case xi.I3V:case xi.F3V:case xi.I4V:case xi.F4V:case xi.MAT2:case xi.MAT3:case xi.MAT4:return[t,e];case xi.I2:case xi.F2:return[t,[e.x,e.y]];case xi.I3:case xi.F3:return[t,[e.x,e.y,e.z]];case xi.I4:case xi.F4:return[t,[e.x,e.y,e.z,e.w]];case xi.SAMPLER2D:if(!(e instanceof Ai))return[t,[]];var r=e.texture;return r?(i.dependences.push({key:r.key,uuid:r.uuid}),[t,[r.key,r.url,r.uuid,e.frame]]):[t,[]]}return[t,[]]},xi.uniformFromJson=function(t,e,i,r,n){if(n)switch(r){case xi.F1:case xi.I1:case xi.I2V:case xi.F2V:case xi.I3V:case xi.F3V:case xi.I4V:case xi.F4V:case xi.MAT2:case xi.MAT3:case xi.MAT4:return void(e[i]=n);case xi.I2:case xi.F2:return void(e[i]?(e[i].x=n[0],e[i].y=n[1]):e[i]={x:n[0],y:n[1]});case xi.I3:case xi.F3:return void(e[i]?(e[i].x=n[0],e[i].y=n[1],e[i].z=n[2]):e[i]={x:n[0],y:n[1],z:n[2]});case xi.I4:case xi.F4:return void(e[i]?(e[i].x=n[0],e[i].y=n[1],e[i].z=n[2],e[i].w=n[3]):e[i]={x:n[0],y:n[1],z:n[2],w:n[3]});case xi.SAMPLER2D:if(!n)return;var a=new Ai(t);if(n.length>0){var o=t.assets.find(n[0],n[1]);if(o||(o=t.assets.findByUUID(n[2])),!o)return void t.log.error("Texture({0}) not loaded, deserialize fail.",n[1]);if(!(o instanceof s.Atlas))return;a.texture=o,a.frame=n[3]}return void(e[i]=a)}},j.prototype._saveFilter=function(t,e,i,r,n){
n&&(e[r]=this._saveFilterItem(n,i))},j.prototype._restoreFilter=function(t,e,i,r){t[i]=this._restoreFilterItem(r)},j.prototype._saveFilterItem=function(t,e){var i=t.getExtraUniforms(),r={};for(var n in i){var a=i[n];r[n]=xi.uniformToJson(a,t[n],e)}return[j.FILTER,t.class,r]},j.prototype._restoreFilterItem=function(t){var e=s.Util.findClass(t[1]);if(e){var i=t[2],r=new e(this.game),n=r.getExtraUniforms();for(var a in n){var o=n[a];i[a]&&o===i[a][0]&&xi.uniformFromJson(this.game,r,a,o,i[a][1])}return r}console.warn("着色器脚本：{0}未找到，无法反序列化。",t[1])};var bi=s.defineFilter=function(i,r,n,o){for(var h=i.split("."),l=t,u=0;u<h.length-1;u++)l[h[u]]||(l[h[u]]={}),l=l[h[u]];var c=h[h.length-1];return r=r||s.Filter,"function"==typeof o&&(o=o.call(this)),o=o||{},l[c]=function(t){r.call(this,t),this.class=i,this.super=r.prototype;var e=this.getExtraUniforms();xi.mixinUniform(this,e),"function"==typeof n&&n.call(this,t)},l[c].prototype=e.create(r.prototype),l[c].prototype.constructor=l[c],l[c].prototype.getExtraUniforms=function(){var t=r.prototype.getExtraUniforms?r.prototype.getExtraUniforms.call(this):{};return a(t,o)},l[c].prototype.clazz=i,xi.filters[i]=l[c],l[c]},Ai=s.Filter.FilterTexture=function(t){this._image=new s.UIImage(t,null,!1),this._image.parent.removeChild(this._image)};Ai.prototype={},Ai.prototype.constructor=Ai,e.defineProperties(Ai.prototype,{texture:{get:function(){return this._image.texture},set:function(t){this._image.texture=t}},frame:{get:function(){return this._image.frame},set:function(t){this._image.frame=t}},filterTexture:{get:function(){return this._image.phaser.texture}}});var Si=s.Filter.UniformHelp=function(t,e){this._type=t,this._value=e,this._valueIsFunc="function"==typeof this._value};Si.prototype={},Si.prototype.constructor=Si,e.defineProperties(Si.prototype,{type:{get:function(){return this._type}},value:{get:function(){return this._valueIsFunc?this._value():this._value}}});bi("qc.Filter.AlphaMask",s.Filter,function(t){this.otherTexture=null,this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = add.a * original;","}"]},{otherTexture:s.Filter.SAMPLER2D}),bi("qc.Filter.BlendTexture",s.Filter,function(t){this.mixing=.5,this.otherTexture=null,this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","uniform float mixing;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = mixing * add + (1.0 - mixing) * original;","}"]},{otherTexture:s.Filter.SAMPLER2D,mixing:s.Filter.F1});var wi=bi("qc.Filter.BlurX",s.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x - blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x + blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","gl_FragColor = sum;","}"],this.blur=1},{blur:s.Filter.F1});e.defineProperty(wi.prototype,"blur",{get:function(){return this._blur},set:function(t){this.dirty=!0,this._blur=t,this.padding=Math.max(0,t)}});var Pi=bi("qc.Filter.BlurY",s.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur*pixelSize.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur*pixelSize.y)) * 0.05;","gl_FragColor = sum;","}"],this.blur=1},{blur:s.Filter.F1});e.defineProperty(Pi.prototype,"blur",{get:function(){return this._blur},set:function(t){this.dirty=!0,this._blur=t,this.padding=Math.max(0,t)}});var Ei=bi("qc.Filter.Glow",s.Filter,function(t){this.distance=40,this.outerStrength=1.5,this.innerStrength=1,this.glowColor=[1,0,0],this.pixelWidth=1/t.phaser.renderer.width,this.pixelHeight=1/t.phaser.renderer.height,this._updateFragmentSrc(),this.registerCustomInspector("glowColor",s.Color)},{distance:s.Filter.F1,outerStrength:s.Filter.F1,innerStrength:s.Filter.F1,glowColor:s.Filter.F3V});e.defineProperty(Ei.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance=t,this._updateFragmentSrc(),this.shaders=[]}}),Ei.prototype._updateFragmentSrc=function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D texture;","uniform float distance;","uniform float outerStrength;","uniform float innerStrength;","uniform vec3 glowColor;","uniform float pixelWidth;","uniform float pixelHeight;","vec2 px = vec2("+this.pixelWidth+", "+this.pixelHeight+");","void main(void) {","    const float PI = 3.14159265358979323846264;","    vec4 ownColor = texture2D(texture, vTextureCoord);","    vec4 curColor;","    float totalAlpha = 0.;","    float maxTotalAlpha = 0.;","    float offset = 0.;","    for (float curDistance = 0.; curDistance <= "+this.distance.toFixed(7)+"; curDistance++) {","       offset = curDistance - distance / 2.;","       curColor = texture2D(texture, vec2(vTextureCoord.x + offset * px.x, vTextureCoord.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x, vTextureCoord.y + offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x + cos(PI * 0.25) * offset * px.x, vTextureCoord.y + sin(PI * 0.25) * offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x + cos(PI * 0.75) * offset * px.x, vTextureCoord.y + sin(PI * 0.75) * offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","    }","    maxTotalAlpha = max(maxTotalAlpha, 0.0001);","    ownColor.a = max(ownColor.a, 0.0001);","    ownColor.rgb = ownColor.rgb / ownColor.a;","    float outerGlowAlpha = (totalAlpha / maxTotalAlpha)  * outerStrength * (1. - ownColor.a);","    float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * innerStrength * ownColor.a;","    float resultAlpha = (ownColor.a + outerGlowAlpha);","    gl_FragColor = vec4(mix(mix(ownColor.rgb, glowColor, innerGlowAlpha / ownColor.a), glowColor.rgb, outerGlowAlpha / resultAlpha) * resultAlpha, resultAlpha);","}"]};var Di=s.Filter.GraphicsTexture=function(t,e,i,r,n){var a=this;a.game=t,a._texture=new s.RenderTexture(e||100,i||100,r||a.game.phaser.render,null,n||a.game.resolution),a.offset=new s.Point(0,0),a._graphics=a.game.phaser.add.graphics(0,0),a._graphics.parent&&a._graphics.parent.remove(a._graphics)};Di.prototype={},Di.prototype.constructor=Di,e.defineProperties(Di.prototype,{graphics:{get:function(){return this._graphics}},filterTexture:{get:function(){return this._texture}}}),Di.prototype.updateTexture=function(){var t=this,e=t._texture,i=t._graphics;i.dirty&&e.directRenderWebGL(i,t.offset,!0)},Di.prototype.resize=function(t,e){t=t<=1?1:t,e=e<=1?1:e,this._texture.resize(t,e,!0)};bi("qc.Filter.Gray",s.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float gray = original.r * 0.3 + original.g * 0.59 + original.b * 0.11;","   gl_FragColor =  original;","   gl_FragColor.r = gray;","   gl_FragColor.g = gray;","   gl_FragColor.b = gray;","}"]},{}),bi("qc.Filter.Highlight",s.Filter,function(t){this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float light;","uniform vec3 lightColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vLight = light * vec4(lightColor, 0.0);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   gl_FragColor = original + original.a * vLight;","}"],this.light=.5,this.lightColor=[1,1,1],this.registerCustomInspector("lightColor",s.Color)},{light:s.Filter.F1,lightColor:s.Filter.F3V}),bi("qc.Filter.KeepSource",s.Filter,function(t){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec2 vMaskCoord;","varying vec4 vMaskLimit;","uniform sampler2D uSampler;","uniform sampler2D uSourceSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(uSourceSampler, vTextureCoord);","   gl_FragColor =  add.a * add + (1.0 - add.a) * original;","}"]},{})}}).call(this,this,Object),function(t){var e=function(){function e(i){this._clock=new t.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=i,console.info("DragonBones: "+e.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return e.prototype.advanceTime=function(e){if(this._objects.length>0){for(var i=0,r=this._objects;i<r.length;i++){var n=r[i];n.returnToPool()}this._objects.length=0}if(this._clock.advanceTime(e),this._events.length>0){for(var a=0;a<this._events.length;++a){var s=this._events[a],o=s.armature;null!==o._armatureData&&(o.eventDispatcher.dispatchDBEvent(s.type,s),s.type===t.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(s.type,s)),this.bufferObject(s)}this._events.length=0}},e.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},e.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.VERSION="5.7.000",e.yDown=!0,e.debug=!1,e.debugDraw=!1,e}();t.DragonBones=e}(dragonBones||(dragonBones={})),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function(){return(new Date).getTime()});var dragonBones,__extends=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i};if(void 0===global&&"undefined"!=typeof window)var global=window;"object"==typeof exports&&"object"==typeof module?module.exports=dragonBones:"function"==typeof define&&define.amd?define(["dragonBones"],function(){return dragonBones}):"object"==typeof exports?exports=dragonBones:void 0!==global&&(global.dragonBones=dragonBones),function(t){var e=function(){function t(){this.hashCode=t._hashCode++,this._isInPool=!1}return t._returnObject=function(e){var i=String(e.constructor),r=i in t._maxCountMap?t._maxCountMap[i]:t._defaultMaxCount,n=t._poolsMap[i]=t._poolsMap[i]||[];n.length<r&&(e._isInPool?console.warn("The object is already in the pool."):(e._isInPool=!0,n.push(e)))},t.toString=function(){throw new Error},t.setMaxCount=function(e,i){if((i<0||i!=i)&&(i=0),null!==e){var r=String(e),n=r in t._poolsMap?t._poolsMap[r]:null;null!==n&&n.length>i&&(n.length=i),t._maxCountMap[r]=i}else for(var r in t._defaultMaxCount=i,t._poolsMap){n=t._poolsMap[r];n.length>i&&(n.length=i),r in t._maxCountMap&&(t._maxCountMap[r]=i)}},t.clearPool=function(e){if(void 0===e&&(e=null),null!==e){var i=String(e),r=i in t._poolsMap?t._poolsMap[i]:null;null!==r&&r.length>0&&(r.length=0)}else for(var n in t._poolsMap){r=t._poolsMap[n];r.length=0}},t.borrowObject=function(e){var i=String(e),r=i in t._poolsMap?t._poolsMap[i]:null;if(null!==r&&r.length>0){var n=r.pop();return n._isInPool=!1,n}var a=new e;return a._onClear(),a},t.prototype.returnToPool=function(){this._onClear(),t._returnObject(this)},t._hashCode=0,t._defaultMaxCount=3e3,t._maxCountMap={},t._poolsMap={},t}();t.BaseObject=e}(dragonBones||(dragonBones={})),function(t){var e=function(){function t(t,e,i,r,n,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},t.prototype.concat=function(t){var e=this.a*t.a,i=0,r=0,n=this.d*t.d,a=this.tx*t.a+t.tx,s=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,i+=this.b*t.d,r+=this.c*t.a,n+=this.c*t.b),0===t.b&&0===t.c||(i+=this.a*t.b,r+=this.d*t.c,a+=this.ty*t.c,s+=this.tx*t.b),this.a=e,this.b=i,this.c=r,this.d=n,this.tx=a,this.ty=s,this},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,a=this.ty;if(0===e&&0===i)return this.b=this.c=0,0===t||0===r?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,r=this.d=1/r,this.tx=-t*n,this.ty=-r*a),this;var s=t*r-e*i;if(0===s)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;s=1/s;var o=this.a=r*s;return e=this.b=-e*s,i=this.c=-i*s,r=this.d=t*s,this.tx=-(o*n+i*a),this.ty=-(e*n+r*a),this},t.prototype.transformPoint=function(t,e,i,r){void 0===r&&(r=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,r||(i.x+=this.tx,i.y+=this.ty)},t.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var i=this.a,r=this.b,n=this.c,a=this.d,s=e?0:this.tx,o=e?0:this.ty,h=t.x,l=t.y,u=h+t.width,c=l+t.height,p=i*h+n*l+s,d=r*h+a*l+o,f=i*u+n*l+s,_=r*u+a*l+o,g=i*u+n*c+s,m=r*u+a*c+o,y=i*h+n*c+s,v=r*h+a*c+o,T=0;p>f&&(T=p,p=f,f=T),g>y&&(T=g,g=y,y=T),t.x=Math.floor(p<g?p:g),t.width=Math.ceil((f>y?f:y)-t.x),d>_&&(T=d,d=_,_=T),m>v&&(T=m,m=v,v=T),t.y=Math.floor(d<m?d:m),t.height=Math.ceil((_>v?_:v)-t.y)},t}();t.Matrix=e}(dragonBones||(dragonBones={})),function(t){var e=function(){function t(t,e,i,r,n,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===a&&(a=1),this.x=t,this.y=e,this.skew=i,this.rotation=r,this.scaleX=n,this.scaleY=a}return t.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=t>0?-Math.PI:Math.PI,t},t.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},t.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},t.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},t.prototype.fromMatrix=function(e){var i=this.scaleX,r=this.scaleY,n=t.PI_Q;this.x=e.tx,this.y=e.ty,this.rotation=Math.atan(e.b/e.a);var a=Math.atan(-e.c/e.d);return this.scaleX=this.rotation>-n&&this.rotation<n?e.a/Math.cos(this.rotation):e.b/Math.sin(this.rotation),this.scaleY=a>-n&&a<n?e.d/Math.cos(a):-e.c/Math.sin(a),i>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),r>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,a-=Math.PI),this.skew=a-this.rotation,this},t.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},t.PI=Math.PI,t.PI_D=2*Math.PI,t.PI_H=Math.PI/2,t.PI_Q=Math.PI/4,t.RAD_DEG=180/Math.PI,t.DEG_RAD=Math.PI/180,t}();t.Transform=e}(dragonBones||(dragonBones={})),function(t){var e=function(){function t(t,e,i,r,n,a,s,o){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===o&&(o=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=r,this.alphaOffset=n,this.redOffset=a,this.greenOffset=s,this.blueOffset=o}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=e}(dragonBones||(dragonBones={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=e}(dragonBones||(dragonBones={})),function(t){var e=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=t,this.y=e,this.width=i,this.height=r}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=e}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.UserData]"},e.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},e.prototype.addInt=function(t){this.ints.push(t)},e.prototype.addFloat=function(t){this.floats.push(t)},e.prototype.addString=function(t){this.strings.push(t)},e.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},e.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},e.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},e}(t.BaseObject);t.UserData=e;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return __extends(e,t),e.toString=function(){return"[class dragonBones.ActionData]"},e.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},e}(t.BaseObject);t.ActionData=i}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameIndices=[],e.cachedFrames=[],e.armatureNames=[],e.armatures={},e.userData=null,e}return __extends(e,t),e.toString=function(){return"[class dragonBones.DragonBonesData]"},e.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.colorArray=null,this.userData=null},e.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):(t.parent=this,this.armatures[t.name]=t,this.armatureNames.push(t.name))},e.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},e}(t.BaseObject);t.DragonBonesData=e}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.aabb=new t.Rectangle,i.animationNameList=[],i.sortedBones=[],i.sortedSlots=[],i.defaultActions=[],i.actions=[],i.bones={},i.slots={},i.constraints={},i.skins={},i.animations={},i.canvas=null,i.userData=null,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.ArmatureData]"},i.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++){var i=e[t];i.returnToPool()}for(var r=0,n=this.actions;r<n.length;r++){i=n[r];i.returnToPool()}for(var a in this.bones)this.bones[a].returnToPool(),delete this.bones[a];for(var a in this.slots)this.slots[a].returnToPool(),delete this.slots[a];for(var a in this.constraints)this.constraints[a].returnToPool(),delete this.constraints[a];for(var a in this.skins)this.skins[a].returnToPool(),delete this.skins[a];for(var a in this.animations)this.animations[a].returnToPool(),delete this.animations[a];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNameList.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},i.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),i=0,r=0;for(this.sortedBones.length=0;r<t;){var n=e[i++];if(i>=t&&(i=0),!(this.sortedBones.indexOf(n)>=0)){var a=!1;for(var s in this.constraints){var o=this.constraints[s];if(o.root===n&&this.sortedBones.indexOf(o.target)<0){a=!0;break}}a||null!==n.parent&&this.sortedBones.indexOf(n.parent)<0||(this.sortedBones.push(n),r++)}}}},i.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},i.prototype.setCacheFrame=function(t,e){var i=this.parent.cachedFrames,r=i.length;return i.length+=10,i[r]=t.a,i[r+1]=t.b,i[r+2]=t.c,i[r+3]=t.d,i[r+4]=t.tx,i[r+5]=t.ty,i[r+6]=e.rotation,i[r+7]=e.skew,i[r+8]=e.scaleX,i[r+9]=e.scaleY,r},i.prototype.getCacheFrame=function(t,e,i){var r=this.parent.cachedFrames;t.a=r[i],t.b=r[i+1],t.c=r[i+2],t.d=r[i+3],t.tx=r[i+4],t.ty=r[i+5],e.rotation=r[i+6],e.skew=r[i+7],e.scaleX=r[i+8],e.scaleY=r[i+9],e.x=t.tx,e.y=t.ty},i.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},i.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},i.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},i.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):(t.parent=this,this.skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},i.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):(t.parent=this,this.animations[t.name]=t,this.animationNameList.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},i.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},i.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},i.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},i.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},i.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},i.prototype.getMesh=function(t,e,i){var r=this.getSkin(t);return null===r?null:r.getDisplay(e,i)},i.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},i}(t.BaseObject);t.ArmatureData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i.userData=null,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.BoneData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.alpha=1,this.name="",this.transform.identity(),this.userData=null,this.parent=null},i}(t.BaseObject);t.BoneData=i;var r=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.geometry=new t.GeometryData,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.SurfaceData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.geometry.clear()},i}(i);t.SurfaceData=r;var n=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return __extends(i,e),i.createColor=function(){return new t.ColorTransform},i.toString=function(){return"[class dragonBones.SlotData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.zIndex=0,this.alpha=1,this.name="",this.color=null,this.userData=null,this.parent=null},i.DEFAULT_COLOR=new t.ColorTransform,i}(t.BaseObject);t.SlotData=n}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.CanvasData]"},e.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},e}(t.BaseObject);t.CanvasData=e}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return __extends(e,t),e.toString=function(){return"[class dragonBones.SkinData]"},e.prototype._onClear=function(){for(var t in this.displays){for(var e=this.displays[t],i=0,r=e;i<r.length;i++){var n=r[i];null!==n&&n.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},e.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this);var i=this.displays[t];i.push(e)},e.prototype.getDisplay=function(t,e){var i=this.getDisplays(t);if(null!==i)for(var r=0,n=i;r<n.length;r++){var a=n[r];if(null!==a&&a.name===e)return a}return null},e.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},e}(t.BaseObject);t.SkinData=e}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},e}(t.BaseObject);t.ConstraintData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},e}(e);t.IKConstraintData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.PathConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},e.prototype.AddBone=function(t){this.bones.push(t)},e}(e);t.PathConstraintData=r}(dragonBones||(dragonBones={})),function(t){var e=function(){function t(){this.weight=null}return t.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},t.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},Object.defineProperty(t.prototype,"vertexCount",{get:function(){var t=this.data.intArray
;return t[this.offset+0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"triangleCount",{get:function(){var t=this.data.intArray;return t[this.offset+1]},enumerable:!0,configurable:!0}),t}();t.GeometryData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i}return __extends(i,e),i.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},i}(t.BaseObject);t.DisplayData=i;var r=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.pivot=new t.Point,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.ImageDisplayData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},i}(i);t.ImageDisplayData=r;var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,i=this.actions;e<i.length;e++){var r=i[e];r.returnToPool()}this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},e.prototype.addAction=function(t){this.actions.push(t)},e}(i);t.ArmatureDisplayData=n;var a=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.geometry=new e,i}return __extends(i,t),i.toString=function(){return"[class dragonBones.MeshDisplayData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.geometry.clear(),this.texture=null},i}(i);t.MeshDisplayData=a;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return __extends(e,t),e.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},e}(i);t.BoundingBoxDisplayData=s;var o=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.geometry=new e,i.curveLengths=[],i}return __extends(i,t),i.toString=function(){return"[class dragonBones.PathDisplayData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.geometry.clear(),this.curveLengths.length=0},i}(i);t.PathDisplayData=o;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.WeightData]"},e.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},e.prototype.addBone=function(t){this.bones.push(t)},e}(t.BaseObject);t.WeightData=h}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},e}(t.BaseObject);t.BoundingBoxData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},e._computeOutCode=function(t,e,i,r,n,a){var s=0;return t<i?s|=1:t>n&&(s|=2),e<r?s|=4:e>a&&(s|=8),s},e.rectangleIntersectsSegment=function(t,i,r,n,a,s,o,h,l,u,c){void 0===l&&(l=null),void 0===u&&(u=null),void 0===c&&(c=null);var p=t>a&&t<o&&i>s&&i<h,d=r>a&&r<o&&n>s&&n<h;if(p&&d)return-1;for(var f=0,_=e._computeOutCode(t,i,a,s,o,h),g=e._computeOutCode(r,n,a,s,o,h);;){if(0==(_|g)){f=2;break}if(0!=(_&g))break;var m=0,y=0,v=0,T=0!==_?_:g;0!=(4&T)?(m=t+(r-t)*(s-i)/(n-i),y=s,null!==c&&(v=.5*-Math.PI)):0!=(8&T)?(m=t+(r-t)*(h-i)/(n-i),y=h,null!==c&&(v=.5*Math.PI)):0!=(2&T)?(y=i+(n-i)*(o-t)/(r-t),m=o,null!==c&&(v=0)):0!=(1&T)&&(y=i+(n-i)*(a-t)/(r-t),m=a,null!==c&&(v=Math.PI)),T===_?(t=m,i=y,_=e._computeOutCode(t,i,a,s,o,h),null!==c&&(c.x=v)):(r=m,n=y,g=e._computeOutCode(r,n,a,s,o,h),null!==c&&(c.y=v))}return f&&(p?(f=2,null!==l&&(l.x=r,l.y=n),null!==u&&(u.x=r,u.y=r),null!==c&&(c.x=c.y+Math.PI)):d?(f=1,null!==l&&(l.x=t,l.y=i),null!==u&&(u.x=t,u.y=i),null!==c&&(c.y=c.x+Math.PI)):(f=3,null!==l&&(l.x=t,l.y=i),null!==u&&(u.x=r,u.y=n))),f},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},e.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var r=.5*this.height;if(e>=-r&&e<=r)return!0}return!1},e.prototype.intersectsSegment=function(t,i,r,n,a,s,o){void 0===a&&(a=null),void 0===s&&(s=null),void 0===o&&(o=null);var h=.5*this.width,l=.5*this.height,u=e.rectangleIntersectsSegment(t,i,r,n,-h,-l,h,l,a,s,o);return u},e}(e);t.RectangleBoundingBoxData=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.EllipseData]"},e.ellipseIntersectsSegment=function(t,e,i,r,n,a,s,o,h,l,u){void 0===h&&(h=null),void 0===l&&(l=null),void 0===u&&(u=null);var c=s/o,p=c*c;e*=c,r*=c;var d=i-t,f=r-e,_=Math.sqrt(d*d+f*f),g=d/_,m=f/_,y=(n-t)*g+(a-e)*m,v=y*y,T=t*t+e*e,x=s*s,b=x-T+v,A=0;if(b>=0){var S=Math.sqrt(b),w=y-S,P=y+S,E=w<0?-1:w<=_?0:1,D=P<0?-1:P<=_?0:1,C=E*D;if(C<0)return-1;0===C&&(-1===E?(A=2,i=t+P*g,r=(e+P*m)/c,null!==h&&(h.x=i,h.y=r),null!==l&&(l.x=i,l.y=r),null!==u&&(u.x=Math.atan2(r/x*p,i/x),u.y=u.x+Math.PI)):1===D?(A=1,t+=w*g,e=(e+w*m)/c,null!==h&&(h.x=t,h.y=e),null!==l&&(l.x=t,l.y=e),null!==u&&(u.x=Math.atan2(e/x*p,t/x),u.y=u.x+Math.PI)):(A=3,null!==h&&(h.x=t+w*g,h.y=(e+w*m)/c,null!==u&&(u.x=Math.atan2(h.y/x*p,h.x/x))),null!==l&&(l.x=t+P*g,l.y=(e+P*m)/c,null!==u&&(u.y=Math.atan2(l.y/x*p,l.x/x)))))}return A},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},e.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var r=.5*this.height;if(e>=-r&&e<=r)return e*=i/r,Math.sqrt(t*t+e*e)<=i}return!1},e.prototype.intersectsSegment=function(t,i,r,n,a,s,o){void 0===a&&(a=null),void 0===s&&(s=null),void 0===o&&(o=null);var h=e.ellipseIntersectsSegment(t,i,r,n,0,0,.5*this.width,.5*this.height,a,s,o);return h},e}(e);t.EllipseBoundingBoxData=r;var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},e.polygonIntersectsSegment=function(t,e,i,r,n,a,s,o){void 0===a&&(a=null),void 0===s&&(s=null),void 0===o&&(o=null),t===i&&(t=i+1e-6),e===r&&(e=r+1e-6);for(var h=n.length,l=t-i,u=e-r,c=t*r-e*i,p=0,d=n[h-2],f=n[h-1],_=0,g=0,m=0,y=0,v=0,T=0,x=0;x<h;x+=2){var b=n[x],A=n[x+1];d===b&&(d=b+1e-4),f===A&&(f=A+1e-4);var S=d-b,w=f-A,P=d*A-f*b,E=l*w-u*S,D=(c*S-l*P)/E;if((D>=d&&D<=b||D>=b&&D<=d)&&(0===l||D>=t&&D<=i||D>=i&&D<=t)){var C=(c*w-u*P)/E;if((C>=f&&C<=A||C>=A&&C<=f)&&(0===u||C>=e&&C<=r||C>=r&&C<=e)){if(null===s){m=D,y=C,v=D,T=C,p++,null!==o&&(o.x=Math.atan2(A-f,b-d)-.5*Math.PI,o.y=o.x);break}var O=D-t;O<0&&(O=-O),0===p?(_=O,g=O,m=D,y=C,v=D,T=C,null!==o&&(o.x=Math.atan2(A-f,b-d)-.5*Math.PI,o.y=o.x)):(O<_&&(_=O,m=D,y=C,null!==o&&(o.x=Math.atan2(A-f,b-d)-.5*Math.PI)),O>g&&(g=O,v=D,T=C,null!==o&&(o.y=Math.atan2(A-f,b-d)-.5*Math.PI))),p++}}d=b,f=A}return 1===p?(null!==a&&(a.x=m,a.y=y),null!==s&&(s.x=m,s.y=y),null!==o&&(o.y=o.x+Math.PI)):p>1&&(p++,null!==a&&(a.x=m,a.y=y),null!==s&&(s.x=v,s.y=T)),p},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},e.prototype.containsPoint=function(t,e){var i=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var r=0,n=this.vertices.length,a=n-2;r<n;r+=2){var s=this.vertices[a+1],o=this.vertices[r+1];if(o<e&&s>=e||s<e&&o>=e){var h=this.vertices[a],l=this.vertices[r];(e-o)*(h-l)/(s-o)+l<t&&(i=!i)}a=r}return i},e.prototype.intersectsSegment=function(t,r,n,a,s,o,h){void 0===s&&(s=null),void 0===o&&(o=null),void 0===h&&(h=null);var l=0;return 0!==i.rectangleIntersectsSegment(t,r,n,a,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(l=e.polygonIntersectsSegment(t,r,n,a,this.vertices,s,o,h)),l},e}(e);t.PolygonBoundingBoxData=n}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.slotTimelines={},e.constraintTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e}return __extends(e,t),e.toString=function(){return"[class dragonBones.AnimationData]"},e.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,i=this.boneTimelines[t];e<i.length;e++){var r=i[e];r.returnToPool()}delete this.boneTimelines[t]}for(var t in this.slotTimelines){for(var n=0,a=this.slotTimelines[t];n<a.length;n++){r=a[n];r.returnToPool()}delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var s=0,o=this.constraintTimelines[t];s<o.length;s++){r=o[s];r.returnToPool()}delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var h=0,l=this.animationTimelines[t];h<l.length;h++){r=l[h];r.returnToPool()}delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.blendType=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},e.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,r=this.cacheFrames.length;i<r;++i)this.cachedFrames[i]=!1;for(var n=0,a=this.parent.sortedBones;n<a.length;n++){var s=a[n],o=new Array(e);for(i=0,r=o.length;i<r;++i)o[i]=-1;this.boneCachedFrameIndices[s.name]=o}for(var h=0,l=this.parent.sortedSlots;h<l.length;h++){var u=l[h];for(o=new Array(e),i=0,r=o.length;i<r;++i)o[i]=-1;this.slotCachedFrameIndices[u.name]=o}}},e.prototype.addBoneTimeline=function(t,e){var i=t in this.boneTimelines?this.boneTimelines[t]:this.boneTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addSlotTimeline=function(t,e){var i=t in this.slotTimelines?this.slotTimelines[t]:this.slotTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addConstraintTimeline=function(t,e){var i=t in this.constraintTimelines?this.constraintTimelines[t]:this.constraintTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addAnimationTimeline=function(t,e){var i=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},e.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},e.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},e.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},e.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},e.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},e}(t.BaseObject);t.AnimationData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.TimelineData]"},e.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},e}(t.BaseObject);t.TimelineData=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.AnimationTimelineData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.x=0,this.y=0},e}(i);t.AnimationTimelineData=r}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.AnimationConfig]"},e.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additive=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},e.prototype.clear=function(){this._onClear()},e.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additive=t.additive,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;e<i;++e)this.boneMask[e]=t.boneMask[e]},e}(t.BaseObject);t.AnimationConfig=e}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.textures={},e}return __extends(e,t),e.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},e.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},e.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this,this.textures[t.name]=t)},e.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},e}(t.BaseObject);t.TextureAtlasData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.region=new t.Rectangle,i.frame=null,i}return __extends(i,e),i.createRectangle=function(){return new t.Rectangle},i.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},i.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=i.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},i}(t.BaseObject);t.TextureData=i}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._slots=[],t._constraints=[],t._actions=[],t._animation=null,t._proxy=null,t._replaceTextureAtlasData=null,t._clock=null,t}return __extends(i,e),i.toString=function(){return"[class dragonBones.Armature]"},i._onSortSlots=function(t,e){return 1e3*t._zIndex+t._zOrder>1e3*e._zIndex+e._zOrder?1:-1},i.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++){var i=e[t];i.returnToPool()}for(var r=0,n=this._slots;r<n.length;r++){var a=n[r];a.returnToPool()}for(var s=0,o=this._constraints;s<o.length;s++){var h=o[s];h.returnToPool()}for(var l=0,u=this._actions;l<u.length;l++){var c=u[l];c.returnToPool()}null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._zIndexDirty=!1,this._alphaDirty=!0,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._alpha=1,this._globalAlpha=1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},i.prototype._sortZOrder=function(t,e){var i=this._armatureData.sortedSlots,r=null===t;if(this._zOrderDirty||!r){for(var n=0,a=i.length;n<a;++n){var s=r?n:t[e+n];if(!(s<0||s>=a)){var o=i[s],h=this.getSlot(o.name);null!==h&&h._setZOrder(n)}}this._slotsDirty=!0,this._zOrderDirty=!r}},i.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},i.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},i.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},i.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},i.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},i.prototype.init=function(e,i,r,n){null===this._armatureData&&(this._armatureData=e,this._animation=t.BaseObject.borrowObject(t.Animation),this._proxy=i,this._display=r,this._dragonBones=n,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},i.prototype.advanceTime=function(t){if(!this._lockUpdate)if(this._lockUpdate=!0,null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty||this._zIndexDirty){if(this._slots.sort(i._onSortSlots),this._zIndexDirty)for(var r=0,n=this._slots.length;r<n;++r)this._slots[r]._setZOrder(r);this._slotsDirty=!1,this._zIndexDirty=!1}if(this._alphaDirty){this._alphaDirty=!1,this._globalAlpha=this._alpha*(null!==this._parent?this._parent._globalAlpha:1);for(var a=0,s=this._bones;a<s.length;a++){var o=s[a];o._updateAlpha()}for(var h=0,l=this._slots;h<l.length;h++){var u=l[h];u._updateAlpha()}}if(this._cacheFrameIndex<0||this._cacheFrameIndex!==e){r=0,n=0;for(r=0,n=this._bones.length;r<n;++r)this._bones[r].update(this._cacheFrameIndex);for(r=0,n=this._slots.length;r<n;++r)this._slots[r].update(this._cacheFrameIndex)}if(this._actions.length>0){for(var c=0,p=this._actions;c<p.length;c++){var d=p[c],f=d.actionData;if(null!==f&&0===f.type)if(null!==d.slot){var _=d.slot.childArmature;null!==_&&_.animation.fadeIn(f.name)}else if(null!==d.bone)for(var g=0,m=this.getSlots();g<m.length;g++){u=m[g];if(u.parent===d.bone){_=u.childArmature;null!==_&&_.animation.fadeIn(f.name)}}else this._animation.fadeIn(f.name);d.returnToPool()}this._actions.length=0}this._lockUpdate=!1,this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},i.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&t.length>0){var i=this.getBone(t);if(null!==i&&(i.invalidUpdate(),e))for(var r=0,n=this._slots;r<n.length;r++){var a=n[r];a.parent===i&&a.invalidUpdate()}}else{for(var s=0,o=this._bones;s<o.length;s++){i=o[s];i.invalidUpdate()}if(e)for(var h=0,l=this._slots;h<l.length;h++){a=l[h];a.invalidUpdate()}}},i.prototype.containsPoint=function(t,e){for(var i=0,r=this._slots;i<r.length;i++){var n=r[i];if(n.containsPoint(t,e))return n}return null},i.prototype.intersectsSegment=function(t,e,i,r,n,a,s){void 0===n&&(n=null),void 0===a&&(a=null),void 0===s&&(s=null);for(var o=t===i,h=0,l=0,u=0,c=0,p=0,d=0,f=0,_=0,g=null,m=null,y=0,v=this._slots;y<v.length;y++){var T=v[y],x=T.intersectsSegment(t,e,i,r,n,a,s);if(x>0){if(null===n&&null===a){g=T;break}if(null!==n){var b=o?n.y-e:n.x-t;b<0&&(b=-b),(null===g||b<h)&&(h=b,u=n.x,c=n.y,g=T,s&&(f=s.x))}if(null!==a){b=a.x-t;b<0&&(b=-b),(null===m||b>l)&&(l=b,p=a.x,d=a.y,m=T,null!==s&&(_=s.y))}}}return null!==g&&null!==n&&(n.x=u,n.y=c,null!==s&&(s.x=f)),null!==m&&null!==a&&(a.x=p,a.y=d,null!==s&&(s.y=_)),g},i.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var r=i[e];if(r.name===t)return r}return null},i.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},i.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];if(r.name===t)return r}return null},i.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];if(r.display===t)return r}return null},i.prototype.getBones=function(){return this._bones},i.prototype.getSlots=function(){return this._slots},Object.defineProperty(i.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var r=i[e],n=r.childArmature;null!==n&&(n.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];r.invalidUpdate(),r.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,i=this._slots;e<i.length;e++){var r=i[e],n=r.childArmature;null!==n&&(n.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i.prototype.getDisplay=function(){return this._display},i}(t.BaseObject);t.Armature=e}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.globalTransformMatrix=new t.Matrix,i.global=new t.Transform,i.offset=new t.Transform,i}return __extends(i,e),i.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._alpha=1,this._globalAlpha=1,this._armature=null},i.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),i._helpMatrix=new t.Matrix,i._helpTransform=new t.Transform,i._helpPoint=new t.Point,i}(t.BaseObject);t.TransformObject=e}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.animationPose=new t.Transform,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.Bone]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._boneData=null,this._parent=null,this._cachedFrameIndices=null},i.prototype._updateGlobalTransformMatrix=function(e){var i=this._boneData,r=this.global,n=this.globalTransformMatrix,a=this.origin,s=this.offset,o=this.animationPose,h=this._parent,l=this._armature.flipX,u=this._armature.flipY===t.DragonBones.yDown,c=null!==h,p=0;if(1===this.offsetMode?null!==a?(r.x=a.x+s.x+o.x,r.y=a.y+s.y+o.y,r.skew=a.skew+s.skew+o.skew,r.rotation=a.rotation+s.rotation+o.rotation,r.scaleX=a.scaleX*s.scaleX*o.scaleX,r.scaleY=a.scaleY*s.scaleY*o.scaleY):r.copyFrom(s).add(o):0===this.offsetMode?null!==a?r.copyFrom(a).add(o):r.copyFrom(o):(c=!1,r.copyFrom(s)),c){var d=1===h._boneData.type,f=d?h._bone:null,_=d?h._getGlobalTransformMatrix(r.x,r.y):h.globalTransformMatrix;if(!i.inheritScale||d&&null===f){if(i.inheritTranslation){var g=r.x,m=r.y;r.x=_.a*g+_.c*m+_.tx,r.y=_.b*g+_.d*m+_.ty}else l&&(r.x=-r.x),u&&(r.y=-r.y);i.inheritRotation?(h.updateGlobalTransform(),p=h.global.scaleX<0?r.rotation+h.global.rotation+Math.PI:r.rotation+h.global.rotation,_.a*_.d-_.b*_.c<0&&(p-=2*r.rotation,(l!==u||i.inheritReflection)&&(r.skew+=Math.PI)),r.rotation=p):(l||u)&&(l&&u?p=r.rotation+Math.PI:(p=l?Math.PI-r.rotation:-r.rotation,r.skew+=Math.PI),r.rotation=p),r.toMatrix(n)}else d?(i.inheritRotation&&(r.rotation+=h.global.rotation),f.updateGlobalTransform(),r.scaleX*=f.global.scaleX,r.scaleY*=f.global.scaleY,_.transformPoint(r.x,r.y,r),r.toMatrix(n),i.inheritTranslation?(r.x=n.tx,r.y=n.ty):(n.tx=r.x,n.ty=r.y)):(i.inheritRotation||(h.updateGlobalTransform(),p=l&&u?r.rotation-(h.global.rotation+Math.PI):l?r.rotation+h.global.rotation+Math.PI:u?r.rotation+h.global.rotation:r.rotation-h.global.rotation,r.rotation=p),r.toMatrix(n),n.concat(_),i.inheritTranslation?(r.x=n.tx,r.y=n.ty):(n.tx=r.x,n.ty=r.y),e?r.fromMatrix(n):this._globalDirty=!0)}else(l||u)&&(l&&(r.x=-r.x),u&&(r.y=-r.y),l&&u?p=r.rotation+Math.PI:(p=l?Math.PI-r.rotation:-r.rotation,r.skew+=Math.PI),r.rotation=p),r.toMatrix(n)},i.prototype._updateAlpha=function(){null!==this._parent?this._globalAlpha=this._alpha*this._parent._globalAlpha:this._globalAlpha=this._alpha*this._armature._globalAlpha},i.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,this._alpha=this._boneData.alpha,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},i.prototype.update=function(t){if(t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,r=this._armature._constraints;i<r.length;i++){var n=r[i];n._root===this&&n.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var a=0,s=this._armature._constraints;a<s.length;a++){n=s[a];n._root===this&&n.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var o=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(o),o&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},i.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},i.prototype.invalidUpdate=function(){this._transformDirty=!0},i.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(i.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var r=i[e];r.parent===this&&r._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i}(t.TransformObject);t.Bone=e}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._vertices=[],e._deformVertices=[],e._hullCache=[],e._matrixCahce=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.Surface]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0,this._bone=null},e.prototype._getAffineTransform=function(t,e,i,r,n,a,s,o,h,l,u,c,p){var d=s-n,f=o-a,_=h-n,g=l-a;u.rotation=Math.atan2(f,d),u.skew=Math.atan2(g,_)-.5*Math.PI-u.rotation,p&&(u.rotation+=Math.PI),u.scaleX=Math.sqrt(d*d+f*f)/i,u.scaleY=Math.sqrt(_*_+g*g)/r,u.toMatrix(c),u.x=c.tx=n-(c.a*t+c.c*e),u.y=c.ty=a-(c.b*t+c.d*e)},e.prototype._updateVertices=function(){var t=this._armature.armatureData.parent,e=this._boneData.geometry,i=t.intArray,r=t.floatArray,n=i[e.offset+0],a=i[e.offset+2],s=this._vertices,o=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var h=0,l=n;h<l;++h){var u=2*h,c=r[a+u]+o[u],p=r[a+u+1]+o[u+1],d=this._parent._getGlobalTransformMatrix(c,p);s[u]=d.a*c+d.c*p+d.tx,s[u+1]=d.b*c+d.d*p+d.ty}else{var f=this._parent.globalTransformMatrix;for(h=0,l=n;h<l;++h){u=2*h,c=r[a+u]+o[u],p=r[a+u+1]+o[u+1];s[u]=f.a*c+f.c*p+f.tx,s[u+1]=f.b*c+f.d*p+f.ty}}else for(h=0,l=n;h<l;++h){u=2*h;s[u]=r[a+u]+o[u],s[u+1]=r[a+u+1]+o[u+1]}},e.prototype._updateGlobalTransformMatrix=function(t){var e=2*this._boneData.segmentX,i=this._vertices.length-2,r=200,n=this._vertices[0],a=this._vertices[1],s=this._vertices[e],o=this._vertices[e+1],h=this._vertices[i],l=this._vertices[i+1],u=this._vertices[i-e],c=this._vertices[i-e+1],p=n+.5*(h-n),d=a+.5*(l-a),f=s+.5*(u-s),_=o+.5*(c-o),g=p+.5*(f-p),m=d+.5*(_-d),y=s+.5*(h-s),v=o+.5*(l-o),T=u+.5*(h-u),x=c+.5*(l-c);this._getAffineTransform(0,0,r,r,g,m,y,v,T,x,this.global,this.globalTransformMatrix,!1),this._globalDirty=!1},e.prototype._getGlobalTransformMatrix=function(t,i){var r=200,n=1e3
;if(t<-n||n<t||i<-n||n<i)return this.globalTransformMatrix;var a=!1,s=this._boneData,o=s.segmentX,h=s.segmentY,l=2*s.segmentX,u=this._dX,c=this._dY,p=Math.floor((t+r)/u),d=Math.floor((i+r)/c),f=0,_=p*u-r,g=d*c-r,m=this._matrixCahce,y=e._helpMatrix;if(t<-r){if(i<-r||i>=r)return this.globalTransformMatrix;if(a=i>this._kX*(t+r)+g,f=7*(2*(o*h+o+h+h+d)+(a?1:0)),m[f]>0)y.copyFromArray(m,f+1);else{var v=d*(l+2),T=this._hullCache[4],x=this._hullCache[5],b=this._hullCache[2]-(h-d)*T,A=this._hullCache[3]-(h-d)*x,S=this._vertices;a?this._getAffineTransform(-r,g+c,n-r,c,S[v+l+2],S[v+l+3],b+T,A+x,S[v],S[v+1],e._helpTransform,y,!0):this._getAffineTransform(-n,g,n-r,c,b,A,S[v],S[v+1],b+T,A+x,e._helpTransform,y,!1),m[f]=1,m[f+1]=y.a,m[f+2]=y.b,m[f+3]=y.c,m[f+4]=y.d,m[f+5]=y.tx,m[f+6]=y.ty}}else if(t>=r){if(i<-r||i>=r)return this.globalTransformMatrix;if(a=i>this._kX*(t-n)+g,f=7*(2*(o*h+o+d)+(a?1:0)),m[f]>0)y.copyFromArray(m,f+1);else{v=(d+1)*(l+2)-2,T=this._hullCache[4],x=this._hullCache[5],b=this._hullCache[0]+d*T,A=this._hullCache[1]+d*x,S=this._vertices;a?this._getAffineTransform(n,g+c,n-r,c,b+T,A+x,S[v+l+2],S[v+l+3],b,A,e._helpTransform,y,!0):this._getAffineTransform(r,g,n-r,c,S[v],S[v+1],b,A,S[v+l+2],S[v+l+3],e._helpTransform,y,!1),m[f]=1,m[f+1]=y.a,m[f+2]=y.b,m[f+3]=y.c,m[f+4]=y.d,m[f+5]=y.tx,m[f+6]=y.ty}}else if(i<-r){if(t<-r||t>=r)return this.globalTransformMatrix;if(a=i>this._kY*(t-_-u)-n,f=7*(2*(o*h+p)+(a?1:0)),m[f]>0)y.copyFromArray(m,f+1);else{v=2*p,T=this._hullCache[10],x=this._hullCache[11],b=this._hullCache[8]+p*T,A=this._hullCache[9]+p*x,S=this._vertices;a?this._getAffineTransform(_+u,-r,u,n-r,S[v+2],S[v+3],S[v],S[v+1],b+T,A+x,e._helpTransform,y,!0):this._getAffineTransform(_,-n,u,n-r,b,A,b+T,A+x,S[v],S[v+1],e._helpTransform,y,!1),m[f]=1,m[f+1]=y.a,m[f+2]=y.b,m[f+3]=y.c,m[f+4]=y.d,m[f+5]=y.tx,m[f+6]=y.ty}}else if(i>=r){if(t<-r||t>=r)return this.globalTransformMatrix;if(a=i>this._kY*(t-_-u)+r,f=7*(2*(o*h+o+h+p)+(a?1:0)),m[f]>0)y.copyFromArray(m,f+1);else{v=h*(l+2)+2*p,T=this._hullCache[10],x=this._hullCache[11],b=this._hullCache[6]-(o-p)*T,A=this._hullCache[7]-(o-p)*x,S=this._vertices;a?this._getAffineTransform(_+u,n,u,n-r,b+T,A+x,b,A,S[v+2],S[v+3],e._helpTransform,y,!0):this._getAffineTransform(_,r,u,n-r,S[v],S[v+1],S[v+2],S[v+3],b,A,e._helpTransform,y,!1),m[f]=1,m[f+1]=y.a,m[f+2]=y.b,m[f+3]=y.c,m[f+4]=y.d,m[f+5]=y.tx,m[f+6]=y.ty}}else if(a=i>this._k*(t-_-u)+g,f=7*(2*(o*d+p)+(a?1:0)),m[f]>0)y.copyFromArray(m,f+1);else{v=2*p+d*(l+2),S=this._vertices;a?this._getAffineTransform(_+u,g+c,u,c,S[v+l+4],S[v+l+5],S[v+l+2],S[v+l+3],S[v+2],S[v+3],e._helpTransform,y,!0):this._getAffineTransform(_,g,u,c,S[v],S[v+1],S[v+2],S[v+3],S[v+l+2],S[v+l+3],e._helpTransform,y,!1),m[f]=1,m[f+1]=y.a,m[f+2]=y.b,m[f+3]=y.c,m[f+4]=y.d,m[f+5]=y.tx,m[f+6]=y.ty}return y},e.prototype.init=function(e,i){if(null===this._boneData){t.prototype.init.call(this,e,i);var r=e.segmentX,n=e.segmentY,a=this._armature.armatureData.parent.intArray[e.geometry.offset+0],s=1e3,o=200;this._dX=2*o/r,this._dY=2*o/n,this._k=-this._dY/this._dX,this._kX=-this._dY/(s-o),this._kY=-(s-o)/this._dX,this._vertices.length=2*a,this._deformVertices.length=2*a,this._matrixCahce.length=2*(r*n+2*r+2*n)*7,this._hullCache.length=10;for(var h=0;h<2*a;++h)this._deformVertices[h]=0;null!==this._parent&&(0===this._parent.boneData.type?this._bone=this._parent:this._bone=this._parent._bone)}},e.prototype.update=function(t){if(t>=0&&null!==this._cachedFrameIndices){var i=this._cachedFrameIndices[t];if(i>=0&&this._cachedFrameIndex===i)this._transformDirty=!1;else if(i>=0)this._transformDirty=!0,this._cachedFrameIndex=i;else{if(this._hasConstraint)for(var r=0,n=this._armature._constraints;r<n.length;r++){var a=n[r];a._root===this&&a.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var s=0,o=this._armature._constraints;s<o.length;s++){a=o[s];a._root===this&&a.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var h=0,l=this._matrixCahce.length;h<l;h+=7)this._matrixCahce[h]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var u=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(u),u&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var c=1e3,p=200,d=2*this.global.x,f=2*this.global.y,_=e._helpPoint;this.globalTransformMatrix.transformPoint(c,-p,_),this._hullCache[0]=_.x,this._hullCache[1]=_.y,this._hullCache[2]=d-_.x,this._hullCache[3]=f-_.y,this.globalTransformMatrix.transformPoint(0,this._dY,_,!0),this._hullCache[4]=_.x,this._hullCache[5]=_.y,this.globalTransformMatrix.transformPoint(p,c,_),this._hullCache[6]=_.x,this._hullCache[7]=_.y,this._hullCache[8]=d-_.x,this._hullCache[9]=f-_.y,this.globalTransformMatrix.transformPoint(this._dX,0,_,!0),this._hullCache[10]=_.x,this._hullCache[11]=_.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},e}(t.Bone);t.Surface=e}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.deformVertices=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.DisplayFrame]"},e.prototype._onClear=function(){this.rawDisplayData=null,this.displayData=null,this.textureData=null,this.display=null,this.deformVertices.length=0},e.prototype.updateDeformVertices=function(){if(null!==this.rawDisplayData&&0===this.deformVertices.length){var t;if(2===this.rawDisplayData.type)t=this.rawDisplayData.geometry;else{if(4!==this.rawDisplayData.type)return;t=this.rawDisplayData.geometry}var e=0;e=null!==t.weight?2*t.weight.count:2*t.data.intArray[t.offset+0],this.deformVertices.length=e;for(var i=0,r=this.deformVertices.length;i<r;++i)this.deformVertices[i]=0}},e.prototype.getGeometryData=function(){if(null!==this.displayData){if(2===this.displayData.type)return this.displayData.geometry;if(4===this.displayData.type)return this.displayData.geometry}if(null!==this.rawDisplayData){if(2===this.rawDisplayData.type)return this.rawDisplayData.geometry;if(4===this.rawDisplayData.type)return this.rawDisplayData.geometry}return null},e.prototype.getBoundingBox=function(){return null!==this.displayData&&3===this.displayData.type?this.displayData.boundingBox:null!==this.rawDisplayData&&3===this.rawDisplayData.type?this.rawDisplayData.boundingBox:null},e.prototype.getTextureData=function(){if(null!==this.displayData){if(0===this.displayData.type)return this.displayData.texture;if(2===this.displayData.type)return this.displayData.texture}if(null!==this.textureData)return this.textureData;if(null!==this.rawDisplayData){if(0===this.rawDisplayData.type)return this.rawDisplayData.texture;if(2===this.rawDisplayData.type)return this.rawDisplayData.texture}return null},e}(t.BaseObject);t.DisplayFrame=e;var i=function(i){function r(){var e=null!==i&&i.apply(this,arguments)||this;return e._localMatrix=new t.Matrix,e._colorTransform=new t.ColorTransform,e._displayFrames=[],e._geometryBones=[],e._rawDisplay=null,e._meshDisplay=null,e._display=null,e}return __extends(r,i),r.prototype._onClear=function(){i.prototype._onClear.call(this);for(var e=[],r=0,n=this._displayFrames;r<n.length;r++){var a=n[r],s=a.display;s!==this._rawDisplay&&s!==this._meshDisplay&&e.indexOf(s)<0&&e.push(s),a.returnToPool()}for(var o=0,h=e;o<h.length;o++){var l=h[o];l instanceof t.Armature?l.dispose():this._disposeDisplay(l,!0)}null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDataDirty=!1,this._displayDirty=!1,this._geometryDirty=!1,this._textureDirty=!1,this._visibleDirty=!1,this._blendModeDirty=!1,this._zOrderDirty=!1,this._colorDirty=!1,this._verticesDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._zIndex=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayFrames.length=0,this._geometryBones.length=0,this._slotData=null,this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},r.prototype._hasDisplay=function(t){for(var e=0,i=this._displayFrames;e<i.length;e++){var r=i[e];if(r.display===t)return!0}return!1},r.prototype._isBonesUpdate=function(){for(var t=0,e=this._geometryBones;t<e.length;t++){var i=e[t];if(null!==i&&i._childrenTransformDirty)return!0}return!1},r.prototype._updateAlpha=function(){var t=this._alpha*this._parent._globalAlpha;this._globalAlpha!==t&&(this._globalAlpha=t,this._colorDirty=!0)},r.prototype._updateDisplayData=function(){var e=this._displayFrame,i=this._geometryData,n=this._textureData,a=null,s=null;if(this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&this._displayIndex<this._displayFrames.length&&(this._displayFrame=this._displayFrames[this._displayIndex],a=this._displayFrame.rawDisplayData,s=this._displayFrame.displayData,this._geometryData=this._displayFrame.getGeometryData(),this._boundingBoxData=this._displayFrame.getBoundingBox(),this._textureData=this._displayFrame.getTextureData()),this._displayFrame!==e||this._geometryData!==i||this._textureData!==n){if(null===this._geometryData&&null!==this._textureData){var o=null!==s&&0===s.type?s:a,h=this._textureData.parent.scale*this._armature._armatureData.scale,l=this._textureData.frame;this._pivotX=o.pivot.x,this._pivotY=o.pivot.y;var u=null!==l?l:this._textureData.region,c=u.width,p=u.height;this._textureData.rotated&&null===l&&(c=u.height,p=u.width),this._pivotX*=c*h,this._pivotY*=p*h,null!==l&&(this._pivotX+=l.x*h,this._pivotY+=l.y*h),null!==a&&o!==a&&(a.transform.toMatrix(r._helpMatrix),r._helpMatrix.invert(),r._helpMatrix.transformPoint(0,0,r._helpPoint),this._pivotX-=r._helpPoint.x,this._pivotY-=r._helpPoint.y,o.transform.toMatrix(r._helpMatrix),r._helpMatrix.invert(),r._helpMatrix.transformPoint(0,0,r._helpPoint),this._pivotX+=r._helpPoint.x,this._pivotY+=r._helpPoint.y),t.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*h-this._pivotY)}else this._pivotX=0,this._pivotY=0;if(this.origin=null!==a?a.transform:null!==s?s.transform:null,null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix),this._geometryData!==i)if(this._geometryDirty=!0,this._verticesDirty=!0,null!==this._geometryData){if(this._geometryBones.length=0,null!==this._geometryData.weight)for(var d=0,f=this._geometryData.weight.bones.length;d<f;++d){var _=this._armature.getBone(this._geometryData.weight.bones[d].name);this._geometryBones.push(_)}}else this._geometryBones.length=0,this._geometryData=null;this._textureDirty=this._textureData!==n,this._transformDirty=!0}},r.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,i=this._childArmature;null!==this._displayFrame?(this._display=this._displayFrame.display,null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null);var r=null!==this._display?this._display:this._rawDisplay;if(r!==e&&(this._textureDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._transformDirty=!0,this._onUpdateDisplay(),this._replaceDisplay(e)),this._childArmature!==i&&(null!==i&&(i._parent=null,i.clock=null,i.inheritAnimation&&i.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var n=this._armature.cacheFrameRate;0!==n&&(this._childArmature.cacheFrameRate=n)}if(null!==this._displayFrame){var a=null,s=null!==this._displayFrame.displayData?this._displayFrame.displayData:this._displayFrame.rawDisplayData;if(null!==s&&1===s.type&&(a=s.actions),null!==a&&a.length>0)for(var o=0,h=a;o<h.length;o++){var l=h[o],u=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(l,u,this._armature),u.slot=this,this._armature._bufferAction(u,!1)}else this._childArmature.animation.play()}}},r.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},r.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return;this._animationDisplayIndex=t}this._displayIndex!==t&&(this._displayIndex=t<this._displayFrames.length?t:this._displayFrames.length-1,this._displayDataDirty=!0,this._displayDirty=this._displayIndex<0||this._display!==this._displayFrames[this._displayIndex].display)},r.prototype._setZOrder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},r.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0},r.prototype.init=function(t,e,i,r){if(null===this._slotData){this._slotData=t,this._colorDirty=!0,this._blendModeDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._zIndex=this._slotData.zIndex,this._alpha=this._slotData.alpha,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=i,this._meshDisplay=r,this._armature=e;var n=this._armature.getBone(this._slotData.parent.name);null!==n&&(this._parent=n),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},r.prototype.update=function(t){if(this._displayDataDirty&&(this._updateDisplayData(),this._displayDataDirty=!1),this._displayDirty&&(this._updateDisplay(),this._displayDirty=!1),(this._geometryDirty||this._textureDirty)&&(null!==this._display&&this._display!==this._rawDisplay&&this._display!==this._meshDisplay||this._updateFrame(),this._geometryDirty=!1,this._textureDirty=!1),null!==this._display){if(this._visibleDirty&&(this._updateVisible(),this._visibleDirty=!1),this._blendModeDirty&&(this._updateBlendMode(),this._blendModeDirty=!1),this._colorDirty&&(this._updateColor(),this._colorDirty=!1),this._zOrderDirty&&(this._updateZOrder(),this._zOrderDirty=!1),null!==this._geometryData&&this._display===this._meshDisplay){var e=null!==this._geometryData.weight,i=0!==this._parent._boneData.type;if((this._verticesDirty||e&&this._isBonesUpdate()||i&&this._parent._childrenTransformDirty)&&(this._updateMesh(),this._verticesDirty=!1),e||i)return}if(t>=0&&null!==this._cachedFrameIndices){var r=this._cachedFrameIndices[t];r>=0&&this._cachedFrameIndex===r?this._transformDirty=!1:r>=0?(this._transformDirty=!0,this._cachedFrameIndex=r):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(this._transformDirty){if(this._cachedFrameIndex<0){var n=t>=0;this._updateGlobalTransformMatrix(n),n&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform(),this._transformDirty=!1}}},r.prototype.invalidUpdate=function(){this._displayDataDirty=!0,this._displayDirty=!0,this._transformDirty=!0},r.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._updateGlobalTransformMatrix(!1),this._transformDirty=!1)},r.prototype.replaceRawDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];if(i.rawDisplayData!==t){if(i.deformVertices.length=0,i.rawDisplayData=t,null===i.rawDisplayData){var r=this._armature._armatureData.defaultSkin;if(null!==r){var n=r.getDisplays(this._slotData.name);null!==n&&e<n.length&&(i.rawDisplayData=n[e])}}e===this._displayIndex&&(this._displayDataDirty=!0)}},r.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];i.displayData!==t&&i.rawDisplayData!==t&&(i.displayData=t,e===this._displayIndex&&(this._displayDataDirty=!0))},r.prototype.replaceTextureData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];i.textureData!==t&&(i.textureData=t,e===this._displayIndex&&(this._displayDataDirty=!0))},r.prototype.replaceDisplay=function(e,i){if(void 0===i&&(i=-1),i<0)i=this._displayIndex<0?0:this._displayIndex;else if(i>=this._displayFrames.length)return;var r=this._displayFrames[i];if(r.display!==e){var n=r.display;r.display=e,null===n||n===this._rawDisplay||n===this._meshDisplay||this._hasDisplay(n)||n instanceof t.Armature||this._disposeDisplay(n,!0),null===e||e===this._rawDisplay||e===this._meshDisplay||this._hasDisplay(n)||e instanceof t.Armature||this._initDisplay(e,!0),i===this._displayIndex&&(this._displayDirty=!0)}},r.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),r._helpMatrix.copyFrom(this.globalTransformMatrix),r._helpMatrix.invert(),r._helpMatrix.transformPoint(t,e,r._helpPoint),this._boundingBoxData.containsPoint(r._helpPoint.x,r._helpPoint.y))},r.prototype.intersectsSegment=function(t,e,i,n,a,s,o){if(void 0===a&&(a=null),void 0===s&&(s=null),void 0===o&&(o=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),r._helpMatrix.copyFrom(this.globalTransformMatrix),r._helpMatrix.invert(),r._helpMatrix.transformPoint(t,e,r._helpPoint),t=r._helpPoint.x,e=r._helpPoint.y,r._helpMatrix.transformPoint(i,n,r._helpPoint),i=r._helpPoint.x,n=r._helpPoint.y;var h=this._boundingBoxData.intersectsSegment(t,e,i,n,a,s,o);return h>0&&(1===h||2===h?null!==a?(this.globalTransformMatrix.transformPoint(a.x,a.y,a),null!==s&&(s.x=a.x,s.y=a.y)):null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s):(null!==a&&this.globalTransformMatrix.transformPoint(a.x,a.y,a),null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s)),null!==o&&(this.globalTransformMatrix.transformPoint(Math.cos(o.x),Math.sin(o.x),r._helpPoint,!0),o.x=Math.atan2(r._helpPoint.y,r._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(o.y),Math.sin(o.y),r._helpPoint,!0),o.y=Math.atan2(r._helpPoint.y,r._helpPoint.x))),h},r.prototype.getDisplayFrameAt=function(t){return this._displayFrames[t]},Object.defineProperty(r.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"displayFrameCount",{get:function(){return this._displayFrames.length},set:function(i){var r=this._displayFrames.length;if(r<i){this._displayFrames.length=i;for(var n=r;n<i;++n)this._displayFrames[n]=t.BaseObject.borrowObject(e)}else if(r>i){for(n=r-1;n<i;--n)this.replaceDisplay(null,n),this._displayFrames[n].returnToPool();this._displayFrames.length=i}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t),this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"displayList",{get:function(){for(var t=new Array,e=0,i=this._displayFrames;e<i.length;e++){var r=i[e];t.push(r.display)}return t},set:function(t){this.displayFrameCount=t.length;for(var e=0,i=0,r=t;i<r.length;i++){var n=r[i];this.replaceDisplay(n,e++)}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"display",{get:function(){return this._display},set:function(t){this._display!==t&&(0===this._displayFrames.length&&(this.displayFrameCount=1,this._displayIndex=0),this.replaceDisplay(t,this._displayIndex))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),r.prototype.getDisplay=function(){return this._display},r.prototype.setDisplay=function(t){this.display=t},r}(t.TransformObject);t.Slot=i}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(i.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),i._helpMatrix=new t.Matrix,i._helpTransform=new t.Transform,i._helpPoint=new t.Point,i}(t.BaseObject);t.Constraint=e;var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.toString=function(){return"[class dragonBones.IKConstraint]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},i.prototype._computeA=function(){var e=this._target.global,i=this._root.global,r=this._root.globalTransformMatrix,n=Math.atan2(e.y-i.y,e.x-i.x);i.scaleX<0&&(n+=Math.PI),i.rotation+=t.Transform.normalizeRadian(n-i.rotation)*this._weight,i.toMatrix(r)},i.prototype._computeB=function(){var e=this._bone._boneData.length,i=this._root,r=this._target.global,n=i.global,a=this._bone.global,s=this._bone.globalTransformMatrix,o=s.a*e,h=s.b*e,l=o*o+h*h,u=Math.sqrt(l),c=a.x-n.x,p=a.y-n.y,d=c*c+p*p,f=Math.sqrt(d),_=a.rotation,g=n.rotation,m=Math.atan2(p,c);c=r.x-n.x,p=r.y-n.y;var y=c*c+p*p,v=Math.sqrt(y),T=0;if(u+f<=v||v+u<=f||v+f<=u)T=Math.atan2(r.y-n.y,r.x-n.x),u+f<=v||f<u&&(T+=Math.PI);else{var x=(d-l+y)/(2*y),b=Math.sqrt(d-x*x*y)/v,A=n.x+c*x,S=n.y+p*x,w=-p*b,P=c*b,E=!1,D=i.parent;if(null!==D){var C=D.globalTransformMatrix;E=C.a*C.d-C.b*C.c<0}E!==this._bendPositive?(a.x=A-w,a.y=S-P):(a.x=A+w,a.y=S+P),T=Math.atan2(a.y-n.y,a.x-n.x)}var O=t.Transform.normalizeRadian(T-m);n.rotation=g+O*this._weight,n.toMatrix(i.globalTransformMatrix);var M=m+O*this._weight;a.x=n.x+Math.cos(M)*f,a.y=n.y+Math.sin(M)*f;var I=Math.atan2(r.y-a.y,r.x-a.x);a.scaleX<0&&(I+=Math.PI),a.rotation=n.rotation+_-g+t.Transform.normalizeRadian(I-O-_)*this._weight,a.toMatrix(s)},i.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var i=this._constraintData;this._scaleEnabled=i.scaleEnabled,this._bendPositive=i.bendPositive,this._weight=i.weight,this._root._hasConstraint=!0}},i.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},i.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},i}(e);t.IKConstraint=i;var r=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}return __extends(i,e),i.toString=function(){return"[class dragonBones.PathConstraint]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},i.prototype._updatePathVertices=function(t){var e=this._armature,i=e.armatureData.parent,r=e.armatureData.scale,n=i.intArray,a=i.floatArray,s=t.offset,o=n[s+0],h=n[s+2];this._pathGlobalVertices.length=2*o;var l=t.weight;if(null!==l)for(var u=this._pathSlot._geometryBones,c=l.bones.length,p=l.offset,d=n[p+1],f=d,_=p+2+c,g=(E=0,0);E<o;E++){for(var m=n[_++],y=0,v=0,T=0,x=m;T<x;T++){var b=n[_++],A=u[b];if(null!==A){A.updateByConstraint();P=A.globalTransformMatrix;var S=a[f++];C=a[f++]*r,O=a[f++]*r;y+=(P.a*C+P.c*O+P.tx)*S,v+=(P.b*C+P.d*O+P.ty)*S}}this._pathGlobalVertices[g++]=y,this._pathGlobalVertices[g++]=v}else{var w=this._pathSlot.parent;w.updateByConstraint();for(var P=w.globalTransformMatrix,E=0,D=h;E<o;E+=2){var C=a[D++]*r,O=a[D++]*r,M=P.a*C+P.c*O+P.tx,I=P.b*C+P.d*O+P.ty;this._pathGlobalVertices[E]=M,this._pathGlobalVertices[E+1]=I}}},i.prototype._computeVertices=function(t,e,i,r){for(var n=i,a=t;n<e;n+=2)r[n]=this._pathGlobalVertices[a++],r[n+1]=this._pathGlobalVertices[a++]},i.prototype._computeBezierCurve=function(t,e,i,r,n){var a=this._armature,s=a.armatureData.parent.intArray,o=s[t.geometry.offset+0],h=this._positions,l=this._spaces,u=t.closed,c=Array(),p=2*o,d=p/6,f=-1,_=this.position;h.length=3*e+2;var g=0;if(t.constantSpeed){u?(p+=2,c.length=o,this._computeVertices(2,p-4,0,c),this._computeVertices(0,2,p-4,c),c[p-2]=c[0],c[p-1]=c[1]):(d--,p-=4,c.length=p,this._computeVertices(2,p,0,c));var m=new Array(d);g=0;for(var y,v,T,x,b,A,S,w,P=c[0],E=c[1],D=0,C=0,O=0,M=0,I=0,R=0,N=(G=0,2);G<d;G++,N+=6)D=c[N],C=c[N+1],O=c[N+2],M=c[N+3],I=c[N+4],R=c[N+5],y=.1875*(P-2*D+O),v=.1875*(E-2*C+M),T=.09375*(3*(D-O)-P+I),x=.09375*(3*(C-M)-E+R),b=2*y+T,A=2*v+x,S=.75*(D-P)+y+.16666667*T,w=.75*(C-E)+v+.16666667*x,g+=Math.sqrt(S*S+w*w),S+=b,w+=A,b+=T,A+=x,g+=Math.sqrt(S*S+w*w),S+=b,w+=A,g+=Math.sqrt(S*S+w*w),S+=b+T,w+=A+x,g+=Math.sqrt(S*S+w*w),m[G]=g,P=I,E=R;if(r&&(_*=g),n)for(G=0;G<e;G++)l[G]*=g;for(var B=this._segments,L=0,F=(G=0,Y=0,X=0,0);G<e;G++,Y+=3){H=l[G];_+=H;var k=_;if(u)k%=g,k<0&&(k+=g),X=0;else{if(k<0)continue;if(k>g)continue}for(;;X++){var U=m[X];if(!(k>U)){if(0===X)k/=U;else{var j=m[X-1];k=(k-j)/(U-j)}break}}if(X!==f){f=X;var W=6*X;for(P=c[W],E=c[W+1],D=c[W+2],C=c[W+3],O=c[W+4],M=c[W+5],I=c[W+6],R=c[W+7],y=.03*(P-2*D+O),v=.03*(E-2*C+M),T=.006*(3*(D-O)-P+I),x=.006*(3*(C-M)-E+R),b=2*y+T,A=2*v+x,S=.3*(D-P)+y+.16666667*T,w=.3*(C-E)+v+.16666667*x,L=Math.sqrt(S*S+w*w),B[0]=L,W=1;W<8;W++)S+=b,w+=A,b+=T,A+=x,L+=Math.sqrt(S*S+w*w),B[W]=L;S+=b,w+=A,L+=Math.sqrt(S*S+w*w),B[8]=L,S+=b+T,w+=A+x,L+=Math.sqrt(S*S+w*w),B[9]=L,F=0}for(k*=L;;F++){var V=B[F];if(!(k>V)){if(0===F)k/=V;else{j=B[F-1];k=F+(k-j)/(V-j)}break}}this.addCurvePosition(.1*k,P,E,D,C,O,M,I,R,h,Y,i)}}else{var z=t.curveLengths;if(d-=u?1:2,g=z[d],r&&(_*=g),n)for(var G=0;G<e;G++)l[G]*=g;c.length=8;for(var G=0,Y=0,X=0;G<e;G++,Y+=3){var H=l[G];if(_+=H,u)_%=g,_<0&&(_+=g),X=0;else{if(_<0)continue;if(_>g)continue}for(var q=0;;X++){var K=z[X];if(!(_>K)){if(0===X)q=_/K;else{var J=z[X-1];q=(_-J)/(K-J)}break}}X!==f&&(f=X,u&&X===d?(this._computeVertices(p-4,4,0,c),this._computeVertices(0,4,4,c)):this._computeVertices(6*X+2,8,0,c)),this.addCurvePosition(q,c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],h,Y,i)}}},i.prototype.addCurvePosition=function(t,e,i,r,n,a,s,o,h,l,u,c){if(0===t)return l[u]=e,l[u+1]=i,void(l[u+2]=0);if(1===t)return l[u]=o,l[u+1]=h,void(l[u+2]=0);var p=1-t,d=p*p,f=t*t,_=d*p,g=d*t*3,m=p*f*3,y=t*f,v=_*e+g*r+m*a+y*o,T=_*i+g*n+m*s+y*h;l[u]=v,l[u+1]=T,l[u+2]=c?Math.atan2(T-(_*i+g*n+m*s),v-(_*e+g*r+m*a)):0},i.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var i=t;this.pathOffset=i.pathDisplayData.geometry.offset,this.position=i.position,this.spacing=i.spacing,this.rotateOffset=i.rotateOffset,this.rotateMix=i.rotateMix,this.translateMix=i.translateMix,this._root=this._armature.getBone(i.root.name),this._target=this._armature.getBone(i.target.name),this._pathSlot=this._armature.getSlot(i.pathSlot.name);for(var r=0,n=i.bones.length;r<n;r++){var a=this._armature.getBone(i.bones[r].name);null!==a&&this._bones.push(a)}2===i.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},i.prototype.update=function(){var e=this._pathSlot;if(null!==e._geometryData&&e._geometryData.offset===this.pathOffset){var i=this._constraintData,r=!1;if(this._root._childrenTransformDirty?(this._updatePathVertices(e._geometryData),r=!0):(e._verticesDirty||e._isBonesUpdate())&&(this._updatePathVertices(e._geometryData),e._verticesDirty=!1,r=!0),r||this.dirty){var n=i.positionMode,a=i.spacingMode,s=i.rotateMode,o=this._bones,h=0===a,l=2===s,u=0===s,c=o.length,p=u?c:c+1,d=this.spacing,f=this._spaces;if(f.length=p,l||h){f[0]=0;for(var _=0,g=p-1;_<g;_++){var m=o[_];m.updateByConstraint();var y=m._boneData.length,v=m.globalTransformMatrix,T=y*v.a,x=y*v.b,b=Math.sqrt(T*T+x*x);l&&(this._boneLengths[_]=b),f[_+1]=(y+d)*b/y}}else for(_=0;_<p;_++)f[_]=d;this._computeBezierCurve(e._displayFrame.rawDisplayData,p,u,1===n,2===a);var A,S=this._positions,w=this.rotateOffset,P=S[0],E=S[1];if(0===w)A=1===s;else{A=!1;m=e.parent;if(null!==m){v=m.globalTransformMatrix;w*=v.a*v.d-v.b*v.c>0?t.Transform.DEG_RAD:-t.Transform.DEG_RAD}}for(var D=this.rotateMix,C=this.translateMix,O=(_=0,3);_<c;_++,O+=3){m=o[_];m.updateByConstraint();v=m.globalTransformMatrix;v.tx+=(P-v.tx)*C,v.ty+=(E-v.ty)*C;T=S[O],x=S[O+1];var M=T-P,I=x-E;if(l){var R=this._boneLengths[_],N=(Math.sqrt(M*M+I*I)/R-1)*D+1;v.a*=N,v.b*=N}if(P=T,E=x,D>0){var B=v.a,L=v.b,F=v.c,k=v.d,U=void 0,j=void 0,W=void 0;if(U=u?S[O-1]:Math.atan2(I,M),U-=Math.atan2(L,B),A){j=Math.cos(U),W=Math.sin(U);var V=m._boneData.length;P+=(V*(j*B-W*L)-M)*D,E+=(V*(W*B+j*L)-I)*D}else U+=w;U>t.Transform.PI?U-=t.Transform.PI_D:U<-t.Transform.PI&&(U+=t.Transform.PI_D),U*=D,j=Math.cos(U),W=Math.sin(U),v.a=j*B-W*L,v.b=W*B+j*L,v.c=j*F-W*k,v.d=W*F+j*k}m.global.fromMatrix(v)}this.dirty=!1}}},i.prototype.invalidUpdate=function(){},i}(e);t.PathConstraint=r}(dragonBones||(dragonBones={})),function(t){var e=function(){function t(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,
this.time=t,this._systemTime=.001*(new Date).getTime()}return t.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var i=0,r=0,n=this._animatebles.length;i<n;++i){var a=this._animatebles[i];null!==a?(r>0&&(this._animatebles[i-r]=a,this._animatebles[i]=null),a.advanceTime(t)):r++}if(r>0){for(n=this._animatebles.length;i<n;++i){var s=this._animatebles[i];null!==s?this._animatebles[i-r]=s:r++}this._animatebles.length-=r}}},t.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},t.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),t}();t.WorldClock=e}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNameList=[],t._animationStates=[],t._animations={},t._blendStates={},t._animationConfig=null,t}return __extends(i,e),i.toString=function(){return"[class dragonBones.Animation]"},i.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];i.returnToPool()}for(var r in this._animations)delete this._animations[r];for(var r in this._blendStates){var n=this._blendStates[r];for(var a in n)n[a].returnToPool();delete this._blendStates[r]}null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNameList.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},i.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,i=this._animationStates;e<i.length;e++){var r=i[e];null===r._parent&&(r.layer===t.layer&&r.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 2:for(var n=0,a=this._animationStates;n<a.length;n++){r=a[n];null===r._parent&&(r.group===t.group&&r.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 3:for(var s=0,o=this._animationStates;s<o.length;s++){r=o[s];null===r._parent&&(r.layer===t.layer&&r.group===t.group&&r.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 4:for(var h=0,l=this._animationStates;h<l.length;h++){r=l[h];null===r._parent&&r.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},i.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},i.prototype.advanceTime=function(t){for(var e in t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale),this._blendStates){var i=this._blendStates[e];for(var r in i)i[r].reset()}var n=this._animationStates.length;if(1===n){var a=this._animationStates[0];if(a._fadeState>0&&a._subFadeState>0)this._armature._dragonBones.bufferObject(a),this._animationStates.length=0,this._lastAnimationState=null;else{var s=a.animationData,o=s.cacheFrameRate;if(this._animationDirty&&o>0){this._animationDirty=!1;for(var h=0,l=this._armature.getBones();h<l.length;h++){var u=l[h];u._cachedFrameIndices=s.getBoneCachedFrameIndices(u.name)}for(var c=0,p=this._armature.getSlots();c<p.length;c++){var d=p[c];if(d.displayFrameCount>0){var f=d.getDisplayFrameAt(0).rawDisplayData;if(null!==f&&f.parent===this._armature.armatureData.defaultSkin){d._cachedFrameIndices=s.getSlotCachedFrameIndices(d.name);continue}}d._cachedFrameIndices=null}}a.advanceTime(t,o)}}else if(n>1){for(var _=0,g=0;_<n;++_){a=this._animationStates[_];a._fadeState>0&&a._subFadeState>0?(g++,this._armature._dragonBones.bufferObject(a),this._animationDirty=!0,this._lastAnimationState===a&&(this._lastAnimationState=null)):(g>0&&(this._animationStates[_-g]=a),a.advanceTime(t,0)),_===n-1&&g>0&&(this._animationStates.length-=g,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},i.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];i.returnToPool()}this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},i.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t){var e=this.getState(t);null!==e&&e.stop()}else for(var i=0,r=this._animationStates;i<r.length;i++){e=r[i];e.stop()}},i.prototype.playConfig=function(e){var i=e.animation;if(!(i in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+i),null;var r=this._animations[i];if(5===e.fadeOutMode)for(var n=0,a=this._animationStates;n<a.length;n++){var s=a[n];if(s._fadeState<1&&s.layer===e.layer&&s.animationData===r)return s}0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime<0&&(e.fadeInTime=r.fadeInTime),e.fadeOutTime<0&&(e.fadeOutTime=e.fadeInTime),e.timeScale<=-100&&(e.timeScale=1/r.scale),r.frameCount>0?(e.position<0?(e.position%=r.duration,e.position=r.duration-e.position):e.position===r.duration?e.position-=1e-6:e.position>r.duration&&(e.position%=r.duration),e.duration>0&&e.position+e.duration>r.duration&&(e.duration=r.duration-e.position),e.playTimes<0&&(e.playTimes=r.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var o=t.BaseObject.borrowObject(t.AnimationState);if(o.init(this._armature,r,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var h=!1,l=0,u=this._animationStates.length;l<u;++l){if(o.layer>this._animationStates[l].layer){h=!0,this._animationStates.splice(l,0,o);break}if(l!==u-1&&o.layer>this._animationStates[l+1].layer){h=!0,this._animationStates.splice(l+1,0,o);break}}h||this._animationStates.push(o)}else this._animationStates.push(o);for(var c=0,p=this._armature.getSlots();c<p.length;c++){var d=p[c],f=d.childArmature;null!==f&&f.inheritAnimation&&f.animation.hasAnimation(i)&&null===f.animation.getState(i)&&f.animation.fadeIn(i)}for(var _ in r.animationTimelines){var g=this.fadeIn(_,0,1,o.layer,"",5);if(null!==g){var m=r.animationTimelines[_];g.actionEnabled=!1,g.resetToPose=!1,g.stop(),o.addState(g,m);var y=this._animationStates.indexOf(o),v=this._animationStates.indexOf(g);v<y&&(this._animationStates.splice(y,1),this._animationStates.splice(v,0,o))}}return this._lastAnimationState=o,o},i.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var i=this._armature.armatureData.defaultAnimation;null!==i&&(this._animationConfig.animation=i.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},i.prototype.fadeIn=function(t,e,i,r,n,a){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===r&&(r=0),void 0===n&&(n=null),void 0===a&&(a=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=a,this._animationConfig.playTimes=i,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==n?n:"",this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},i.prototype.gotoAndPlay=function(t,e,i,r){if(playTimes=r?1e3:1,void 0===t&&(t=null),void 0===playTimes&&(playTimes=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=playTimes,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var n=this._armature.armatureData.defaultAnimation;null!==n&&(this._animationConfig.animation=n.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},i.prototype.getLastAnimationName=function(){return this._lastAnimationState?this._lastAnimationState.name:null},i.prototype.getIsComplete=function(){if(this._lastAnimationState){if(!this._lastAnimationState.isComplete)return!1;for(var t=this._animationLayer.length;t--;)for(var e=this._animationLayer[t],i=e.length;i--;)if(!e[i].isComplete)return!1;return!0}return!1},i.prototype.getIsPlaying=function(){return this.isPlaying},i.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var r=t in this._animations?this._animations[t]:null;return null!==r&&(this._animationConfig.position=r.frameCount>0?r.duration*e/r.frameCount:0),this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var r=t in this._animations?this._animations[t]:null;return null!==r&&(this._animationConfig.position=r.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},i.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByTime(t,e,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByFrame(t,e,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByProgress(t,e,1);return null!==i&&i.stop(),i},i.prototype.getBlendState=function(e,i,r){e in this._blendStates||(this._blendStates[e]={});var n=this._blendStates[e];if(!(i in n)){var a=n[i]=t.BaseObject.borrowObject(t.BlendState);a.target=r}return n[i]},i.prototype.getState=function(t,e){void 0===e&&(e=-1);for(var i=this._animationStates.length;i--;){var r=this._animationStates[i];if(r.name===t&&(e<0||r.layer===e))return r}return null},i.prototype.hasAnimation=function(t){return t in this._animations},i.prototype.getStates=function(){return this._animationStates},Object.defineProperty(i.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];if(i.isPlaying)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];if(!i.isCompleted)return!1}return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationNameList",{get:function(){return this._animationNameList},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNameList.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNameList.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),i}(t.BaseObject);t.Animation=e}(dragonBones||(dragonBones={})),function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._boneMask=[],t._boneTimelines=[],t._boneBlendTimelines=[],t._slotTimelines=[],t._slotBlendTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._actionTimeline=null,t._zOrderTimeline=null,t}return __extends(r,e),r.toString=function(){return"[class dragonBones.AnimationState]"},r.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++){var i=e[t];i.returnToPool()}for(var r=0,n=this._boneBlendTimelines;r<n.length;r++){i=n[r];i.returnToPool()}for(var a=0,s=this._slotTimelines;a<s.length;a++){i=s[a];i.returnToPool()}for(var o=0,h=this._slotBlendTimelines;o<h.length;o++){i=h[o];i.returnToPool()}for(var l=0,u=this._constraintTimelines;l<u.length;l++){i=u[l];i.returnToPool()}for(var c=0,p=this._animationTimelines;c<p.length;c++){i=p[c];var d=i.target;d._parent===this&&(d._fadeState=1,d._subFadeState=1,d._parent=null),i.returnToPool()}null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additive=!1,this.displayControl=!1,this.resetToPose=!1,this.blendType=0,this.playTimes=1,this.layer=0,this.timeScale=1,this._weight=1,this.parameterX=0,this.parameterY=0,this.positionX=0,this.positionY=0,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._boneMask.length=0,this._boneTimelines.length=0,this._boneBlendTimelines.length=0,this._slotTimelines.length=0,this._slotBlendTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._activeChildA=null,this._activeChildB=null,this._parent=null},r.prototype._updateTimelines=function(){for(var e=0,i=this._armature._constraints;e<i.length;e++){var r=i[e],n=this._animationData.getConstraintTimelines(r.name);if(null!==n)for(var a=0,s=n;a<s.length;a++){var o=s[a];switch(o.type){case 30:var h=t.BaseObject.borrowObject(t.IKConstraintTimelineState);h.target=r,h.init(this._armature,this,o),this._constraintTimelines.push(h)}}else if(this.resetToPose){h=t.BaseObject.borrowObject(t.IKConstraintTimelineState);h.target=r,h.init(this._armature,this,null),this._constraintTimelines.push(h),this._poseTimelines.push(h)}}},r.prototype._updateBoneAndSlotTimelines=function(){for(var e={},r=0,n=this._boneTimelines;r<n.length;r++){var a=n[r],s=a.target.target.name;s in e||(e[s]=[]),e[s].push(a)}for(var o=0,h=this._boneBlendTimelines;o<h.length;o++){a=h[o],s=a.target.target.name;s in e||(e[s]=[]),e[s].push(a)}for(var l=0,u=this._armature.getBones();l<u.length;l++){var c=u[l];s=c.name;if(this.containsBoneMask(s))if(s in e)delete e[s];else{var p=this._animationData.getBoneTimelines(s),d=this._armature.animation.getBlendState(i.BONE_TRANSFORM,c.name,c);if(null!==p)for(var f=0,_=p;f<_.length;f++){var g=_[f];switch(g.type){case 10:a=t.BaseObject.borrowObject(t.BoneAllTimelineState);a.target=d,a.init(this._armature,this,g),this._boneTimelines.push(a);break;case 11:a=t.BaseObject.borrowObject(t.BoneTranslateTimelineState);a.target=d,a.init(this._armature,this,g),this._boneTimelines.push(a);break;case 12:a=t.BaseObject.borrowObject(t.BoneRotateTimelineState);a.target=d,a.init(this._armature,this,g),this._boneTimelines.push(a);break;case 13:a=t.BaseObject.borrowObject(t.BoneScaleTimelineState);a.target=d,a.init(this._armature,this,g),this._boneTimelines.push(a);break;case 60:a=t.BaseObject.borrowObject(t.AlphaTimelineState);a.target=this._armature.animation.getBlendState(i.BONE_ALPHA,c.name,c),a.init(this._armature,this,g),this._boneBlendTimelines.push(a);break;case 50:a=t.BaseObject.borrowObject(t.SurfaceTimelineState);a.target=this._armature.animation.getBlendState(i.SURFACE,c.name,c),a.init(this._armature,this,g),this._boneBlendTimelines.push(a)}}else if(this.resetToPose)if(0===c._boneData.type){a=t.BaseObject.borrowObject(t.BoneAllTimelineState);a.target=d,a.init(this._armature,this,null),this._boneTimelines.push(a),this._poseTimelines.push(a)}else{a=t.BaseObject.borrowObject(t.SurfaceTimelineState);a.target=this._armature.animation.getBlendState(i.SURFACE,c.name,c),a.init(this._armature,this,null),this._boneBlendTimelines.push(a),this._poseTimelines.push(a)}}}for(var m in e)for(var y=0,v=e[m];y<v.length;y++){a=v[y];var T=this._boneTimelines.indexOf(a);T>=0&&(this._boneTimelines.splice(T,1),a.returnToPool()),T=this._boneBlendTimelines.indexOf(a),T>=0&&(this._boneBlendTimelines.splice(T,1),a.returnToPool())}for(var x={},b=[],A=0,S=this._slotTimelines;A<S.length;A++){a=S[A],s=a.target.name;s in x||(x[s]=[]),x[s].push(a)}for(var w=0,P=this._slotBlendTimelines;w<P.length;w++){a=P[w],s=a.target.target.name;s in x||(x[s]=[]),x[s].push(a)}for(var E=0,D=this._armature.getSlots();E<D.length;E++){var C=D[E],O=C.parent.name;if(this.containsBoneMask(O)){s=C.name;if(s in x)delete x[s];else{var M=!1,I=!1;b.length=0;p=this._animationData.getSlotTimelines(s);if(null!==p)for(var R=0,N=p;R<N.length;R++){g=N[R];switch(g.type){case 20:a=t.BaseObject.borrowObject(t.SlotDislayTimelineState);a.target=C,a.init(this._armature,this,g),this._slotTimelines.push(a),M=!0;break;case 23:a=t.BaseObject.borrowObject(t.SlotZIndexTimelineState);a.target=this._armature.animation.getBlendState(i.SLOT_Z_INDEX,C.name,C),a.init(this._armature,this,g),this._slotBlendTimelines.push(a);break;case 21:a=t.BaseObject.borrowObject(t.SlotColorTimelineState);a.target=C,a.init(this._armature,this,g),this._slotTimelines.push(a),I=!0;break;case 22:a=t.BaseObject.borrowObject(t.DeformTimelineState);a.target=this._armature.animation.getBlendState(i.SLOT_DEFORM,C.name,C),a.init(this._armature,this,g),null!==a.target?(this._slotBlendTimelines.push(a),b.push(a.geometryOffset)):a.returnToPool();break;case 24:a=t.BaseObject.borrowObject(t.AlphaTimelineState);a.target=this._armature.animation.getBlendState(i.SLOT_ALPHA,C.name,C),a.init(this._armature,this,g),this._slotBlendTimelines.push(a)}}if(this.resetToPose){if(!M){a=t.BaseObject.borrowObject(t.SlotDislayTimelineState);a.target=C,a.init(this._armature,this,null),this._slotTimelines.push(a),this._poseTimelines.push(a)}if(!I){a=t.BaseObject.borrowObject(t.SlotColorTimelineState);a.target=C,a.init(this._armature,this,null),this._slotTimelines.push(a),this._poseTimelines.push(a)}for(var B=0,L=C.displayFrameCount;B<L;++B){var F=C.getDisplayFrameAt(B);if(0!==F.deformVertices.length){var k=F.getGeometryData();if(null!==k&&b.indexOf(k.offset)<0){a=t.BaseObject.borrowObject(t.DeformTimelineState);a.geometryOffset=k.offset,a.displayFrame=F,a.target=this._armature.animation.getBlendState(i.SLOT_DEFORM,C.name,C),a.init(this._armature,this,null),this._slotBlendTimelines.push(a),this._poseTimelines.push(a)}}}}}}}for(var m in x)for(var U=0,j=x[m];U<j.length;U++){a=j[U],T=this._slotTimelines.indexOf(a);T>=0&&(this._slotTimelines.splice(T,1),a.returnToPool()),T=this._slotBlendTimelines.indexOf(a),T>=0&&(this._slotBlendTimelines.splice(T,1),a.returnToPool())}},r.prototype._advanceFadeTime=function(e){var i=this._fadeState>0;if(this._subFadeState<0){this._subFadeState=0;var r=null===this._parent&&this.actionEnabled;if(r){var n=i?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;if(this._armature.eventDispatcher.hasDBEventListener(n)){var a=t.BaseObject.borrowObject(t.EventObject);a.type=n,a.armature=this._armature,a.animationState=this,this._armature._dragonBones.bufferEvent(a)}}}if(e<0&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=i?0:1):this._fadeTime>0?this._fadeProgress=i?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=i?1:0,this._subFadeState>0){i||(this._playheadState|=1,this._fadeState=0);r=null===this._parent&&this.actionEnabled;if(r){n=i?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE;if(this._armature.eventDispatcher.hasDBEventListener(n)){a=t.BaseObject.borrowObject(t.EventObject);a.type=n,a.armature=this._armature,a.animationState=this,this._armature._dragonBones.bufferEvent(a)}}}},r.prototype.init=function(e,i,r){if(null===this._armature){if(this._armature=e,this._animationData=i,this.resetToPose=r.resetToPose,this.additive=r.additive,this.displayControl=r.displayControl,this.actionEnabled=r.actionEnabled,this.blendType=i.blendType,this.layer=r.layer,this.playTimes=r.playTimes,this.timeScale=r.timeScale,this.fadeTotalTime=r.fadeInTime,this.autoFadeOutTime=r.autoFadeOutTime,this.name=r.name.length>0?r.name:r.animation,this.group=r.group,this._weight=r.weight,r.pauseFadeIn?this._playheadState=2:this._playheadState=3,r.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==r.position?this.timeScale>=0?this._time=r.position:this._time=r.position-this._duration:this._time=0):(this._position=r.position,this._duration=r.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),r.boneMask.length>0){this._boneMask.length=r.boneMask.length;for(var n=0,a=this._boneMask.length;n<a;++n)this._boneMask[n]=r.boneMask[n]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},r.prototype.advanceTime=function(t,e){0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(t),3===this._playheadState&&(1!==this.timeScale&&(t*=this.timeScale),this._time+=t),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines());var i=0!==this._fadeState||0===this._subFadeState,r=0===this._fadeState&&e>0,n=!0,a=!0,s=this._time;if(this._weightResult=this._weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult),this._actionTimeline.playState<=0&&this._actionTimeline.update(s),0!==this._weight){if(r){var o=2*e;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*o)/o}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(s),r){var h=Math.floor(this._actionTimeline.currentTime*e);this._armature._cacheFrameIndex===h?(n=!1,a=!1):(this._armature._cacheFrameIndex=h,this._animationData.cachedFrames[h]?a=!1:this._animationData.cachedFrames[h]=!0)}if(n){var l=!1,u=null;if(a)for(var c=0,p=this._boneTimelines.length;c<p;++c){var d=this._boneTimelines[c];if(d.playState<=0&&d.update(s),d.target!==u){var f=d.target;if(l=f.update(this),u=f,1===f.dirty){var _=f.target.animationPose;_.x=0,_.y=0,_.rotation=0,_.skew=0,_.scaleX=1,_.scaleY=1}}l&&d.blend(i)}for(c=0,p=this._boneBlendTimelines.length;c<p;++c){d=this._boneBlendTimelines[c];d.playState<=0&&d.update(s),d.target.update(this)&&d.blend(i)}if(this.displayControl)for(c=0,p=this._slotTimelines.length;c<p;++c){d=this._slotTimelines[c];if(d.playState<=0){var g=d.target,m=g.displayController;null!==m&&m!==this.name&&m!==this.group||d.update(s)}}for(c=0,p=this._slotBlendTimelines.length;c<p;++c){d=this._slotBlendTimelines[c];if(d.playState<=0){f=d.target;d.update(s),f.update(this)&&d.blend(i)}}for(c=0,p=this._constraintTimelines.length;c<p;++c){d=this._constraintTimelines[c];d.playState<=0&&d.update(s)}if(this._animationTimelines.length>0){var y=100,v=100,T=null,x=null;for(c=0,p=this._animationTimelines.length;c<p;++c){d=this._animationTimelines[c];if(d.playState<=0&&d.update(s),1===this.blendType){var b=d.target,A=this.parameterX-b.positionX;A>=0?A<y&&(y=A,T=b):-A<v&&(v=-A,x=b)}}null!==T&&(this._activeChildA!==T&&(null!==this._activeChildA&&(this._activeChildA.weight=0),this._activeChildA=T,this._activeChildA.activeTimeline()),this._activeChildB!==x&&(null!==this._activeChildB&&(this._activeChildB.weight=0),this._activeChildB=x),T.weight=v/(y+v),x&&(x.weight=1-T.weight))}}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(var S=0,w=this._poseTimelines;S<w.length;S++){d=w[S];var P=this._boneTimelines.indexOf(d);P>=0?(this._boneTimelines.splice(P,1),d.returnToPool()):(P=this._boneBlendTimelines.indexOf(d),P>=0?(this._boneBlendTimelines.splice(P,1),d.returnToPool()):(P=this._slotTimelines.indexOf(d),P>=0?(this._slotTimelines.splice(P,1),d.returnToPool()):(P=this._slotBlendTimelines.indexOf(d),P>=0?(this._slotBlendTimelines.splice(P,1),d.returnToPool()):(P=this._constraintTimelines.indexOf(d),P>=0&&(this._constraintTimelines.splice(P,1),d.returnToPool())))))}this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},r.prototype.play=function(){this._playheadState=3},r.prototype.stop=function(){this._playheadState&=1},r.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,r=this._boneTimelines;i<r.length;i++){var n=r[i];n.fadeOut()}for(var a=0,s=this._boneBlendTimelines;a<s.length;a++){n=s[a];n.fadeOut()}for(var o=0,h=this._slotTimelines;o<h.length;o++){n=h[o];n.fadeOut()}for(var l=0,u=this._slotBlendTimelines;l<u.length;l++){n=u[l];n.fadeOut()}for(var c=0,p=this._constraintTimelines;c<p.length;c++){n=p[c];n.fadeOut()}for(var d=0,f=this._animationTimelines;d<f.length;d++){n=f[d];n.fadeOut();var _=n.target;_.fadeOut(999999,!0)}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},r.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},r.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(null!==i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var r=0,n=this._armature.getBones();r<n.length;r++){var a=n[r];this._boneMask.indexOf(a.name)<0&&i.contains(a)&&this._boneMask.push(a.name)}this._timelineDirty=1}},r.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(i>=0&&this._boneMask.splice(i,1),e){var r=this._armature.getBone(t);if(null!==r){var n=this._armature.getBones();if(this._boneMask.length>0)for(var a=0,s=n;a<s.length;a++){var o=s[a],h=this._boneMask.indexOf(o.name);h>=0&&r.contains(o)&&this._boneMask.splice(h,1)}else for(var l=0,u=n;l<u.length;l++){o=u[l];o!==r&&(r.contains(o)||this._boneMask.push(o.name))}}}this._timelineDirty=1},r.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},r.prototype.addState=function(e,i){if(void 0===i&&(i=null),null!==i)for(var r=0,n=i;r<n.length;r++){var a=n[r];switch(a.type){case 40:var s=t.BaseObject.borrowObject(t.AnimationProgressTimelineState);if(s.target=e,s.init(this._armature,this,a),this._animationTimelines.push(s),0!==this.blendType){var o=a;e.positionX=o.x,e.positionY=o.y,e.weight=0}e._parent=this,this.resetToPose=!1;break;case 41:s=t.BaseObject.borrowObject(t.AnimationWeightTimelineState);s.target=e,s.init(this._armature,this,a),this._animationTimelines.push(s);break;case 42:s=t.BaseObject.borrowObject(t.AnimationParametersTimelineState);s.target=e,s.init(this._armature,this,a),this._animationTimelines.push(s)}}null===e._parent&&(e._parent=this)},r.prototype.activeTimeline=function(){for(var t=0,e=this._slotTimelines;t<e.length;t++){var i=e[t];i.dirty=!0,i.currentTime=-1}},Object.defineProperty(r.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration,t<0&&(t+=this._duration)),this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&null===this._parent&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var i=0,r=this._boneTimelines;i<r.length;i++){var n=r[i];n.playState=-1}for(var a=0,s=this._slotTimelines;a<s.length;a++){n=s[a];n.playState=-1}}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weight",{get:function(){return this._weight},set:function(t){if(this._weight!==t){this._weight=t;for(var e=0,i=this._boneTimelines;e<i.length;e++){var r=i[e];r.dirty=!0}for(var n=0,a=this._boneBlendTimelines;n<a.length;n++){r=a[n];r.dirty=!0}for(var s=0,o=this._slotBlendTimelines;s<o.length;s++){r=o[s];r.dirty=!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),r}(t.BaseObject);t.AnimationState=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.BlendState]"},e.prototype._onClear=function(){this.reset(),this.target=null},e.prototype.update=function(t){var e=t.layer,i=t._weightResult;if(this.dirty>0){if(this.leftWeight>0){if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.dirty++,this.layer=e,this.leftWeight=0,this.blendWeight=0,!1;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return i*=this.leftWeight,this.dirty++,this.blendWeight=i,this.layerWeight+=this.blendWeight,!0}return!1}return this.dirty++,this.layer=e,this.leftWeight=1,
this.blendWeight=i,this.layerWeight=i,!0},e.prototype.reset=function(){this.dirty=0,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},e.BONE_TRANSFORM="boneTransform",e.BONE_ALPHA="boneAlpha",e.SURFACE="surface",e.SLOT_DEFORM="slotDeform",e.SLOT_ALPHA="slotAlpha",e.SLOT_Z_INDEX="slotZIndex",e}(t.BaseObject);t.BlendState=i}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this.dirty=!1,this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this.target=null,this._isTween=!1,this._valueOffset=0,this._frameValueOffset=0,this._frameOffset=0,this._frameRate=0,this._frameCount=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._valueArray=null,this._timelineArray=null,this._frameIndices=null},e.prototype._setCurrentTime=function(t){var e=this.playState,i=this.currentPlayTimes,r=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var n=this._animationState.playTimes,a=n*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),n>0&&(t>=a||t<=-a)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=n,this.currentTime=t<0?0:this._duration+1e-6):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==i||this.currentTime!==r)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==i)&&(this._frameIndex=-1),!0)},e.prototype.init=function(t,e,i){if(this._armature=t,this._animationState=e,this._timelineData=i,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState.animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,null!==this._timelineData){var r=this._animationData.parent.parent;this._frameArray=r.frameArray,this._timelineArray=r.timelineArray,this._frameIndices=r.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1]}},e.prototype.fadeOut=function(){this.dirty=!1},e.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),i=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==i&&(this._frameIndex=i,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());(this._isTween||this.dirty)&&this._onUpdateFrame()}},e.prototype.blend=function(t){},e}(t.BaseObject);t.TimelineState=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e._getEasingValue=function(t,e,i){var r=e;switch(t){case 3:r=Math.pow(e,2);break;case 4:r=1-Math.pow(1-e,2);break;case 5:r=.5*(1-Math.cos(e*Math.PI))}return(r-e)*i+e},e._getEasingCurveValue=function(t,e,i,r){if(t<=0)return 0;if(t>=1)return 1;var n=i>0,a=i+1,s=Math.floor(t*a),o=0,h=0;return n?(o=0===s?0:e[r+s-1],h=s===a-1?1e4:e[r+s]):(o=e[r+s-1],h=e[r+s]),1e-4*(o+(h-o)*(t*a-s))},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenEasing=0,this._tweenProgress=0,this._valueScale=1},e.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._isTween=0!==this._tweenType,this._isTween?2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]):this.dirty=!0,this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=e>0?1/e:0}else this.dirty=!0,this._isTween=!1},e.prototype._onUpdateFrame=function(){this._isTween&&(this.dirty=!0,this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=e._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=e._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing)))},e}(e);t.TweenTimelineState=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this._current=0,this._difference=0,this._result=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._valueScale,i=this._valueArray,r=this._valueOffset+this._frameValueOffset+this._frameIndex;if(this._isTween){var n=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:r+1;1===e?(this._current=i[r],this._difference=i[n]-this._current):(this._current=i[r]*e,this._difference=i[n]*e-this._current)}else this._result=i[r]*e}else this._result=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._result=this._current+this._difference*this._tweenProgress)},e}(i);t.SingleValueTimelineState=r;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this._currentA=0,this._currentB=0,this._differenceA=0,this._differenceB=0,this._resultA=0,this._resultB=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._valueScale,i=this._valueArray,r=this._valueOffset+this._frameValueOffset+2*this._frameIndex;if(this._isTween){var n=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:r+2;1===e?(this._currentA=i[r],this._currentB=i[r+1],this._differenceA=i[n]-this._currentA,this._differenceB=i[n+1]-this._currentB):(this._currentA=i[r]*e,this._currentB=i[r+1]*e,this._differenceA=i[n]*e-this._currentA,this._differenceB=i[n+1]*e-this._currentB)}else this._resultA=i[r]*e,this._resultB=i[r+1]*e}else this._resultA=0,this._resultB=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._resultA=this._currentA+this._differenceA*this._tweenProgress,this._resultB=this._currentB+this._differenceB*this._tweenProgress)},e}(i);t.DoubleValueTimelineState=n;var a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._rd=[],e}return __extends(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this._valueCount=0,this._rd.length=0},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this);var e=this._valueCount,i=this._rd;if(null!==this._timelineData){var r=this._valueScale,n=this._valueArray,a=this._valueOffset+this._frameValueOffset+this._frameIndex*e;if(this._isTween){var s=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:a+e;if(1===r)for(var o=0;o<e;++o)i[e+o]=n[s+o]-n[a+o];else for(o=0;o<e;++o)i[e+o]=(n[s+o]-n[a+o])*r}else if(1===r)for(o=0;o<e;++o)i[o]=n[a+o];else for(o=0;o<e;++o)i[o]=n[a+o]*r}else for(o=0;o<e;++o)i[o]=0},e.prototype._onUpdateFrame=function(){if(t.prototype._onUpdateFrame.call(this),this._isTween){var e=this._valueCount,i=this._valueScale,r=this._tweenProgress,n=this._valueArray,a=this._rd,s=this._valueOffset+this._frameValueOffset+this._frameIndex*e;if(1===i)for(var o=0;o<e;++o)a[o]=n[s+o]+a[e+o]*r;else for(o=0;o<e;++o)a[o]=n[s+o]*i+a[e+o]*r}},e}(i);t.MutilpleValueTimelineState=a}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.toString=function(){return"[class dragonBones.ActionTimelineState]"},i.prototype._onCrossFrame=function(e){var i=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var r=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],n=this._frameArray[r+1],a=this._animationData.parent.actions,s=0;s<n;++s){var o=this._frameArray[r+2+s],h=a[o];if(0===h.type){var l=t.BaseObject.borrowObject(t.EventObject);l.time=this._frameArray[r]/this._frameRate,l.animationState=this._animationState,t.EventObject.actionDataToInstance(h,l,this._armature),this._armature._bufferAction(l,!0)}else{var u=10===h.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;if(11===h.type||i.hasDBEventListener(u)){l=t.BaseObject.borrowObject(t.EventObject);l.time=this._frameArray[r]/this._frameRate,l.animationState=this._animationState,t.EventObject.actionDataToInstance(h,l,this._armature),this._armature._dragonBones.bufferEvent(l)}}}},i.prototype._onArriveAtFrame=function(){},i.prototype._onUpdateFrame=function(){},i.prototype.update=function(e){var i=this.playState,r=this.currentPlayTimes,n=this.currentTime;if(this._setCurrentTime(e)){var a=null===this._animationState._parent&&this._animationState.actionEnabled,s=this._armature.eventDispatcher;if(i<0){if(this.playState===i)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),r=this.currentPlayTimes,a&&s.hasDBEventListener(t.EventObject.START)){var o=t.BaseObject.borrowObject(t.EventObject);o.type=t.EventObject.START,o.armature=this._armature,o.animationState=this._animationState,this._armature._dragonBones.bufferEvent(o)}}var h=this._animationState.timeScale<0,l=null,u=null;if(a&&this.currentPlayTimes!==r&&(s.hasDBEventListener(t.EventObject.LOOP_COMPLETE)&&(l=t.BaseObject.borrowObject(t.EventObject),l.type=t.EventObject.LOOP_COMPLETE,l.armature=this._armature,l.animationState=this._animationState),this.playState>0&&s.hasDBEventListener(t.EventObject.COMPLETE)&&(u=t.BaseObject.borrowObject(t.EventObject),u.type=t.EventObject.COMPLETE,u.armature=this._armature,u.animationState=this._animationState)),this._frameCount>1){var c=this._timelineData,p=Math.floor(this.currentTime*this._frameRate),d=this._frameIndices[c.frameIndicesOffset+p];if(this._frameIndex!==d){var f=this._frameIndex;if(this._frameIndex=d,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[c.offset+5+this._frameIndex],h){if(f<0){var _=Math.floor(n*this._frameRate);f=this._frameIndices[c.frameIndicesOffset+_],this.currentPlayTimes===r&&f===d&&(f=-1)}for(;f>=0;){var g=this._animationData.frameOffset+this._timelineArray[c.offset+5+f],m=this._frameArray[g]/this._frameRate;if(this._position<=m&&m<=this._position+this._duration&&this._onCrossFrame(f),null!==l&&0===f&&(this._armature._dragonBones.bufferEvent(l),l=null),f>0?f--:f=this._frameCount-1,f===d)break}}else{if(f<0){_=Math.floor(n*this._frameRate);f=this._frameIndices[c.frameIndicesOffset+_];g=this._animationData.frameOffset+this._timelineArray[c.offset+5+f],m=this._frameArray[g]/this._frameRate;this.currentPlayTimes===r&&(n<=m?f>0?f--:f=this._frameCount-1:f===d&&(f=-1))}for(;f>=0;){f<this._frameCount-1?f++:f=0;g=this._animationData.frameOffset+this._timelineArray[c.offset+5+f],m=this._frameArray[g]/this._frameRate;if(this._position<=m&&m<=this._position+this._duration&&this._onCrossFrame(f),null!==l&&0===f&&(this._armature._dragonBones.bufferEvent(l),l=null),f===d)break}}}}else if(this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)){this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5];m=this._frameArray[this._frameOffset]/this._frameRate;this.currentPlayTimes===r?n<=m&&this._onCrossFrame(this._frameIndex):this._position<=m&&(h||null===l||(this._armature._dragonBones.bufferEvent(l),l=null),this._onCrossFrame(this._frameIndex))}null!==l&&this._armature.eventDispatcher.dispatchDBEvent(l.type,l),null!==u&&this._armature.eventDispatcher.dispatchDBEvent(u.type,u)}},i.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},i}(t.TimelineState);t.ActionTimelineState=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=this._frameArray[this._frameOffset+1];t>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0)}},e.prototype._onUpdateFrame=function(){},e}(t.TimelineState);t.ZOrderTimelineState=i;var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},i.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._rd[2]=t.Transform.normalizeRadian(this._rd[2]),this._rd[3]=t.Transform.normalizeRadian(this._rd[3])),null===this._timelineData&&(this._rd[4]=1,this._rd[5]=1)},i.prototype.init=function(t,i,r){e.prototype.init.call(this,t,i,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=6,this._valueArray=this._animationData.parent.parent.frameFloatArray},i.prototype.fadeOut=function(){this.dirty=!1,this._rd[2]=t.Transform.normalizeRadian(this._rd[2]),this._rd[3]=t.Transform.normalizeRadian(this._rd[3])},i.prototype.blend=function(t){var e=this._armature.armatureData.scale,i=this._rd,r=this.target,n=r.target,a=r.blendWeight,s=n.animationPose;r.dirty>1?(s.x+=i[0]*a*e,s.y+=i[1]*a*e,s.rotation+=i[2]*a,s.skew+=i[3]*a,s.scaleX+=(i[4]-1)*a,s.scaleY+=(i[5]-1)*a):(s.x=i[0]*a*e,s.y=i[1]*a*e,s.rotation=i[2]*a,s.skew=i[3]*a,s.scaleX=(i[4]-1)*a+1,s.scaleY=(i[5]-1)*a+1),(t||this.dirty)&&(this.dirty=!1,n._transformDirty=!0)},i}(t.MutilpleValueTimelineState);t.BoneAllTimelineState=r;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=this._animationData.parent.parent.frameFloatArray},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight,n=i.animationPose;e.dirty>1?(n.x+=this._resultA*r,n.y+=this._resultB*r):1!==r?(n.x=this._resultA*r,n.y=this._resultB*r):(n.x=this._resultA,n.y=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},e}(t.DoubleValueTimelineState);t.BoneTranslateTimelineState=n;var a=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},i.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._differenceA=t.Transform.normalizeRadian(this._differenceA),this._differenceB=t.Transform.normalizeRadian(this._differenceB))},i.prototype.init=function(t,i,r){e.prototype.init.call(this,t,i,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},i.prototype.fadeOut=function(){this.dirty=!1,this._resultA=t.Transform.normalizeRadian(this._resultA),this._resultB=t.Transform.normalizeRadian(this._resultB)},i.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight,n=i.animationPose;e.dirty>1?(n.rotation+=this._resultA*r,n.skew+=this._resultB*r):1!==r?(n.rotation=this._resultA*r,n.skew=this._resultB*r):(n.rotation=this._resultA,n.skew=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},i}(t.DoubleValueTimelineState);t.BoneRotateTimelineState=a;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._resultA=1,this._resultB=1)},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight,n=i.animationPose;e.dirty>1?(n.scaleX+=(this._resultA-1)*r,n.scaleY+=(this._resultB-1)*r):1!==r?(n.scaleX=(this._resultA-1)*r+1,n.scaleY=(this._resultB-1)*r+1):(n.scaleX=this._resultA,n.scaleY=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},e}(t.DoubleValueTimelineState);t.BoneScaleTimelineState=s;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},e.prototype.init=function(e,i,r){if(t.prototype.init.call(this,e,i,r),null!==this._timelineData){var n=this._animationData.parent.parent,a=n.frameIntArray,s=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=a[s+2],this._deformCount=a[s+1],this._deformOffset=a[s+3],this._sameValueOffset=a[s+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=n.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.target.target._deformVertices.length},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight,n=i._deformVertices,a=this._valueArray;if(null!==a)for(var s=this._valueCount,o=this._deformOffset,h=this._sameValueOffset,l=this._rd,u=0;u<this._deformCount;++u){var c=0;c=u<o?a[h+u]:u<o+s?l[u-o]:a[h+u-s],e.dirty>1?n[u]+=c*r:n[u]=c*r}else if(1===e.dirty)for(u=0;u<this._deformCount;++u)n[u]=0;(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},e}(t.MutilpleValueTimelineState);t.SurfaceTimelineState=o;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.AlphaTimelineState]"},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._result=1)},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight;e.dirty>1?(i._alpha+=this._result*r,i._alpha>1&&(i._alpha=1)):i._alpha=this._result*r,(t||this.dirty)&&(this.dirty=!1,this._armature._alphaDirty=!0)},e}(t.SingleValueTimelineState);t.AlphaTimelineState=h;var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=this.target,e=null!==this._timelineData?this._frameArray[this._frameOffset+1]:t._slotData.displayIndex;t.displayIndex!==e&&t._setDisplayIndex(e,!0)}},e.prototype._onUpdateFrame=function(){},e}(t.TimelineState);t.SlotDislayTimelineState=l;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[0,0,0,0,0,0,0,0],e._difference=[0,0,0,0,0,0,0,0],e._result=[0,0,0,0,0,0,0,0],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.parent.parent,i=e.colorArray,r=e.frameIntArray,n=this._animationData.frameIntOffset+this._frameValueOffset+this._frameIndex,a=r[n];a<0&&(a+=65536),this._isTween?(this._current[0]=i[a++],this._current[1]=i[a++],this._current[2]=i[a++],this._current[3]=i[a++],this._current[4]=i[a++],this._current[5]=i[a++],this._current[6]=i[a++],this._current[7]=i[a++],a=this._frameIndex===this._frameCount-1?r[this._animationData.frameIntOffset+this._frameValueOffset]:r[n+1],a<0&&(a+=65536),this._difference[0]=i[a++]-this._current[0],this._difference[1]=i[a++]-this._current[1],this._difference[2]=i[a++]-this._current[2],this._difference[3]=i[a++]-this._current[3],this._difference[4]=i[a++]-this._current[4],this._difference[5]=i[a++]-this._current[5],this._difference[6]=i[a++]-this._current[6],this._difference[7]=i[a++]-this._current[7]):(this._result[0]=.01*i[a++],this._result[1]=.01*i[a++],this._result[2]=.01*i[a++],this._result[3]=.01*i[a++],this._result[4]=i[a++],this._result[5]=i[a++],this._result[6]=i[a++],this._result[7]=i[a++])}else{var s=this.target,o=s.slotData.color;this._result[0]=o.alphaMultiplier,this._result[1]=o.redMultiplier,this._result[2]=o.greenMultiplier,this._result[3]=o.blueMultiplier,this._result[4]=o.alphaOffset,this._result[5]=o.redOffset,this._result[6]=o.greenOffset,this._result[7]=o.blueOffset}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._result[0]=.01*(this._current[0]+this._difference[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._difference[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._difference[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._difference[3]*this._tweenProgress),this._result[4]=this._current[4]+this._difference[4]*this._tweenProgress,this._result[5]=this._current[5]+this._difference[5]*this._tweenProgress,this._result[6]=this._current[6]+this._difference[6]*this._tweenProgress,this._result[7]=this._current[7]+this._difference[7]*this._tweenProgress)},e.prototype.fadeOut=function(){this._isTween=!1},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._isTween||this.dirty){var i=this.target,r=i._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(r.alphaMultiplier!==this._result[0]||r.redMultiplier!==this._result[1]||r.greenMultiplier!==this._result[2]||r.blueMultiplier!==this._result[3]||r.alphaOffset!==this._result[4]||r.redOffset!==this._result[5]||r.greenOffset!==this._result[6]||r.blueOffset!==this._result[7]){var n=Math.pow(this._animationState._fadeProgress,4);r.alphaMultiplier+=(this._result[0]-r.alphaMultiplier)*n,r.redMultiplier+=(this._result[1]-r.redMultiplier)*n,r.greenMultiplier+=(this._result[2]-r.greenMultiplier)*n,r.blueMultiplier+=(this._result[3]-r.blueMultiplier)*n,r.alphaOffset+=(this._result[4]-r.alphaOffset)*n,r.redOffset+=(this._result[5]-r.redOffset)*n,r.greenOffset+=(this._result[6]-r.greenOffset)*n,r.blueOffset+=(this._result[7]-r.blueOffset)*n,i._colorDirty=!0}}else this.dirty&&(this.dirty=!1,r.alphaMultiplier===this._result[0]&&r.redMultiplier===this._result[1]&&r.greenMultiplier===this._result[2]&&r.blueMultiplier===this._result[3]&&r.alphaOffset===this._result[4]&&r.redOffset===this._result[5]&&r.greenOffset===this._result[6]&&r.blueOffset===this._result[7]||(r.alphaMultiplier=this._result[0],r.redMultiplier=this._result[1],r.greenMultiplier=this._result[2],r.blueMultiplier=this._result[3],r.alphaOffset=this._result[4],r.redOffset=this._result[5],r.greenOffset=this._result[6],r.blueOffset=this._result[7],i._colorDirty=!0))}},e}(t.TweenTimelineState);t.SlotColorTimelineState=u;var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.SlotZIndexTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null===this._timelineData){var e=this.target,i=e.target;this._result=i.slotData.zIndex}},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueArray=this._animationData.parent.parent.frameIntArray},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight;e.dirty>1?i._zIndex+=this._result*r:i._zIndex=this._result*r,(t||this.dirty)&&(this.dirty=!1,this._armature._zIndexDirty=!0)},e}(t.SingleValueTimelineState);t.SlotZIndexTimelineState=c;var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.DeformTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.geometryOffset=0,this.displayFrame=null,this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},e.prototype.init=function(e,i,r){if(t.prototype.init.call(this,e,i,r),null!==this._timelineData){var n=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],a=this._animationData.parent.parent,s=a.frameIntArray,o=this.target.target;this.geometryOffset=s[n+0],this.geometryOffset<0&&(this.geometryOffset+=65536);for(var h=0,l=o.displayFrameCount;h<l;++h){var u=o.getDisplayFrameAt(h),c=u.getGeometryData();if(null!==c&&c.offset===this.geometryOffset){this.displayFrame=u,this.displayFrame.updateDeformVertices();break}}if(null===this.displayFrame)return void this.returnToPool();this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=s[n+2],this._deformCount=s[n+1],this._deformOffset=s[n+3],this._sameValueOffset=s[n+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=a.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.displayFrame.deformVertices.length},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight,n=this.displayFrame.deformVertices,a=this._valueArray;if(null!==a)for(var s=this._valueCount,o=this._deformOffset,h=this._sameValueOffset,l=this._rd,u=0;u<this._deformCount;++u){var c=0;c=u<o?a[h+u]:u<o+s?l[u-o]:a[h+u-s],e.dirty>1?n[u]+=c*r:n[u]=c*r}else if(1===e.dirty)for(u=0;u<this._deformCount;++u)n[u]=0;(t||this.dirty)&&(this.dirty=!1,i._geometryData===this.displayFrame.getGeometryData()&&(i._verticesDirty=!0))},e}(t.MutilpleValueTimelineState);t.DeformTimelineState=p;var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;if(null!==this._timelineData)e._bendPositive=this._currentA>0,e._weight=this._currentB;else{var i=e._constraintData;e._bendPositive=i.bendPositive,e._weight=i.weight}e.invalidUpdate(),this.dirty=!1},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},e}(t.DoubleValueTimelineState);t.IKConstraintTimelineState=d;var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.AnimationProgressTimelineState]"},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.currentTime=this._result*e.totalTime),this.dirty=!1},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},e}(t.SingleValueTimelineState);t.AnimationProgressTimelineState=f;var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.AnimationWeightTimelineState]"},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.weight=this._result),this.dirty=!1},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},e}(t.SingleValueTimelineState);t.AnimationWeightTimelineState=_;var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.AnimationParametersTimelineState]"},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.parameterX=this._resultA,e.parameterY=this._resultB),this.dirty=!1},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},e}(t.DoubleValueTimelineState);t.AnimationParametersTimelineState=g}(dragonBones||(dragonBones={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.actionDataToInstance=function(t,i,r){0===t.type?i.type=e.FRAME_EVENT:i.type=10===t.type?e.FRAME_EVENT:e.SOUND_EVENT,i.name=t.name,i.armature=r,i.actionData=t,i.data=t.data,null!==t.bone&&(i.bone=r.getBone(t.bone.name)),null!==t.slot&&(i.slot=r.getSlot(t.slot.name))},e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",e}(t.BaseObject);t.EventObject=e}(dragonBones||(dragonBones={})),function(t){var e=function(){function t(){}return t._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},t._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},t._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}},t._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}},t._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:
return 0}},t._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}},t._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},t._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},t._getAnimationBlendType=function(t){switch(t.toLowerCase()){case"none":return 0;case"1d":return 1;default:return 0}},t._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},t.DATA_VERSION_2_3="2.3",t.DATA_VERSION_3_0="3.0",t.DATA_VERSION_4_0="4.0",t.DATA_VERSION_4_5="4.5",t.DATA_VERSION_5_0="5.0",t.DATA_VERSION_5_5="5.5",t.DATA_VERSION_5_6="5.6",t.DATA_VERSION=t.DATA_VERSION_5_6,t.DATA_VERSIONS=[t.DATA_VERSION_4_0,t.DATA_VERSION_4_5,t.DATA_VERSION_5_0,t.DATA_VERSION_5_5,t.DATA_VERSION_5_6],t.TEXTURE_ATLAS="textureAtlas",t.SUB_TEXTURE="SubTexture",t.FORMAT="format",t.IMAGE_PATH="imagePath",t.WIDTH="width",t.HEIGHT="height",t.ROTATED="rotated",t.FRAME_X="frameX",t.FRAME_Y="frameY",t.FRAME_WIDTH="frameWidth",t.FRAME_HEIGHT="frameHeight",t.DRADON_BONES="dragonBones",t.USER_DATA="userData",t.ARMATURE="armature",t.CANVAS="canvas",t.BONE="bone",t.SURFACE="surface",t.SLOT="slot",t.CONSTRAINT="constraint",t.SKIN="skin",t.DISPLAY="display",t.FRAME="frame",t.IK="ik",t.PATH_CONSTRAINT="path",t.ANIMATION="animation",t.TIMELINE="timeline",t.FFD="ffd",t.TRANSLATE_FRAME="translateFrame",t.ROTATE_FRAME="rotateFrame",t.SCALE_FRAME="scaleFrame",t.DISPLAY_FRAME="displayFrame",t.COLOR_FRAME="colorFrame",t.DEFAULT_ACTIONS="defaultActions",t.ACTIONS="actions",t.EVENTS="events",t.INTS="ints",t.FLOATS="floats",t.STRINGS="strings",t.TRANSFORM="transform",t.PIVOT="pivot",t.AABB="aabb",t.COLOR="color",t.VERSION="version",t.COMPATIBLE_VERSION="compatibleVersion",t.FRAME_RATE="frameRate",t.TYPE="type",t.SUB_TYPE="subType",t.NAME="name",t.PARENT="parent",t.TARGET="target",t.STAGE="stage",t.SHARE="share",t.PATH="path",t.LENGTH="length",t.DISPLAY_INDEX="displayIndex",t.Z_ORDER="zOrder",t.Z_INDEX="zIndex",t.BLEND_MODE="blendMode",t.INHERIT_TRANSLATION="inheritTranslation",t.INHERIT_ROTATION="inheritRotation",t.INHERIT_SCALE="inheritScale",t.INHERIT_REFLECTION="inheritReflection",t.INHERIT_ANIMATION="inheritAnimation",t.INHERIT_DEFORM="inheritDeform",t.SEGMENT_X="segmentX",t.SEGMENT_Y="segmentY",t.BEND_POSITIVE="bendPositive",t.CHAIN="chain",t.WEIGHT="weight",t.BLEND_TYPE="blendType",t.FADE_IN_TIME="fadeInTime",t.PLAY_TIMES="playTimes",t.SCALE="scale",t.OFFSET="offset",t.POSITION="position",t.DURATION="duration",t.TWEEN_EASING="tweenEasing",t.TWEEN_ROTATE="tweenRotate",t.TWEEN_SCALE="tweenScale",t.CLOCK_WISE="clockwise",t.CURVE="curve",t.SOUND="sound",t.EVENT="event",t.ACTION="action",t.X="x",t.Y="y",t.SKEW_X="skX",t.SKEW_Y="skY",t.SCALE_X="scX",t.SCALE_Y="scY",t.VALUE="value",t.ROTATE="rotate",t.SKEW="skew",t.ALPHA="alpha",t.ALPHA_OFFSET="aO",t.RED_OFFSET="rO",t.GREEN_OFFSET="gO",t.BLUE_OFFSET="bO",t.ALPHA_MULTIPLIER="aM",t.RED_MULTIPLIER="rM",t.GREEN_MULTIPLIER="gM",t.BLUE_MULTIPLIER="bM",t.UVS="uvs",t.VERTICES="vertices",t.TRIANGLES="triangles",t.WEIGHTS="weights",t.SLOT_POSE="slotPose",t.BONE_POSE="bonePose",t.BONES="bones",t.POSITION_MODE="positionMode",t.SPACING_MODE="spacingMode",t.ROTATE_MODE="rotateMode",t.SPACING="spacing",t.ROTATE_OFFSET="rotateOffset",t.ROTATE_MIX="rotateMix",t.TRANSLATE_MIX="translateMix",t.TARGET_DISPLAY="targetDisplay",t.CLOSED="closed",t.CONSTANT_SPEED="constantSpeed",t.VERTEX_COUNT="vertexCount",t.LENGTHS="lengths",t.GOTO_AND_PLAY="gotoAndPlay",t.DEFAULT_NAME="default",t}();t.DataParser=e}(dragonBones||(dragonBones={})),function(t){var e=function(e){function r(){var i=null!==e&&e.apply(this,arguments)||this;return i._rawTextureAtlasIndex=0,i._rawBones=[],i._data=null,i._armature=null,i._bone=null,i._geometry=null,i._slot=null,i._skin=null,i._mesh=null,i._animation=null,i._timeline=null,i._rawTextureAtlases=null,i._frameValueType=0,i._defaultColorOffset=-1,i._prevClockwise=0,i._prevRotation=0,i._frameDefaultValue=0,i._frameValueScale=1,i._helpMatrixA=new t.Matrix,i._helpMatrixB=new t.Matrix,i._helpTransform=new t.Transform,i._helpColorTransform=new t.ColorTransform,i._helpPoint=new t.Point,i._helpArray=[],i._intArray=[],i._floatArray=[],i._frameIntArray=[],i._frameFloatArray=[],i._frameArray=[],i._timelineArray=[],i._colorArray=[],i._cacheRawMeshes=[],i._cacheMeshes=[],i._actionFrames=[],i._weightSlotPose={},i._weightBonePoses={},i._cacheBones={},i._slotChildActions={},i}return __extends(r,e),r._getBoolean=function(t,e,i){if(e in t){var r=t[e],n=typeof r;if("boolean"===n)return r;if("string"!==n)return!!r;switch(r){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},r._getNumber=function(t,e,i){if(e in t){var r=t[e];return null===r||"NaN"===r?i:+r||0}return i},r._getString=function(t,e,i){if(e in t){var r=t[e],n=typeof r;return"string"===n?r:String(r)}return i},r.prototype._getCurvePoint=function(t,e,i,r,n,a,s,o,h,l){var u=1-h,c=u*u,p=h*h,d=u*c,f=3*h*c,_=3*u*p,g=h*p;l.x=d*t+f*i+_*n+g*s,l.y=d*e+f*r+_*a+g*o},r.prototype._samplingEasingCurve=function(t,e){var i=t.length;if(i%3==1){for(var r=-2,n=0,a=e.length;n<a;++n){for(var s=(n+1)/(a+1);(r+6<i?t[r+6]:1)<s;)r+=6;for(var o=r>=0&&r+6<i,h=o?t[r]:0,l=o?t[r+1]:0,u=t[r+2],c=t[r+3],p=t[r+4],d=t[r+5],f=o?t[r+6]:1,_=o?t[r+7]:1,g=0,m=1;m-g>1e-4;){var y=.5*(m+g);this._getCurvePoint(h,l,u,c,p,d,f,_,y,this._helpPoint),s-this._helpPoint.x>0?g=y:m=y}e[n]=this._helpPoint.y}return!0}for(r=0,n=0,a=e.length;n<a;++n){for(s=(n+1)/(a+1);t[r+6]<s;)r+=6;for(h=t[r],l=t[r+1],u=t[r+2],c=t[r+3],p=t[r+4],d=t[r+5],f=t[r+6],_=t[r+7],g=0,m=1;m-g>1e-4;){y=.5*(m+g);this._getCurvePoint(h,l,u,c,p,d,f,_,y,this._helpPoint),s-this._helpPoint.x>0?g=y:m=y}e[n]=this._helpPoint.y}return!1},r.prototype._parseActionDataInFrame=function(e,i,r,n){t.DataParser.EVENT in e&&this._mergeActionFrame(e[t.DataParser.EVENT],i,10,r,n),t.DataParser.SOUND in e&&this._mergeActionFrame(e[t.DataParser.SOUND],i,11,r,n),t.DataParser.ACTION in e&&this._mergeActionFrame(e[t.DataParser.ACTION],i,0,r,n),t.DataParser.EVENTS in e&&this._mergeActionFrame(e[t.DataParser.EVENTS],i,10,r,n),t.DataParser.ACTIONS in e&&this._mergeActionFrame(e[t.DataParser.ACTIONS],i,0,r,n)},r.prototype._mergeActionFrame=function(t,e,r,n,a){for(var s=this._armature.actions.length,o=this._parseActionData(t,r,n,a),h=0,l=null,u=0,c=o;u<c.length;u++){var p=c[u];this._armature.addAction(p,!1)}0===this._actionFrames.length&&(l=new i,l.frameStart=0,this._actionFrames.push(l),l=null);for(var d=0,f=this._actionFrames;d<f.length;d++){var _=f[d];if(_.frameStart===e){l=_;break}if(_.frameStart>e)break;h++}null===l&&(l=new i,l.frameStart=e,this._actionFrames.splice(h,0,l));for(var g=0;g<o.length;++g)l.actions.push(s+g)},r.prototype._parseArmature=function(e,i){var n=t.BaseObject.borrowObject(t.ArmatureData);if(n.name=r._getString(e,t.DataParser.NAME,""),n.frameRate=r._getNumber(e,t.DataParser.FRAME_RATE,this._data.frameRate),n.scale=i,t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?n.type=t.DataParser._getArmatureType(e[t.DataParser.TYPE]):n.type=r._getNumber(e,t.DataParser.TYPE,0),0===n.frameRate&&(n.frameRate=24),this._armature=n,t.DataParser.CANVAS in e){var a=e[t.DataParser.CANVAS],s=t.BaseObject.borrowObject(t.CanvasData);t.DataParser.COLOR in a?s.hasBackground=!0:s.hasBackground=!1,s.color=r._getNumber(a,t.DataParser.COLOR,0),s.x=r._getNumber(a,t.DataParser.X,0)*n.scale,s.y=r._getNumber(a,t.DataParser.Y,0)*n.scale,s.width=r._getNumber(a,t.DataParser.WIDTH,0)*n.scale,s.height=r._getNumber(a,t.DataParser.HEIGHT,0)*n.scale,n.canvas=s}if(t.DataParser.AABB in e){var o=e[t.DataParser.AABB];n.aabb.x=r._getNumber(o,t.DataParser.X,0)*n.scale,n.aabb.y=r._getNumber(o,t.DataParser.Y,0)*n.scale,n.aabb.width=r._getNumber(o,t.DataParser.WIDTH,0)*n.scale,n.aabb.height=r._getNumber(o,t.DataParser.HEIGHT,0)*n.scale}if(t.DataParser.BONE in e)for(var h=e[t.DataParser.BONE],l=0,u=h;l<u.length;l++){var c=u[l],p=r._getString(c,t.DataParser.PARENT,""),d=this._parseBone(c);if(p.length>0){var f=n.getBone(p);null!==f?d.parent=f:(p in this._cacheBones||(this._cacheBones[p]=[]),this._cacheBones[p].push(d))}if(d.name in this._cacheBones){for(var _=0,g=this._cacheBones[d.name];_<g.length;_++){var m=g[_];m.parent=d}delete this._cacheBones[d.name]}n.addBone(d),this._rawBones.push(d)}if(t.DataParser.IK in e)for(var y=e[t.DataParser.IK],v=0,T=y;v<T.length;v++){var x=T[v],b=this._parseIKConstraint(x);b&&n.addConstraint(b)}if(n.sortBones(),t.DataParser.SLOT in e)for(var A=0,S=e[t.DataParser.SLOT],w=0,P=S;w<P.length;w++){var E=P[w];n.addSlot(this._parseSlot(E,A++))}if(t.DataParser.SKIN in e)for(var D=e[t.DataParser.SKIN],C=0,O=D;C<O.length;C++){var M=O[C];n.addSkin(this._parseSkin(M))}if(t.DataParser.PATH_CONSTRAINT in e)for(var I=e[t.DataParser.PATH_CONSTRAINT],R=0,N=I;R<N.length;R++){var B=N[R];b=this._parsePathConstraint(B);b&&n.addConstraint(b)}for(var L=0,F=this._cacheRawMeshes.length;L<F;++L){var k=this._cacheRawMeshes[L],U=r._getString(k,t.DataParser.SHARE,"");if(0!==U.length){var j=r._getString(k,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME);0===j.length&&(j=t.DataParser.DEFAULT_NAME);var W=n.getMesh(j,"",U);if(null!==W){var V=this._cacheMeshes[L];V.geometry.shareFrom(W.geometry)}}}if(t.DataParser.ANIMATION in e)for(var z=e[t.DataParser.ANIMATION],G=0,Y=z;G<Y.length;G++){var X=Y[G],H=this._parseAnimation(X);n.addAnimation(H)}if(t.DataParser.DEFAULT_ACTIONS in e)for(var q=this._parseActionData(e[t.DataParser.DEFAULT_ACTIONS],0,null,null),K=0,J=q;K<J.length;K++){var Z=J[K];if(n.addAction(Z,!0),0===Z.type){H=n.getAnimation(Z.name);null!==H&&(n.defaultAnimation=H)}}if(t.DataParser.ACTIONS in e){q=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);for(var Q=0,$=q;Q<$.length;Q++){Z=$[Q];n.addAction(Z,!1)}}for(var tt in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[tt];for(var tt in this._weightBonePoses)delete this._weightBonePoses[tt];for(var tt in this._cacheBones)delete this._cacheBones[tt];for(var tt in this._slotChildActions)delete this._slotChildActions[tt];return n},r.prototype._parseBone=function(e){var i=0;if(i=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getBoneType(e[t.DataParser.TYPE]):r._getNumber(e,t.DataParser.TYPE,0),0===i){var n=this._armature.scale,a=t.BaseObject.borrowObject(t.BoneData);return a.inheritTranslation=r._getBoolean(e,t.DataParser.INHERIT_TRANSLATION,!0),a.inheritRotation=r._getBoolean(e,t.DataParser.INHERIT_ROTATION,!0),a.inheritScale=r._getBoolean(e,t.DataParser.INHERIT_SCALE,!0),a.inheritReflection=r._getBoolean(e,t.DataParser.INHERIT_REFLECTION,!0),a.length=r._getNumber(e,t.DataParser.LENGTH,0)*n,a.alpha=r._getNumber(e,t.DataParser.ALPHA,1),a.name=r._getString(e,t.DataParser.NAME,""),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],a.transform,n),a}var s=t.BaseObject.borrowObject(t.SurfaceData);return s.alpha=r._getNumber(e,t.DataParser.ALPHA,1),s.name=r._getString(e,t.DataParser.NAME,""),s.segmentX=r._getNumber(e,t.DataParser.SEGMENT_X,0),s.segmentY=r._getNumber(e,t.DataParser.SEGMENT_Y,0),this._parseGeometry(e,s.geometry),s},r.prototype._parseIKConstraint=function(e){var i=this._armature.getBone(r._getString(e,t.DataParser.BONE,""));if(null===i)return null;var n=this._armature.getBone(r._getString(e,t.DataParser.TARGET,""));if(null===n)return null;var a=r._getNumber(e,t.DataParser.CHAIN,0),s=t.BaseObject.borrowObject(t.IKConstraintData);return s.scaleEnabled=r._getBoolean(e,t.DataParser.SCALE,!1),s.bendPositive=r._getBoolean(e,t.DataParser.BEND_POSITIVE,!0),s.weight=r._getNumber(e,t.DataParser.WEIGHT,1),s.name=r._getString(e,t.DataParser.NAME,""),s.type=0,s.target=n,a>0&&null!==i.parent?(s.root=i.parent,s.bone=i):(s.root=i,s.bone=null),s},r.prototype._parsePathConstraint=function(e){var i=this._armature.getSlot(r._getString(e,t.DataParser.TARGET,""));if(null===i)return null;var n=this._armature.defaultSkin;if(null===n)return null;var a=n.getDisplay(i.name,r._getString(e,t.DataParser.TARGET_DISPLAY,i.name));if(null===a||!(a instanceof t.PathDisplayData))return null;var s=e[t.DataParser.BONES];if(null===s||0===s.length)return null;var o=t.BaseObject.borrowObject(t.PathConstraintData);o.name=r._getString(e,t.DataParser.NAME,""),o.type=1,o.pathSlot=i,o.pathDisplayData=a,o.target=i.parent,o.positionMode=t.DataParser._getPositionMode(r._getString(e,t.DataParser.POSITION_MODE,"")),o.spacingMode=t.DataParser._getSpacingMode(r._getString(e,t.DataParser.SPACING_MODE,"")),o.rotateMode=t.DataParser._getRotateMode(r._getString(e,t.DataParser.ROTATE_MODE,"")),o.position=r._getNumber(e,t.DataParser.POSITION,0),o.spacing=r._getNumber(e,t.DataParser.SPACING,0),o.rotateOffset=r._getNumber(e,t.DataParser.ROTATE_OFFSET,0),o.rotateMix=r._getNumber(e,t.DataParser.ROTATE_MIX,1),o.translateMix=r._getNumber(e,t.DataParser.TRANSLATE_MIX,1);for(var h=0,l=s;h<l.length;h++){var u=l[h],c=this._armature.getBone(u);null!==c&&(o.AddBone(c),null===o.root&&(o.root=c))}return o},r.prototype._parseSlot=function(e,i){var n=t.BaseObject.borrowObject(t.SlotData);return n.displayIndex=r._getNumber(e,t.DataParser.DISPLAY_INDEX,0),n.zOrder=i,n.zIndex=r._getNumber(e,t.DataParser.Z_INDEX,0),n.alpha=r._getNumber(e,t.DataParser.ALPHA,1),n.name=r._getString(e,t.DataParser.NAME,""),n.parent=this._armature.getBone(r._getString(e,t.DataParser.PARENT,"")),t.DataParser.BLEND_MODE in e&&"string"==typeof e[t.DataParser.BLEND_MODE]?n.blendMode=t.DataParser._getBlendMode(e[t.DataParser.BLEND_MODE]):n.blendMode=r._getNumber(e,t.DataParser.BLEND_MODE,0),t.DataParser.COLOR in e?(n.color=t.SlotData.createColor(),this._parseColorTransform(e[t.DataParser.COLOR],n.color)):n.color=t.SlotData.DEFAULT_COLOR,t.DataParser.ACTIONS in e&&(this._slotChildActions[n.name]=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null)),n},r.prototype._parseSkin=function(e){var i=t.BaseObject.borrowObject(t.SkinData);if(i.name=r._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),t.DataParser.SLOT in e){var n=e[t.DataParser.SLOT];this._skin=i;for(var a=0,s=n;a<s.length;a++){var o=s[a],h=r._getString(o,t.DataParser.NAME,""),l=this._armature.getSlot(h);if(null!==l){if(this._slot=l,t.DataParser.DISPLAY in o)for(var u=o[t.DataParser.DISPLAY],c=0,p=u;c<p.length;c++){var d=p[c];d?i.addDisplay(h,this._parseDisplay(d)):i.addDisplay(h,null)}this._slot=null}}this._skin=null}return i},r.prototype._parseDisplay=function(e){var i=r._getString(e,t.DataParser.NAME,""),n=r._getString(e,t.DataParser.PATH,""),a=0,s=null;switch(a=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getDisplayType(e[t.DataParser.TYPE]):r._getNumber(e,t.DataParser.TYPE,a),a){case 0:var o=s=t.BaseObject.borrowObject(t.ImageDisplayData);o.name=i,o.path=n.length>0?n:i,this._parsePivot(e,o);break;case 1:var h=s=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(h.name=i,h.path=n.length>0?n:i,h.inheritAnimation=!0,t.DataParser.ACTIONS in e)for(var l=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null),u=0,c=l;u<c.length;u++){var p=c[u];h.addAction(p)}else if(this._slot.name in this._slotChildActions){var d=this._skin.getDisplays(this._slot.name);if(null===d?0===this._slot.displayIndex:this._slot.displayIndex===d.length){for(var f=0,_=this._slotChildActions[this._slot.name];f<_.length;f++){p=_[f];h.addAction(p)}delete this._slotChildActions[this._slot.name]}}break;case 2:var g=s=t.BaseObject.borrowObject(t.MeshDisplayData);g.geometry.inheritDeform=r._getBoolean(e,t.DataParser.INHERIT_DEFORM,!0),g.name=i,g.path=n.length>0?n:i,t.DataParser.SHARE in e?(g.geometry.data=this._data,this._cacheRawMeshes.push(e),this._cacheMeshes.push(g)):this._parseMesh(e,g);break;case 3:var m=this._parseBoundingBox(e);if(null!==m){var y=s=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);y.name=i,y.path=n.length>0?n:i,y.boundingBox=m}break;case 4:var v=e[t.DataParser.LENGTHS],T=s=t.BaseObject.borrowObject(t.PathDisplayData);T.closed=r._getBoolean(e,t.DataParser.CLOSED,!1),T.constantSpeed=r._getBoolean(e,t.DataParser.CONSTANT_SPEED,!1),T.name=i,T.path=n.length>0?n:i,T.curveLengths.length=v.length;for(var x=0,b=v.length;x<b;++x)T.curveLengths[x]=v[x];this._parsePath(e,T)}return null!==s&&t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],s.transform,this._armature.scale),s},r.prototype._parsePath=function(t,e){this._parseGeometry(t,e.geometry)},r.prototype._parsePivot=function(e,i){if(t.DataParser.PIVOT in e){var n=e[t.DataParser.PIVOT];i.pivot.x=r._getNumber(n,t.DataParser.X,0),i.pivot.y=r._getNumber(n,t.DataParser.Y,0)}else i.pivot.x=.5,i.pivot.y=.5},r.prototype._parseMesh=function(e,i){if(this._parseGeometry(e,i.geometry),t.DataParser.WEIGHTS in e){var r=e[t.DataParser.SLOT_POSE],n=e[t.DataParser.BONE_POSE],a=this._skin.name+"_"+this._slot.name+"_"+i.name;this._weightSlotPose[a]=r,this._weightBonePoses[a]=n}},r.prototype._parseBoundingBox=function(e){var i=null,n=0;switch(n=t.DataParser.SUB_TYPE in e&&"string"==typeof e[t.DataParser.SUB_TYPE]?t.DataParser._getBoundingBoxType(e[t.DataParser.SUB_TYPE]):r._getNumber(e,t.DataParser.SUB_TYPE,n),n){case 0:i=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:i=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:i=this._parsePolygonBoundingBox(e)}return null!==i&&(i.color=r._getNumber(e,t.DataParser.COLOR,0),0!==i.type&&1!==i.type||(i.width=r._getNumber(e,t.DataParser.WIDTH,0),i.height=r._getNumber(e,t.DataParser.HEIGHT,0))),i},r.prototype._parsePolygonBoundingBox=function(e){var i=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);if(t.DataParser.VERTICES in e){var r=this._armature.scale,n=e[t.DataParser.VERTICES],a=i.vertices;a.length=n.length;for(var s=0,o=n.length;s<o;s+=2){var h=n[s]*r,l=n[s+1]*r;a[s]=h,a[s+1]=l,0===s?(i.x=h,i.y=l,i.width=h,i.height=l):(h<i.x?i.x=h:h>i.width&&(i.width=h),l<i.y?i.y=l:l>i.height&&(i.height=l))}i.width-=i.x,i.height-=i.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return i},r.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);if(i.blendType=t.DataParser._getAnimationBlendType(r._getString(e,t.DataParser.BLEND_TYPE,"")),i.frameCount=r._getNumber(e,t.DataParser.DURATION,0),i.playTimes=r._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=r._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=r._getNumber(e,t.DataParser.SCALE,1),i.name=r._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),i.frameIntOffset=this._frameIntArray.length,i.frameFloatOffset=this._frameFloatArray.length,i.frameOffset=this._frameArray.length,this._animation=i,t.DataParser.FRAME in e){var n=e[t.DataParser.FRAME],a=n.length;if(a>0)for(var s=0,o=0;s<a;++s){var h=n[s];this._parseActionDataInFrame(h,o,null,null),o+=r._getNumber(h,t.DataParser.DURATION,1)}}if(t.DataParser.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[t.DataParser.Z_ORDER],null,t.DataParser.FRAME,1,0,0,this._parseZOrderFrame)),t.DataParser.BONE in e)for(var l=e[t.DataParser.BONE],u=0,c=l;u<c.length;u++){var p=c[u];this._parseBoneTimeline(p)}if(t.DataParser.SLOT in e){l=e[t.DataParser.SLOT];for(var d=0,f=l;d<f.length;d++){p=f[d];this._parseSlotTimeline(p)}}if(t.DataParser.FFD in e){l=e[t.DataParser.FFD];for(var _=0,g=l;_<g.length;_++){p=g[_];var m=r._getString(p,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME),y=r._getString(p,t.DataParser.SLOT,""),v=r._getString(p,t.DataParser.NAME,"");if(0===m.length&&(m=t.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(y),this._mesh=this._armature.getMesh(m,y,v),null!==this._slot&&null!==this._mesh){var T=this._parseTimeline(p,null,t.DataParser.FRAME,22,2,0,this._parseSlotDeformFrame);null!==T&&this._animation.addSlotTimeline(y,T),this._slot=null,this._mesh=null}}}if(t.DataParser.IK in e){l=e[t.DataParser.IK];for(var x=0,b=l;x<b.length;x++){p=b[x];var A=r._getString(p,t.DataParser.NAME,""),S=this._armature.getConstraint(A);if(null!==S){T=this._parseTimeline(p,null,t.DataParser.FRAME,30,1,2,this._parseIKConstraintFrame);null!==T&&this._animation.addConstraintTimeline(A,T)}}}if(this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,0,0,this._parseActionFrame),this._actionFrames.length=0),t.DataParser.TIMELINE in e){l=e[t.DataParser.TIMELINE];for(var w=0,P=l;w<P.length;w++){p=P[w];var E=r._getNumber(p,t.DataParser.TYPE,0),D=r._getString(p,t.DataParser.NAME,"");T=null;switch(E){case 0:break;case 20:case 23:case 60:case 24:case 40:case 41:if(20===E?(this._frameValueType=0,this._frameValueScale=1):(this._frameValueType=1,this._frameValueScale=23===E?1:40===E||41===E?1e4:100),this._frameDefaultValue=60===E||24===E||41===E?1:0,40===E&&0!==i.blendType){T=t.BaseObject.borrowObject(t.AnimationTimelineData);var C=T;C.x=r._getNumber(p,t.DataParser.X,0),C.y=r._getNumber(p,t.DataParser.Y,0)}T=this._parseTimeline(p,null,t.DataParser.FRAME,E,this._frameValueType,1,this._parseSingleValueFrame,T);break;case 11:case 12:case 13:case 30:case 42:30===E||42===E?(this._frameValueType=1,this._frameValueScale=42===E?1e4:100):(this._frameValueScale=12===E?t.Transform.DEG_RAD:1,this._frameValueType=2),this._frameDefaultValue=13===E||30===E?1:0,T=this._parseTimeline(p,null,t.DataParser.FRAME,E,this._frameValueType,2,this._parseDoubleValueFrame);break;case 1:break;case 50:var O=this._armature.getBone(D);if(null===O)continue;this._geometry=O.geometry,T=this._parseTimeline(p,null,t.DataParser.FRAME,E,2,0,this._parseDeformFrame),this._geometry=null;break;case 22:for(var m in this._geometry=null,this._armature.skins){var M=this._armature.skins[m];for(var I in M.displays)for(var R=M.displays[I],N=0,B=R;N<B.length;N++){var L=B[N];if(null!==L&&L.name===D){this._geometry=L.geometry;break}}}if(null===this._geometry)continue;T=this._parseTimeline(p,null,t.DataParser.FRAME,E,2,0,this._parseDeformFrame),this._geometry=null;break;case 21:T=this._parseTimeline(p,null,t.DataParser.FRAME,E,1,1,this._parseSlotColorFrame)}if(null!==T)switch(E){case 0:case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(D,T);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(D,T);break;case 30:this._animation.addConstraintTimeline(D,T);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(D,T)}}}return this._animation=null,i},r.prototype._parseTimeline=function(e,n,a,s,o,h,l,u){if(void 0===u&&(u=null),null!==e&&a.length>0&&a in e&&(n=e[a]),null===n)return null;var c=n.length;if(0===c)return null;var p=this._frameIntArray.length,d=this._frameFloatArray.length,f=this._timelineArray.length;switch(null===u&&(u=t.BaseObject.borrowObject(t.TimelineData)),u.type=s,u.offset=f,this._frameValueType=o,this._timeline=u,this._timelineArray.length+=5+c,null!==e?(this._timelineArray[f+0]=Math.round(100*r._getNumber(e,t.DataParser.SCALE,1)),this._timelineArray[f+1]=Math.round(100*r._getNumber(e,t.DataParser.OFFSET,0))):(this._timelineArray[f+0]=100,this._timelineArray[f+1]=0),this._timelineArray[f+2]=c,this._timelineArray[f+3]=h,this._frameValueType){case 0:this._timelineArray[f+4]=0;break;case 1:this._timelineArray[f+4]=p-this._animation.frameIntOffset;break;case 2:this._timelineArray[f+4]=d-this._animation.frameFloatOffset}if(1===c)u.frameIndicesOffset=-1,this._timelineArray[f+5+0]=l.call(this,n[0],0,0)-this._animation.frameOffset;else{var _=this._animation.frameCount+1,g=this._data.frameIndices,m=g.length;g.length+=_,u.frameIndicesOffset=m;for(var y=0,v=0,T=0,x=0;y<_;++y){if(T+x<=y&&v<c){var b=n[v];T=y,x=v===c-1?this._animation.frameCount-T:b instanceof i?this._actionFrames[v+1].frameStart-T:r._getNumber(b,t.DataParser.DURATION,1),this._timelineArray[f+5+v]=l.call(this,b,T,x)-this._animation.frameOffset,v++}g[m+y]=v-1}}return this._timeline=null,u},r.prototype._parseBoneTimeline=function(e){var i=this._armature.getBone(r._getString(e,t.DataParser.NAME,""));if(null!==i){if(this._bone=i,this._slot=this._armature.getSlot(this._bone.name),t.DataParser.TRANSLATE_FRAME in e){this._frameDefaultValue=0,this._frameValueScale=1;var n=this._parseTimeline(e,null,t.DataParser.TRANSLATE_FRAME,11,2,2,this._parseDoubleValueFrame);null!==n&&this._animation.addBoneTimeline(i.name,n)}if(t.DataParser.ROTATE_FRAME in e){this._frameDefaultValue=0,this._frameValueScale=1;n=this._parseTimeline(e,null,t.DataParser.ROTATE_FRAME,12,2,2,this._parseBoneRotateFrame);null!==n&&this._animation.addBoneTimeline(i.name,n)}if(t.DataParser.SCALE_FRAME in e){this._frameDefaultValue=1,this._frameValueScale=1;n=this._parseTimeline(e,null,t.DataParser.SCALE_FRAME,13,2,2,this._parseBoneScaleFrame);null!==n&&this._animation.addBoneTimeline(i.name,n)}if(t.DataParser.FRAME in e){n=this._parseTimeline(e,null,t.DataParser.FRAME,10,2,6,this._parseBoneAllFrame);null!==n&&this._animation.addBoneTimeline(i.name,n)}this._bone=null,this._slot=null}},r.prototype._parseSlotTimeline=function(e){var i=this._armature.getSlot(r._getString(e,t.DataParser.NAME,""));if(null!==i){var n=null,a=null;this._slot=i,n=t.DataParser.DISPLAY_FRAME in e?this._parseTimeline(e,null,t.DataParser.DISPLAY_FRAME,20,0,0,this._parseSlotDisplayFrame):this._parseTimeline(e,null,t.DataParser.FRAME,20,0,0,this._parseSlotDisplayFrame),a=t.DataParser.COLOR_FRAME in e?this._parseTimeline(e,null,t.DataParser.COLOR_FRAME,21,1,1,this._parseSlotColorFrame):this._parseTimeline(e,null,t.DataParser.FRAME,21,1,1,this._parseSlotColorFrame),null!==n&&this._animation.addSlotTimeline(i.name,n),null!==a&&this._animation.addSlotTimeline(i.name,a),this._slot=null}},r.prototype._parseFrame=function(t,e,i){var r=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[r+0]=e,r},r.prototype._parseTweenFrame=function(e,i,n){var a=this._parseFrame(e,i,n);if(n>0)if(t.DataParser.CURVE in e){var s=n+1;this._helpArray.length=s;var o=this._samplingEasingCurve(e[t.DataParser.CURVE],this._helpArray);this._frameArray.length+=2+this._helpArray.length,this._frameArray[a+1]=2,this._frameArray[a+2]=o?s:-s;for(var h=0;h<s;++h)this._frameArray[a+3+h]=Math.round(1e4*this._helpArray[h])}else{var l=-2,u=l;t.DataParser.TWEEN_EASING in e&&(u=r._getNumber(e,t.DataParser.TWEEN_EASING,l)),u===l?(this._frameArray.length+=1,this._frameArray[a+1]=0):0===u?(this._frameArray.length+=1,this._frameArray[a+1]=1):u<0?(this._frameArray.length+=2,this._frameArray[a+1]=3,this._frameArray[a+2]=Math.round(100*-u)):u<=1?(this._frameArray.length+=2,this._frameArray[a+1]=4,this._frameArray[a+2]=Math.round(100*u)):(this._frameArray.length+=2,this._frameArray[a+1]=5,this._frameArray[a+2]=Math.round(100*u-100))}else this._frameArray.length+=1,this._frameArray[a+1]=0;return a},r.prototype._parseSingleValueFrame=function(e,i,n){var a=0;switch(this._frameValueType){case 0:a=this._parseFrame(e,i,n),this._frameArray.length+=1,this._frameArray[a+1]=r._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue);break;case 1:a=this._parseTweenFrame(e,i,n);var s=this._frameIntArray.length;this._frameIntArray.length+=1,this._frameIntArray[s]=Math.round(r._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale);break;case 2:a=this._parseTweenFrame(e,i,n);s=this._frameFloatArray.length;this._frameFloatArray.length+=1,this._frameFloatArray[s]=r._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale}return a},r.prototype._parseDoubleValueFrame=function(e,i,n){var a=0;switch(this._frameValueType){case 0:a=this._parseFrame(e,i,n),this._frameArray.length+=2,this._frameArray[a+1]=r._getNumber(e,t.DataParser.X,this._frameDefaultValue),this._frameArray[a+2]=r._getNumber(e,t.DataParser.Y,this._frameDefaultValue);break;case 1:a=this._parseTweenFrame(e,i,n);var s=this._frameIntArray.length;this._frameIntArray.length+=2,this._frameIntArray[s]=Math.round(r._getNumber(e,t.DataParser.X,this._frameDefaultValue)*this._frameValueScale),this._frameIntArray[s+1]=Math.round(r._getNumber(e,t.DataParser.Y,this._frameDefaultValue)*this._frameValueScale);break;case 2:a=this._parseTweenFrame(e,i,n);s=this._frameFloatArray.length;this._frameFloatArray.length+=2,this._frameFloatArray[s]=r._getNumber(e,t.DataParser.X,this._frameDefaultValue)*this._frameValueScale,this._frameFloatArray[s+1]=r._getNumber(e,t.DataParser.Y,this._frameDefaultValue)*this._frameValueScale}return a},r.prototype._parseActionFrame=function(t,e,i){var r=this._frameArray.length,n=t.actions.length;this._frameArray.length+=2+n,this._frameArray[r+0]=e,this._frameArray[r+0+1]=n;for(var a=0;a<n;++a)this._frameArray[r+0+2+a]=t.actions[a];return r},r.prototype._parseZOrderFrame=function(e,i,r){var n=this._parseFrame(e,i,r);if(t.DataParser.Z_ORDER in e){var a=e[t.DataParser.Z_ORDER];if(a.length>0){for(var s=this._armature.sortedSlots.length,o=new Array(s-a.length/2),h=new Array(s),l=0;l<o.length;++l)o[l]=0;for(var u=0;u<s;++u)h[u]=-1;for(var c=0,p=0,d=0,f=a.length;d<f;d+=2){for(var _=a[d],g=a[d+1];c!==_;)o[p++]=c++;var m=c+g;h[m]=c++}for(;c<s;)o[p++]=c++;this._frameArray.length+=1+s,this._frameArray[n+1]=s;for(var y=s;y--;)-1===h[y]?this._frameArray[n+2+y]=o[--p]||0:this._frameArray[n+2+y]=h[y]||0;return n}}return this._frameArray.length+=1,this._frameArray[n+1]=0,n},r.prototype._parseBoneAllFrame=function(e,i,n){this._helpTransform.identity(),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],this._helpTransform,1);var a=this._helpTransform.rotation;0!==i&&(0===this._prevClockwise?a=this._prevRotation+t.Transform.normalizeRadian(a-this._prevRotation):((this._prevClockwise>0?a>=this._prevRotation:a<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),a=this._prevRotation+a-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=r._getNumber(e,t.DataParser.TWEEN_ROTATE,0),this._prevRotation=a;var s=this._parseTweenFrame(e,i,n),o=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[o++]=this._helpTransform.x,this._frameFloatArray[o++]=this._helpTransform.y,this._frameFloatArray[o++]=a,this._frameFloatArray[o++]=this._helpTransform.skew,this._frameFloatArray[o++]=this._helpTransform.scaleX,this._frameFloatArray[o++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,i,this._bone,this._slot),s},r.prototype._parseBoneTranslateFrame=function(e,i,n){var a=this._parseTweenFrame(e,i,n),s=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[s++]=r._getNumber(e,t.DataParser.X,0),this._frameFloatArray[s++]=r._getNumber(e,t.DataParser.Y,0),a},r.prototype._parseBoneRotateFrame=function(e,i,n){var a=r._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD;0!==i&&(0===this._prevClockwise?a=this._prevRotation+t.Transform.normalizeRadian(a-this._prevRotation):((this._prevClockwise>0?a>=this._prevRotation:a<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),a=this._prevRotation+a-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=r._getNumber(e,t.DataParser.CLOCK_WISE,0),this._prevRotation=a;var s=this._parseTweenFrame(e,i,n),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=a,this._frameFloatArray[o++]=r._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD,s},
r.prototype._parseBoneScaleFrame=function(e,i,n){var a=this._parseTweenFrame(e,i,n),s=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[s++]=r._getNumber(e,t.DataParser.X,1),this._frameFloatArray[s++]=r._getNumber(e,t.DataParser.Y,1),a},r.prototype._parseSlotDisplayFrame=function(e,i,n){var a=this._parseFrame(e,i,n);return this._frameArray.length+=1,t.DataParser.VALUE in e?this._frameArray[a+1]=r._getNumber(e,t.DataParser.VALUE,0):this._frameArray[a+1]=r._getNumber(e,t.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(e,i,this._slot.parent,this._slot),a},r.prototype._parseSlotColorFrame=function(e,i,r){var n=this._parseTweenFrame(e,i,r),a=-1;if(t.DataParser.VALUE in e||t.DataParser.COLOR in e){var s=t.DataParser.VALUE in e?e[t.DataParser.VALUE]:e[t.DataParser.COLOR];for(var o in s){this._parseColorTransform(s,this._helpColorTransform),a=this._colorArray.length,this._colorArray.length+=8,this._colorArray[a++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._colorArray[a++]=Math.round(100*this._helpColorTransform.redMultiplier),this._colorArray[a++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._colorArray[a++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._colorArray[a++]=Math.round(this._helpColorTransform.alphaOffset),this._colorArray[a++]=Math.round(this._helpColorTransform.redOffset),this._colorArray[a++]=Math.round(this._helpColorTransform.greenOffset),this._colorArray[a++]=Math.round(this._helpColorTransform.blueOffset),a-=8;break}}a<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=a=this._colorArray.length,this._colorArray.length+=8,this._colorArray[a++]=100,this._colorArray[a++]=100,this._colorArray[a++]=100,this._colorArray[a++]=100,this._colorArray[a++]=0,this._colorArray[a++]=0,this._colorArray[a++]=0,this._colorArray[a++]=0),a=this._defaultColorOffset);var h=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[h]=a,n},r.prototype._parseSlotDeformFrame=function(e,i,n){var a=this._frameFloatArray.length,s=this._parseTweenFrame(e,i,n),o=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:null,h=r._getNumber(e,t.DataParser.OFFSET,0),l=this._intArray[this._mesh.geometry.offset+0],u=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,c=this._mesh.geometry.weight,p=0,d=0,f=0,_=0;if(null!==c){var g=this._weightSlotPose[u];this._helpMatrixA.copyFromArray(g,0),this._frameFloatArray.length+=2*c.count,f=c.offset+2+c.bones.length}else this._frameFloatArray.length+=2*l;for(var m=0;m<2*l;m+=2)if(null===o?(p=0,d=0):(p=m<h||m-h>=o.length?0:o[m-h],d=m+1<h||m+1-h>=o.length?0:o[m+1-h]),null!==c){var y=this._weightBonePoses[u],v=this._intArray[f++];this._helpMatrixA.transformPoint(p,d,this._helpPoint,!0),p=this._helpPoint.x,d=this._helpPoint.y;for(var T=0;T<v;++T){var x=this._intArray[f++];this._helpMatrixB.copyFromArray(y,7*x+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(p,d,this._helpPoint,!0),this._frameFloatArray[a+_++]=this._helpPoint.x,this._frameFloatArray[a+_++]=this._helpPoint.y}}else this._frameFloatArray[a+m]=p,this._frameFloatArray[a+m+1]=d;if(0===i){var b=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[b+0]=this._mesh.geometry.offset,this._frameIntArray[b+1]=this._frameFloatArray.length-a,this._frameIntArray[b+2]=this._frameFloatArray.length-a,this._frameIntArray[b+3]=0,this._frameIntArray[b+4]=a-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=b-this._animation.frameIntOffset}return s},r.prototype._parseIKConstraintFrame=function(e,i,n){var a=this._parseTweenFrame(e,i,n),s=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[s++]=r._getBoolean(e,t.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[s++]=Math.round(100*r._getNumber(e,t.DataParser.WEIGHT,1)),a},r.prototype._parseActionData=function(e,i,n,a){var s=new Array;if("string"==typeof e){var o=t.BaseObject.borrowObject(t.ActionData);o.type=i,o.name=e,o.bone=n,o.slot=a,s.push(o)}else if(e instanceof Array)for(var h=0,l=e;h<l.length;h++){var u=l[h];o=t.BaseObject.borrowObject(t.ActionData);if(t.DataParser.GOTO_AND_PLAY in u?(o.type=0,o.name=r._getString(u,t.DataParser.GOTO_AND_PLAY,"")):(t.DataParser.TYPE in u&&"string"==typeof u[t.DataParser.TYPE]?o.type=t.DataParser._getActionType(u[t.DataParser.TYPE]):o.type=r._getNumber(u,t.DataParser.TYPE,i),o.name=r._getString(u,t.DataParser.NAME,"")),t.DataParser.BONE in u){var c=r._getString(u,t.DataParser.BONE,"");o.bone=this._armature.getBone(c)}else o.bone=n;if(t.DataParser.SLOT in u){var p=r._getString(u,t.DataParser.SLOT,"");o.slot=this._armature.getSlot(p)}else o.slot=a;var d=null;if(t.DataParser.INTS in u){null===d&&(d=t.BaseObject.borrowObject(t.UserData));for(var f=u[t.DataParser.INTS],_=0,g=f;_<g.length;_++){var m=g[_];d.addInt(m)}}if(t.DataParser.FLOATS in u){null===d&&(d=t.BaseObject.borrowObject(t.UserData));for(var y=u[t.DataParser.FLOATS],v=0,T=y;v<T.length;v++){m=T[v];d.addFloat(m)}}if(t.DataParser.STRINGS in u){null===d&&(d=t.BaseObject.borrowObject(t.UserData));for(var x=u[t.DataParser.STRINGS],b=0,A=x;b<A.length;b++){m=A[b];d.addString(m)}}o.data=d,s.push(o)}return s},r.prototype._parseDeformFrame=function(e,i,n){var a=this._frameFloatArray.length,s=this._parseTweenFrame(e,i,n),o=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:t.DataParser.VALUE in e?e[t.DataParser.VALUE]:null,h=r._getNumber(e,t.DataParser.OFFSET,0),l=this._intArray[this._geometry.offset+0],u=this._geometry.weight,c=0,p=0;if(null!==u);else{this._frameFloatArray.length+=2*l;for(var d=0;d<2*l;d+=2)null!==o?(c=d<h||d-h>=o.length?0:o[d-h],p=d+1<h||d+1-h>=o.length?0:o[d+1-h]):(c=0,p=0),this._frameFloatArray[a+d]=c,this._frameFloatArray[a+d+1]=p}if(0===i){var f=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[f+0]=this._geometry.offset,this._frameIntArray[f+1]=this._frameFloatArray.length-a,this._frameIntArray[f+2]=this._frameFloatArray.length-a,this._frameIntArray[f+3]=0,this._frameIntArray[f+4]=a-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=f-this._animation.frameIntOffset}return s},r.prototype._parseTransform=function(e,i,n){i.x=r._getNumber(e,t.DataParser.X,0)*n,i.y=r._getNumber(e,t.DataParser.Y,0)*n,t.DataParser.ROTATE in e||t.DataParser.SKEW in e?(i.rotation=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD)):(t.DataParser.SKEW_X in e||t.DataParser.SKEW_Y in e)&&(i.rotation=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.SKEW_Y,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.SKEW_X,0)*t.Transform.DEG_RAD)-i.rotation),i.scaleX=r._getNumber(e,t.DataParser.SCALE_X,1),i.scaleY=r._getNumber(e,t.DataParser.SCALE_Y,1)},r.prototype._parseColorTransform=function(e,i){i.alphaMultiplier=.01*r._getNumber(e,t.DataParser.ALPHA_MULTIPLIER,100),i.redMultiplier=.01*r._getNumber(e,t.DataParser.RED_MULTIPLIER,100),i.greenMultiplier=.01*r._getNumber(e,t.DataParser.GREEN_MULTIPLIER,100),i.blueMultiplier=.01*r._getNumber(e,t.DataParser.BLUE_MULTIPLIER,100),i.alphaOffset=r._getNumber(e,t.DataParser.ALPHA_OFFSET,0),i.redOffset=r._getNumber(e,t.DataParser.RED_OFFSET,0),i.greenOffset=r._getNumber(e,t.DataParser.GREEN_OFFSET,0),i.blueOffset=r._getNumber(e,t.DataParser.BLUE_OFFSET,0)},r.prototype._parseGeometry=function(e,i){var r=e[t.DataParser.VERTICES],n=Math.floor(r.length/2),a=0,s=this._intArray.length,o=this._floatArray.length;i.offset=s,i.data=this._data,this._intArray.length+=4,this._intArray[s+0]=n,this._intArray[s+2]=o,this._intArray[s+3]=-1,this._floatArray.length+=2*n;for(var h=0,l=2*n;h<l;++h)this._floatArray[o+h]=r[h];if(t.DataParser.TRIANGLES in e){var u=e[t.DataParser.TRIANGLES];a=Math.floor(u.length/3),this._intArray.length+=3*a;for(h=0,l=3*a;h<l;++h)this._intArray[s+4+h]=u[h]}if(this._intArray[s+1]=a,t.DataParser.UVS in e){var c=e[t.DataParser.UVS],p=o+2*n;this._floatArray.length+=2*n;for(h=0,l=2*n;h<l;++h)this._floatArray[p+h]=c[h]}if(t.DataParser.WEIGHTS in e){var d=e[t.DataParser.WEIGHTS],f=Math.floor(d.length-n)/2,_=this._intArray.length,g=this._floatArray.length,m=0,y=this._armature.sortedBones,v=t.BaseObject.borrowObject(t.WeightData);if(v.count=f,v.offset=_,this._intArray.length+=2+m+n+f,this._intArray[_+1]=g,t.DataParser.BONE_POSE in e){var T=e[t.DataParser.SLOT_POSE],x=e[t.DataParser.BONE_POSE],b=new Array;m=Math.floor(x.length/7),b.length=m;for(h=0;h<m;++h){var A=x[7*h],S=this._rawBones[A];v.addBone(S),b[h]=A,this._intArray[_+2+h]=y.indexOf(S)}this._floatArray.length+=3*f,this._helpMatrixA.copyFromArray(T,0);h=0;for(var w=0,P=_+2+m,E=g;h<n;++h){var D=2*h,C=this._intArray[P++]=d[w++],O=this._floatArray[o+D],M=this._floatArray[o+D+1];this._helpMatrixA.transformPoint(O,M,this._helpPoint),O=this._helpPoint.x,M=this._helpPoint.y;for(var I=0;I<C;++I){A=d[w++];var R=b.indexOf(A);this._helpMatrixB.copyFromArray(x,7*R+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(O,M,this._helpPoint),this._intArray[P++]=R,this._floatArray[E++]=d[w++],this._floatArray[E++]=this._helpPoint.x,this._floatArray[E++]=this._helpPoint.y}}}else{var N=e[t.DataParser.BONES];m=N.length;for(h=0;h<m;h++){A=N[h],S=this._rawBones[A];v.addBone(S),this._intArray[_+2+h]=y.indexOf(S)}this._floatArray.length+=3*f;h=0,w=0,E=0,P=_+2+m;for(var B=g;h<f;h++){C=d[w++];this._intArray[P++]=C;for(I=0;I<C;I++){R=d[w++];var L=d[w++];O=r[E++],M=r[E++];this._intArray[P++]=N.indexOf(R),this._floatArray[B++]=L,this._floatArray[B++]=O,this._floatArray[B++]=M}}}i.weight=v}},r.prototype._parseArray=function(t){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0,this._colorArray.length=0},r.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0),this._timelineArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._colorArray.push(0);for(var t=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,e=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,r=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,n=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,a=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,s=this._colorArray.length*Int16Array.BYTES_PER_ELEMENT,o=t+e+i+r+n+a+s,h=new ArrayBuffer(o),l=new Int16Array(h,0,this._intArray.length),u=new Float32Array(h,t,this._floatArray.length),c=new Int16Array(h,t+e,this._frameIntArray.length),p=new Float32Array(h,t+e+i,this._frameFloatArray.length),d=new Int16Array(h,t+e+i+r,this._frameArray.length),f=new Uint16Array(h,t+e+i+r+n,this._timelineArray.length),_=new Int16Array(h,t+e+i+r+n+a,this._colorArray.length),g=0,m=this._intArray.length;g<m;++g)l[g]=this._intArray[g];for(g=0,m=this._floatArray.length;g<m;++g)u[g]=this._floatArray[g];for(g=0,m=this._frameIntArray.length;g<m;++g)c[g]=this._frameIntArray[g];for(g=0,m=this._frameFloatArray.length;g<m;++g)p[g]=this._frameFloatArray[g];for(g=0,m=this._frameArray.length;g<m;++g)d[g]=this._frameArray[g];for(g=0,m=this._timelineArray.length;g<m;++g)f[g]=this._timelineArray[g];for(g=0,m=this._colorArray.length;g<m;++g)_[g]=this._colorArray[g];this._data.binary=h,this._data.intArray=l,this._data.floatArray=u,this._data.frameIntArray=c,this._data.frameFloatArray=p,this._data.frameArray=d,this._data.timelineArray=f,this._data.colorArray=_,this._defaultColorOffset=-1},r.prototype.parseDragonBonesData=function(e,i){void 0===i&&(i=1),console.assert(null!=e,"Data error.");var n=r._getString(e,t.DataParser.VERSION,""),a=r._getString(e,t.DataParser.COMPATIBLE_VERSION,"");if(t.DataParser.DATA_VERSIONS.indexOf(n)>=0||t.DataParser.DATA_VERSIONS.indexOf(a)>=0){var s=t.BaseObject.borrowObject(t.DragonBonesData);if(s.version=n,s.name=r._getString(e,t.DataParser.NAME,""),s.frameRate=r._getNumber(e,t.DataParser.FRAME_RATE,24),0===s.frameRate&&(s.frameRate=24),t.DataParser.ARMATURE in e){this._data=s,this._parseArray(e);for(var o=e[t.DataParser.ARMATURE],h=0,l=o;h<l.length;h++){var u=l[h];s.addArmature(this._parseArmature(u,i))}this._data.binary||this._modifyArray(),t.DataParser.STAGE in e?s.stage=s.getArmature(r._getString(e,t.DataParser.STAGE,"")):s.armatureNames.length>0&&(s.stage=s.getArmature(s.armatureNames[0])),this._data=null}return t.DataParser.TEXTURE_ATLAS in e&&(this._rawTextureAtlases=e[t.DataParser.TEXTURE_ATLAS]),s}return console.assert(!1,"Nonsupport data version: "+n+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},r.prototype.parseTextureAtlasData=function(e,i,n){if(void 0===n&&(n=1),console.assert(void 0!==e),null===e){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var a=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(a,i,n),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(i.width=r._getNumber(e,t.DataParser.WIDTH,0),i.height=r._getNumber(e,t.DataParser.HEIGHT,0),i.scale=1===n?1/r._getNumber(e,t.DataParser.SCALE,1):n,i.name=r._getString(e,t.DataParser.NAME,""),i.imagePath=r._getString(e,t.DataParser.IMAGE_PATH,""),t.DataParser.SUB_TEXTURE in e)for(var s=e[t.DataParser.SUB_TEXTURE],o=0,h=s.length;o<h;++o){var l=s[o],u=r._getNumber(l,t.DataParser.FRAME_WIDTH,-1),c=r._getNumber(l,t.DataParser.FRAME_HEIGHT,-1),p=i.createTexture();p.rotated=r._getBoolean(l,t.DataParser.ROTATED,!1),p.name=r._getString(l,t.DataParser.NAME,""),p.region.x=r._getNumber(l,t.DataParser.X,0),p.region.y=r._getNumber(l,t.DataParser.Y,0),p.region.width=r._getNumber(l,t.DataParser.WIDTH,0),p.region.height=r._getNumber(l,t.DataParser.HEIGHT,0),u>0&&c>0&&(p.frame=t.TextureData.createRectangle(),p.frame.x=r._getNumber(l,t.DataParser.FRAME_X,0),p.frame.y=r._getNumber(l,t.DataParser.FRAME_Y,0),p.frame.width=u,p.frame.height=c),i.addTexture(p)}return!0},r.getInstance=function(){return null===r._objectDataParserInstance&&(r._objectDataParserInstance=new r),r._objectDataParserInstance},r._objectDataParserInstance=null,r}(t.DataParser);t.ObjectDataParser=e;var i=function(){function t(){this.frameStart=0,this.actions=[]}return t}();t.ActionFrame=i}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype._inRange=function(t,e,i){return e<=t&&t<=i},i.prototype._decodeUTF8=function(t){for(var e,i=-1,r=-1,n=65533,a=0,s="",o=0,h=0,l=0,u=0;t.length>a;){var c=t[a++];if(c===i)e=0!==h?n:r;else if(0===h)this._inRange(c,0,127)?e=c:(this._inRange(c,194,223)?(h=1,u=128,o=c-192):this._inRange(c,224,239)?(h=2,u=2048,o=c-224):this._inRange(c,240,244)&&(h=3,u=65536,o=c-240),o*=Math.pow(64,h),e=null);else if(this._inRange(c,128,191))if(l+=1,o+=(c-128)*Math.pow(64,h-l),l!==h)e=null;else{var p=o,d=u;o=0,h=0,l=0,u=0,e=this._inRange(p,d,1114111)&&!this._inRange(p,55296,57343)?p:c}else o=0,h=0,l=0,u=0,a--,e=c;null!==e&&e!==r&&(e<=65535?e>0&&(s+=String.fromCharCode(e)):(e-=65536,s+=String.fromCharCode(55296+(e>>10&1023)),s+=String.fromCharCode(56320+(1023&e))))}return s},i.prototype._parseBinaryTimeline=function(e,i,r){void 0===r&&(r=null);var n=null!==r?r:t.BaseObject.borrowObject(t.TimelineData);n.type=e,n.offset=i,this._timeline=n;var a=this._timelineArrayBuffer[n.offset+2];if(1===a)n.frameIndicesOffset=-1;else{var s=0,o=this._animation.frameCount+1,h=this._data.frameIndices;s=h.length,h.length+=o,n.frameIndicesOffset=s;for(var l=0,u=0,c=0,p=0;l<o;++l)c+p<=l&&u<a&&(c=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+u]],p=u===a-1?this._animation.frameCount-c:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+u+1]]-c,u++),h[s+l]=u-1}return this._timeline=null,n},i.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);i.blendType=t.DataParser._getAnimationBlendType(t.ObjectDataParser._getString(e,t.DataParser.BLEND_TYPE,"")),i.frameCount=t.ObjectDataParser._getNumber(e,t.DataParser.DURATION,0),i.playTimes=t.ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=t.ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=t.ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),i.name=t.ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME);var r=e[t.DataParser.OFFSET];if(i.frameIntOffset=r[0],i.frameFloatOffset=r[1],i.frameOffset=r[2],this._animation=i,t.DataParser.ACTION in e&&(i.actionTimeline=this._parseBinaryTimeline(0,e[t.DataParser.ACTION])),t.DataParser.Z_ORDER in e&&(i.zOrderTimeline=this._parseBinaryTimeline(1,e[t.DataParser.Z_ORDER])),t.DataParser.BONE in e){var n=e[t.DataParser.BONE];for(var a in n){var s=n[a],o=this._armature.getBone(a);if(null!==o)for(var h=0,l=s.length;h<l;h+=2){var u=s[h],c=s[h+1],p=this._parseBinaryTimeline(u,c);this._animation.addBoneTimeline(o.name,p)}}}if(t.DataParser.SLOT in e){n=e[t.DataParser.SLOT];for(var a in n){s=n[a];var d=this._armature.getSlot(a);if(null!==d)for(h=0,l=s.length;h<l;h+=2){u=s[h],c=s[h+1],p=this._parseBinaryTimeline(u,c);this._animation.addSlotTimeline(d.name,p)}}}if(t.DataParser.CONSTRAINT in e){n=e[t.DataParser.CONSTRAINT];for(var a in n){s=n[a];var f=this._armature.getConstraint(a);if(null!==f)for(h=0,l=s.length;h<l;h+=2){u=s[h],c=s[h+1],p=this._parseBinaryTimeline(u,c);this._animation.addConstraintTimeline(f.name,p)}}}if(t.DataParser.TIMELINE in e){s=e[t.DataParser.TIMELINE];for(var _=0,g=s;_<g.length;_++){var m=g[_];c=t.ObjectDataParser._getNumber(m,t.DataParser.OFFSET,0);if(c>=0){u=t.ObjectDataParser._getNumber(m,t.DataParser.TYPE,0);var y=t.ObjectDataParser._getString(m,t.DataParser.NAME,"");p=null;if(40===u&&0!==i.blendType){p=t.BaseObject.borrowObject(t.AnimationTimelineData);var v=p;v.x=t.ObjectDataParser._getNumber(m,t.DataParser.X,0),v.y=t.ObjectDataParser._getNumber(m,t.DataParser.Y,0)}switch(p=this._parseBinaryTimeline(u,c,p),u){case 0:case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(y,p);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(y,p);break;case 30:this._animation.addConstraintTimeline(y,p);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(y,p)}}}}return this._animation=null,i},i.prototype._parseGeometry=function(e,i){i.offset=e[t.DataParser.OFFSET],i.data=this._data;var r=this._intArrayBuffer[i.offset+3];if(r>=0){var n=t.BaseObject.borrowObject(t.WeightData),a=this._intArrayBuffer[i.offset+0],s=this._intArrayBuffer[r+0];n.offset=r;for(var o=0;o<s;++o){var h=this._intArrayBuffer[r+2+o];n.addBone(this._rawBones[h])}for(var l=r+2+s,u=0,c=(o=0,a);o<c;++o){var p=this._intArrayBuffer[l++];u+=p,l+=p}n.count=u,i.weight=n}},i.prototype._parseArray=function(e){var i=e[t.DataParser.OFFSET],r=i[1],n=i[3],a=i[5],s=i[7],o=i[9],h=i[11],l=i.length>12?i[13]:0,u=new Int16Array(this._binary,this._binaryOffset+i[0],r/Int16Array.BYTES_PER_ELEMENT),c=new Float32Array(this._binary,this._binaryOffset+i[2],n/Float32Array.BYTES_PER_ELEMENT),p=new Int16Array(this._binary,this._binaryOffset+i[4],a/Int16Array.BYTES_PER_ELEMENT),d=new Float32Array(this._binary,this._binaryOffset+i[6],s/Float32Array.BYTES_PER_ELEMENT),f=new Int16Array(this._binary,this._binaryOffset+i[8],o/Int16Array.BYTES_PER_ELEMENT),_=new Uint16Array(this._binary,this._binaryOffset+i[10],h/Uint16Array.BYTES_PER_ELEMENT),g=l>0?new Int16Array(this._binary,this._binaryOffset+i[12],l/Int16Array.BYTES_PER_ELEMENT):u;this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=u,this._data.floatArray=c,this._data.frameIntArray=p,this._data.frameFloatArray=d,this._data.frameArray=this._frameArrayBuffer=f,this._data.timelineArray=this._timelineArrayBuffer=_,this._data.colorArray=g},i.prototype.parseDragonBonesData=function(t,i){void 0===i&&(i=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var r=new Uint8Array(t,0,8);if(r[0]!=="D".charCodeAt(0)||r[1]!=="B".charCodeAt(0)||r[2]!=="D".charCodeAt(0)||r[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var n=new Uint32Array(t,8,1)[0],a=new Uint8Array(t,12,n),s=this._decodeUTF8(a),o=JSON.parse(s);return this._binaryOffset=12+n,this._binary=t,e.prototype.parseDragonBonesData.call(this,o,i)},i.getInstance=function(){return null===i._binaryDataParserInstance&&(i._binaryDataParserInstance=new i),i._binaryDataParserInstance},i._binaryDataParserInstance=null,i}(t.ObjectDataParser);t.BinaryDataParser=e}(dragonBones||(dragonBones={})),function(t){var e=function(){function e(i){void 0===i&&(i=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===e._objectParser&&(e._objectParser=new t.ObjectDataParser),null===e._binaryParser&&(e._binaryParser=new t.BinaryDataParser),this._dataParser=null!==i?i:e._objectParser}return e.prototype._isSupportMesh=function(){return!0},e.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var i=0,r=this._textureAtlasDataMap[t];i<r.length;i++){var n=r[i],a=n.getTexture(e);if(null!==a)return a}if(this.autoSearch)for(var s in this._textureAtlasDataMap)for(var o=0,h=this._textureAtlasDataMap[s];o<h.length;o++){n=h[o];if(n.autoSearch){a=n.getTexture(e);if(null!==a)return a}}return null},e.prototype._fillBuildArmaturePackage=function(t,e,i,r,n){var a=null,s=null;if(e.length>0&&e in this._dragonBonesDataMap&&(a=this._dragonBonesDataMap[e],s=a.getArmature(i)),null===s&&(0===e.length||this.autoSearch))for(var o in this._dragonBonesDataMap)if(a=this._dragonBonesDataMap[o],(0===e.length||a.autoSearch)&&(s=a.getArmature(i),null!==s)){e=o;break}if(null!==s){if(t.dataName=e,t.textureAtlasName=n,t.data=a,t.armature=s,t.skin=null,r.length>0&&(t.skin=s.getSkin(r),null===t.skin&&this.autoSearch))for(var o in this._dragonBonesDataMap){var h=this._dragonBonesDataMap[o],l=h.getArmature(r);if(null!==l){t.skin=l.defaultSkin;break}}return null===t.skin&&(t.skin=s.defaultSkin),!0}return!1},e.prototype._buildBones=function(e,i){for(var r=0,n=e.armature.sortedBones;r<n.length;r++){var a=n[r],s=t.BaseObject.borrowObject(0===a.type?t.Bone:t.Surface);s.init(a,i)}},e.prototype._buildSlots=function(t,e){var i=t.skin,r=t.armature.defaultSkin;if(null!==i&&null!==r){var n={};for(var a in r.displays){var s=r.getDisplays(a);n[a]=s}if(i!==r)for(var a in i.displays){s=i.getDisplays(a);n[a]=s}for(var o=0,h=t.armature.sortedSlots;o<h.length;o++){var l=h[o],u=l.name in n?n[l.name]:null,c=this._buildSlot(t,l,e);if(null!==u){c.displayFrameCount=u.length;for(var p=0,d=c.displayFrameCount;p<d;++p){var f=u[p];if(c.replaceRawDisplayData(f,p),null!==f){if(t.textureAtlasName.length>0){var _=this._getTextureData(t.textureAtlasName,f.path);c.replaceTextureData(_,p)}var g=this._getSlotDisplay(t,f,c);c.replaceDisplay(g,p)}else c.replaceDisplay(null)}}c._setDisplayIndex(l.displayIndex,!0)}}},e.prototype._buildConstraints=function(e,i){var r=e.armature.constraints;for(var n in r){var a=r[n];switch(a.type){case 0:var s=t.BaseObject.borrowObject(t.IKConstraint);s.init(a,i),i._addConstraint(s);break;case 1:var o=t.BaseObject.borrowObject(t.PathConstraint);o.init(a,i),i._addConstraint(o);break;default:var h=t.BaseObject.borrowObject(t.IKConstraint);h.init(a,i),i._addConstraint(h)}}},e.prototype._buildChildArmature=function(t,e,i){return this.buildArmature(i.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},e.prototype._getSlotDisplay=function(e,i,r){var n=null!==e?e.dataName:i.parent.parent.parent.name,a=null;switch(i.type){case 0:var s=i;null===s.texture&&(s.texture=this._getTextureData(n,i.path)),a=r.rawDisplay;break;case 2:var o=i;null===o.texture&&(o.texture=this._getTextureData(n,o.path)),a=this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break;case 1:var h=i,l=this._buildChildArmature(e,r,h);if(null!==l){if(l.inheritAnimation=h.inheritAnimation,!l.inheritAnimation){var u=h.actions.length>0?h.actions:l.armatureData.defaultActions;if(u.length>0)for(var c=0,p=u;c<p.length;c++){var d=p[c],f=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(d,f,r.armature),f.slot=r,r.armature._bufferAction(f,!1)}else l.animation.play()}h.armature=l.armatureData}a=l}return a},e.prototype.parseDragonBonesData=function(t,i,r){void 0===i&&(i=null),void 0===r&&(r=1);for(var n=t instanceof ArrayBuffer?e._binaryParser:this._dataParser,a=n.parseDragonBonesData(t,r);;){var s=this._buildTextureAtlasData(null,null);if(!n.parseTextureAtlasData(null,s,r)){s.returnToPool();break}this.addTextureAtlasData(s,i)}return null!==a&&this.addDragonBonesData(a,i),a},e.prototype.parseTextureAtlasData=function(t,e,i,r){void 0===i&&(i=null),void 0===r&&(r=1);var n=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,n,r),this._buildTextureAtlasData(n,e||null),this.addTextureAtlasData(n,i),n},e.prototype.updateTextureAtlases=function(t,e){var i=this.getTextureAtlasData(e);if(null!==i)for(var r=0,n=i.length;r<n;++r)r<t.length&&this._buildTextureAtlasData(i[r],t[r])},e.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},e.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),e=null!==e?e:t.name,e in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},e.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},e.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},e.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null),e=null!==e?e:t.name;var i=e in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];i.indexOf(t)<0&&i.push(t)},e.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e)for(var r=0,n=i;r<n.length;r++){var a=n[r];this._dragonBones.bufferObject(a)}delete this._textureAtlasDataMap[t]}},e.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var r=new i;return this._fillBuildArmaturePackage(r,e,t,"","")?r.armature:null},e.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=this._textureAtlasDataMap[e],r=0,n=i;r<n.length;r++){var a=n[r];this._dragonBones.bufferObject(a)}delete this._textureAtlasDataMap[e]}},e.prototype.buildArmature=function(t,e,r,n){void 0===e&&(e=""),void 0===r&&(r=""),void 0===n&&(n="");var a=new i;if(!this._fillBuildArmaturePackage(a,e||"",t,r||"",n||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var s=this._buildArmature(a);return this._buildBones(a,s),this._buildSlots(a,s),this._buildConstraints(a,s),s.invalidUpdate(null,!0),s.advanceTime(0),s},e.prototype.replaceDisplay=function(t,e,i){if(void 0===i&&(i=-1),i<0&&(i=t.displayIndex),i<0&&(i=0),t.replaceDisplayData(e,i),null!==e){var r=this._getSlotDisplay(null,e,t);if(0===e.type){var n=t.getDisplayFrameAt(i).rawDisplayData;null!==n&&2===n.type&&(r=t.meshDisplay)}t.replaceDisplay(r,i)}else t.replaceDisplay(null,i)},e.prototype.replaceSlotDisplay=function(t,e,i,r,n,a){void 0===a&&(a=-1);var s=this.getArmatureData(e,t||"");if(null===s||null===s.defaultSkin)return!1;var o=s.defaultSkin.getDisplay(i,r);return this.replaceDisplay(n,o,a),!0},e.prototype.replaceSlotDisplayList=function(t,e,i,r){var n=this.getArmatureData(e,t||"");if(!n||!n.defaultSkin)return!1;var a=n.defaultSkin.getDisplays(i);if(!a)return!1;r.displayFrameCount=a.length;for(var s=0,o=r.displayFrameCount;s<o;++s){var h=a[s];this.replaceDisplay(r,h,s)}return!0},e.prototype.replaceSkin=function(t,e,i,r){void 0===i&&(i=!1),void 0===r&&(r=null);for(var n=!1,a=e.parent.defaultSkin,s=0,o=t.getSlots();s<o.length;s++){var h=o[s];if(!(null!==r&&r.indexOf(h.name)>=0)){var l=e.getDisplays(h.name);if(null!==l||(null!==a&&e!==a&&(l=a.getDisplays(h.name)),null!==l)){h.displayFrameCount=l.length;for(var u=0,c=h.displayFrameCount;u<c;++u){var p=l[u];h.replaceRawDisplayData(p,u),null!==p?h.replaceDisplay(this._getSlotDisplay(null,p,h),u):h.replaceDisplay(null,u)}n=!0}else i&&(h.displayFrameCount=0)}}return n},e.prototype.replaceAnimation=function(e,i,r){void 0===r&&(r=!0);var n=i.defaultSkin;if(null===n)return!1;if(r)e.animation.animations=i.animations;else{var a=e.animation.animations,s={};for(var o in a)s[o]=a[o];for(var o in i.animations)s[o]=i.animations[o];e.animation.animations=s}for(var h=0,l=e.getSlots();h<l.length;h++)for(var u=l[h],c=0,p=0,d=u.displayList;p<d.length;p++){var f=d[p];if(f instanceof t.Armature){var _=n.getDisplays(u.name);if(null!==_&&c<_.length){var g=_[c];if(null!==g&&1===g.type){var m=this.getArmatureData(g.path,g.parent.parent.parent.name);m&&this.replaceAnimation(f,m,r)}}}c++}return!0},e.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},e.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(e.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),e._objectParser=null,e._binaryParser=null,e}();t.BaseFactory=e;var i=function(){function t(){this.dataName="",this.textureAtlasName="",this.skin=null}return t}();t.BuildArmaturePackage=i}(dragonBones||(dragonBones={})),function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderTexture=null,t}return __extends(r,e),r.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"},r.prototype._onClear=function(){e.prototype._onClear.call(this),this._renderTexture,this._renderTexture=null},r.prototype.createTexture=function(){return t.BaseObject.borrowObject(i)},Object.defineProperty(r.prototype,"renderTexture",{get:function(){return this._renderTexture},set:function(t){if(this._renderTexture!==t)if(this._renderTexture=t,null!==this._renderTexture)for(var e in this.textures){var i=this.textures[e];i.renderTexture=new PIXI.Texture(this._renderTexture,i.region,i.region,new PIXI.Rectangle(0,0,i.region.width,i.region.height))}else for(var e in this.textures){i=this.textures[e];i.renderTexture=null}},enumerable:!0,configurable:!0}),r}(t.TextureAtlasData);t.PhaserTextureAtlasData=e;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.renderTexture=null,e}return __extends(e,t),e.toString=function(){return"[class dragonBones.PhaserTextureData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.renderTexture&&this.renderTexture.destroy(!1),this.renderTexture=null},e}(t.TextureData);t.PhaserTextureData=i}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(){var t=e.call(this,window.qc_game)||this;return t.debugDraw=!1,t._debugDraw=!1,t._armature=null,t._signals={},t._debugDrawer=null,t.positionHasSet=!1,t}return __extends(i,e),i.prototype.updateTransform=function(e){if(!e&&!this.parent&&!this.game)return this;var i=this.parent;e?i=e:this.parent||(i=this.game.world)
;var r,n,a,s,o,h,l=i.worldTransform,u=this.worldTransform;if(this.rotation%Phaser.Math.PI2){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var c=this.skew%t.Transform.PI_D;c>.01||c<-.01?(r=this._cr*this.scaleX,n=this._sr*this.scaleX,a=-Math.sin(c+this.rotation)*this.scaleY,s=Math.cos(c+this.rotation)*this.scaleY,o=this.x,h=this.y):(r=this._cr*this.scaleX,n=this._sr*this.scaleX,a=-this._sr*this.scaleY,s=this._cr*this.scaleY,o=this.x,h=this.y),(this.pivotX||this.pivotY)&&(o-=this.pivotX*r+this.pivotY*a,h-=this.pivotX*n+this.pivotY*s),u.a=r*l.a+n*l.c,u.b=r*l.b+n*l.d,u.c=a*l.a+s*l.c,u.d=a*l.b+s*l.d,u.tx=o*l.a+h*l.c+l.tx,u.ty=o*l.b+h*l.d+l.ty}else r=this.scaleX,n=0,a=0,s=this.scaleY,o=this.x-this.pivotX*r,h=this.y-this.pivotY*s,u.a=r*l.a,u.b=r*l.b,u.c=s*l.c,u.d=s*l.d,u.tx=o*l.a+h*l.c+l.tx,u.ty=o*l.b+h*l.d+l.ty;r=u.a,n=u.b,a=u.c,s=u.d;if(r||n){var p=Math.sqrt(r*r+n*n);this.worldRotationTmp=n>0?Math.acos(r/p):-Math.acos(r/p)}else if(a||s){var d=Math.sqrt(a*a+s*s);this.worldRotationTmp=Phaser.Math.HALF_PI-(s>0?Math.acos(-a/d):-Math.acos(a/d))}return this.worldAlpha=this.alpha*i.worldAlpha,this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,u,l),this},i.prototype._getChildByName=function(t,e){for(var i=0,r=t.children;i<r.length;i++){var n=r[i];if(n.name===e)return n}return null},i.prototype.dbInit=function(t){this._armature=t},i.prototype.dbClear=function(){for(var t in this._signals){var i=this._signals[t];i.removeAll(),i.dispose(),delete this._signals[t]}this._debugDrawer,e.prototype.destroy.call(this,!1)},i.prototype.dbUpdate=function(){var e=t.DragonBones.debugDraw||this.debugDraw;if(e||this._debugDraw)if(this._debugDraw=e,this._debugDraw){if(null===this._debugDrawer){this._debugDrawer=new Phaser.Sprite(this.game,0,0);var i=new Phaser.Graphics(this.game);this._debugDrawer.addChild(i)}this.addChild(this._debugDrawer);var r=this._debugDrawer.getChildAt(0);r.clear();for(var n=this._armature.getBones(),a=0,s=n.length;a<s;++a){var o=n[a],h=o.boneData.length,l=o.globalTransformMatrix.tx,u=o.globalTransformMatrix.ty,c=l+o.globalTransformMatrix.a*h,p=u+o.globalTransformMatrix.b*h;r.lineStyle(2,65535,.7),r.moveTo(l,u),r.lineTo(c,p),r.lineStyle(0,0,0),r.beginFill(65535,.7),r.drawCircle(l,u,3),r.endFill()}var d=this._armature.getSlots();for(a=0,s=d.length;a<s;++a){var f=d[a],_=f.boundingBoxData;if(_){var g=this._getChildByName(this._debugDrawer,f.name);switch(g||(g=new Phaser.Graphics(this.game),g.name=f.name,this._debugDrawer.addChild(g)),g.clear(),g.lineStyle(2,16711935,.7),_.type){case 0:g.drawRect(.5*-_.width,.5*-_.height,_.width,_.height);break;case 1:g.drawEllipse(.5*-_.width,.5*-_.height,_.width,_.height);break;case 2:for(var m=_.vertices,y=0,v=m.length;y<v;y+=2){var T=m[y],x=m[y+1];0===y?g.moveTo(T,x):g.lineTo(T,x)}g.lineTo(m[0],m[1])}g.endFill(),f.updateTransformAndMatrix(),f.updateGlobalTransform();var b=f.global;g.x=b.x,g.y=b.y,g.rotation=b.rotation,g.scale.x=b.scaleX,g.scale.y=b.scaleY,g.pivot.x=f._pivotX,g.pivot.y=f._pivotY}else{g=this._getChildByName(this._debugDrawer,f.name);g&&this._debugDrawer.removeChild(g)}}}else null!==this._debugDrawer&&this._debugDrawer.parent===this&&this.removeChild(this._debugDrawer)},i.prototype.dispose=function(t){void 0===t&&(t=!0),null!==this._armature&&(this._armature.dispose(),this._armature=null)},i.prototype.destroy=function(){this.dispose()},i.prototype.dispatchDBEvent=function(t,e){t in this._signals||(this._signals[t]=new Phaser.Signal);var i=this._signals[t];i.dispatch(e)},i.prototype.hasDBEventListener=function(t){return t in this._signals&&this._signals[t].getNumListeners()>0},i.prototype.addDBEventListener=function(t,e,i){t in this._signals||(this._signals[t]=new Phaser.Signal);var r=this._signals[t];r.add(e,i)},i.prototype.removeDBEventListener=function(t,e,i){if(t in this._signals){var r=this._signals[t];r.remove(e,i)}},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),i.prototype.hasEvent=function(t){return this.hasDBEventListener(t)},i.prototype.addEvent=function(t,e,i){this.addDBEventListener(t,e,i)},i.prototype.removeEvent=function(t,e,i){this.removeDBEventListener(t,e,i)},i}(qc.Sprite);t.PhaserArmatureDisplay=e}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.toString=function(){return"[class dragonBones.PhaserSlot]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this._textureScale=1,this._renderDisplay=null},i.prototype._initDisplay=function(t,e){},i.prototype._disposeDisplay=function(t,e){e||t.destroy(!0)},i.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display?this._display:this._rawDisplay},i.prototype._addDisplay=function(){var t=this._armature.display;t.addChild(this._renderDisplay)},i.prototype._replaceDisplay=function(t){var e=this._armature.display,i=t;e.addChild(this._renderDisplay),e.swapChildren(this._renderDisplay,i),e.removeChild(i),this._textureScale=1},i.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},i.prototype._updateZOrder=function(){var t=this._armature.display,e=t.getChildIndex(this._renderDisplay);e!==this._zOrder&&t.addChildAt(this._renderDisplay,this._zOrder)},i.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible&&this._visible},i.prototype._updateBlendMode=function(){if(this._renderDisplay instanceof PIXI.Sprite)switch(this._blendMode){case 0:this._renderDisplay.blendMode=PIXI.blendModes.NORMAL;break;case 1:this._renderDisplay.blendMode=PIXI.blendModes.ADD;break;case 3:this._renderDisplay.blendMode=PIXI.blendModes.DARKEN;break;case 4:this._renderDisplay.blendMode=PIXI.blendModes.DIFFERENCE;break;case 6:this._renderDisplay.blendMode=PIXI.blendModes.HARD_LIGHT;break;case 9:this._renderDisplay.blendMode=PIXI.blendModes.LIGHTEN;break;case 10:this._renderDisplay.blendMode=PIXI.blendModes.MULTIPLY;break;case 11:this._renderDisplay.blendMode=PIXI.blendModes.OVERLAY;break;case 12:this._renderDisplay.blendMode=PIXI.blendModes.SCREEN}},i.prototype._updateColor=function(){var t=this._colorTransform.alphaMultiplier*this._globalAlpha;if(this._renderDisplay.alpha=t,this._renderDisplay instanceof PIXI.Sprite){var e=(Math.round(255*this._colorTransform.redMultiplier)<<16)+(Math.round(255*this._colorTransform.greenMultiplier)<<8)+Math.round(255*this._colorTransform.blueMultiplier);this._renderDisplay.tint=e}},i.prototype._updateFrame=function(){var e=this._textureData;if(this._displayIndex>=0&&null!==this._display&&null!==e){var i=e.parent;null!==this._armature.replacedTexture&&(null===this._armature._replaceTextureAtlasData?(i=t.BaseObject.borrowObject(t.PhaserTextureAtlasData),i.copyFrom(e.parent),i.renderTexture=this._armature.replacedTexture,this._armature._replaceTextureAtlasData=i):i=this._armature._replaceTextureAtlasData,e=i.getTexture(e.name));var r=e.renderTexture;if(null!==r){if(null!==this._geometryData);else{this._textureScale=e.parent.scale*this._armature._armatureData.scale;var n=this._renderDisplay;n.change_texture?(n.texture=n.change_texture,n.resetNativeSize()):n.phaser.texture=r;var a=e.name.split("/");n.name=a[a.length-1],n._bone=!0,n.resetNativeSize()}return void(this._visibleDirty=!0)}}if(null!==this._geometryData);else{n=this._renderDisplay;n.x=0,n.y=0,n.visible=!1}},i.prototype._updateMesh=function(){},i.prototype._updateTransform=function(){this.updateGlobalTransform();var e=this.global,i=this._renderDisplay.getScript(ps.Layout);if(!i)if(this._renderDisplay===this._rawDisplay||this._renderDisplay===this._meshDisplay){var r=e.x-(this.globalTransformMatrix.a*this._pivotX+this.globalTransformMatrix.c*this._pivotY),n=e.y-(this.globalTransformMatrix.b*this._pivotX+this.globalTransformMatrix.d*this._pivotY);this._renderDisplay.x=r,this._renderDisplay.y=n}else this._renderDisplay.x=e.x,this._renderDisplay.y=e.y,this._renderDisplay instanceof t.PhaserArmatureDisplay&&(this._renderDisplay.positionHasSet=!0);if(this._renderDisplay.rotation=e.rotation,this._renderDisplay.skew=e.skew,this._renderDisplay.scaleX=e.scaleX*this._textureScale,this._renderDisplay.scaleY=e.scaleY*this._textureScale,this._renderDisplay instanceof t.PhaserArmatureDisplay){var a=.001*qc_game.time.deltaTime;this._renderDisplay.armature.advanceTime(a)}else this._renderDisplay.updateTransform()},i.prototype._identityTransform=function(){this._renderDisplay.x=0,this._renderDisplay.y=0,this._renderDisplay.rotation=0,this._renderDisplay.skew=0,this._renderDisplay.scale.x=1,this._renderDisplay.scale.y=1},i}(t.Slot);t.PhaserSlot=e}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(t){var i=null!==e&&e.call(this,window.qc_game)||this;return i.change_texture=null,i}return __extends(i,e),i.prototype.updateTransform=function(e){if(!e&&!this.parent&&!this.game)return this;var i=this.parent;e?i=e:this.parent||(i=this.game.world);var r,n,a,s,o,h,l=i.worldTransform,u=this.worldTransform;if(this.rotation%Phaser.Math.PI2){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var c=this.skew%t.Transform.PI_D;c>.01||c<-.01?(r=this._cr*this.scaleX,n=this._sr*this.scaleX,a=-Math.sin(c+this.rotation)*this.scaleY,s=Math.cos(c+this.rotation)*this.scaleY,o=this.x,h=this.y):(r=this._cr*this.scaleX,n=this._sr*this.scaleX,a=-this._sr*this.scaleY,s=this._cr*this.scaleY,o=this.x,h=this.y),(this.pivotX||this.pivotY)&&(o-=this.pivotX*r+this.pivotY*a,h-=this.pivotX*n+this.pivotY*s),u.a=r*l.a+n*l.c,u.b=r*l.b+n*l.d,u.c=a*l.a+s*l.c,u.d=a*l.b+s*l.d,u.tx=o*l.a+h*l.c+l.tx,u.ty=o*l.b+h*l.d+l.ty}else r=this.scaleX,n=0,a=0,s=this.scaleY,o=this.x-this.pivotX*r,h=this.y-this.pivotY*s,u.a=r*l.a,u.b=r*l.b,u.c=s*l.c,u.d=s*l.d,u.tx=o*l.a+h*l.c+l.tx,u.ty=o*l.b+h*l.d+l.ty;r=u.a,n=u.b,a=u.c,s=u.d;if(r||n){var p=Math.sqrt(r*r+n*n);this.worldRotationTmp=n>0?Math.acos(r/p):-Math.acos(r/p)}else if(a||s){var d=Math.sqrt(a*a+s*s);this.worldRotationTmp=Phaser.Math.HALF_PI-(s>0?Math.acos(-a/d):-Math.acos(a/d))}return this.worldAlpha=this.alpha*i.worldAlpha,this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,u,l),this},i}(qc.UIImage);t.PhaserSlotDisplay=e}(dragonBones||(dragonBones={})),function(t){var e=function(e){function i(t){void 0===t&&(t=null);var r=e.call(this,t)||this;return r._dragonBones=i._dragonBonesInstance,r}return __extends(i,e),i.init=function(e){if(null===i._game){i._game=e;var r=new t.PhaserArmatureDisplay;r.parent&&r.parent.removeChild(r),i._dragonBonesInstance=new t.DragonBones(r)}},Object.defineProperty(i,"factory",{get:function(){return null===i._factory&&(i._factory=new i),i._factory},enumerable:!0,configurable:!0}),i.prototype._isSupportMesh=function(){return console.warn("Phaser-ce can not support mesh."),!1},i.prototype._buildTextureAtlasData=function(e,i){return e?e.renderTexture=i:e=t.BaseObject.borrowObject(t.PhaserTextureAtlasData),e},i.prototype._buildArmature=function(e){var i=t.BaseObject.borrowObject(t.Armature),r=new t.PhaserArmatureDisplay;return r.parent&&r.parent.removeChild(r),r.name=e.armature.name,i.init(e.armature,r,r,this._dragonBones),i},i.prototype._buildSlot=function(e,i,r){var n=t.BaseObject.borrowObject(t.PhaserSlot),a=new t.PhaserSlotDisplay;return a.parent&&a.parent.removeChild(a),n.init(i,r,a,a),n},i.prototype.buildArmatureDisplay=function(t,e,i,r){void 0===e&&(e=""),void 0===i&&(i=""),void 0===r&&(r="");var n=this.buildArmature(t,e||"",i||"",r||"");return null!==n?(this._dragonBones.clock.add(n),n):null},i.prototype.getTextureDisplay=function(t,e){void 0===e&&(e=null);var r=this._getTextureData(null!==e?e:"",t);return null!==r&&null!==r.renderTexture?new Phaser.Sprite(i._game,0,0):null},Object.defineProperty(i.prototype,"soundEventManager",{get:function(){return this._dragonBones.eventManager},enumerable:!0,configurable:!0}),i._game=null,i._dragonBonesInstance=null,i._factory=null,i}(t.BaseFactory);t.PhaserFactory=e}(dragonBones||(dragonBones={})),dragonBones.CoverAtlas=function(t){for(var e,i,r={meta:{image:t.imagePath},frames:e={}},n=t.SubTexture,a=n.length,s=0;s<a;s++)i=n[s],e[i.name]={filename:i.name,frame:{x:i.x,y:i.y,w:i.width,h:i.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:i.width,h:i.height},sourceSize:{w:i.width,h:i.height}};return r},dragonBones.findArmature=function(t){return t.armature[0].name},dragonBones.makeQcArmature=function(t,e,i,r){var n=dragonBones.PhaserFactory.factory;n.addDragonBonesData(n.parseDragonBonesData(t),"aaa");var a=new qc.UIImage(dragonBones.game._qc);a.texture=dragonBones.game._qc.assets.find(r),n.addTextureAtlasData(n.parseTextureAtlasData(e,a.phaser.texture),"bbb"),a.parent&&a.parent.removeChild(a);var s=n.buildArmature(dragonBones.findArmature(t));return s&&(s._clock=new dragonBones.WorldClock),n.clear(!1),s},qc.dragonBones=dragonBones,Phaser.Text=function(t,e,i,r,n){e=e||0,i=i||0,r=null==r?"":r.toString(),n=Phaser.Utils.extend({},n),this.type=Phaser.TEXT,this.realWidth=0,this.realHeight=0,this.physicsType=Phaser.SPRITE,this.padding=new Phaser.Point,this.textBounds=null,this.canvas=Phaser.Canvas.create(),this.context=this.canvas.getContext("2d"),this.colors=[],this.strokeColors=[],this.fontStyles=[],this.fontWeights=[],this.autoRound=!1,this.useAdvancedWrap=!1,this._res=1,this._text=r,this._fontComponents=null,this._lineSpacing=0,this._lineHeight=1,this._letterSpacing=0,this._enableUnderline=!1,this._underlineColor=[],this._underlineWidth=1,this._underlineSpacing=0,this._enableDeleteline=!1,this._deletelineColor=[],this._deletelineWidth=1,this._deletelineSpacing=0,this._gradientByLine=!0,this._charCount=0,this._width=0,this._height=0,this._canvasPadding={left:0,right:0,top:0,bottom:0},Phaser.Sprite.call(this,t,e,i,PIXI.Texture.fromCanvas(this.canvas)),this.setStyle(n),""!==r&&this.updateText()},Phaser.Text.prototype=Object.create(Phaser.Sprite.prototype),Phaser.Text.prototype.constructor=Phaser.Text,Phaser.Text.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},Phaser.Text.prototype.update=function(){},Phaser.Text.prototype.destroy=function(t){this.texture.destroy(!0),Phaser.Component.Destroy.prototype.destroy.call(this,t)},Phaser.Text.prototype.setShadow=function(t,e,i,r,n,a){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="rgba(0, 0, 0, 1)"),void 0===r&&(r=0),void 0===n&&(n=!0),void 0===a&&(a=!0),this.style.shadowOffsetX=t,this.style.shadowOffsetY=e,this.style.shadowColor=i,this.style.shadowBlur=r,this.style.shadowStroke=n,this.style.shadowFill=a,this.dirty=!0,this},Phaser.Text.prototype.setStyle=function(t,e){void 0===e&&(e=!1),t=t||{},t.font=t.font||"bold 20pt Arial",t.backgroundColor=t.backgroundColor||null,t.fill=t.fill||"black",t.align=t.align||"left",t.boundsAlignH=t.boundsAlignH||"left",t.boundsAlignV=t.boundsAlignV||"top",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.wordWrapHeight=t.wordWrapHeight||100,t.maxLines=t.maxLines||0,t.shadowOffsetX=t.shadowOffsetX||0,t.shadowOffsetY=t.shadowOffsetY||0,t.shadowColor=t.shadowColor||"rgba(0,0,0,0)",t.shadowBlur=t.shadowBlur||0,t.tabs=t.tabs||0,t.shadowFill=t.shadowFill||!0;var i=this.fontToComponents(t.font);return t.fontStyle&&(i.fontStyle=t.fontStyle),t.fontVariant&&(i.fontVariant=t.fontVariant),t.fontWeight&&(i.fontWeight=t.fontWeight),t.fontSize&&("number"==typeof t.fontSize&&(t.fontSize=t.fontSize+"px"),i.fontSize=t.fontSize),this._fontComponents=i,t.font=this.componentsToFont(this._fontComponents),this.style=t,this.dirty=!0,e&&this.updateText(),this},Phaser.Text.prototype.updatePaddingRect=function(){var t=0,e=0,i=0,r=0,n=0;if(this.enableUnderline&&(e=this.underlineSpacing+this.underlineWidth,i=this.underlineWidth/2,r=this.underlineWidth/2),this.style.strokeThickness&&(n=this.style.strokeThickness,i=Math.max(i,n/2),r=Math.max(r,n/2),t=Math.max(t,n/2),e=Math.max(e,n/2)),this.style.shadowFill){var a=this.style.shadowBlur+n,s=this.style.shadowOffsetX,o=this.style.shadowOffsetY;i=Math.max(i,-s+a),r=Math.max(r,s+a),t=Math.max(t,-o+a),e=Math.max(e,o+a)}if("italic"===this.fontStyle){var h=this.fontSize*Math.tan(.20943951);r+=h}this._canvasPadding.left=i,this._canvasPadding.right=r,this._canvasPadding.top=t,this._canvasPadding.bottom=e},Phaser.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var t,e=this.text;this.updatePaddingRect(),this.style.wordWrap?(e=e.replace(/(?:\r\n|\r|\n)/g,"\n"),t=this.runWordWrap(e,this.wordWrapWidth)):t=e.split(/(?:\r\n|\r|\n)/);var i=this.style.tabs,r=[],n=0,a=this.determineFontProperties(this.style.font),s=t.length;this.style.maxLines>0&&this.style.maxLines<t.length&&(s=this.style.maxLines),this._charCount=0;for(var o=0;o<s;o++)lineWidth=this.measureLine(t[o],!0),r[o]=Math.ceil(lineWidth),n=Math.max(n,r[o],this.wordWrapWidth);this.canvas.width=n*this._res+this._canvasPadding.left+this._canvasPadding.right;var h=a.fontSize,l=h*s,u=this.lineSpacing;u<0&&Math.abs(u)>h&&(u=-h),0!==u&&(l+=u>0?u*t.length:u*(t.length-1));var c,p,d=Math.max(this.style.wordWrapHeight,l);this.canvas.height=d,this.realWidth=this.canvas.width,this.realHeight=this.canvas.height,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=Number(this.style.strokeThickness),this.context.lineCap="square",this.context.lineJoin="round",this._charCount=0;var f=h*(s-1),_=this._canvasPadding.top+a.ascent-a.descent;for("bottom"===this.style.boundsAlignV?_=this.canvas.height-f-this._canvasPadding.bottom:"middle"===this.style.boundsAlignV&&(_+=(this.canvas.height-f-this._canvasPadding.bottom-_)/2),o=0;o<s;o++)if(c=this._canvasPadding.left,p=_,p+=(h+u)*o,this.context.textAlign="left","right"===this.style.boundsAlignH?c+=n-r[o]:"center"===this.style.boundsAlignH&&(c+=(n-r[o])/2),this.autoRound&&(c=Math.round(c),p=Math.round(p)),this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0)this.updateLine(t[o],c,p);else{var g=["ar","my"],m=languagesMgr.getLang()?languagesMgr.getLang().toLocaleLowerCase():"";g.every(function(t){return m!==t})?this.updateLine(t[o],c,p):(this.style.stroke&&this.style.strokeThickness&&(0===i?this.context.strokeText(t[o],c,p):this.renderTabLine(t[o],c,p,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===i?this.context.fillText(t[o],c,p):this.renderTabLine(t[o],c,p,!0)))}this.updateTexture(),this.dirty=!1},Phaser.Text.prototype.renderTabLine=function(t,e,i,r){var n=t.split(/(?:\t)/),a=this.style.tabs,s=0;if(Array.isArray(a))for(var o=0,h=0;h<n.length;h++)h>0&&(o+=a[h-1]),s=e+o,r?this.context.fillText(n[h],s,i):this.context.strokeText(n[h],s,i);else for(h=0;h<n.length;h++){var l=Math.ceil(this.context.measureText(n[h]).width);s=this.game.math.snapToCeil(e,a),r?this.context.fillText(n[h],s,i):this.context.strokeText(n[h],s,i),e=s+l}},Phaser.Text.prototype.updateShadow=function(t){t?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)},Phaser.Text.prototype.measureLine=function(t,e){null==e&&(e=!1);var i=0,r=this.splitter||new GraphemeSplitter;this.splitter||(this.splitter=r);for(var n=r.splitGraphemes(t),a=0;a<n.length;a++){var s=n[a],o=this.context.measureText(s).width;e&&this.letterSpacing&&a!=t.length-1&&(o+=this.letterSpacing),i+=o,this._charCount++}return Math.ceil(i)},Phaser.Text.prototype.updateLine=function(t,e,i){var r=this.measureLine(t,!1),n=this.letterSpacing||0,a=this.splitter||new GraphemeSplitter;this.splitter||(this.splitter=a);var s=a.splitGraphemes(t);"justify"===this.boundsAlignH&&(n=(this.realWidth-r-this._canvasPadding.left-this._canvasPadding.right)/(s.length-1));var o=this.determineFontProperties(this.style.font),h=e,l=[],u=this;this.context.clearRect(e,i,this._width,this._height);for(var c=0;c<s.length;c++){var p=s[c];if(this.fontWeights.length>0||this.fontStyles.length>0){var d=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(d.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(d.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(d)}var f=this.context.measureText(p).width;if(this.context.save(),this.gradient&&this.gradientByLine){var _=this.context.createLinearGradient(e,i-o.fontSize,e,i);_.addColorStop(0,this.startColor),_.addColorStop(1,this.endColor)}this.style.fill&&(this.gradient&&this.gradientByLine?this.context.fillStyle=_:this.context.fillStyle=this.style.fill,this.updateShadow(this.style.shadowFill),this.context.fillText(p,e,i)),this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(!1),this.context.strokeText(p,e,i)),l.push([p,e,i]),l.forEach(function(t){u.gradient&&u.gradientByLine?u.context.fillStyle=_:u.context.fillStyle=u.style.fill,u.updateShadow(!1),u.context.fillText(t[0],t[1],t[2])}),c!==s.length-1&&(f+=n),e+=f,this._charCount++}if(this.enableUnderline){this.context.beginPath(),this.context.strokeStyle=this.underlineColor,this.context.lineWidth=this.underlineWidth,this.gradient&&(this.gradientByLine?this.context.strokeStyle=_:this.context.strokeStyle=this.fill);var g=this.underlineSpacing;g+=this.style.strokeThickness/2,this.context.moveTo(h,i+this.context.lineWidth/2+g),this.context.lineTo(e,i+this.context.lineWidth/2+g),this.updateShadow(this.style.shadowFill),this.context.stroke()}if(this.enableDeleteline){this.context.beginPath(),this.context.strokeStyle=this.deletelineColor,this.context.lineWidth=this.deletelineWidth,this.gradient&&(this.gradientByLine?this.context.strokeStyle=_:this.context.strokeStyle=this.fill);g=this.deletelineSpacing;this.context.moveTo(h,i-this.fontSize/3+g),this.context.lineTo(e,i-this.fontSize/3+g),this.updateShadow(this.style.shadowFill),this.context.stroke()}this.context.restore()},Phaser.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this},Phaser.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=!0,this},Phaser.Text.prototype.addColor=function(t,e){return this.colors[e]=t,this.dirty=!0,this},Phaser.Text.prototype.addStrokeColor=function(t,e){return this.strokeColors[e]=t,this.dirty=!0,this},Phaser.Text.prototype.addFontStyle=function(t,e){return this.fontStyles[e]=t,this.dirty=!0,this},Phaser.Text.prototype.addFontWeight=function(t,e){return this.fontWeights[e]=t,this.dirty=!0,this},Phaser.Text.prototype.precalculateWordWrap=function(t){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var e=this.runWordWrap(t);return e.split(/(?:\r\n|\r|\n)/)},Phaser.Text.prototype._getWorldWidth=function(t){if(t.length>0&&"\n"===t[t.length-1]){var e=t.substr(0,t.length-1);return this.context.measureText(e).width}return this.context.measureText(t).width},Phaser.Text.prototype._isLetter=function(t){return!(t<"a"||t>"z")||!(t<"A"||t>"Z")},Phaser.Text.prototype.runWordWrap=function(t,e){for(var i=e,r=[],n=0,a=!1,s=0;s<t.length;)if("\n"===t[s]){var o=t.substr(n,s-n+1);1===o.length&&r.length>0&&!a?r[r.length-1]+="\n":r.push(o.split("\n")[0]),s++,n=s,a=!0}else{a=!1;for(var h=-1;s<t.length;){var l=t.charAt(s);if(!this._isLetter(l)){h>=0&&s--;break}-1===h&&(h=s),s++}s===t.length&&s--;var u=this._getWorldWidth(t.substr(n,s-n+1));if(u>i)if(h>=0&&h===n){o=t.substr(n,s-n+1);r.push(o),s++,n=s}else if(h>=0){var c=h-n;o=t.substr(n,c);r.push(o),s=n+c,n=s}else if(s-n==0){o=t.substr(n,s-n+1);r.push(o),s++,n=s}else{o=t.substr(n,s-n);r.push(o),n=s}else if(s++,s===t.length){o=t.substr(n,s-n+1);r.push(o)}}return r},Phaser.Text.prototype.advancedWordWrap=function(t){for(var e=this.context,i=this.style.wordWrapWidth,r="",n=t.replace(/ +/gi," ").split(/\r?\n/gi),a=n.length,s=0;s<a;s++){var o=n[s],h="";o=o.replace(/^ *|\s*$/gi,"");var l=e.measureText(o).width;if(l<i)r+=o+"\n";else{for(var u=i,c=o.split(" "),p=0;p<c.length;p++){var d=c[p],f=d+" ",_=e.measureText(f).width;if(_>u){if(0===p){for(var g=f;g.length&&(g=g.slice(0,-1),_=e.measureText(g).width,!(_<=u)););if(!g.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");var m=d.substr(g.length);c[p]=m,h+=g}var y=c[p].length?p:p+1,v=c.slice(y).join(" ").replace(/[ \n]*$/gi,"");n[s+1]=v+" "+(n[s+1]||""),a=n.length;break}h+=f,u-=_}r+=h.replace(/[ \n]*$/gi,"")+"\n"}}return r=r.replace(/[\s|\n]*$/gi,""),r},Phaser.Text.prototype.basicWordWrap=function(t){for(var e="",i=t.split("\n"),r=0;r<i.length;r++){for(var n=this.style.wordWrapWidth,a=i[r].split(" "),s=0;s<a.length;s++){var o=this.context.measureText(a[s]).width,h=o+this.context.measureText(" ").width;h>n?(s>0&&(e+="\n"),e+=a[s]+" ",n=this.style.wordWrapWidth-o):(n-=h,e+=a[s]+" ")}r<i.length-1&&(e+="\n")}return e},Phaser.Text.prototype.updateFont=function(t){var e=this.componentsToFont(t);this.style.font!==e&&(this.style.font=e,this.dirty=!0,this.parent&&this.updateTransform())},Phaser.Text.prototype.fontToComponents=function(t){var e=t.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(e){var i=e[5].trim();return/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(i)||/['",]/.exec(i)||(i="'"+i+"'"),{font:t,fontStyle:e[1]||"normal",fontVariant:e[2]||"normal",fontWeight:e[3]||"normal",fontSize:e[4]||"medium",fontFamily:i}}return console.warn("Phaser.Text - unparsable CSS font: "+t),{font:t}},Phaser.Text.prototype.componentsToFont=function(t){var e,i=[];return e=t.fontStyle,e&&"normal"!==e&&i.push(e),e=t.fontVariant,e&&"normal"!==e&&i.push(e),e=t.fontWeight,e&&"normal"!==e&&i.push(e),e=t.fontSize,e&&"medium"!==e&&i.push(e),e=t.fontFamily,e&&i.push(e),i.length||i.push(t.font),i.join(" ")},Phaser.Text.prototype.setText=function(t,e){return void 0===e&&(e=!1),this.text=t.toString()||"",e?this.updateText():this.dirty=!0,this},Phaser.Text.prototype.parseList=function(t){if(!Array.isArray(t))return this;for(var e="",i=0;i<t.length;i++)Array.isArray(t[i])?(e+=t[i].join("\t"),i<t.length-1&&(e+="\n")):(e+=t[i],i<t.length-1&&(e+="\t"));return this.text=e,this.dirty=!0,this},Phaser.Text.prototype.setTextBounds=function(t,e,i,r){return void 0===t?this.textBounds=null:(this.textBounds?this.textBounds.setTo(t,e,i,r):this.textBounds=new Phaser.Rectangle(t,e,i,r),this.style.wordWrapWidth>i&&(this.style.wordWrapWidth=i)),this.updateTexture(),this},Phaser.Text.prototype.updateTexture=function(){var t=this.texture.baseTexture,e=this.texture.crop,i=this.texture.frame,r=this.canvas.width,n=this.canvas.height;if(t.width=r,t.height=n,e.width=r,e.height=n,i.width=r,i.height=n,this.texture.width=r,this.texture.height=n,this._width=r,this._height=n,this.textBounds){var a=this.textBounds.x,s=this.textBounds.y;"right"===this.style.boundsAlignH?a+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(a+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?s+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(s+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=-a,this.pivot.y=-s}this.renderable=0!==r&&0!==n,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()},Phaser.Text.prototype._renderWebGL=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderWebGL.call(this,t)},Phaser.Text.prototype._renderCanvas=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderCanvas.call(this,t)},Phaser.Text.prototype.determineFontProperties=function(t){var e=Phaser.Text.fontPropertiesCache[t];if(!e){e={};var i=Phaser.Text.fontPropertiesCanvas,r=Phaser.Text.fontPropertiesContext;r.font=t;var n=Math.ceil(r.measureText("|MÉq").width),a=Math.ceil(r.measureText("|MÉq").width),s=2*a;if(a=1.4*a|0,i.width=n,i.height=s,r.fillStyle="#f00",r.fillRect(0,0,n,s),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|MÉq",0,a),!r.getImageData(0,0,n,s))return e.ascent=a,e.descent=a+6,e.fontSize=e.ascent+e.descent,Phaser.Text.fontPropertiesCache[t]=e,e;var o,h,l=r.getImageData(0,0,n,s).data,u=l.length,c=4*n,p=0,d=!1;for(o=0;o<a;o++){for(h=0;h<c;h+=4)if(255!==l[p+h]){d=!0;break}if(d)break;p+=c}for(e.ascent=a-o,p=u-c,d=!1,o=s;o>a;o--){for(h=0;h<c;h+=4)if(255!==l[p+h]){d=!0;break}if(d)break;p-=c}e.descent=o-a,e.descent+=6,e.fontSize=e.ascent+e.descent,Phaser.Text.fontPropertiesCache[t]=e}return e},Phaser.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,t)},Object.defineProperty(Phaser.Text.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(Phaser.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(t){t=t||"bold 20pt Arial",this._fontComponents=this.fontToComponents(t),this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(t){t=t||"Arial",t=t.trim(),/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)||/['",]/.exec(t)||(t="'"+t+"'"),this._fontComponents.fontFamily=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"fontSize",{get:function(){var t=this._fontComponents.fontSize;return t&&/(?:^0$|px$)/.exec(t)?parseInt(t,10):t},set:function(t){t=t||"0","number"==typeof t&&(t+="px"),this._fontComponents.fontSize=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontWeight=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontStyle=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontVariant=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(Phaser.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){t!==this.style.fill&&(this.style.fill=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){t!==this.style.align&&(this.style.align=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"resolution",{get:function(){return this._res},
set:function(t){t!==this._res&&(this._res=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(t){t!==this.style.tabs&&(this.style.tabs=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(t){t!==this.style.boundsAlignH&&(this.style.boundsAlignH=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(t){t!==this.style.boundsAlignV&&(this.style.boundsAlignV=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){t!==this.style.stroke&&(this.style.stroke=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){t!==this.style.strokeThickness&&(this.style.strokeThickness=Number(t),this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){t!==this.style.wordWrap&&(this.style.wordWrap=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){t!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"wordWrapHeight",{get:function(){return this.style.wordWrapHeight},set:function(t){t!==this.style.wordWrapHeight&&(this.style.wordWrapHeight=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing||0},set:function(t){if(t!==this._lineSpacing){this._lineSpacing=parseFloat(t);var e=this.determineFontProperties(this.style.font).fontSize;this._lineHeight=(this.lineSpacing+e)/e,this.dirty=!0,this.parent&&this.updateTransform()}}}),Object.defineProperty(Phaser.Text.prototype,"lineHeight",{get:function(){return null!=this._lineHeight?this._lineHeight:1},set:function(t){if(t!==this._lineHeight){this._lineHeight=t;var e=this.determineFontProperties(this.style.font).fontSize;this._lineSpacing=this.lineHeight*e-e,this.dirty=!0,this.parent&&this.updateTransform()}}}),Object.defineProperty(Phaser.Text.prototype,"letterSpacing",{get:function(){return this._letterSpacing||0},set:function(t){t!==this._letterSpacing&&(this._letterSpacing=t,this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(Phaser.Text.prototype,"enableUnderline",{get:function(){return this._enableUnderline||!1},set:function(t){t!==this._enableUnderline&&(this._enableUnderline=t,this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(Phaser.Text.prototype,"underlineColor",{get:function(){return this._underlineColor||qc.Color.black},set:function(t){t!==this._underlineColor&&(this._underlineColor=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"underlineWidth",{get:function(){return null!=this._underlineWidth?this._underlineWidth:1},set:function(t){t!==this._underlineWidth&&(this._underlineWidth=t,this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(Phaser.Text.prototype,"underlineSpacing",{get:function(){return this._underlineSpacing||0},set:function(t){t!==this._underlineSpacing&&(this._underlineSpacing=t,this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(Phaser.Text.prototype,"enableDeleteline",{get:function(){return this._enableDeleteline||!1},set:function(t){t!==this._enableDeleteline&&(this._enableDeleteline=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"deletelineColor",{get:function(){return this._deletelineColor||qc.Color.black},set:function(t){t!==this._deletelineColor&&(this._deletelineColor=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"deletelineWidth",{get:function(){return null!=this._deletelineWidth?this._deletelineWidth:1},set:function(t){t!==this._deletelineWidth&&(this._deletelineWidth=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"deletelineSpacing",{get:function(){return null!=this._deletelineSpacing?this._deletelineSpacing:10},set:function(t){t!==this._deletelineSpacing&&(this._deletelineSpacing=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"gradientByLine",{get:function(){return this._gradientByLine},set:function(t){t!==this._gradientByLine&&(this._gradientByLine=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){t!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){t!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){t!==this.style.shadowColor&&(this.style.shadowColor=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){t!==this.style.shadowBlur&&(this.style.shadowBlur=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(t){t!==this.style.shadowStroke&&(this.style.shadowStroke=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(t){t!==this.style.shadowFill&&(this.style.shadowFill=t,this.dirty=!0)}}),Object.defineProperty(Phaser.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(Phaser.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),Phaser.Text.fontPropertiesCache={},Phaser.Text.fontPropertiesCanvas=document.createElement("canvas"),Phaser.Text.fontPropertiesContext=Phaser.Text.fontPropertiesCanvas.getContext("2d"),"undefined"!=typeof module&&module.exports&&(module.exports=GraphemeSplitter);